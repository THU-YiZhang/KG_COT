### 1.1 Analog Integrated-Circuit Design
Integrated-circuit design is separated into two major categories: analog and digital. To characterize these two design methods we must first define analog and digital signals. A signal will be considered to be any detectable value of voltage, current, or charge. A signal should convey information about the state or behavior of a physical system. An analog signal is a signal that is defined over a continuous range of time and a continuous range of amplitudes. An analog signal is illustrated in Fig. 1.1-1(a). A digital signal is a signal that is defined only at discrete values of amplitude or, said another way, a digital signal is quantized to discrete values. Typically, the digital signal is a binary-weighted sum of signals having only two defined values of amplitude as illustrated in Fig. 1.1-1(b) and shown in Eq. (1.1-1). Figure 1.1-1(b) is a three-bit representation of the analog signal shown in Fig. 1.1-1(a).
$$
D = {b}_{N - 1}{2}^{-1} + {b}_{N - 2}{2}^{-2} + {b}_{N - 3}{2}^{-3} + \cdots  + {b}_{0}{2}^{-N} = \mathop{\sum }\limits_{{i = 1}}^{N}{b}_{N - i}{2}^{-i} \tag{1.1-1}
$$
The individual binary numbers, ${b}_{i}$ , have a value of either zero or one. Consequently, it is possible to implement digital circuits using components that operate with only two stable states. This leads to a great deal of regularity and to an algebra that can be used to describe the function of the circuit. As a result, digital circuit designers have been able to adapt readily to the design of more complex integrated circuits.

Figure 1.1-1 Signals. (a) Analog or continuous time. (b) Digital. (c) Analog sampled data or discrete time. $T$ is the period of the digital or sampled signals.

Figure 1.1-2 (a) Analysis process. (b) Design process.
Another type of signal encountered in analog integrated-circuit design is an analog sampled-data signal. An analog sampled-data signal is a signal that is defined over a continuous range of amplitudes but only at discrete points in time. Often the sampled analog signal is held at the value present at the end of the sample period, resulting in a sampled-and-held signal. An analog sampled-and-held signal is illustrated in Fig. 1.1-1(c).
Circuit design is the creative process of developing a circuit that solves a particular problem. Design can be better understood by comparing it to analysis. The analysis of a circuit, illustrated in Fig. 1.1-2(a), is the process by which one starts with the circuit and finds its properties. An important characteristic of the analysis process is that the solution or properties are unique. On the other hand, the synthesis or design of a circuit is the process by which one starts with a desired set of properties and finds a circuit that satisfies them. In a design problem the solution is not unique, thus giving opportunity for the designer to be creative. Consider the design of a 1.5 $\Omega$ resistance as a simple example. This resistance could be realized as the series connection of three ${0.5\Omega }$ resistors, the combination of a ${1\Omega }$ resistor in series with two ${1\Omega }$ resistors in parallel, and so forth. All would satisfy the requirement of ${1.5\Omega }$ resistance, although some might exhibit other properties that would favor their use. Figure 1.1-2 illustrates the difference between synthesis (design) and analysis.
The differences between integrated and discrete analog circuit design are important. Unlike integrated circuits, discrete circuits use active and passive components that are not on the same substrate. A major benefit of components sharing the same substrate in close proximity is that component matching can be used as a tool for design. Another difference between the two design methods is that the geometry of active devices and passive components in integrated-circuit design is under the control of the designer. This control over geometry gives the designer a new degree of freedom in the design process. A second difference is due to the fact that it is impractical to breadboard the integrated-circuit design. Consequently, the designer must turn to computer simulation methods to confirm the design's performance. Another difference between integrated and discrete analog design is that the integrated-circuit designer is restricted to a more limited class of components that are compatible with the technology being used.
The task of designing an analog integrated circuit includes many steps. Figure 1.1-3 illustrates the general approach to the design of an integrated circuit. The major steps in the design process are:
1. Definition
2. Synthesis or implementation
3. Simulation or modeling

Figure 1.1-3 Design process for analog integrated circuits.
4. Geometrical description
5. Simulation including the geometrical parasitics
6. Fabrication
7. Testing and verification
The designer is responsible for all of these steps except fabrication. The first steps are to define and synthesize the function. These steps are crucial since they determine the performance capability of the design. When these steps are completed, the designer must be able to confirm the design before it is fabricated. The next step is to simulate the circuit to predict the performance of the circuit. Initially, the designer makes approximations about the physical definition of the circuit. Later, once the layout is complete, simulations are checked using parasitic information derived from the layout. At this point, the designer may iterate using the simulation results to improve the circuit's performance. Once satisfied with this performance, the designer can address the next step- the geometrical description (layout) of the circuit. This geometrical description typically consists of a computer database of variously shaped rectangles or polygons (in the $x$ - $y$ plane) at different levels (in the $z$ direction); it is intimately connected with the electrical performance of the circuit. As stated earlier, once the layout is finished, it is necessary to include the geometrical effects in additional simulations. If results are satisfactory, the circuit is ready for fabrication. After fabrication, the designer is faced with the last step-determining whether the fabricated circuit meets the design specifications. If the designer has not carefully considered this step in the overall design process, it may be difficult to test the circuit and determine whether or not specifications have been met.
As mentioned earlier, one distinction between discrete and integrated analog circuit design is that it may be impractical to breadboard the integrated circuit. Computer simulation techniques have been developed that have several advantages, provided the models are adequate. These advantages include:
- Elimination of the need for breadboards
- Ability to monitor signals at any point in the circuit
- Ability to open a feedback loop
- Ability to easily modify the circuit
- Ability to analyze the circuit at different processes and temperatures
Disadvantages of computer simulation include:
- Accuracy of models
- Failure of the simulation program to converge to a solution
- Time required to perform simulations of large circuits
- Use of the computer as a substitute for thinking
Because simulation is closely associated with the design process, it will be included in the text where appropriate.
In accomplishing the design steps described above, the designer works with three different types of description formats: the design description, the physical description, and the model/simulation description. The format of the design description is the way in which the circuit is specified; the physical description format is the geometrical definition of the circuit; the model/simulation format is the means by which the circuit can be simulated. The designer must be able to describe the design in each of these formats. For example, the first steps of analog integrated-circuit design could be carried out in the design description format. The geometrical description obviously uses the geometrical format. The simulation steps would use the model/simulation format.
Analog integrated-circuit design can also be characterized from the viewpoint of hierarchy. Table 1.1-1 shows a vertical hierarchy consisting of devices, circuits, and systems, and horizontal description formats consisting of design, physical, and model. The device level is the lowest level of design. It is expressed in terms of device specifications, geometry, or model parameters for the design, physical, and model description formats, respectively. The circuit level is the next higher level of design and can be expressed in terms of devices. The design, physical, and model description formats typically used for the circuit level include voltage and current relationships, parameterized layouts, and macromodels. The highest level of design is the systems level-expressed in terms of circuits. The design, physical, and model description formats for the systems level include mathematical or graphical descriptions, a chip floor plan, and a behavioral model.
Table 1.1-1 Hierarchy and Description of the Analog Integrated-Circuit Design Process
<table><tr><td>Hierarchy</td><td>Design</td><td>Physical</td><td>Model</td></tr><tr><td>Systems</td><td>System specifications</td><td>Floor plan</td><td>Behavioral model</td></tr><tr><td>Circuits</td><td>Circuit specifications</td><td>Parameterized blocks/cells</td><td>Macromodels</td></tr><tr><td>Devices</td><td>Device specifications</td><td>Geometrical description</td><td>Device models</td></tr></table>
This book has been organized to emphasize the hierarchical viewpoint of integrated-circuit design, as illustrated in Table 1.1-2. At the device level, Chapters 2 and 3 deal with CMOS technology and models. In order to design CMOS analog integrated circuits the designer must understand the technology, so Chapter 2 along with Appendix B give an overview of CMOS technology, along with the design rules that result from technological considerations. This information is important for the designer's appreciation of the constraints and limits of the technology. Before starting a design, one must have access to the process and electrical parameters of the device model. Modeling is a key aspect of both the synthesis and simulation steps and is covered in Chapter 3. The designer must also be able to characterize the actual model parameters in order to confirm the assumed model parameters. Ideally, the designer has access to a test chip from which these parameters can be measured. Finally, the measurement of the model parameters after fabrication can be used in testing the completed circuit. Device characterization methods are covered in Appendix C.
Chapters 4 and 5 cover circuits consisting of two or more devices that are classified as simple circuits. These simple circuits are used to design more complex circuits, which are covered in Chapters 6 through 8. Finally, the circuits presented in Chapters 6 through 8 are used in Chapter 9 and Appendix E to implement analog systems. Some of the dividing lines between the various levels will at times be unclear. However, the general relationship is valid and should leave the reader with an organized viewpoint of analog integrated-circuit design.
Table 1.1-2 Relationship of the Book Chapters to Analog Circuit Design
<table><tr><td>Design Level</td><td/><td colspan="2">CMOS Technology</td></tr><tr><td>Systems</td><td/><td>Chapter 9 Digital-Analog and Analog-Digital Converters</td><td>Appendix E Switched Capacitor Circuits</td></tr><tr><td>Complex circuits</td><td>Chapter 6</td><td>Chapter 7</td><td>Chapter 8</td></tr><tr><td/><td>CMOS Operational Amplifiers</td><td>High-Performance CMOS Op Amps</td><td>Comparators</td></tr><tr><td>Simple circuits</td><td>Chapter 4 Analog CMOS Subcircuits</td><td/><td>Chapter 5 CMOS Amplifiers</td></tr><tr><td>Devices</td><td>Chapter 2</td><td>Chapter 3</td><td>Appendix C</td></tr><tr><td/><td>CMOS Technology</td><td>CMOS Device Modeling</td><td>CMOS Device Characterization</td></tr></table>
Table 1.2-1 Definition of the Symbols for Various Signals
<table><tr><td>Signal Definition</td><td>Quantity</td><td>Subscript</td><td>Example</td></tr><tr><td>Total instantaneous value of the signal</td><td>Lowercase</td><td>Uppercase</td><td>${q}_{A}$</td></tr><tr><td>dc Value of the signal</td><td>Uppercase</td><td>Uppercase</td><td>${Q}_{A}$</td></tr><tr><td>ac Value of the signal</td><td>Lowercase</td><td>Lowercase</td><td>${q}_{a}$</td></tr><tr><td>Complex variable, phasor, or rms value of the signal</td><td>Uppercase</td><td>Lowercase</td><td>${Q}_{a}$</td></tr></table>

### 1.2 Notation, Symbology, and Terminology
To help the reader have a clear understanding of the material presented in this book, this section dealing with notation, symbology, and terminology is included. The conventions chosen are consistent with those used in undergraduate electronics texts and with the standards proposed by technical societies. The International System of Units has been used throughout. Every effort has been made in the remainder of this book to use the conventions here described.
The first item of importance is the notation (the symbols) for currents and voltages. Signals will generally be designated as a quantity with a subscript. The quantity and the subscript will be either uppercase or lowercase according to the convention illustrated in Table 1.2-1. Figure 1.2-1 shows how the definitions in Table 1.2-1 would be applied to a periodic signal superimposed upon a dc value.
This notation will be of help when modeling the devices. For example, consider the portion of the MOS model that relates the drain-source current to the various terminal voltages. This model will be developed in terms of the total instantaneous variables $\left( {i}_{D}\right)$ . For biasing purposes, the dc variables $\left( {I}_{D}\right)$ will be used; for small-signal analysis, the ac variables $\left( {i}_{d}\right)$ will be used; and finally, the small-signal frequency discussion will use the complex variable $\left( {I}_{d}\right)$ .
The second item to be discussed here is what symbols are used for the various components. (Most of these symbols will already be familiar to the reader. However, inconsistencies exist about the MOS symbol shown in Fig. 1.2-2.) The symbols shown in Figs. 1.2-2(a) and 1.2-2(b) are used for enhancement-mode MOS transistors when the substrate or bulk(B)is connected to the source. Although the transistor operation will be explained later, the terminals are called drain(D), gate(G), and source(S). If the bulk is not connected to the source, then the symbols shown in Figs. 1.2-2(c) and 1.2-2(d) are used for the enhancement-mode MOS transistors. It will be important to know where the bulk of the MOS transistor is connected when it is used in circuits. Most often, the appropriate supply for the bulk is the most positive one for p-channel transistors and the most negative one for n-channel transistors.

Figure 1.2-1 Notation for signals.

Figure 1.2-3 (a) Symbol for an operational amplifier. (b) Independent voltage source. (c) Independent current source. (d) Voltage-controlled voltage source (VCVS). (e) Voltage-controlled current source (VCCS). (f) Current-controlled voltage source (CCVS). (g) Current-controlled current source (CCCS).
Figure 1.2-3 shows another set of symbols that should be defined. Figure 1.2-3(a) represents a differential-input operational amplifier or, in some instances, a comparator, which may have a gain approaching that of the operational amplifier. Figures 1.2-3(b) and 1.2-3(c) represent an independent voltage and current source, respectively. Sometimes, the battery symbol is used instead of Fig. 1.2-3(b). Finally, Figs. 1.2-3(d) through 1.2-3(g) represent the four types of ideal controlled sources. Figure 1.2-3(d) is a voltage-controlled voltage source (VCVS), Fig. 1.2-3(e) is a voltage-controlled current source (VCCS), Fig. 1.2-3(f) is a current-controlled voltage source (CCVS), and Fig. 1.2-3(g) is a current-controlled current source (CCCS). The gains of each of these controlled sources are given by the symbols ${A}_{v}$ , ${G}_{m},{R}_{m}$ , and ${A}_{i}$ (for the VCVS, VCCS, CCVS, and CCCS, respectively).

### 1.3 Analog Signal Processing
Before beginning an in-depth study of analog circuit design, it is worthwhile to consider the application of such circuits. The general subject of analog signal processing includes most of the circuits and systems that will be presented in this text. Figure 1.3-1 shows a simple block diagram of a typical signal-processing system. In the past, such a signal-processing system required multiple integrated circuits with considerable additional passive components. However, the advent of analog sampled-data techniques and MOS technology has made viable the design of a general signal processor using both analog and digital techniques on a single integrated circuit [2].
The first step in the design of an analog signal-processing system is to examine the specifications and decide what part of the system should be analog and what part should be digital. In most cases, the input signal is analog. It could be a speech signal, a sensor output, a radar return, and so forth. The first block of Fig. 1.3-1 is a preprocessing block. Typically, this block will consist of filters, an automatic-gain-control circuit, and an analog-to-digital converter (ADC or A/D). Often, very strict speed and accuracy requirements are placed on the components in this block. The next block of the analog signal processor is a digital signal processor. The advantages of performing signal processing in the digital domain are numerous. One advantage is due to the fact that digital circuitry is easily implemented in the smallest geometry processes available, providing a cost and speed advantage. Another advantage relates to the additional degrees of freedom available in digital signal processing (e.g., linear-phase filters). Additional advantages lie in the ability to easily program digital devices. Finally, it may be necessary to have an analog output. In this case, a postprocessing block is necessary. It will typically contain a digital-to-analog converter (DAC or D/A), amplification, and filtering.
In a signal-processing system, one important system consideration is the bandwidth of the signal to be processed. A graph of the operating frequency of a variety of signals is given in Fig. 1.3-2. At the low end are seismic signals, which do not extend much below $1\mathrm{\;{Hz}}$ because of the absorption characteristics of the earth. At the other extreme are microwave signals. These are not used much above ${30}\mathrm{{GHz}}$ because of the difficulties in performing even the simplest forms of signal processing at higher frequencies.
To address any particular application area illustrated in Fig 1.3-2, a technology that can support the required signal bandwidth must be used. Figure 1.3-3 illustrates the speed capabilities of the various process technologies available today. Bandwidth requirements and speed are not the only considerations when deciding which technology to use for an integrated circuit (IC) addressing an application area. Other considerations are cost and integration. The clear trend today is to use CMOS digital combined with CMOS analog (as needed) whenever possible because significant integration can be achieved, thus providing highly reliable compact system solutions.

Figure 1.3-1 A typical signal-processing system block diagram.

Figure 1.3-2 Frequency of signals used in signal-processing applications.

### 1.4 Example of Analog VLSI Mixed-Signal Circuit Design
Analog circuit design methodology is best illustrated by example. Figure 1.4-1 shows the block diagram of a fully integrated digital read/write channel for disk-drive recording applications. The device employs partial response maximum likelihood (PRML) sequence detection when reading data to enhance bit-error-rate versus signal-to-noise ratio performance. The device supports data rates up to ${64}\mathrm{{Mbits}}/\mathrm{s}$ and is fabricated in a ${0.8\mu }\mathrm{m}$ double-metal CMOS process.
In a typical application, this IC receives a fully differential analog signal from an external preamplifier, which senses magnetic transitions on a spinning disk-drive platter. This differential read pulse is first amplified by a variable gain amplifier (VGA) under control of a real-time digital gain-control loop. After amplification, the signal is passed to a seven-pole two-zero equiripple-phase low-pass filter. The zeros of the filter are real and symmetrical about the imaginary axis. The locations of the zeros relative to the locations of the poles are programmable and are designed to boost filter gain at high frequencies and thus narrow the width of the read pulse.

Figure 1.3-3 Frequencies that can be processed by present-day technologies.

Figure 1.4-1 Read/Write channel integrated-circuit block diagram.
The low-pass filter is constructed from transconductance stages $\left( {g}_{m}\right.$ stages) and capacitors. A one-pole prototype illustrating the principles embodied in the low-pass filter design is shown in Fig. 1.4-2. While the relative pole arrangement is fixed, two mechanisms are available for scaling the low-pass filter's frequency response. The first is via a control voltage (labeled "VCON"), which is common to all of the transconductance stages in the filter. This control voltage is applied to the gate of an $\mathrm{n}$ -channel transistor in each of the transconductance stages. The conductance of each of these transistors determines the overall conductance of its associated stage and can be varied continuously by the control voltage. The second frequency response control mechanism is via the digital control of the value of the capacitors in the low-pass filter. All capacitors in the low-pass filter are constructed identically, and each consists of a programmable array of binarily weighted capacitors.
The continuous control capability via VCON designed into the transconductance stage provides for a means to compensate for variations in the low-pass filter's frequency response due to process, temperature, and supply voltage changes [3]. The control voltage, VCON, is derived from the "Master PLL" composed of a replica of the filter configured as a voltage-controlled oscillator in a phase-locked-loop configuration as illustrated in Fig. 1.4-3. The frequency of oscillation is inversely proportional to the characteristic time constant, $C/{g}_{m}$ , of the replica filter's stages. By forcing the oscillator to be phase and frequency locked to an external frequency reference through variation of the VCON terminal voltage, the characteristic time constant is held fixed. To the extent that the circuit elements in the low-pass filter match those in the master filter, the characteristic time constants of the low-pass filter (and thus the frequency response) are also fixed.

Figure 1.4-2 Single-pole low-pass filter.

Figure 1.4-3 Master filter phase-locked loop.
The normal output of the low-pass filter is passed through a buffer to a 6-bit one-step-flash sampling A/D converter. The A/D converter is clocked by a voltage-controlled oscillator (VCO) whose frequency is controlled by a digital timing-recovery loop. Each of the 63 comparators in the flash A/D converter contains capacitors to sample the buffered analog signal from the low-pass filter. While sampling the signal each capacitor is also absorbing the comparator's offset voltage to correct for the distortion errors these offsets would otherwise cause [4]. The outputs from the comparators are passed through a block of logic that checks for invalid patterns, which could cause severe conversion errors if left unchecked [5]. The outputs of this block are then encoded into a 6-bit word.
As illustrated in Fig. 1.4-1, after being digitized, the 6-bit output of the A/D converter is filtered by a finite-impulse-response (FIR) filter. The digital gain- and timing-control loops mentioned above monitor the raw digitized signal or the FIR filter output for gain and timing errors. Because these errors can be measured only when signal pulses occur, a digital transition detector is provided to detect pulses and activate the gain and timing error detectors. The gain and timing error signals are then passed through digital low-pass filters and subsequently to D/A converters in the analog circuitry to adjust the VGA gain and A/D VCO frequency, respectively.
The heart of the read channel IC is the sequence detector. The detector's operation is based on the Viterbi algorithm, which is generally used to implement maximum likelihood detection. The detector anticipates linear intersymbol interference and after processing the received sequence of values deduces the most likely transmitted sequence (i.e., the data read from the media). The bit stream from the sequence detector is passed to the run-length-limited (RLL) decoder block, where it is decoded. If the data written to the disk were randomized before being encoded, the inverse process is applied before the bit stream appears on the read channel output pins.
The write path is illustrated in detail in Fig. 1.4-4. In write mode, data is first encoded by an RLL encoder block. The data can optionally be randomized before being sent to the encoder. When enabled, a linear feedback shift register is used to generate a pseudorandom pattern that is XOR'd with the input data. Using the randomizer ensures that bit patterns that may be difficult to read occur no more frequently than would be expected from random input data.

Figure 1.4-4 Frequency synthesizer and write-data path.
A write clock is synthesized to set the data rate by a VCO placed in a phase-locked loop. The VCO clock is divided by a programmable value "M," and the divided clock is phase-locked to an external reference clock divided by 2 and a programmable value " $\mathrm{N}$ ." The result is a write clock at a frequency $\mathrm{M}/2\mathrm{\;N}$ times the reference clock frequency. The values for $\mathrm{M}$ and $\mathrm{N}$ can each range from 2 to 256, and write clock frequencies can be synthesized to support zone-bit-recording designs, wherein zones on the media having different data rates are defined.
Encoded data are passed to the write precompensation circuitry. While linear bit-shift effects caused by intersymbol interference need not be compensated in a PRML channel, nonlinear effects can cause a shift in the location of a magnetic transition caused by writing a one in the presence of other nearby transitions. Although the particular RLL code implemented prohibits two consecutive "ones" (and therefore two transitions in close proximity) from being written, a "one/zero/one" pattern can still create a measurable shift in the second transition. The write precompensation circuitry delays the writing of the second "one" to counter the shift. The synthesized write clock is input to two delay lines, each constructed from stages similar to those found in the VCO. Normally the signal from one delay line is used to clock the channel data to the output drivers. However, when a "one/zero/one" pattern is detected, the second "one" is clocked to the output drivers by the signal from the other delay line. This second delay line is current-starved, thus exhibiting a longer delay than the first, and the second "one" in the pattern is thereby delayed. The amount of delay is programmable.
The servo channel circuitry, shown in Fig. 1.4-5, is used for detecting embedded head positioning information. There are three main functional blocks in the servo section:
- Automatic gain-control (AGC) loop
- Bit detector
- Burst demodulator
Time constants and charge rates in the servo section are programmable and controlled by the master filter to avoid variation due to supply voltage, process, and temperature. All blocks are powered down between servo fields to conserve power.
The AGC loop feedback around the VGA forces the output of the high-pass filter to a constant level during the servo preamble. The preamble consists of an alternating bit pattern and defines the ${100}\%$ full-scale level. To avoid the need for timing acquisition, the servo AGC loop is implemented in the analog domain. The peak amplitude at the output of the high-pass filter is detected with a rectifying peak detector. The peak detector either charges or discharges a capacitor, depending on whether the input signal is above or below the held value on the capacitor. The output of the peak detector is compared to a full-scale reference and integrated to control the VGA gain. The relationship between gain and control voltage for the VGA is an exponential one; thus, the loop dynamics are independent of gain. The burst detector is designed to detect and hold the peak amplitude of up to four servo positioning bursts, indicating the position of the head relative to track center.
An asynchronous bit detector is included to detect the servo data information and address mark. Input pulses are qualified with a programmable threshold comparator such that a pulse is detected only for those pulses whose peak amplitude exceeds the threshold. The servo bit detector provides outputs indicating both zero-crossing events and the polarity of the detected event.
Figure 1.4-6 shows a photomicrograph of the read-channel chip described. The circuit was fabricated in a single-polysilicon, double-metal, ${0.8\mu }\mathrm{m}$ CMOS process.

Figure 1.4-5 Servo channel block diagram.

Figure 1.4-6 Photomicrograph of the read-channel chip.

### 1.5 Summary
This chapter has presented an introduction to the design of CMOS analog integrated circuits. Section 1.1 gave a definition of signals in analog circuits and defined analog, digital, and analog sampled-data signals. The difference between analysis and design was discussed. The design differences between discrete and integrated analog circuits are primarily due to the designer's control over circuit geometry and the need to computer-simulate rather than build a breadboard. The first section also presented an overview of the text and showed in Table 1.1-2 how the various chapters are tied together. It is strongly recommended that the reader refer to Table 1.1-2 at the beginning of each chapter.
Section 1.2 discussed notation, symbology, and terminology. Understanding these topics is important to avoid confusion in the presentation of the various subjects. The choice of symbols and terminology has been made to correspond with standard practices and definitions. Additional topics concerning the subject in this section will be given in the text at the appropriate place.
An overview of analog signal processing was presented in Section 1.3. The objective of most analog circuits was seen to be the implementation of some sort of analog signal processing. The important concepts of circuit application, circuit technology, and system bandwidth were introduced and interrelated, and it was pointed out that analog circuits rarely stand alone but are usually combined with digital circuits to accomplish some form of signal processing. The boundaries between the analog and digital parts of the circuit depend on the application, the performance, and the area.
Section 1.4 gave an example of the design of a fully integrated disk-drive read-channel circuit. The example emphasized the hierarchical structure of the design and showed how the subjects to be presented in the following chapters could be used to implement a complex design.
Before beginning the study of the following chapters, the reader may wish to study Appendix A, which presents material that should be mastered before going further. It covers the subject of circuit analysis for analog circuit design, and some of the problems at the end of this chapter refer to this material. The reader may also wish to review other subjects, such as electronic modeling, computer simulation techniques, Laplace and $z$ -transform theory, and semiconductor device theory.
## Problems
1.1-1. Using Eq. (1.1-1), give the base-10 value for the 5-bit binary number ${11010}\left( {{b}_{4}{b}_{3}{b}_{2}{b}_{1}{b}_{0}}\right.$ ordering).
1.1-2. Process the sinusoid in Fig. P1.1-2. through an analog sample and hold. The sample points are given at each integer value of $t/T$ .

Figure P1.1-2
1.1-3. Digitize the sinusoid given in Fig. P1.1-2 according to Eq. (1.1-1) using a 4-bit digitizer.
The following problems refer to material in
Appendix A.
1.1-4. Use the nodal equation method to find ${v}_{\text{out }}/{v}_{\text{in }}$ of Fig. P1.1-4.

Figure P1.1-4
1.1-5. Use the mesh equation method to find ${v}_{\text{out }}/{v}_{\text{in }}$ of Fig. P1.1-4.
1.1-6. Use the source rearrangement and substitution concepts to simplify the circuit shown in Fig. P1.1-6 and solve for ${i}_{\text{out }}/{i}_{\text{in }}$ by making chain-type calculations only.

Figure P1.1-6
1.1-7. Find ${v}_{2}/{v}_{1}$ and ${v}_{1}/{i}_{1}$ of Fig. P1.1-7.

1.1-8. Use the circuit-reduction technique to solve for ${v}_{\text{out }}/{v}_{\text{in }}$ of Fig. P.1.1-8

1.1-9. Use the Miller simplification concept to solve for ${v}_{\text{out }}/{v}_{\text{in }}$ of Fig. A.1-3 (see Appendix A).
1.1-10. Find ${v}_{\text{out }}/{i}_{\text{in }}$ of Fig. A.1-12 and compare with the results of Example A.1-1.
1.1-11. Use the Miller simplification technique described in Appendix A to solve for the output resistance, ${v}_{o}/{i}_{o}$ , of Fig. P1.1-4. Calculate the output resistance not using the Miller simplification and compare your results.
1.1-12. Consider an ideal voltage amplifier with a voltage gain of ${A}_{v} = {0.99}$ . A resistance $R =$ ${50}\mathrm{k}\Omega$ is connected from the output back to the input. Find the input resistance of this circuit by applying the Miller simplification concept.
## References
1. D. Welland, S. Phillip, K. Leung, T. Tuttle, S. Dupuie, D. Holberg, R. Jack, N. Sooch, R. Behrens, K. Anderson, A. Armstrong, W. Bliss, T. Dudley, B. Foland, N. Glover, and L. King, "A Digital Read/Write Channel with EEPR4 Detection," Proc. IEEE Int. Solid-State Circuits Conf., Feb. 1994.
2. M. Townsend, M. Hoff, Jr., and R. Holm, "An NMOS Microprocessor for Analog Signal Processing," IEEE J. Solid-State Circuits, Vol. SC-15, No. 1, pp. 33-38, Feb. 1980.
3. M. Banu and Y. Tsividis, "An Elliptic Continuous-Time CMOS Filter with On-Chip Automatic Tuning," IEEE J. Solid-State Circuits, Vol. 20, No. 6, pp. 1114-1121, Dec. 1985.
4. Y. Yee et al., "A 1 m V MOS Comparator," IEEE J. Solid-State Circuits, Vol. 13, pp. 294-297, June 1978.
5. A. Yukawa, "A CMOS 8-bit High-Speed A/D Converter IC," IEEE J. Solid-State Circuits, Vol. 20, pp. 775-779, June 1985.
CHAPTER 2
# CMOS Technology
Modern silicon integrated-circuit technologies consist of bipolar, BiCMOS, and CMOS, as illustrated in Fig. 2.0-1. For many years the dominant silicon integrated- circuit technology was bipolar, as evidenced by the ubiquitous monolithic operational amplifier and the TTL (transistor-transistor logic) family. In the early 1970s MOS technology was demonstrated to be viable in the area of dynamic random-access memories (DRAMs), microprocessors, and the 4000-series logic family. By the end of the 1970s, driven by the need for density, it was clear that MOS technology would be the vehicle for growth in the digital VLSI area. At this same time, several organizations were attempting analog circuit designs using MOS [1-4]. NMOS technology was the early technology of choice for the majority of both digital and analog MOS designs. The early 1980s saw the movement of the VLSI world toward silicon-gate CMOS, which has been the dominant technology for VLSI digital and mixed-signal designs ever since [5,6]. Processes that combine both CMOS and bipolar (BiCMOS) have proven themselves to be both a technological and market success where the primary market force has been improved speed for digital circuits (primarily in static random-access memories, SRAMs). BiCMOS has potential as well in analog design due to the enhanced performance that a bipolar transistor provides in the context of CMOS technology. This book focuses on the use of CMOS for analog and mixed-signal circuit design.
There are numerous references that develop the details of the physics of MOS device operation $\left\lbrack  {7,8}\right\rbrack$ . Therefore, this text covers only the aspects of this theory that are pertinent to the viewpoint of the circuit designer. The objective is to be able to appreciate the limits of the MOS circuit models and to understand the physical constraints on electrical performance.
This chapter covers various aspects of the CMOS process from a physical point of view. In order to understand CMOS technology, a brief review of the basic semiconductor fabrication processes is presented, followed by a description of the fabrication steps required to build the basic CMOS process. Next, the pn junction is presented and analyzed, followed by a description of how active and passive components compatible with the CMOS technology are built. Next, important limitations on the performance of CMOS technology including latch-up, temperature dependence, and noise are covered.

Figure 2.0-1 Modern silicon integrated-circuit (IC) technologies.
Physical layout of an integrated circuit requires understanding of layout rules and techniques. Successful analog circuit design is tightly coupled with the physical layout. This topic is covered in Appendix B and should be studied along with Chapter 2.

### 2.1 Basic MOS Semiconductor Fabrication Processes
Semiconductor technology is based on a number of well-established process steps, which are the means for fabricating semiconductor components. In order to understand the fabrication process, it is necessary to understand these steps. The process steps described here include oxidation, diffusion, ion implantation, deposition, and etching. The means of defining the area of the semiconductor subject to processing is called photolithography. Lastly, a planarization method using chemical-mechanical polishing is introduced.
All processing starts with single-crystalline silicon material. There are two methods for growing such crystals [9]. Most of the material is grown by a method based on that developed by Czochralski in 1917. A second method, called the float zone technique, produces crystals of high purity and is often used for power devices. The crystals are normally grown in either a $< {100} >$ or $< {111} >$ crystal orientation. The resulting crystals are cylindrical and have a diameter of ${75} - {300}\mathrm{\;{mm}}$ and a length of $1\mathrm{\;m}$ . The cylindrical crystals are sliced into wafers that are approximately ${0.5}\mathrm{\;{mm}}$ to ${0.75}\mathrm{\;{mm}}$ thick for wafers of size ${100}\mathrm{\;{mm}}$ to ${300}\mathrm{\;{mm}}$ , respectively [10]. This thickness is determined primarily by the physical strength requirements. When the crystals are grown, they are doped with either an n-type or a p-type impurity to form an n- or a p-substrate. The substrate is the starting material in wafer form for the fabrication process. The doping level of most substrates is approximately ${10}^{15}$ impurity atoms $/{\mathrm{{cm}}}^{3}$ , which roughly corresponds to a resistivity of $3 - {5\Omega }$ -cm for an n-substrate and ${14} - {16\Omega }$ -cm for a p-substrate [11].
An alternative to starting with a lightly doped silicon wafer is to use a heavily doped wafer that has a lightly doped epitaxial (epi) on top of it where subsequent devices are formed. Although epi wafers are more expensive, they can provide some benefits by reducing sensitivity to latch-up (discussed later) and reducing interference between analog and digital circuits on mixed-signal integrated circuits.
The six basic processing steps that are applied to the doped silicon wafer to fabricate semiconductor components (oxidation, diffusion, ion implantation, deposition, etching, and chemical mechanical polishing) will be described in the following paragraphs.
## Oxidation
The first basic processing step is oxide growth or oxidation [12]. Oxidation is the process by which a layer of silicon dioxide $\left( {\mathrm{{SiO}}}_{2}\right)$ is formed on the surface of the silicon wafer. The oxide grows both into as well as on the silicon surface, as indicated in Fig. 2.1-1. Typically about ${56}\%$ of the oxide thickness is above the original surface while about ${44}\%$ is below the original surface. The oxide thickness, designated ${t}_{ox}$ , can be grown using either dry or wet techniques, with the former achieving lower defect densities. Typically oxide thickness varies from less than ${50Å}$ for gate oxides to more than ${10},{000Å}$ for field oxides. Oxidation takes place at temperatures ranging from ${700}^{ \circ  }\mathrm{C}$ to ${1100}^{ \circ  }\mathrm{C}$ , with the resulting oxide thickness being proportional to the temperature at which it is grown (for a fixed amount of time).

Figure 2.1-1 Silicon dioxide growth at the surface of a silicon wafer.
## Diffusion
The second basic processing step is diffusion [13]. Diffusion in semiconductor material is the movement of impurity atoms at the surface of the material into the bulk of the material. Diffusion takes place at temperatures in the range of ${800} - {1400}^{ \circ  }\mathrm{C}$ in the same way as a gas diffuses in air. The concentration profile of the impurity in the semiconductor is a function of the concentration of the impurity at the surface and the time in which the semiconductor is placed in a high-temperature environment. There are two basic types of diffusion mechanisms, which are distinguished by the concentration of the impurity at the surface of the semiconductor. One type of diffusion assumes that there is an infinite source of impurities at the surface $\left( {{N}_{0}{\mathrm{\;{cm}}}^{-3}}\right)$ during the entire time the impurity is allowed to diffuse. The impurity profile for an infinite-source impurity as a function of diffusion time is given in Fig. 2.1-2(a). The second type of diffusion assumes that there is a finite source of impurities at the surface of the material initially. At $t = 0$ this value is given by ${N}_{0}$ . However, as time increases, the impurity concentration at the surface decreases as shown in Fig. 2.1-2(b). In both cases, ${N}_{B}$ is the prediffusion impurity concentration of the semiconductor.
The infinite-source and finite-source diffusions are typical of predeposition and drive-in diffusions, respectively. The object of a predeposition diffusion is to place a large concentration of impurities near the surface of the material. There is a maximum impurity concentration that can be diffused into silicon depending on the type of impurity. This maximum concentration is due to the solid solubility limit, which is in the range of $5 \times  {10}^{20}$ to $2 \times  {10}^{21}$ atoms $/{\mathrm{{cm}}}^{3}$ . The drive-in diffusion follows the deposition diffusion and is used to drive the impurities deeper into the semiconductor. The crossover between the prediffusion impurity level and the diffused impurities of the opposite type defines the semiconductor junction. This junction is between a p-type and an n-type material and is simply called a pn junction. The distance between the surface of the semiconductor and the junction is called the junction depth. Typical junction depths for diffusion can range from ${0.1\mu }\mathrm{m}$ for predeposition-type diffusions to greater than ${10\mu }\mathrm{m}$ for drive-in-type diffusions.
## Ion Implantation
The next basic processing step is ion implantation and is widely used in the fabrication of MOS components $\left\lbrack  {{14},{15}}\right\rbrack$ . Ion implantation is the process by which ions of a particular dopant (impurity) are accelerated by an electric field to a high velocity and physically lodge within the semiconductor material. The average depth of penetration varies from 0.1 to ${0.6\mu }\mathrm{m}$ depending on the velocity and angle at which the ions strike the silicon wafer. The path of each ion depends on the collisions it experiences. Therefore, ions are typically implanted off-axis from the wafer so that they will experience collisions with lattice atoms, thus avoiding undesirable channeling of ions deep into the silicon. An alternative method to address channeling is to implant through silicon dioxide, which randomizes the implant direction before the ions enter the silicon. The ion-implantation process causes damage to the semiconductor crystal lattice, leaving many of the implanted ions electrically inactive. This damage can be repaired by an annealing process in which the temperature of the semiconductor after implantation is raised to around ${800}^{ \circ  }\mathrm{C}$ to allow the ions to move to electrically active locations in the semiconductor crystal lattice.

Figure 2.1-2 Diffusion profiles as a function of time for (a) an infinite source of impurities at the surface, and (b) a finite source of impurities at the surface.
Ion implantation can be used in place of diffusion since in both cases the objective is to insert impurities into the semiconductor material. Ion implantation has several advantages over thermal diffusion. One advantage is the accurate control of doping—to within $\pm  5\%$ . Reproducibility is very good, making it possible to adjust the thresholds of MOS devices or to create precise resistors. A second advantage is that ion implantation is a room-temperature process, although annealing at higher temperatures is required to remove the crystal damage. A third advantage is that it is possible to implant through a thin layer. Consequently, the material to be implanted does not have to be exposed to contaminants during and after the implantation process. Unlike ion implantation, diffusion requires that the surface be free of silicon dioxide or silicon nitride layers. Finally, ion implantation allows control over the profile of the implanted impurities. For example, a concentration peak can be placed below the surface of the silicon if desired.
## Deposition
The fourth basic semiconductor process is deposition. Deposition is the means by which films of various materials may be deposited on the silicon wafer. These films may be deposited using several techniques, including deposition by evaporation [16], sputtering [17], and chemical-vapor deposition (CVD) [18,19]. In evaporation deposition, a solid material is placed in a vacuum and heated until it evaporates. The evaporant molecules strike the cooler wafer and condense into a solid film on the wafer surface. Thickness of the deposited material is determined by the temperature and the amount of time evaporation is allowed to take place (a thickness of ${1\mu }\mathrm{m}$ is typical). The sputtering technique uses positive ions to bombard the cathode, which is coated with the material to be deposited. The bombarded or target material is dislodged by direct momentum transfer and deposited on wafers, which are placed on the anode. The types of sputtering systems used for depositions in integrated circuits include dc, radio frequency (RF), or magnetron (magnetic field). Sputtering is usually done in a vacuum. Chemical vapor deposition uses a process in which a film is deposited by a chemical reaction or pyrolytic decomposition in the gas phase, which occurs in the vicinity of the silicon wafer. This deposition process is generally used to deposit polysilicon, silicon dioxide $\left( {{\mathrm{{SiO}}}_{2}\text{or simply oxide), or silicon nitride}\left( {{\mathrm{{Si}}}_{3}{\mathrm{\;N}}_{4}}\right. }\right.$ or simply nitride). While the chemical vapor deposition is usually performed at atmospheric pressure, it can also be done at low pressures where the diffusivity increases significantly. This technique is called low-pressure chemical-vapor deposition (LPCVD).
## Etching
Etching is the process of removing exposed (unprotected) material. The means by which some material is exposed and some is not will be considered later under the topic of photolithography. For the moment, we will assume that the situation illustrated in Fig. 2.1-3(a) exists. Here we see a top layer called a film and an underlying layer. A protective layer, called a mask,* covers the film except in the area that is to be etched. The objective of etching is to remove just the section of the exposed film. To achieve this, the etching process must have two important properties: selectivity and anisotropy. Selectivity is the characteristic of the etch whereby only the desired layer is etched with no effect on either the protective layer (masking layer) or the underlying layer. Selectivity can be quantified as the ratio of the desired layer etch rate to the undesired layer etch rate as given below.
$$
{S}_{A - B} = \frac{\text{ Desired layer etch rate }\left( \mathrm{A}\right) }{\text{ Undesired layer etch rate }\left( \mathrm{B}\right) } \tag{2.1-1}
$$

Figure 2.1-3 (a) Portion of the top layer ready for etching. (b) Result of etching indicating horizontal etching and etching of underlying layer.
---
*A distinction is made between a deposited masking layer referred to as a "mask" and the photographic plate used in exposing the photoresist, which is called a "photomask."
---
Anisotropy is the property of the etch to manifest itself in one direction; that is, a perfectly anisotropic etchant will etch in one direction only. The degree of anisotropy can be quantified by the relation given below.
$$
A = 1 - \frac{\text{ Lateral etch rate }}{\text{ Vertical etch rate }} \tag{2.1-2}
$$
Reality is such that neither perfect selectivity nor perfect anisotropy can be achieved in practice, resulting in undercutting effects and partial removal of the underlying layer as illustrated in Fig. 2.1-3(b). As illustrated, the lack of selectivity with respect to the mask is given by dimension "a." Lack of selectivity with respect to the underlying layer is given by dimension "b." Dimension "c" shows the degree of anisotropy. There are preferential etching techniques that achieve high degrees of anisotropy and thus minimize undercutting effects, as well as maintain high selectivity. Materials that are normally etched include polysilicon, silicon dioxide, silicon nitride, and aluminum.
There are two basic types of etching techniques. Wet etching uses chemicals to remove the material to be etched. Hydrofluoric acid (HF) is used to etch silicon dioxide; phosphoric acid $\left( {{\mathrm{H}}_{3}{\mathrm{{PO}}}_{4}}\right)$ is used to remove silicon nitride; nitric acid, acetic acid, or hydrofluoric acid is used to remove polysilicon; potassium hydroxide is used to etch silicon; and a phosphoric acid mixture is used to remove metal. The wet-etching technique is strongly dependent on time and temperature, and care must be taken with the acids used in wet etching as they represent a potential hazard. Dry etching or plasma etching uses ionized gases that are rendered chemically active by an RF-generated plasma. This process requires significant characterization to optimize pressure, gas flow rate, gas mixture, and RF power. Dry etching is very similar to sputtering and in fact the same equipment can be used. Reactive ion etching (RIE) induces plasma etching accompanied by ionic bombardment. Dry etching is used for submicron technologies since it achieves anisotropic profiles (no undercutting).
## Chemical Mechanical Polishing
Performing the photolithographic steps on nonplanar surfaces can be challenging. Moreover, maintaining uniform thickness of metal deposited over a surface with abrupt transitions is difficult. The solution is to planarize the surface of the wafer prior to each photolithographic or deposition step. One means for achieving planarization is to use an oxide appropriately doped so that it will reflow under elevated temperature. Another, and far superior, means for pla-narization is to literally polish the wafer when a flat surface is needed. Modern processes use chemical mechanical polishing (CMP) to planarize wafers [20].
## Photolithography
Each of the basic semiconductor fabrication processes discussed thus far is applied only to selected parts of the silicon wafer with the exception of oxidation, deposition, and CMP. The selection of these parts is accomplished by a process called photolithography [12,21,22]. Photolithography refers to the complete process of transferring an image from a photomask or computer database to a wafer. The basic components of photolithography are the photoresist material and the photomask used to expose some areas of the photoresist to ultraviolet (UV) light while shielding the remainder.
Photoresist is an organic polymer whose characteristics can be altered when exposed to ultraviolet light. Photoresist is classified into positive and negative photoresist. Positive photoresist is used to create a mask where patterns exist (where the photomask is opaque to UV light). Negative photoresist creates a mask where patterns do not exist (where the photomask is transparent to UV light). The photolithographic process involves depositing photoresist on the wafer and conditioning it with time and temperature. Portions of the photoresist are exposed to UV light. After exposure, the exposed photoresist is hardened through a developing process while the unexposed areas are removed. The hardened photoresist protects selected areas from plasma or acids used in the etching process. When its protective function is complete, the photoresist is removed with solvents or plasma ashing, leaving underlying layers unharmed. This process must be repeated for each layer of the integrated circuit. Figure 2.1-4 shows, by way of example, the basic photolithographic steps in defining a polysilicon geometry using positive photoresist.

Figure 2.1-4 Basic photolithographic steps to define a polysilicon geometry: (a) expose, (b) develop, (c) etch, (d) remove photoresist.

Figure 2.1-4 (Continued)
The process of exposing selective areas of a wafer to light through a photomask is called printing. There are three basic types of printing systems used. They are listed below:
- Contact printing
- Proximity printing
- Projection printing
The simplest and most accurate method is contact printing. This method uses a glass plate a little larger than the size of the actual wafer with the image of the desired pattern on the side of the glass that comes in physical contact with the wafer. This glass plate is called a photomask. The system achieves high resolution, high throughput, and low cost. Unfortunately, because of the direct contact, the photomask wears out and has to be replaced after 10-25 exposures. This method also introduces impurities and defects, because of the physical contact. For these reasons, contact printing is not used in modern VLSI.
A second exposure system is called proximity printing. In this system, the photomask and wafer are placed very close to one another but not in intimate contact. As the gap between the photomask and the wafer increases, resolution decreases. In general, this method of patterning is not useful where minimum feature size is below ${2\mu }\mathrm{m}$ . Therefore, proximity printing is not used in present-day VLSI.
The projection printing method separates the wafer from the photomask by a relatively large distance. Lenses or mirrors are used to focus the photomask image on the surface of the wafer. There are two approaches used for projection printing: scanning and step-and-repeat. The scanning method passes light through the scaled photomask (typically $5 \times$ ), which follows a complex optical path reflecting off multiple mirrors imaging the wafer with an arc of illumination optimized for minimum distortion. The photomask and wafer scan the illuminated arc. Minimum feature size for this method is approximately ${0.25\mu }\mathrm{m}$ . The projection printing system most used today is step-and-repeat.
The latest advancements in photolithography, with the goal of increasing resolution, replace the air gap between the lens and the wafer surface with a liquid medium (highly purified water).
Electron beam exposure systems are often used to generate the photomasks for projection printing systems because of their high resolution (less than ${1\mu }\mathrm{m}$ ). However, the electron beam can be used to directly pattern photoresist without using a photomask. The advantages of using the electron beam as an exposure system are accuracy and the ability to make software changes. The disadvantages are high cost and low throughput.
## Twin-Well CMOS Fabrication Steps
It is important for a circuit designer to understand some of the basic steps involved in fabricating a CMOS circuit. The fabrication steps of a generic submicron CMOS twin-well silicon-gate process will be described.
Fabrication begins with a heavily doped ${\mathrm{p}}^{ + }$ silicon wafer with a lightly doped ${\mathrm{p}}^{ - }$ epitaxial layer (epi layer). A thin silicon-dioxide region is grown on the surface of the ${\mathrm{p}}^{ - }$ epi layer. Subsequent to this, the regions where n-wells are to exist are defined in a masking step by depositing a photoresist material on top of the oxide. After exposing and developing the photoresist, n-type impurities are implanted into the wafer as illustrated in Fig. 2.1-5(a). Next, photoresist is removed and p-wells are created using a p-well mask and the photolithographic process to define appropriate areas to be implanted. Photoresist is removed and a high-temperature oxidation/drive-in step is performed, causing the implanted ions to diffuse into the substrate. This is followed by oxide removal and subsequent growth of a thin pad oxide layer. (The purpose of the pad oxide is to protect the substrate from stress due to the difference in the thermal expansion of silicon and silicon nitride.) A layer of silicon nitride is deposited over the entire wafer as illustrated in Fig. 2.1-5(b). Silicon nitride is used as a stop layer during the CMP step. Photoresist is deposited, patterned, and developed as before, and the silicon nitride is removed from the areas where it has been patterned. The silicon nitride and photoresist remain in the areas where transistors will reside. The regions where silicon nitride remains are called active area(AA). In order to provide isolation between transistors, an etch is performed that cuts trenches between the remaining nitride (AA) regions as illustrated in Fig. 2.1-5(c). This is followed by a linear oxide growth and a conformal oxide deposition [Fig. 2.1-5(d)]. A CMP step removes the oxide, forming a planar surface at the top of the nitride as shown in Fig. 2.1-5(e). At this stage, the active areas are separated by shallow trench isolation (STI) regions.
Next, using the appropriate p-well or n-well mask and photolithographic steps, p-type and n-type field implants are performed. These will ensure that parasitic transistors are not formed in the field regions. Nitride is removed. A thin gate oxide is grown followed by a poly-silicon deposition step [Fig. 2.1-5(f)]. Polysilicon is then patterned and etched, leaving only what is required to make transistor gates and interconnect lines.

Figure 2.1-5 The major CMOS process steps.
At this point, the drain and source areas have not been diffused into the substrate. Modern processes employ lightly doped drain/source (LDD) diffusions to minimize impact ionization. The LDD structure is created by first performing a lightly doped implant (LDD), which self-aligns with the polysilicon gate and the STI. Figure 2.1-5(g) shows the results after both p-channel and n-channel transistors have received their LDD implant of the appropriate type $\left( {\mathrm{p}}^{ - }\right.$ and ${\mathrm{n}}^{ - }$ , respectively). A nitride spacer is formed on the sides of the polysil-icon gates by depositing a thin nitride layer followed by an anisotropic etch [Fig. 2.1-5(h)]. To make ${\mathrm{n}}^{ + }$ sources and drains, photoresist is applied and patterned everywhere $\mathrm{n}$ -channel transistors are required; ${\mathrm{n}}^{ + }$ is also required where metal connections are to be made to ${\mathrm{n}}^{ - }$ material such as the n-well. After developing, the ${\mathrm{n}}^{ + }$ areas are implanted as illustrated in Fig. 2.1-5(i). The photoresist acts as a barrier to the implant, as does the nitride spacer. As a result, the ${\mathrm{n}}^{ + }$ regions that result are properly aligned with the spacer nitride. Similarly, the p-channel transistors receive their S/D implant after appropriate masking [Fig. 2.1-5(j)]. Annealing is performed in order to activate the implanted ions. Figure 2.1-5(k) shows the result after this step.

Figure 2.1-5 (Continued)

Figure 2.1-5 (Continued)
In order to improve the conductivity of S/D, polysilicon interconnect, and contacts, titanium (Ti) is sputtered over the entire wafer. Annealing is performed, which forms titanium silicide $\left( {\mathrm{{TiSi}}}_{2}\right)$ at all silicon interfaces [22]. Silicide provides a much lower resistance than diffusion or polysilicon. Silicide is not formed on the nitride spacer. The Ti not interfacing to silicon is removed using a chemical etch. Figure 2.1-5(1) illustrates the titanium silicide remaining on $\mathrm{S}/\mathrm{D}$ and polysilicon gates. Because the titanium silicide does not react with the nitride spacer (and is later removed), the resulting silicide is self-aligned with polysilicon and diffusion. Thus, the technique for creating the silicide is called a salicide process (meaning a self-aligned-silicide). To avoid confusion, the term "silicide" will be used throughout the text. A new, thick oxide layer is deposited over the entire wafer as illustrated in Fig. 2.1-5(m), followed by a CMP step to planarize the surface. Contacts are formed by first defining their location using the photolithographic process applied in earlier steps. Next, the oxide areas where contacts are to be made are etched down to the surface of the silicide. The remaining photoresist is removed. A thin titanium/titanium-nitride (Ti/TiN) layer is deposited followed by a thick layer of tungsten (W). The Ti/TiN provides adhesion and a diffusion barrier and the tungsten readily fills the holes formed by the contact etch. Another CMP step is performed, this time removing the tungsten so that only the tungsten plugs remain where contact holes were formed. Aluminum is deposited to form the Metal 1 interconnect layer. It is defined photolithographically and subsequently etched removing all unnecessary metal. To prepare for a Metal 2, another interlayer dielectric is deposited [Fig. 2.1-5(n)]. Again, CMP is performed to planarize the surface of the oxide. Intermetal connections (vias) are defined through the photolithographic patterning and etch. A thin layer of Ti/TiN is deposited followed by a thick layer of tungsten. A CMP step polishes away the tungsten above the surface of the oxide, leaving plugs. Metal 2 aluminum is deposited, patterned, and etched [Fig. 2.1-5(o)]. The steps of oxide deposition, CMP, tungsten plug formation, and aluminum metallization are repeated for as many layers of metal as desired.

Figure 2.1-5 (Continued)
In order to protect the wafer from chemical intrusion or scratching, a passivation layer of oxide or nitride is applied, covering the entire wafer. Pad regions are then defined (areas where wires will be bonded between the integrated circuit and the package containing the circuit) and the passivation layer removed only in these areas. Figure 2.1-5(p) shows a cross section of the final circuit.
To illustrate the process steps in sufficient detail, true relative dimensions are not given (i.e., the side-view drawings are not to scale). It is valuable to gain an appreciation of actual scale; thus, Fig. 2.1-6 is provided to illustrate relative dimensions.
Thus far, the basic twin-well CMOS process has been described. There are a variety of enhancements that can be applied to this process to improve circuit performance.
Prior to forming contact plugs, titanium was deposited and annealed, and titanium silicide was formed at all silicon interfaces, including polysilicon. The polysilicide forms a much lower resistance than the polysilicon alone. This is beneficial where low-resistance interconnect is desired. However, analog designers often want to use high-resistance components and polysilicon is an excellent choice. In order to use the sheet resistance of the polysilicon, the titanium must be blocked from being depositing onto the polysilicon. This is achieved with an additional mask-silicide block-which does precisely what its name implies. In some processes, the polysilicon is not doped. Intrinsic polysilicon has a very high resistance. To be useful as an analog component, a mask is used to selectively dope polysil-icon resistors to achieve the desired resistivity.

Figure 2.1-6 Side view of a CMOS integrated circuit.
Invariably, analog circuits require high-performance capacitors. There are at least three common ways to achieve useful capacitors: (1) poly-oxide-poly, (2) metal-oxide-metal (MOM), and (3) metal-insulator-metal (MiM). Poly-oxide-poly (or simply poly-poly) capacitors are fabricated by an additional step subsequent to the gate-poly step so that two polysil-icon layers lie on top of one another with an intervening thin oxide. MOM capacitors are formed without any additional processing steps as they are simply capacitors made from the various metal layers that already exist (suitably oriented in the layout). MiM capacitors require the formation of an additional metal layer. It is usually created just prior to the final interconnect layer and sits atop a thin oxide on the second-to-last metal interconnect layer. These capacitor structures are described in Section 2.4.
When designing analog circuits integrated with complex digital circuitry, one must be careful to avoid interference due to the digital logic-digital noise. Such interference will reduce the performance of sensitive analog signal paths. There are numerous circuit design techniques that can mitigate digital noise. In addition, there are structural methods to isolate the analog circuits from the digital ones. One such method is to use deep $n$ -well (DNW). Figure 2.1-7 illustrates an example of a deep n-well. The well is driven below the depth of the p-well and the standard n-well. Electrical connection to the DNW is made via n-well and ${\mathrm{n}}^{ + }$ diffusions. Isolation and interference reduction is achieved by connecting the DNW to a quiet supply source (e.g., a quiet ${V}_{DD}$ ).
As geometries shrink, the breakdown voltages for transistors also go down. Thus, core supply voltages continue to go down (e.g.,65 nm core voltage is typically around 1.0 volts). Even though core voltages are shrinking, I/O voltages are not (at the same rate); thus, interfacing between the core of an integrated circuit and the I/O presents challenges. One solution is to provide transistors with higher breakdown voltages alongside the standard devices. The primary means for accomplishing this is to offer multiple gate oxides. The smallest gate oxide is used for core transistors while larger gate oxides are used for I/O devices. Clever designers often find use of the I/O devices with the core of the integrated circuit to address special needs (e.g., low-leakage circuitry).
The process described in this section applies generally to ${0.25\mu }\mathrm{m}$ and below. Technologies at ${0.35\mu }\mathrm{m}$ and above typically use the LOCOS method for isolation. An example of such a process (n-well LOCOS) is illustrated in Fig. 2.1-8.

Figure 2.1-7 Deep n-well improves isolation.

Figure 2.1-8 Cross section of a LOCOS CMOS process.

### 2.2 The pn Junction
The pn junction plays an important role in all semiconductor devices. The objective of this section is to develop the concepts of the pn junction that will be useful to us later in our study. These include the depletion-region width, the depletion capacitance, reverse-bias or breakdown voltage, and the diode equation. Further information can be found in the references $\left\lbrack  {{23},{24}}\right\rbrack$ .
Figure 2.2-1(a) shows the physical model of a pn junction. In this model it is assumed that the impurity concentration changes abruptly from ${N}_{D}$ donors in the n-type semiconductor to ${N}_{A}$ acceptors in the p-type semiconductor. This situation is called a step junction and is illustrated in Fig. 2.2-1(b). The distance $x$ is measured to the right from the metallurgical junction at $x = 0$ . When two different types of semiconductor materials are formed in this manner, the free carriers in each type move across the junction by the principle of diffusion. As these free carriers cross the junction, they leave behind fixed atoms that have a charge opposite to the carrier. For example, as the electrons near the junction of the n-type material diffuse across the junction they leave fixed donor atoms of opposite charge $\left( +\right)$ near the junction of the n-type material. This is represented in Fig. 2.2-1(c) by the rectangle with a height of $q{N}_{D}$ . Similarly, the holes that diffuse across the junction from the p-type material to the n-type material leave behind fixed acceptor atoms that are negatively charged. The electrons and holes that diffuse across the junction quickly recombine with the free majority carriers across the junction. As positive and negative fixed charges are uncovered near the junction by the diffusion of the free carriers, an electric field develops that creates an opposing carrier movement. When the current due to the free carrier diffusion equals the current caused by the electric field, the pn junction reaches equilibrium. In equilibrium, both ${v}_{D}$ and ${i}_{D}$ of Fig. 2.2-1(a) are zero.
The distance over which the donor atoms have a positive charge (because they have lost their free electron) is designated as ${x}_{n}$ in Fig. 2.2-1(c). Similarly, the distance over which the acceptor atoms have a negative charge (because they have lost their free hole) is ${x}_{p}$ . In this diagram, ${x}_{p}$ is a negative number. The depletion region is defined as the region about the metallurgical junction that is depleted of free carriers. The depletion region is defined as
$$
{x}_{d} = {x}_{n} - {x}_{p} \tag{2.2-1}
$$

Figure 2.2-1 Junction; (a) physical structure, (b) impurity concentration, (c) depletion charge concentration, (d) electric field, (e) electrostatic potential.
Note that ${x}_{p} < 0$ .
Due to electrical neutrality, the charge on either side of the junction must be equal. Thus,
$$
q{N}_{D}{x}_{n} =  - q{N}_{A}{x}_{p} \tag{2.2-2}
$$
where $q$ is the charge of an electron $\left( {{1.60} \times  {10}^{-{19}}\mathrm{C}}\right)$ . The electric field distribution in the depletion region can be calculated using the point form of Gauss's law.
$$
\frac{{dE}\left( x\right) }{dx} = \frac{qN}{{\varepsilon }_{\mathrm{{Si}}}} \tag{2.2-3}
$$
By integrating either side of the junction, the maximum electric field that occurs at the junction, ${E}_{0}$ , can be found. This is illustrated in Fig. 2.2-1(d). Therefore, the expression for ${E}_{0}$ is
$$
{E}_{0} = {\int }_{0}^{{E}_{0}}{dE} = {\int }_{{x}_{p}}^{0}\frac{-q{N}_{A}}{{\varepsilon }_{\mathrm{{Si}}}}{dx} = \frac{q{N}_{A}{x}_{p}}{{\varepsilon }_{\mathrm{{Si}}}} = \frac{-q{N}_{D}{x}_{n}}{{\varepsilon }_{\mathrm{{Si}}}} \tag{2.2-4}
$$
where ${\varepsilon }_{\mathrm{{Si}}}$ is the dielectric constant of silicon and is ${11.7}{\varepsilon }_{0}\left( {\varepsilon }_{0}\right.$ is $\left. {{8.85} \times  {10}^{-{14}}\mathrm{\;F}/\mathrm{{cm}}}\right)$ .
The voltage drop across the depletion region is shown in Fig. 2.2-1(e). The voltage is found by integrating the negative electric field, resulting in
$$
{\phi }_{0} - {v}_{D} = \frac{-{E}_{0}\left( {{x}_{n} - {x}_{p}}\right) }{2} \tag{2.2-5}
$$
where ${v}_{D}$ is an applied external voltage and ${\phi }_{0}$ is called the barrier potential and is given as
$$
{\phi }_{0} = \frac{kT}{q}\ln \left( \frac{{N}_{A}{N}_{D}}{{n}_{i}^{2}}\right)  = {V}_{t}\ln \left( \frac{{N}_{A}{N}_{D}}{{n}_{i}^{2}}\right)  \tag{2.2-6}
$$
Here, $k$ is Boltzmann’s constant $\left( {{1.38} \times  {10}^{-{23}}\mathrm{\;J}/\mathrm{K}}\right)$ and ${n}_{i}$ is the intrinsic concentration of silicon, which is ${1.45} \times  {10}^{10}/{\mathrm{{cm}}}^{3}$ at ${300}\mathrm{\;K}$ . At room temperature, the value of ${V}_{t}$ is ${25.9}\mathrm{\;{mV}}$ . It is important to note that the notation for ${kT}/q$ is ${V}_{t}$ rather than the conventional ${V}_{T}$ . The reason for this is to avoid confusion with ${V}_{T}$ , which will be used to designate the threshold voltage of the MOS transistor (see Section 2.3). Although the barrier voltage exists with ${v}_{D} = 0$ , it is not available externally at the terminals of the diode. When metal leads are attached to the ends of the diode a metal-semiconductor junction is formed. The barrier potentials of the metal-semiconductor contacts are exactly equal to ${\phi }_{0}$ so that the open circuit voltage of the diode is zero.
Equations (2.2-2), (2.2-4), and (2.2-5) can be solved simultaneously to find the width of the depletion region in the n-type and p-type semiconductor. These widths are found as
$$
{x}_{n} = {\left\lbrack  \frac{2{\varepsilon }_{\mathrm{{Si}}}\left( {{\phi }_{0} - {v}_{D}}\right) {N}_{A}}{q{N}_{D}\left( {{N}_{A} + {N}_{D}}\right) }\right\rbrack  }^{1/2} \tag{2.2-7}
$$
and
$$
{x}_{p} =  - {\left\lbrack  \frac{2{\varepsilon }_{\mathrm{{Si}}}\left( {{\phi }_{0} - {v}_{D}}\right) {N}_{D}}{q{N}_{A}\left( {{N}_{A} + {N}_{D}}\right) }\right\rbrack  }^{1/2} \tag{2.2-8}
$$
The width of the depletion region, ${x}_{d}$ , is found from Eqs. (2.2-1),(2.2-7), and (2.2-8) and is
$$
{x}_{d} = {\left\lbrack  \frac{2{\varepsilon }_{\mathrm{{Si}}}\left( {{N}_{A} + {N}_{D}}\right) }{q{N}_{A}{N}_{D}}\right\rbrack  }^{1/2}{\left( {\phi }_{0} - {v}_{D}\right) }^{1/2} \tag{2.2-9}
$$
It can be seen from Eq. (2.2-9) that the depletion width for the pn junction of Fig. 2.2-1 is proportional to the square root of the difference between the barrier potential and the externally applied voltage. It can also be shown that ${x}_{d}$ is approximately equal to ${x}_{n}$ or ${x}_{p}$ for ${N}_{A} >  > {N}_{D}$ or ${N}_{D} >  > {N}_{A}$ , respectively. Consequently, the depletion region will extend farther into the lightly doped semiconductor than it will into the heavily doped semiconductor.
It is also of interest to characterize the depletion charge ${Q}_{j}$ , which is equal to the magnitude of the fixed charge on either side of the junction. The depletion charge can be expressed from the above relationships as
$$
{Q}_{j} = \left| {{Aq}{N}_{A}{x}_{p}}\right|  = {Aq}{N}_{D}{x}_{n} = A{\left\lbrack  \frac{2{\varepsilon }_{\mathrm{{Si}}}q{N}_{A}{N}_{D}}{{N}_{A} + {N}_{D}}\right\rbrack  }^{1/2}{\left( {\phi }_{0} - {v}_{D}\right) }^{1/2} \tag{2.2-10}
$$
where $A$ is the cross-sectional area of the pn junction.
The magnitude of the electric field at the junction ${E}_{0}$ can be found from Eqs. (2.2-4) and (2.2-7) or (2.2-8). This quantity is expressed as
$$
{E}_{0} = {\left\lbrack  \frac{{2q}{N}_{A}{N}_{D}}{{\varepsilon }_{\mathrm{{Si}}}\left( {{N}_{A} + {N}_{D}}\right) }\right\rbrack  }^{1/2}{\left( {\phi }_{0} - {v}_{D}\right) }^{1/2} \tag{2.2-11}
$$
Equations (2.2-9), (2.2-10), and (2.2-11) are key relationships in understanding the pn junction.
The depletion region of a pn junction forms a capacitance called the depletion-layer capacitance. It results from the dipole formed by uncovered fixed charges near the junction and will vary with the applied voltage. The depletion-layer capacitance ${C}_{j}$ can be found from Eq. (2.2-10) using the following definition of capacitance:
$$
{C}_{j} = \frac{d{Q}_{j}}{d{v}_{D}} = A{\left\lbrack  \frac{{\varepsilon }_{\mathrm{{Si}}}q{N}_{A}{N}_{D}}{2\left( {{N}_{A} + {N}_{D}}\right) }\right\rbrack  }^{1/2}\frac{1}{{\left( {\phi }_{0} - {v}_{D}\right) }^{1/2}} = \frac{{C}_{j0}}{{\left\lbrack  1 - \left( {v}_{D}/{\phi }_{0}\right) \right\rbrack  }^{m}} \tag{2.2-12}
$$
${C}_{j0}$ is the depletion-layer capacitance when ${v}_{D} = 0$ and $m$ is called a grading coefficient. The coefficient $m$ is 1/2 for the case of Fig. 2.2-1, which is called a step junction. If the junction is fabricated using diffusion techniques described in Section 2.1, Fig. 2.2-1(b) will become more like the profile of Fig. 2.2-2. It can be shown for this case that $m$ is $1/3$ . The range of values of the grading coefficient will fall between 1/3 and 1/2. Figure 2.2-3 shows a plot of the depletion layer capacitance for a pn junction. It is seen that when ${v}_{D}$ is positive and approaches ${\phi }_{0}$ , the depletion-layer capacitance approaches infinity. At this value of voltage, the assumptions made in deriving the above equations are no longer valid. In particular, the assumption that the depletion region is free of charged carriers is not true. Consequently, the actual curve bends over and ${C}_{j}$ decreases as ${v}_{D}$ approaches ${\phi }_{0}$ [25].

Figure 2.2-2 Impurity concentration profile for diffused pn junction.

Figure 2.2-3 Depletion capacitance as a function of externally applied junction voltage.
---
Example 2.2-1
---
## Characteristics of a pn Junction
Find ${x}_{p},{x}_{n},{x}_{d},{\phi }_{0},{C}_{j0}$ , and ${C}_{j}$ for an applied voltage of $- 4\mathrm{\;V}$ for a pn diode with a step junction, ${N}_{A} = 5 \times  {10}^{15}/{\mathrm{{cm}}}^{3},{N}_{D} = {10}^{20}/{\mathrm{{cm}}}^{3}$ , and an area of ${10\mu }\mathrm{m}$ by ${10\mu }\mathrm{m}$ .
At room temperature, Eq. (2.2-6) gives the barrier potential as 0.917 V. Equations (2.2-7) and (2.2-8) give ${x}_{n} \cong  0$ and ${x}_{p} = {1.128\mu }\mathrm{m}$ . Thus, the depletion width is approximately ${x}_{p}$ or ${1.128\mu }\mathrm{m}$ . Using these values in Eq. (2.2-12) we find that ${C}_{j0}$ is ${20.3}\mathrm{{fF}}$ and at a voltage of $- 4\mathrm{\;V},{C}_{j}$ is ${9.18}\mathrm{{fF}}$ .
The voltage breakdown of a reverse-biased $\left( {{v}_{D} < 0}\right)$ pn junction is determined by the maximum electric field ${E}_{\max }$ that can exist across the depletion region. For silicon, this maximum electric field is approximately $3 \times  {10}^{5}\mathrm{\;V}/\mathrm{{cm}}$ . If we assume that $\left| {v}_{D}\right|  > {\phi }_{0}$ , then substituting ${E}_{\max }$ into Eq. (2.2-11) allows us to express the maximum reverse-bias voltage or breakdown voltage(BV)as
$$
{BV} \cong  \frac{{\varepsilon }_{\mathrm{{Si}}}\left( {{N}_{A} + {N}_{D}}\right) }{{2q}{N}_{A}{N}_{D}}{E}_{\max }^{2} \tag{2.2-13}
$$
Substituting the values of Example 2.2-1 in Eq. (2.2-13) and using a value of $3 \times  {10}^{5}\mathrm{\;V}/\mathrm{{cm}}$ for ${E}_{\max }$ gives a breakdown voltage of 58.2 volts. However, as the reverse-bias voltage starts to approach this value, the reverse current in the pn junction starts to increase. This increase is due to two conduction mechanisms that can take place in a reverse-biased junction between two heavily doped semiconductors. The first current mechanism is called avalanche multiplication and is caused by the high electric fields present in the pn junction; the second is called Zener breakdown. Zener breakdown is a direct disruption of valence bonds in high electric fields. However, the Zener mechanism does not require the presence of an energetic ionizing carrier. The current in most breakdown diodes will be a combination of these two current mechanisms.
If ${i}_{R}$ is the reverse current in the pn junction and ${v}_{R}$ is the reverse-bias voltage across the pn junction, then the actual reverse current ${i}_{RA}$ can be expressed as
$$
{i}_{RA} = M{i}_{R} = \left( \frac{1}{1 - {\left( {v}_{R}/BV\right) }^{n}}\right) {i}_{R} \tag{2.2-14}
$$
$M$ is the avalanche multiplication factor and $n$ is an exponent that adjusts the sharpness of the "knee" of the curve shown in Fig. 2.2-4. Typically, $n$ varies between 3 and 6 . If both sides of the pn junction are heavily doped, the breakdown will take place by tunneling, leading to the

Figure 2.2-4 Reverse-bias volgate-current characteristics of the pn junction illustrating voltage breakdown.
Zener breakdown, which generally occurs at voltages less than 6 volts. Zener diodes can be fabricated where an ${\mathrm{n}}^{ + }$ diffusion overlaps with a ${\mathrm{p}}^{ + }$ diffusion. Note that the Zener diode is compatible with the basic CMOS process although one terminal of the Zener must be either on the lowest power supply, ground, or the highest power supply, ${V}_{DD}$ .
The diode voltage-current relationship can be derived by examining the minority-carrier concentrations in the pn junction. Figure 2.2-5 shows the minority-carrier concentration for a forward-biased pn junction. The majority-carrier concentrations are much larger and are not shown on this figure. The forward bias causes minority carriers to move across the junction where they recombine with majority carriers on the opposite side. The excess of minority-carrier concentration on each side of the junction is shown by the shaded regions. We note that this excess concentration starts at a maximum value at $x = 0\left( {{x}^{\prime } = 0}\right)$ and decreases to the equilibrium value as $x\left( {x}^{\prime }\right)$ becomes large. The value of the excess concentration at $x = 0$ , designated as ${p}_{n}\left( 0\right)$ , or ${x}^{\prime } = 0$ , designated as ${n}_{p}\left( 0\right)$ , is expressed in terms of the forward-bias voltage ${v}_{D}$ as
$$
{p}_{n}\left( 0\right)  = {p}_{n0}\exp \left( \frac{{v}_{D}}{{V}_{t}}\right)  \tag{2.2-15}
$$
and
$$
{n}_{p}\left( 0\right)  = {n}_{p0}\exp \left( \frac{{v}_{D}}{{V}_{t}}\right)  \tag{2.2-16}
$$
where ${p}_{n0}$ and ${n}_{p0}$ are the equilibrium concentrations of the minority carriers in the n-type and p-type semiconductors, respectively. We note that these values are essentially equal to the intrinsic concentration squared divided by the donor or acceptor impurity atom concentration, as shown on Fig. 2.2-5. As ${v}_{D}$ is increased, the excess minority concentrations are increased. If ${v}_{D}$ is zero, there is no excess minority concentration. If ${v}_{D}$ is negative (reverse biased), the minority-carrier concentration is depleted below its equilibrium value.
The current that flows in the pn junction is proportional to the slope of the excess minority-carrier concentration at $x = 0\left( {{x}^{\prime } = 0}\right)$ . This relationship is given by the diffusion equation expressed below for holes in the n-type material.
$$
{J}_{p}\left( x\right)  =  - {\left. q{D}_{p}\frac{d{p}_{n}\left( x\right) }{dx}\right| }_{x = 0} \tag{2.2-17}
$$
where ${D}_{p}$ is the diffusion constant of holes in an n-type semiconductor. The excess holes in the n-type material can be defined as
$$
{p}_{n}^{\prime }\left( x\right)  = {p}_{n}\left( x\right)  - {p}_{n0} \tag{2.2-18}
$$

Figure 2.2-5 Impurity concentration profile for diffused pn junction.
The decrease of excess minority carriers away from the junction is exponential and can be expressed as
$$
{p}_{n}^{\prime }\left( x\right)  = {p}_{n}^{\prime }\left( 0\right) \exp \left( \frac{-x}{{L}_{p}}\right)  = \left\lbrack  {{p}_{n}\left( 0\right)  - {p}_{n0}}\right\rbrack  \exp \left( \frac{-x}{{L}_{p}}\right)  \tag{2.2-19}
$$
where ${L}_{p}$ is the diffusion length for holes in an $\mathrm{n}$ -type semiconductor. Substituting Eq. (2.2-15) into Eq. (2.2-19) gives
$$
{p}_{n}^{\prime }\left( x\right)  = {p}_{n0}\left\lbrack  {\exp \left( \frac{{v}_{D}}{{V}_{t}}\right)  - 1}\right\rbrack  \exp \left( \frac{-x}{{L}_{p}}\right)  \tag{2.2-20}
$$
The current density due to the excess-hole concentration in the n-type semiconductor is found by substituting Eq. (2.2-20) in Eq. (2.2-17), resulting in
$$
{J}_{p}\left( 0\right)  = \frac{q{D}_{p}{p}_{n0}}{{L}_{p}}\left\lbrack  {\exp \left( \frac{{v}_{D}}{{V}_{t}}\right)  - 1}\right\rbrack   \tag{2.2-21}
$$
Similarly, for the excess electrons in the p-type semiconductor we have
$$
{J}_{n}\left( 0\right)  = \frac{q{D}_{n}{n}_{p0}}{{L}_{n}}\left\lbrack  {\exp \left( \frac{{v}_{D}}{{V}_{t}}\right)  - 1}\right\rbrack   \tag{2.2-22}
$$
Assuming negligible recombination in the depletion region leads to an expression for the total current density of the pn junction, given as
$$
J\left( 0\right)  = {J}_{p}\left( 0\right)  + {J}_{n}\left( 0\right)  = q\left\lbrack  {\frac{{D}_{p}{p}_{n0}}{{L}_{p}} + \frac{{D}_{n}{n}_{p0}}{{L}_{n}}}\right\rbrack  \left\lbrack  {\exp \left( \frac{{v}_{D}}{{V}_{t}}\right)  - 1}\right\rbrack   \tag{2.2-23}
$$
Multiplying Eq. (2.2-23) by the pn junction area $A$ gives the total current as
$$
{i}_{D} = {q}^{A}\left\lbrack  {\frac{{D}_{p}{p}_{n0}}{{L}_{p}} + \frac{{D}_{n}{n}_{p0}}{{L}_{n}}}\right\rbrack  \left\lbrack  {\exp \left( \frac{{v}_{D}}{{V}_{t}}\right)  - 1}\right\rbrack   = {I}_{s}\left\lbrack  {\exp \left( \frac{{v}_{D}}{{V}_{t}}\right)  - 1}\right\rbrack   \tag{2.2-24}
$$
${I}_{s}$ is a constant called the saturation current. Equation (2.2-24) is the familiar voltage-current relationship that characterizes the pn junction diode.
---
Example 2.2-2
---
## Calculation of the Saturation Current
Calculate the saturation current of a pn junction diode with ${N}_{A} = 5 \times  {10}^{15}/{\mathrm{{cm}}}^{3},{N}_{D} =$ ${10}^{20}/{\mathrm{{cm}}}^{3},{D}_{n} = {20}{\mathrm{\;{cm}}}^{2}/\mathrm{s},{D}_{p} = {10}{\mathrm{\;{cm}}}^{2}/\mathrm{s},{L}_{n} = {10\mu }\mathrm{m},{L}_{p} = {5\mu }\mathrm{m}$ , and $A = {1000\mu }{\mathrm{m}}^{2}$ .
From Eq. (2.2-24), the saturation current is defined as
$$
{I}_{s} = {qA}\left( {\frac{{D}_{p}{p}_{n0}}{{L}_{p}} + \frac{{D}_{n}{n}_{p0}}{{L}_{n}}}\right)
$$
${P}_{n0}$ is calculated from ${n}_{i}^{2}/{N}_{D}$ to get ${2.103}/{\mathrm{{cm}}}^{3};{n}_{p0}$ is calculated from ${n}_{i}^{2}/{N}_{A}$ to get ${4.205} \times$ ${10}^{4}/{\mathrm{{cm}}}^{3}$ . Changing the units of area from $\mu {\mathrm{m}}^{2}$ to ${\mathrm{{cm}}}^{2}$ results in a saturation current magnitude of ${1.346} \times  {10}^{-{15}}\mathrm{\;A}$ or ${1.346}\mathrm{{fA}}$ .
This section has developed the depletion-region width, depletion capacitance, breakdown voltage, and voltage-current characteristics of the pn junction. These concepts will be very important in determining the characteristics and performance of MOS active and passive components.

### 2.3 The MOS Transistor
The structure of an n-channel and a p-channel MOS transistor fabricated using an n-well LOCOS process (same principles apply for a twin-well STI process) is shown in Fig. 2.3-1. The p-channel device is formed with two heavily doped ${\mathrm{p}}^{ + }$ regions diffused into a lighter doped ${\mathrm{n}}^{ - }$ material called the well. The two ${\mathrm{p}}^{ + }$ regions are called drain and source, and are separated by a distance, $L$ (referred to as the device length). At the surface between the drain and source lies a gate electrode that is separated from the silicon by a thin dielectric material (silicon dioxide). Similarly, the n-channel transistor is formed by two heavily doped ${\mathrm{n}}^{ + }$ regions within a lightly doped ${\mathrm{p}}^{ - }$ substrate and has a gate on the surface between the drain and source separated from the silicon by a thin dielectric material (silicon dioxide). Essentially, both types of transistors are four-terminal devices as shown in Fig. 1.2-2(c, d). The $B$ terminal is the bulk, or substrate, which contains the drain and source diffusions. For an n-well process, the p-bulk connection is common throughout the integrated circuit and is connected to ground (the most negative supply). Multiple n-wells can be fabricated on a single circuit, and they can be connected to different potentials in various ways depending on the application.
Figure 2.3-2 shows an n-channel transistor with all four terminals connected to ground. At equilibrium, the ${\mathrm{p}}^{ - }$ substrate and the ${\mathrm{n}}^{ + }$ source and drain form a pn junction. Therefore, a depletion region exists between the ${\mathrm{n}}^{ + }$ source and drain and the ${\mathrm{p}}^{ - }$ substrate. Since the source and drain are separated by back-to-back pn junctions, the resistance between the source and drain is very high $\left( { > {10}^{12}\Omega }\right)$ . The gate and the substrate of the MOS transistor form the parallel plates of a capacitor with the ${\mathrm{{SiO}}}_{2}$ as the dielectric. This capacitance divided by the area

Figure 2.3-1 Physical structure of an n-channel and a p-channel transistor in an n-well technology.

Figure 2.3-2 Cross section of an n-channel transistor with all terminals grounded.
of the gate is designated as ${C}_{ox} \cdot$ * When a positive potential is applied to the gate with respect to the source, a depletion region is formed under the gate resulting from holes being pushed away from the silicon-silicon dioxide interface. The depletion region consists of fixed ions that have a negative charge. Using one-dimensional analysis, the charge density, $\rho$ , of the depletion region is given by
$$
\rho  = q\left( {-{N}_{A}}\right)  \tag{2.3-1}
$$
Applying the point form of Gauss's law, the electric field resulting from this charge is
$$
E\left( x\right)  = \int \frac{\rho }{\varepsilon }{dx} = \int \frac{-q{N}_{A}}{{\varepsilon }_{\mathrm{{Si}}}}{dx} = \frac{-q{N}_{A}}{{\varepsilon }_{\mathrm{{Si}}}}\left( x\right)  + \mathrm{C} \tag{2.3-2}
$$
The constant, $\mathrm{C}$ , is determined by evaluating $E\left( x\right)$ at the edges of the depletion region $(x = 0$ at the ${\mathrm{{Si} - {SiO}}}_{2}$ interface; $x = {x}_{d}$ at the boundary of the depletion region in the bulk).
$$
E\left( 0\right)  = {E}_{0} = \frac{-q{N}_{A}}{{\varepsilon }_{\mathrm{{Si}}}}\left( 0\right)  + \mathrm{C} = \mathrm{C} \tag{2.3-3}
$$
$$
E\left( {x}_{d}\right)  = 0 = \frac{-q{N}_{A}}{{\varepsilon }_{\mathrm{{Si}}}}{x}_{d} + \mathrm{C} \tag{2.3-4}
$$
$$
\mathrm{C} = \frac{q{N}_{A}}{{\varepsilon }_{\mathrm{{Si}}}}{x}_{d} \tag{2.3-5}
$$
This gives an expression for $E\left( x\right)$
$$
E\left( x\right)  = \frac{q{N}_{A}}{{\varepsilon }_{\mathrm{{Si}}}}\left( {{xd} - x}\right)  \tag{2.3-6}
$$
---
*The symbol " $C$ " normally has units of farads; however, in the field of MOS devices it often has units of farads per unit area (e.g., $\mathrm{F}/{\mathrm{m}}^{2}$ ).
---
Applying the relationship between potential and electric field yields
$$
\int {d\phi } =  - \int E\left( x\right) {dx} =  - \int \frac{q{N}_{A}}{{\varepsilon }_{\mathrm{{Si}}}}\left( {{x}_{d} - x}\right) {dx} \tag{2.3-7}
$$
Integrating both sides of Eq. (2.3-7) with appropriate limits of integration gives
$$
{\int }_{{\phi }_{s}}^{{\phi }_{F}}{d\phi } =  - {\int }_{0}^{{x}_{d}}\frac{q{N}_{A}}{{\varepsilon }_{\mathrm{{Si}}}}\left( {{x}_{d} - x}\right) {dx} =  - \frac{q{N}_{A}{x}_{d}^{2}}{2{\varepsilon }_{\mathrm{{Si}}}} = {\phi }_{F} - {\phi }_{s} \tag{2.3-8}
$$
$$
\frac{q{N}_{A}{x}_{d}^{2}}{2{\varepsilon }_{\mathrm{{Si}}}} = {\phi }_{s} - {\phi }_{F} \tag{2.3-9}
$$
where ${\phi }_{F}$ is the equilibrium electrostatic potential (Fermi potential) in the semiconductor, ${\phi }_{S}$ is the surface potential of the semiconductor, and ${x}_{d}$ is the thickness of the depletion region. For a p-type semiconductor, ${\phi }_{F}$ is given as
$$
{\phi }_{F} =  - {V}_{t}\ln \left( {{N}_{A}/{n}_{i}}\right)  \tag{2.3-10}
$$
and for an $n$ -type semiconductor, ${\phi }_{F}$ is given as
$$
{\phi }_{F} = {V}_{t}\ln \left( {{N}_{D}/{n}_{i}}\right)  \tag{2.3-11}
$$
Equation (2.3-9) can be solved for ${x}_{d}$ assuming that $\left| {{\phi }_{s} - {\phi }_{F}}\right|  \geq  0$ to get
$$
{x}_{d} = {\left\lbrack  \frac{2{\varepsilon }_{\mathrm{{Si}}}\left| {{\phi }_{s} - {\phi }_{F}}\right| }{q{N}_{A}}\right\rbrack  }^{1/2} \tag{2.3-12}
$$
The immobile charge due to acceptor ions that have been stripped of their mobile holes is given by
$$
Q =  - q{N}_{A}{x}_{d} \tag{2.3-13}
$$
Substituting Eq. (2.3-12) into Eq. (2.3-13) gives
$$
Q \cong   - q{N}_{A}{\left\lbrack  \frac{2{\varepsilon }_{\mathrm{{Si}}}\left| {{\phi }_{s} - {\phi }_{F}}\right| }{q{N}_{A}}\right\rbrack  }^{1/2} =  - \sqrt{{2q}{N}_{A}{\varepsilon }_{\mathrm{{Si}}}\left| {{\phi }_{s} - {\phi }_{F}}\right| } \tag{2.3-14}
$$
When the gate voltage reaches a value called the threshold voltage, designated as ${V}_{T}$ , the substrate underneath the gate becomes inverted; that is, it changes from a p-type to an n-type semiconductor. Consequently, an n-type channel exists between the source and drain that allows carriers to flow. In order to achieve this inversion, the surface potential must increase from its original negative value $\left( {{\phi }_{s} - {\phi }_{F}}\right)$ , to zero $\left( {{\phi }_{s} = 0}\right)$ , and then to a positive value $\left( {{\phi }_{s} =  - {\phi }_{F}}\right)$ . The value of gate-source voltage necessary to cause this change in surface potential is defined as the threshold voltage, ${V}_{T}$ . This condition is known as strong inversion. The n-channel transistor in this condition is illustrated in Fig. 2.3-3. With the substrate at ground potential, the charge stored in the depletion region between the channel under the gate and the substrate is given by Eq. (2.3-14) where ${\phi }_{s}$ has been replaced by $- {\phi }_{F}$ to account for the fact that ${v}_{GS} = {V}_{T}$ . This charge ${Q}_{b0}$ is written as
$$
{Q}_{b0} \cong   - \sqrt{{2q}{N}_{A}{\varepsilon }_{\mathrm{{Si}}}\left| {-2{\phi }_{F}}\right| } \tag{2.3-15}
$$

Figure 2.3-3 Cross section of an $\mathrm{n}$ -channel transistor with small ${v}_{DS}$ and ${v}_{GS} > {V}_{T}$ .
If a reverse-bias voltage ${v}_{BS}$ is applied across the pn junction, Eq. (2.3-15) becomes
$$
{Q}_{b} \cong  \sqrt{{2q}{N}_{A}{\varepsilon }_{\mathrm{{Si}}}\left| {-2{\phi }_{F} + {v}_{SB}}\right| } \tag{2.3-16}
$$
An expression for the threshold voltage can be developed by breaking it down into several components. First, the term ${\phi }_{MS} *$ must be included to represent the difference in the work functions between the gate material and bulk silicon in the channel region. The term ${\phi }_{MS}$ is given by
$$
{\phi }_{MS} = {\phi }_{F}\left( \text{ substrate }\right)  - {\phi }_{F}\left( \text{ gate }\right)  \tag{2.3-17}
$$
where ${\phi }_{F}\left( \text{metal}\right)  = {0.6}\mathrm{\;V}$ . Second, a gate voltage of $\left\lbrack  {-2{\phi }_{F} - \left( {{Q}_{b}/{C}_{ox}}\right) }\right\rbrack$ is required to change the surface potential and offset the depletion layer charge ${Q}_{b}$ . Lastly, there is always an undesired positive charge, ${Q}_{ss}$ , present in the interface between the oxide and the bulk silicon. This charge is due to impurities and imperfections at the interface and must be compensated by a gate voltage of $- {Q}_{ss}/{C}_{ox}$ . Thus, the threshold voltage for the MOS transistor can be expressed as
$$
{V}_{T} = {\phi }_{MS} + \left( {-2{\phi }_{F} - \frac{{Q}_{b}}{{C}_{ox}}}\right)  + \left( \frac{-{Q}_{ss}}{{C}_{ox}}\right)
$$
$$
= {\phi }_{MS} - 2{\phi }_{F} - \frac{{Q}_{b0}}{{C}_{ox}} - \frac{{Q}_{ss}}{{C}_{ox}} - \frac{{Q}_{b} - {Q}_{b0}}{{C}_{ox}} \tag{2.3-18}
$$
---
*Historically, this term has been referred to as the metal-to-silicon work function. We will continue the tradition even when the gate terminal is something other than metal (e.g., polysilicon).
---
Table 2.3-1 Signs for the Quantities in the Threshold Voltage Equation.
<table><tr><td>Parameter</td><td>N-CHANNEL (p-type substrate)</td><td>P-CHANNEL (n-type substrate)</td></tr><tr><td colspan="3">${\phi }_{MS}$</td></tr><tr><td>Metal</td><td>-</td><td>-</td></tr><tr><td>${\mathrm{n}}^{ + }$ Si Gate</td><td>-</td><td>-</td></tr><tr><td>${\mathrm{p}}^{ + }$ Si Gate</td><td>+</td><td>+</td></tr><tr><td>${\phi }_{F}$</td><td>-</td><td>+</td></tr><tr><td>${Q}_{b0},{Q}_{b}$</td><td>-</td><td>+</td></tr><tr><td>${Q}_{ss}$</td><td>+</td><td>+</td></tr><tr><td>${V}_{SB}$</td><td>+</td><td>-</td></tr><tr><td>γ</td><td>+</td><td>-</td></tr></table>
The threshold voltage can be rewritten as
$$
{V}_{T} = {V}_{T0} + \gamma \left( {\sqrt{\left| -2{\phi }_{F} + {v}_{SB}\right| } - \sqrt{\left| -2{\phi }_{F}\right| }}\right)  \tag{2.3-19}
$$
where
$$
{V}_{T0} = {\phi }_{MS} - 2{\phi }_{F} - \frac{{Q}_{b0}}{{C}_{ox}} - \frac{{Q}_{ss}}{{C}_{ox}} \tag{2.3-20}
$$
and the body factor, $\gamma$ , is defined as
$$
\gamma  = \frac{\sqrt{{2q}{\varepsilon }_{\mathrm{{Si}}}{N}_{A}}}{{C}_{ox}} \tag{2.3-21}
$$
The signs of the above analysis can become very confusing. Table 2.3-1 attempts to clarify any confusion that might arise [24].
---
Example 2.3-1
---
## Calculation of the Threshold Voltage
Find the threshold voltage and body factor $\gamma$ for an n-channel transistor with an ${\mathrm{n}}^{ + }$ silicon gate if ${t}_{ox} = {200Å},{N}_{A} = 3 \times  {10}^{16}{\mathrm{\;{cm}}}^{-3}$ , gate doping, ${N}_{D} = 4 \times  {10}^{19}{\mathrm{\;{cm}}}^{-3}$ , and if the positively charged ions at the oxide-silicon interface per area is ${10}^{10}{\mathrm{\;{cm}}}^{-2}$ .
From Eq. (2.3-10), ${\phi }_{F}$ (substrate) is given as
$$
{\phi }_{F}\left( \text{ substrate }\right)  =  - {0.0259}\ln \left( \frac{3 \times  {10}^{16}}{{1.45} \times  {10}^{10}}\right)  =  - {0.377}\mathrm{\;V}
$$
The equilibrium electrostatic potential for the ${\mathrm{n}}^{ + }$ polysilicon gate is found from Eq. (2.3-11) as
$$
{\phi }_{F}\left( \text{ gate }\right)  = {0.0259}\ln \left( \frac{4 \times  {10}^{19}}{{1.45} \times  {10}^{10}}\right)  = {0.563}\mathrm{\;V}
$$
Equation (2.3-17) gives ${\phi }_{MS}$ as
$$
{\phi }_{F}\left( \text{ substrate }\right)  - {\phi }_{F}\left( \text{ gate }\right)  =  - {0.940}\mathrm{\;V}
$$
The oxide capacitance is given as
$$
{C}_{ox} = {\varepsilon }_{ox}/{t}_{ox} = \frac{{3.9} \times  {8.854} \times  {10}^{-{14}}}{{200} \times  {10}^{-8}} = {1.727} \times  {10}^{-7}\mathrm{\;F}/{\mathrm{{cm}}}^{2}
$$
The fixed charge in the depletion region, ${Q}_{b0}$ , is given by Eq. (2.3-15) as
$$
{Q}_{b0} =  - {\left( 2 \times  {1.6} \times  {10}^{-{19}} \times  {11.7} \times  {8.854} \times  {10}^{-{14}} \times  2 \times  {0.377} \times  3 \times  {10}^{16}\right) }^{1/2}
$$
$$
=  - {8.66} \times  {10}^{-8}\mathrm{C}/{\mathrm{{cm}}}^{2}
$$
Dividing ${Q}_{b0}$ by ${C}_{ox}$ gives $- {0.501}\mathrm{\;V}$ . Finally, ${Q}_{ss}/{C}_{ox}$ is given as
$$
\frac{{Q}_{ss}}{{C}_{ox}} = \frac{{10}^{10} \times  {1.60} \times  {10}^{-{19}}}{{1.727} \times  {10}^{-7}} = {9.3} \times  {10}^{-3}\mathrm{\;V}
$$
Substituting these values in Eq. (2.3-18) gives
$$
{V}_{T0} =  - {0.940} + {0.754} + {0.501} - {9.3} \times  {10}^{-3} = {0.306}\mathrm{\;V}
$$
The body factor is found from Eq. (2.3-21) as
$$
\gamma  = \frac{{\left( 2 \times  {1.6} \times  {10}^{-{19}} \times  {11.7} \times  {8.854} \times  {10}^{-{14}} \times  3 \times  {10}^{16}\right) }^{1/2}}{{1.727} \times  {10}^{-7}} = {0.577}{\mathrm{\;V}}^{1/2}
$$
The above example shows how the value of impurity concentrations can influence the threshold voltage. In fact, the threshold voltage can be set to any value by proper choice of the variables in Eq. (2.3-18). Standard practice is to implant the appropriate ions into the substrate in the channel region to adjust the threshold voltage to the desired value. If the opposite impurities are implanted in the channel region of the substrate, the threshold for an n-channel transistor can be made negative. This type of transistor is called a depletion transistor and can have current flow between the drain and source for zero volts between the gate and source.
When the channel is formed between the drain and source as illustrated in Fig. 2.3-3, a drain current ${i}_{D}$ can flow if a voltage ${v}_{DS}$ exists across the channel. The dependence of this drain current on the terminal voltages of the MOS transistor can be developed by considering the characteristics of an incremental length of the channel designated as ${dy}$ in Fig. 2.3-3. It is assumed that the width of the MOS transistor (into the page) is $W$ and that ${v}_{DS}$ is small. The charge per unit area in the channel, ${Q}_{I}\left( y\right)$ , can be expressed as
$$
{Q}_{I}\left( y\right)  = {C}_{ox}\left\lbrack  {{v}_{GS} - v\left( y\right)  - {V}_{T}}\right\rbrack   \tag{2.3-22}
$$
The resistance in the channel per unit of length ${dy}$ can be written as
$$
{dR} = \frac{dy}{{\mu }_{n}{Q}_{I}\left( y\right) W} \tag{2.3-23}
$$
where ${\mu }_{n}$ is the average mobility of the electrons in the channel. The voltage drop, referenced to the source, along the channel in the $y$ direction, is
$$
{dv}\left( y\right)  = {i}_{D}{dR} = \frac{{i}_{D}{dy}}{{\mu }_{n}{Q}_{I}\left( y\right) W} \tag{2.3-24}
$$
or
$$
{i}_{D}{dy} = W{\mu }_{n}{Q}_{I}\left( y\right) {dv}\left( y\right)  \tag{2.3-25}
$$
Integrating along the channel from $y = 0$ to $y = L$ gives
$$
{\int }_{0}^{L}{i}_{D}{dy} = {\int }_{0}^{{v}_{DS}}W{\mu }_{n}{Q}_{I}\left( y\right) {dv}\left( y\right)  = {\int }_{0}^{{v}_{DS}}W{\mu }_{n}{C}_{ox}\left\lbrack  {{v}_{GS} - v\left( y\right)  - {V}_{T}}\right\rbrack  {dv}\left( y\right)  \tag{2.3-26}
$$
Performing the integration results in the desired expression for ${i}_{D}$ as
$$
{i}_{D} = \frac{{\mu }_{n}{C}_{ox}W}{L}{\left\lbrack  \left( {v}_{GS} - {V}_{T}\right) v\left( y\right)  - \frac{v{\left( y\right) }^{2}}{2}\right\rbrack  }_{0}^{{v}_{DS}}
$$
$$
= \frac{{\mu }_{n}{C}_{ox}W}{L}\left\lbrack  {\left( {{v}_{GS} - {V}_{T}}\right) {v}_{DS} - \frac{{v}_{DS}^{2}}{2}}\right\rbrack   \tag{2.3-27}
$$
This equation is sometimes called the Sah equation [26] and has been used by Shichman and Hodges [27] as a model for computer simulation. Equation (2.3-27) is only valid when
$$
{v}_{GS} \geq  {V}_{T}\text{and}{v}_{DS} \leq  \left( {{v}_{GS} - {V}_{T}}\right)  \tag{2.3-28}
$$
and for values of $L$ greater than the minimum $L$ . The factor ${\mu }_{n}{C}_{ox}$ is often called the transconductance parameter, given as
$$
{K}^{\prime } = {\mu }_{n}{C}_{ox} = \frac{{\mu }_{n}{\varepsilon }_{ox}}{{t}_{ox}} \tag{2.3-29}
$$
Equation (2.3-28) will be examined in more detail in the next chapter, concerning the modeling of MOS transistors. The operation of the p-channel transistor is essentially the same as that of the n-channel transistor, except that all voltage and current polarities are reversed.

### 2.4 Passive Components
This section examines the passive components that are compatible with fabrication steps used to build the MOS device. These passive components include the capacitor and the resistor.
## Capacitors
A good capacitor is often required when designing analog integrated circuits. They are used as compensation capacitors in amplifier designs, as bandwidth-determining components in ${g}_{m}/C$ filters, as charge storage devices in switched-capacitor filters and digital-to-analog converters, and in other places as well. The desired characteristics for capacitors used in these applications are given below:
- Good matching accuracy
- Low voltage coefficient
- High ratio of desired capacitance to parasitic capacitance
- High capacitance per unit area
- Low temperature dependence
Analog CMOS processes differentiate themselves from purely digital ones by providing capacitors that meet the above criteria. For such analog processes, there are basically two types of capacitors made available, capacitors utilizing polysilicon for plates and capacitors utilizing metal for plates. Modern submicron processes ( ${0.18\mu }\mathrm{m}$ and below) use MiM (metal-insulator-metal) capacitors because they are economical to build (minimal masks, steps, and process complexity) and meet the criteria set forth above. Figure 2.4-1(a) shows an example of a MiM capacitor. It is formed by providing an additional metal layer prior to the last metal interconnect layer that lies above a thin oxide region on top of the next to last metal layer (i.e., a capacitor metal on top of M4, separated by a thin oxide region fabricated in a five-metal process). Typical performance for a MiM capacitor implemented in a ${0.18\mu }\mathrm{m}$ process is given in Table 2.4-1.
A second type of capacitor is illustrated in Fig. 2.4-1(b). This capacitor is constructed by putting an $\mathrm{n}$ -well underneath an $\mathrm{n}$ -channel transistor. The bottom plate (the $\mathrm{n}$ -well) of this capacitor has a much higher resistivity (as compared to a MiM bottom plate). Because of this fact, it is not used in circuits where a low voltage coefficient is important. It is, however, often used when one terminal of the capacitor is connected to ground. It offers a very high capacitance per unit area, it can be matched well, and it is available in all CMOS processes because no unique steps or masks are required. A conventional transistor can be used as a capacitor if properly biased in the inversion region and has similar performance to the capacitor illustrated in Fig. 2.4-1(b).

Figure 2.4-1 (a) MiM capacitor, (b) accumulation MOS capacitor.
Table 2.4-1 Approximate Performance Summary of Passive Components in a ${0.18\mu }\mathrm{m}$ CMOS Process
<table><tr><td>Component Type</td><td>Typical Value</td><td>Typical Matching Accuracy</td><td>Temperature Coefficient</td><td>Voltage Coefficient</td></tr><tr><td>MiM capacitor</td><td>${1.0}\mathrm{{fF}}/{\mathrm{{\mu m}}}^{2}$</td><td>0.03%</td><td>${50}\mathrm{{ppm}}/{}^{ \circ  }\mathrm{C}$</td><td>50 ppm/V</td></tr><tr><td>MOM capacitor</td><td>${0.17}\mathrm{{fF}}/{\mathrm{{\mu m}}}^{2}$</td><td>1%</td><td>${50}\mathrm{{ppm}}/{}^{ \circ  }\mathrm{C}$</td><td>50 ppm/V</td></tr><tr><td>${\mathrm{P}}^{ + }$ Diffused resistor (nonsilicide)</td><td>80-150 Ω/Ω</td><td>0.4%</td><td>1500 ppm/°C</td><td>200 ppm/V</td></tr><tr><td>${\mathrm{N}}^{ + }$ Diffused resistor (non-silicide)</td><td>${50} - {80}$ Ω/Ω</td><td>0.4%</td><td>1500 ppm/°C</td><td>200 ppm/V</td></tr><tr><td>${\mathrm{N}}^{ + }$ Poly resistor (non-silicide)</td><td>300 Ω/Ω</td><td>2%</td><td>$- {2000}\mathrm{{ppm}}/{}^{ \circ  }\mathrm{C}$</td><td>100 ppm/V</td></tr><tr><td>${\mathrm{P}}^{ + }$ Poly resistor (non-silicide) ${\mathrm{P}}^{ - }$ Poly resistor</td><td>300 Ω/Ω</td><td>0.5%</td><td>$- {500}\mathrm{{ppm}}/\mathrm{C}$</td><td>100 ppm/V</td></tr><tr><td>(non-silicide)</td><td>1000 Ω/Ω</td><td>0.5%</td><td>$- {1000}\mathrm{{ppm}}/{}^{ \circ  }\mathrm{C}$</td><td>100 ppm/V</td></tr><tr><td>n-well resistor</td><td>$1 - 2\mathrm{k}\Omega /\square$</td><td/><td>8000 ppm/℃</td><td>10k ppm/V</td></tr></table>
Quite often, the processing performance required by the digital component of a mixed-signal integrated circuit necessitates the use of a process targeted for digital applications. Such processes do not provide tailored capacitors for analog applications. Therefore, when a capacitor is needed, it must be derived from two or more of the existing interconnect layers. Capacitors constructed of only native metal layers are called ${MOM}$ (metal-oxide-metal) capacitors (or finger capacitors if constructed using interdigitated fingers). Figure 2.4-2 illustrates symbolically several schemes for making MOM capacitors using only metal layers available in a purely digital process. Figure 2.4-2(a) is a finger capacitor constructed vertically, taking advantage of both vertical and sidewall capacitance. This structure is very efficient because the vertical space between metal layers is greater than the allowed space between them (see Fig. 2.1-6). An example of a same-layer parallel-plate MOM capacitor is illustrated in Fig. 2.4-2(b). Compared to MiM capacitors, these capacitors typically suffer from lower per-unit-area capacitance and lower ratio of desired capacitance to parasitic capacitance; however, they generally have a higher $Q$ , which makes them the capacitor of choice for RF circuit applications. Matching accuracy of capacitors implemented like those in Fig 2.4-2 is on the order of $1 - 2\%$ and voltage coefficient is low. A typical value for a finger capacitor implemented in four metal layers is about ${0.2}\mathrm{{fF}}/\mu {\mathrm{m}}^{2}$ (depends greatly on layout).
The voltage coefficient of MiM and MOM capacitors is generally less than ${50}\mathrm{{ppm}}/\mathrm{V}$ and their temperature coefficient less than ${50}\mathrm{{ppm}}/{}^{ \circ  }\mathrm{C}$ . When considering the ratio of two capacitors on the same substrate, note that the variations on the absolute value of the capacitor due to temperature tend to cancel. Therefore, temperature variations have little effect on the matching accuracy of capacitors. When capacitors are switched to different voltages, as in the case of sampled-data circuits, their voltage coefficients can have a negative impact on performance if not kept to a minimum.

Figure 2.4-2 Various ways to implement capacitors using available interconnect layers illustrated symbolically: (a) interleaved finger capacitor, (b) horizontal parallel plate capacitor.
The parasitic capacitance associated with the capacitors of Figs. 2.4-1 and 2.4-2 can give rise to a significant source of error in analog sampled-data circuits. Figure 2.4-3 illustrates a general model for a capacitor with its top- and bottom-plate parasitics. These parasitic capacitances depend on the capacitor size, layout, and technology and are unavoidable.
The capacitor plate with the smallest parasitic associated with it is referred to as the top plate. It is not necessarily physically the top plate although quite often it is. The bottom plate is that plate having the larger parasitic capacitance associated with it. Schematically, the top plate is represented by the flat (straight) line in the capacitor symbol while the curved plate represents the bottom plate. For the MiM capacitor illustrated in Fig. 2.4-1(a) the parasitic capacitor associated with the top plate of the capacitor itself is due to interconnect lines leading to the capacitor and the bottom-plate parasitic capacitance is due to the capacitance between the bottom plate and the substrate or any intervening metal lines below the bottom plate. Parasitic bottom-plate capacitance of the MiM capacitor is minimized by constructing it in such a way so that there are no metal or polysilicon interconnects running below the bottom-plate metal. MOM capacitors available in a digital process and shown in Fig. 2.4-2 have parasitics that are not so easily generalized.

Figure 2.4-3 A model for the integrated capacitors showing top- and bottom-plate parasitics.
## Resistors
The other passive component compatible with MOS technology is the resistor. Even though we shall use circuits consisting of primarily MOS active devices and capacitors, some applications, such as digital-to-analog conversion, use resistors. Resistors compatible with the MOS technology of this section include diffused, polysilicon, and n-well resistors. Though not as common, metal can be used as a resistor as well.
To understand the dimensions that are important in accessing the performance of a resistor, it is necessary to review the relationship for the resistance of a conductive bar.
For a conductive bar of material as shown in Fig. 2.4-4, the resistance, $R$ , is given as
$$
R = \frac{\rho L}{A}\left( \Omega \right)  \tag{2.4-1}
$$
where $\rho$ is resistivity in $\Omega$ -cm and $A$ is a plane perpendicular to the direction of current flow. In terms of the dimensions given in Fig. 2.4-4, Eq. (2.4-1) can be rewritten as
$$
R = \frac{\rho L}{WT} \tag{2.4-2}
$$
(Ω)
Since the nominal values for $\rho$ and $T$ are generally fixed for a given process and material type, they are grouped together to form a new term ${\rho }_{s}$ called sheet resistivity. This is clarified by the following expression:
$$
R = \left( \frac{\rho }{T}\right) \frac{L}{W} = {\rho }_{\mathrm{s}}\frac{L}{W} \tag{2.4-3}
$$
(Ω)
It is conventional to give ${\rho }_{\mathrm{s}}$ the units of $\Omega /\square$ (read ohms per square). From the layout point of view, a resistor has the value determined by the number of squares of resistance multiplied by ${\rho }_{\mathrm{s}}$ .

Figure 2.4-4 Current flow in a conductive bar.
## Example 2.4-1 Resistance Calculation
Given a polysilicon resistor like that drawn in Fig. 2.4-4 with $W = {0.8\mu }\mathrm{m}$ and $L = {20\mu }\mathrm{m}$ , calculate ${\rho }_{\mathrm{s}}$ (in $\Omega /\square$ ), the number of squares of resistance, and the resistance value. Assume that $\rho$ for polysilicon is $9 \times  {10}^{-4}\Omega$ -cm and polysilicon is ${3000Å}$ thick. Ignore any contact resistance.
First calculate ${\rho }_{\mathrm{s}}$ .
$$
{\rho }_{\mathrm{s}} = \frac{\rho }{T} = \frac{9 \times  {10}^{-4}\Omega  - \mathrm{{cm}}}{{3000} \times  {10}^{-8}\mathrm{\;{cm}}} = {30\Omega }/\square
$$
The number of squares of resistance, $\mathrm{N}$ , is
$$
N = \frac{L}{W} = \frac{{20\mu }\mathrm{m}}{{0.8\mu }\mathrm{m}} = {25}
$$
giving the total resistance as
$$
R = {\rho }_{\mathrm{s}} \times  N = {30} \times  {25} = {750\Omega }
$$
Figure 2.4-5(a) illustrates a ${\mathrm{p}}^{ + }$ diffusion resistor. It is formed using source/drain diffusion in an n-well. The sheet resistance of such resistors in a nonsilicide process is usually in the range of ${50} - {150\Omega }/\square$ . For a silicide process, these resistors are in the range of $5 - {15\Omega }/\square$ . The fact that the source/drain diffusion is needed as a good conductor (i.e., as interconnect) in integrated circuits conflicts with its use as a resistor. Clearly the goal of a silicide process is to achieve "interconnect-like" performance from source/drain diffusion. In these processes, a silicide block can be used to mask the titanium film from forming a silicide, thus allowing for a high-resistance source/drain diffusion where desired. The diffused resistor is found to have a voltage coefficient of resistance in the 100-500 ppm/V range. The parasitic capacitance to ground is also voltage dependent in this type of resistor. Figure 2.4-5(b) shows an example of an n-well resistor. n-Well resistors have much higher resistivity (on the order of ${1000\Omega }/\square$ ) and a high-voltage coefficient. In cases where accuracy is not required, such as pull-up resistors, or protection resistors, this structure is very useful.
Polysilicon makes an excellent choice for use as a resistor because it is least affected by voltage coefficient and parasitic capacitance. Polysilicon also offers very good matching performance. A polysilicon resistor is shown in Fig. 2.4-6(a) where a silicide block was not implemented. Resistance for a polysilicide resistor is on the order of of 5-15 $\Omega$ / $\square$ . Nonsilicided polysilicon resistors have a sheet resistance in the range of ${30} - {200\Omega }/\square$ depending on doping levels. As noted earlier, an additional mask is generally required to allow for selective doping of the polysilicon resistor to achieve a useful resistivity.
Other types of resistors are possible if the process is altered. The three categories above represent those most commonly applied with standard MOS technology. Table 2.4-1 summarizes the characteristics of the passive components presented.
---
Example 2.4-1
---

Figure 2.4-5 Resistors: (a) diffusion, (b) n-well.

Figure 2.4-6 Polysilicon resistors: (a) without silicide block, (b) with silicide block.

### 2.5 Other Considerations of CMOS Technology
In the previous two sections, the active and passive components of the basic CMOS process have been introduced. In this section we wish to consider some other components that are also available in the basic CMOS process but that are not used as extensively. We will further consider some of the limitations of CMOS technology, including latch-up, temperature, and noise. This information will become useful later, when the performance of CMOS circuits is characterized.
So far we have seen that it is possible to make resistors, capacitors, and pn diodes that are compatible with the basic twin-well CMOS fabrication process illustrated in Fig. 2.3-1. It is also possible to implement a bipolar junction transistor (BJT) that is compatible with this process, even though the collector terminal is constrained to ground (for an n-well process). Figure 2.5-1 shows how the BJT is implemented for an n-well process. The emitter is the source/drain diffusion, the base is the n-well (with a base width of ${w}_{B}$ ), and the ${\mathrm{p}}^{ - }$ substrate is the collector. Because the pn junction between the n-well and the ${\mathrm{p}}^{ - }$ substrate must be reverse biased, the collector must always be connected to the most negative power-supply voltage (typically ground). The BJT will still find many useful applications even though the collector is constrained to ground. The BJT illustrated in Fig. 2.5-1 is often referred to as a substrate BJT. The substrate BJT functions like the BJT fabricated in a process designed for BJTs. The only difference is that the collector terminal is constrained and the base width is not well controlled, resulting in a wide variation of (and typically not very high) current gains.
Figure 2.5-2 shows the minority-carrier concentrations in the BJT. Normally, the base-emitter(BE)pn junction is forward biased and the collector-base(CB)pn junction is reverse biased. The forward-biased ${BE}$ junction causes free holes to be injected into the base region. If the base width ${w}_{B}$ is small, most of these holes reach the ${CB}$ junction and are swept into the collector by the reverse-bias voltage. If the minority-carrier concentrations are much less than the majority-carrier concentrations, then the collector current can be found by solving for the current in the base region. In terms of current densities, the collector current density is
$$
{JC} =  - {\left. {J}_{p}\right| }_{\text{base }} =  - q{D}_{p}\frac{d{p}_{n}\left( x\right) }{dx} = q{D}_{p}\frac{{p}_{n}\left( 0\right) }{{w}_{B}} \tag{2.5-1}
$$
From Eq. (2.2-16) we can write
$$
{p}_{n}\left( 0\right)  = {p}_{n0}\exp \left( \frac{{v}_{EB}}{{V}_{t}}\right)  \tag{2.5-2}
$$
Combining Eqs. (2.5-1) and (2.5-2) and multiplying by the area of the ${BE}$ junction $A$ gives the collector current as
$$
{i}_{C} = A{J}_{C} = \frac{{qA}{D}_{p}{p}_{n0}}{{w}_{B}}\exp \left( \frac{{v}_{EB}}{{V}_{t}}\right)  = {I}_{s}\exp \left( \frac{{v}_{EB}}{{V}_{t}}\right)  \tag{2.5-3}
$$
where ${I}_{s}$ is defined as
$$
{I}_{s} = \frac{{qA}{D}_{p}{p}_{n0}}{{w}_{B}} \tag{2.5-4}
$$
As the holes travel through the base, a small fraction will recombine with electrons, which are the majority carriers in the base. As this occurs, an equal number of electrons must enter the base from the external base circuit in order to maintain electrical neutrality in the base region. Also, there will be injection of the electrons from the base to the emitter due to the forward-biased ${BE}$ junction. This injection is much smaller than the hole injection from the emitter because the emitter is more heavily doped than the base. The injection of electrons into the emitter and the recombination of electrons with holes in the base both constitute the external base current ${i}_{B}$ that flows out of the base. The ratio of collector current to base current, ${i}_{C}/{i}_{B}$ , is defined as ${\beta }_{F}$ or the common-emitter current gain. Thus, the base current is expressed as
$$
{i}_{B} = \frac{{i}_{C}}{{\beta }_{F}} = \frac{{I}_{s}}{{\beta }_{F}}\exp \left( \frac{{v}_{EB}}{{V}_{t}}\right)  \tag{2.5-5}
$$

Figure 2.5-2 Minority-carrier concentrations for a bipolar junction transistor.
The emitter current can be found from the base current and the collector current because the sum of all three currents must equal zero. Although ${\beta }_{F}$ has been assumed constant it varies with ${i}_{C}$ , having a maximum for moderate currents and falling off from this value for large or small currents.
In addition to the substrate BJT, it is also possible to have a lateral BJT. Figure 2.3-1 can be used to show how the lateral BJT can be implemented. The emitter could be the ${\mathrm{n}}^{ + }$ source of the n-channel device, the base the ${\mathrm{p}}^{ - }$ substrate, and the collector the n-well. Although the base is constrained to the substrate potential of the chip, the emitter and collector can have arbitrary voltages. Unfortunately, the lateral BJT is not very useful because of the large base width. In fact, the lateral BJT is considered more as a parasitic transistor. However, this lateral BJT becomes important in understanding the problem of latch-up of CMOS circuits [29].
Device dimensions in submicron technologies are so small that they are sensitive to relatively small amounts of excess voltage or current. The amount of current or voltage causing damage can vary based on many factors. Whenever damage has occurred due to excess current or voltage, it is said that the circuit has experienced electrical overstress (EOS) or an EOS event. The first type of EOS event to be discussed is latch-up.
Latch-up in integrated circuits may be defined as a high-current state accompanied by a collapsing of the voltage supplying the circuit. Latch-up can cause irreversible electrical damage. Upon application of a radiation transient or certain electrical excitations, the latched or high-current state can be triggered. Latch-up in CMOS circuits is almost exclusively due to the triggering of a PNPN structure resembling a silicon-controlled rectifier (SCR). Such structures are native to the CMOS process and thus must be understood so that techniques can be applied to minimize the possibility of triggering with the accompanying damage that results.
Figure 2.5-3(a) shows a cross section of Fig. 2.3-1 and how the PNPN SCR is formed. The schematic equivalent of Fig. 2.5-3(a) is given in Fig. 2.5-3(b). Here the SCR action is clearly illustrated. The resistor ${R}_{N}{}^{ - }$ is the n-well resistance from the base of the vertical ${PNP}$ (Q2) to ${V}_{DD}$ . The resistor ${R}_{P}{}^{ - }$ is the substrate resistance from the base of the lateral ${NPN}\left( {Q2}\right)$ to ground.

Figure 2.5-3 (a) Parasitic lateral NPN and vertical PNP bipolar transistor in CMOS integrated circuits. (b) Equivalent circuit of the SCR formed from the parasitic bipolar transistors.

Figure 2.5-4 Preventing latch-up using guard bars in an n-well technology.
Regeneration occurs when three conditions are satisfied. The first condition is that the loop gain must exceed unity. This condition is stated as
$$
{\beta }_{NPN}{\beta }_{PNP} \geq  1 \tag{2.5-6}
$$
where ${\beta }_{NPN}$ and ${\beta }_{PNP}$ are the common-emitter, current-gain ratios of Q2 and Q1, respectively. The second condition occurs when both of the base-emitter junctions become forward biased. The third condition is enabled when the circuits connected to the emitter are capable of sinking and sourcing a current greater than the holding current of the PNPN device.
To prevent latch-up, several standard techniques should be applied by the designer. One is to keep the source/drain of the n-channel device as far away from the n-well as possible. This reduces the value of ${\beta }_{NPN}$ and helps to prevent latch-up. Unfortunately, this is very costly in terms of area. A second approach is to reduce the values of ${R}_{N}{}^{ - }$ and ${R}_{P}{}^{ - }$ . Smaller resistor values are helpful because more current must flow through them in order to forward bias the base-emitter regions of Q1 and Q2. These resistances can be reduced by surrounding the p-channel devices with an ${\mathrm{n}}^{ + }$ guard ring connected to ${V}_{DD}$ and by surrounding n-channel transistors with ${\mathrm{p}}^{ + }$ guard rings tied to ground as shown in Fig. 2.5-4.
Latch-up can also be prevented by keeping the potential of the source/drain of the p-channel device [A in Fig. 2.5-3(b)] from being higher than ${V}_{DD}$ or the potential of the source/drain of the n-channel device [B in Fig. 2.5-3(b)] from going below ground. By careful design and layout, latch-up can be avoided in most cases. In the design of various circuits, particularly those that have high currents, one must use care to avoid circuit conditions that will initiate latch-up.
Another type of EOS event that must be considered is an electrostatic discharge (ESD). An ESD event occurs when a very high voltage (several thousand volts) appears across the pins of an integrated circuit. This can occur when a circuit is handled by a person who has built up a large static charge as a result of, for example, walking across a carpeted floor. When the person touches the circuit and a discharge path exists through the circuit, circuit components can be damaged. Thin gate oxides of input transistors are particularly vulnerable. Protection of the gates of these transistors, which are externally accessible, is the goal of an ESD protection methodology/circuit. The simplest structure to prevent accidental destruction of the gate oxide is a resistor and two reverse-biased pn junction diodes forming an input protection circuit. One of the diodes is connected with the cathode to the highest circuit potential $\left( {V}_{DD}\right)$ and the anode side to the gate to be protected. The other diode is connected with the cathode to the gate to be protected and the anode to the lowest circuit potential (ground). This is illustrated in Fig. 2.5-5. For an n-well process, the first diode is usually made by a ${\mathrm{p}}^{ + }$ diffusion into the n-well. The second diode is made by an ${\mathrm{n}}^{ + }$ diffusion into the substrate. The resistor is connected between the external contact and the junction between the diodes and the gate to be protected. If a large voltage is applied to the input, one of the diodes will break down depending on the polarity of the voltage. If the resistor is large enough, it will limit the breakdown current so that the diode is not destroyed. This circuit should be used whenever the gates of a transistor (or transistors) are taken to external circuits.
The topic of ESD protection is considerably broader than the previous paragraph might imply. More complex protection circuits as well as consideration for total integrated circuit topology and interconnect must generally be taken into account to achieve optimal protection. When a designer arrives at the pins of an integrated circuit, he should consult the design guidelines for the process being used (generally provided by the fabrication vendor/company). Quite often, I/O cells are carefully engineered and are available to the designer as standard cells. In this way, the complexities of ESD protection need not be understood (only appreciated) by the designer, in general.
The temperature dependence of MOS components is an important performance characteristic in analog circuit design. The temperature behavior of passive components is usually expressed in terms of a fractional temperature coefficient, $T{C}_{F}$ , defined as
$$
T{C}_{F} = \frac{1}{X} \cdot  \frac{dX}{dT} \tag{2.5-7}
$$
where $X$ can be the resistance or capacitance of the passive component. Generally, the fractional temperature coefficient is multiplied by ${10}^{6}$ and expressed in units of parts per million per ${}^{ \circ  }\mathrm{C}$ , or ppm $/{}^{ \circ  }\mathrm{C}$ . The fractional temperature coefficient of various CMOS passive components has been given in Table 2.4-1.

Figure 2.5-5 Electrostatic discharge protection circuitry. (a) Electrical equivalent circuit. (b) Implementation in CMOS technology.
The temperature dependence of the MOS device can be found from the expression for drain current given in Eq. (2.3-27). The primary temperature-dependent parameters are the mobility $\mu$ and the threshold voltage ${V}_{T}$ . The temperature dependence of the carrier mobility $\mu$ is given as [28]
$$
\mu  = {K}_{\mu }{T}^{-{1.5}} \tag{2.5-8}
$$
The temperature dependence of the threshold voltage can be approximated by the following expression [29]:
$$
{V}_{T}\left( T\right)  = {V}_{T}\left( {T}_{0}\right)  - \alpha \left( {T - {T}_{0}}\right)  \tag{2.5-9}
$$
where $\alpha$ is approximately ${2.3}\mathrm{\;{mV}}/{}^{ \circ  }\mathrm{C}$ . This expression is valid over the range of ${200} - {400}\mathrm{\;K}$ , with $\alpha$ depending on the substrate doping level and the dosages of the implants used during fabrication. These expressions for the temperature dependence of mobility and threshold voltage will be used later to determine the temperature performance of MOS circuits and are valid only for limited ranges of temperature variation about room temperature. Other modifications are necessary for extreme temperature ranges.
The temperature dependence of the pn junction is also important in this study. For example, the pn-junction diode can be used to create a reference voltage whose temperature stability will depend on the temperature characteristics of the pn-junction diode. We shall consider the reverse-biased pn-junction diode first. Equation (2.2-24) shows that when ${v}_{D} < 0$ , the diode current is given as
$$
- {i}_{D} \cong  {I}_{s} = {qA}\left\lbrack  {\frac{{D}_{p}{p}_{n0}}{{L}_{p}} + \frac{{D}_{n}{n}_{p0}}{{L}_{n}}}\right\rbrack   \cong  \frac{qAD}{L}\frac{{n}_{i}^{2}}{N} = K{T}^{3}\exp \left( \frac{-{V}_{G0}}{{V}_{t}}\right)  \tag{2.5-10}
$$
where it has been assumed that one of the terms in the brackets is dominant and that $L$ and $N$ correspond to the diffusion length and impurity concentration of the dominant term. Also, $T$ is the absolute temperature in kelvin and ${V}_{G0}$ is the bandgap voltage of silicon at ${300}\mathrm{\;K}$ (1.205V). Differentiating Eq. (2.5-10) with respect to $T$ results in
$$
\frac{d{I}_{s}}{dT} = \frac{{3K}{T}^{3}}{T}\exp \left( \frac{-{V}_{G0}}{{V}_{t}}\right)  + \frac{{qK}{T}^{3}{V}_{G0}}{K{T}^{2}}\exp \left( \frac{-{V}_{G0}}{{V}_{t}}\right)  = \frac{3{I}_{s}}{T} + \frac{{I}_{s}}{T}\frac{{V}_{G0}}{{V}_{t}} \tag{2.5-11}
$$
The $T{C}_{\mathrm{F}}$ for the reverse diode current can be expressed as
$$
\frac{1}{{I}_{s}}\frac{d{I}_{s}}{dT} = \frac{3}{T} + \frac{1}{T}\frac{{V}_{G0}}{{V}_{t}} \tag{2.5-12}
$$
The reverse diode current is seen to double approximately every $5{}^{ \circ  }\mathrm{C}$ increase as illustrated in the following example.
## Calculation of the Reverse Diode Current Temperature Dependence and $T{C}_{F}$
Assume that the temperature is ${300}\mathrm{\;K}$ (room temperature) and calculate the reverse diode current change and the $T{C}_{F}$ for a $5\mathrm{\;K}$ increase.
The $T{C}_{F}$ can be calculated from Eq. (2.5-12) as
$$
T{C}_{F} = {0.01} + {0.155} = {0.165}
$$
Since the $T{C}_{F}$ is change per degree, the reverse current will increase by a factor of 1.165 for every kelvin (or ${}^{ \circ  }\mathrm{C}$ ) change in temperature. Multiplying by 1.165 five times gives an increase of approximately 2. This implies that the reverse saturation current will approximately double for every ${5}^{ \circ  }\mathrm{C}$ temperature increase. Experimentally, the reverse current doubles for every $8{}^{ \circ  }\mathrm{C}$ increase in temperature because the reverse current is in part leakage current.
The forward-biased pn-junction diode current is given by
$$
{i}_{D} \cong  {I}_{s}\exp \left( \frac{{v}_{D}}{{V}_{t}}\right)  \tag{2.5-13}
$$
Differentiating this expression with respect to temperature and assuming that the diode voltage is a constant $\left( {{v}_{D} = {v}_{D}}\right)$ gives
$$
\frac{d{i}_{D}}{dT} = \frac{{i}_{D}}{{I}_{s}} \cdot  \frac{d{I}_{s}}{dT} - \frac{1}{T} \cdot  \frac{{V}_{D}}{{V}_{t}}{i}_{D} \tag{2.5-14}
$$
The fractional temperature coefficient for ${i}_{D}$ results from Eq. (2.5-14) as
$$
\frac{1}{{i}_{D}} \cdot  \frac{d{i}_{D}}{dT} = \frac{1}{{I}_{s}} \cdot  \frac{d{I}_{s}}{dT} - \frac{{V}_{D}}{T{V}_{t}} = \frac{3}{T} + \left( \frac{{V}_{G0} - {V}_{D}}{T{V}_{t}}\right)  \tag{2.5-15}
$$
If ${v}_{D}$ is assumed to be 0.6 volts, then the fractional temperature coefficient is equal to ${0.01} + \left( {{0.155} - {0.077}}\right)  = {0.0879}$ . It can be seen that the forward diode current will double for approximately a ${10}^{ \circ  }\mathrm{C}$ increase in temperature.
The above analysis for the forward-biased pn-junction diode assumed that the diode voltage ${v}_{D}$ was held constant. If the forward current is held constant $\left( {{i}_{D} = {I}_{D}}\right)$ , then the fractional temperature coefficient of the forward diode voltage can be found. From Eq. (2.5-13) we can solve for ${v}_{D}$ to get
$$
{v}_{D} = {V}_{t}\ln \left( \frac{{I}_{D}}{{I}_{s}}\right)  \tag{2.5-16}
$$
Differentiating Eq. (2.5-16) with respect to temperature gives
$$
\frac{d{v}_{D}}{dT} = \frac{{v}_{D}}{T} - {V}_{t}\left( {\frac{1}{{I}_{s}} \cdot  \frac{d{I}_{s}}{dT}}\right)  = \frac{{v}_{D}}{T} - \frac{3{V}_{t}}{T} - \frac{{V}_{G0}}{T} =  - \left( \frac{{V}_{G0} - {v}_{D}}{T}\right)  - \frac{3{V}_{t}}{T} \tag{2.5-17}
$$
Assuming that ${v}_{D} = {v}_{D} = {0.6}\mathrm{\;V}$ , the temperature dependence of the forward diode voltage at room temperature is approximately $- {2.3}\mathrm{{mV}}/{}^{ \circ  }\mathrm{C}$ .
---
Example 2.5-1
---
Another limitation of CMOS components is noise. Noise is a phenomenon caused by small fluctuations of the analog signal within the components themselves. Noise results from the fact that electrical charge is not continuous but the result of quantized behavior and is associated with the fundamental processes in a semiconductor component. In essence, noise acts like a random variable and is often treated as one. Our objective is to introduce the basic concepts concerning noise in CMOS components. More detail can be found in several excellent references $\left\lbrack  {{23},{30}}\right\rbrack$ .
Several sources of noise are important in CMOS components. Shot noise is associated with the dc current flow across a pn junction. It typically has the form of
$$
{i}_{n}^{2} = {2q}{I}_{D}{\Delta f}\;\left( {\text{ amperes }}^{2}\right)  \tag{2.5-18}
$$
where ${i}_{n}^{2}$ is the mean-square value of the noise current, $q$ is the charge of an electron, ${I}_{D}$ is the average dc current of the pn junction, and ${\Delta f}$ is the bandwidth in Hertz. Noise-current spectral density can be found by dividing ${i}_{n}^{2}$ by ${\Delta f}$ . The noise-current spectral density is denoted as ${i}_{n}^{2}/{\Delta f}$ .
Another source of noise, called thermal noise, is due to random thermal motion of the electron and is independent of the dc current flowing in the component. It generally has the form of
$$
{e}_{n}^{2} = {4kTR\Delta f} \tag{2.5-19}
$$
where $k$ is Boltzmann’s constant and $R$ is the resistor or equivalent resistor in which the thermal noise is occurring.
An important source of noise for MOS components is the flicker noise or the 1/f noise. This noise is associated with carrier traps in semiconductors, which capture and release carriers in a random manner. The time constants associated with this process give rise to a noise signal with energy concentrated at low frequency. The typical form of the $1/f$ noise is given as
$$
{i}_{n}^{2} = {K}_{f}\left( \frac{{I}^{a}}{{f}^{b}}\right) {\Delta f} \tag{2.5-20}
$$
where ${K}_{f}$ is a constant, $a$ is a constant (0.5-2), and $b$ is a constant ( $\cong  1$ ). The current-noise spectral density for typical $1/f$ noise is shown in Fig. 2.5-6. Other sources of noise exist, such as burst noise and avalanche noise, but are not important in CMOS components and are not discussed here.
Noise power Figure 2.5-6 1/f noise spectrum. spectral density

### 2.6 Summary
This chapter has introduced CMOS technology from the viewpoint of its use to implement analog circuits. The basic semiconductor fabrication processes were described in order to understand the fundamental elements of this technology. The basic fabrication steps include diffusion, implantation, deposition, etching, and oxide growth. These steps are implemented by the use of photolithographic methods, which limit the processing steps to certain physical areas of the silicon wafer. The basic processing steps needed to implement a typical twin-well, STI, silicon-gate CMOS process were described next.
The pn junction was reviewed following the introduction to CMOS technology because it plays an important role in all semiconductor devices. This review examined a step pn junction and developed the physical dimensions, the depletion capacitance, and the voltage-current characteristics of the pn junction. Next, the MOS transistor was introduced and characterized with respect to its behavior. It was shown how the channel between the source and drain is formed and the influence of the gate voltage on this channel was discussed. The MOS transistor is physically a very simple component.
A discussion of the passive components available in CMOS technology followed. These components include only resistors and capacitors. The various ways to implement these along with their merits were discussed.
The next section presented further considerations of CMOS technology. These included the substrate and lateral BJTs compatible with the CMOS process; electrical overstress and means for protecting against it; the temperature dependence of CMOS components; and the noise sources in these components.
Support material for this chapter covers the topic of device layout and is presented in Appendix B.
## Problems (refer to Appendix B for problems on layout)
2.1-1. List the five basic MOS fabrication processing steps and give the purpose or function of each step.
2.1-2. What is the difference between positive and negative photoresist and how is photoresist used?
2.1-3. Consider a mask that is opaque everywhere except for a transparent circle in the center. Metal is deposited on a substrate followed by an application of negative photoresist which is patterned with the mask described. After exposure, developing, and subsequent etching, what will remain?
2.1-4. Illustrate the impact on source and drain diffusions of a ${7}^{ \circ  }$ angle off-perpendicular ion implant. Assume that the thickness of polysilicon is ${8000Å}$ and that outdiffusion from point of ion impact is ${0.07\mu }\mathrm{m}$ .
2.1-5. Given the process flow described in Section 2.1 , would it be possible to create a structure with polysilicon on top of a heavily doped diffusion separated by a thin oxide? Why or why not? Explain.
2.2-1. Repeat Example 2.2-1 if the applied voltage is $- 2\mathrm{\;V}$ .
2.2-2. Develop Eq. (2.2-9) using Eqs. (2.2-1), (2.2-7), and (2.2-8) of the same section.
2.2-3. Redevelop Eqs. (2.2-7) and (2.2-8) if the impurity concentration of a pn junction is given by Fig. 2.2-2 rather than the step junction of Fig. 2.2-1(b).
2.2-4. Plot the normalized reverse current, ${i}_{RA}/{i}_{R}$ , versus the reverse voltage ${v}_{R}$ of a silicon pn diode that has ${BV} = {12}\mathrm{\;V}$ and $n = 6$ .
2.2-5. What is the breakdown voltage of a pn junction with ${N}_{A} = {N}_{D} = {10}^{16}/{\mathrm{{cm}}}^{3}$ ?
2.2-6. What change in ${v}_{D}$ of a silicon pn diode will cause an increase of 10 (an order of magnitude) in the forward diode current?
2.3-1. Explain in your own words why the magnitude of the threshold voltage in Eq. (2.3-19) increases as the magnitude of the source-bulk voltage increases. (The source-bulk pn diode remains reverse biased.)
2.3-2. If ${V}_{SB} = 2\mathrm{\;V}$ , find the value of ${V}_{T}$ for the $\mathrm{n}$ - channel transistor of Example 2.3-1.
2.3-3. Rederive Eq. (2.3-27) given that ${V}_{T}$ is not constant in Eq. (2.3-22) but rather varies linearly with $v\left( y\right)$ according to the following equation:
$$
{V}_{T} = {V}_{T0} + {\alpha v}\left( y\right)
$$
2.3-4. If the mobility of an electron is ${500}{\mathrm{\;{cm}}}^{2}$ / $\left( {\mathrm{V} \cdot  \mathrm{s}}\right)$ and the mobility of a hole is ${200}{\mathrm{\;{cm}}}^{2}/$ $\left( {\mathrm{V} \cdot  \mathrm{s}}\right)$ , compare the performance of an n-channel with a p-channel transistor. In particular, consider the value of the transconductance parameter and speed of the MOS transistor.
2.3-5. Using Example 2.3-1 as a starting point, calculate the difference in threshold voltage between two devices whose gate oxide is different by $5\%$ (i.e., ${t}_{ox} = {210Å}$ ).
2.3-6. Repeat Example 2.3-1 using ${N}_{A} = 7 \times  {10}^{16}$ ${\mathrm{{cm}}}^{-3}$ , gate doping, ${N}_{D} = 1 \times  {10}^{19}{\mathrm{\;{cm}}}^{-3}$ .
2.4-1. If a capacitor is needed to shunt high-frequency signals from an internal signal node to ground, which of the two capacitors illustrated in Fig. 2.4-1 would be best suited and why? Assume that both capacitors have the same capacitance per unit area.
2.4-2. A simple first-order filter shown in Fig. P2.4-2 is to be built with a polysilicon resistor and an MOS capacitor. The polysilicon resistor has a sheet resistance of ${50\Omega }$ /sq. $\pm$ ${30}\%$ and is ${5\mu }\mathrm{m}$ wide. The MOS capacitor is $2\mathrm{{fF}}/{\mathrm{{\mu m}}}^{2} \pm  {10}\%$ . The $- 3\mathrm{\;{dB}}$ frequency of the low-pass filter is $1\mathrm{{MHz}}$ . (a) Choose the size of the resistor (the number of squares, $N$ ) to minimize the total area of the filter including both the resistor and the capacitor. Find the area of the resistor and the capacitor in $\mu {\mathrm{m}}^{2}$ and their values. (b)
Using the worst-case tolerance of the resistor and capacitor, find the maximum and minimum $- 3\mathrm{\;{dB}}$ frequencies.

2.4-3. List two sources of error that can make the actual capacitor, fabricated using a CMOS process, differ from its designed value.
2.4-4. The capacitor shown in Fig. 2.4-1(a) has, in addition to the desired capacitance between the top and bottom plates, a capacitance between Metal 4 and Metal 5. Illustrate (sketch) a way to make such a capacitor, minimizing this additional capacitance due to M5-M4. For this problem, draw a square capacitor and use relative dimensions.
2.4-5. Consider the circuit in Fig. P2.4-5. Resistor ${R}_{1}$ is an $\mathrm{n}$ -well resistor with a nominal value of ${10}\mathrm{k}\Omega$ when the voltage at both terminals is ${2.5}\mathrm{\;V}$ . The input voltage, ${v}_{in}$ , is ${2.5}\mathrm{\;V}$ . Under these conditions, the value of ${R}_{1}$ is given as
$$
{R}_{1} = {R}_{\text{nom }}\left\lbrack  {1 + K\left( \frac{{v}_{\text{in }} + {v}_{\text{out }}}{2}\right) }\right\rbrack
$$
where ${R}_{\text{nom }}$ is ${10}\mathrm{\;K}$ and the coefficient $K$ is the voltage coefficient of an $\mathrm{n}$ -well resistor and has a value of ${20}\mathrm{\;K}$ ppm/V. Resistor ${R}_{2}$ is an ideal resistor with a value of ${10}\mathrm{k}\Omega$ . Calculate the value for ${v}_{\text{out }}$ .

2.4-6. Repeat Problem 2.4-5 using a ${\mathrm{n}}^{ + }$ diffused resistor for ${R}_{1}$ . Assume that a ${\mathrm{n}}^{ + }$ resistor’s voltage coefficient is ${200}\mathrm{{ppm}}/\mathrm{V}$ .
2.4-7. Consider Problem 2.4-6 again but assume 2.4-8. Given the polysilicon resistor in Fig. P2.4-8 that the n-well in which ${R}_{1}$ lies is not con- with a resistivity of $\rho  = 4 \times  {10}^{-3}\Omega$ -cm, nected to a 5 volt supply, but rather is con- calculate the resistance of the structure. nected as shown in Fig. P2.4-7. What effect Consider only the resistance defined by the does the n-well have on the voltage depend- silicide block. ency of the diffused resistor?

Figure P2.4-8
2.5-1. Assume ${v}_{D} = {0.7}\mathrm{\;V}$ and find the fractional temperature coefficient of ${I}_{s}$ and ${v}_{D}$ .
2.5-2. Plot the noise voltage as a function of the frequency if the thermal noise is ${100}\mathrm{{nV}}/\mathrm{{VHz}}$ and the junction of the $1/f$ and thermal noise (the $1/f$ noise corner) is 10,000 Hz.
Refer to Appendix B for the following problems.
A-1. Given that you wish to match two transistors having a $W/L$ of ${40\mu }\mathrm{m}/{0.3\mu }\mathrm{m}$ each, sketch the layout of these two transistors to achieve the best possible matching.
A-2. Assume that the edge variation of the top plate of a capacitor is ${0.05\mu }\mathrm{m}$ and that capacitor top plates are to be laid out as squares. It is desired to match two equal capacitors to an accuracy of ${0.1}\%$ . Assume that there is no variation in oxide thickness. How large would the capacitors have to be to achieve this matching accuracy?
A-3. Show that a circular geometry minimizes the perimeter-to-area ratio for a given area requirement. In your proof, compare against a rectangle and square.
A-4. Show analytically how the Yiannoulos-path technique illustrated in Fig. A-5 maintains a constant area-to-perimeter ratio with nonin-teger ratios.
A-5. Design an optimal layout of a matched pair of transistors whose $W/L$ is ${16\mu }\mathrm{m}/{0.5\mu }\mathrm{m}$ . The matching should be a photolithographic invariant as well as a common centroid.
A-6. Figure PA-6 illustrates various ways to implement the layout of a resistor divider. Choose the layout that BEST achieves the goal of a 2:1 ratio. Explain why the other choices are not optimal.

Figure PA-6
1. Y. P. Tsividis and P. R. Gray, "A Segmented μ255 Law PCM Voice Encoder Utilizing NMOS Technology," IEEE J. Solid-State Circuits, Vol. SC-11, pp. 740-747, Dec. 1976.
2. B. Fotohouhi and D. A. Hodges, "High-Resolution A/D Conversion in MOS/LSI," IEEE J. Solid-State Circuits, Vol. SC- 14, pp. 920-926, Dec. 1979.
3. J. T. Caves, C. H. Chan, S. D. Rosenbaum, L. P. Sellers, and J. B. Terry, "A PCM Voice Codec with On-Chip Filters," IEEE J. Solid-State Circuits, Vol. SC-14, pp. 65-73, Feb. 1979.
4. Y. P. Tsividis and P. R. Gray, "An Integrated NMOS Operational Amplifier with Internal Compensation," IEEE J. Solid-State Circuits, Vol. SC-11, pp. 748-754, Dec. 1976.
5. B. K. Ahuja, P. R. Gray, W. M. Baxter, and G. T. Uehara, "A Programmable CMOS Dual Channel Interface Processor for Telecommunications Applications," IEEE J. Solid-State Circuits, Vol. SC-19, pp. 892-899, Dec. 1984.
6. H. Shirasu, M. Shibukawa, E. Amada, Y. Hasegawa, F. Fujii, K. Yasunari, and Y. Toba, "A CMOS SLIC with a Automatic Balancing Hybrid," IEEE J. Solid-State Circuits, Vol. SC-18, pp. 678-684, Dec. 1983.
7. A. S. Grove, Physics and Technology of Semiconductor Devices. New York: John Wiley & Sons, 1967.
8. R. S. Muller and T. I. Kamins, Device Electronics for Integrated Circuits. New York: John Wiley & Sons, 1977.
9. S. Wolf and R. N. Tauber, Silicon Processing for the VLSI Era, Vol. 1: Process Technology. Sunset Beach, CA: Lattice Press, 1986, pp. 5-11.
10. S. Wolf and R. N. Tauber, Silicon Processing for the VLSI Era, Vol. 1: Process Technology. Sunset Beach, CA: Lattice Press, 1986, p. 27.
11.J. C. Irvin, "Resistivity of Bulk Silicon and Diffused Layers in Silicon," Bell Syst. Technical J., Vol. 41, pp. 387-410, Mar. 1962.
12. D. G. Ong, Modern MOS Technology-Processes, Devices, & Design. New York: McGraw-Hill, 1984, Chap. 8.
13. D. J. Hamilton and W. G. Howard, Basic Integrated Circuit Engineering. New York: McGraw-Hill, 1975, Chap. 2.
14.D. H. Lee and J. W. Mayer, "Ion Implanted Semiconductor Devices," Proceedings of IEEE, pp. 1241-1255, Sept. 1974.
15. J. F. Gibbons, "Ion Implantation in Semiconductors," Proceedings of IEEE, Part I, Vol. 56, pp. 295-319, March 1968; Part II, Vol. 60, pp. 1062-1096, Sept. 1972.
16. S. Wolf and R. N. Tauber, Silicon Processing for the VLSI Era, Vol. 1: Process Technology. Sunset Beach, CA: Lattice Press, 1986, pp. 374-381.
17. S. Wolf and R. N. Tauber, Silicon Processing for the VLSI Era, Vol. 1: Process Technology. Sunset Beach, CA: Lattice Press, 1986, pp. 335-374.
18. J. L. Vossen and W. Kern (eds.), Thin Film Processes, Part III-2. New York: Academic Press, 1978.
19.P. E. Gise and R. Blanchard, Semiconductor and Integrated Circuit Fabrication Technique. Reston, VA: Reston Publishers, 1979, Chaps. 5, 6, 10, and 12.
20. S. Wolf and R. N. Tauber, Silicon Processing for the VLSI Era, Vol. 2: Process Integration. Sunset Beach, CA: Lattice Press, 1990, pp. 238-239.
21. D. J. Elliot, Integrated Circuit Fabrication Technology. New York: McGraw-Hill, 1982.
22. S. Wolf and R. N. Tauber, Silicon Processing for the VLSI Era, Vol. 1: Process Technology. Sunset Beach, CA: Lattice Press, 1986, pp. 384-406.
23. P. R. Gray and R. G. Meyer, Analysis and Design of Analog Integrated Circuits. 2nd ed. New York: John Wiley & Sons, 1984, Chap. 1.
24.D. A. Hodges and H. G. Jackson, Analysis and Design of Analog Integrated Circuits. New York: McGraw-Hill, 1983.
25. B. R. Chawla and H. K. Gummel, "Transition Region Capacitance of Diffused pn Junctions," IEEE Transactions on Electron Devices, Vol. ED-18, pp. 178-195, Mar. 1971.
26. C. T. Sah, "Characteristics of the Metal-Oxide-Semiconductor Transistor," IEEE Transactions on Electron Devices, Vol. ED-11, pp. 324-345, July 1964.
27. H. Shichman and D. Hodges, "Modelling and Simulation of Insulated-Gate Field-Effect Transistor Switching Circuts," IEEE J. Solid-State Circuits, Vol. SC-13, pp. 285-289, Sept. 1968.
66 CMOS TECHNOLOGY
28. D. B. Estreich and R. W. Dutton, "Modeling Latch-Up in CMOS Integrated Circuits and Systems," IEEE Transactions on CAD, Vol. CAD-1, pp. 157-162, Oct. 1982.
29. S. M. Sze, Physics of Semiconductor Devices, 2nd ed. New York: John Wiley & Sons, 1981, p. 28.
30. R. A. Blauschild, P. A. Tucci, R. S. Muller, and R. G. Meyer, "A New Temperature-Stable Voltage Reference," IEEE J. Solid-State Circuits, Vol. SC-19, Dec. 1978, pp. 767-774.
31. C. D. Motchenbacher and F. G. Fitchen, Low-Noise Electronic Design. New York: John Wiley & Sons, 1973.

Before one can design a circuit to be integrated in CMOS technology, one must first have a model describing the behavior of all the components available for use in the design. A model can take the form of mathematical equations, circuit representations, or tables. Most of the modeling used in this text will focus on the active and passive devices discussed in the previous chapter as opposed to higher-level modeling such as macromodeling or behavioral modeling.
It should be stressed at the outset that a model is just that and no more-it is not the real thing! In an ideal world, we would have a model that accurately describes the behavior of a device under all possible conditions. Realistically, we are happy to have a model that predicts simulated performance to within a few percent of measured performance. There is no clear agreement as to which model comes closest to meeting this "ideal" model [1]. This lack of agreement is illustrated by the fact that, at this writing, HSPICE [2] offers the user 43 different MOS transistor models from which to choose!
This text will concentrate on only three of these models. The simplest model, which is appropriate for hand calculations, was described in Section 2.3 and will be further developed here to include capacitance, noise, and ohmic resistance. In SPICE terminology, this simple model is called the LEVEL 1 model. Next, a small-signal model is derived from the LEVEL 1 large-signal model and is presented in Section 3.3.
A far more complex model, the SPICE LEVEL 3 model, is presented in Section 3.4. This model includes many effects that are more evident in modern short-channel technologies as well as subthreshold conduction. It is adequate for device geometries down to about ${0.8\mu }\mathrm{m}$ . Finally, the BSIM3v3 [3] model is presented. This model is the closest to becoming a standard for computer simulation.
## Notation
SPICE was originally implemented in FORTRAN where all input was required to be uppercase ASCII characters. Lowercase, Greek, and super-subscripting were not allowed. Modern SPICE implementations generally accept (but do not distinguish between) uppercase and lowercase but the tradition of using uppercase ASCII still lives on. This is particularly evident in the device model parameters. Since Greek characters are not available, these were simply spelled out, for example, $\gamma$ entered as GAMMA. Superscripts and subscripts were simply not used.
It is inconvenient to adopt the SPICE naming convention throughout the book because equations would appear unruly and would not be familiar to what is commonly seen in the literature. On the other hand, it is necessary to provide the correct notation where application to SPICE is intended. To address this dilemma, we have decided to use SPICE uppercase (nonitalic) notation for all model parameters except those applied to the simple model (SPICE LEVEL 1).

### 3.1 Simple MOS Large-Signal Model (SPICE LEVEL 1)
All large-signal models will be developed for the n-channel MOS device with the positive polarities of voltages and currents shown in Fig. 3.1-1(a). The same models can be used for the p-channel MOS device if all voltages and currents are multiplied by -1 and the absolute value of the p-channel threshold is used. This is equivalent to using the voltages and currents defined by Fig. 3.1-1(b), which are all positive quantities. As mentioned in Chapter 1, lowercase variables with capital subscripts will be used for the variables of large-signal models and lowercase variables with lowercase subscripts will be used for the variables of small-signal models. When the voltage or current is a model parameter, such as threshold voltage, it will be designated by an uppercase variable and an uppercase subscript.
When the length and width of the MOS device is greater than about ${10\mu }\mathrm{m}$ , the substrate doping is low, and when a simple model is desired, the model suggested by Sah [4] and used in SPICE by Shichman and Hodges [5] is very appropriate. This model was developed in Eq. (2.3-27) and is given below.
$$
{i}_{D} = \frac{{\mu }_{0}{C}_{\mathrm{{ox}}}W}{L}\left\lbrack  {\left( {{v}_{GS} - {V}_{T}}\right)  - \left( \frac{{v}_{DS}}{2}\right) }\right\rbrack  {v}_{DS} \tag{3.1-1}
$$
The terminal voltages and currents have been defined in the previous chapter. The various parameters of Eq. (3.1-1) are defined as
${\mu }_{0} =$ surface mobility of the channel for the n-channel
or p-channel device $\left( {{\mathrm{{cm}}}^{2}/\mathrm{V} - \mathrm{s}}\right)$
${C}_{\mathrm{{ox}}} = \frac{{\varepsilon }_{\mathrm{{ox}}}}{{t}_{\mathrm{{ox}}}} =$ capacitance per unit area of the gate oxide $\left( {\mathrm{F}/{\mathrm{{cm}}}^{2}}\right)$
$W =$ effective channel width
$L =$ effective channel length

Figure 3.1-1 Positive sign convention for (a) n-channel and (b) p-channel MOS transistor.
The threshold voltage ${V}_{T}$ is given by Eq. (2.3-19) for an n-channel transistor:
$$
{V}_{T} = {V}_{T0} + \gamma \left( {\sqrt{2\left| {\phi }_{F}\right|  + {v}_{SB}} - \sqrt{2\left| {\phi }_{F}\right| }}\right)  \tag{3.1-2}
$$
$$
{V}_{T0} = {V}_{T}\left( {{v}_{SB} = 0}\right)  = {V}_{FB} + 2\left| {\phi }_{F}\right|  + \frac{\sqrt{{2q}{\varepsilon }_{\mathrm{{Si}}}{N}_{\mathrm{{SUB}}}2\left| {\phi }_{F}\right| }}{{C}_{\mathrm{{ox}}}} \tag{3.1-3}
$$
$$
\gamma  = \text{bulk threshold parameter}\left( {\mathrm{V}}^{1/2}\right)  = \frac{\sqrt{2{\varepsilon }_{\mathrm{{Si}}}q{N}_{\mathrm{{SUB}}}}}{{C}_{\mathrm{{ox}}}} \tag{3.1-4}
$$
$$
{\phi }_{F} = \text{strong inversion surface potential}\left( \mathrm{V}\right)  = \frac{kT}{q}\ln \left( \frac{{N}_{\mathrm{{SUB}}}}{{n}_{i}}\right)  \tag{3.1-5}
$$
$$
{V}_{FB} = \text{ flatband voltage }\left( \mathrm{V}\right)  = {\phi }_{MS} - \frac{{Q}_{ss}}{{C}_{\mathrm{{ox}}}} \tag{3.1-6}
$$
$$
{\phi }_{MS} = {\phi }_{F}\text{(substrate)} - {\phi }_{F}\text{(gate) [see Eq. (2.3-17)]} \tag{3.1-7}
$$
$$
{\phi }_{F}\left( \text{substrate}\right)  =  - \frac{kT}{q}\ln \left( \frac{{N}_{\mathrm{{SUB}}}}{{n}_{i}}\right) \text{[n-channel with p-substrate]} \tag{3.1-8}
$$
$$
{\phi }_{F}\left( \text{gate}\right)  =  - \frac{kT}{q}\ln \left( \frac{{N}_{\text{GATE }}}{{n}_{i}}\right) \left\lbrack  {\mathrm{n}\text{-channel with }{\mathrm{n}}^{ + }\text{polysilicon gate }}\right\rbrack   \tag{3.1-9}
$$
$$
{Q}_{ss} = \text{oxide-charge} = q{N}_{ss} \tag{3.1-10}
$$
$$
k = \text{Boltzmann’s constant}
$$
$$
T = \text{temperature}\left( \mathrm{K}\right)
$$
$$
{n}_{i} = \text{intrinsic carrier concentration}
$$
Table 3.1-1 gives some of the pertinent constants for silicon.
A unique aspect of the MOS device is its dependence on the voltage from the source to bulk as shown by Eq. (3.1-2). This dependence means that the MOS device must be treated as a four-terminal element. It will be shown later how this behavior can influence both the large- and small-signal performance of MOS circuits.
Table 3.1-1 Constants for Silicon
<table><tr><td>Constant Symbol</td><td>Constant Description</td><td>Value</td><td>Units</td></tr><tr><td>${V}_{G0}$</td><td>Silicon bandgap (27 °C)</td><td>1.205</td><td>V</td></tr><tr><td>$k$</td><td>Boltzmann's constant</td><td>${1.381} \times  {10}^{-{23}}$</td><td>J/K</td></tr><tr><td>${n}_{i}$</td><td>Intrinsic carrier concentration ( ${27}^{ \circ  }\mathrm{C}$ )</td><td>${1.45} \times  {10}^{10}$</td><td>${\mathrm{{cm}}}^{-3}$</td></tr><tr><td>${\varepsilon }_{0}$</td><td>Permittivity of free space</td><td>${8.854} \times  {10}^{-{14}}$</td><td>F/cm</td></tr><tr><td>${\varepsilon }_{\mathrm{{Si}}}$</td><td>Permittivity of silicon</td><td>${11.7}{\varepsilon }_{0}$</td><td>F/cm</td></tr><tr><td>${\varepsilon }_{\text{ox }}$</td><td>Permittivity of ${\mathrm{{SiO}}}_{2}$</td><td>${3.9}{\varepsilon }_{0}$</td><td>F/cm</td></tr></table>
Table 3.1-2 Model Parameters for a Typical CMOS Bulk Process Suitable for Hand Calculations Using the Simple Model with Values Based on a ${0.8\mu }\mathrm{m}$ Silicon-Gate Bulk CMOS n-Well Process
<table><tr><td rowspan="2">Parameter Symbol</td><td rowspan="2">Parameter Description</td><td colspan="2">Typical Parameter Value</td><td rowspan="2">Units</td></tr><tr><td>n-Channel</td><td>p-Channel</td></tr><tr><td>${V}_{T0}$</td><td>Threshold voltage $\left( {{V}_{BS} = 0}\right)$</td><td>${0.7} \pm  {0.15}$</td><td>$- {0.7} \pm  {0.15}$</td><td>V</td></tr><tr><td>${K}^{\prime }$</td><td>Transconductance parameter (in saturation)</td><td>${110.0} \pm  {10}\%$</td><td>${50.0} \pm  {10}\%$</td><td>$\mu \mathrm{A}/{\mathrm{V}}^{2}$</td></tr><tr><td>$\gamma$</td><td>Bulk threshold parameter</td><td>0.4</td><td>0.57</td><td>${\mathrm{V}}^{1/2}$</td></tr><tr><td>入</td><td>Channel length modulation</td><td>${0.04}\left( {L = {1\mu }\mathrm{m}}\right)$</td><td>${0.05}\left( {L = {1\mu }\mathrm{m}}\right)$</td><td>${\mathrm{V}}^{-1}$</td></tr><tr><td/><td>parameter</td><td>${0.01}\left( {L = {2\mu }\mathrm{m}}\right)$</td><td>${0.01}\left( {L = {2\mu }\mathrm{m}}\right)$</td><td/></tr><tr><td>$2\left| {\phi }_{F}\right|$</td><td>Surface potential at strong inversion</td><td>0.7</td><td>0.8</td><td>V</td></tr></table>
In the realm of circuit design, it is more desirable to express the model equations in terms of electrical rather than physical parameters. For this reason, the drain current is often expressed as
$$
{i}_{D} = \beta \left\lbrack  {\left( {{v}_{GS} - {V}_{T}}\right)  - \frac{{v}_{DS}}{2}}\right\rbrack  {v}_{DS} \tag{3.1-11}
$$
or
$$
{i}_{D} = {K}^{\prime }\frac{W}{L}\left\lbrack  {\left( {{v}_{GS} - {V}_{T}}\right)  - \frac{{v}_{DS}}{2}}\right\rbrack  {v}_{DS} \tag{3.1-12}
$$
where the transconductance parameter $\beta$ is given in terms of physical parameters as
$$
\beta  = {K}^{\prime }\frac{W}{L} \cong  {\mu }_{0}{C}_{\text{ox }}\frac{W}{L}\;\left( {\mathrm{\;A}/{\mathrm{V}}^{2}}\right)  \tag{3.1-13}
$$
When devices are characterized in the nonsaturation region with low gate and drain voltages, the value for ${K}^{\prime }$ is approximately equal to ${\mu }_{0}{C}_{\mathrm{{ox}}}$ in the simple model. This is not the case when devices are characterized with larger voltages introducing effects such as mobility degradation. For these latter cases, ${K}^{\prime }$ is usually smaller. Typical values for the model parameters of Eq. (3.1-12) are given in Table 3.1-2.
There are various regions of operation of the MOS transistor based on the model of Eq. (3.1-1). These regions of operation depend on the value of ${v}_{GS} - {V}_{T}$ . If ${v}_{GS} - {V}_{T}$ is zero or negative, then the MOS device is in the cutoff* region and Eq. (3.1-1) becomes
$$
{i}_{D} = 0,\;{v}_{GS} - {V}_{T} \leq  0 \tag{3.1-14}
$$
In this region, the channel acts like an open circuit.
---
*We will learn later that MOS transistors can operate in the subthreshold region where the gate-source voltage is less than the threshold voltage.
---

Figure 3.1-2 Graphical illustration of the modified Sah equation.
A plot of Eq. (3.1-1) with $\lambda  = 0$ as a function of ${v}_{DS}$ is shown in Fig. 3.1-2 for various values of ${v}_{GS} - {V}_{T}$ . At the maximum of these curves the MOS transistor is said to saturate. The value of ${v}_{DS}$ at which this occurs is called the saturation voltage and is given as
$$
{v}_{DS}\left( \text{sat}\right)  = {v}_{GS} - {V}_{T} \tag{3.1-15}
$$
Thus, ${v}_{DS}$ (sat) defines the boundary between the remaining two regions of operation. If ${v}_{DS}$ is less than ${v}_{DS}$ (sat), then the MOS transistor is in the nonsaturated region and Eq. (3.1-1) becomes
$$
{i}_{D} = {K}^{\prime }\frac{W}{L}\left\lbrack  {\left( {{v}_{GS} - {V}_{T}}\right)  - \frac{{v}_{DS}}{2}}\right\rbrack  {v}_{DS},\;0 < {v}_{DS} \leq  \left( {{v}_{GS} - {V}_{T}}\right)  \tag{3.1-16}
$$
In Fig. 3.1-2, the nonsaturated region lies between the vertical axis $\left( {{v}_{DS} = 0}\right)$ and the ${v}_{DS} =$ ${v}_{GS} - {V}_{T}$ curve.
The third region occurs when ${v}_{DS}$ is greater than ${v}_{DS}$ (sat) or ${v}_{GS} - {V}_{T}$ . At this point the current ${i}_{D}$ becomes independent of ${v}_{DS}$ . Therefore, ${v}_{DS}$ in Eq. (3.1-1) is replaced by ${v}_{DS}$ (sat) of Eq. (3.1-15) to get
$$
{i}_{D} = {K}^{\prime }\frac{W}{2L}{\left( {v}_{GS} - {V}_{T}\right) }^{2},\;0 < \left( {{v}_{GS} - {V}_{T}}\right)  \leq  {v}_{DS} \tag{3.1-17}
$$
Equation (3.1-17) indicates that drain current remains constant once ${v}_{DS}$ is greater than ${v}_{GS}$ - ${V}_{T}$ . In reality, this is not true. As drain voltage increases, the channel length is reduced, resulting in increased current. This phenomenon is called channel length modulation and is accounted for in the saturation model with the addition of the factor $\left( {1 + \lambda {v}_{DS}}\right)$ , where ${v}_{DS}$ is the actual drain-source voltage and not ${v}_{DS}$ (sat). The saturation region model modified to include channel length modulation is given in Eq. (3.1-18):
$$
{i}_{D} = {K}^{\prime }\frac{W}{2L}{\left( {v}_{GS} - {V}_{T}\right) }^{2}\left( {1 + \lambda {v}_{DS}}\right) ,\;0 < \left( {{v}_{GS} - {V}_{T}}\right)  \leq  {v}_{DS} \tag{3.1-18}
$$
Up to this point in time, it has been convention to refer to the various regions of the MOS transistor as cutoff when $\left( {{v}_{GS} - {V}_{T}}\right)  \leq  0$ ; as active, ohmic, triode, or nonsaturation when $0 \leq  {v}_{DS} \leq  \left( {{v}_{GS} - {V}_{T}}\right)$ ; and as saturation when $\left( {{v}_{GS} - {V}_{T}}\right)  \leq  {v}_{DS}$ . While we will continue to use this convention throughout this text, the reader needs to be aware that a different convention was introduced recently in the fourth edition of Gray, Hurst, Lewis, and Meyer [6] that defines cutoff when $\left( {{v}_{GS} - {V}_{T}}\right)  \leq  0$ , triode or ohmic when $0 \leq  {v}_{DS} \leq  \left( {{v}_{GS} - {V}_{T}}\right)$ , and active when $\left( {{v}_{GS} - {V}_{T}}\right)  \leq  {v}_{DS}$ . The important difference is that "active" has replaced "saturation" when describing the region when $\left( {{v}_{GS} - {V}_{T}}\right)  \leq  {v}_{DS}$ . This new convention makes the names of the regions of operation for an MOS transistor similar to the bipolar transistor.

Figure 3.1-3 Output characteristics of the MOS device.
The output characteristics of the MOS transistor can be developed from Eqs. (3.1-14), (3.1-16), and (3.1-18). Figure 3.1-3 shows these characteristics plotted on a normalized basis. These curves have been normalized to the upper curve, where ${V}_{GS0}$ is defined as the value of ${v}_{GS}$ that causes a drain current of ${I}_{D0}$ in the saturation region. The entire characteristic is developed by extending the solid curves of Fig. 3.1-2 horizontally to the right from the maximum points. The solid curves of Fig. 3.1-3 correspond to $\lambda  = 0$ . If $\lambda  \neq  0$ , then the curves are the dashed lines.
Another important characteristic of the MOS transistor can be obtained by plotting ${i}_{D}$ versus ${v}_{GS}$ using Eq. (3.1-18). Figure 3.1-4 shows this result. This characteristic of the MOS transistor is called the transconductance characteristic. We note that the transconductance characteristic in the saturation region can be obtained from Fig. 3.1-3 by drawing a vertical line to the right of the parabolic dashed line and plotting values of ${i}_{D}$ versus ${v}_{GS}$ . Figure 3.1-4 is also useful for illustrating the effect of the source-bulk voltage, ${v}_{SB}$ . As the value of ${v}_{SB}$ increases, the value of ${V}_{T}$ increases for the enhancement, n-channel devices (for a p-channel device, $\left| {V}_{T}\right|$ increases as ${v}_{BS}$ increases). ${V}_{T}$ also increases positively for the n-channel depletion device, but since ${V}_{T}$ is negative, the value of ${V}_{T}$ approaches zero from the negative side. If ${v}_{SB}$ is large enough, ${V}_{T}$ will actually become positive and the depletion device becomes an enhancement device.

Figure 3.1-4 Transconductance characteristic of the MOS transistor as a function of the source-bulk voltage, ${v}_{\mathrm{{SB}}}$ .
Since the MOS transistor is a bidirectional device, determining which physical node is the drain and which the source may seem arbitrary. This is not really the case. For an n-channel transistor, the source is always at the lower potential of the two nodes. For the p-channel transistor, the source is always at the higher potential. It is obvious that the drain and source designations are not constrained to a given node of a transistor but can switch back and forth depending on the terminal voltages applied to the transistor.
A circuit version of the large-signal model of the MOS transistor consists of a current source connected between the drain and source terminals, that depends on the drain, source, gate, and bulk terminal voltages defined by the simple model described in this section. This simple model has five electrical and process parameters that completely define it. These parameters are ${K}^{\prime },{V}_{T},\gamma ,\lambda$ , and $2{\phi }_{F}$ . The subscript $n$ or $p$ will be used when the parameter refers to an n-channel or p-channel device, respectively. They constitute the LEVEL 1 model parameters of SPICE [7]. Typical values for these model parameters are given in Table 3.1-2.
The function of the large-signal model is to solve for the drain current given the terminal voltages of the MOS device. An example will help to illustrate this as well as show how the model is applied to the p-channel device.
---
Example 3.1-1
---
## Application of the Simple MOS Large-Signal Model
Assume that the transistors in Fig. 3.1-1 have a $W/L$ ratio of ${5\mu }\mathrm{m}/{1\mu }\mathrm{m}$ and that the large-signal model parameters are those given in Table 3.1-2. If the drain, gate, source, and bulk voltages of the n-channel transistor are $3\mathrm{\;V},2\mathrm{\;V},0\mathrm{\;V}$ , and $0\mathrm{\;V}$ , respectively, find the drain current. Repeat for the p-channel transistor if the drain, gate, source, and bulk voltages are $- 3\mathrm{\;V}$ , $- 2\mathrm{\;V},0\mathrm{\;V}$ , and $0\mathrm{\;V}$ , respectively.
## SOLUTION
We must first determine in which region the transistor is operating. Equation (3.1-15) gives ${v}_{DS}$ (sat) as $2\mathrm{\;V} - {0.7}\mathrm{\;V} = {1.3}\mathrm{\;V}$ . Since ${v}_{DS}$ is $3\mathrm{\;V}$ , the $\mathrm{n}$ -channel transistor is in the saturation region. Using Eq. (3.1-18) and the values from Table 3.1-2, we have
$$
{i}_{D} = \frac{{K}_{N}^{\prime }W}{2L}{\left( {v}_{GS} - {V}_{TN}\right) }^{2}\left( {1 + {\lambda }_{N}{v}_{DS}}\right)
$$
$$
= \frac{{110} \times  {10}^{-6}\left( {{5\mu }\mathrm{m}}\right) }{2\left( {{1\mu }\mathrm{m}}\right) }{\left( 2 - {0.7}\right) }^{2}\left( {1 + {0.04} \times  3}\right)  = {520\mu }\mathrm{A}
$$
Evaluation of Eq. (3.1-15) for the p-channel transistor is given as
$$
{v}_{SD}\left( \text{ sat }\right)  = {v}_{SG} - \left| {V}_{TP}\right|  = 2\mathrm{\;V} - {0.7}\mathrm{\;V} = {1.3}\mathrm{\;V}
$$
Since ${v}_{SD}$ is $3\mathrm{\;V}$ , the p-channel transistor is also in the saturation region, and Eq. (3.1-17) is applicable. The drain current of Fig. 3.1-1(b) can be found using the values from Table 3.1-2 as
$$
{i}_{D} = \frac{{K}_{P}^{\prime }W}{2L}{\left( {v}_{SG} - \left| {V}_{TP}\right| \right) }^{2}\left( {1 + {\lambda }_{P}{v}_{SD}}\right)
$$
$$
= \frac{{50} \times  {10}^{-6}\left( {{5\mu }\mathrm{m}}\right) }{2\left( {{1\mu }\mathrm{m}}\right) }{\left( 2 - {0.7}\right) }^{2}\left( {1 + {0.05} \times  3}\right)  = {243\mu }\mathrm{A}
$$
It is often useful to describe ${v}_{GS}$ in terms of ${i}_{D}$ in saturation as shown below:
$$
{v}_{GS} = {V}_{T} + \sqrt{2{i}_{D}/\beta } \tag{3.1-19}
$$
This expression illustrates that there are two components to ${v}_{GS}$ —an amount to invert the channel plus an additional amount to support the desired drain current. This second component is often referred to in the literature as ${V}_{ON}$ or overdrive. Thus, ${V}_{ON}$ can be defined as
$$
{V}_{ON} = \sqrt{2{i}_{D}/\beta } \tag{3.1-20}
$$
The term ${V}_{ON}$ should be recognized as the term for saturation voltage ${V}_{DS}$ (sat). They can be used interchangeably.
As the channel length of the technology decreases, the carriers in the channel will experience velocity saturation and the velocity is no longer proportional to the electric field [8]. An approximation for the carrier velocity is given as
$$
{v}_{d} \approx  \frac{\mu E}{1 + \frac{E}{{E}_{c}}} \tag{3.1-21}
$$
where ${E}_{c}$ is the critical electrical field at which velocity saturation of the carrier occurs. Eq. (2.3-25) can be expressed as
$$
{i}_{D} = W{Q}_{I}\left( y\right) {\mu }_{n}\frac{{dv}\left( y\right) }{dy} = W{Q}_{I}\left( y\right) {\mu }_{n}E\left( y\right)  = W{Q}_{I}\left( y\right) {\mu }_{n}{v}_{d} \tag{3.1-22}
$$
If we substitute Eq. (3.1-21) into Eq. (3.1-22) and replace the electric field $E$ by ${dv}/{dy}$ , we obtain
$$
{i}_{D}\left( {1 + \frac{1}{{E}_{c}}\frac{dv}{dy}}\right) {dy} = W{Q}_{I}\left( y\right) {\mu }_{n}{dv}\left( y\right)  \tag{3.1-23}
$$
which is the form of Eq. (2.3-25) that includes velocity saturation for electrons. Integrating the distance and voltage along the channel from 0 to $L$ and 0 to ${v}_{DS}$ as done in Section 2.4 gives
$$
{i}_{D} = \frac{{\mu }_{n}{C}_{ox}}{2\left( {1 + \frac{1}{{E}_{c}}\frac{{v}_{DS}}{L}}\right) }\frac{W}{L}\left\lbrack  {2\left( {{v}_{GS} - {V}_{T}}\right) {v}_{DS} - {v}_{DS}{}^{2}}\right\rbrack   \tag{3.1-24}
$$
which is equivalent to Eq. (2.3-27) but incorporates the velocity saturation effect. It is convenient to define a constant $\theta$ as
$$
\theta  = \frac{1}{{E}_{c}L}\left( {V}^{-1}\right)  \tag{3.1-25}
$$
Using this definition, Eq. (3.1-24) can rewritten as
$$
{i}_{D} = \frac{{\mu }_{n}{C}_{ox}}{2\left( {1 + \theta {v}_{DS}}\right) }\frac{W}{L}\left\lbrack  {2\left( {{v}_{GS} - {V}_{T}}\right) {v}_{DS} - {v}_{DS}^{2}}\right\rbrack   \tag{3.1-26}
$$
This expression is also equivalent to Eq. (3.1-1) but includes the influence of velocity saturation.
The next step, which follows the previous development in this section, is to solve for ${v}_{DS}$ (sat) as was done in Eq. (3.1-15). Unfortunately, this is not very straightforward because of ${v}_{DS}$ in the denominator of Eq. (3.1-26). An approximation for ${v}_{DS}$ (sat) is given as [6]
$$
{v}_{DS}^{\prime }\left( \mathrm{{sat}}\right)  \approx  \left( {{V}_{GS} - {V}_{T}}\right) \left( {1 - \frac{\theta \left( {{V}_{GS} - {V}_{T}}\right) }{2} + \cdots }\right)
$$
$$
= {v}_{DS}\left( \mathrm{{sat}}\right) \left( {1 - \frac{\theta \left( {{V}_{GS} - {V}_{T}}\right) }{2} + \cdots }\right)  \tag{3.1-27}
$$
The large-signal model for the saturation region that includes velocity saturation can be developed by assuming that ${0.5\theta }\left( {{v}_{GS} - {V}_{T}}\right)  < 1$ so that Eq. (3.1-27) reduces to the definition of ${v}_{DS}$ (sat). With this assumption, Eq. (3.1-26) becomes
$$
{i}_{D} = \frac{{\mu }_{n}{C}_{ox}}{2\left\lbrack  {1 + \theta \left( {{v}_{GS} - {V}_{T}}\right) }\right\rbrack  }\frac{W}{L}\left\lbrack  {\left( {v}_{GS} - {V}_{T}\right) }^{2}\right\rbrack  ,{v}_{DS} \geq  \left( {{V}_{GS} - {V}_{T}}\right) \left( {1 - \frac{\theta \left( {{V}_{GS} - {V}_{T}}\right) }{2} + \cdots }\right)  \tag{3.1-28}
$$
which extends the large-signal model of Eq. (3.1-17) to include the effect of velocity saturation. Figure 3.1-5 shows the influence of the $\theta$ parameter on the transconductance characteristics of an $\mathrm{n}$ -channel MOSFET with ${K}^{\prime } = {110\mu }\mathrm{A}/{\mathrm{V}}^{2}$ and $W/L = 1$ . We see that the effect of velocity saturation (when $\theta  \neq  0$ ) causes the slope of the transconductance curve to decrease. The transconductance characteristic moves from square law to linear as $\theta$ increases from zero.

Figure 3.1-5 Influence of velocity saturation on the transconductance characteristics.

Figure 3.1-6 n-Channel MOSFET with a degeneration resistor ${R}_{SX}$ to model velocity saturation.
A simple way of modeling velocity saturation is found by considering degeneration of the MOSFET [6]. Degeneration is the insertion of a resistor in series with the source as illustrated in Fig. 3.1-6. In terms of this figure, we can write
$$
{i}_{D} = \frac{{K}^{\prime }W}{2L}{\left( {v}_{GS}^{\prime } - {V}_{T}\right) }^{2} \tag{3.1-29}
$$
where
$$
{v}_{GS}^{\prime } = {v}_{GS} - {i}_{D}{R}_{XS} \tag{3.1-30}
$$
Solving for ${i}_{D}$ by substituting Eq. (3.1-30) into Eq. (3.1-29) results in
$$
{i}_{D} = \frac{{K}^{\prime }}{2\left\lbrack  {1 + {K}^{\prime }\frac{W}{L}{R}_{SX}\left( {{v}_{GS} - {V}_{T}}\right) }\right\rbrack  }\frac{W}{L}{\left( {v}_{GS} - {V}_{T}\right) }^{2} \tag{3.1-31}
$$
Comparing Eq. (3.1-31) with Eq. (3.1-28) gives the result that
$$
{R}_{SX} = \frac{\theta L}{{K}^{\prime }W} = \frac{1}{{E}_{c}{K}^{\prime }W} \tag{3.1-32}
$$
Therefore, given the critical field, ${E}_{c}$ , one can calculate a value of ${R}_{SX}$ that can be inserted in series with the source of the MOSFET to model velocity saturation. Therefore, given ${E}_{c},{K}^{\prime }$ , and $W$ , we can calculate a resistor to be placed in series with the source of the MOS transistor to model velocity saturation using the MOS transistor model that does not include velocity saturation.
---
Example 3.1-2
---
## Application of the Simple MOS Large-Signal Model for Velocity Saturation
Assume that the transistor in Fig. 3.1-6 has a $W/L$ ratio of ${1\mu }\mathrm{m}/{0.18\mu }\mathrm{m}$ and that the large-signal model parameters are those given in Table 3.1-2. Assume also that this transistor experiences velocity saturation where ${E}_{c}$ is ${1.5} \times  {10}^{6}\mathrm{\;V}/\mathrm{m}$ . Find the value of ${R}_{SX}$ .
## SOLUTION
The value of ${R}_{SX}$ can be calculated as
$$
{R}_{SX} = \frac{1}{{E}_{c}{K}^{\prime }W} = \frac{1}{{1.5} \times  {10}^{6} \cdot  {110} \times  {10}^{-6} \cdot  1 \times  {10}^{-6}} = {6.06}\mathrm{k}\Omega
$$

### 3.2 Other MOS Large-Signal Model Parameters
The large-signal model also includes several other characteristics such as the source/drain bulk junctions, source/drain ohmic resistances, various capacitors, noise, and temperature dependence. The complete version of the large-signal model is given in Fig. 3.2-1.
The diodes of Fig. 3.2-1 represent the pn junctions between the source and substrate and the drain and substrate. For proper transistor operation, these diodes must always be reverse biased. Their purpose in the dc model is primarily to model leakage currents. These currents are expressed as
$$
{i}_{BD} = {I}_{s}\left\lbrack  {\exp \left( \frac{q{v}_{BD}}{kT}\right)  - 1}\right\rbrack   \tag{3.2-1}
$$
and
$$
{i}_{BS} = {I}_{s}\left\lbrack  {\exp \left( \frac{q{v}_{BS}}{kT}\right)  - 1}\right\rbrack   \tag{3.2-2}
$$
where ${I}_{s}$ is the reverse saturation current of a pn junction, $q$ is the charge of an electron, $k$ is Boltzmann’s constant, and $T$ is temperature in kelvin units.
The resistors ${r}_{D}$ and ${r}_{S}$ represent the ohmic resistance of the drain and source, respectively. Typically, these resistors may be ${50} - {100\Omega }$ * and can often be ignored at low drain currents.
The capacitors of Fig. 3.2-1 can be separated into three types. The first type includes capacitors ${C}_{BD}$ and ${C}_{BS}$ , which are associated with the backbiased depletion region between the drain and substrate and the source and substrate. The second type includes capacitors ${C}_{GD}$ , ${C}_{GS}$ , and ${C}_{GB}$ , which are all common to the gate and are dependent on the operating condition of the transistor. The third type includes parasitic capacitors, which are independent of the operating conditions.

Figure 3.2-1 Complete large-signal model for the MOS transistor.
---
*For silicide process, these resistances will be much less-on the order of $5 - {10\Omega }$ .
---
The depletion capacitors are a function of the voltage across the pn junction. The expression of this junction-depletion capacitance is divided into two regions to account for the high injection effects. The first is given as
$$
{C}_{BX} = \left( \mathrm{{CJ}}\right) \left( \mathrm{{AX}}\right) {\left\lbrack  1 - \frac{{v}_{BX}}{\mathrm{{PB}}}\right\rbrack  }^{-\mathrm{{MJ}}},\;{v}_{BX} \leq  \left( \mathrm{{FC}}\right) \left( \mathrm{{PB}}\right)  \tag{3.2-3}
$$
where
$$
X = D\text{for}{C}_{BD}\text{or}X = S\text{for}{C}_{BS}
$$
$$
\mathrm{{AX}} = \text{area of the source}\left( {\mathrm{X} = \mathrm{S}}\right) \text{or drain}\left( {\mathrm{X} = \mathrm{D}}\right)
$$
$$
\mathrm{{CJ}} = \text{zero-bias}\left( {{v}_{BX} = 0}\right) \text{junction capacitance (per unit area)}
$$
$$
\mathrm{{CJ}} \cong  \sqrt{\frac{q{\varepsilon }_{\mathrm{{Si}}}{N}_{\mathrm{{SUB}}}}{2\mathrm{{PB}}}}
$$
$\mathrm{{PB}} =$ bulk junction potential [same as ${\phi }_{0}$ given in Eq. (2.2-6)]
$\mathrm{{FC}} =$ forward-bias nonideal junction-capacitance coefficient $\left( { \cong  {0.5}}\right)$
$\mathrm{{MJ}} =$ bulk junction grading coefficient $\left( \frac{1}{2}\right.$ for step junctions and $\frac{1}{3}$ for
graded junctions)
The second region is given as
$$
{C}_{BX} = \frac{\left( \mathrm{{CJ}}\right) \left( \mathrm{{AX}}\right) }{{\left( 1 - \mathrm{{FC}}\right) }^{1 + \mathrm{{MJ}}}}\left\lbrack  {1 - \left( {1 + \mathrm{{MJ}}}\right) \mathrm{{FC}} + \mathrm{{MJ}}\frac{{v}_{BX}}{\mathrm{{PB}}}}\right\rbrack  ,\;{v}_{BX} > \left( \mathrm{{FC}}\right) \left( \mathrm{{PB}}\right)  \tag{3.2-4}
$$
Figure 3.2-2 illustrates how the junction-depletion capacitances of Eqs. (3.2-3) and (3.2-4) are combined to model the large-signal capacitances ${C}_{BD}$ and ${C}_{BS}$ . It is seen that Eq. (3.2-4) prevents ${C}_{BX}$ from approaching infinity as ${v}_{BX}$ approaches PB.
A closer examination of the depletion capacitors in Fig. 3.2-3 shows that this capacitor is like a tub. It has a bottom with an area equal to the area of the drain or source. However, there are the sides that are also part of the depletion region. This area is called the sidewall. AX in Eqs. (3.2-3) and (3.2-4) should include both the bottom and sidewall assuming the zero-bias capacitances of the two regions are similar. To more closely model the depletion capacitance, it is separated into the bottom and sidewall components, given as follows:
$$
{C}_{BX} = \frac{\left( \mathrm{{CJ}}\right) \left( \mathrm{{AX}}\right) }{{\left\lbrack  1 - \left( \frac{{v}_{BX}}{\mathrm{{PB}}}\right) \right\rbrack  }^{\mathrm{{MJ}}}} + \frac{\left( \mathrm{{CJSW}}\right) \left( \mathrm{{PX}}\right) }{{\left\lbrack  1 - \left( \frac{{v}_{BX}}{\mathrm{{PB}}}\right) \right\rbrack  }^{\mathrm{{MJSW}}}}, \tag{3.2-5}
$$
and
$$
{C}_{BX} = \frac{\left( \mathrm{{CJ}}\right) \left( \mathrm{{AX}}\right) }{{\left( 1 - \mathrm{{FC}}\right) }^{1 + \mathrm{{MJ}}}}\left\lbrack  {1 - \left( {1 + \mathrm{{MJ}}}\right) \mathrm{{FC}} + \mathrm{{MJ}}\frac{{v}_{BX}}{\mathrm{{PB}}}}\right\rbrack
$$
$$
+ \frac{\left( \mathrm{{CJSW}}\right) \left( \mathrm{{PX}}\right) }{{\left( 1 - \mathrm{{FC}}\right) }^{1 + \mathrm{{MJSW}}}}\left\lbrack  {1 - \left( {1 + \mathrm{{MJSW}}}\right) \mathrm{{FC}} + \frac{{v}_{BX}}{\mathrm{{PB}}}\left( \mathrm{{MJSW}}\right) }\right\rbrack  \text{,}
$$
$$
{v}_{BX} \geq  \left( \mathrm{{FC}}\right) \left( \mathrm{{PB}}\right)  \tag{3.2-6}
$$

Figure 3.2-2 Example of the method of modeling the voltage dependence of the bulk junction capacitances.
where
$$
\mathrm{{AX}} = \text{area of the source}\left( {\mathrm{X} = \mathrm{S}}\right) \text{or drain}\left( {\mathrm{X} = \mathrm{D}}\right)
$$
$$
\text{PX} = \text{perimeter of the source}\left( {\mathrm{X} = \mathrm{S}}\right) \text{or drain}\left( {\mathrm{X} = \mathrm{D}}\right)
$$
$$
\text{CJSW = zero-bias, bulk-source/drain sidewall capacitance}
$$
$$
\text{MJSW = bulk-source/drain sidewall grading coefficient}
$$
Table 3.2-1 gives the values for CJ, CJSW, MJ, and MJSW for an MOS device that has an oxide thickness of ${140Å}$ resulting in a ${C}_{\mathrm{{ox}}} = {24.7} \times  {10}^{-4}\mathrm{\;F}/{\mathrm{m}}^{2}$ . It can be seen that the depletion capacitors cannot be accurately modeled until the geometry of the device is known, for example, the area and perimeter of the source and drain. However, values can be assumed for the purpose of design. For example, one could consider a typical source or drain to be ${1.8\mu }\mathrm{m}$ by ${5\mu }\mathrm{m}$ . Thus, a value for ${C}_{BX}$ of ${12.1}\mathrm{\;F}$ and ${9.8}\mathrm{\;F}$ results for n-channel and p-channel devices, respectively, for ${V}_{BX} = 0$ .
Polysilicon gate Figure 3.2-3 Illustration showing the bottom(ABCD)and sidewall $({ABFE} +$

${BCGF} + {DCGH} + {ADHE})$ components of the bulk junction capacitors.
Table 3.2-1 Capacitance Values and Coefficients for the MOS Model
<table><tr><td>Type</td><td>p-Channel</td><td>n-Channel</td><td>Units</td></tr><tr><td>CGSO</td><td>${220} \times  {10}^{-{12}}$</td><td>${220} \times  {10}^{-{12}}$</td><td>F/m</td></tr><tr><td>CGDO</td><td>${220} \times  {10}^{-{12}}$</td><td>${220} \times  {10}^{-{12}}$</td><td>F/m</td></tr><tr><td>CGBO</td><td>${700} \times  {10}^{-{12}}$</td><td>${700} \times  {10}^{-{12}}$</td><td>F/m</td></tr><tr><td>CJ</td><td>${560} \times  {10}^{-6}$</td><td>${770} \times  {10}^{-6}$</td><td>$\mathrm{F}/{\mathrm{m}}^{2}$</td></tr><tr><td>CJSW</td><td>${350} \times  {10}^{-{12}}$</td><td>${380} \times  {10}^{-{12}}$</td><td>F/m</td></tr><tr><td>MJ</td><td>0.5</td><td>0.5</td><td/></tr><tr><td>MJSW</td><td>0.35</td><td>0.38</td><td/></tr></table>
Based on an oxide thickness of140Å or ${C}_{\mathrm{{ox}}} = {24.7} \times  {10}^{-4}\mathrm{\;F}/{\mathrm{m}}^{2}$ .
The large-signal, charge-storage capacitors of the MOS device consist of the gate-to-source $\left( {C}_{GS}\right)$ , gate-to-drain $\left( {C}_{GD}\right)$ , and gate-to-bulk $\left( {C}_{GB}\right)$ capacitances. Figure 3.2-4 shows a cross section of the various capacitances that constitute the charge-storage capacitors of the MOS device. ${C}_{BS}$ and ${C}_{BD}$ are the bulk-to-source and bulk-to-drain capacitors discussed above. The following discussion represents a heuristic development of a model for the large-signal charge-storage capacitors.
${C}_{1}$ and ${C}_{3}$ are overlap capacitances and are due to an overlap of two conducting surfaces separated by a dielectric. The overlapping capacitors are shown in more detail in Fig. 3.2-5. The amount of overlap is designated as LD. This overlap is due to the lateral diffusion of the source and drain underneath the polysilicon gate. For example, a ${0.8\mu }\mathrm{m}$ CMOS process might have a lateral diffusion component, LD, of approximately ${16}\mathrm{\;{nm}}$ . The overlap capacitances can be approximated as
$$
{C}_{1} = {C}_{3} \cong  \left( \mathrm{{LD}}\right) \left( {W}_{\text{eff }}\right) {C}_{\text{ox }} = \left( \mathrm{{CGXO}}\right) {W}_{\text{eff }} \tag{3.2-7}
$$
where ${W}_{\text{eff }}$ is the effective channel width and CGXO $\left( {\mathrm{X} = \mathrm{S}\text{or D}}\right)$ is the overlap capacitance in $\mathrm{F}/\mathrm{m}$ for the gate-source or gate-drain overlap. The difference between the mask $W$ and actual $W$ is due to the encroachment of the field oxide under the silicon nitride. Table 3.2-1 gives a value for CGSO and CGDO based on a device with an oxide thickness of 140 Å. A third overlap capacitance that can be significant is the overlap between the gate and the bulk. Figure 3.2-6 shows this overlap capacitor $\left( {C}_{5}\right)$ in more detail. This is the capacitance that occurs between the gate and bulk at the edges of the channel and is a function of the effective length of the channel, ${L}_{\text{eff }}$ . Table 3.2-1 gives a typical value for CGBO for a device based on an oxide thickness of 140 Å.

Figure 3.2-4 Large-signal, charge-storage capacitors of the MOS device.

Figure 3.2-5 Overlap capacitances of an MOS transistor. (a) Top view showing the overlap between the source or drain and the gate for LOCOS technology. (b) Side view for LOCOS technology. (c) Side view for STI technology.
If the device illustrated in Fig. 3.2-4 was in the saturated state, the channel would extend almost to the drain and would extend completely to the drain if the MOS device was in the nonsaturated state. ${C}_{2}$ is the gate-to-channel capacitance and is given as
$$
{C}_{2} = {W}_{\mathrm{{eff}}}\left( {L - 2\mathrm{{LD}}}\right) {C}_{\mathrm{{ox}}} = {W}_{\mathrm{{eff}}}\left( {L}_{\mathrm{{eff}}}\right) {C}_{\mathrm{{ox}}} \tag{3.2-8}
$$
The term ${L}_{\text{eff }}$ is the effective channel length resulting from the mask-defined length being reduced by the amount of lateral diffusion (note that up until now, the symbols $L$ and $W$ were used to refer to "effective" dimensions whereas now these have been changed for added clarification). ${C}_{4}$ is the channel-to-bulk capacitance, which is a depletion capacitance that will vary with voltage like ${C}_{BS}$ or ${C}_{BD}$ .

Figure 3.2-6 Gate-bulk overlap capacitances. (a) LOCOS technology. (b) STI technology.

Figure 3.2-7 Voltage dependence of ${C}_{GS},{C}_{GD}$ , and ${C}_{GB}$ as a function of ${V}_{GS}$ with ${V}_{DS}$ constant and ${V}_{BS} = 0$ .
It is of interest to examine ${C}_{GB},{C}_{GS}$ , and ${C}_{GD}$ as ${v}_{DS}$ is held constant and ${v}_{GS}$ is increased from zero. To understand the results, one can imagine following a vertical line on Fig. 3.1-3 at, say, ${v}_{DS} = {0.5}\left( {{V}_{GS0} - {V}_{T}}\right)$ , as ${v}_{GS}$ increases from zero. The MOS device will first be off until ${v}_{GS}$ reaches ${V}_{T}$ . Next, it will be in the saturated region until ${v}_{GS}$ becomes equal to ${v}_{DS}$ (sat) $+ {V}_{T}$ . Finally, the MOS device will be in the nonsaturated region. The approximate variation of ${C}_{GB},{C}_{GS}$ , and ${C}_{GD}$ under these conditions is shown in Fig. 3.2-7. In cutoff, there is no channel and ${C}_{GB}$ is approximately equal to ${C}_{2} + 2{C}_{5}$ . As ${v}_{GS}$ approaches ${V}_{T}$ from the off region, a thin depletion layer is formed, creating a large value of ${C}_{4}$ . Since ${C}_{4}$ is in series with ${C}_{2}$ , little effect is observed. As ${v}_{GS}$ increases, this depletion region widens, causing ${C}_{4}$ to decrease and reducing ${C}_{GB}$ . When ${v}_{GS} = {V}_{T}$ , an inversion layer is formed that prevents further decreases of ${C}_{4}$ (and thus ${C}_{GB}$ ).
${C}_{1},{C}_{2}$ , and ${C}_{3}$ constitute ${C}_{GS}$ and ${C}_{GD}$ . The problem is how to allocate ${C}_{2}$ to ${C}_{GS}$ and ${C}_{GD}$ . The approach used is to assume in saturation that approximately two-thirds of ${C}_{2}$ belongs to ${C}_{GS}$ and none to ${C}_{GD}$ . This is, of course, an approximation. However, it has been found to give reasonably good results. Figure 3.2-7 shows how ${C}_{GS}$ and ${C}_{GD}$ change values in going from the off to the saturation region. Finally, when ${v}_{GS}$ is greater than ${v}_{DS} + {V}_{T}$ , the MOS device enters the nonsaturated region. In this case, the channel extends from the drain to the source and ${C}_{2}$ is simply divided evenly between ${C}_{GD}$ and ${C}_{GS}$ as shown in Fig. 3.2-7.
As a consequence of the above considerations, we shall use the following formulas for the charge-storage capacitances of the MOS device in the indicated regions.
Off
$$
{C}_{GB} = {C}_{2} + 2{C}_{5} = {C}_{\mathrm{{ox}}}\left( {W}_{\mathrm{{eff}}}\right) \left( {L}_{\mathrm{{eff}}}\right)  + \operatorname{CGBO}\left( {L}_{\mathrm{{eff}}}\right)  \tag{3.2-9a}
$$
$$
{C}_{GS} = {C}_{1} \cong  {C}_{\mathrm{{ox}}}\left( \mathrm{{LD}}\right) \left( {W}_{\mathrm{{eff}}}\right)  = \operatorname{CGSO}\left( {W}_{\mathrm{{eff}}}\right)  \tag{3.2-9b}
$$
$$
{C}_{GD} = {C}_{3} \cong  {C}_{\mathrm{{ox}}}\left( \mathrm{{LD}}\right) \left( {W}_{\mathrm{{eff}}}\right)  = \operatorname{CGDO}\left( {W}_{\mathrm{{eff}}}\right)  \tag{3.2-9c}
$$
Saturation
$$
{C}_{GB} = 2{C}_{5} = \operatorname{CGBO}\left( {L}_{\text{eff }}\right)  \tag{3.2-10a}
$$
$$
{C}_{GS} = {C}_{1} + \frac{2}{3}{C}_{2} = {C}_{\mathrm{{ox}}}\left( {\mathrm{{LD}} + {0.67}{L}_{\mathrm{{eff}}}}\right) \left( {W}_{\mathrm{{eff}}}\right)
$$
$$
= \operatorname{CGSO}\left( {W}_{\text{eff }}\right)  + {0.67}{C}_{\mathrm{{ox}}}\left( {W}_{\text{eff }}\right) \left( {L}_{\text{eff }}\right)  \tag{3.2-10b}
$$
$$
{C}_{GD} = {C}_{3} \cong  {C}_{\mathrm{{ox}}}\left( \mathrm{{LD}}\right) \left( {W}_{\mathrm{{eff}}}\right)  = \operatorname{CGDO}\left( {W}_{\mathrm{{eff}}}\right)  \tag{3.2-10c}
$$
Nonsaturated
$$
{C}_{GB} = 2{C}_{5} = \operatorname{CGBO}\left( {L}_{\text{eff }}\right)  \tag{3.2-11a}
$$
$$
{C}_{GS} = {C}_{1} + {0.5}{C}_{2} = {C}_{\mathrm{{ox}}}\left( {\mathrm{{LD}} + {0.5}{L}_{\mathrm{{eff}}}}\right) \left( {W}_{\mathrm{{eff}}}\right)
$$
$$
= \left( {\mathrm{{CGSO}} + {0.5}{C}_{\mathrm{{ox}}}{L}_{\mathrm{{eff}}}}\right) {W}_{\text{eff }} \tag{3.2-11b}
$$
$$
{C}_{GD} = {C}_{3} + {0.5}{C}_{2} = {C}_{\mathrm{{ox}}}\left( {\mathrm{{LD}} + {0.5}{L}_{\mathrm{{eff}}}}\right) \left( {W}_{\mathrm{{eff}}}\right)
$$
$$
= \left( {\mathrm{{CGDO}} + {0.5}{C}_{\mathrm{{ox}}}{L}_{\mathrm{{eff}}}}\right) {W}_{\text{eff }} \tag{3.2-11c}
$$
Equations that provide a smooth transition between the three regions can be found in the literature [9].
Other capacitor parasitics associated with transistors are due to interconnect to the transistor, for example, polysilicon over field (substrate). This type of capacitance typically constitutes the major portion of ${C}_{GB}$ in the nonsaturated and saturated regions and thus is very important and should be considered in the design of CMOS circuits.
Another important aspect of modeling the CMOS device is noise. The existence of noise is due to the fact that electrical charge is not continuous but is carried in discrete amounts equal to the charge of an electron. In electronic circuits, noise manifests itself by representing a lower limit below which electrical signals cannot be amplified without significant deterioration in the quality of the signal. Noise can be modeled by a current source connected in parallel with ${i}_{D}$ of Fig. 3.2-1. This current source represents two sources of noise, called thermal noise and flicker noise $\left\lbrack  {{10},{11}}\right\rbrack$ . These sources of noise were discussed in Section 2.5. The mean-square current-noise source is defined as
$$
{i}_{n}^{2} = \left\lbrack  {\frac{{8kT}{g}_{m}\left( {1 + \eta }\right) }{3} + \frac{\left( \mathrm{{KF}}\right) {I}_{D}}{f{C}_{\mathrm{{ox}}}{L}^{2}}}\right\rbrack  {\Delta f}\;\left( {A}^{2}\right)  \tag{3.2-12}
$$
where
$$
{\Delta f} = \text{a small bandwidth (typically}1\mathrm{\;{Hz}}\text{) at a frequency}f
$$
$$
\eta  = {g}_{mbs}/{g}_{m}\text{[see Eq. (3.3-8)]}
$$
$$
k = \text{Boltzmann’s constant}
$$
$$
T = \text{temperature}\left( \mathrm{K}\right)
$$
$$
{g}_{m} = \text{small-signal transconductance from gate to channel [see Eq. (3.3-6)]}
$$
$$
\mathrm{{KF}} = \text{flicker noise coefficient (F-A)}
$$
$$
f = \text{frequency}\left( \mathrm{{Hz}}\right)
$$
$\mathrm{{KF}}$ has a typical value of ${10}^{-{28}}\mathrm{\;F}$ -A. Both sources of noise are process dependent and the values are usually different for enhancement and depletion mode field effect transistors (FETs).
The mean-square current noise can be reflected to the gate of the MOS device by dividing Eq. (3.2-12) by ${g}_{m}^{2}$ , if the source is on ac ground, giving
$$
{e}_{n}^{2} = \frac{{i}_{n}^{2}}{{g}_{m}^{2}} = \left\lbrack  {\frac{{8kT}\left( {1 + \eta }\right) }{3{g}_{m}} + \frac{\mathrm{{KF}}}{{2f}{C}_{\mathrm{{ox}}}{WL}{K}^{\prime }}}\right\rbrack  {\Delta f}\;\left( {\mathrm{\;V}}^{2}\right)  \tag{3.2-13}
$$
The equivalent input-mean-square voltage-noise form of Eq. (3.2-13) will be useful for analyzing the noise performance of CMOS circuits in later chapters.
The experimental noise characteristics of n-channel and p-channel devices are shown in Figs. 3.2-8(a) and 3.2-8(b). These devices were fabricated using a submicron, silicon-gate, n-well, CMOS process. The data in Figs. 3.2-8(a) and 3.2-8(b) are typical for MOS devices and show that the $1/f$ noise is the dominant source of noise for frequencies below ${100}\mathrm{{kHz}}$ (at the given bias conditions).* Consequently, in many practical cases, the equivalent input-mean-square voltage noise of Eq. (3.2-13) is simplified to
$$
{e}_{\mathrm{{eq}}}^{2} = \left\lbrack  \frac{\mathrm{{KF}}}{{2f}{C}_{\mathrm{{ox}}}{WL}{K}^{\prime }}\right\rbrack  {\Delta f}\;\left( {\mathrm{\;V}}^{2}\right)  \tag{3.2-14}
$$
or in terms of the input-voltage-noise spectral density we can rewrite Eq. (3.2-14) as
$$
{e}_{\mathrm{{eq}}}^{2} = \frac{{e}_{\mathrm{{eq}}}^{2}}{\Delta f} = \frac{\mathrm{{KF}}}{{2f}{C}_{\mathrm{{ox}}}{WL}{K}^{\prime }} = \frac{B}{fWL}\;\left( {{\mathrm{\;V}}^{2}/\mathrm{{Hz}}}\right)  \tag{3.2-15}
$$
where $B$ is a constant for an $\mathrm{n}$ -channel or a p-channel device of a given process. ** The righthand expression of Eq. (3.2-15) will be important in optimizing the design with respect to noise performance.

Figure 3.2-8 Drain-current noise for (a) an n-channel and (b) a p-channel MOSFET measured on a silicon-gate submicron process.
---
*If the bias current is reduced, the thermal noise floor increases, thus moving the $1/f$ noise corner to a lower frequency. Therefore, the $1/f$ noise corner is a function of the thermal noise floor.
**Since the same symbol is used for voltage (current) noise and voltage (current) spectral density, the units are generally used to distinguish the difference if it is not clear in the text.
---
The temperature behavior of the MOS was given in Eqs. (2.5-8) and (2.5-9). Equation (2.5-8) can be expressed as
$$
{K}^{\prime }\left( T\right)  = {K}^{\prime }\left( {T}_{0}\right) {\left( T/{T}_{0}\right) }^{-{1.5}} \tag{3.2-16}
$$
Equation (2.5-9) is a series approximation of the threshold voltage temperature dependence and can be written as
$$
{V}_{T}\left( T\right)  = {V}_{T}\left( {T}_{0}\right)  + \alpha \left( {T - {T}_{0}}\right)  + \cdots  \tag{3.2-17}
$$
where a plus sign is used instead of the minus sign in Eq. (2.5-9). This means that $\alpha$ will be negative for NMOS and positive for PMOS. Substituting Eqs. (3.2-16) and (3.2-17) into the simple, large-signal model of the MOSFET in Eq. (3.1-17) gives the temperature dependence of the transistor:
$$
{I}_{D}\left( T\right)  = \frac{{\mu }_{o}{C}_{ox}W}{2L}{\left( \frac{T}{{T}_{0}}\right) }^{-{1.5}}{\left\lbrack  {V}_{GS} - {V}_{T0} - \alpha \left( T - {T}_{0}\right) \right\rbrack  }^{2} \tag{3.2-18}
$$
where ${V}_{T0}$ is the value of the threshold voltage at the reference temperature, ${T}_{0}$ .
While Eq. (3.2-18) can be used to determine the influence of temperature on the transistor current, there is an interesting characteristic called the zero temperature coefficient point that we want to examine. The differentiation of Eq. (3.2-18) is given as
$$
\frac{d{I}_{D}}{{d}_{T}} = \frac{-{1.5}{\mu }_{o}{C}_{ox}W}{{2L}{T}_{0}}{\left( \frac{T}{{T}_{0}}\right) }^{-{2.5}}{\left\lbrack  {V}_{GS} - {V}_{T0} - \alpha \left( T - {T}_{0}\right) \right\rbrack  }^{2}
$$
$$
- \alpha \frac{{\mu }_{o}{C}_{ox}W}{L}{\left( \frac{T}{{T}_{0}}\right) }^{-{1.5}}\left\lbrack  {{V}_{GS} - {V}_{T0} - \alpha \left( {T - {T}_{0}}\right) }\right\rbrack   \tag{3.2-19}
$$
If Eq. (3.2-19) is set to zero, the value of ${V}_{GS}$ that gives a zero temperature coefficient is given as
$$
{V}_{GS}\left( \mathrm{{ZTC}}\right)  = {V}_{T0} - \alpha {T}_{0} - \frac{\alpha T}{3} \tag{3.2-20}
$$
The zero temperature characteristics of an NMOS transistor are illustrated in Fig. 3.2-9. Note that in general, the ZTC point is well defined only for temperatures less than ${150}^{ \circ  }\mathrm{C}$ . For higher temperatures the ZTC drifts from the low-temperature value. Also, note that for values of gate-source voltage above the ZTC value, the drain current decreases as the temperature increases. This reduces the thermal runaway characteristics of the MOSFET compared to the BJT. The following example illustrates the application of the ZTC concept.
Example
## Example 3.2-1 Application of the ZTC Point to an NMOS Transistor
${3.2} - 1$ Assume that ${K}^{\prime } = {110\mu }\mathrm{A}/{\mathrm{V}}^{2},{V}_{T0} = {0.7}\mathrm{\;V}$ , and $\alpha  =  - {2.3}\mathrm{\;{mV}}/{}^{ \circ  }\mathrm{C}$ for an NMOS transistor. Find the ZTC point if the reference temperature is ${300}\mathrm{\;K}$ and the new temperature is ${400}\mathrm{\;K}$ . Find the drain current under these conditions if $W/L = {10}$ .

Figure 3.2-9 Zero temperature coefficient characteristics of a modern CMOS technology $\left( {{L}_{\min } = {50}\mathrm{\;{nm}}}\right)$ .
## SOLUTION
Evaluating Eq. (3.2-20) gives
$$
{V}_{GS}\left( \mathrm{{ZTC}}\right)  = {0.7}\mathrm{\;V} + {0.0023}\left( {\mathrm{\;V}/{}^{ \circ  }\mathrm{C}}\right) \left( {{300}\mathrm{\;K}}\right)  + \frac{{0.0023}\left( {\mathrm{\;V}/{}^{ \circ  }\mathrm{C}}\right) \left( {{400}\mathrm{\;K}}\right) }{3}
$$
$$
= {1.697}\mathrm{\;V}
$$
At this value of VGS the drain current is
$$
{I}_{D}\left( {{400}{}^{ \circ  }\mathrm{K}}\right)  = \frac{{110\mu }\mathrm{A}/{\mathrm{V}}^{2}\left( {10}\right) }{2}{\left( \frac{400}{300}\right) }^{-{1.5}}{\left\lbrack  {1.697} - {0.7} - {0.0023}\left( {100}\right) \right\rbrack  }^{2}
$$
$$
= {176\mu }\mathrm{A}
$$

### 3.3 Small-Signal Model for the MOS Transistor
Up to this point, we have been considering the large-signal model of the MOS transistor shown in Fig. 3.2-1. However, after the large-signal model has been used to find the dc conditions, the small-signal model becomes important. The small-signal model is a linear model that helps to simplify calculations. It is valid only over voltage or current regions where the large-signal voltage and currents can adequately be represented by a straight line.
Figure 3.3-1 shows a linearized small-signal model for the MOS transistor. The parameters of the small-signal model will be designated by lowercase subscripts. The various parameters of this small-signal model are all related to the large-signal model parameters and dc variables. The normal relationship between these two models assumes that the small-signal parameters are defined in terms of the ratio of small perturbations of the large-signal variables or as the partial differentiation of one large-signal variable with respect to another.

Figure 3.3-1 Small-signal model of the MOS transistor.
The conductances ${g}_{bd}$ and ${g}_{bs}$ are the equivalent conductances of the bulk-to-drain and bulk-to-source junctions. Since these junctions are normally reverse biased, the conductances are very small. They are defined as
$$
{g}_{bd} = \frac{\partial {i}_{BD}}{\partial {v}_{BD}}\text{(evaluated at the quiescent point)} \cong  0 \tag{3.3-1}
$$
and
$$
{g}_{bs} = \frac{\partial {i}_{BS}}{\partial {v}_{BS}}\text{(evaluated at the quiescent point)} \cong  0 \tag{3.3-2}
$$
The channel transconductances ${g}_{m}$ and ${g}_{mbs}$ and the channel conductance ${g}_{ds}$ are defined as
$$
{g}_{m} = \frac{\partial {i}_{D}}{\partial {v}_{GS}}\text{(evaluated at the quiescent point)} \tag{3.3-3}
$$
$$
{g}_{mbs} = \frac{\partial {i}_{D}}{\partial {v}_{BS}}\text{(evaluated at the quiescent point)} \tag{3.3-4}
$$
and
$$
{g}_{ds} = \frac{\partial {i}_{D}}{\partial {v}_{DS}}\text{(evaluated at the quiescent point)} \tag{3.3-5}
$$
The values of these small-signal parameters depend on which region the quiescent point occurs in. For example, in the saturated region ${g}_{m}$ can be found from Eq. (3.1-18) as
$$
{g}_{m} = \sqrt{\left( {2{K}^{\prime }W/L}\right) \left| {I}_{D}\right| \left( {1 + \lambda {V}_{DS}}\right) } \cong  \sqrt{\left( {2{K}^{\prime }W/L}\right) \left| {I}_{D}\right| } \tag{3.3-6}
$$
which emphasizes the dependence of the small-signal parameters on the large-signal operating conditions. The small-signal channel transconductance due to ${v}_{SB}$ is found by rewriting Eq. (3.3-4) as
$$
{g}_{mbs} = \frac{-\partial {i}_{D}}{\partial {v}_{SB}} =  - \left( \frac{\partial {i}_{D}}{\partial {V}_{T}}\right) \left( \frac{\partial {V}_{T}}{\partial {v}_{SB}}\right)  \tag{3.3-7}
$$
Using Eq. (3.1-2) and noting that $\partial {i}_{D}/\partial {V}_{T} =  - \partial {i}_{D}/\partial {v}_{GS}$ , we get*
$$
{g}_{mbs} = {g}_{m}\frac{\gamma }{2{\left( 2\left| {\phi }_{F}\right|  + \left| {V}_{SB}\right| \right) }^{1/2}} = \eta {g}_{m} \tag{3.3-8}
$$
This transconductance will become important in our small-signal analysis of the MOS transistor when the ac value of the source-bulk potential ${v}_{sb}$ is not zero.
The small-signal channel conductance, ${g}_{ds}\left( {g}_{0}\right)$ , is given as
$$
{g}_{ds} = {g}_{0} = \frac{{I}_{D}\lambda }{1 + \lambda {V}_{DS}} \cong  {I}_{D}\lambda  \tag{3.3-9}
$$
The channel conductance will be dependent on $L$ through $\lambda$ , which is inversely proportional to $L$ . We have assumed the MOS transistor is in saturation for the results given by Eqs. (3.3-6), (3.3-8), and (3.3-9).
The important dependence of the small-signal parameters on the large-signal model parameters and dc voltages and currents is illustrated in Table 3.3-1. In this table we see that the three small-signal model parameters of ${g}_{m},{g}_{mbs}$ , and ${g}_{ds}$ have several alternate forms. An example of the typical values of the small-signal model parameters follows.
---
Example 3.3-1
---
## Typical Values of Small-Signal Model Parameters
Find the values of ${g}_{m},{g}_{mbs}$ , and ${g}_{ds}$ using the large-signal model parameters in Table 3.1-2 for both an n-channel and a p-channel device if the dc value of the magnitude of the drain current is ${50\mu }\mathrm{A}$ and the magnitude of the dc value of the source-bulk voltage is $2\mathrm{\;V}$ . Assume that the $W/L$ ratio is ${1\mu }\mathrm{m}/{1\mu }\mathrm{m}$ .
## SOLUTION
Using the values of Table 3.1-2 and Eqs. (3.3-6),(3.3-8), and (3.3-9) gives ${g}_{m} = {105\mu }\mathrm{A}/\mathrm{V}$ , ${g}_{mbs} = {12.8\mu }\mathrm{A}/\mathrm{V}$ , and ${g}_{ds} = {2.0\mu }\mathrm{A}/\mathrm{V}$ for the n-channel device and ${g}_{m} = {70.7\mu }\mathrm{A}/\mathrm{V},{g}_{mbs} =$ ${12.0\mu }\mathrm{A}/\mathrm{V}$ , and ${g}_{ds} = {2.5\mu }\mathrm{A}/\mathrm{V}$ for the p-channel device.
---
*Note that absolute signs are used for ${V}_{SB}$ in order to prevent ${g}_{mbs}$ from becoming infinite. However, in a few rare cases the source-bulk junction is forward biased and in this case the absolute signs must be removed and ${V}_{SB}$ becomes negative (for an $\mathrm{n}$ -channel transistor).
---
Table 3.3-1 Dependence of the Small-Signal Model Parameters on the dc Values of Voltage and Current in the Saturation Region
<table><tr><td>Small-Signal Model Parameters</td><td>dc Current</td><td>dc Current and Voltage</td><td>dc Voltage</td></tr><tr><td>${g}_{m}$</td><td>$\cong  {\left( 2{K}^{\prime }{I}_{D}W/L\right) }^{1/2}$</td><td>-</td><td>$\cong  \frac{{K}^{\prime }W}{L}\left( {{V}_{GS} - {V}_{T}}\right)$</td></tr><tr><td>${g}_{mbs}$</td><td>-</td><td>$\frac{\gamma {\left( 2{I}_{D}\beta \right) }^{1/2}}{2{\left( 2\left| {\phi }_{F}\right|  + \left| {V}_{SB}\right| \right) }^{1/2}}$</td><td>$\gamma {\left\lbrack  \beta \left( {V}_{GS} - {V}_{T}\right) \right\rbrack  }^{1/2}$ $2{\left( 2\left| {\phi }_{F}\right|  + \left| {V}_{SB}\right| \right) }^{1/2}$</td></tr><tr><td>${g}_{ds}$</td><td>$\cong  \lambda {I}_{D}$</td><td>-</td><td>-</td></tr></table>
Although MOS devices are not often used in the nonsaturation region in analog circuit design, the relationships of the small-signal model parameters in the nonsaturation region are given as
$$
{g}_{m} = \frac{\partial {i}_{D}}{\partial {v}_{GS}} \cong  \beta {V}_{DS} \tag{3.3-10}
$$
$$
{g}_{mbs} = \frac{\partial {i}_{D}}{\partial {v}_{BS}} = \frac{{\beta \gamma }{V}_{DS}}{2{\left( 2\left| {\phi }_{F}\right|  + \left| {V}_{SB}\right| \right) }^{1/2}} \tag{3.3-11}
$$
and
$$
{g}_{ds} \cong  \beta \left( {{V}_{GS} - {V}_{T} - {V}_{DS}}\right)  \tag{3.3-12}
$$
Table 3.3-2 summarizes the dependence of the small-signal model parameters on the large-signal model parameters and dc voltages and currents for the nonsaturated region. The typical values of the small-signal model parameters for the nonsaturated region are illustrated in the following example.
---
Example 3.3-2
---
## Typical Values of the Small-Signal Model Parameters in the Nonsaturated Region
Find the values of the small-signal model parameters in the nonsaturation region for an n-channel and a p-channel transistor if ${V}_{GS} = 5\mathrm{\;V},{V}_{DS} = 1\mathrm{\;V}$ , and $\left| {V}_{BS}\right|  = 2\mathrm{\;V}$ . Assume that the $W/L$ ratio for both transistors is ${1\mu }\mathrm{m}/{1\mu }\mathrm{m}$ . Also assume that the value for ${K}^{\prime }$ in the nonsaturation region is the same as that for the saturation (generally a poor assumption).
## SOLUTION
First, it is necessary to calculate the threshold voltage of each transistor using Eq. (3.1-2). The results are a ${V}_{T}$ of ${1.02}\mathrm{\;V}$ for the n-channel and $- {1.14}\mathrm{\;V}$ for the p-channel. This gives a dc current of ${383\mu }\mathrm{A}$ and ${168\mu }\mathrm{A}$ , respectively. Using Eqs. (3.3-10),(3.3-11), and (3.3-12), we get ${g}_{m} = {110\mu }\mathrm{A}/\mathrm{V},{g}_{mbs} = {13.4\mu }\mathrm{A}/\mathrm{V}$ , and ${r}_{ds} = {3.05}\mathrm{k}\Omega$ for the $\mathrm{n}$ -channel transistor and ${g}_{m} = {50\mu }\mathrm{A}/\mathrm{V},{g}_{mbs} = {8.52\mu }\mathrm{A}/\mathrm{V}$ , and ${r}_{ds} = {6.99}\mathrm{k}\Omega$ for the p-channel transistor.
Table 3.3-2 Dependence of the Small-Signal Model Parameters on the dc Values of Voltage and Current in the Nonsaturation Region
<table><tr><td>Small-Signal Model Parameters</td><td>dc Voltage and/or Current Dependence</td></tr><tr><td>${g}_{m}$</td><td>$\cong  \beta {V}_{DS}$ ${\beta \gamma }{V}_{DS}$</td></tr><tr><td>${g}_{mbs}$</td><td>$2{\left( 2\left| {\phi }_{F}\right|  + \left| {V}_{SB}\right| \right) }^{1/2}$</td></tr><tr><td>${g}_{ds}$</td><td>$\cong  \beta \left( {{V}_{GS} - {V}_{T} - {V}_{DS}}\right)$</td></tr></table>
The values of ${r}_{d}$ and ${r}_{s}$ are assumed to be the same as ${r}_{D}$ and ${r}_{S}$ of Fig. 3.2-1. Likewise, for small-signal conditions ${C}_{gs},{C}_{gd},{C}_{gb},{C}_{bd}$ , and ${C}_{bs}$ are evaluated for ${C}_{gs},{C}_{gd}$ , and ${C}_{gb}$ by knowing the region of operation (cutoff, saturation or nonsaturation) and for ${C}_{bd}$ and ${C}_{bs}$ by knowing the value of ${V}_{BD}$ and ${V}_{BS}$ . With this information, ${C}_{gs},{C}_{gd},{C}_{gb},{C}_{bd}$ , and ${C}_{bs}$ can be found from ${C}_{GS},{C}_{GD},{C}_{GB},{C}_{BD}$ , and ${C}_{BS}$ , respectively.
If the noise of the MOS transistor is to be modeled, then three additional current sources are added to Fig. 3.3-1 as indicated by the dashed lines. The values of the mean-square noise-current sources are given as
$$
{i}_{nrD}^{2} = \left( \frac{4kT}{{r}_{D}}\right) {\Delta f}\;\left( {\mathrm{\;A}}^{2}\right)  \tag{3.3-13}
$$
$$
{i}_{nrS}^{2} = \left( \frac{4kT}{{r}_{S}}\right) {\Delta f}\;\left( {\mathrm{\;A}}^{2}\right)  \tag{3.3-14}
$$
and
$$
{i}_{nD}^{2} = \left\lbrack  {\frac{{8kT}{g}_{m}\left( {1 + \eta }\right) }{3} + \frac{\left( \mathrm{{KF}}\right) {I}_{D}}{f{C}_{\mathrm{{ox}}}{L}^{2}}}\right\rbrack  {\Delta f}\;\left( {\mathrm{\;A}}^{2}\right)  \tag{3.3-15}
$$
The various parameters for these equations have previously been defined. With the noise modeling capability, the small-signal model of Fig. 3.3-1 is a very general model.
It will be important to be familiar with the small-signal model for the saturation region developed in this section. This model, along with the circuit simplification techniques given in Appendix A, will be the key element in analyzing the circuits in the following chapters.

### 3.4 Computer Simulation Models
The large-signal model of the MOS device previously discussed is simple to use for hand calculations but neglects many important second-order effects. While a simple model for hand calculation and design intuition is critical, a more accurate model is required for computer simulation. There are many model choices available for the designer when choosing a device model to use for computer simulation. At one time, HSPICE* supported 43 different MOSFET models [2] (many of which were company proprietary) while SmartSpice publishes support for 14 [12]. Which model is the right one to use? In the fabless semiconductor environment, the user must use the model provided by the wafer foundry. In companies where the foundry is captive (i.e., the company owns its own wafer fabrication facility) a modeling group provides the model to circuit designers. It is seldom that a designer chooses a model and performs parameter extraction to get the terms for the model chosen.
---
*HSPICE is now owned by Avant! Inc. and has been renamed Star-Hspice.
---
The SPICE LEVEL 3 dc model will be covered in some detail because it is a relatively straightforward extension of the LEVEL 2 model. The BSIM3v3 model will be introduced but the detailed equations will not be presented because of the volume of equations required to describe it-there are other good texts that deal with the subject of modeling exclusively $\left\lbrack  {{13},{14}}\right\rbrack$ , and there is little additional design intuition derived from covering the details.
Models developed for computer simulation have improved over the years but no model has yet been developed that, with a single set of parameters, covers device operation for all possible geometries. Therefore, many SPICE simulators offer a feature called "model binning." Parameters are derived for transistors of different geometry ( $W$ ’s and $L$ ’s) and the simulator determines which set of parameters to use based on the particular $W$ and $L$ called out in the device instantiation line in the circuit description. The circuit designer need only be aware of this since the binning is done by the model provider.
## SPICE LEVEL 3 Model
The large-signal model of the MOS device previously discussed is simple to use for hand calculations but neglects many important second-order effects. Most of these second-order effects are due to narrow or short channel dimensions (less than about ${3\mu }\mathrm{m}$ ). In this section, we will consider a more complex model that is suitable for computer-based analysis (circuit simulation, i.e., SPICE simulation). In particular, the SPICE LEVEL 3 model will be covered (see Table 3.4-1). This model is typically good for MOS technologies down to about ${0.8\mu }\mathrm{m}$ . We will also consider the effects of temperature on the parameters of the MOS large-signal model.
We first consider second-order effects due to small geometries (Fig. 3.4-1). When ${v}_{GS}$ is greater than ${V}_{T}$ , the drain current for a small device can be given as [2] follows: Drain Current
$$
{i}_{DS} = \operatorname{BETA}\left\lbrack  {{v}_{GS} - {V}_{T} - \left( \frac{1 + {f}_{b}}{2}\right) {v}_{DE}}\right\rbrack  {v}_{DE} \tag{3.4-1}
$$
$$
\mathrm{{BETA}} = \mathrm{{KP}}\frac{{W}_{\mathrm{{eff}}}}{{L}_{\mathrm{{eff}}}} = {\mu }_{\mathrm{{eff}}}\mathrm{{COX}}\frac{{W}_{\mathrm{{eff}}}}{{L}_{\mathrm{{eff}}}} \tag{3.4-2}
$$
$$
{L}_{\text{eff }} = L - 2\left( \mathrm{{LD}}\right)  \tag{3.4-3}
$$
$$
{W}_{\text{eff }} = W - 2\left( \mathrm{{WD}}\right)  \tag{3.4-4}
$$
$$
{v}_{DE} = \min \left( {{v}_{DS},{v}_{DS}\left( \mathrm{{sat}}\right) }\right)  \tag{3.4-5}
$$
$$
{f}_{b} = {f}_{n} + \frac{\text{ GAMMA } \cdot  {f}_{s}}{4{\left( \mathrm{{PHI}} + {v}_{SB}\right) }^{1/2}} \tag{3.4-6}
$$
Table 3.4-1 Typical Model Parameters Suitable for SPICE Simulations Using LEVEL-3 Model (Extended Model)*
<table><tr><td rowspan="2">Parameter Symbol</td><td rowspan="2">Parameter Description</td><td colspan="3">Typical Parameter Value</td></tr><tr><td>n-Channel</td><td>p-Channel</td><td>Units</td></tr><tr><td>VTO</td><td>Threshold</td><td>${0.7} \pm  {0.15}$</td><td>$- {0.7} \pm  {0.15}$</td><td>V</td></tr><tr><td>UO</td><td>Mobility</td><td>660</td><td>210</td><td>${\mathrm{{cm}}}^{2}/\mathrm{V} - \mathrm{s}$</td></tr><tr><td>DELTA</td><td>Narrow-width threshold adjustment factor</td><td>2.4</td><td>1.25</td><td>-</td></tr><tr><td>ETA</td><td>Static-feedback threshold adjustment factor</td><td>0.1</td><td>0.1</td><td>-</td></tr><tr><td>KAPPA</td><td>Saturation field factor in channel length modulation</td><td>0.15</td><td>2.5</td><td>1/V</td></tr><tr><td>THETA</td><td>Mobility degradation factor</td><td>0.1</td><td>0.1</td><td>1/V</td></tr><tr><td>NSUB</td><td>Substrate doping</td><td>$3 \times  {10}^{16}$</td><td>$6 \times  {10}^{16}$</td><td>${\mathrm{{cm}}}^{-3}$</td></tr><tr><td>TOX</td><td>Oxide thickness</td><td>140</td><td>140</td><td>A</td></tr><tr><td>XJ</td><td>Metallurgical junction depth</td><td>0.2</td><td>0.2</td><td>μm</td></tr><tr><td>WD</td><td>Delta width</td><td/><td/><td>μm</td></tr><tr><td>LD</td><td>Lateral diffusion</td><td>0.016</td><td>0.015</td><td>μm</td></tr><tr><td>NFS</td><td>Parameter for weak</td><td>$7 \times  {10}^{11}$</td><td>$6 \times  {10}^{11}$</td><td>${\mathrm{{cm}}}^{-2}$</td></tr><tr><td/><td>inversion modeling</td><td/><td/><td/></tr><tr><td>CGSO</td><td/><td>${220} \times  {10}^{-{12}}$</td><td>${220} \times  {10}^{-{12}}$</td><td>F/m</td></tr><tr><td>CGDO</td><td/><td>${220} \times  {10}^{-{12}}$</td><td>${220} \times  {10}^{-{12}}$</td><td>F/m</td></tr><tr><td>CGBO</td><td/><td>${700} \times  {10}^{-{12}}$</td><td>${700} \times  {10}^{-{12}}$</td><td>F/m</td></tr><tr><td>CJ</td><td/><td>${770} \times  {10}^{-6}$</td><td>${560} \times  {10}^{-6}$</td><td>$\mathrm{F}/{\mathrm{m}}^{2}$</td></tr><tr><td>CJSW</td><td/><td>${380} \times  {10}^{-{12}}$</td><td>${350} \times  {10}^{-{12}}$</td><td>F/m</td></tr><tr><td>MJ</td><td/><td>0.5</td><td>0.5</td><td/></tr><tr><td>MJSW</td><td/><td>0.38</td><td>0.35</td><td/></tr></table>
*These values are based on a ${0.8\mu }\mathrm{m}$ silicon-gate bulk CMOS n-well process and include capacitance parameters from Table 3.2-1.
Note that PHI is the SPICE model term for the quantity $2{\phi }_{F}$ . Also be aware that PHI is always positive in SPICE regardless of the transistor type (p- or n-channel). In this text, the term PHI will always be positive while the term $2{\phi }_{F}$ will have a polarity determined by the transistor type as shown in Table 2.3-1.
$$
{f}_{n} = \frac{\text{ DELTA }}{{W}_{\text{eff }}}\frac{\pi {\varepsilon }_{\mathrm{{Si}}}}{2 \cdot  {\mathrm{C}}_{\mathrm{{ox}}}} \tag{3.4-7}
$$
$$
{f}_{s} = 1 - \frac{\mathrm{{XJ}}}{{L}_{\text{eff }}}\left\{  {\frac{\mathrm{{LD}} + {wc}}{\mathrm{{XJ}}}{\left\lbrack  1 - {\left( \frac{wp}{\mathrm{{XJ}} + {wp}}\right) }^{2}\right\rbrack  }^{1/2} - \frac{\mathrm{{LD}}}{\mathrm{{XJ}}}}\right\}   \tag{3.4-8}
$$
$$
{wp} = {xd}{\left( \mathrm{{PHI}} + {v}_{SB}\right) }^{1/2} \tag{3.4-9}
$$
$$
{xd} = {\left( \frac{2 \cdot  {\varepsilon }_{\mathrm{{Si}}}}{q \cdot  \mathrm{{NSUB}}}\right) }^{1/2} \tag{3.4-10}
$$
$$
{wc} = \mathrm{{XJ}}\left\lbrack  {{k}_{1} + {k}_{2}\left( \frac{wp}{\mathrm{{XJ}}}\right)  - {k}_{3}{\left( \frac{wp}{\mathrm{{XJ}}}\right) }^{2}}\right\rbrack   \tag{3.4-11}
$$
$$
{k}_{1} = {0.0631353},\;{k}_{2} = {0.08013292},\;{k}_{3} = {0.01110777}
$$

Figure 3.4-1 Illustration of the short-channel effects in the MOS transistor.
Threshold Voltage
$$
{V}_{T} = {V}_{bi} - \left( \frac{\mathrm{{ETA}} - {8.14} \times  {10}^{-{22}}}{{C}_{\mathrm{{ox}}}{L}_{\mathrm{{eff}}}^{3}}\right) {v}_{DS} + \mathrm{{GAMMA}} \cdot  {f}_{s}{\left( \mathrm{{PHI}} + {v}_{SB}\right) }^{1/2} \tag{3.4-12}
$$
$$
+ {f}_{n}\left( {\mathrm{{PHI}} + {v}_{SB}}\right)
$$
$$
{v}_{bi} = {v}_{fb} + \mathrm{{PHI}} \tag{3.4-13}
$$
or
$$
{v}_{bi} = \text{ VTO } - \text{ GAMMA } \cdot  \sqrt{\mathrm{{PHI}}} \tag{3.4-14}
$$
Saturation Voltage
$$
{v}_{\text{sat }} = \frac{{v}_{gs} - {V}_{T}}{1 + {f}_{b}} \tag{3.4-15}
$$
$$
{v}_{DS}\left( \mathrm{{sat}}\right)  = {v}_{\text{sat }} + {v}_{C} - {\left( {v}_{\text{sat }}^{2} + {v}_{C}^{2}\right) }^{1/2} \tag{3.4-16}
$$
$$
{v}_{C} = \frac{\mathrm{{VMAX}} \cdot  {L}_{\mathrm{{eff}}}}{{\mu }_{\mathrm{s}}} \tag{3.4-17}
$$
If VMAX is not given, then ${v}_{DS}\left( \text{sat}\right)  = {v}_{\text{sat }}$ .
## Effective Mobility
$$
{\mu }_{s} = \frac{\mathrm{U}0}{1 + \operatorname{THETA}\left( {{v}_{Gs} - {V}_{T}}\right) },\;\text{ when }\operatorname{VMAX} = 0 \tag{3.4-18}
$$
$$
{\mu }_{\text{eff }} = \frac{{\mu }_{s}}{1 + \frac{{v}_{DE}}{{v}_{C}}},\;\text{ when }\mathrm{{VMAX}} > 0;\;\text{ otherwise }{\mu }_{\text{eff }} = {\mu }_{s} \tag{3.4-19}
$$
## Channel Length Modulation
$$
{\Delta L} = {xd}{\left\lbrack  \operatorname{KAPPA}\left( {v}_{DS} - {v}_{DS}\left( \mathrm{{sat}}\right) \right) \right\rbrack  }^{1/2},\;\text{ when }\operatorname{VMAX} = 0 \tag{3.4-20}
$$
$$
{\Delta L} =  - \frac{{ep} \cdot  x{d}^{2}}{2} + {\left\lbrack  {\left( \frac{{ep} \cdot  x{d}^{2}}{2}\right) }^{2} + \mathrm{{KAPPA}} \cdot  x{d}^{2}\left( {v}_{DS} - {v}_{DS}\left( \mathrm{{sat}}\right) \right) \right\rbrack  }^{1/2}, \tag{3.4-21}
$$
when VMAX $> 0$
where
$$
{ep} = \frac{{v}_{C}\left( {{v}_{C} + {v}_{DS}\left( \mathrm{{sat}}\right) }\right) }{{L}_{\text{eff }}{v}_{DS}\left( \mathrm{{sat}}\right) } \tag{3.4-22}
$$
$$
{i}_{DS} = \frac{{i}_{DS}}{1 - {\Delta L}} \tag{3.4-23}
$$
The temperature-dependent variables in the models developed so far include the Fermi potential, PHI, EG, bulk junction potential of the source-bulk and drain-bulk junctions, PB, the reverse currents of the pn junctions, ${I}_{S}$ , and the dependence of mobility on temperature. The temperature dependence of most of these variables is found in the equations given previously or from well-known expressions. The dependence of mobility on temperature is given as
$$
\mathrm{U}0\left( T\right)  = \mathrm{U}0\left( {T}_{0}\right) {\left( \frac{T}{{T}_{0}}\right) }^{\mathrm{{BEX}}} \tag{3.4-24}
$$
where BEX is the temperature exponent for mobility and is typically -1.5 .
$$
{v}_{\text{therm }}\left( T\right)  = \frac{kT}{q} \tag{3.4-25}
$$
$$
\mathrm{{EG}}\left( T\right)  = {1.16} - {7.02} \cdot  {10}^{-4}\left\lbrack  \frac{{T}^{2}}{T + {1108.0}}\right\rbrack   \tag{3.4-26}
$$
$$
\operatorname{PHI}\left( T\right)  = \operatorname{PHI}\left( {T}_{0}\right)  \cdot  \left( \frac{T}{{T}_{0}}\right)  - {v}_{\text{therm }}\left( T\right) \left\lbrack  {3\ln \left( \frac{T}{{T}_{0}}\right)  + \frac{\mathrm{{EG}}\left( {T}_{0}\right) }{{v}_{\text{therm }}\left( {T}_{0}\right) } - \frac{\mathrm{{EG}}\left( T\right) }{{v}_{\text{therm }}\left( T\right) }}\right\rbrack   \tag{3.4-27}
$$
$$
{v}_{bi}\left( T\right)  = {v}_{bi}\left( {T}_{0}\right)  + \frac{\mathrm{{PHI}}\left( T\right)  - \mathrm{{PHI}}\left( {T}_{0}\right) }{2} + \frac{\mathrm{{EG}}\left( {T}_{0}\right)  - \mathrm{{EG}}\left( T\right) }{2} \tag{3.4-28}
$$
$$
\operatorname{VT}0\left( T\right)  = {v}_{bi}\left( T\right)  + \operatorname{GAMMA}\left\lbrack  \sqrt{\operatorname{PHI}\left( T\right) }\right\rbrack   \tag{3.4-29}
$$
$$
\operatorname{PHI}\left( T\right)  = 2{v}_{\text{therm }}\ln \left( \frac{\mathrm{{NSUB}}}{{n}_{i}\left( T\right) }\right)  \tag{3.4-30}
$$
$$
{n}_{i}\left( T\right)  = {1.45} \cdot  {10}^{16}{\left( \frac{T}{{T}_{0}}\right) }^{3/2}\exp \left\lbrack  {\mathrm{{EG}} \cdot  \left( {\frac{T}{{T}_{0}} - 1}\right) \left( \frac{1}{2 \cdot  {v}_{\text{therm }}\left( {T}_{0}\right) }\right) }\right\rbrack   \tag{3.4-31}
$$
For drain and source junction diodes, the following relationships apply:
$$
\mathrm{{PB}}\left( T\right)  = \mathrm{{PB}} \cdot  \left( \frac{T}{{T}_{0}}\right)  - {v}_{\text{therm }}\left( T\right) \left\lbrack  {3\ln \left( \frac{T}{{T}_{0}}\right)  + \frac{\mathrm{{EG}}\left( {T}_{0}\right) }{{v}_{\text{therm }}\left( {T}_{0}\right) } - \frac{\mathrm{{EG}}\left( T\right) }{{v}_{\text{therm }}\left( T\right) }}\right\rbrack   \tag{3.4-32}
$$
and
$$
{I}_{S}\left( T\right)  = \frac{{I}_{S}\left( {T}_{0}\right) }{\mathrm{N}} \cdot  \exp \left\lbrack  {\frac{\mathrm{{EG}}\left( {T}_{0}\right) }{{v}_{\text{therm }}\left( {T}_{0}\right) } - \frac{\mathrm{{EG}}\left( T\right) }{{v}_{\text{therm }}\left( T\right) } + 3\ln \left( \frac{T}{{T}_{0}}\right) }\right\rbrack   \tag{3.4-33}
$$
where $\mathrm{N}$ is the diode emission coefficient. The nominal temperature, ${T}_{0}$ , is ${300}\mathrm{\;K}$ .
An alternate form of the temperature dependence of the MOS model can be found elsewhere [15].
## BSIM 3v3 Model
MOS transistor models introduced thus far in this chapter have been used successfully when applied to ${0.8\mu }\mathrm{m}$ technologies and above. As geometries shrink below ${0.8\mu }\mathrm{m}$ , better models are required. Researchers in the Electrical Engineering and Computer Sciences Department at the University of California at Berkeley have been leaders in the development of SPICE and the models used in it. In 1984 they introduced the BSIM1 model [16] to address the need for a better submicron MOS transistor model. The BSIM1 model approached the modeling problem as a multiparameter curve-fitting exercise. The model contained 60 parameters covering the dc performance of the MOS transistor. There was some relationship to device physics, but in large part, it was a nonphysical model. Later, in 1991, UC Berkeley released the BSIM2 model that improved performance related to the modeling of output resistance changes due to hot-electron effects, source/drain parasitic resistance, and inversion-layer capacitance. This model contained ${99}\mathrm{{dc}}$ parameters, making it more unwieldy than the ${60} -$ parameter (dc parameters) BSIM1 model. In 1994, UC Berkeley introduced the BSIM3 model (version 2), which, unlike the earlier BSIM models, returned to a more device-physics-based modeling approach. The model is simpler to use and has only 40 dc parameters. Moreover, the BSIM3 model provides good performance when applied to analog as well as digital circuit simulation. In its third version, BSIM3v3 [3], it has become the industry standard MOS transistor model.
The BSIM3 model addresses the following important effects seen in deep-submicron MOSFET operation:
- Threshold voltage reduction
- Mobility degradation due to a vertical field
- Velocity saturation effects
- Drain-induced barrier lowering (DIBL)
- Channel length modulation
- Subthreshold (weak inversion) conduction
- Parasitic resistance in the source and drain
- Hot-electron effects on output resistance

Figure 3.4-2 Simulation of MOSFET transconductance characteristic using LEVEL $= 1$ , LEVEL $= 3$ and the BSIM3v3 models.
The plot shown in Fig. 3.4-2 shows a comparison of a 20/0.8 device using the LEVEL 1, LEVEL 3, and BSIM3v3 models. The model parameters were adjusted to provide similar characteristics (given the limitations of each model). Assuming that the BSIM3v3 model closely approximates actual transistor performance, this figure indicates that the LEVEL 1 model is grossly in error, while the LEVEL 3 model shows a significant difference in modeling the transition from the nonsaturation to linear region.

### 3.5 Subthreshold MOS Model
The models discussed in previous sections predict that no current will flow in a device when the gate-source voltage is at or below the threshold voltage. In reality, this is not the case. As ${v}_{GS}$ approaches ${V}_{T}$ , the ${i}_{D} - {v}_{GS}$ characteristics change from square-law to exponential. Whereas the region where ${v}_{GS}$ is above the threshold is called the strong inversion region, the region below (actually, the transition between the two regions is not well defined as will be explained later) is called the subthreshold, or weak inversion region. This is illustrated in Fig. 3.5-1 where the transconductance characteristic of a MOSFET in saturation is shown with the square root of current plotted as a function of the gate-source voltage. When the gate-source voltage reaches the value designated as ${V}_{ON}$ (this relates to the SPICE model formulation), the current changes from square-law to an exponential-law behavior. It is the objective of this section to present two models suitable for the subthreshold region. The first is the SPICE LEVEL 3 [2] model for computer simulation while the second is useful for hand calculations.
In the SPICE LEVEL 3 model, the transition point from the region of strong inversion to the weak inversion characteristic of the MOS device is designated as ${V}_{ON}$ and is greater than ${V}_{T}.{V}_{ON}$ is given by
$$
{V}_{ON} = {V}_{T} + \text{ fast } \tag{3.5-1}
$$
where
$$
\text{ fast } = \frac{kT}{q}\left\lbrack  {1 + \frac{q \cdot  \mathrm{{NFS}}}{\mathrm{{COX}}} + \frac{\mathrm{{GAMMA}} \cdot  {f}_{s}{\left( \mathrm{{PHI}} + {v}_{SB}\right) }^{1/2} + {f}_{n}\left( {\mathrm{{PHI}} + {v}_{SB}}\right) }{2\left( {\mathrm{{PHI}} + {v}_{SB}}\right) }}\right\rbrack   \tag{3.5-2}
$$
${NFS}$ is a parameter used in the evaluation of ${V}_{ON}$ and can be extracted from measurements. The drain current in the weak inversion region, ${v}_{GS} < {V}_{ON}$ , is given as
$$
{i}_{DS} = {i}_{DS}\left( {{V}_{ON},{v}_{DE},{v}_{SB}}\right) \exp \left( \frac{{v}_{GS} - {V}_{ON}}{\text{ fast }}\right)  \tag{3.5-3}
$$
where ${i}_{DS}$ is given as [from Eq. (3.4.1), with ${v}_{GS}$ replaced with ${V}_{ON}$ ]
$$
{i}_{DS} = \operatorname{BETA}\left\lbrack  {{V}_{ON} - {V}_{T} - \left( \frac{1 + {f}_{b}}{2}\right) {v}_{DE}}\right\rbrack   \cdot  {v}_{DE} \tag{3.5-4}
$$
For hand calculations, a simple model describing weak inversion operation is given as
$$
{i}_{D} \cong  \frac{W}{L}{I}_{D0}\exp \left( \frac{{v}_{GS}}{n\left( {{kT}/q}\right) }\right)  \tag{3.5-5}
$$
where the term $n$ is the subthreshold slope factor, and ${I}_{DO}$ is a process-dependent parameter that is dependent also on ${v}_{SB}$ and ${V}_{T}$ . These two terms are best extracted from experimental

Figure 3.5-1 Weak inversion characteristics of the MOS transistor as modeled by Eq. (3.5-4).

Figure 3.5-2 The three regions of operation of an MOS transistor.
data. Typically $n$ is greater than 1 and less than $3\left( {1 < n < 3}\right)$ . The point at which a transistor enters the weak inversion region can be approximated as
$$
{v}_{gs} < {V}_{T} + n\frac{kT}{q} \tag{3.5-6}
$$
Unfortunately, the model equations given here do not properly model the transistor as it makes the transition from strong to weak inversion. In reality, there is a transition region of operation between strong and weak inversion called the "moderate inversion" region [17]. This is illustrated in Fig. 3.5-2. A complete treatment of the operation of the transistor through this region is given in the literature $\left\lbrack  {{17},{18}}\right\rbrack$ .
It is important to consider the temperature behavior of the MOS device operating in the subthreshold region. As is the case for strong inversion, the temperature coefficient of the threshold voltage is negative in the subthreshold region. The variation of current due to temperature of a device operating in weak inversion is dominated by the negative temperature coefficient of the threshold voltage. Therefore, for a given gate-source voltage, subthreshold current increases as the temperature increases. This is illustrated in Fig. 3.5-3 [19].
Operation of the MOS device in the subthreshold region is very important when low-power circuits are desired. A whole class of CMOS circuits have been developed based on the weak inversion operation characterized by the above model [20-23]. We will consider some of these circuits in later chapters.

Figure 3.5-3 Transfer characteristics of a long-channel device as a function of temperature. (Copyright © 1977).

### 3.6 SPICE Simulation of MOS Circuits
The objective of this section is to show how to use SPICE to verify the performance of an MOS circuit. It is assumed that the reader already has experience using SPICE to simulate circuits containing resistors, capacitors, sources, and so on. This section will extend the reader's knowledge to include the application of MOS transistors into SPICE simulations. The models used in this section are the LEVEL 1 and LEVEL 3 models.
In order to simulate MOS circuits in SPICE, two components of the SPICE simulation file are needed. They are instance declarations and model descriptions. Instance declarations are simply descriptions of MOS devices appearing in the circuit along with characteristics unique to each instance. A simple example that shows the minimum required terms for a transistor instance follows:
---
$\mathrm{M}1\;3\;6\;7\;0\;\mathrm{{NCH}}\;\mathrm{W} = {100}\mathrm{U}\;\mathrm{L} = 1\mathrm{U}$
---
Here, the first letter in the instance declaration, $\mathrm{M}$ , tells SPICE that the instance is an MOS transistor (just like $\mathrm{R}$ tells SPICE that an instance is a resistor). The 1 makes this instance unique (different from M2, M9 9, etc.). The four numbers following M1 specify the nets (or nodes) to which the drain, gate, source, and substrate (bulk) are connected. These nets have a specific order as indicated below:
---
M<number> <DRAIN> <GATE> <SOURCE> <BULK> . .
---
Following the net numbers is the model name governing the character of the particular instance. In the example given above, the model name is NCH. There must be a model description somewhere in the simulation file that describes the model NCH. The transistor width and length are specified for the instance by the $\mathrm{W} = {100}\mathrm{U}$ and $\mathrm{L} = 1\mathrm{U}$ expressions. The default units for width and length are meters so the $\mathrm{U}$ following the number 100 is a multiplier of ${10}^{-6}$ . (Recall that the following multipliers can be used in SPICE: $\mathrm{M},\mathrm{U},\mathrm{N},\mathrm{P},\mathrm{F}$ , for ${10}^{-3}$ , ${10}^{-6},{10}^{-9},{10}^{-{12}},{10}^{-{15}}$ , respectively.)
Additional information can be specified for each instance. Some of these are:
Drain area and periphery (AD and PD)
Source area and periphery (AS and PS)
Drain and source resistance in squares (NRD and NRS)
Multiplier designating how many devices are in parallel (M)
Initial conditions (for initial transient analysis)
Drain and source area and periphery terms are used in calculating depletion capacitance and diode currents (remember, the drain and source are pn diodes to the bulk or well). The numbers of squares of resistance in the drain and source (NRD and NRS) are used to calculate the drain and source resistances for the transistor. The multiplier designator is very important and thus deserves extended discussion here.
In Appendix B, layout matching techniques were developed. One of the fundamental principles described was the "unit-matching" principle. This principle prescribes that when one device needs to be $\mathrm{M}$ times larger than another device, then the larger device should be made from $\mathrm{M}$ units of the smaller device. In the layout, the larger device would be drawn using $\mathrm{M}$ copies of the smaller device-all of them in parallel (i.e., all of the gates tied together, all of the drains tied together, and all of the sources tied together). In SPICE, one must account for the multiple components tied in parallel. One way to do this would be to instantiate the larger device by instantiating $\mathrm{M}$ of the smaller devices. A more convenient way to handle this is to use the multiplier parameter when the larger device is instantiated. Figure 3.6-1 illustrates two methods for implementing a $2\mathrm{X}$ device (unit device implied). In Fig. 3.6-1(a) the correct way to instantiate the device in SPICE is
---
$\mathrm{M}1\;3\;2\;1\;0\;\mathrm{{NCH}}\;\mathrm{W} = {20}\mathrm{U}\;\mathrm{L} = 1\mathrm{U}$
---
whereas in Fig. 3.6-1(b) the correct SPICE instantiation is
---
$\mathrm{M}1\;3\;2\;1\;0\;\mathrm{{NCH}}\;\mathrm{W} = 1\;0\mathrm{U}\;\mathrm{L} = 1\mathrm{U}\;\mathrm{M} = 2$
---
Clearly, from the point of view of matching (again, it is implied that an attempt is made to achieve a 2:1 ratio), case (b) is the better choice and thus the instantiation with the multiplier is required. For the sake of completeness, it should be noted that the following pair of instantiations are equivalent to the use of the multiplier:
---
$\mathrm{M}1\mathrm{\;A}3\;2\;1\;0\;\mathrm{{NCH}}\;\mathrm{W} = {10}\mathrm{U}\;\mathrm{L} = 1\mathrm{U}$
$\mathrm{M}1\mathrm{\;B}3\;2\;1\;0\;\mathrm{{NCH}}\;\mathrm{W} = {10}\mathrm{U}\;\mathrm{L} = 1\mathrm{U}$
---
Some SPICE simulators offer additional terms further describing an instance of an MOS transistor.

A SPICE simulation file for an MOS circuit is incomplete without a description of the model to be used to characterize the MOS transistors used in the circuit. A model is described by placing a line in the simulation file using the following format:
---
.MODEL <MODEL NAME> <MODEL TYPE> <MODEL PARAMETERS>
---
The model line must always begin with . MODEL and be followed by a model name such as $\mathrm{{NCH}}$ in our example. Following the model name is the model type. The appropriate choices for model type in MOS circuits is either PMOS or NMOS. The final group of entries is model parameters. If no entries are provided, SPICE uses a default set of model parameters. Except for the crudest of simulations, you will always want to avoid the default parameters. Most of the time you should expect to get a model from the foundry where the wafers will be fabricated, or from the modeling group within your company. For times where it is desired to check hand calculations that were performed using the simple model (LEVEL 1 model) it is useful to know the details of entering model information. An example model description line follows.
---
. MODEL NCH NMOS LEVEL $= 1\;$ VT $0 = 1\;$ KP $= {50}\;$ U GAMMA $= {0.5}$
$+ \mathrm{{LAMBDA}} = {0.01}$
---
In this example, the model name is $\mathrm{{NCH}}$ and the model type is $\mathrm{{NMOS}}$ . The model parameters dictate that the LEVEL 1 model is used with VT 0, KP, GAMMA, and LAMBDA specified. Note that the + is SPICE syntax for a continuation line.
The information on the model line is much more extensive and will be covered in this and the following paragraphs. The model line is preceded by a period to flag the program that this line is not a component. The model line identifies the model LEVEL (e.g., LEVEL = 1) and provides the electrical and process parameters. If the user does not input the various parameters, default values are used. These default values are indicated in the user's guide for the version of SPICE being used (e.g., SmartSpice). The LEVEL 1 model parameters were covered in Section 3.1 and are the zero-bias threshold voltage, VT0 $\left( {\mathrm{V}}_{T0}\right)$ , in volts extrapolated to ${i}_{D} = 0$ for large devices; the intrinsic transconductance parameter, $\mathrm{{KP}}\left( {K}^{\prime }\right)$ , in amperes/volt ${}^{2}$ ; the bulk threshold parameter, GAMMA $\left( \gamma \right)$ , in volt ${}^{1/2}$ ; the surface potential at strong inversion, PHI $\left( {2{\phi }_{F}}\right)$ , in volts; and the channel length modulation parameter, LAMBDA $\left( \lambda \right)$ , in volt ${}^{-1}$ . Values for these parameters can be found in Table 3.1-2.
Sometimes, one would rather let SPICE calculate the above parameters from the appropriate process parameters. This can be done by entering the surface state density in ${\mathrm{{cm}}}^{-2}$ (NSS); the oxide thickness in meters (TOX); the surface mobility, $\mathrm{U}0\left( {\mu }_{0}\right)$ , in ${\mathrm{{cm}}}^{2}/\mathrm{V} - \mathrm{s}$ ; and the substrate doping in ${\mathrm{{cm}}}^{-3}$ (NSUB). The equations used to calculate the electrical parameters are
$$
\mathrm{{VT}}0 = {\phi }_{MS} - \frac{q\left( \mathrm{{NSS}}\right) }{\left( {\varepsilon }_{\mathrm{{ox}}}/\mathrm{{TOX}}\right) } + \frac{{\left( 2q \cdot  {\varepsilon }_{\mathrm{{Si}}} \cdot  \mathrm{{NSUB}} \cdot  \mathrm{{PHI}}\right) }^{1/2}}{\left( {\varepsilon }_{\mathrm{{ox}}}/\mathrm{{TOX}}\right) } + \mathrm{{PHI}} \tag{3.6-1}
$$
$$
\mathrm{{KP}} = \mathrm{U}0\frac{{\varepsilon }_{\mathrm{{ox}}}}{\mathrm{{TOX}}} \tag{3.6-2}
$$
$$
\text{ GAMMA } = \frac{{\left( 2q \cdot  {\varepsilon }_{\mathrm{{Si}}} \cdot  \mathrm{{NSUB}}\right) }^{1/2}}{\left( {\varepsilon }_{\mathrm{{ox}}}/\mathrm{{TOX}}\right) } \tag{3.6-3}
$$
and
$$
\mathrm{{PHI}} = \left| {2{\phi }_{F}}\right|  = \frac{2kT}{q}\ln \left( \frac{\mathrm{{NSUB}}}{{n}_{i}}\right)  \tag{3.6-4}
$$
LAMBDA is not calculated from the process parameters for the LEVEL 1 model. The constants for silicon, given in Table 3.1-1, are contained within the SPICE program and do not have to be entered.
The next model parameters considered are those that were considered in Section 3.2. The first parameters considered were associated with the bulk-drain and bulk-source pn junctions. These parameters include the reverse current of the drain-bulk or source-bulk junctions in A (IS) or the reverse-current density of the drain-bulk or source-bulk junctions in $\mathrm{A}/{\mathrm{m}}^{2}$ (JS). JS requires the specification of AS and AD on the model line. If IS is specified, it overrides JS. The default value of IS is usually ${10}^{-{14}}\mathrm{\;A}$ . The next parameters considered in Section 3.2 were the drain ohmic resistance in ohms (RD), the source ohmic resistance in ohms (RS), and the sheet resistance of the source and drain in ohms/square (RSH). RSH is overridden if RD or RS is entered. To use RSH, the values of NRD and NRS must be entered on the model line.
The drain-bulk and source-bulk depletion capacitors can be specified by the zero-bias bulk junction bottom capacitance in farads per ${\mathrm{m}}^{2}$ of junction area (CJ). CJ requires NSUB and assumes a step junction using a formula similar to Eq. (2.2-12). Alternately, the drain-bulk and source-bulk depletion capacitances can be specified using Eqs. (3.2-5) and (3.2-6). The necessary parameters include the zero-bias bulk-drain junction capacitance (CBD) in farads, the zero-bias bulk-source junction capacitance (CBS) in farads, the bulk junction potential (PB) in volts, the coefficient for forward-bias depletion capacitance (FC), the zero-bias bulk junction sidewall capacitance (CJSW) in farads per meter of junction perimeter, and the bulk junction sidewall capacitance grading coefficient (MJSW). If CBD or CBS is specified, then CJ is overridden. The values of AS, AD, PS, and PD must be given on the device line to use the above parameters. Typical values of these parameters are given in Table 3.2-1.
The next parameters discussed in Section 3.2 were the gate overlap capacitances. These capacitors are specified by the gate-source overlap capacitance (CGSO) in farads/meter, the gate-drain overlap capacitance (CGDO) in farads/meter, and the gate-bulk overlap capacitance (CGBO) in farads/meter. Typical values of these overlap capacitances can be found in Table 3.2-1. Finally, the noise parameters include the flicker noise coefficient (KF) and the flicker noise exponent (AF). Typical values of these parameters are ${10}^{-{28}}$ and 1, respectively.
Additional parameters not discussed in Section 3.4 include the type of gate material (TPG), the thin oxide capacitance model flag, and the coefficient of channel charge allocated to the drain (XQC). The choices for TPG are +1 if the gate material is opposite to the substrate, -1 if the gate material is the same as the substrate, and 0 if the gate material is aluminum. A charge-controlled model is used in the SPICE simulator if the value of the parameter XQC has a value smaller than or equal to 0.5 . This model attempts to keep the sum of charge associated with each node equal to zero. If XQC is larger than 0.5 , charge conservation is not guaranteed.
In order to illustrate its use and to provide examples for the novice user to follow, several examples will be given showing how to use SPICE to perform various simulations.
## Use of SPICE to Simulate MOS Output Characteristics
Use SPICE to obtain the output characteristics of the n-channel transistor shown in Fig. 3.6- 2 using the LEVEL 1 model and the parameter values of Table 3.1-2. The output curves are to be plotted for drain-source voltages from 0 to $5\mathrm{\;V}$ and for gate-source voltages of1,2,3, 4 , and 5 V. Assume that the bulk voltage is zero.

Figure 3.6-2 Circuit for Example 3.6-1.
SOLUTION
Table 3.6-1 shows the input file for SPICE to solve this problem. The first line is a title for the simulation file and must be present. The lines not preceded by "." define the interconnection of the circuit. The second line describes how the transistor is connected, defines the model to be used, and gives the $\mathrm{W}$ and $\mathrm{L}$ values. Note that because the units are meters, the suffix $U$ is used to convert to $\mu \mathrm{m}$ . The third and fourth lines describe the independent voltages. VDS and VGS are used to bias the MOSFET. The fifth line is the model description for M1. The remaining lines instruct SPICE to perform a dc sweep and print desired results. . DC asks for a dc sweep. In this particular case, a nested dc sweep is specified in order to avoid seven consecutive analyses. The . DC. . . line will set VGS to a value of $1\mathrm{\;V}$ and then sweep VDS from 0 to $5\mathrm{\;V}$ in increments of ${0.2}\mathrm{\;V}$ . Next, it will increment VGS to $2\mathrm{\;V}$ and repeat the VDS sweep. This is continued until five VDS sweeps have been made with the desired values of VGS. The . PR I NT. . . line directs the program to print the values of the dc sweeps. The last line of every SPICE input file must be . END. Figure 3.6-3 shows the output plot of this analysis.
## Table 3.6-1 SPICE Input File for Example 3.6-1
---
Ex. 3.6-1 Use of SPICE to Simulate MOS Output
$\mathrm{M}1\;2\;1\;0\;0\;\mathrm{{MOS}}1\;\mathrm{W} = 5\mathrm{U}\;\mathrm{L} = 1\;0\mathrm{\;U}$
VDS 2 0 5
VGS 1 0 1
.MODEL MOS1 NMOS VTO = 0.7 KP = 110U GAMMA = 0.4 LAMBDA = 0.04 PHI = 0.7
. DC VDS 0 5 0.2 VGS 1 5 1
PRINT DC V(2) I (VDS)
. END
---
---
Example 3.6-1
---

Figure 3.6-3 Output from Example 3.6-1.
---
Example 3.6-2
---
## DC Analysis of Fig. 3.6-4
Use the SPICE simulator to obtain a plot of the value of ${v}_{\mathrm{{OUT}}}$ as a function of ${v}_{\mathrm{{IN}}}$ of Fig. 3.6- 4. Identify the dc value of ${v}_{\mathrm{{IN}}}$ that gives ${v}_{\mathrm{{OUT}}} = {2.5}\mathrm{\;V}$ .

Figure 3.6-4 A simple MOS amplifier for Example 3.6-2.
SOLUTION
The input file for SPICE is shown in Table 3.6-2. It follows the same format as the previous example except that two types of transistors are used. These models are designated by MOSN and MOSP. A dc sweep is requested starting from ${v}_{\mathrm{{IN}}} = 0\mathrm{\;V}$ and going to $+ 5\mathrm{\;V}$ . Figure 3.6- 5 shows the resulting output of the dc sweep. ${v}_{\mathrm{{OUT}}} = {2.5}\mathrm{\;V}$ when ${v}_{\mathrm{{IN}}} \approx  {1.0}\mathrm{\;V}$ .
Table 3.6-2 SPICE Input File for Example 3.6-2
---
Ex. 3.6-2 DC Analysis of Fig. 3.6-4
$\mathrm{M}1\;2\;1\;0\;0\;\mathrm{{MOSN}}\;\mathrm{W} = 5\mathrm{U}\;\mathrm{L} = 1\mathrm{U}$
$\mathrm{M}2\;2\;3\;4\;4\;\mathrm{{MOSP}}\;\mathrm{W} = 5\mathrm{U}\;\mathrm{L} = 1\mathrm{U}$
$\mathrm{M}3\;3\;3\;4\;4\;\mathrm{{MOSP}}\;\mathrm{W} = 5\mathrm{U}\;\mathrm{L} = 1\mathrm{U}$
R1 3 0 100K
VDD 4 0 DC 5.0
VIN 1 0 DC 5.0
MODEL MOSN NMOS VTO = 0.7 KP = 110U GAMMA = 0.4 LAMBDA = 0.04 PHI = 0.7
. MODEL MOSP PMOS VTO $=  - {0.7}\;\mathrm{{KP}} = {50}\mathrm{U}\;\mathrm{{GAMMA}} = {0.57}\;\mathrm{{LAMBDA}} = {0.05}\;\mathrm{{PHI}} = {0.8}$
. DC VIN 0 5 0.1
PRINT DC V ( 2 )
. END
---

Figure 3.6-5 Output of Example 3.6-2.
---
Example 3.6-3
---
AC Analysis of Fig. 3.6-4
Use SPICE to obtain a small-signal frequency response of ${V}_{\text{out }}\left( \omega \right) /{V}_{\text{in }}\left( \omega \right)$ when the amplifier is biased in the transition region. Assume that a $5\mathrm{{pF}}$ capacitor is attached to the output of Fig. 3.6-4 and find the magnitude and phase response over the frequency range of ${100}\mathrm{\;{Hz}}$ to 100 MHz.
## SOLUTION
The SPICE input file for this example is shown in Table 3.6-3. It is important to note that VIN has been defined as both an ac and a dc voltage source with a dc value of 1.07 V. If the dc voltage were not included, SPICE would find the dc solution for $\mathrm{{VIN}} = 0\mathrm{\;V}$ , which is not in the transition region. Therefore, the small-signal solution would not be evaluated in the transition region.
Table 3.6-3 SPICE Input File for Example 3.6-3
---
Ex. 3.6-3 AC Analysis of Fig. 3.6-4
$\mathrm{M}1\;2\;1\;0\;0\;\mathrm{{MOSN}}\;\mathrm{W} = 5\mathrm{U}\;\mathrm{L} = 1\mathrm{U}$
$\mathrm{M}2\;2\;3\;4\;4\;\mathrm{{MOSP}}\;\mathrm{W} = 5\mathrm{U}\;\mathrm{L} = 1\mathrm{U}$
$\mathrm{M}3\;3\;3\;4\;4\;\mathrm{{MOSP}}\;\mathrm{W} = 5\mathrm{U}\;\mathrm{L} = 1\mathrm{U}$
CL $2\;0\;5\mathrm{\;P}$
R1 3 0 100K
VDD 4 0 DC 5.0
VIN 1 0 DC 1.07 AC 1.0
. MODEL MOSN NMOS VTO = 0.7 KP = 110U GAMMA = 0.4 LAMBDA = 0.04
+ PHI = 0.7
MODEL MOSP PMOS VTO = $- {0.7}\;\mathrm{{KP}} = {50}\;\mathrm{U}\;\mathrm{{GAMMA}} = {0.57}\;\mathrm{{LAMBDA}} = {0.05}$
+ PHI = 0.8
AC DEC 20 100 100MEG
. OP
PRINT AC VM(2) VDB(2) VP(2)
. END
---
Once the dc solution has been evaluated, the amplitude of the signal applied as the ac input has no influence on the simulation. Thus, it is convenient to use ac inputs of unity in order to treat the output as a gain quantity. Here, we have assumed an ac input of ${1.0}\mathrm{\;V}$ peak.
The simulation desired is defined by the . AC DEC 20 100 100MEG line. This line directs SPICE to make an ac analysis over a log frequency with 20 points per decade from ${100}\mathrm{\;{Hz}}$ to ${100}\mathrm{{MHz}}$ . The . OP option has been added to print out the dc voltages of all circuit nodes in order to verify that the ac solution is in the desired region. The program will calculate the linear magnitude, dB magnitude, and phase of the output voltage. Figures 3.6-6(a) and 3.6-6(b) show the magnitude (dB) and the phase of this simulation.

Figure 3.6-6 (a) Magnitude response and (b) phase response of Example 3.6-3.
## Transient Analysis of Fig. 3.6-4
The last simulation to be made with Fig. 3.6-4 is the transient response to an input pulse. This simulation will include the $5\mathrm{{pF}}$ output capacitor of the previous example and will be made from time 0 to ${4\mu }\mathrm{s}$ .
## SOLUTION
Table 3.6-4 shows the SPICE input file. The input pulse is described using the piecewise linear capability (PWL) of SPICE. The output desired is defined by . TRAN 0.01U 4U, which asks for a transient analysis from 0 to ${4\mu }\mathrm{s}$ at points spaced every ${0.01\mu }\mathrm{s}$ . The output will consist of both ${v}_{\mathrm{{IN}}}\left( t\right)$ and ${v}_{\mathrm{{OUT}}}\left( t\right)$ and is shown in Fig. 3.6-7. The use of an asterisk at the beginning of a line causes that line to be ignored.
## Table 3.6-4 SPICE Output for Example 3.6-4
---
Ex. 3.6-4 Transient Analysis of Fig. 3.6-4
$\mathrm{M}1\;2\;1\;0\;0\;\mathrm{{MOSN}}\;\mathrm{W} = 5\mathrm{U}\;\mathrm{L} = 1\mathrm{U}$
$\mathrm{M}2\;2\;3\;4\;4\;\mathrm{{MOSP}}\mathrm{W} = 5\mathrm{U}\;\mathrm{L} = 1\mathrm{U}$
$\mathrm{M}3\;3\;4\;4\;\mathrm{{MOSP}}\mathrm{W} = 5\mathrm{U}\;\mathrm{L} = 1\mathrm{U}$
CL $2\;0\;5\mathrm{\;P}$
R1 3 0 100K
VDD 4 0 DC 5.0
VIN 1 0 PWL ( 0 0V 1U 0V 1.05U 3V 3U 3V 3.05U 0V 6U 0V )
*VIN 1 0 DC 21.07 AC 1.0
. MODEL MOSN NMOS VTO = 0.7 KP = 110U GAMMA = 0.4 LAMBDA = 0.04
$+ \mathrm{{PHI}} = {0.7}$
MODEL MOSP PMOS VTO = $- {0.7}\;\mathrm{{KP}} = {50}\mathrm{U}\;\mathrm{{GAMMA}} = {0.57}\;\mathrm{{LAMBDA}} =$
$+ {0.05}\mathrm{{PHI}} = {0.8}$
. TRAN 0.01U 4U
PRINT TRAN V ( 2 ) V ( 1 )
. END
---

Figure 3.6-7 Transient response of Example 3.6-4.
---
Example 3.6-4
---
The above examples will serve to introduce the reader to the basic ideas and concepts of using the SPICE program. In addition to what the reader has distilled from these examples, a useful set of guidelines is offered, which has resulted from extensive experience in using SPICE:
1. Never use a simulator unless you know the range of answers beforehand.
2. Never simulate more of the circuit than is necessary.
3. Always use the simplest model that will do the job.
4. Always start a dc solution from the point at which the majority of the devices are on.
5. Use a simulator in the same manner as you would make the measurement on the bench.
6. Never change more than one parameter at a time when using the simulator for design.
7. Learn the basic operating principles of the simulator so that you can enhance its capability. Know how to use its options.
8. Watch out for syntax problems like $\mathrm{O}$ and0.
9. Use the correct multipliers for quantities.
10. Use common sense.
Most problems with simulators can be traced back to a violation of one or more of these guidelines.
There are many SPICE simulators in use today. The discussion here focused on the more general versions of SPICE and should apply in most cases. However, there is nothing fundamental about the syntax or use of a circuit simulator, so it is prudent to carefully study the manual of the SPICE simulator you are using.

### 3.7 Summary
This chapter has tried to give the reader the background necessary to be able to simulate CMOS circuits. The approach used has been based on the SPICE simulation program. This program normally has three levels of MOS models that are available to the user. The function of models is to solve for the dc operating conditions and then use this information to develop a linear small-signal model. Section 3.1 described the LEVEL 1 model used by SPICE to solve for the dc operating point. This model also uses the additional model parameters presented in Section 3.2. These parameters include bulk resistance, capacitance, and noise. A small-signal model that was developed from the large-signal model was described in Section 3.3. These three sections represent the basic modeling concepts for MOS transistors.
Models for computer simulation were presented. The SPICE LEVEL 3 model, which is effective for device lengths of ${0.8\mu }\mathrm{m}$ and greater, was covered. The BSIM3v3 model, which is effective for deep-submicron devices, was introduced. Large-signal models suitable for weak inversion were also described. Further details of these models and other models are found in the references for this chapter. A brief background of simulation methods was presented in Section 3.6. Simulation of MOS circuits using SPICE was discussed. After studying this chapter, the reader should be able to use the model information presented along with a SPICE simulator to analyze MOS circuits. This ability will be very important in the remainder of this text. It will be used to verify intuitive design approaches and to perform analyses beyond the scope of the techniques presented. One of the important aspects of modeling is to determine the model parameters that best fit the MOS process being used. Appendix $\mathrm{C}$ will be devoted to this subject.
## Problems
3.1-1. Sketch to scale the transconductance characteristics of an enhancement n-channel device if ${V}_{T} = {0.7}\mathrm{\;V}$ and ${I}_{D} =$ ${500\mu }\mathrm{A}$ when ${V}_{GS} = 5\mathrm{\;V}$ in saturation. Choose values of ${V}_{GS} = 1,2,3,4$ , and $5\mathrm{\;V}$ . Assume that the channel modulation parameter is zero.
3.1-2. Sketch to scale the output characteristics of an enhancement p-channel device if ${V}_{T} =$ $- {0.7}\mathrm{\;V}$ and ${I}_{D} =  - {500\mu }\mathrm{A}$ when ${V}_{GS} =  - 5$ $\mathrm{V}$ in saturation. Choose values of ${V}_{GS} =$ $- 1, - 2, - 3, - 4$ , and $- 6\mathrm{\;V}$ . Assume that the channel modulation parameter is zero.
3.1-3. In Table 3.1-2, why is ${\gamma }_{P}$ greater than ${\gamma }_{N}$ for an n-well, CMOS technology?
3.1-4. A large-signal model for the MOSFET that features symmetry for the drain and source is given as
$$
{i}_{D} = {K}^{\prime }\frac{W}{L}\left\{  \left\lbrack  {{\left( {v}_{GS} - {V}_{TS}\right) }^{2}u\left( {{v}_{GS} - {V}_{TS}}\right) }\right\rbrack  \right.
$$
$$
- \left\lbrack  {{\left( {v}_{GD} - {v}_{TD}\right) }^{2}u\left( {{v}_{GD} - {v}_{TD}}\right) }\right\rbrack
$$
where $u\left( x\right)$ is 1 if $x$ is greater than or equal to zero and 0 if $x$ is less than zero (step function), and ${V}_{TX}$ is the threshold voltage evaluated from the gate to $X$ , where $X$ is either $S$ (source) or $D$ (drain). Sketch this model in the form of ${i}_{D}$ versus ${v}_{DS}$ for a constant value of ${v}_{GS}\left( {{v}_{GS} > {V}_{TS}}\right)$ and identify the saturated and nonsaturated regions. Be sure to extend this sketch for both positive and negative values of ${v}_{DS}$ . Repeat the sketch of ${i}_{D}$ versus ${v}_{DS}$ for a constant value of ${v}_{GD}\left( {{v}_{GD} > {V}_{TD}}\right)$ . Assume that both ${V}_{TS}$ and ${V}_{TD}$ are positive.
3.1-5. Equations (3.1-12) and (3.1-18) describe the MOS model in the nonsaturation and saturation region, respectively. These equations do not agree at the point of transition between saturation and nonsaturation regions. For hand calculations, this is not an issue, but for computer analysis, it is. How would you change Eq. (3.1-18) so that it would agree with Eq. (3.1-12) at ${v}_{DS} = {v}_{DS}$ (sat)?
3.2-1. Using the values of Tables 3.1-1 and 3.2-1, calculate the values of CGB, CGS, and CGD for an MOS device that has a $W$ of 5 $\mu \mathrm{m}$ and an $L$ of ${1\mu }\mathrm{m}$ for all three regions of operation.
3.2-2. Find ${C}_{BX}$ at $\left| {V}_{BX}\right|  = 0\mathrm{\;V}$ and ${0.75}\mathrm{\;V}$ (with the junction always reverse biased) of Fig. P3.2-2. The values of Table 3.2-1 apply to the MOS device, where $\mathrm{{FC}} = {0.5}$ and $\mathrm{{PB}}$ $= 1\mathrm{\;V}$ . Assume the device is n-channel and repeat for a p-channel device.

Figure P3.2-2
3.2-3. Calculate the values of ${C}_{GB},{C}_{GS}$ , and ${C}_{GD}$ for an n-channel device with a length of 1 $\mu \mathrm{m}$ and a width of ${5\mu }\mathrm{m}$ . Assume ${V}_{D} = 2$ $\mathrm{V},{V}_{G} = {2.4}\mathrm{\;V}$ , and ${V}_{S} = {0.5}\mathrm{\;V}$ and let ${V}_{B}$ $= 0$ V. Use model parameters from Tables 3.1-1, 3.1-2, and 3.2-1.
3.2-4. A layout of an NMOS transistor is shown in Fig. P3.2-4. (a) Find the values of ${RD}$ and ${RS}$ in the schematic shown if the sheet resistance of the ${\mathrm{n}}^{ + }$ is ${35\Omega }$ /sq. and the resistance of a single contact is ${1\Omega }$ . (b) Find the values of ${C}_{BD}$ and ${C}_{BS}$ assuming the transistor is cutoff and the drain and source are at ground potential if ${CJ}$ and CJSW for an NMOS transistor are ${770} \times$ ${10}^{-6}\mathrm{\;F}/{\mathrm{m}}^{2}$ and ${380} \times  {10}^{-{12}}\mathrm{\;F}/\mathrm{m}$ . Assume the capacitors are lumped and appear on the source/drain side of the bulk resistors in part (a). (c) What is the $W$ and $L$ of this transistor? (d) If the overlap capacitor/unit length is ${220} \times  {10}^{-{12}}\mathrm{\;F}/\mathrm{m}$ , what is ${C}_{GD}$ ?
3.2-5 A CMOS inverter is shown in Fig. P3.2-5 along with the top view of the circuit layout assuming a p-well CMOS technology. If this inverter is driving an identical inverter with the same layout, find the magnitude of the pole at the output of the first inverter $\left( {v}_{x}\right)$ and the input of the second inverter which is equal to the reciprocal product of the sum of all capacitances connected to this node and the output resistance which is assumed to be $1\mathrm{M}\Omega$ . Express this pole magnitude in $\mathrm{{Hz}}$ . Use the information in Table 3.2-1 to calculate the capacitances.

Figure P3.2-5
3.3-1. Calculate the transfer function ${v}_{\text{out }}\left( s\right) /{v}_{\text{in }}\left( s\right)$ for the circuit shown in Fig. P3.3-1. The $W/L$ of $\mathrm{M}1$ is ${2\mu }\mathrm{m}/{0.8\mu }\mathrm{m}$ and the $W/L$ of $\mathrm{M}2$ is ${4\mu }\mathrm{m}/{4\mu }\mathrm{m}$ . Note that this is a small-signal analysis and the input voltage has a dc value of $2\mathrm{\;V}$ .

Figure P3.3-1
3.3-2. Design a low-pass filter patterned after the circuit in Fig. P3.3-1 that achieves a $- 3\mathrm{{dB}}$ frequency of ${100}\mathrm{{kHz}}$ .
3.3-3. Repeat Examples 3.3-1 and 3.3-2 if the $W/L$ ratio is ${100\mu }\mathrm{m}/{10\mu }$ . Assume $\lambda  = {0.01}{\mathrm{\;V}}^{-1}$ .
3.3-4. Find the complete small-signal model for an $\mathrm{n}$ -channel transistor with the drain at $4\mathrm{\;V}$ , gate at $4\mathrm{\;V}$ , source at $2\mathrm{\;V}$ , and bulk at $0\mathrm{\;V}$ . Assume the model parameters from Tables ${3.1} - 1,{3.1} - 2$ , and ${3.2} - 1$ , and $W/L = {10\mu }\mathrm{m}/1$ μm.
3.3-5. Consider the circuit in Fig P3.3-5. It is a parallel connection of $n$ MOSFET transistors. Each transistor has the same length, $L$ , but each transistor can have a different width, $W$ . Derive an expression for $W$ and $L$ for a single transistor that replaces, and is equivalent to, the multiple parallel transistors.

Figure P3.3-5
3.3-6. Consider the circuit in Fig P3.3-6. It is a series connection of $n$ MOSFET transistors. Each transistor has the same width, $W$ , but each transistor can have a different length, $L$ . Derive an expression for $W$ and $L$ for a single transistor that replaces, and is equivalent to, the multiple series transistors. When using the simple model, you must ignore body effect.

Figure P3.3-6
3.5-1. Calculate the value for ${V}_{ON}$ for an NMOS transistor in weak inversion assuming that ${fs}$ and ${fn}$ can be approximated to be unity (1.0).
3.5-2. Develop an expression for the small-signal transconductance of an MOS device operating in weak inversion using the large-signal expression of Eq. (3.5-5).
3.5-3. Another way to approximate the transition from strong inversion to weak inversion is to find the current at which the weak inversion transconductance and the strong inversion transconductance are equal. Using this method and the approximation for drain current in weak inversion [Eq. (3.5-5)], derive an expression for drain current at the transition between strong and weak inversion.
3.6-1. Consider the circuit illustrated in Fig. P3.6- 1. (a) Write a SPICE netlist that describes this circuit. (b) Repeat part (a) with M2 being ${2\mu }\mathrm{m}/{1\mu }\mathrm{m}$ and M3 and M2 are ratio matched, 1:2.

Figure P3.6-1
3.6-2. Use SPICE to perform the following analyses on the circuit shown in Fig. P3.6-1: (a) Plot ${v}_{\mathrm{{OUT}}}$ versus ${v}_{\mathrm{{IN}}}$ for the nominal parameter set shown. (b) Separately, vary ${K}^{\prime }$ and ${V}_{T}$ by $+ {10}\%$ and repeat part (a)—four simulations.
<table><tr><td>Parameter</td><td>n-Channel</td><td>p-Channel</td><td>Units</td></tr><tr><td>${V}_{T}$</td><td>0.7</td><td>-0.7</td><td>V</td></tr><tr><td>${K}^{\prime }$</td><td>110</td><td>50</td><td>$\mu \mathrm{A}/{\mathrm{V}}^{2}$</td></tr><tr><td>1</td><td>0.04</td><td>0.05</td><td>${\mathrm{V}}^{-1}$</td></tr></table>
3.6-3. Use SPICE to plot ${i}_{2}$ as a function of ${v}_{2}$ when ${i}_{1}$ has values of10,20,30,40,50,60, and ${70\mu }\mathrm{A}$ for Fig. P3.6-3. The maximum value of ${v}_{2}$ is $5\mathrm{\;V}$ . Use the model parameters of ${V}_{T} = {0.7}\mathrm{\;V}$ and ${K}^{\prime } = {110\mu }\mathrm{A}/{\mathrm{V}}^{2}$ and $\lambda$ $= {0.01}{\mathrm{\;V}}^{-1}$ . Repeat with $\lambda  = {0.04}{\mathrm{\;V}}^{-1}$ .

Figure P3.6-3
3.6-4. Use SPICE to plot ${i}_{D}$ as a function of ${v}_{DS}$ for values of ${v}_{GS} = 1,2,3,4$ , and $5\mathrm{\;V}$ for an n-channel transistor with ${V}_{T} = 1\mathrm{\;V},{K}^{\prime } =$ ${110\mu }\mathrm{A}/{\mathrm{V}}^{2}$ , and $\lambda  = {0.04}{\mathrm{\;V}}^{-1}$ . Show how SPICE can be used to generate and plot these curves simultaneously as illustrated by Fig. 3.1-3.
3.6-5. Repeat Example 3.6-1 if the transistor of Fig. 3.6-2 is a PMOS having the model parameters given in Table 3.1-2.
3.6-6. Repeat Examples 3.6-2 through 3.6-4 for the circuit of Fig. 3.6-4 if $\mathrm{R}1 = {200}\mathrm{k}\Omega$ .
## References
1. Y. Tsividis, "Problems with Modeling of Analog MOS LSI," IEDM, pp. 274-277, 1982.
2. Star-Hspice User's Manual. Fremont, CA: Avant! 2000.
3. Yuhua Cheng and Chenming Hu, MOSFET Modeling & BSIM3 User's Guide. Norwell, MA: Kluwer Academic Publishers, 1999.
4. C. T. Sah, "Characteristics of the Metal-Oxide-Semiconductor Transistor," IEEE Transactions on Electron Devices, Vol. ED-11, No. 7, pp. 324-345, July 1964.
5. H. Shichman and D. Hodges, "Modelling and Simulation of Insulated-Gate Field-Effect Transistor Switching Circuts," IEEE J. Solid-State Circuits, Vol. SC-3, No. 3, pp. 285-289, Sept. 1968.
6. P. R. Gray, P. J. Hurst, S. H. Lewis, and R. G. Meyer, Analysis and Design of Analog Integrated Circuits, 4th ed. New York: John Wiley & Sons, 2001, pp. 62-63.
7. A. Vladimerescu, A. R. Newton, and D. O. Pederson, SPICE Version 2G. 0 User's Guide. University of California, Berkeley, Sept. 1980.
8. S. M. Sze and Kwok K. Ng, Physics of Semiconductor Devices, 3rd ed. Hoboken, NJ: John Wiley & Sons, Inc., 2007, pp. 36-38.
9. D. R. Alexander, R. J. Antinone, and G. W. Brown, SPICE Modelling Handbook, Report BDM/A-77-071-TR, BDM Corporation, 2600 Yale Blvd., Albuquerque, NM 87106.
10. P. R. Gray and R. G. Meyer, Analysis and Design of Analog Integrated Circuits, 2nd ed. New York: John Wiley & Sons, 1984, p. 646.
11. P. E. Allen and E. Sanchez-Sinencio, Switched Capacitor Circuits. New York: Van Nostrand Reinhold, 1984, p. 589
12. SmartSpice Modeling Manual, Vols. 1 and 2. Santa Clara, CA: Silvaco International, Sept. 1999.
13. Daniel P. Foty, MOSFET Modeling with SPICE: Principles and Practice. Scarborough, ON: Prentice Hall Canada, 1997.
14. G. Massobrio and P. Antognetti, Semiconductor Device Modeling with SPICE, 2nd ed. New York: McGraw-Hill, 1993.
15. F. H. Gaensslen and R. C. Jaeger, "Temperature Dependent Threshold Behavior of Depletion Mode MOSFET's," Solid-State Electronics, Vol. 22, No. 4, pp. 423-430, 1979.
16. J. R. Pierret, A MOS Parameter Extraction Program for the BSIM Model, Electronics Research Laboratory, University of California, Berkeley, CA, 94720. Memorandum No. UCB/ERL M84/99, Nov. 21, 1984.
17. Y. Tsividis, "Moderate Inversion In MOS Devices," Solid State Electronics, Vol. 25, No. 11, pp. 1099-1104, 1982.
18. P. Antognetti, D. D. Caviglia, and E. Profumo, "CAD Model for Threshold and Subthreshold Conduction in MOSFET's," IEEE J. Solid-State Circuits, Vol. SC-17, No. 2, pp. 454-458, June 1982.
19. S. M. Sze, Physics of Semiconductor Devices, 2nd ed. New York: John Wiley and Sons, 1981.
20. E. Vittoz and J. Fellrath, "CMOS Analog Integrated Circuits Based on Weak Inversion Operation," IEEE J. Solid-State Circuits, Vol. SC-12, No. 3, pp. 231-244, June 1977.
21. M. G. DeGrauwe, J. Rigmenants, E. Vittoz, and H. J. DeMan, "Adaptive Biasing CMOS Amplifiers," IEEE J. Solid-State Circuits, Vol. SC-17, No. 3, pp. 522-528, June 1982.
22. W. Steinhagen and W. L. Engl, "Design of Integrated Analog CMOS Circuits—A Multichannel Telemetry Transmitter," IEEE J. Solid-State Circuits, Vol. SC-13, No. 6, pp. 799-805, Dec. 1978.
23. Y. Tsividis and R. Ulmer, "A CMOS Voltage Reference," IEEE J. Solid-State Circuits, Vol. SC-13, No. 6, pp. 774-778, Dec. 1978.

F'rom the viewpoint of Table 1.1-2, the previous two chapters have provided the back- ground for understanding the technology and modeling of CMOS devices and com- ponents compatible with the CMOS process. The next step toward our objective-methodically developing the subject of CMOS analog circuit design-is to develop subcircuits. These simple circuits consist of one or more transistors and generally perform only one function. A subcircuit is typically combined with other simple circuits to generate a more complex circuit function. Consequently, the circuits of this and the next chapter can be considered as building blocks.
The operational amplifier, or op amp, to be covered in Chapters 6 and 7, is a good example of how simple circuits are combined to perform a complex function. Figure 4.0-1 presents a hierarchy showing how an operational amplifier-a complex circuit-might be related to various simple circuits. Working our way backward, we note that one of the stages of an op amp is the differential amplifier. The differential amplifier consists of simple circuits that might include a current sink, a current-mirror load, and a source-coupled pair. Another stage of the op amp is a second gain stage, which might consist of an inverter and a current-sink load. If the op amp is to be able to drive a low-impedance load, an output stage is necessary. The output stage might consist of a source follower and a current-sink load. It is also necessary to provide a stabilized bias for each of the previous stages. The biasing stage could consist of a current sink and current mirrors to distribute the bias currents to the other stages.
The subject of basic CMOS analog circuits has been divided into two chapters to avoid one lengthy chapter and yet provide sufficient detail. Chapter 4 covers the simpler subcircuits, including the MOS switch, active loads, current sinks/sources, current mirrors and current amplifiers, and voltage and current references. Chapter 5 will examine more complex circuits like CMOS amplifiers. That chapter represents a natural extension of the material presented in Chapter 4. Taken together, these two chapters are fundamental for the analog CMOS designer's understanding and capability, as most designs will start at this level and progress upward to synthesize the more complex circuits and systems of Table 1.1-2.

Figure 4.0-1 Illustration of the hierarchy of analog circuits for an operational amplifier.

### 4.1 MOS Switch
The switch finds many applications in integrated-circuit design. In analog circuits, the switch is used primarily to connect capacitors in various configurations. This application is called switched capacitor circuits. The switch is also useful for multiplexing, modulation, and a number of other applications. The switch is used as a transmission gate in digital circuits and adds a dimension of flexibility not found in standard logic circuits. The objective of this section is to study the characteristics of switches that are compatible with CMOS integrated circuits.
We begin with the characteristics of a voltage-controlled switch. Figure 4.1-1 shows a model for such a device. The voltage ${v}_{C}$ controls the state of the switch-ON or OFF. The voltage-controlled switch is a three-terminal network with terminals $A$ and ${B}^{ * }$ comprising the switch and terminal $C$ providing the means of applying the control voltage ${v}_{C}$ . The most important characteristics of a switch are its $\mathrm{{ON}}$ resistance, ${r}_{\mathrm{{ON}}}$ , and its $\mathrm{{OFF}}$ resistance, ${r}_{\mathrm{{OFF}}}$ . Ideally, ${r}_{\mathrm{{ON}}}$ is zero and ${r}_{\mathrm{{OFF}}}$ is infinite. Reality is such that ${r}_{\mathrm{{ON}}}$ is never zero and ${r}_{\mathrm{{OFF}}}$ is never infinite. Moreover, these values are never constant with respect to terminal conditions. In general, switches can have some form of voltage offset, which is modeled by ${V}_{OS}$ of Fig. 4.1-1. ${V}_{OS}$ represents the small voltage that may exist between terminals $A$ and $B$ when the switch is in the ON state and the current is zero. ${I}_{\text{OFF }}$ represents the leakage current that may flow in the OFF state of the switch. Currents ${I}_{A}$ and ${I}_{B}$ represent leakage currents from the switch terminals to ground (or some other supply potential). The polarities of the offset sources and leakage currents are not known and have arbitrarily been assigned the directions indicated in Fig. 4.1-1. The parasitic capacitors are an important consideration in the application of ana- $\log$ sampled-data circuits. Capacitors ${C}_{A}$ and ${C}_{B}$ are the parasitic capacitors between the switch terminals $A$ and $B$ and ground. Capacitor ${C}_{AB}$ is the parasitic capacitor between the switch terminals $A$ and $B$ . Capacitors ${C}_{AC}$ and ${C}_{BC}$ are parasitic capacitors that may exist between the voltage-control terminal $C$ and the switch terminals $A$ and $B$ . Capacitors ${C}_{AC}$ and ${C}_{BC}$ contribute to the effect called charge feedthrough-where a portion of the control voltage appears at the switch terminals $A$ and $B$ .

Figure 4.1-1 Model for a nonideal switch.
---
*The reader is cautioned not to confuse $B$ used in this section with $B$ used for the bulk terminal (see Fig. 3.1-1).
---
One advantage of MOS technology is that it provides a good switch. Figure 4.1-2 shows an MOS transistor that is to be used as a switch. Its performance can be determined by comparing Fig. 4.1-1 with the large-signal model for the MOS transistor. We see that either terminal, $A$ or $B$ , can be the drain or the source of the MOS transistor depending on the terminal voltages (e.g., for an n-channel transistor, if terminal $A$ is at a higher potential than $B$ , then terminal $A$ is the drain and terminal $B$ is the source). The ON resistance consists of the series combination of ${r}_{D}$ , ${r}_{S}$ , and whatever channel resistance exists. Typically, by design, the contribution from ${r}_{D}$ and ${r}_{S}$ is small such that the primary consideration is the channel resistance. An expression for the channel resistance can be found as follows. In the ON state of the switch, the voltage across the switch should be small and ${v}_{GS}$ should be large. Therefore, the MOS device is assumed to be in the nonsaturation region. Equation (3.1-1), repeated below, is used to model this state:
$$
{i}_{D} = \frac{{K}^{\prime }W}{L}\left\lbrack  {\left( {{v}_{GS} - {V}_{T}}\right) {v}_{DS} - \frac{{v}_{DS}^{2}}{2}}\right\rbrack   \tag{4.1-1}
$$
where ${v}_{DS}$ is less than ${v}_{GS} - {V}_{T}$ but greater than zero. ( ${v}_{GS}$ becomes ${v}_{GD}$ if ${v}_{DS}$ is negative.) The small-signal channel resistance is given as
$$
{r}_{\mathrm{{ON}}} = {\left. \frac{1}{\partial {i}_{D}/\partial {v}_{DS}}\right| }_{\mathrm{Q}} = \frac{L}{{K}^{\prime }W\left( {{V}_{GS} - {V}_{T} - {V}_{DS}}\right) } \tag{4.1-2}
$$
where Q in Eq. (4.1-2) designates the quiescent point of the transistor. Figure 4.1-3 illustrates the drain current of an n-channel transistor as a function of the voltage across the drain and source terminals, plotted for equal increasing steps of ${V}_{GS}$ for $W/L = 5/1$ . This figure illustrates some very important principles about MOS transistor operation. Note that the curves are not symmetrical about ${V}_{1} = 0$ . This is because the transistor terminals (drain and source) switch roles as ${V}_{1}$ crosses $0\mathrm{\;V}$ . For example, when ${V}_{1}$ is positive, node $B$ is the drain and node $A$ is the source and ${V}_{BS}$ is fixed at $- {2.5}\mathrm{\;V}$ and ${V}_{GS}$ is fixed as well (for a given ${V}_{G}$ ). When ${V}_{1}$ is negative, node $B$ is the source and node $A$ is the drain and as ${V}_{1}$ continues to decrease, ${V}_{BS}$ decreases and ${V}_{GS}$ increases, resulting in an increase in current.

Figure 4.1-2 An n-channel transistor used as a switch.

Figure 4.1-3 I-V characteristic of an n-channel transistor operating as a switch.
A plot of ${r}_{\mathrm{{ON}}}$ as a function of ${V}_{GS}$ is shown in Fig. 4.1-4 for ${V}_{DS} = {0.1}\mathrm{\;V}$ and for $W/L = 1$ , 2,5, and 10. It is seen that a lower value of ${r}_{\mathrm{{ON}}}$ is achieved for larger values of $W/L$ . When ${V}_{GS}$ approaches ${V}_{T}\left( {{V}_{T} = {0.7}\mathrm{\;V}}\right.$ in this case), ${r}_{ON}$ approaches infinity because the switch is turning off.
When ${V}_{GS}$ is less than or equal to ${V}_{T}$ , the switch is $\mathrm{{OFF}}$ and ${r}_{\mathrm{{OFF}}}$ is ideally infinite. Of course, it is never infinite, but because it is so large, the performance in the OFF state is dominated by the drain-bulk and source-bulk leakage current as well as subthreshold leakage from drain to source. The leakage from drain and source to bulk is primarily due to the pn junction leakage current and is modeled in Fig. 4.1-1 as ${I}_{A}$ and ${I}_{B}$ . Typically, this leakage current is on the order of $1\mathrm{{fA}}/\mu {\mathrm{m}}^{2}$ at room temperature and doubles for every $8{}^{ \circ  }\mathrm{C}$ increase (see Example 2.5-1).
The offset voltage modeled in Fig. 4.1-1 does not exist in MOS switches and thus is not a consideration in MOS switch performance. The capacitors ${C}_{A},{C}_{B},{C}_{AC}$ , and ${C}_{BC}$ of Fig. 4.1-1 correspond directly to the capacitors ${C}_{BS},{C}_{BD},{C}_{GS}$ , and ${C}_{GD}$ of the MOS transistor (see Fig. 3.2-1). ${C}_{AB}$ is small for the MOS transistor and is usually negligible.

Figure 4.1-4 Illustration of ON resistance for an n-channel transistor.

Figure 4.1-5 Application of an n-channel transistor as a switch with typical terminal voltages indicated.
One important aspect of the switch is the range of voltages on the switch terminals compared to the control voltage. For the n-channel MOS transistor we see that the gate voltage must be considerably larger than either the drain or source voltage in order to ensure that the MOS transistor is ON. (For the p-channel transistor, the gate voltage must be considerably less than either the drain or source voltage.) Typically, the bulk is taken to the most negative potential for the n-channel switch (positive for the p-channel switch). This requirement can be illustrated as follows for the n-channel switch. Suppose that the ON voltage of the gate is the positive power supply ${V}_{DD}$ . With the bulk to ground this should keep the n-channel switch ON until the signal on the switch terminals (which should be approximately identical at the source and drain) approaches ${V}_{DD} - {V}_{T}$ . As the signal approaches ${V}_{DD} - {V}_{T}$ the switch begins to turn OFF. Typical voltages used for an n-channel switch are shown in Fig. 4.1-5, where the switch is connected between the two networks shown.
Consider the use of a switch to charge a capacitor as shown in Fig. 4.1-6. An n-channel transistor is used as a switch and ${V}_{\phi }$ is the control voltage (clock) applied to the gate. The ON resistance of the switch is important during the charge transfer phase of this circuit. For example, when ${V}_{\phi }$ goes high $\left( {{V}_{\phi } > {v}_{\text{in }} + {V}_{T}}\right)$ , M1 connects $C$ to the voltage source ${v}_{\text{in }}$ . The equivalent circuit at this time is shown in Fig. 4.1-7. It can be seen that $C$ will charge to ${v}_{\text{in }}$ with the time constant of ${r}_{\mathrm{{ON}}}C$ . For successful operation ${r}_{\mathrm{{ON}}}C \ll  T$ , where $T$ is the time ${V}_{\phi }$ is high. Clearly, ${r}_{\mathrm{{ON}}}$ varies greatly with ${v}_{GS}$ , as illustrated in Fig. 4.1-4. The worst-case value for ${r}_{\mathrm{{ON}}}$ (the highest value), during the charging of $C$ , is when ${v}_{DS} = 0$ and ${v}_{GS} = {V}_{\phi } - {v}_{in}$ . This value should be used when sizing the transistor to achieve the desired charging time.
Consider a case where the time ${V}_{\phi }$ is high is $T = {0.1\mu }\mathrm{s}$ and $C = {0.2}\mathrm{{pF}}$ ; then ${r}_{\mathrm{{ON}}}$ must be less than ${100}\mathrm{\;k}\Omega$ if sufficient charge transfer occurs in five time constants. For a $5\mathrm{\;V}$ clock swing and ${v}_{in}$ of ${2.5}\mathrm{\;V}$ , the MOS device of Fig. ${4.1} - 4$ with $W = L$ gives ${r}_{\mathrm{{ON}}}$ of approximately ${6.4}\mathrm{k}\Omega$ , which is sufficiently small to transfer the charge in the desired time. It is desirable to keep the switch size as small as possible (minimize $W \times  L$ ) to minimize charge feedthrough from the gate.

Figure 4.1-6 An application of an MOS switch.

Figure 4.1-7 Model for the ON state of the switch in Fig. 4.1-6.
The OFF state of the switch has little influence on the performance of the circuit in Fig. 4.1- 6 except for the leakage current. Figure 4.1-8 shows a sample-and-hold circuit where the leakage current can create serious problems. If ${C}_{H}$ is not large enough, then in the hold mode where the MOS switch is OFF the leakage current can charge or discharge ${C}_{H}$ a significant amount.
Switches are often used to switch capacitors from one configuration to another. In this application, the capacitance of the switch becomes important. There are two types of capacitors that are associated with the MOSFET switch: capacitors with one terminal connected to the gate and the drain- and source-to-bulk depletion capacitors. The gate capacitors can cause charge injection onto the capacitors that they are switching while the depletion capacitors influence the value of the switched capacitors as parasitics. Since the impact of the depletion capacitors can be eliminated by circuit techniques [1] we will deal only with the influence of the gate capacitors.
Figure 4.1-9 is a useful model for studying the charge injection of the MOSFET switch. Figure 4.1-9(b) illustrates modeling a transistor with the channel symbolized as a resistor, ${R}_{\text{channel }}$ , and gate-channel coupling capacitance, denoted ${C}_{\text{channel }}$ . The values of ${C}_{\text{channel }}$ and ${R}_{\text{channel }}$ depend on the terminal conditions of the device. The gate-channel coupling is distributed across the channel as is the channel resistance, ${R}_{\text{channel }}$ . In addition to the channel capacitance, there is the overlap capacitance, CGSO and CGDO.
It is convenient to approximate the total channel capacitance by splitting it into two capacitors of equal size placed at the gate-source and gate-drain terminals as illustrated in Fig. 4.1-9(c). These capacitors represent the charge that is stored in the channel of the MOSFET switch. In addition to these capacitors, there are the overlap capacitors, ${C}_{GSO}$ and ${C}_{GDO}$ . We will keep these two capacitors distinct because they cause different forms of charge transfer during the operation of the switch. For example, when the switch is ON, there is a charge in the channel, which must be removed before the switch can turn OFF. The flow of this charge from the channel to the switch terminals is called channel charge injection. In addition to the channel charge injection, the clock at the gate of the switch is connected to the switch terminals by the overlap capacitors. If there is any change of voltage across these capacitors, there will be a corresponding charge flow, which is called clock feedthrough. We see there can be clock feedthrough whenever there is a change in the gate voltage with respect to the switch terminals regardless of whether the switch is ON or OFF.

Figure 4.1-8 Example of the influence of ${I}_{\mathrm{{OFF}}}$ in a sample-and-hold circuit.

Figure 4.1-9 (a) Simple switch circuit useful for studying charge injection. (b) Distributed model for the transistor switch. (c) Lumped model of Fig. 4.1-9(a).
Let us first consider the channel charge injection using Fig. 4.1-9(a). When the switch is ON, a charge will be stored in the channel, which is equal to
$$
{Q}_{\text{channel }} =  - {WL}{C}_{ox}\left( {{V}_{H} - {v}_{\text{in }} - {V}_{T}}\right)  \tag{4.1-3}
$$
where ${V}_{H}$ is the value of the clock waveform applied to the gate when the switch is $\mathrm{{ON}}$ , for example, ${V}_{H} \approx  {V}_{DD}$ and ${v}_{in} = {V}_{S}$ . When the switch turns OFF, this charge is injected into the source and drain terminals. If we assume the charge splits evenly, then half goes to the input voltage source, ${v}_{in}$ , and the other half to ${C}_{L}$ . The half that goes through ${C}_{L}$ creates a change in voltage across ${C}_{L}$ given as
$$
{\Delta V} = \frac{{Q}_{ch}}{2{C}_{L}} = \frac{-{WL}{C}_{ox}\left( {{V}_{H} - {v}_{in} - {V}_{T}}\right) }{2{C}_{L}} \tag{4.1-4}
$$
The charge injection does not influence ${v}_{in}$ because it is a voltage source. We see from Eq. (4.1-4) that the channel charge injection is a function of the input voltage and will vary as the input voltage changes. We also know that the channel charge will have a time constant that is equal to the resistance of the channel times the channel capacitance.
Clock feedthrough (sometimes called charge injection and charge feedthrough) allows charge to be transferred from the gate signal (which is generally a clock) to the drain and source nodes-an undesirable but unavoidable effect. Clock feedthrough involves a complex process whose resulting effects depend on a number of factors such as the layout of the transistor, its dimensions, impedance levels at the source and drain nodes, and gate waveform. It is hopeless to attempt to describe all of these effects precisely analytically-we have computers to do that! Nevertheless, it is useful to develop a qualitative understanding of this important effect.
For the circuit in Fig. 4.1-9, it is of interest to examine the charge flow in the switch during a high-to-low transition at the gate of ${\phi }_{1}$ . Moreover, it is convenient to consider two cases regarding the gate transition-a fast transition time and a slow transition time. Consider the slow-transition case first (what is meant by slow and fast will be covered shortly). As the gate is falling, some charge is being injected into the channel. However, initially, the transistor remains on so that whatever charge is injected flows in the input voltage source, ${V}_{S}$ . None of this charge will appear on the load capacitor, ${C}_{L}$ . As the gate voltage falls, at some point, the transistor turns off (when the gate voltage reaches ${V}_{S} + {V}_{T}$ ). After the transistor turns off, there is no other path for the charge injection other than through ${C}_{L}$ .
For the fast case, the time constant associated with the channel resistance and the channel capacitance limits the amount of charge that can flow to the source voltage so that some of the channel charge that is injected while the transistor is on contributes to the total charge on ${C}_{L}$ .
To develop some intuition about the fast and slow cases, it is useful to model the gate voltage as a piecewise constant waveform (a quantized waveform) and consider the charge flow at each transition as illustrated in Figs. 4.1-10(a) and 4.1-10(b). In these figures, the range of voltage across ${C}_{L}$ illustrated represents the period while the transistor is on. In both cases, the quantized voltage step, $\Delta \mathrm{V}$ , is the same, but the time between steps is different. The voltage across ${C}_{L}$ is observed to be an exponential whose time constant is due to the channel resistance and channel capacitance and does not change from the fast case to the slow case.

Figure 4.1-10 Illustration of (a) slow ramp and (b) fast ramp using a quantized voltage ramp to illustrate the effects due to the time constant of the channel resistance and capacitance.
Analytical expressions have been derived that describe the approximate operation of a transistor in the slow and fast regimes and include both channel charge injection and clock feedthrough [2]. Consider the gate voltage traversing from ${V}_{H}$ to ${V}_{L}$ (e.g., ${5.0}\mathrm{\;V}$ to ${0.0}\mathrm{\;V}$ , respectively) described in the time domain as
$$
{v}_{G} = {V}_{H} - {Ut} \tag{4.1-5}
$$
where $U$ is the magnitude of the slope of ${v}_{G}\left( t\right)$ . When operating in the slow regime defined by the relationship
$$
\frac{\beta {V}_{HT}^{2}}{2{C}_{L}} >  > U \tag{4.1-6}
$$
where ${V}_{HT}$ is defined as
$$
{V}_{HT} = {V}_{H} - {V}_{S} - {V}_{T} \tag{4.1-7}
$$
the error (the difference between the desired voltage ${V}_{S}$ and the actual voltage ${V}_{{C}_{L}}$ ) due to charge injection can be described as
$$
{V}_{\text{error }} = \left( \frac{W \cdot  \operatorname{CGDO} + \frac{{C}_{\text{channel }}}{2}}{{C}_{L}}\right) \sqrt{\frac{{\pi U}{C}_{L}}{2\beta }} + \frac{W \cdot  \operatorname{CGDO}}{{C}_{L}}\left( {{V}_{S} + {V}_{T} - {V}_{L}}\right)  \tag{4.1-8}
$$
In the fast switching regime defined by the relationship
$$
\frac{\beta {V}_{HT}^{2}}{2{C}_{L}} <  < U \tag{4.1-9}
$$
the error voltage is given as
$$
{V}_{\text{error }} = \left( \frac{W \cdot  \operatorname{CGDO} + \frac{{C}_{\text{channel }}}{2}}{{C}_{L}}\right) \left( {{V}_{HT} - \frac{\beta {V}_{HT}^{3}}{{6U}{C}_{L}}}\right)  + \frac{W \cdot  \operatorname{CGDO}}{{C}_{L}}\left( {{V}_{S} + {V}_{T} - {V}_{L}}\right)  \tag{4.1-10}
$$
The following example illustrates the application of the charge feedthrough model given by Eqs. (4.1-5) through (4.1-10).
Example
## Calculation of Charge Feedthrough Error
4.1-1 Calculate the effect of charge feedthrough on the circuit shown in Fig. 4.1-9, where ${V}_{S} =$ ${1.0}\mathrm{\;V},{C}_{L} = {200}\mathrm{{fF}}, W/L = {0.8\mu }\mathrm{m}/{0.8\mu }\mathrm{m}$ , and ${V}_{G}$ is given for two cases illustrated below. Use model parameters from Tables 3.1-2 and 3.2-1. Neglect ${\Delta L}$ and ${\Delta W}$ effects. SOLUTION Case 1: The first step is to determine the value of $U$ in the expression
$$
{v}_{G} = {V}_{H} - {Ut}
$$
For a transition from $5\mathrm{\;V}$ to $0\mathrm{\;V}$ in ${0.2}\mathrm{\;{ns}}, U = {25} \times  {10}^{9}\mathrm{\;V}/\mathrm{s}$ . In order to determine operating regime, the following relationship must be tested:
$$
\frac{\beta {V}_{HT}^{2}}{2{C}_{L}} \gg  U\text{ for slow or }\frac{\beta {V}_{HT}^{2}}{2{C}_{L}} \ll  U\text{ for fast }
$$

Observing that there is a backbias on the transistor switch affecting ${V}_{T},{V}_{HT}$ is
$$
{V}_{HT} = {V}_{H} - {V}_{S} - {V}_{T} = 5 - 1 - {0.887} = {3.113}
$$
giving
$$
\frac{\beta {V}_{HT}^{2}}{2{C}_{L}} = \frac{{110} \times  {10}^{-6} \times  {3.113}^{2}}{2 \times  {200} \times  {10}^{-{15}}} = {2.66} \times  {10}^{9} \ll  {25} \times  {10}^{9}\;\text{thus fast regime}
$$
Applying Eq. (4.1-10) for the fast regime yields
$$
{V}_{\text{error }} = \left( \frac{{176} \times  {10}^{-{18}} + \frac{{1.58} \times  {10}^{-{15}}}{2}}{{200} \times  {10}^{-{15}}}\right) \left( {{3.113} - \frac{{3.32} \times  {10}^{-3}}{{30} \times  {10}^{-3}}}\right)
$$
$$
+ \frac{{176} \times  {10}^{-{18}}}{{200} \times  {10}^{-{15}}}\left( {5 + {0.887} - 0}\right)
$$
${V}_{\text{error }} = {19.7}\mathrm{{mV}}$
Case 2: The first step is to determine the value of $U$ in the expression
$$
{v}_{G} = {V}_{H} - {Ut}
$$
For a transition from $5\mathrm{\;V}$ to $0\mathrm{\;V}$ in ${10}\mathrm{\;{ns}}, U = 5 \times  {10}^{8}$ , thus indicating the slow regime according to the following test:
$$
{2.66} \times  {10}^{9} \gg  5 \times  {10}^{8}
$$
$$
{V}_{\text{error }} = \left( \frac{{176} \times  {10}^{-{18}} + \frac{{1.58} \times  {10}^{-{15}}}{2}}{{200} \times  {10}^{-{15}}}\right) {\left( \frac{{314} \times  {10}^{-6}}{{220} \times  {10}^{-6}}\right) }^{1/2}
$$
$$
+ \frac{{176} \times  {10}^{-{18}}}{{200} \times  {10}^{-{15}}}\left( {5 + {0.887} - 0}\right)
$$
${V}_{\text{error }} = {10.95}\mathrm{{mV}}$
This example illustrates the application of the charge feedthrough model. The reader should be cautioned not to expect Eqs. (4.1-5) through (4.1-10) to give precise answers regarding the amount of charge feedthrough one should expect in an actual circuit. The model should be used as a guide in understanding the effects of various circuit elements and terminal conditions in order to minimize unwanted behavior by design.
It is possible to partially cancel some of the feedthrough effects using the technique illustrated in Fig. 4.1-11. Here a dummy MOS transistor MD (with source and drain both attached to the signal line and the gate attached to the inverse clock) is used to apply an opposing clock feedthrough due to M1. The area of MD can be designed to provide minimum clock feedthrough. Typically, ${W}_{D}/{L}_{D} \approx  {0.5}{W}_{1}/{L}_{1}$ . Unfortunately, this method never completely removes the feedthrough and in some cases may worsen it. Also, it is necessary to generate an inverted clock, which is applied to the dummy switch. Clock feedthrough can be reduced by using the largest capacitors possible, using minimum-geometry switches, and keeping the clock swings as small as possible. Typically, these solutions will create problems in other areas, requiring some compromises.
The dynamic range limitations associated with single-channel MOS switches can be avoided with the CMOS switch shown in Fig. 4.1-12. Using CMOS technology, a switch is usually constructed by connecting p-channel and n-channel enhancement transistors in parallel as illustrated. For this configuration, when $\phi$ is low, both transistors are off, creating an effective open circuit. When $\phi$ is high, both transistors are on, giving a low-impedance state. The bulk potentials of the p-channel and the n-channel devices are taken to the highest and lowest potentials, respectively. The primary advantage of the CMOS switch over the single-channel MOS switch is that the dynamic analog-signal range in the ON state is greatly increased.

Figure 4.1-11 The use of a dummy transistor to cancel clock feedthrough.

Figure 4.1-12 A CMOS switch.
The increased dynamic range of the analog signal is evident in Fig. 4.1-13, where the on resistance of a CMOS switch is plotted as a function of the input voltage. In this figure, the p-channel and n-channel devices are sized in such a way that they have equivalent resistance with identical terminal conditions. The double-peak behavior is due to the n-channel device dominating when ${v}_{\text{in }}$ is low and the p-channel dominating when ${v}_{\text{in }}$ is high (near ${V}_{DD}$ ). At the midrange (near ${V}_{DD}/2$ ), the parallel combination of the two devices results in a minimum. The dip at midrange is due to mobility degradation effects and is not evident when analyzed using the LEVEL 1 model.
In many switch applications, the voltage available to turn on the switch is not large enough. This is particularly true as the power supply voltages decrease or if the voltage to be switched is midway between the power supply rails. In these cases, it is necessary to generate a gate overdrive voltage. Charge pumps are used to accomplish the gate overdrive voltage. Figure 4.1-14 shows one method of generating a gate overdrive in a CMOS technology. The operation of this circuit is straightforward. To more easily understand the basic principle of the circuit, first ignore M4, M5, M7, and M8. Consider the other transistors (M1, M2, M3, and M6) as simple switches. During the phase when ${\phi }_{A}$ is high and ${\phi }_{B}$ is low, ${C}_{\text{PUMP }}$ is charged with the full supply voltage. When ${\phi }_{A}$ goes low and ${\phi }_{B}$ goes high, M1 turns on along with M6, dumping a portion of the charge in ${C}_{\mathrm{{PUMP}}}$ into ${C}_{\mathrm{{HOLD}}}$ , causing ${v}_{DBL}$ to go positive. If both capacitors are equal and the charge is transferred ideally, then after the first pump, ${v}_{DBL}$ will be equal to ${V}_{DD} + {0.5}\left( {{V}_{DD} - {V}_{SS}}\right)$ . After many cycles, ${v}_{DBL}$ will be at $2{V}_{DD}$ with respect to ${V}_{SS}$ (assuming there is no current drain on the ${v}_{DBL}$ node). The switches M4, M5, M7, and M8 are for the purpose of keeping the bulk sources of M3 and M6 reverse biased during the operation of the charge pump.

Figure 4.1-13 ${r}_{\mathrm{{ON}}}$ of Fig 4.1-12 as a function of the voltage ${v}_{\text{in }}$ .

Figure 4.1-14 Voltage doubler used to provide gate overdrive.
In this section we have seen that MOS transistors make one of the best switch realizations available in integrated-circuit form. They require small area, dissipate very little power, and provide reasonable values of ${r}_{\mathrm{{ON}}}$ and ${r}_{\mathrm{{OFF}}}$ for most applications. The inclusion of a good realization of a switch into the designer's basic building blocks will produce some interesting and useful circuits and systems that will be studied in the following chapters.

### 4.2 MOS Diode/Active Resistor
When the gate and drain of an MOS transistor are tied together as illustrated in Figs. 4.2-1(a) and 4.2-1(b), the $I - V$ characteristics are qualitatively similar to a pn-junction diode, thus the name MOS diode. The MOS diode is used as a component of a current mirror (Section 4.4) and for level translation (voltage drop).
The $I - V$ characteristics of the MOS diode are illustrated in Fig. 4.2-1(c) and described by the large-signal equation for drain current in saturation (the connection of the gate to the drain guarantees operation in the saturation region) shown below.
$$
I = {I}_{D} = \left( \frac{{K}^{\prime }W}{2L}\right) \left\lbrack  {\left( {V}_{GS} - {V}_{T}\right) }^{2}\right\rbrack   = \frac{\beta }{2}{\left( {V}_{GS} - {V}_{T}\right) }^{2} \tag{4.2-1}
$$
$$
V = {V}_{GS} = {V}_{DS} = {V}_{T} + \sqrt{2{I}_{D}/\beta } \tag{4.2-2}
$$
If $V$ or $I$ is given, then the remaining variable can be designed using either Eq. (4.2-1) or Eq. (4.2-2) and solving for the value of $\beta$ .

Figure 4.2-1 Active resistor. (a) n-Channel. (b) p-Channel. (c) $I - V$ characteristics for n-channel case. (d) Small-signal model.
Connecting the gate to the drain means that ${v}_{DS}$ controls ${i}_{D}$ and therefore the channel transconductance becomes a channel conductance. The small-signal model of an MOS diode (excluding capacitors) is shown in Fig. 4.2-1(d). It is easily seen that the small-signal resistance of an MOS diode is
$$
{r}_{\text{out }} = \frac{1}{{g}_{m} + {g}_{mbs} + {g}_{ds}} \cong  \frac{1}{{g}_{m}} \tag{4.2-3}
$$
where ${g}_{m}$ is greater than ${g}_{mbs}$ or ${g}_{ds}$ .
An illustration of the application of the MOS diode is shown in Fig. 4.2-2, where a bias voltage is generated with respect to ground (the value of such a circuit will become obvious later). Noting that ${V}_{DS} = {V}_{GS}$ for both devices,
$$
{V}_{DS} = \sqrt{{2I}/\beta } + {V}_{T} = {V}_{ON} + {V}_{T} \tag{4.2-4}
$$
$$
{V}_{\text{BIAS }} = {V}_{DS1} + {V}_{DS2} = 2{V}_{ON} + 2{V}_{T} \tag{4.2-5}
$$
The MOS switch described in Section 4.1 and illustrated in Fig. 4.1-2 can be viewed as a resistor, albeit rather nonlinear, as illustrated in Fig. 4.1-4. The nonlinearity can be mitigated where the drain and source voltages vary over a small range so that the transistor ON resistance can be approximated as small-signal resistance. Figure 4.2-3 illustrates this point showing a configuration where the transistor's drain and source form the two ends of a "floating" resistor. For the small-signal premise to be valid, ${v}_{DS}$ is assumed small. The $I - V$ characteristics of the floating resistor are given by Fig. 4.1-3. Consequently, the range of resistance values is large but nonlinear. When the transistor is operated in the nonsaturation region, the resistance can be calculated from Eq. (4.1-2), repeated below, where ${v}_{DS}$ is assumed small.
$$
{r}_{ds} = \frac{L}{{K}^{\prime }W\left( {{V}_{GS} - {V}_{T}}\right) } \tag{4.2-6}
$$

---
Example 4.2-1
---
## Calculation of the Resistance of an Active Resistor
The floating active resistor of Fig. 4.2-3 is to be used to design a $1\mathrm{k}\Omega$ resistance. The dc value of ${V}_{A, B} = 2\mathrm{\;V}$ . Use the device parameters in Table 3.1-2 and assume the active resistor is an n-channel transistor with the gate voltage at $5\mathrm{\;V}$ . Assume that ${V}_{DS} = {0.0}$ . Calculate the required $W/L$ to achieve $1\mathrm{\;k}\Omega$ resistance. The bulk terminal is ${0.0}\mathrm{\;V}$ .
## SOLUTION
Before applying Eq. (4.2-6), it is necessary to calculate the new threshold voltage, ${V}_{T}$ , due to ${V}_{BS}$ not being zero $\left( {\left| {V}_{BS}\right|  = 2\mathrm{\;V}}\right)$ . From Eq. (3.1-2) the new ${V}_{T}$ is found to be 1.022 V. Equating Eq. (4.2-6) to ${1000\Omega }$ gives a $W/L$ of ${4.597} \cong  {4.6}$ .

### 4.3 Current Sinks and Sources
A current sink and current source are two terminal components whose current at any instant of time is independent of the voltage across their terminals. The current of a current sink or source flows from the positive node, through the sink or source, to the negative node. A current sink typically has the negative node at ${V}_{SS}$ and the current source has the positive node at ${V}_{DD}$ . Figure 4.3-1(a) shows the MOS implementation of a current sink. The gate is taken to whatever voltage is necessary to create the desired value of current. The voltage divider of Fig. 4.2-2 can be used to provide this voltage. We note that in the nonsaturation region the MOS device is not a good current source. In fact, the voltage across the current sink must be larger than ${V}_{\mathrm{{MIN}}}$ in order for the current sink to perform properly. For Fig. 4.3-1(a) this means that
$$
{v}_{\mathrm{{OUT}}} \geq  {V}_{GG} - {V}_{T0} \tag{4.3-1}
$$

Figure 4.3-1 (a) Current sink. (b) Current-voltage characteristics of (a).
If the gate-source voltage is held constant, then the large-signal characteristics of the MOS transistor are given by the output characteristics of Fig. 3.1-3. An example is shown in Fig. 4.3-1(b). If the source and bulk are both connected to ground, then the small-signal output resistance is given by [see Eq. (3.3-9)]
$$
{r}_{\text{out }} = \frac{1 + \lambda {V}_{DS}}{\lambda {I}_{D}} \cong  \frac{1}{\lambda {I}_{D}} \tag{4.3-2}
$$
If the source and bulk are not connected to the same potential, the characteristics will not change as long as ${V}_{BS}$ is a constant.
Figure 4.3-2(a) shows an implementation of a current source using a p-channel transistor. Again, the gate is taken to a constant potential as is the source. With the definition of ${v}_{\mathrm{{OUT}}}$ and ${i}_{\mathrm{{OUT}}}$ of the source as shown in Fig. 4.3-2(a), the large-signal $I - V$ characteristic is shown in Fig. 4.3-2(b). The small-signal output resistance of the current source is given by Eq. (4.3-2). The source-drain voltage must be larger than ${V}_{\mathrm{{MIN}}}$ for this current source to work properly. This current source works only for values of ${v}_{\mathrm{{OUT}}}$ given by
$$
{v}_{\text{OUT }} \leq  {V}_{GG} + \left| {V}_{T0}\right|  \tag{4.3-3}
$$

Figure 4.3-2 (a) Current source. (b) Current-voltage characteristics of (a).
The advantage of the current sink and source of Figs. 4.3-1(a) and 4.3-2(a) is their simplicity. However, there are two areas in which their performance may need to be improved for certain applications. One improvement is to increase the small-signal output resistance-resulting in a more constant current over the range of ${v}_{\mathrm{{OUT}}}$ values. The second is to reduce the value of ${V}_{\mathrm{{MIN}}}$ , thus allowing a larger range of ${v}_{\mathrm{{OUT}}}$ over which the current sink/source works properly. We shall illustrate methods to improve both areas of performance. First, the small-signal output resistance can be increased using the principle illustrated in Fig. 4.3-3(a). This principle uses the common-gate configuration to multiply the source resistance $r$ by the approximate voltage gain of the common-gate configuration with an infinite load resistance. The exact small-signal output resistance ${r}_{\text{out }}$ can be calculated from the small-signal model of Fig. 4.3-3(b) as
$$
{r}_{\text{out }} = \frac{{v}_{\text{out }}}{{i}_{\text{out }}} = r + {r}_{ds2} + \left\lbrack  {\left( {{g}_{m2} + {g}_{mbs2}}\right) {r}_{ds2}}\right\rbrack  r \cong  \left( {{g}_{m2}{r}_{ds2}}\right) r \tag{4.3-4}
$$
where ${g}_{m2}{r}_{ds2} >  > 1$ and ${g}_{m2} > {g}_{mbs2}$ .
The above principle is implemented in Fig. 4.3-4(a), where the output resistance $\left( {r}_{ds1}\right)$ of the current sink of Fig. 4.3-1(a) should be increased by the common-gate voltage gain of M2. To verify the principle, the small-signal output resistance of the cascode current sink of Fig. 4.3-4(a) will be calculated using the model of Fig. 4.3-4(b). Since ${v}_{gs2} =  - {v}_{1}$ and ${v}_{gs1} = 0$ , summing the currents at the output node gives
$$
{i}_{\text{out }} + {g}_{m2}{v}_{1} + {g}_{mbs2}{v}_{1} = {g}_{ds2}\left( {{v}_{\text{out }} - {v}_{1}}\right)  \tag{4.3-5}
$$
Since ${v}_{1} = {i}_{\text{out }}{r}_{ds1}$ , we can solve for ${r}_{\text{out }}$ as
$$
{r}_{\text{out }} = \frac{{v}_{\text{out }}}{{i}_{\text{out }}} = {r}_{ds2}\left( {1 + {g}_{m2}{r}_{ds1} + {g}_{mbs2}{r}_{ds1} + {g}_{ds2}{r}_{ds1}}\right)  \tag{4.3-6}
$$
$$
= {r}_{ds1} + {r}_{ds2} + {g}_{m2}{r}_{ds1}{r}_{ds2}\left( {1 + {\eta }_{2}}\right)
$$
Typically, ${g}_{m2}{r}_{ds2}$ is greater than unity so that Eq. (4.3-6) simplifies to
$$
{r}_{\text{out }} \cong  \left( {{g}_{m2}{r}_{ds2}}\right) {r}_{ds1} \tag{4.3-7}
$$

Figure 4.3-3 (a) Technique for increasing the output resistance of a resistor $r$ : (b) Small-signal model for the circuit in (a).

Figure 4.3-4 (a) Circuit for increasing ${r}_{\text{out }}$ of a current sink. (b) Small-signal model for the circuit in (a).
We see that the small-signal output resistance of the current sink of Fig. 4.3-4(a) is increased by the factor of ${g}_{m2}{r}_{ds2}$ .
---
Example 4.3-1
---
## Calculation of Output Resistance for a Current Sink
Use the model parameters of Table 3.1-2 to calculate (a) the small-signal output resistance for the simple current sink of Fig. 4.3-1(a) if ${I}_{\mathrm{{OUT}}} = {100\mu }\mathrm{A}$ ; and (b) the small-signal output resistance if the simple current sink of (a) is inserted into the cascode current-sink configuration of Fig. 4.3-4(a). Assume that ${W}_{1}/{L}_{1} = {W}_{2}/{L}_{2} = 1$ .
## SOLUTION
(a) Using $\lambda  = {0.04}$ and ${I}_{\mathrm{{OUT}}} = {100\mu }\mathrm{A}$ gives a small-signal output resistance of ${250}\mathrm{k}\Omega$ . (b) The body-effect term, ${g}_{mbs2}$ , can be ignored with little error in the result. Equation (3.3-6) gives ${g}_{m1} = {g}_{m2} = {148\mu }\mathrm{A}/\mathrm{V}$ . Substituting these values into Eq. (4.3-7) gives the small-signal output resistance of the cascode current sink as ${9.25}\mathrm{M}\Omega$ .
The other performance limitation of the simple current sink/source was the fact that the constant output current could not be obtained for all values of ${v}_{\mathrm{{OUT}}}$ . This was illustrated in Figs. 4.3-1(b) and 4.3-2(b). While this problem may not be serious in the simple current sink/source, it becomes more severe in the cascode current-sink/source configuration that was used to increase the small-signal output resistance. It therefore becomes necessary to examine methods of reducing the value of ${V}_{\mathrm{{MIN}}}\left\lbrack  3\right\rbrack$ . Obviously, ${V}_{\mathrm{{MIN}}}$ can be reduced by increasing the value of $W/L$ and adjusting the gate-source voltage to get the same output current. However, another method that works well for the cascode current-sink/source configuration will be presented.
We must introduce an important principle used in biasing MOS devices before showing the method of reducing ${V}_{\mathrm{{MIN}}}$ of the cascode current sink/source. This principle can best be illustrated by considering two MOS devices, M1 and M2. Assume that the applied dc gate-source voltage ${V}_{GS}$ can be divided into two parts, given as
$$
{V}_{GS} = {V}_{ON} + {V}_{T} \tag{4.3-8}
$$
where ${V}_{ON}$ is that part of ${V}_{GS}$ that is in excess of the threshold voltage, ${V}_{T}$ . This definition allows us to express the minimum value of ${v}_{DS}$ for which the device will remain in saturation as
$$
{v}_{DS}\left( \text{sat}\right)  = {V}_{GS} - {V}_{T} = {V}_{ON} \tag{4.3-9}
$$
Thus, ${V}_{ON}$ can be thought of as the minimum drain-source voltage for which the device remains saturated. In saturation, the drain current can be written as
$$
{i}_{D} = \frac{{K}^{\prime }W}{2L}{\left( {V}_{ON}\right) }^{2} \tag{4.3-10}
$$
The principle to be illustrated is based on Eq. (4.3-10). If the currents of two MOS devices are equal (because they are in series), then the following relationship holds:
$$
\frac{{K}_{1}^{\prime }{W}_{1}}{{L}_{1}}{\left( {V}_{ON1}\right) }^{2} = \frac{{K}_{2}^{\prime }{}_{2}{W}_{2}}{{L}_{2}}{\left( {V}_{ON2}\right) }^{2} \tag{4.3-11}
$$
If both MOS transistors are of the same type, then Eq. (4.3-11) reduces to
$$
\frac{{W}_{1}}{{L}_{1}}{\left( {V}_{ON1}\right) }^{2} = \frac{{W}_{2}}{{L}_{2}}{\left( {V}_{ON2}\right) }^{2} \tag{4.3-12}
$$
or
$$
\frac{\left( \frac{{W}_{1}}{{L}_{1}}\right) }{\left( \frac{{W}_{2}}{{L}_{2}}\right) } = \frac{{\left( {V}_{ON2}\right) }^{2}}{{\left( {V}_{ON1}\right) }^{2}} \tag{4.3-13}
$$
The principle above can also be used to define a relationship between the current and $W/L$ ratios. If the gate-source voltages of two similar MOS devices are equal (because they are physically connected), then ${V}_{ON1}$ is equal to ${V}_{ON2}$ . From Eq. (4.3-10) we can write
$$
{i}_{D1}\left( \frac{{W}_{2}}{{L}_{2}}\right)  = {i}_{D2}\left( \frac{{W}_{1}}{{L}_{1}}\right)  \tag{4.3-14}
$$
Equation (4.3-13) is useful even though the gate-source terminals of M1 and M2 may not be physically connected because voltages can be identical without being physically connected, as will be seen in later material. Equations (4.3-13) and (4.3-14) represent a very important principle that will be used not only in the material immediately following but throughout this text to determine biasing relationships.
Consider the cascode current sink of Fig. 4.3-5(a). Our objective is to use the above principle to reduce the value of ${V}_{\mathrm{{MIN}}}$ . If we ignore the bulk effects on M2 and M4 and assume that M1, M2, M3, and M4 are all matched with identical W/L ratios, then the gate-source voltage of each transistor can be expressed as ${V}_{T} + {V}_{ON}$ as shown in Fig. 4.3-5(a). At the gate of M2 we see that the voltage with respect to the lower power supply is $2{V}_{T} + 2{V}_{ON}$ . In order to maintain current-sink/source operation, it will be assumed that M1 and M2 must have at least a voltage of ${V}_{ON}$ as given in Eq. (4.3-9). In order to find ${V}_{\mathrm{{MIN}}}$ of Fig. 4.3-5(a) we can rewrite Eq. (3.1-15) as
$$
{v}_{D} \geq  {v}_{G} - {V}_{T} \tag{4.3-15}
$$
Since ${V}_{G2} = 2{V}_{T} + 2{V}_{ON}$ , substituting this value into Eq. (4.3-15) gives
$$
{V}_{D2}\left( \min \right)  = {V}_{\mathrm{{MIN}}} = {V}_{T} + 2{V}_{ON} \tag{4.3-16}
$$
The current-voltage characteristics of Fig. 4.3-5(a) are illustrated in Fig. 4.3-5(b), where the value of ${V}_{\mathrm{{MIN}}}$ of Eq. (4.3-16) is shown.
${V}_{\mathrm{{MIN}}}$ of Eq. (4.3-16) is dropped across both M1 and M2. The drop across M2 is ${V}_{ON}$ while the drop across M1 is ${V}_{T} + {V}_{ON}$ . From the results of Eq. (4.3-9), this implies that ${V}_{\text{MIN }}$ of Fig. 4.3-5 could be reduced by ${V}_{T}$ and still keep both M1 and M2 in saturation. Figure 4.3-6(a) shows how this can be accomplished [4]. The $W/L$ ratio of M4 is made one-quarter of the identical $W/L$ ratios of M1 through M3. This causes the gate-source voltage across M4 to be ${V}_{T} + 2{V}_{ON}$ rather than ${V}_{T} + {V}_{ON}$ . Consequently, the voltage at the gate of $\mathrm{M}2$ is now ${V}_{T} + 2{V}_{ON}$ . Substituting this value into Eq. (4.3-15) gives
$$
{V}_{D2}\left( \min \right)  = {V}_{\mathrm{{MIN}}} = 2{V}_{ON} \tag{4.3-17}
$$
The resulting current-voltage relationship is shown in Fig. 4.3-6(b). It can be seen that a voltage of $2{V}_{ON}$ is across both M1 and M2, giving the lowest value of ${V}_{\mathrm{{MIN}}}$ and still keeping both $\mathrm{M}1$ and $\mathrm{M}2$ in saturation. Using this approach and increasing the $W/L$ ratios will result in minimum values of ${V}_{\mathrm{{MIN}}}$ .

Figure 4.3-5 (a) Standard cascode current sink. (b) Output characteristics of circuit in (a).

Figure 4.3-6 (a) High-swing cascode. (b) Output characteristics of circuit in (a).
---
Example 4.3-2
---
## Designing the Cascode Current Sink for a Given ${V}_{\mathrm{{MIN}}}$
Use the cascode current-sink configuration of Fig. 4.3-6(a) to design a current sink of ${100\mu }\mathrm{A}$ and a ${V}_{\mathrm{{MIN}}}$ of $1\mathrm{\;V}$ . Assume the device parameters of Table 3.1-2.
## SOLUTION
With ${V}_{\mathrm{{MIN}}}$ of $1\mathrm{\;V}$ , choose ${V}_{ON} = {0.5}\mathrm{\;V}$ . Using the saturation model, the $W/L$ ratio of $\mathrm{M}1$ through M3 can be found from
$$
\frac{W}{L} = \frac{2{i}_{\mathrm{{OUT}}}}{{K}^{\prime }{V}_{ON}^{2}} = \frac{2 \times  {100} \times  {10}^{-6}}{{110} \times  {10}^{-6} \times  {0.25}} = {7.27}
$$
The $W/L$ ratio of M4 will be one-quarter this value or 1.82 .
A problem exists with the circuit in Fig. 4.3-6. The ${V}_{DS}$ of M1 and the ${V}_{DS}$ of M3 are not equal. Therefore, the current ${i}_{\mathrm{{OUT}}}$ will not be an accurate replica of ${I}_{\mathrm{{REF}}}$ due to channel length modulation as well as drain-induced threshold shift. If precise mirroring of the current ${I}_{\mathrm{{REF}}}$ to ${I}_{\mathrm{{OUT}}}$ is desired, a slight modification of the circuit of Fig. 4.3-6 will minimize this problem. Figure 4.3-7 illustrates this fix. An additional transistor, M5, is added in series with M3 so as to force the drain voltages of M3 and M1 to be equal, thus eliminating any errors due to channel length modulation and drain-induced threshold shift.
The above technique will be useful in maximizing the voltage-signal swings of cascode configurations to be studied later. This section has presented implementations of the current sink/source and has shown how to boost the output resistance of an MOS device. A very important principle that will be used in biasing was based on relationships between the excess gate-source voltage ${V}_{ON}$ , the drain current, and the $W/L$ ratios of MOS devices. This principle was applied to reduce the voltage ${V}_{\mathrm{{MIN}}}$ of the cascode current source.
When power dissipation must be kept at a minimum, the circuit in Fig. 4.3-7 can be modified to eliminate one of the ${I}_{\mathrm{{REF}}}$ currents. Figure 4.3-8 illustrates a self-biased cascode current source that requires only one reference current [5]. While this circuit eliminates a bias

Figure 4.3-7 Improved high-swing cascode.
voltage, it has two disadvantages. The first is that the resistor $R$ can become quite large if the current is small and the second is that another node has been introduced into the circuit, creating a parasitic pole.
---
Example 4.3-3
---
## Designing the Self-Biased High-Swing Cascode Current Sink for a Given ${V}_{\text{MIN }}$
Use the cascode current-sink configuration of Fig. 4.3-8 to design a current sink of ${250\mu }\mathrm{A}$ and a ${V}_{\mathrm{{MIN}}}$ of ${0.5}\mathrm{\;V}$ . Assume the device parameters of Table 3.1-2.
## SOLUTION
With ${V}_{\mathrm{{MIN}}}$ of ${0.5}\mathrm{\;V}$ , choose ${V}_{ON} = {0.25}\mathrm{\;V}$ . Using the saturation model, the $W/L$ ratio of $\mathrm{M}1$ and M3 can be found from
$$
\frac{W}{L} = \frac{2{i}_{\mathrm{{OUT}}}}{{K}^{\prime }{V}_{ON}^{2}} = \frac{{500} \times  {10}^{-6}}{{110} \times  {10}^{-6} \times  {0.0625}} = {72.73}
$$

Figure 4.3-8 Self-biased high-swing cascode current source.
The back-gate bias on M2 and M4 is $- {0.25}\mathrm{\;V}$ . Therefore, the threshold voltage for M2 and M4 is calculated to be
$$
{V}_{TH} = {0.7} + {0.4}\left( {\sqrt{{0.25} + {0.7}} - \sqrt{0.7}}\right)  = {0.755}
$$
Taking into account the increased value of the threshold voltage, the gate voltage of M4 and M2 is
$$
{V}_{G4} = {0.755} + {0.25} + {0.25} = {1.255}
$$
The gate voltage of M1 and M3 is
$$
{V}_{G1} = {0.70} + {0.25} = {0.95}
$$
Both terminals of the resistor are now defined so that the required resistance value is easily calculated to be
$$
R = \frac{{V}_{G4} - {V}_{G1}}{{250} \times  {10}^{-6}} = \frac{{1.255} - {0.95}}{{250} \times  {10}^{-6}} = {1220\Omega }
$$
It was seen that if a resistance is inserted between the source and ground of a current sink, the output resistance is increased. This was demonstrated by small-signal analysis in Eqs. (4.3-4) and (4.3-6). However, from a design viewpoint we should understand the principle that enables this result so that it can be used in future designs to either increase or decrease the resistance at a port. The principle at hand is negative feedback applied to a single port. It is characterized by a concept called Blackman's formula [6]. Blackman's formula is based on Fig. 4.3-9 where the port of interest is designated as $X$ . In Fig. 4.3-9(a), a controlled or dependent source is shown. The controlling variable can be a voltage, ${v}_{c}$ , or current, ${i}_{c}$ . The source that is controlled can be a voltage source, $k{v}_{c}$ , or a current source, $k{i}_{c}$ , where the controlling parameter is $k$ . In Fig. 4.3-9(b), the dependent source has been converted into an independent voltage source designated as $k{v}_{c}^{\prime }$ or an independent current source designated as $k{i}_{c}^{\prime }$ . When this is done, the feedback loop is opened and a quantity called return ratio can be calculated. The return ratio is simply the negative ratio of the controlling variable divided by the primed controlling variable. There are two types of return ratio, the return ratio with port $X$ open-circuited $\left( {{i}_{x} = 0}\right)$ and the return ratio with port $X$ short-circuited $\left( {{v}_{x} = 0}\right)$ . It can be shown that the input resistance at port $X$ of Fig. 4.3-9(a) is [7]
$$
{R}_{x} = {R}_{x}\left( {k = 0}\right) \left\lbrack  \frac{1 + {RR}\left( \text{ port shorted }\right) }{1 + {RR}\left( \text{ port opened }\right) }\right\rbrack   \tag{4.3-18}
$$

Figure 4.3-9 (a) Application of Blackman's formula to find the resistance at port X. (b) Circuit used to find the return ratio of Blackman's formula.

Figure 4.3-10 (a) Figure 4.3-3(b) with ${v}_{g2} = 0$ and ${v}_{bs2} = 0\mathrm{\;V}$ . (b) Conversion of Fig. 4.3-10(a) from Fig 4.3-9(a) to Fig. 4.3-9(b), which can also be used for the open-circuit port if ${i}_{x} = 0$ . (c) Short-circuit form of Fig. 4.3-10(b).
where ${RR}$ is the return ratio $\left( {-{v}_{c}/{v}_{c}^{\prime }}\right.$ or $\left. {-{i}_{c}/{i}_{c}^{\prime }}\right)$ . Let us apply this formula to Fig. 4.3-3(a) to derive Eq. (4.3-4) in the following example.
---
Example 4.3-4
---
## Application of Blackman's Formula to Fig. 4.3-3(a)
Apply Blackman's formula given in Eq. (4.3-18) to the current sink of Fig. 4.3-3(a). To simplify the example, we will assume that ${v}_{bs} = 0\mathrm{\;V}$ .
## SOLUTION
Figure 4.3-10 shows the process of converting Fig. 4.3-3(b) into the form of Fig. 4.3-9(b). The output resistance with ${g}_{m2} = 0$ is
$$
{R}_{\text{out }}\left( {{g}_{m2} = 0}\right)  = {r}_{ds2} + r
$$
The return ratio with the port shorted $\left( {{v}_{x} = 0}\right)$ is found as
$$
\text{ Return ratio }\left( {{v}_{x} = 0}\right)  =  - \frac{{v}_{c}}{{v}_{c}^{\prime }} = {g}_{m2}\frac{{r}_{ds2}r}{{r}_{ds2} + r}
$$
The return ratio with the port open $\left( {{i}_{x} = 0}\right)$ is found as
$$
\text{ Return ratio }\left( {{i}_{x} = 0}\right)  =  - \frac{{v}_{c}}{{v}_{c}^{\prime }} = 0
$$
because if ${i}_{x} = 0$ , then all of the current ${g}_{m2}{v}_{c}^{\prime }$ flows through ${r}_{ds2}$ and none through $r$ . Substituting these values in Eq. (4.3-18) gives the output resistance as
$$
{R}_{\text{out }} = {R}_{\text{out }}\left( {{g}_{m2} = 0}\right) \left\lbrack  \frac{1 + {RR}\left( \text{ port shorted }\right) }{1 + {RR}\left( \text{ port opened }\right) }\right\rbrack   = \left( {{r}_{ds2} + r}\right) \left( {{g}_{m2}\frac{{r}_{ds2}r}{{r}_{ds2} + r}}\right)
$$
$$
= {r}_{ds2} + {g}_{m2}{r}_{ds2}r
$$
which is identical to Eq. (4.3-4) if ${g}_{mbs2} = 0$ .
The key principle we learn from the influence of feedback through Blackman's formula is that if the resistance is to be increased, we want to find a feedback circuit where the return ratio goes to zero when the port is opened. On the other hand, if we want the resistance at a port to decrease, we want to find a feedback circuit where the return ratio goes to zero when the port is shorted. In terms of feedback concepts, the first case is called series feedback and the second case is called shunt feedback. Generally, if the controlling variable is voltage, ${v}_{c}$ , the feedback is series, and if the controlling variable is current, ${i}_{c}$ , the feedback is shunt.

### 4.4 Current Mirrors
Current mirrors are simply an extension of the current sink/source of the previous section. In fact, it is unlikely that one would ever build a current sink/source that was not biased as a current mirror. The current mirror uses the principle that if the gate-source potentials of two identical MOS transistors are equal, the channel currents should be equal. Figure 4.4-1 shows the implementation of a simple n-channel current mirror. The current ${i}_{I}$ is assumed to be defined by a current source or some other means and ${i}_{O}$ is the output or "mirrored" current. M1 is in saturation because ${v}_{DS1} = {v}_{GS1}$ . Assuming that ${v}_{DS2} \geq  {v}_{GS2} - {V}_{T2}$ allows us to use the equations in the saturation region of the MOS transistor. In the most general case, the ratio of ${i}_{O}$ to ${i}_{I}$ is
$$
\frac{{i}_{O}}{{i}_{I}} = \left( \frac{{L}_{1}{W}_{2}}{{W}_{1}{L}_{2}}\right) {\left( \frac{{V}_{GS} - {V}_{T2}}{{V}_{GS} - {V}_{T1}}\right) }^{2}\left\lbrack  {\frac{1 + \lambda {v}_{DS2}}{1 + \lambda {v}_{DS1}}\left( \frac{{K}_{2}^{\prime }}{{K}_{1}^{\prime }}\right) }\right\rbrack   \tag{4.4-1}
$$
Normally, the components of a current mirror are processed on the same integrated circuit and thus all of the physical parameters such as ${V}_{T}$ and ${K}^{\prime }$ are identical for both devices. As a result, Eq. (4.4-1) simplifies to
$$
\frac{{i}_{O}}{{i}_{I}} = \left( \frac{{L}_{1}{W}_{2}}{{W}_{1}{L}_{2}}\right) \left( \frac{1 + \lambda {v}_{DS2}}{1 + \lambda {v}_{DS1}}\right)  \tag{4.4-2}
$$
If ${v}_{DS2} = {v}_{DS1}$ (not always a good assumption), then the ratio of ${i}_{O}/{i}_{I}$ becomes
$$
\frac{{i}_{O}}{{i}_{I}} = \left( \frac{{L}_{1}{W}_{2}}{{W}_{1}{L}_{2}}\right)  \tag{4.4-3}
$$
Consequently, ${i}_{O}/{i}_{I}$ is a function of the aspect ratios that are under the control of the designer.

Figure 4.4-1 n-Channel current mirror.
There are three effects that cause the current mirror to be different from the ideal situation of Eq. (4.4-3). These effects are (1) channel length modulation, (2) threshold offset between the two transistors, and (3) imperfect geometrical matching. Each of these effects will be analyzed separately.
Consider the channel length modulation effect. Assuming all other aspects of the transistor are ideal and the aspect ratios of the two transistors are both unity, then Eq. (4.4-2) simplifies to
$$
\frac{{i}_{O}}{{i}_{I}} = \frac{1 + \lambda {v}_{DS2}}{1 + \lambda {v}_{DS1}} \tag{4.4-4}
$$
with the assumption that $\lambda$ is the same for both transistors. This equation shows that differences in drain-source voltages of the two transistors can cause a deviation from the ideal unity current gain or current mirroring. Figure 4.4-2 shows a plot of current ratio error versus ${v}_{DS2} -$ ${v}_{DS1}$ for different values of $\lambda$ with both transistors in the saturation region. Two important facts should be recognized from this plot. The first is that significant ratio error can exist when the mirror transistors do not have the same drain-source voltage and second, for a given difference in drain-source voltages, the ratio of the mirror current to the reference current improves as $\lambda$ becomes smaller (output resistance becomes larger). Thus, a good current mirror or current amplifier should have identical drain-source voltages and a high output resistance.
The second nonideal effect is that of offset between the threshold voltage of the two transistors. For clean silicon-gate CMOS processes, the threshold offset is typically less than ${10}\mathrm{{mV}}$ for transistors that are identical and in close proximity to one another.
Consider two transistors in a mirror configuration where both have the same drain-source voltage and all other aspects of the transistors are identical except ${V}_{T}$ . In this case, Eq. (4.4-1) simplifies to
$$
\frac{{i}_{O}}{{i}_{I}} = {\left( \frac{{v}_{GS} - {V}_{T2}}{{v}_{GS} - {V}_{T1}}\right) }^{2} \tag{4.4-5}
$$

Figure 4.4-2 Plot of ratio error (in %) versus drain voltage difference for the current mirror of Fig. 4.4-1. For this plot, ${v}_{DS1} = {2.0}\mathrm{\;V}$ .

Figure 4.4-3 Plot of ratio error (in $\%$ ) versus offset voltage for the current mirror of Fig. 4.4-1. For this plot, ${v}_{T1} = {0.7}\mathrm{\;V}$ and ${K}^{\prime }W/L = {110\mu }\mathrm{A}/{\mathrm{V}}^{2}$ .
Figure 4.4-3 shows a plot of the ratio error versus $\Delta {V}_{T}$ , where $\Delta {V}_{T} = {V}_{T1} - {V}_{T2}$ . It is obvious from this graph that better current-mirror performance is obtained at higher currents, because ${v}_{GS}$ is higher for higher currents and thus $\Delta {V}_{T}$ becomes a smaller percentage of ${v}_{GS}$ .
It is also possible that the transconductance gain ${K}^{\prime }$ of the current mirror is also mismatched (due to oxide gradients). A quantitative analysis approach to variations in both ${K}^{\prime }$ and ${V}_{T}$ is now given. Let us assume that the $W/L$ ratios of the two mirror devices are exactly equal but that ${K}^{\prime }$ and ${V}_{T}$ may be mismatched. Equation (4.4-5) can be rewritten as
$$
\frac{{i}_{O}}{{i}_{I}} = \frac{{K}_{2}^{\prime }{\left( {v}_{GS} - {V}_{T2}\right) }^{2}}{{K}_{1}^{\prime }{\left( {v}_{GS} - {V}_{T1}\right) }^{2}} \tag{4.4-6}
$$
where ${v}_{GS1} = {v}_{GS2} = {v}_{GS}$ . Defining $\Delta {K}^{\prime } = {K}_{2}^{\prime } - {K}_{1}^{\prime }$ and ${K}^{\prime } = {0.5}\left( {{K}_{2}^{\prime } + {K}_{1}^{\prime }}\right)$ and $\Delta {V}_{T} = {V}_{T2} -$ ${V}_{T1}$ and ${V}_{T} = {0.5}\left( {{V}_{T2} + {V}_{T1}}\right)$ gives
$$
{K}_{1}^{\prime } = {K}^{\prime } - {0.5\Delta }{K}^{\prime } \tag{4.4-7}
$$
$$
{K}_{2}^{\prime } = {K}^{\prime } + {0.5\Delta }{K}^{\prime } \tag{4.4-8}
$$
$$
{V}_{T1} = {V}_{T} - {0.5\Delta }{V}_{T} \tag{4.4-9}
$$
$$
{V}_{T2} = {V}_{T} + {0.5\Delta }{V}_{T} \tag{4.4-10}
$$
Substituting Eqs. (4.4-7) through (4.4-10) into Eq. (4.4-6) gives
$$
\frac{{i}_{O}}{{i}_{I}} = \frac{\left( {{K}^{\prime } + {0.5\Delta }{K}^{\prime }}\right) {\left( {v}_{GS} - {V}_{T} - {0.5}\Delta {V}_{T}\right) }^{2}}{{\left( {K}^{\prime } - {0.5}\Delta {K}^{\prime })\left( {v}_{GS} - {V}_{T} + {0.5}\Delta {V}_{T}\right. \right) }^{2}} \tag{4.4-11}
$$
Factoring out ${K}^{\prime }$ and $\left( {{v}_{GS} - {V}_{T}}\right)$ gives
$$
\frac{{i}_{O}}{{i}_{I}} = \frac{\left( {1 + \frac{\Delta {K}^{\prime }}{2K}}\right) {\left( 1 - \frac{\Delta {V}_{T}}{2\left( {{v}_{GS} - {V}_{T}}\right) }\right) }^{2}}{\left( {1 - \frac{\Delta {K}^{\prime }}{2K}}\right) {\left( 1 + \frac{\Delta {V}_{T}}{2\left( {{v}_{GS} - {V}_{T}}\right) }\right) }^{2}} \tag{4.4-12}
$$
Assuming that the quantities in Eq. (4.4-12) following the " 1 " are small, Eq. (4.4-12) can be approximated as
$$
\frac{{i}_{O}}{{i}_{I}} \cong  \left( {1 + \frac{\Delta {K}^{\prime }}{2{K}^{\prime }}}\right) \left( {1 + \frac{\Delta {K}^{\prime }}{2{K}^{\prime }}}\right) {\left( 1 - \frac{\Delta {V}_{T}}{2\left( {{v}_{GS} - {V}_{T}}\right) }\right) }^{2}{\left( 1 - \frac{\Delta {V}_{T}}{2\left( {{v}_{GS} - {V}_{T}}\right) }\right) }^{2} \tag{4.4-13}
$$
Retaining only first-order products gives
$$
\frac{{i}_{O}}{{i}_{I}} \cong  1 + \frac{\Delta {K}^{\prime }}{{K}^{\prime }} - \frac{{2\Delta }{V}_{T}}{{v}_{GS} - {V}_{T}} \tag{4.4-14}
$$
If the percentage change of ${K}^{\prime }$ and ${V}_{T}$ are known, Eq. (4.4-14) can be used on a worst-case basis to predict the error in the current-mirror gain. For example, assume that $\Delta {K}^{\prime }/{K}^{\prime } =  \pm  5\%$ and $\Delta {V}_{T}/\left( {{v}_{GS} - {V}_{T}}\right)  =  \pm  {10}\%$ . Then the current-mirror gain would be given as ${i}_{O}/{i}_{I} \cong  1 \pm$ ${0.05} \pm  \left( {-{0.20}}\right)$ or $1 \pm  \left( {-{0.15}}\right)$ amounting to a ${15}\%$ error in gain assuming the tolerances of ${K}^{\prime }$ and ${V}_{T}$ are correlated.
The third nonideal effect of current mirrors is the error in the aspect ratio of the two devices. We saw in Chapter 3 that there are differences in the drawn values of $W$ and $L$ . These are due to mask, photolithographic, etch, and outdiffusion variations. These variations can be different even for two transistors placed side by side. One way to avoid the effects of these variations is to make the dimensions of the transistors much larger than the typical variation one might see. For transistors of identical size with $W$ and $L$ greater than ${10\mu }\mathrm{m}$ , the errors due to geometrical mismatch will generally be insignificant compared to offset-voltage and ${v}_{DS}$ -induced errors.
In some applications, the current mirror is used to multiply current and function as a current amplifier. In this case, the aspect ratio of the multiplier transistor (M2) is much greater than the aspect ratio of the reference transistor (M1). To obtain the best performance, the geometrical aspects must be considered. An example will illustrate this concept.
---
Example ${4.4} - 1$
---
## Aspect Ratio Errors in Current Amplifiers
Figure 4.4-4 shows the layout of a one-to-four current amplifier. Assume that the lengths are identical $\left( {{L}_{1} = {L}_{2}}\right)$ and find the ratio error if ${W}_{1} = 5 \pm  {0.1\mu }\mathrm{m}$ and ${W}_{2} = {20} \pm  {0.1\mu }\mathrm{m}$ .
## SOLUTION
The actual widths of the two transistors are
$$
{W}_{1} = 5 \pm  {0.1\mu }\mathrm{m}
$$
and
$$
{W}_{2} = {20} \pm  {0.1\mu }\mathrm{m}
$$

Figure 4.4-4 Layout of current mirror without ${\Delta W}$ correction.
We note that the tolerance is not multiplied by the nominal gain factor of 4 . The ratio of ${W}_{2}$ to ${W}_{1}$ and consequently the gain of the current amplifier is
$$
\frac{{i}_{O}}{{i}_{I}} = \frac{{W}_{2}}{{W}_{1}} = \frac{{20} + {0.1}}{5 \pm  {0.1}} = 4\left( \frac{1 \pm  \left( {{0.1}/{20}}\right) }{1 \pm  \left( {{0.1}/5}\right) }\right)  \approx  4\left( {1 \pm  \frac{0.1}{20}}\right) \left( {1 - \frac{\pm {0.1}}{5}}\right)
$$
$$
\approx  4\left( {1 \pm  \frac{0.1}{20} - \frac{\pm {0.4}}{20}}\right)  = 4 - \left( {\pm {0.03}}\right)
$$
where we have assumed that the variations would both have the same sign. It is seen that this ratio error is ${0.75}\%$ of the desired current ratio or gain.
The error noted above would be valid if every other aspect of the transistor were matched perfectly. A solution to this problem can be achieved by using proper layout techniques as illustrated in Appendix B. The correct one-to-four ratio should be implemented using four duplicates of the transistor $\mathrm{M}1$ . In this way, the tolerance on ${W}_{2}$ is multiplied by the nominal current gain. Let us reconsider the above example using this approach.
---
Example 4.4-2
---
## Reduction of the Aspect Ratio Error in Current Amplifiers
Use the layout technique illustrated in Fig. 4.4-5 and calculate the ratio error of a current amplifier having the specifications of the previous example. SOLUTION

Figure 4.4-5 Layout of current mirror with ${\Delta W}$ correction as well as common-centroid layout techniques.
The actual widths of M1 and M2 are
$$
{W}_{1} = 5 \pm  {0.05\mu }\mathrm{m}
$$
and
$$
{W}_{2} = 4\left( {5 \pm  {0.05}}\right) \mu \mathrm{m}
$$
The ratio of ${W}_{2}$ to ${W}_{1}$ and consequently the current gain is seen to be
$$
\frac{{i}_{O}}{{i}_{I}} = \frac{4\left( {5 \pm  {0.05}}\right) }{5 \pm  {0.05}} = 4
$$
In the above examples we made the assumption that ${\Delta W}$ should be the same for all transistors. Unfortunately, this is not true, but the ${\Delta W}$ matching errors will be small compared to the other error contributions. If the widths of two transistors are equal but the lengths differ, the scaling approach discussed above for the width is also applicable to the length. Usually one does not try to scale the length because the tolerances are greater than the width tolerances due to diffusion (outdiffusion) under the polysilicon gate.
We have seen that the small-signal output resistance is a good measure of the perfection of the current mirror or amplifier. The output resistance of the simple n-channel mirror of Fig. 4.4-1 is given as
$$
{r}_{\text{out }} = \frac{1}{{g}_{ds}} \cong  \frac{1}{\lambda {I}_{D}} \tag{4.4-15}
$$
Higher-performance current mirrors will attempt to increase the value of ${r}_{\text{out }}$ . Equation (4.4-15) will be the point of comparison.
Up to this point we have discussed aspects of and improvements on the current mirror or current amplifier shown in Fig. 4.4-1, but there are ways of improving current-mirror performance using the same principles employed in Section 4.3. The current mirror shown in Fig. 4.4-6 applies the cascode technique, which reduces ratio errors due to differences in output and input voltages.

Figure 4.4-6 Standard cascode current sink.

Figure 4.4-7 Small-signal model for the circuit of Fig. 4.4-6.
Figure 4.4-7 shows an equivalent small-signal model of Fig. 4.4-6. To find the small-signal output resistance, set ${i}_{i} = 0$ . This causes the small-signal voltages ${v}_{1}$ and ${v}_{3}$ to be zero. Therefore, Fig. 4.4-7 is exactly equivalent to the circuit of Example 4.3-1. Using the correct subscripts for Fig. 4.4-7, we can use the results of Eq. (4.3-6) to write
$$
{r}_{\text{out }} = {r}_{ds2} + {r}_{ds4} + {g}_{m4}{r}_{ds2}{r}_{ds4}\left( {1 + {\eta }_{4}}\right)  \tag{4.4-16}
$$
We have already seen from Example 4.3-1 that the small-signal output resistance of this configuration is much larger than for the simple mirror of Eq. (4.4-15).
Another current mirror is shown in Fig. 4.4-8. This circuit is an n-channel implementation of the well-known Wilson current mirror [8]. The output resistance of the Wilson current mirror is increased through the use of negative current feedback. If ${i}_{O}$ increases, then the current through M2 also increases. However, the mirroring action of M1 and M2 causes the current in M1 to increase. If ${i}_{I}$ is constant and if we assume there is some resistance from the gate of M3 (drain of M1) to ground, then the gate voltage of M3 is decreased if the current ${i}_{O}$ increases. The loop gain is essentially the product of ${g}_{m1}$ and the small-signal resistance seen from the drain of M1 to ground.

Figure 4.4-8 Wilson current mirror.
It can be shown that the small-signal output resistance of the Wilson current source of Fig. 4.4-8 is
$$
{r}_{\text{out }} = {r}_{ds3} + {r}_{ds2}\left( \frac{1 + {r}_{ds3}{g}_{m3}\left( {1 + {\eta }_{3}}\right)  + {g}_{m1}{r}_{ds1}{g}_{m3}{r}_{ds3}}{1 + {g}_{m2}{r}_{ds2}}\right)  \tag{4.4-17}
$$
The output resistance of Fig. 4.4-8 is seen to be comparable with that of Fig. 4.4-6.
Unfortunately, the behavior described above for the current mirrors or amplifier requires a nonzero voltage at the input and output before it is achieved. Consider the cascode current mirror of Fig. 4.4-6 from a large-signal viewpoint. This voltage at the input, designated as ${V}_{I}\left( \min \right)$ , can be shown to depend on the value of ${i}_{I}$ as follows. Since ${v}_{DG} = 0$ for both M1 and M3, these devices are always in saturation. Therefore, we may express ${V}_{I}\left( \min \right)$ as
$$
{V}_{I}\left( \min \right)  = {\left( \frac{2{i}_{I}}{{K}^{\prime }}\right) }^{1/2}\left\lbrack  {{\left( \frac{{L}_{1}}{{W}_{1}}\right) }^{1/2} + {\left( \frac{{L}_{3}}{{W}_{3}}\right) }^{1/2}}\right\rbrack   + \left( {{V}_{T1} + {V}_{T3}}\right)  \tag{4.4-18}
$$
It is seen that for a given ${i}_{I}$ the only way to decrease ${V}_{I}\left( \min \right)$ is to increase the $W/L$ ratios of both M1 and M3. One must also remember that ${V}_{T3}$ will be larger due to the back-gate bias on M3. The techniques used to reduce ${V}_{\mathrm{{MIN}}}$ at the output of the cascode current sink/source in Section 4.3 are not applicable to the Wilson current source.
For the cascoded current sink of Fig. 4.4-6 we are also interested in the voltage, ${V}_{\mathrm{{MIN}}}$ , where M4 makes the transition from the nonsaturated region to the saturated region. This voltage can be found from the relationship
$$
{v}_{DS4} \geq  \left( {{v}_{GS4} - {V}_{T4}}\right)  \tag{4.4-19}
$$
or
$$
{v}_{D4} \geq  {v}_{G4} - {V}_{T4} \tag{4.4-20}
$$
which is when M4 is on the threshold between the two regions. Equation (4.4-20) can be used to obtain the value of ${V}_{\mathrm{{MIN}}}$ as
$$
{V}_{\mathrm{{MIN}}} = {V}_{I} - {V}_{T4} = {\left( \frac{2{I}_{I}}{{K}^{\prime }}\right) }^{1/2}\left\lbrack  {{\left( \frac{{L}_{1}}{{W}_{1}}\right) }^{1/2} + {\left( \frac{{L}_{3}}{{W}_{3}}\right) }^{1/2}}\right\rbrack   + \left( {{V}_{T1} + {V}_{T3} - {V}_{T4}}\right)  \tag{4.4-21}
$$
For voltages above ${V}_{\mathrm{{MIN}}}$ , the transistor $\mathrm{M}4$ is in saturation and the output resistance should be that calculated in Eq. (4.4-16). Since the value of voltage across M2 is greater than necessary for saturation, the technique used to decrease ${V}_{\mathrm{{MIN}}}$ in Section 4.3 can be used to decrease ${V}_{\mathrm{{MIN}}}$ .
Similar relationships can be developed for the Wilson current mirror or amplifier. If M3 is saturated, then ${V}_{I}\left( \min \right)$ is expressed as
$$
{V}_{I}\left( \min \right)  = {\left( \frac{2{I}_{O}}{{K}^{\prime }}\right) }^{1/2}\left\lbrack  {{\left( \frac{{L}_{2}}{{W}_{2}}\right) }^{1/2} + {\left( \frac{{L}_{3}}{{W}_{3}}\right) }^{1/2}}\right\rbrack   + \left( {{V}_{T2} + {V}_{T3}}\right)  \tag{4.4-22}
$$
For M3 to be saturated, ${v}_{\mathrm{{OUT}}}$ must be greater than ${V}_{\mathrm{{OUT}}}$ (sat) given as
$$
{V}_{\mathrm{{OUT}}}\left( \mathrm{{sat}}\right)  = {V}_{I} - {V}_{T3} = {\left( \frac{2{I}_{O}}{{K}^{\prime }}\right) }^{1/2}\left\lbrack  {{\left( \frac{{L}_{2}}{{W}_{2}}\right) }^{1/2} + {\left( \frac{{L}_{3}}{{W}_{3}}\right) }^{1/2}}\right\rbrack   + {V}_{T2} \tag{4.4-23}
$$
It is seen that both of these circuits require at least $2{V}_{T}$ across the input before they behave as described above. Larger $W/L$ ratios will decrease ${V}_{I}\left( \min \right)$ and ${V}_{\mathrm{{OUT}}}\left( \mathrm{{sat}}\right)$ .

Figure 4.4-9 (a) Wilson current mirror redrawn. (b) Wilson current mirror modified to increase ${r}_{\text{out }}$ at M2.
An improvement on the Wilson current mirror can be developed by viewing from a different perspective. Consider the Wilson current mirror redrawn in Fig. 4.4-9. Note that the resistance looking into the diode connection of M2 is
$$
{r}_{\mathrm{M}2} = \frac{{r}_{ds2}}{1 + {g}_{m2}{r}_{ds2}} \tag{4.4-24}
$$
If the gate of $\mathrm{M}2$ is tied to a bias voltage so that ${r}_{\mathrm{M}2}$ becomes
$$
{r}_{\mathrm{M}2} = \frac{{r}_{ds2}}{1 + {g}_{m2}{r}_{ds2}} \Rightarrow  {r}_{\mathrm{M}2} = {r}_{ds2} \tag{4.4-25}
$$
then the expression for ${r}_{\text{out }}$ is given as
$$
{r}_{\text{out }} = {r}_{ds3} + {r}_{ds2}\left( \frac{1 + {r}_{ds3}{g}_{m3}\left( {1 + {\eta }_{3}}\right)  + {g}_{m1}{r}_{ds1}{g}_{m3}{r}_{ds3}}{1}\right)  \tag{4.4-26}
$$
$$
{r}_{\text{out }} \cong  {r}_{ds2}{g}_{m1}{r}_{ds1}{g}_{m3}{r}_{ds3} \tag{4.4-27}
$$
This new current mirror illustrated fully in Fig. 4.4-10 is called a regulated cascode [9] and it achieves an output resistance on the order of ${g}_{m}^{2}{r}_{ds}^{3}$ .
Each of the current mirrors discussed above can be implemented using p-channel devices. The circuits perform in an identical manner and exhibit the same small-signal output resistance. The use of n-channel and p-channel current mirrors will be useful in dc biasing of CMOS circuits.

Figure 4.4-10 Regulated cascode current mirror.

### 4.5 Current and Voltage References
An ideal current or voltage reference is independent of power supply and temperature. Many applications in analog circuits require such a building block, which provides a stable current or voltage. The large-signal current and voltage characteristics of an ideal current and voltage reference are shown in Fig. 4.5-1. These characteristics are identical to those of the ideal current and voltage source. The term reference is used when the current or voltage values have more precision and stability than ordinarily found in a source. A reference is typically dependent on the load connected to it. It will always be possible to use a buffer amplifier to isolate the reference from the load and maintain the high performance of the reference. In the discussion that follows, it will be assumed that a high-performance voltage reference can be used to implement a high-performance current reference and vice versa.
A very crude voltage reference can be made from a voltage divider between the power supplies. Passive or active components can be used as the divider elements. Figure 4.5-2 shows an example of each. Unfortunately, the value of ${V}_{\mathrm{{REF}}}$ is directly proportional to the power supply. Let us quantify this relationship by introducing the concept of sensitivity $\mathbf{S}$ . The sensitivity of ${V}_{\mathrm{{REF}}}$ of Fig. 4.5-2(a) to ${V}_{DD}$ can be expressed as
$$
{\mathbf{S}}_{{V}_{DD}}^{{V}_{\mathrm{{REF}}}} = \frac{\left( \partial {V}_{\mathrm{{REF}}}/{V}_{\mathrm{{REF}}}\right) }{\left( \partial {V}_{DD}/{V}_{DD}\right) } = \frac{{V}_{DD}}{{V}_{\mathrm{{REF}}}}\left( \frac{\partial {V}_{\mathrm{{REF}}}}{\partial {V}_{DD}}\right)  \tag{4.5-1}
$$

Figure 4.5-1 $I - V$ characteristics of ideal current and voltage references.

Figure 4.5-2 Voltage references using voltage division. (a) Resistor implementation. (b) Active device implementation.
Equation (4.5-1) can be interpreted as follows: if the sensitivity is 1, then a 10% change in ${V}_{DD}$ will result in a ${10}\%$ change in ${V}_{\mathrm{{REF}}}$ (which is undesirable for a voltage reference). It may also be shown that the sensitivity of ${V}_{\mathrm{{REF}}}$ of Fig. 4.5-2(b) with respect to ${V}_{DD}$ is unity (see Problem 4.5-1).
A simple way of obtaining a better voltage reference is to use an active device as shown in Fig. 4.5-3. In Fig. 4.5-3(a), the substrate BJT has been connected to the power supply through a resistance $R$ . The voltage across the pn junction is given as
$$
{V}_{\mathrm{{REF}}} = {V}_{EB} = \frac{kT}{q}\ln \left( \frac{I}{{I}_{s}}\right)  \tag{4.5-2}
$$
where ${I}_{s}$ is the junction-saturation current defined in Eq. (2.5-4). If ${V}_{DD}$ is much greater than ${V}_{EB}$ , then the current $I$ is given as
$$
I = \frac{{V}_{DD} - {V}_{EB}}{R} \cong  \frac{{V}_{DD}}{R} \tag{4.5-3}
$$

Figure 4.5-3 (a) pn Junction voltage reference. (b) Increasing ${V}_{\mathrm{{REF}}}$ of (a).
Thus, the reference voltage of this circuit is given as
$$
{V}_{\mathrm{{REF}}} \cong  \frac{kT}{q}\ln \left( \frac{{V}_{DD}}{R{I}_{s}}\right)  \tag{4.5-4}
$$
The sensitivity of ${V}_{\mathrm{{REF}}}$ of Fig. 4.5-3(a) to ${V}_{DD}$ is shown to be
$$
{S}_{{V}_{DD}}^{{V}_{\mathrm{{REF}}}} = \frac{1}{\ln \left\lbrack  {{V}_{DD}/\left( {R{I}_{s}}\right) }\right\rbrack  } = \frac{1}{\ln \left( {I/{I}_{s}}\right) } \tag{4.5-5}
$$
Interestingly enough, since $I$ is normally greater than ${I}_{s}$ , the sensitivity of ${V}_{\mathrm{{REF}}}$ of Fig. 4.5- 3(a) is less than unity. For example, if $I = 1\mathrm{{mA}}$ and ${I}_{s} = {10}^{-{15}}\mathrm{\;A}$ , then Eq. (4.5-5) becomes 0.0362. Thus, a 10% change in ${V}_{DD}$ creates only a ${0.362}\%$ change in ${V}_{\text{REF }}$ . Figure 4.5-3(b) shows a method of increasing the value of ${V}_{\mathrm{{REF}}}$ in Fig. 4.5-3(a). The reference voltage of Fig. 4.5-3(b) can be written as
$$
{V}_{\mathrm{{REF}}} \cong  {V}_{EB}\left( \frac{{R}_{1} + {R}_{2}}{{R}_{1}}\right)  \tag{4.5-6}
$$
In order to find the value of ${V}_{EB}$ , it is necessary to assume that the transistor ${\beta }_{F}$ (common-emitter current gain) is large and/or the resistance ${R}_{1} + {R}_{2}$ is large. The larger ${V}_{\mathrm{{REF}}}$ becomes in Fig. 4.5-3(b), the more the current $I$ becomes a function of ${V}_{\mathrm{{REF}}}$ and eventually an iterative solution is necessary.
The BJT of Fig. 4.5-3(a) may be replaced with an MOS enhancement device to achieve a voltage that is less dependent on ${V}_{DD}$ than Fig. 4.5-2(a) as shown in Fig. 4.5-4(a). ${V}_{\text{REF }}$ can be found from Eq. (4.2-2), which gives ${V}_{GS}$ as
$$
{V}_{GS} = {V}_{T} + \sqrt{\frac{2I}{\beta }} \tag{4.5-7}
$$
Ignoring channel length modulation, ${V}_{\mathrm{{REF}}}$ is
$$
{V}_{\mathrm{{REF}}} = {V}_{T} - \frac{1}{\beta R} + \sqrt{\frac{2\left( {{V}_{DD} - {V}_{T}}\right) }{\beta R} + \frac{1}{{\beta }^{2}{R}^{2}}} \tag{4.5-8}
$$
If ${V}_{DD} = 5\mathrm{\;V}, W/L = 2$ , and $R$ is ${100}\mathrm{k}\Omega$ , the values of Table 3.1-2 give a reference voltage of 1.281 V. The sensitivity of Fig. 4.5-4(a) can be found as
$$
{\mathbf{S}}_{{V}_{DD}}^{{V}_{\mathrm{{REF}}}} = \left( \frac{1}{\sqrt{1 + {2\beta }\left( {{V}_{DD} - {V}_{T}}\right) R}}\right) \left( \frac{{V}_{DD}}{{V}_{\mathrm{{REF}}}}\right)  \tag{4.5-9}
$$
Using the previous values gives a sensitivity of ${V}_{\mathrm{{REF}}}$ to ${V}_{DD}$ of 0.283 . This sensitivity is not as good as the BJT because the logarithmic function is much less sensitive to its argument than the square root. The value of ${V}_{\mathrm{{REF}}}$ of Fig. 4.5-4(a) can be increased using the technique employed for the BJT reference of Fig. 4.5-3(b), with the result shown in Fig. 4.5-4(b), where the reference voltage is given as
$$
{V}_{\mathrm{{REF}}} = {V}_{GS}\left( {1 + \frac{{R}_{1}}{{R}_{2}}}\right)  \tag{4.5-10}
$$

Figure 4.5-4 (a) MOS equivalent of the pn junction voltage reference. (b) Increasing ${V}_{\mathrm{{REF}}}$ of (a).
In the types of voltage references illustrated in Figs. 4.5-3 and 4.5-4, the designer can use geometry to adjust the value of ${V}_{\mathrm{{REF}}}$ . In the BJT reference the geometric-dependent parameter is ${I}_{s}$ and for the MOS reference it is $W/L$ . The small-signal output resistance of these references is a measure of how dependent the reference will be on the load (see Problem 4.5-5).
We have noted in Figs. 4.5-3(a) and 4.5-4(a) that the sensitivity of the voltage across an active device is less than unity. If the voltage across the active device is used to create a current and this current is somehow used to provide the original current through the device, then a current or voltage will be obtained that is for all practical purposes independent of ${V}_{DD}$ . This technique is called a ${V}_{T}$ referenced source. This technique is also called a bootstrap reference. Figure 4.5-5(a) shows an example of this technique using all MOS devices. M3 and M4 cause the currents ${I}_{1}$ and ${I}_{2}$ to be equal. ${I}_{1}$ flows through M1 creating a voltage ${V}_{GS1}.{I}_{2}$ flows through $R$ creating a voltage ${I}_{2}R$ . Because these two voltages are connected together, an equilibrium point is established. Figure 4.5-5(b) illustrates how the equilibrium point is achieved. On this curve, ${I}_{1}$ and ${I}_{2}$ are plotted as a function of $V$ . The intersection of these curves defines the equilibrium point indicated by $Q$ . The equation describing this equilibrium point is given as
$$
{I}_{2}R = {V}_{T1} + {\left( \frac{2{I}_{1}{L}_{1}}{{K}_{N}^{\prime }{W}_{1}}\right) }^{1/2} \tag{4.5-11}
$$
This equation can be solved for ${I}_{1} = {I}_{2} = {I}_{Q}$ , giving (ignoring $\lambda$ )
$$
{I}_{Q} = {I}_{2} = \frac{{V}_{T1}}{R} + \frac{1}{{\beta }_{1}{R}^{2}} + \frac{1}{R}\sqrt{\frac{2{V}_{T1}}{{\beta }_{1}R} + \frac{1}{{\beta }_{1}^{2}{R}^{2}}} \tag{4.5-12}
$$
To first order, neither ${I}_{1}$ nor ${I}_{2}$ changes as a function of ${V}_{DD}$ ; thus, the sensitivity of ${I}_{Q}$ to ${V}_{DD}$ is essentially zero. A voltage reference can be achieved by mirroring ${I}_{2}\left( { = {I}_{Q}}\right)$ through M5 or M6 and using a resistor. A closer examination shows that channel modulation effects on the M3-M4 current mirrors causes a weak dependence on ${V}_{DD}$ .

Figure 4.5-5 (a) Threshold-referenced circuit. (b) $I - V$ characteristics of (a), illustrating how the bias point is established.
Unfortunately, there are two possible equilibrium points on Fig. 4.5-5(b). One is at $Q$ and the other is at the origin. In order to prevent the circuit from choosing the wrong equilibrium point, a startup circuit is necessary. The circuit within the dotted box in Fig. 4.5-5(a) functions as a startup circuit. If the circuit is at the undesired equilibrium point, then ${I}_{1}$ and ${I}_{2}$ are zero. However, M7 will provide a current in M1 that will cause the circuit to move to the equilibrium point at $Q$ . As the circuit approaches the point $Q$ , the source voltage of M7 increases, causing the current through M7 to decrease. At $Q$ the current through M1 is essentially the current through M3.
An alternate version of Fig. 4.5-5(a) that uses ${V}_{BE}$ to reference the voltage or current is shown in Fig. 4.5-6. It can be shown that the equilibrium point is defined by the relationship
$$
{I}_{2}R = {V}_{BE1} = {V}_{T}\ln \left( \frac{{I}_{1}}{{I}_{s}}\right)  \tag{4.5-13}
$$
This reference circuit also has two equilibrium points and a startup circuit similar to Fig. 4.5-5(a) is necessary. The reference circuits in Figs. 4.5-5(a) and 4.5-6 represent a very good method of implementing power-supply-independent references. Either circuit can be operated in the weak-threshold inversion in order to develop a low-power, low-supply-voltage reference.
Unfortunately, supply-independent references are not necessarily temperature independent because the pn junction and gate-source voltage drops are temperature dependent, as noted in Section 2.5. The concept of fractional temperature coefficient $\left( {T{C}_{F}}\right)$ , defined in

Figure 4.5-6 Base-emitter voltage-referenced circuit.
Eq. (2.5-7), will be used to characterize the temperature dependence of voltage and current references. We see that $T{C}_{F}$ is related to the sensitivity as defined in Eq. (4.5-1)
$$
T{C}_{F} = \frac{1}{T}\left( {\mathbf{S}}_{T}^{X}\right)  \tag{4.5-14}
$$
where $X = {V}_{\text{REF }}$ or ${I}_{\text{REF }}$ . Let us now consider the temperature characteristics of the simple pn junction of Fig. 4.5-3(a). If we assume that ${V}_{DD}$ is much greater than ${V}_{\mathrm{{REF}}}$ , then Eq. (4.5-4) describes the reference voltage. Although ${V}_{DD}$ is independent of temperature, $R$ is not and must be considered. The fractional temperature coefficient of this voltage reference can be expressed using the results of Eq. (2.5-17) as
$$
T{C}_{F} = \frac{1}{{V}_{\mathrm{{REF}}}}\frac{d{V}_{\mathrm{{REF}}}}{dT} \cong  \frac{{V}_{\mathrm{{REF}}} - {V}_{G0}}{{V}_{\mathrm{{REF}}}T} - \frac{3k}{{V}_{\mathrm{{REF}}}q} - \frac{kT}{{V}_{\mathrm{{REF}}}q}\left( \frac{dR}{RdT}\right)  \tag{4.5-15}
$$
if ${v}_{D} = {V}_{\mathrm{{REF}}}$ . Assuming a ${V}_{\mathrm{{REF}}}$ of ${0.6}\mathrm{\;V}$ at room temperature, the $T{C}_{\mathrm{F}}$ of the simple pn voltage reference is approximately $- {2500}\mathrm{{ppm}}/{}^{ \circ  }\mathrm{C}$ .
Figure 4.5-4(a) is the MOS equivalent of the simple pn junction voltage reference. The temperature dependence of ${V}_{\mathrm{{REF}}}$ of this circuit can be written as
$$
\frac{d{V}_{\mathrm{{REF}}}}{dT} = \frac{-\alpha  + \sqrt{\frac{{V}_{DD} - {V}_{\mathrm{{REF}}}}{2\beta R}}\left( {\frac{1.5}{T} - \frac{1}{R}\frac{dR}{dT}}\right) }{1 + \frac{1}{\sqrt{{2\beta R}\left( {{V}_{DD} - {V}_{\mathrm{{REF}}}}\right) }}} \tag{4.5-16}
$$
## Calculation of Threshold Voltage Reference Circuit
Calculate the temperature coefficient of the circuit in Fig. 4.5-4(a), where $W/L = 2,{V}_{DD} =$ $5\mathrm{\;V}$ , and $R = {100}\mathrm{k}\Omega$ , using the parameters of Table 3.1-2. Resistor $R$ is polysilicon and has a temperature coefficient of ${1500}\mathrm{{ppm}}/{}^{ \circ  }\mathrm{C}$ .
SOLUTION
Using Eq. (4.5-8),
$$
{V}_{\mathrm{{REF}}} = {V}_{T} - \frac{1}{{\beta }_{R}} + \sqrt{\frac{2\left( {{V}_{DD} - {V}_{T}}\right) }{\beta R} + \frac{1}{{\beta }^{2}{R}^{2}}}
$$
$$
{\beta R} = {220} \times  {10}^{-6} \times  {10}^{5} = {22}
$$
$$
{V}_{\mathrm{{REF}}} = {0.7} - \frac{1}{22} + \sqrt{\frac{2\left( {5 - {0.7}}\right) }{22} + {\left( \frac{1}{22}\right) }^{2}}
$$
$$
{V}_{\text{REF }} = {1.281}
$$
$$
\frac{1dR}{RdT} = {1500}\mathrm{{ppm}}/{}^{ \circ  }\mathrm{C}
$$
$$
\frac{d{V}_{\mathrm{{REF}}}}{dT} = \frac{-\alpha  + \sqrt{\frac{{V}_{DD} - {V}_{\mathrm{{REF}}}}{2\beta R}}\left( {\frac{1.5}{T} - \frac{1}{R}\frac{dR}{dT}}\right) }{1 + \frac{1}{\sqrt{{2\beta R}\left( {{V}_{DD} - {V}_{\mathrm{{REF}}}}\right) }}}
$$
$$
\frac{d{V}_{\mathrm{{REF}}}}{dT} = \frac{-{2.3} \times  {10}^{-3} + \sqrt{\frac{5 - {1.281}}{2\left( {22}\right) }}\left( {\frac{1.5}{300} - {1500} \times  {10}^{-6}}\right) }{1 + \frac{1}{\sqrt{2\left( {22}\right) \left( {5 - {1.281}}\right) }}}
$$
$$
\frac{d{V}_{\mathrm{{REF}}}}{dT} =  - {1.189} \times  {10}^{-3}\mathrm{\;V}/{}^{ \circ  }\mathrm{C}
$$
The fractional temperature coefficient is given by
$$
T{C}_{F} = \frac{1}{{V}_{\mathrm{{REF}}}}\frac{d{V}_{\mathrm{{REF}}}}{dT}
$$
giving, for this example,
$$
T{C}_{F} =  - {1.189} \times  {10}^{-3}\left( \frac{1}{1.281}\right) {}^{ \circ  }{\mathrm{C}}^{-1} =  - {928}\mathrm{{ppm}}/{}^{ \circ  }\mathrm{C}
$$
Unfortunately, the $T{C}_{F}$ of this example is not realistic because the values of $\alpha$ and the $T{C}_{F}$ of the resistor do not have the implied accuracy.
---
Example 4.5-1
---
The bootstrap reference circuit of Fig. 4.5-5(a) has its current ${I}_{2}$ given by Eq. (4.5-12). If the product of $R$ and $\beta$ is large, the $T{C}_{F}$ of the bootstrap reference circuit can be approximated as
$$
T{C}_{F} = \frac{1}{{V}_{T}}\frac{d{V}_{T}}{dT} - \frac{1}{R}\frac{dR}{dT} = \frac{-\alpha }{{V}_{T}} - \frac{1}{R}\frac{dR}{dT} \tag{4.5-17}
$$
---
Example 4.5-2
---
## Calculation of Bootstrap Reference Circuit
Calculate the temperature coefficient of the circuit in Fig. 4.5-5(a), where ${\left( W/L\right) }_{1} = {20}$ , ${V}_{DD} = 5\mathrm{\;V}$ , and $R = {100}\mathrm{k}\Omega$ using the parameters of Table 3.1-2. Resistor $R$ is polysilicon and has a temperature coefficient of ${1500}\mathrm{{ppm}}/{}^{ \circ  }\mathrm{C}.\alpha  = {2.3} \times  {10}^{-3}\mathrm{\;V}/{}^{ \circ  }\mathrm{C}$ .
SOLUTION
Using Eq. (4.5-12),
$$
{I}_{Q} = {I}_{2} = \frac{{V}_{T1}}{R} + \frac{1}{{\beta }_{1}{R}^{2}} + \frac{1}{R}\sqrt{\frac{2{V}_{T1}}{{\beta }_{1}R} + \frac{1}{{\beta }_{1}^{2}{R}^{2}}}
$$
$$
{\beta }_{1}R = {220} \times  {10}^{-5} \times  {10}^{5} = {220}
$$
$$
{\beta }_{1}{R}^{2} = {220} \times  {10}^{-5} \times  {10}^{10} = {22} \times  {10}^{6}
$$
$$
{I}_{Q} = \frac{0.7}{{10}^{5}} - \frac{1}{{22} \times  {10}^{6}} + \frac{1}{{10}^{5}}\sqrt{\frac{2 \times  {0.7}}{220} + {\left( \frac{1}{220}\right) }^{2}}
$$
$$
{I}_{Q} = {7.75\mu }\mathrm{A}
$$
$$
\frac{1}{R}\frac{dR}{dT} = {1500}\mathrm{{ppm}}/{}^{ \circ  }\mathrm{C}
$$
$$
T{C}_{F} = \frac{-{2.3} \times  {10}^{-3}}{0.7} - {1500} \times  {10}^{-6}{}^{ \circ  }{\mathrm{C}}^{-1} =  - {4.79} \times  {10}^{-3}{}^{ \circ  }{\mathrm{C}}^{-1} =  - {4790}\mathrm{{ppm}}/{}^{ \circ  }\mathrm{C}
$$
The temperature behavior of the base-emitter-referenced circuit of Fig. 4.5-6 is similar to that of the threshold-referenced circuit of Fig. 4.5-5(a). Equation (4.5-13) showed that ${I}_{2}$ is equal to ${V}_{BE1}$ divided by $R$ . Thus, Eq. (4.5-17) above expresses the $T{C}_{F}$ of this reference if ${V}_{T}$ is replaced by ${V}_{BE}$ as follows:
$$
T{C}_{F} = \frac{1}{{V}_{BE}}\frac{d{V}_{BE}}{dT} - \frac{1}{R}\frac{dR}{dT} \tag{4.5-18}
$$
Assuming ${V}_{BE}$ of ${0.6}\mathrm{\;V}$ gives a $T{C}_{F}$ of $- {2333}\mathrm{{ppm}}/{}^{ \circ  }\mathrm{C}$ .

Figure 4.5-7 Simple, power-supply independent current reference.
In many applications, the designer needs only a reasonably stable bias voltage or bias current. A simple and efficient realization for this situation based on the ideas in Figs. 4.5-5 and 4.5-6 is shown in Fig. 4.5-7. It consists of four transistors and one resistor. The two transistors M5 and M6 are used to create the sinking or sourcing currents. To simplify the design, the $W/L$ ratio of M1, M3, and M4 are identical and M2 is four times larger. The upper current mirror consisting of M3-M4 keeps the current in both sides equal. The defining equation can be written as
$$
{V}_{GS1} = {V}_{GS2} + {I}_{2}R \tag{4.5-19}
$$
Solving for ${I}_{2}$ and assuming all transistors are operating in the saturation region gives
$$
{I}_{2} = \frac{{V}_{GS1} - {V}_{GS2}}{R} = \frac{1}{R}\left( {\sqrt{\frac{2{I}_{1}}{{\beta }_{1}}} - \sqrt{\frac{2{I}_{2}}{{\beta }_{2}}}}\right)  = \frac{\sqrt{2{I}_{1}}}{R\sqrt{{\beta }_{1}}}\left( {1 - \frac{1}{2}}\right)  \tag{4.5-20}
$$
since ${I}_{1} = {I}_{2}$ and ${\beta }_{2} = 4{\beta }_{1}$ . We can solve for the bias currents, ${I}_{1} = {I}_{2}$ , from Eq. (4.5-11) as
$$
{I}_{1} = {I}_{2} = \frac{1}{2{\beta }_{1}{R}^{2}} \tag{4.5-21}
$$
While the $W/L$ values of M5 and M6 are shown as the same as M1, they could be used to decrease or increase the value of current given in Eq. (4.5-21).
Fig. 4.5-7 also provides a bias voltage with respect to ground. This reference voltage is equal to ${V}_{GS1}$ and is given as
$$
{V}_{\text{Bias }} = {V}_{GS1} = \sqrt{\frac{2{I}_{2}}{{\beta }_{1}}} = {V}_{TN} = \frac{1}{{\beta }_{1}R} + {V}_{TN} \tag{4.5-22}
$$
Since Fig. 4.5-7 has two stable operating points due to the interaction of the negative and positive feedback, it may be necessary to provide a startup circuit as shown in Figs. 4.5-5 and 4.5-6.
---
Example 4.5-2
---
## Design of the Simple Reference of Fig. 4.5-7
Use Fig. 4.5-7 to design (a) a ${20\mu }\mathrm{A}$ current sink and (b) a $1\mathrm{\;V}$ bias voltage. Assume the MOSFET parameters of Table 3.1-2 and the $W/L$ of $\mathrm{M}1 = 5$ .
## SOLUTION
From Eq. (4.5-21) we can design the resistor, $R$ , as
$$
R = \frac{1}{\sqrt{2{\beta }_{1}{I}_{1}}} = \frac{1}{\sqrt{2 \times  {110}\left( {\mu \mathrm{A}/{\mathrm{V}}^{2}}\right)  \times  5 \times  {20\mu }\mathrm{A}}} = {6.74}\mathrm{k}\Omega
$$
To design the $1\mathrm{\;V}$ bias voltage we use Eq. (4.5-22) to redesign the resistor $R$ as
$$
R = \frac{1}{{\beta }_{1}\left( {{V}_{\text{Bias }} - {V}_{TN}}\right) } = \frac{1}{{110}\left( {\mu \mathrm{A}/{\mathrm{V}}^{2}}\right)  \times  5 \times  \left( {1\mathrm{\;V} - {0.7}\mathrm{\;V}}\right) } = {6.06}\mathrm{k}\Omega
$$
The voltage and current references presented in this section have the objective of providing a stable value of current with respect to changes in power supply and temperature. It was seen that while power-supply independence could thus be obtained, satisfactory temperature performance could not. To illustrate this conclusion, consider the accuracy requirement for a voltage reference for 8-bit accuracy. Maintaining this accuracy over a ${100}^{ \circ  }\mathrm{C}$ change requires the $T{C}_{F}$ of the reference to be $1/\left( {{256} \times  {100}^{ \circ  }\mathrm{C}}\right)$ or ${39}\mathrm{{ppm}}/{}^{ \circ  }\mathrm{C}$ .

### 4.6 Temperature-Independent References
In the last section, we showed voltage and current references that were reasonably independent of power supply but were dependent on temperature. In this section, we will show how to design voltage and current references that are reasonably independent of both power supply and temperature. These references are typically called bandgap references [10-14] although they have very little to do with the bandgap voltage. These references typically have a temperature coefficient (TC) of ${10} - {50}\mathrm{{ppm}}/{}^{ \circ  }\mathrm{C}$ over a temperature range of $0 - {70}{}^{ \circ  }\mathrm{C}$ without correction. With correction [15-20], they are capable of achieving $1\mathrm{{ppm}}/{}^{ \circ  }\mathrm{C}$ or less over $0 - {70}^{ \circ  }\mathrm{C}$ .
## Voltage References with Moderate Temperature Stability
The principle of temperature-independent references is very simple. It begins with identifying a voltage that increases with temperature and a voltage that decreases with temperature. Figure 4.6-1(a) shows two voltages, one that increases proportionately with temperature and one that decreases proportionately with temperature. The increasing voltage is called proportional to absolute temperature or PTAT and the decreasing voltage is called complementary to absolute temperature or CTAT. Next, the voltage with the smallest magnitude of slope (in this case ${V}_{PTAT}$ ) is multiplied by a temperature independent constant, $K$ , so that the magnitudes of the slopes are equal. Finally, if $K \cdot  {V}_{PTAT}\left( T\right)$ is added to ${V}_{CTAT}\left( T\right)$ , as illustrated in Fig. 4.6-1(b), the resulting voltage should be independent of temperature.
To implement the principle above, we must develop ${V}_{PTAT}$ and ${V}_{CTAT}$ voltages. We will begin by showing how to generate a PTAT voltage. Figure 4.6-2 shows two current sources each in series with a diode. The diode could also be a bipolar junction transistor with the collector connected to the base. The voltage, $\Delta {V}_{D}$ , will be PTAT and can be expressed as
$$
{V}_{PTAT} = \Delta {V}_{D} = {V}_{D1} - {V}_{D2} = {V}_{t}\ln \left( \frac{{I}_{1}}{{I}_{s1}}\right)  - {V}_{t}\ln \left( \frac{{I}_{2}}{{I}_{s2}}\right)
$$
$$
= {V}_{t}\ln \left( {\frac{{I}_{1}}{{I}_{2}}\frac{{I}_{s2}}{{I}_{s1}}}\right)  = {V}_{t}\ln \left( \frac{{I}_{s2}}{{I}_{s1}}\right)  = {V}_{t}\ln \left( \frac{{A}_{2}}{{A}_{1}}\right)  = \frac{kT}{q}\ln \left( \frac{{A}_{2}}{{A}_{1}}\right)  \tag{4.6-1}
$$

Figure 4.6-1 (a) Illustration of voltages that increase and decrease with increasing temperature. (b) Multiplication of ${V}_{PTAT}\left( T\right)$ by $K$ to make the slopes of ${V}_{PTAT}\left( T\right)$ and ${V}_{CTAT}\left( T\right)$ equal but opposite.
if ${I}_{1} = {I}_{2}$ . Equation (4.6-1) shows that $\Delta {V}_{D}$ is proportional to absolute temperature with a proportionality constant or slope equal to Boltzmann's constant divided by the charge of an electron $\left( {k/q = {1.381} \times  {10}^{-{23}}\mathrm{\;J}/{}^{ \circ  }\mathrm{K}/{1.6} \times  {10}^{-{19}}\mathrm{{Coul}} = {0.086}\mathrm{\;{mV}}/{}^{ \circ  }\mathrm{C}}\right)$ .
In developing voltage-independent references, it is useful to show how to generate PTAT and CTAT currents. A pseudo-PTAT current can be created by placing the PTAT voltage $\Delta {V}_{D}$ across a resistor. Unfortunately, all resistors have some sort of temperature dependence so that the current is not truly PTAT, thus the name pseudo-PTAT. This will not be a problem because in most cases, the pseudo-PTAT current runs through a second resistor, creating a new PTAT voltage. If the two resistors have the same temperature dependence, then the new PTAT voltage is truly PTAT. Pseudo-PTAT currents will be designated as PTAT'.
Figures 4.6-3(a) and 4.6-3(b) show two ways of creating a pseudo-PTAT currents. Figure 4.6- 3(a) is similar to Fig. 4.5-6 except for the diode ${D}_{2}$ , which has been added in series with the resistor $R$ . The transistors M1 and M2 ensure that the voltage across diode ${D}_{1}$ is the same as the voltage across the series combination of the resistor $R$ and the diode ${D}_{2}$ . The pseudo-PTAT current is
$$
{I}_{PTAT}{}^{\prime } = \frac{{V}_{D1} + {V}_{GS1} - {V}_{GS2} - {V}_{D2}}{R} = \frac{kT}{Rq}\ln \left( \frac{{A}_{2}}{{A}_{1}}\right)  \tag{4.6-2}
$$
if ${V}_{GS1} = {V}_{GS2}$ . Figure 4.6-3(b) shows a method of generating the pseudo-PTAT current using an op amp to make the voltage across diode ${D}_{1}$ the same as the voltage across the series combination of the resistor $R$ and the diode ${D}_{2}$ . Note that the op amp has both positive and negative feedback, which is also the case for Fig. 4.6-3(a). For these circuits to work properly, the negative feedback loop gain should be at least twice as large as the positive feedback loop gain.

Figure 4.6-2 Implementation of a PTAT voltage.

Figure 4.6-3 Creation of pseudo-PTAT currents using (a) MOSFETs only and (b) MOSFETs and an op amp.
A true PTAT current, ${I}_{PTAT}$ , can be generated from a pseudo-PTAT current using the zero temperature coefficient property described in Section 3.2. Figure 4.6-4 shows the application of this property to obtain a true PTAT current. The pseudo-PTAT current can be provided by either Fig. 4.6-3(a) or 4.6-3(b). If the resistor in Fig. 4.6-3(a) or 4.6-3(b) is designated ${R}_{1}$ , then the gate-source voltage of the MOSFET can be written as
$$
{V}_{GS6}\left( {ZTC}\right)  = {I}_{{PTA}{T}^{\prime }}{R}_{2} = \frac{{R}_{2}}{{R}_{1}}\frac{kT}{q}\ln \left( \frac{{A}_{2}}{{A}_{1}}\right)  \tag{4.6-3}
$$
If the voltage in Eq. (4.6-3) is designed to be the ZTC point of the MOSFET, then because the gate-source voltage is PTAT, the drain current should also be PTAT. This of course assumes that the temperature change is not large enough to make the ZTC point shift. The influence of the resistors, ${R}_{1}$ and ${R}_{2}$ , can be found by differentiating their ratio with respect to temperature. The result is
$$
\frac{d\left( {{R}_{2}/{R}_{1}}\right) }{dT} = \frac{{1d}{R}_{2}}{{R}_{1}{dT}} - \frac{{R}_{2}}{{R}_{1}^{2}}\frac{d{R}_{1}}{dT} = \frac{{R}_{2}}{{R}_{1}}\left\lbrack  {\frac{{1d}{R}_{2}}{{R}_{2}{dT}} - \frac{{1d}{R}_{1}}{{R}_{1}{dT}}}\right\rbrack   \tag{4.6-4}
$$
If the temperature coefficients of ${R}_{1}$ and ${R}_{2}$ are the same, then the resistor ratio does not influence the temperature characteristics. At this point, we have shown how to develop voltages and currents that are PTAT.

Figure 4.6-4 Generation of a true PTAT current from a pseudo-PTAT current.
The next step is to show how to create a voltage that is complementary to absolute temperature (CTAT). This becomes more challenging because a voltage with a true complementary dependence on temperature does not exist. The best candidate for finding a voltage that decreases linearly with absolute temperature is the ${pn}$ junction. The current density in a diode is given as
$$
{J}_{D} = \left\lbrack  {\frac{q{D}_{n}{n}_{po}}{{L}_{n}} + \frac{q{D}_{p}{p}_{no}}{{L}_{p}}}\right\rbrack  \exp \left( \frac{{v}_{D}}{{V}_{t}}\right)  \tag{4.6-5}
$$
where
$$
{J}_{D} = \text{diode current density}\left( {\mathrm{A}/{\mathrm{m}}^{2}}\right)
$$
$$
{n}_{po} = \text{equilibrium concentration of electrons in the p-side}
$$
$$
{p}_{no} = \text{equilibrium concentration of holes in the n-side}
$$
$$
{D}_{n} = \text{average diffusion constant for electrons}
$$
$$
{D}_{p} = \text{average diffusion constant for holes}
$$
$$
{L}_{n} = \text{diffusion length of electrons in the p-side}
$$
$$
{L}_{p} = \text{diffusion length of holes in the n-side}
$$
The equilibrium concentration of the electrons and holes can be expressed as
$$
{n}_{po} = \frac{{n}_{i}^{2}}{{N}_{A}} \tag{4.6-6}
$$
and
$$
{p}_{no} = \frac{{n}_{i}^{2}}{{N}_{D}} \tag{4.6-7}
$$
where
$$
{n}_{i}^{2} = D{T}^{3}\exp \left( {-{V}_{G0}/{V}_{t}}\right)  \tag{4.6-8}
$$
The term $D$ is a temperature-independent constant and ${V}_{G0}$ is the bandgap voltage at room temperature (1.205 volts). Combining Eqs. (4.6-5) through (4.6-8) results in the following equation for diode current density:
$$
{J}_{D} = \left\lbrack  {\frac{q{D}_{n}}{{L}_{n}{N}_{A}} + \frac{q{D}_{p}}{{L}_{p}{N}_{D}}}\right\rbrack  {n}_{i}^{2}\exp \left( \frac{{V}_{D}}{{V}_{t}}\right)  \tag{4.6-9}
$$
or
$$
{J}_{D} = A{T}^{\gamma }\exp \left( \frac{{V}_{D} - {V}_{G0}}{{V}_{t}}\right)  \tag{4.6-10}
$$
In Eq. (4.6-10), the temperature-independent constants of Eq. (4.6-9) are combined into a single constant $A$ . The term ${T}^{3}$ in Eq. (4.6-8) has been replaced with ${T}^{\gamma }$ due to the influence of the temperature dependence of ${D}_{n}$ and ${D}_{p}$ . Solving for ${V}_{D}$ from Eq. (4.6-10) gives
$$
{V}_{D} = \frac{kT}{q}\ln \left( \frac{{J}_{D}}{A{T}^{\gamma }}\right)  + {V}_{G0} \tag{4.6-11}
$$
Now consider ${J}_{D}$ at a temperature ${T}_{0}$ .
$$
{J}_{D0} = A{T}_{0}^{\gamma }\exp \left\lbrack  {\frac{q}{k{T}_{0}}\left( {{V}_{D0} - {V}_{G0}}\right) }\right\rbrack   \tag{4.6-12}
$$
The ratio of ${J}_{D}$ to ${J}_{D0}$ is
$$
\frac{{J}_{D}}{{J}_{D0}} = {\left( \frac{T}{{T}_{0}}\right) }^{\gamma }\exp \left\lbrack  {\frac{q}{k}\left( {\frac{{V}_{D} - {V}_{G0}}{T} - \frac{{V}_{D0} - {V}_{G0}}{{T}_{0}}}\right) }\right\rbrack   \tag{4.6-13}
$$
Equation (4.6-13) can be rearranged to get ${V}_{D}$ which is a CTAT voltage as
$$
{V}_{CTAT} = {V}_{D} = {V}_{G0}\left( {1 - \frac{T}{{T}_{0}}}\right)  + {V}_{D0}\left( \frac{T}{{T}_{0}}\right)  + \frac{\gamma kT}{q}\ln \left( \frac{{T}_{0}}{T}\right)  + \frac{kT}{q}\ln \left( \frac{{J}_{D}}{{J}_{D0}}\right)  \tag{4.6-14}
$$
A close examination of Eq. (4.6-14) shows that the term $\frac{\gamma kT}{q}\ln \left( \frac{{T}_{0}}{T}\right)$ is not linear with temperature. This term will cause ${V}_{CTAT}\left( T\right)$ in Fig. 4.6-1(b) to follow the shaded, dashed line instead of the straight bold line. This problem is called the bandgap curvature problem. We will look at ways to overcome this problem later.
The last step is to generate currents that are CTAT. We will use the CTAT voltage of the pn junction to accomplish this objective. Figures 4.6-5(a) and 4.6-5(b) show two ways of accomplishing this using negative feedback [15]. The current flowing in the resistor $R$ is given as
$$
{I}_{CTAT}{}^{\prime } = \frac{{V}_{BE}}{R} = \frac{{V}_{D}}{R} \tag{4.6-15}
$$
The negative feedback loop is indicated on both circuits. This loop causes the current flowing in $R$ to be equal to the current in Eq. (4.6-15). The resistor, $R$ , will be dependent on temperature, which causes this current to be pseudo-CTAT as indicated by the primed notation. It is not necessary to find a true CTAT current because in all applications, the pseudo-CTAT current flows through a second resistor to create a true CTAT voltage assuming the two resistors have the same temperature dependence.

Figure 4.6-5 Generation of a pseudo-CTAT current using (a) a bipolar transistor and (b) a diode.
A temperature-independent voltage reference can be generated using any of the techniques shown in Fig. 4.6-6. The temperature-independent voltage reference has two basic structures. They are the series realization in Fig. 4.6-6(a) and the parallel realization in Fig. 4.6-6(b). There are realizations that use a combination of the series and parallel realizations [16]. For the series realization, the temperature-independent reference voltage can be written as
$$
{V}_{\mathrm{{REF}}} = {I}_{PTAT}{}^{\prime }{R}_{2} + {V}_{D} = \left( \frac{{R}_{2}}{{R}_{1}}\right) {V}_{PTAT} + {V}_{CTAT} \tag{4.6-16}
$$
The resistor, ${R}_{1}$ , comes from Eq. (4.6-3) where $R = {R}_{1}$ or from the realizations for ${I}_{PTAT}{}^{\prime }$ like those in Figure 4.6-3.
For the parallel realization, the temperature-independent reference voltage can be written as
$$
{V}_{\mathrm{{REF}}} = \left( {{I}_{PTAT}{}^{\prime } + {I}_{CTAT}{}^{\prime }}\right) {R}_{3} = \left( \frac{{R}_{3}}{{R}_{1}}\right) {V}_{PTAT} + \left( \frac{{R}_{3}}{{R}_{2}}\right) {V}_{CTAT} \tag{4.6-17}
$$
The resistor, ${R}_{2}$ , comes from Eq. (4.6-15) where $R = {R}_{2}$ or from the realizations for ${I}_{CTAT}{}^{\prime }$ like those in Figure 4.6-5.
In order to achieve temperature independence, Eqs. (4.6-16) and (4.6-17) must be differentiated with respect to temperature and set equal to zero. The resistor ratios and other parameters can be used to achieve temperature independence. Let us first examine the series realization.

Figure 4.6-6 Temperature-independent voltage references: (a) series form and (b) parallel form.
Differentiating Eq. (4.6-16) with respect to absolute temperature gives
$$
\frac{d{V}_{\mathrm{{REF}}}}{dT} = \left( \frac{{R}_{2}}{{R}_{1}}\right) \frac{d{V}_{PTAT}}{dT} + \frac{d{V}_{CTAT}}{dT} \tag{4.6-18}
$$
assuming the ${R}_{1}$ and ${R}_{2}$ have identical dependence on temperature. Differentiating Eqs. (4.6-1) and (4.6-14) gives
$$
{\left. \frac{d{V}_{PTAT}}{dT}\right| }_{T = {T}_{0}} = \frac{k}{q}\ln \left( \frac{{J}_{D2}}{{J}_{D1}}\right)  = \frac{k}{q}\ln \left( \frac{{A}_{2}}{{A}_{1}}\right)  = \frac{{V}_{t0}}{{T}_{0}}\ln \left( \frac{{A}_{2}}{{A}_{1}}\right)  = \frac{{V}_{PTAT}}{{T}_{0}} \tag{4.6-19}
$$
and
$$
{\left. \frac{d{V}_{CTAT}}{dT}\right| }_{T = {T}_{0}} = \frac{{V}_{D} - {V}_{GO}}{{T}_{0}} + \left( {\alpha  - \gamma }\right) \left( \frac{k}{q}\right)  = \frac{{V}_{CTAT} - {V}_{GO}}{{T}_{0}} + \left( {\alpha  - \gamma }\right) \left( \frac{{V}_{t0}}{{T}_{0}}\right)  \tag{4.6-20}
$$
where for Eq. (4.6-20) we have assumed that the current density, ${J}_{D}$ , in Eq. (4.6-14) has a temperature dependence of ${T}^{\alpha }$ . Substituting Eqs. (4.6-19) and (4.6-20) into Eq. (4.6-18) and equating to zero gives the desired result as
$$
\text{ Temperature-independent constant } = K = \frac{{R}_{2}}{{R}_{1}} = \frac{{V}_{GO} - {V}_{CTAT} + \left( {\gamma  - \alpha }\right) {V}_{t0}}{{V}_{PTAT}} \tag{4.6-21}
$$
Substituting Eq. (4.6-21) into Eq. (4.6-16) gives the value of ${V}_{\mathrm{{REF}}}$ as
$$
{V}_{\mathrm{{REF}}} = {V}_{GO} - {V}_{CTAT} + \left( {\gamma  - \alpha }\right) {V}_{t0} + {V}_{CTAT} = {V}_{GO} + \left( {\gamma  - \alpha }\right) {V}_{t0} \tag{4.6-22}
$$
The second term of Eq. (4.6-22) is small compared to ${V}_{GO}$ so that the reference voltage is slightly larger than the bandgap voltage, ${V}_{GO}$ . Historically, this type of reference is called the bandgap voltage reference [10]. However as stated earlier, the operation of the bandgap voltage reference has nothing to do with the bandgap voltage.
---
Example 4.6-1
---
## Design of ${R}_{2}/{R}_{1}$ for a Series Temperature-Independent Voltage Reference
Assuming that ${A}_{2}/{A}_{1} = {10}$ and that ${V}_{CTAT} = {0.6}\mathrm{\;V}$ , find the value of the temperature-independent constant, ${R}_{2}/{R}_{1}$ , and the value of the reference voltage at room temperature where ${V}_{t0} = {0.026}\mathrm{\;V}$ .
SOLUTION
Equation (4.6-21) gives
$$
\frac{{R}_{2}}{{R}_{1}} = \frac{{1.205} - {0.6} + {2.2}\left( {0.026}\right) }{{0.026}\left( {2.3026}\right) } = {11.04}
$$
Equation (4.6-22) gives the value of ${V}_{\mathrm{{REF}}}$ as
$$
{V}_{\mathrm{{REF}}} = {1.205} + {2.2}\left( {0.026}\right)  = {1.262}\mathrm{\;V}
$$
The parallel form of the temperature-independent voltage reference of Eq. (4.6-17) is independent of temperature under exactly the same conditions as the series form given in Eq. (4.6-21). In the case of the parallel form, the value of ${V}_{\mathrm{{REF}}}$ is
$$
{V}_{\mathrm{{REF}}} = \frac{{R}_{3}}{{R}_{2}}\left\lbrack  \left( {{V}_{GO} + \left( {\gamma  - \alpha }\right) {V}_{t0}}\right. \right\rbrack   \tag{4.6-23}
$$
We see that the ratio of ${R}_{3}$ to ${R}_{2}$ can be used to achieve any desired value of temperature-independent voltage.
---
Example 4.6-2
---
## Design of ${R}_{2}/{R}_{1}$ and ${R}_{3}/{R}_{2}$ for a Parallel Temperature-Independent Voltage Reference
Assuming that ${A}_{2}/{A}_{1} = {10}$ and that ${V}_{CTAT} = {0.6}\mathrm{\;V}$ , find the value of ${R}_{1},{R}_{2}$ , and ${R}_{3}$ that gives a temperature-independent value of the reference voltage at room temperature of ${0.5}\mathrm{\;V}$ where ${V}_{t0} = {0.026}\mathrm{\;V}$ if ${R}_{1} = 1\mathrm{k}\Omega$ .
## SOLUTION
Equation (4.6-21) gives that ${R}_{2}/{R}_{1} = {11.04}$ . Therefore, ${R}_{2} = {11.04}\mathrm{k}\Omega$ . From Eq. (4.6-23) and Example 4.6-1, we find that
$$
\frac{{R}_{3}}{{R}_{2}} = \frac{{V}_{\mathrm{{REF}}}}{{V}_{GO} + \left( {\gamma  - \alpha }\right) {V}_{t0}} = \frac{{0.5}\mathrm{\;V}}{{1.262}\mathrm{\;V}} = {0.3962}
$$
Therefore, ${R}_{3} = {0.3962}\left( {{11.04}\mathrm{k}\Omega }\right)  = {4.376}\mathrm{k}\Omega$ .
One of the first realizations of the series form of the temperature-independent reference is shown in Fig. 4.6-7 [11]. This realization is compatible with a normal n-well CMOS technology using substrate bipolar transistors. In fact, the bipolar transistors could be replaced by diodes. If we assume for the present that ${V}_{OS}$ is zero, then the voltage ${V}_{R1}$ can be written as
$$
{V}_{R1} = {V}_{EB2} - {V}_{EB1} = {V}_{t}\ln \left( \frac{{J}_{2}}{{J}_{S2}}\right)  - {V}_{t}\ln \left( \frac{{J}_{1}}{{J}_{S1}}\right)  = {V}_{t}\ln \left( \frac{{I}_{2}{A}_{E1}}{{I}_{1}{A}_{E2}}\right)  \tag{4.6-24}
$$

Figure 4.6-7 A realization of the series temperature-independent voltage reference that uses an op amp.
However, the op amp also forces the relationship
$$
{I}_{1}{R}_{2} = {I}_{2}{R}_{3} \tag{4.6-25}
$$
Therefore, the reference voltage of Fig. 4.6-7 can be written as
$$
{V}_{\mathrm{{REF}}} = {V}_{EB2} + {I}_{2}{R}_{3} = {V}_{BE2} + {V}_{R1}\left( \frac{{R}_{2}}{{R}_{1}}\right)  \tag{4.6-26}
$$
Substituting Eq. (4.6-25) into Eq. (4.6-24) and the result into Eq. (4.6-26) gives
$$
{V}_{\mathrm{{REF}}} = {V}_{EB2} + \left( \frac{{R}_{2}}{{R}_{1}}\right) {V}_{t}\ln \left( \frac{{R}_{2}{A}_{E1}}{{R}_{3}{A}_{E2}}\right)  \tag{4.6-27}
$$
Differentiating Eq. (4.6-27) with respect to absolute temperature and setting the result to zero gives
$$
\left( \frac{{R}_{2}}{{R}_{1}}\right) \ln \left( \frac{{R}_{2}{A}_{E1}}{{R}_{3}{A}_{E2}}\right)  = \frac{{V}_{GO} - {V}_{CTAT} + \left( {\gamma  - \alpha }\right) {V}_{t0}}{{V}_{PTAT}} \tag{4.6-28}
$$
Thus, the temperature-independent constant, $K$ , is defined in terms of resistor and emitter-base area ratios. It can be shown that if the input-offset voltage is not zero, Eq. (4.6-27) becomes
$$
{V}_{\mathrm{{REF}}} = {V}_{EB2} - \left( {1 + \frac{{R}_{2}}{{R}_{1}}}\right) {V}_{OS} + \frac{{R}_{2}}{{R}_{1}}{V}_{t}\ln \left\lbrack  {\frac{{R}_{2}{A}_{E1}}{{R}_{3}{A}_{E2}}\left( {1 - \frac{{V}_{OS}}{{I}_{1}{R}_{2}}}\right) }\right\rbrack   \tag{4.6-29}
$$
It is clear that the input-offset voltage of the op amp should be small and independent of temperature in order not to deteriorate the performance of ${V}_{\mathrm{{REF}}}$ .
The dependence of ${V}_{\mathrm{{REF}}}$ on power supply can now be investigated. In Eq. (4.6-29), the only possible parameters that may depend on power supply are ${V}_{EB2},{V}_{OS}$ , and ${I}_{1}$ . Since ${V}_{EB2}$ and ${I}_{1}$ are derived from ${V}_{\mathrm{{REF}}}$ , the only way in which ${V}_{\mathrm{{REF}}}$ can depend on the power supply is through a finite power-supply rejection ratio of the op amp (manifesting itself as a variation in ${V}_{OS}$ ). If the PSRR of the op amp is large, then Fig. 4.6-7 is for all practical purposes a power-supply-independent as well as a temperature-independent voltage reference.
---
Example 4.6-3
---
## The Design of a Bandgap-Voltage Reference
Assume that ${A}_{E1} = {10}{A}_{E2},{V}_{EB2} = {0.7}\mathrm{\;V},{R}_{2} = {R}_{3}$ , and ${V}_{t} = {0.026}\mathrm{\;V}$ at room temperature for Fig. 4.6-7. Find ${R}_{2}/{R}_{1}$ to give a zero temperature coefficient at room temperature. If ${V}_{OS} = {10}\mathrm{{mV}}$ , find the change in ${V}_{\mathrm{{REF}}}$ . Note that ${I}_{1}{R}_{2} = {V}_{\mathrm{{REF}}} - {V}_{EB2} - {V}_{OS}$ .
SOLUTION
Evaluating Eq. (4.6-28) gives
$$
\left( \frac{{R}_{2}}{{R}_{1}}\right) \ln \left( \frac{{R}_{2}{A}_{E1}}{{R}_{3}{A}_{E2}}\right)  = \frac{{V}_{GO} - {V}_{CTAT} + \left( {\gamma  - \alpha }\right) {V}_{t0}}{{V}_{PTAT}} = \frac{{1.205} - {0.7} + \left( {2.2}\right) \left( {0.026}\right) }{0.026} = {21.62}
$$

Figure 4.6-8 Series temperature-independent voltage references using (a) MOSFETs and BJTs and (b) only MOSFETs and diodes.
Therefore, ${R}_{2}/{R}_{1} = {9.39}$ . In order to use Eq. (4.6-29), we must know the approximate value, of ${V}_{\mathrm{{REF}}}$ and iterate if necessary because ${I}_{1}$ is a function of ${V}_{\mathrm{{REF}}}$ . Assuming ${V}_{\mathrm{{REF}}}$ to be 1.262, we obtain from Eq. (4.6-29) a new value, ${V}_{\mathrm{{REF}}} = {1.153}\mathrm{\;V}$ . The second iteration makes little difference on the result because ${V}_{\mathrm{{REF}}}$ is in the argument of the logarithm.
While an op amp can be used to implement the temperature-independent voltage reference, it has several disadvantages, including the influence of the input-offset voltage (which is a function of temperature), the input noise of the op amp, and the additional complexity of the op amp. For the remainder of this section, we will examine temperature-independent voltage references that do not use op amps.
Figure 4.6-8 shows two examples of the series form of the temperature-independent voltage references that do not use op amps. Figure 4.6-8(a) uses a cascode current mirror (M1-M4) to more precisely force ${I}_{1}$ to be equal to ${I}_{2}$ . We see that ${I}_{1}$ is pseudo-PTAT and is given as
$$
{I}_{1} = {I}_{PTAT}{}^{\prime } = \frac{{V}_{BE2} - {V}_{BE1}}{{R}_{2}} = \frac{{V}_{t}}{{R}_{2}}\left\lbrack  {\ln \left( \frac{{I}_{2}}{{I}_{s2}}\right)  - \ln \left( \frac{{I}_{1}}{{I}_{s1}}\right) }\right\rbrack
$$
$$
= \frac{{V}_{t}}{{R}_{2}}\ln \left( \frac{{I}_{s1}}{{I}_{s2}}\right)  = \frac{{V}_{t}}{{R}_{2}}\ln \left( \frac{{A}_{E1}}{{A}_{E2}}\right)  \tag{4.6-30}
$$
Since ${I}_{1} = {I}_{2}$ , we can write ${V}_{\mathrm{{REF}}}$ as
$$
{V}_{\mathrm{{REF}}} = {V}_{BE2} + {I}_{1}{R}_{1} = {V}_{BE1} + \left\lbrack  {\frac{{R}_{1}}{{R}_{2}}\ln \left( \frac{{A}_{E1}}{{A}_{E2}}\right) }\right\rbrack  {V}_{t}
$$
$$
= {V}_{CTAT} + \left\lbrack  {\frac{{R}_{1}}{{R}_{2}}\ln \left( \frac{{A}_{E1}}{{A}_{E2}}\right) }\right\rbrack  {V}_{PTAT} \tag{4.6-31}
$$
We see that Eq. (4.6-31) is similar in form to the previous equations for a series temperature-independent voltage reference. To implement the reference, simply set the temperature-independent multiplier of ${V}_{PTAT}$ equal to Eq. (4.6-21).
Figure 4.6-8(b) gives another realization of the series temperature-independent voltage reference. M1 and M2 are used to enforce the following relationship:
$$
{V}_{D1} = {I}_{2}{R}_{1} + {V}_{D2} \tag{4.6-32}
$$
$$
{I}_{3} = {I}_{2} = {I}_{{PTA}{T}^{\prime }} = \frac{{V}_{t}}{{R}_{1}}\ln \left( n\right)  \tag{4.6-33}
$$
which is a pseudo-PTAT current. The reference voltage is written as
$$
{V}_{\mathrm{{REF}}} = {V}_{D3} + {I}_{3}\left( {R}_{2}\right)  = {V}_{D3} + \frac{{R}_{2}}{{R}_{1}}{V}_{t}\ln \left( n\right)
$$
$$
= {V}_{CTAT} + \frac{{R}_{2}}{{R}_{1}}\ln \left( n\right) {V}_{PTAT} \tag{4.6-34}
$$
The temperature-independent constant, $\left( {{R}_{2}/{R}_{1}}\right) \ln \left( n\right)$ , is equated to Eq. (4.6-21) to complete the design. Since $n$ is an integer greater than $1,{R}_{2}/{R}_{1}$ and $n$ can be used to satisfy Eq. (4.6-21). It is interesting to note that all of the series forms of the temperature-independent voltage reference will have a voltage close to ${1.262}\mathrm{\;V}$ at room temperature.
The parallel form of the temperature-independent voltage reference requires a pseudo-PTAT and CTAT current. Combining Fig. 4.6-3(a) and Fig. 4.6-5(a) gives one possible realization shown in Fig. 4.6-9. If the gate of a PMOS transistor is connected to one of the darkened horizontal busses and the source to ${V}_{DD}$ , the drain current will be either ${I}_{PTAT}{}^{\prime }$ or ${I}_{CTAT}{}^{\prime }$ . The bipolar transistor in the ${I}_{CTAT}{}^{\prime }$ generator can be replaced by the M1, M2, and diode of Fig. 4.6-5(b) to achieve a MOSFET-diode parallel temperature-independent voltage reference. Example 4.6-2 gave an example of how to design the resistors of Fig. 4.6-9.
There are many different realizations of the bandgap voltage reference [17]. A typical family of reference-voltage variations as a function of $T$ for various values of ${T}_{0}$ is shown in Fig. 4.6-10. The influence of the nonlinear term of the CTAT voltage can clearly be seen in this figure. True temperature independence is achieved only over a small range of temperatures. Most of the temperature-independent voltage references that do not use a curvature correction technique have a temperature dependence of ${10} - {50}\mathrm{{ppm}}/{}^{ \circ  }\mathrm{C}$ over $0 - {70}^{ \circ  }\mathrm{C}$ . This undesirable characteristic is called the bandgap curvature problem.
## Voltage References with Excellent Temperature Stability
To achieve temperature stability that exceeds the above voltage references, it is necessary to solve the bandgap curvature problem. There have been many ideas forwarded on how to solve this problem [15-20]. We will examine one of these solutions that allows a temperature dependence of less than $1\mathrm{{ppm}}/{}^{ \circ  }\mathrm{C}$ over a $0 - {100}^{ \circ  }\mathrm{C}$ range. This method was first developed for the series form of the temperature-independent voltage reference [20]. The idea is to cancel out the nonlinear term in the CTAT voltage of Eq. (4.6-14). Figure 4.6-11(a) shows a slightly modified form of the series temperature-independent voltage reference. Figure 4.6-11(b) shows one that is capable of reducing the bandgap curvature problem. ${V}_{\text{REF }}$ can be written as
$$
{V}_{\mathrm{{REF}}} = {V}_{PTAT} + 3{V}_{CTAT} - 2{V}_{\text{constant }} \tag{4.6-35}
$$

Figure 4.6-9 A parallel form of the temperature-independent voltage reference.

Figure 4.6-10 Variation of bandgap reference output with temperature ((C) John Wiley and Sons, Inc.).

Figure 4.6-11 (a) Series temperature-independent voltage reference. (b) Method of correcting for the bandgap curvature problem.
As before, if we assume that the current density, ${J}_{D}$ , in Eq. (4.6-14) has a temperature dependence of ${T}^{\alpha }$ , then we can rewrite Eq. (4.6-14) as
$$
{V}_{CTAT} = {V}_{BE}\left( T\right)  = {V}_{GO} - \frac{T}{{T}_{0}}\left\lbrack  {{V}_{GO} - {V}_{CTAT}\left( {T}_{0}\right) }\right\rbrack   - \left( {\gamma  - \alpha }\right) {V}_{t}\ln \left( \frac{T}{{T}_{0}}\right)  \tag{4.6-36}
$$
If the current through a pn junction is pseudo-PTAT, then $\alpha  = 1$ and we can express the voltage across the ${pn}$ junction as
$$
{V}_{CTAT} = {V}_{GO} - \frac{T}{{T}_{0}}\left\lbrack  {{V}_{GO} - {V}_{CTAT}\left( {T}_{0}\right) }\right\rbrack   - \left( {\gamma  - 1}\right) {V}_{t}\ln \left( \frac{T}{{T}_{0}}\right)  \tag{4.6-37}
$$
If we put a temperature-independent current $\left( {I}_{\text{Const }}\right)$ through a pn junction, then $\alpha  = 0$ and we can express the voltage across the pn junction as
$$
{V}_{\text{Const }} = {V}_{GO} - \frac{T}{{T}_{0}}\left\lbrack  {{V}_{GO} - {V}_{CTAT}\left( {T}_{0}\right) }\right\rbrack   - \gamma {V}_{t}\ln \left( \frac{T}{{T}_{0}}\right)  \tag{4.6-38}
$$
Substituting Eqs. (4.6-37) and (4.6-38) into Eq. (4.6-35) gives
$$
{V}_{\mathrm{{REF}}} = {V}_{PTAT} + {V}_{GO} - \frac{T}{{T}_{0}}\left\lbrack  {{V}_{GO} - {V}_{CTAT}\left( {T}_{0}\right) }\right\rbrack   - \left( {\gamma  - 3}\right) {V}_{t}\ln \left( \frac{T}{{T}_{0}}\right)  \tag{4.6-39}
$$
If $\gamma  \approx  3$ , then Eq. (4.6-39) becomes
$$
{V}_{\mathrm{{REF}}} \approx  {V}_{PTAT} + {V}_{GO} - \frac{T}{{T}_{0}}\left\lbrack  {{V}_{GO} - {V}_{CTAT}\left( {T}_{0}\right) }\right\rbrack   \tag{4.6-40}
$$
To complete this example, the PTAT voltage will have to be multiplied by the constant $K$ given in Eq. (4.6-21). This is accomplished by the resistors ${R}_{1}$ and ${R}_{2}$ and any component area ratios that are part of the pseudo-PTAT current generation. The unique aspect of Eq. (4.6-40) is that the nonlinear CTAT term, $\ln \left( {T/{T}_{0}}\right)$ , has been cancelled, eliminating or at least minimizing the bandgap curvature problem.
The stacking of pn junctions is not attractive as power supplies decrease. The previous idea can be implemented more precisely and at a smaller value of power supply in the parallel form of the temperature-independent voltage reference. The implementation of Fig. 4.6-11(b) in a parallel form is shown as blocks in Fig. 4.6-12. The various forms of the ${I}_{PTAT}{}^{\prime }$ generator and ${I}_{CTAT}{}^{\prime }$ generator have already been described in the previous discussion. The ${I}_{\text{Const. }}{}^{\prime }$ generator is developed using the principle of Fig. 4.6-4 and is shown in Fig. 4.6-13. We solve for ${V}_{GS}\left( \mathrm{{ZTC}}\right)$ as
$$
{V}_{GS}\left( {ZTC}\right)  = \left( {{I}_{PTAT}{}^{\prime } + {I}_{CTAT}{}^{\prime }}\right) {R}_{3} = \left( \frac{{R}_{3}}{{R}_{1}}\right) {V}_{PTAT} + \left( \frac{{R}_{3}}{{R}_{2}}\right) {V}_{CTAT} \tag{4.6-41}
$$
The value of the constant current depends on the ZTC characteristics of the NMOS transistor and the $W/L$ that is selected and is designated as ${I}_{\text{Const. }}$
If the pseudo-PTAT current in the pseudo-CTAT generators of Fig. 4.6-5 is replaced with the constant current generated above, then the current generated will be CTAT but $\alpha$ of Eq. (4.6-36) becomes zero. This current is designated as ${I}_{\alpha  = 0}{}^{\prime }$ . Finally, the three currents, ${I}_{PTAT}{}^{\prime }$ , ${I}_{CTAT}{}^{\prime }$ , and ${I}_{\alpha  = 0}{}^{\prime }$ , are combined in the low TC voltage reference of Fig. 4.6-14 to achieve a

Figure 4.6-12 Block diagram of the parallel form of the curvature corrected temperature stable reference.
highly temperature-stable voltage reference. To simplify the situation, we will assume the $W/L$ ratios of all NMOS transistors are equal and the $W/L$ ratios of all PMOS transistors are equal to twice the $W/L$ ratio of the NMOS transistors. The output reference voltage can be written as
$$
{V}_{\mathrm{{REF}}} = {R}_{5}\left( {{I}_{PTAT}{}^{\prime } + {I}_{CTAT}{}^{\prime } - {I}_{\alpha  = 0}{}^{\prime }}\right)
$$
$$
= \left( \frac{{R}_{5}}{{R}_{1}}\right) {V}_{PTAT} + \left( \frac{{R}_{5}}{{R}_{2}}\right) {V}_{CTAT}\left( {\alpha  = 1}\right)  - \left( \frac{{R}_{5}}{{R}_{4}}\right) {V}_{CTAT}\left( {\alpha  = 0}\right)  \tag{4.6-42}
$$
Substituting Eqs. (4.6-37) and (4.6-38) into Eq. (4.6-42) gives
$$
{V}_{\mathrm{{REF}}} = \frac{{R}_{5}}{{R}_{1}}{V}_{PTAT} + \frac{{R}_{5}}{{R}_{2}}\left\lbrack  {{V}_{GO} - \frac{T}{{T}_{0}}\left\lbrack  {{V}_{GO} - {V}_{CTAT}\left( {T}_{0}\right) }\right\rbrack   - \left( {\gamma  - 1}\right) {V}_{t}\ln \left( \frac{T}{{T}_{0}}\right) }\right\rbrack
$$
$$
- \frac{{R}_{5}}{{R}_{4}}\left\lbrack  {{V}_{GO} - \frac{T}{{T}_{0}}\left\lbrack  {{V}_{GO} - {V}_{CTAT}\left( {T}_{0}\right) }\right\rbrack   - \gamma {V}_{t}\ln \left( \frac{T}{{T}_{0}}\right) }\right\rbrack   \tag{4.6-43}
$$
To cancel the nonlinear CTAT term, we want the following relationship to be true:
$$
\frac{{R}_{5}}{{R}_{2}}\left( {\gamma  - 1}\right)  = \frac{{R}_{5}}{{R}_{4}}\gamma  \tag{4.6-44}
$$

Figure 4.6-13 Implementation of the constant-current generator.

Figure 4.6-14 Transistor-level implementation of the low TC voltage reference in Fig. 4.6-13.
This relationship gives
$$
\frac{{R}_{2}}{{R}_{4}} = \frac{\left( \gamma  - 1\right) }{\gamma } \tag{4.6-45}
$$
Fortunately, $\gamma$ is always greater than one. With the relationship of Eq. (4.6-45) valid, Eq. (4.6-43) becomes
$$
{V}_{\mathrm{{REF}}} = \frac{{R}_{5}}{{R}_{1}}{V}_{PTAT} + \left( \frac{{R}_{5}}{{R}_{4}\left( {\gamma  - 1}\right) }\right) \left\lbrack  {{V}_{GO} - \frac{T}{{T}_{0}}\left\lbrack  {{V}_{GO} - {V}_{CTAT}\left( {T}_{0}\right) }\right\rbrack  }\right\rbrack   \tag{4.6-46}
$$
Rewriting Eq. (4.6-46) as follows gives the form necessary to find the relationship that will ensure the positive and negative temperature coefficients are cancelled:
$$
{V}_{\mathrm{{REF}}} = \frac{{R}_{5}}{{R}_{4}\left( {\gamma  - 1}\right) }\left\lbrack  {\frac{{R}_{4}\left( {\gamma  - 1}\right) }{{R}_{1}}{V}_{PTAT} + {V}_{GO} - \frac{T}{{T}_{0}}\left\lbrack  {{V}_{GO} - {V}_{CTAT}\left( {T}_{0}\right) }\right\rbrack  }\right\rbrack   \tag{4.6-47}
$$
Differentiating Eq. (4.6-47) with respect to temperature and setting $T = {T}_{0}$ gives
$$
{\left. \frac{\partial {V}_{\text{REF }}}{\partial T}\right| }_{T = {T}_{0}} = \frac{{R}_{5}}{{R}_{4}\left( {\gamma  - 1}\right) }\left\lbrack  {\frac{{R}_{4}\left( {\gamma  - 1}\right) }{{R}_{1}}\frac{{V}_{PTAT}}{{T}_{0}} - \frac{1}{{T}_{0}}\left\lbrack  {{V}_{GO} - {V}_{CTAT}\left( {T}_{0}\right) }\right\rbrack  }\right\rbrack   \tag{4.6-48}
$$
Setting Eq. (4.6-48) equal to zero gives
$$
\frac{{R}_{4}}{{R}_{1}} = \frac{{V}_{GO} - {V}_{CTAT}\left( {T}_{0}\right) }{\left( {\gamma  - 1}\right) {V}_{PTAT}} \tag{4.6-49}
$$
Substituting Eq. (4.6-49) into Eq. (4.6-47) for $T = {T}_{0}$ gives
$$
{V}_{\mathrm{{REF}}} = \frac{{R}_{5}}{{R}_{4}\left( {\gamma  - 1}\right) }\left\lbrack  {{V}_{GO} - {V}_{CTAT}\left( {T}_{0}\right)  + {V}_{GO} - {V}_{GO} + {V}_{CTAT}\left( {T}_{0}\right) }\right\rbrack
$$
$$
= \frac{{R}_{5}}{{R}_{4}\left( {\gamma  - 1}\right) }{V}_{GO} \tag{4.6-50}
$$
Equation (4.6-50) will be used to design the value of ${R}_{5}/{R}_{4}$ as
$$
\frac{{R}_{5}}{{R}_{1}} = \frac{{V}_{\mathrm{{REF}}}\left( {\gamma  - 1}\right) }{{V}_{GO}} \tag{4.6-51}
$$
Thus, the design equations for Fig. 4.6-14 are Eqs. (4.6-45), (4.6-49), and (4.6-51). The value of ${R}_{3}$ is designed based on the value of ${V}_{GS}\left( \mathrm{{ZTC}}\right)$ from Eq. (4.6-41). The values of these resistors could be modified by adjusting the $W/L$ ratios of M23, M24, and M25.
---
Example 4.6-4
---
## Design of a Zero Temperature Coefficient Voltage Reference
Assume that ${V}_{CTAT} = {0.7}\mathrm{\;V},{R}_{4} = {10}\mathrm{k}\Omega ,\gamma  = {3.2}$ , and ${V}_{t} = {0.026}\mathrm{\;V}$ at room temperature for Fig. 4.6-14. Find ${R}_{1},{R}_{2}$ , and ${R}_{5}$ to give a zero temperature coefficient at room temperature and a reference voltage of ${1.0}\mathrm{\;V}$ .
SOLUTION
From Eq. (4.6-45), we get ${R}_{2} = {0.6875}{R}_{4} = {6.88}\mathrm{k}\Omega$ . From Eq. (4.6-49) we get
$$
\frac{{R}_{4}}{{R}_{1}} = \frac{{V}_{GO} - {V}_{CTAT}\left( {T}_{0}\right) }{\left( {\gamma  - 1}\right) {V}_{PTAT}} = \frac{{1.205}\mathrm{\;V} - {0.7}\mathrm{\;V}}{{2.2}\left( {{0.026}\mathrm{\;V}}\right) {2.306}} = {3.83}
$$
Thus, ${R}_{1} = {R}_{4}/{3.83} = {2.61}\mathrm{k}\Omega$ . From Eq. (4.6-51) we get
$$
\frac{{R}_{5}}{{R}_{1}} = \frac{{V}_{\mathrm{{REF}}}\left( {\gamma  - 1}\right) }{{V}_{GO}} = \frac{1\mathrm{\;V}\left( {2.2}\right) }{{1.205}\mathrm{\;V}} = {1.83}
$$
Thus, ${R}_{5} = {1.83}{R}_{1} = {1.83}\left( {{2.61}\mathrm{k}\Omega }\right)  = {4.77}\mathrm{k}\Omega$ .
It is important to keep any influences on the temperature-independent voltage reference less than the inherent temperature variation. If, for example, dc drifts or noise causes a variation of the voltage outside of the inherent temperature variation, then this disturbance becomes larger than the temperature variation. If a very good temperature-independent voltage reference has a temperature dependence of $1\mathrm{{ppm}}/{}^{ \circ  }\mathrm{C}$ over a ${100}^{ \circ  }\mathrm{C}$ range, then the maximum temperature deviation of the reference is ${100}\mathrm{{ppm}}$ or ${0.01}\%$ . If the nominal reference voltage is $1\mathrm{\;V}$ , then the deviation is ${100\mu }\mathrm{V}$ . If the noise on the output of the voltage reference, or the dc offset or drift, or the PSRR of the op amp (if one is used) is greater than ${100\mu }\mathrm{V}$ , then the possible temperature independence is not achieved. As the deviation of the voltage reference with respect to temperature becomes small, the designer must be aware of these other influences.
Suppose that a temperature-independent current is desired. There are at least two ways of accomplishing this. The first is to generate a temperature-independent voltage that is equal to the ZTC gate-source voltage of a MOSFET. We have illustrated this approach in our previous considerations. The only disadvantage of this approach is that if the temperature variation becomes too large, the ZTC point will move. A second approach is to place the temperature-independent reference voltage across a resistor, thus generating a ${V}_{\mathrm{{REF}}}/R$ current. The obvious problem with this is the lack of a temperature-independent resistor. If we divide Eq. (4.6-16) by a resistor, R, to get a reference current, the result is
$$
{I}_{\mathrm{{REF}}} = \frac{{V}_{\mathrm{{REF}}}}{R} = \frac{1}{R}\left\lbrack  {\left( \frac{{R}_{2}}{{R}_{1}}\right) {V}_{PTAT} + {V}_{CTAT}}\right\rbrack   \tag{4.6-52}
$$
Differentiating with respect to absolute temperature gives
$$
\frac{d{I}_{\mathrm{{REF}}}}{dT} = \frac{1}{R}\left\lbrack  {\left( \frac{{R}_{2}}{{R}_{1}}\right) \frac{d{V}_{PTAT}}{dT} + \frac{d{V}_{CTAT}}{dT}}\right\rbrack   - \frac{1}{{R}^{2}}\frac{dR}{dT}\left\lbrack  {\left( \frac{{R}_{2}}{{R}_{1}}\right) {V}_{PTAT} + {V}_{CTAT}}\right\rbrack
$$
$$
= \frac{1}{R}\left\lbrack  {\left( \frac{{R}_{2}}{{R}_{1}}\right) \frac{d{V}_{PTAT}}{dT} + \frac{d{V}_{CTAT}}{dT}}\right\rbrack   - \frac{1}{R}\frac{dR}{dT}{I}_{\mathrm{{REF}}} = 0 \tag{4.6-53}
$$
To achieve a temperature-independent reference current, the value of the temperature-independent constant, ${R}_{2}/{R}_{1}$ , must be
$$
\frac{{R}_{2}}{{R}_{1}} = \frac{{I}_{\text{REF }}{T}_{0}\frac{dR}{dT} - {V}_{CTAT} + \left( {\gamma  - \alpha }\right) {V}_{t0}}{{V}_{PTAT}} \tag{4.6-54}
$$
Assuming the values of Example 4.6-1 and that ${dR}/{dT} = {100\Omega }/{}^{ \circ  }\mathrm{C}$ and ${I}_{\mathrm{{REF}}} = {100\mu }\mathrm{A}$ , we get a value of ${R}_{2}/{R}_{1}$ equal to
$$
\frac{{R}_{2}}{{R}_{1}} = \frac{\left( {{100\mu }\mathrm{A}}\right) \left( {{300}\mathrm{\;K}}\right) \left( {{100\Omega }/\mathrm{K}}\right)  - {0.6}\mathrm{\;V} + {2.2}\left( {0.026}\right) }{{2.306}\left( {0.026}\right) } = {40.98} \tag{4.6-55}
$$
Depending on the value of ${dR}/{dT}$ and ${I}_{\mathrm{{REF}}}$ , the value of ${R}_{2}/{R}_{1}$ may not be positive and this method will not work unless the current or the temperature behavior of the resistor is different.
Although other techniques have been used to develop power-supply and temperature-independent references, the bandgap circuit has proven the best to date. In this section we have used the bandgap concept to develop precision references. As the requirement for higher precision increases, the designer will find it necessary to begin including second-order and sometimes third-order effects that might normally be neglected. These higher-order effects require the designer to be familiar with the physics and operation of the MOS devices and passive components.

### 4.7 Summary
This chapter has introduced CMOS subcircuits, including the switch, active resistors, current sinks/sources, current mirrors or amplifiers, and voltage and current references. The general principles of each circuit were covered, as was their large-signal and small-signal performance. Remember that the circuits presented in this chapter are rarely used by themselves; rather, they are joined with other such circuits to implement a desired ana- $\log$ function.
The approach used in each case was to present a general understanding of the circuit and how it works. This presentation was followed by analysis of large-signal performance, typically a voltage-transfer function or a voltage-current characteristic. Limitations such as signal swing or nonlinearity were identified and characterized. This was followed by the analysis of small-signal performance. The important parameters of small-signal performance include ac resistance, voltage gain, and bandwidth.
The subject matter presented in this chapter will be continued and extended in the next chapter. A good understanding of the circuits in this and the next chapter will provide a firm foundation for the later chapters and subject material.

### 4.8 Design Problems
It is common to hear an experienced designer say, "I am not sure what works, but I know several things that do not work." This understanding comes from the experience acquired through various design experiences. As an analog designer, it is very important to be able to identify which topology gives the best compromise under certain design constraints. Starting with the problems of this chapter, design problems are introduced to get the reader acquainted with the various design trade-offs of analog circuit design and to increase your understanding of the practical problem of design. These problems will be clearly identified in each chapter that has them.
Below are some guidelines that will help you approach these design problems.
1. Select a topology that you believe will best achieve the design goals. Do not forget, you can always make things more complex: what is important is to keep things as simple as possible while meeting the specifications.
2. Calculate the bias currents, transistor aspect ratios, and bias voltages that will optimize the circuit toward achieving the specifications (e.g., slew rate, GBW, signal swing, etc.). In this step you should do the small-signal analysis and/or derivations by hand for the circuit. Show all your calculations and briefly explain your reasoning.
3. Simulate the circuit in SPICE or any SPICE-like simulator (e.g., Spectre, SpectreS, etc.). You may need to do some tweaking in this step. If the simulation results are significantly different from your hand calculations (say, more than $\pm  {30}\%$ ), then make sure that your reasoning and hand calculations are correct.
4. Provide any relevant simulation results (e.g., frequency response, step response, etc.).
5. Provide a table summarizing your simulation results (e.g., slew rate, GBW, dc gain, signal swing, etc.).
6. Provide your final schematic along with the transistor aspect ratios and bias currents. Doing so may result in feedback and suggestions on your design, which may improve your understanding of the circuit.
All of the design problems are self-grading. By this we mean that you will be given a formula for the score of the problem. Various specifications of the problem have been given a particular weighting. It is your responsibility to make the best choices and trade-offs to maximize your score. Some guidelines for helping you with the problem and its scoring are as follows:
1. These problems are normally designed so that to get a full score requires an inordinate amount of design time. One of the things you are to learn is the trade-off between the time you can invest in the problem and the score you want to achieve.
2. If you submit your design to an instructor, you must provide the simulation information in the form of at least the input file or schematic input information and the output of the simulator using whatever postprocessing necessary to clearly present the results.
3. Remember, there is no "right" answer, and your responsibility is to find the best answer under the given circumstances including how much time you are willing to spend on the problem.
## Problems
4.1-1. Using SPICE, generate a set of parametric $I - V$ curves similar to Fig. 4.1-3 for a transistor with a $W/L = {10}/1$ . Use model parameters from Table 3.1-2.
4.1-2. The circuit shown in Fig. P4.1-2 illustrates a single-channel MOS resistor with a $W/L$ of ${2\mu }\mathrm{m}/{1\mu }\mathrm{m}$ . Using Table 3.1-2 model parameters, calculate the small-signal ON resistance of the MOS transistor at various values for ${V}_{S}$ and fill in the table below.
<table><tr><td>${V}_{s}$ (volts)</td><td>$R$ (ohms)</td></tr><tr><td>1.0</td><td/></tr><tr><td>3.0</td><td/></tr><tr><td>5.0</td><td/></tr></table>

Figure P4.1-2
4.1-3. The circuit shown in Fig. P4.1-3 illustrates a single-channel MOS resistor with a $W/L$ of ${4\mu }\mathrm{m}/{1\mu }\mathrm{m}$ . Using Table 3.1-2 model parameters, calculate the small-signal ON resistance of the MOS transistor at various values for ${V}_{S}$ and fill in the table below. Note that the most positive supply voltage is $5\mathrm{\;V}$ .
<table><tr><td>${V}_{S}$ (volts)</td><td>$R$ (ohms)</td></tr><tr><td>1.0</td><td/></tr><tr><td>3.0</td><td/></tr><tr><td>5.0</td><td/></tr></table>

Figure P4.1-3
4.1-4. The circuit shown in Fig. P4.1-4 illustrates a complementary MOS resistor with an $\mathrm{n}$ - channel $W/L$ of ${2\mu }\mathrm{m}/{1\mu }\mathrm{m}$ and a p-channel
$W/L$ of ${4\mu }\mathrm{m}/{1\mu }\mathrm{m}$ . Using Table 3.1-2 model parameters, calculate the small-signal ON resistance of the complementary MOS resistor at various values for ${V}_{S}$ and fill in the table below. Note that the most positive supply voltage is $5\mathrm{\;V}$ .
<table><tr><td>${V}_{S}$ (volts)</td><td>$R$ (ohms)</td></tr><tr><td>1.0</td><td/></tr><tr><td>3.0</td><td/></tr><tr><td>5.0</td><td/></tr></table>

Figure P4.1-4
4.1-5. For the circuit in Fig. P4.1-5(a) assume that there are NO capacitance parasitics associated with M1. The voltage source ${v}_{\text{in }}$ is a small-signal value, whereas voltage source ${V}_{DC}$ has a dc value of $3\mathrm{\;V}$ . Design $\mathrm{M}1$ to achieve the asymptotic frequency response shown in Fig. P4.1-5(b).
4.1-6. Using the result of Problem 4.1-5, calculate the frequency response resulting from changing the gate voltage of M1 to ${4.5}\mathrm{\;V}$ . Draw a Bode diagram of the resulting frequency response.
4.1-7. Consider the circuit shown in Fig. P4.1-7. Assume that the slow regime of charge injection is valid for this circuit. Initially, the charge on ${C}_{1}$ is zero. Calculate ${v}_{\text{out }}$ at time ${t}_{1}$ after ${\phi }_{1}$ pulse occurs. Assume that CGSO and CGDO are both $5\mathrm{{fF}} \cdot  {C}_{1} = {30}\mathrm{{fF}}$ . You cannot ignore body effect. $L = {1.0\mu }\mathrm{m}$ and $W = {5.0\mu }\mathrm{m}$ . Use the model parameters from Tables 3.1-2 and 3.2-1 as required.

4.1-8. In Problem 4.1-7, how long must ${\phi }_{1}$ remain high for ${C}_{1}$ to charge up to ${99}\%$ of the desired final value (2.0 V)?
4.1-9. In Problem 4.1-7, the charge feedthrough could be reduced by reducing the size of M1 or increasing the size of ${C}_{1}$ . What impact do both of these changes have on the width of the ${\phi }_{1}$ pulse?
4.1-10. Considering charge feedthrough due to slow regime only, will reducing the magnitude of the ${\phi }_{1}$ pulse impact the resulting charge feedthrough? What impact does reducing the magnitude of the ${\phi }_{1}$ pulse have on the accuracy of the voltage transfer to the output?
4.1-11. Repeat Example 4.1-1 with the following conditions. Calculate the effect of charge feedthrough on the circuit shown in Fig. 4.1-9, where ${V}_{S} = {1.5}\mathrm{\;V},{C}_{L} = {150}\mathrm{{fF}}$ , $W/L = {1.6\mu }\mathrm{m}/{0.8\mu }\mathrm{m}$ . The fall time for Case 1 and Case 2 is ${0.1}\mathrm{{ns}}$ and $8\mathrm{{ns}}$ , respectively.
4.1-12. Figure P4.1-12 illustrates a circuit that contains a charge-cancellation scheme. Design the size of M2 to minimize the effects of charge feedthrough. Assume a slow rise and fall time of the clock.

Figure P4.1-12
4.1-13. Calculate the effect of charge injection on the circuit shown in Fig. P4.1-13. Assume that $U = 5\mathrm{\;V}/{50}\mathrm{\;{ns}} = {10}^{8}\mathrm{\;V}/\mathrm{s}$ and ${v}_{in} = {2.5}\mathrm{\;V}$ and ignore the bulk effect. Use the model parameters from Tables 3.1-2 and 3.2-1.

Figure P4.1-13
4.1-14. The four MOS diodes shown in Fig. P4.1-14 form a switch connecting ${v}_{in}$ to $1\mathrm{k}\Omega$ load resistor when ${I}_{\text{control }} = {200\mu }\mathrm{A}$ . Find the small-signal value of the on-resistance of this switch configuration when ${I}_{\text{control }} = {200\mu }\mathrm{A}$ . What is the switch loss in $\mathrm{{dB}}$ when the switch is on? If this switch (the four MOS diodes and controlling current) was inserted in place of the MOSFET switch in Fig. 4.1-6, compare the performance of the two switch realizations.
4.2-1 Find an expression for the resistance ${R}_{AB}$ for the parallel combination of identical NMOS transistors shown in Fig. P4.2-1. Assume that the transistors are in the active or triode region of operation and ${v}_{DS}$ is small but not zero. Rederive the expression for resistance of Fig. 4.2-3 given in Eq. (4.2-6) assuming the same large-signal model parameters and $W/L$ used for Fig. P4.2-1 when ${v}_{DS}$ is small but not zero. Which of the two realizations, Fig. 4.2-3 or Fig. P4.2-1, is more linear?
4.3-1 Figure P4.3-1 illustrates a source-degenerated current source. Using Table 3.1-2 model parameters, calculate the output resistance at the given current bias. Ignore the body effect.

Figure P4.3-1
4.3-2 Using the cascode circuit shown in Fig. P4.3-2, design the $W/L$ of $\mathrm{M}1$ to achieve the same output resistance as the circuit in Fig. P4.3-1. Ignore the body effect.

Figure P4.3-2
4.3-3. Calculate the minimum output voltage required to keep the device in saturation in Problem 4.3-1. Compare this result with that of Problem 4.3-2. Which circuit is a better choice in most cases?
4.3-4. Calculate the output resistance and the minimum output voltage, while maintaining all devices in saturation, for the circuit shown in Fig. P4.3-4. Assume that ${i}_{\mathrm{{OUT}}}$ is actually ${10\mu }\mathrm{A}$ . Simulate this circuit using SPICE LEVEL 3 model (Table 3.4-1) and determine the actual output current, ${i}_{\mathrm{{OUT}}}$ and small-signal output resistance, ${r}_{\mathrm{{OUT}}}$ . Use Table 3.1-2 for device model information.

Figure P4.3-4
4.3-5. Calculate the output resistance and the minimum output voltage, while maintaining all devices in saturation, for the circuit shown in Fig. P4.3-5. Assume that ${i}_{\text{OUT }}$ is actually ${10\mu }\mathrm{A}$ . Simulate this circuit using SPICE LEVEL 3 model (Table 3.4-1) and determine the actual output current, ${i}_{\mathrm{{OUT}}}$ . Use Table 3.1-2 for device model information.

Figure P4.3-5
4.3-6. Design M3 and M4 of Fig. P4.3-6 so that the output characteristics are identical to the circuit shown in Fig. P4.3-5. It is desired that ${i}_{\mathrm{{OUT}}}$ is ideally ${10\mu }\mathrm{A}$ .

Figure P4.3-6
4.3-7. For the circuit shown in Fig. P4.3-7, determine ${i}_{\mathrm{{OUT}}}$ by simulating it using SPICE LEVEL 3 model (Table 3.4-1). Use Table 3.1-2 for device model information. Compare the results with the SPICE results from Problem 4.3-5.

Figure P4.3-7
4.3-8 Use Blackman's formula to calculate the small-signal output resistance of the stacked MOSFET configuration of Fig. P4.3-8 having identical drain-source drops for both transistors. Express your answer in terms of all the pertinent small-signal parameters and then simplify your answer if ${g}_{m} > {g}_{ds} > \left( {1/R}\right)$ . Assume the MOSFETs are identical and ignore body effects.

Figure P4.3-8
4.3-9 In Fig. P4.3-9, transistors M1 through M4 are identical and have a $W/L$ ratio of ${10\mu }\mathrm{m}/{1\mu }\mathrm{m}$ . What value of ${V}_{\text{Bias }}$ gives the smallest value of ${V}_{min}$ and what is this value of ${V}_{min}$ assuming all transistors are in saturation? What is the small-signal output resistance in ohms?

Figure P4.3-9
4.3-10 (Design Problem-this problem is self-grading.)
You are to design a CMOS current sink using only a 5 volt power supply and MOSFETs that will attempt to minimize ${V}_{MIN}$ and $\Delta {I}_{o}$ as illustrated in Fig. P4.3-10. $\Delta {I}_{o}$ is arithmetically centered about ${I}_{o}$ , which is ${100\mu }\mathrm{A}$ . Ignore bulk effects and keep $W/L$ s between 1 and 100 .
${V}_{MIN}$ and $\Delta {I}_{o}$ are determined by simulating your design once using the HIGH model parameters and once using the LOW model parameters. These two simulations are to be plotted as ${i}_{OUT}$ versus ${v}_{OUT}$ plot as shown in Fig. P4.3-10. ${V}_{MIN}$ is the distance horizontally from the origin to where the line AB intersects the right-most IV curve. $\Delta {I}_{o}$ is the biggest vertical difference between the two simulations from ${V}_{MIN}$ to $5\mathrm{\;V}$ .
The PMOS and NMOS model parameters are as follows:
<table><tr><td>Model</td><td>${\mathrm{K}}^{\prime }\left( {{\mu A}/{\mathrm{V}}^{2}}\right)$</td><td>${\mathrm{V}}_{\mathrm{T}0}\left( {\mathrm{V}}^{2}\right)$</td><td>$\lambda \left( {V}^{-1}\right)$</td></tr><tr><td>NMOS(HIGH)</td><td>26.4</td><td>0.675</td><td>0.011</td></tr><tr><td>NMOS(LOW)</td><td>21.6</td><td>0.825</td><td>0.009</td></tr><tr><td>PMOS(HIGH)</td><td>8.8</td><td>-0.675</td><td>0.022</td></tr><tr><td>PMOS(LOW)</td><td>7.2</td><td>-0.875</td><td>0.018</td></tr></table>
Your score for this problem will be determined by the following formula:
$$
\text{SCORE} = \min \left( {\frac{5}{{V}_{MIN}},{25}}\right)  + \min \left( {\frac{{500\mu }\mathrm{A}}{\Delta {I}_{o}},{25}}\right)
$$
The values entered in the above SCORE formula must come from computer simulation. You are responsible for providing the supporting information necessary to verify how you determined the value of your SCORE along with a labeled schematic of your circuit.

Figure P4.3-10
4.4-1. Consider the simple current mirror illustrated in Fig. P4.4-1. Over the process, the absolute variations of physical parameters are as follows:
Width variation Length variation ${K}^{\prime }$ variation ${V}_{T}$ variation $\pm  5\mathrm{{mV}}$
Assuming that the drain voltages are identical, what is the minimum and maximum output current measured over the process variations given above?

Figure P4.4-1
4.4-2. Find ${R}_{in},{i}_{out}/{i}_{in},{R}_{out},{V}_{MIN}$ (in), and ${V}_{MIN}$ (out) for the current mirror shown in Figure P4.4-2. $R$ has the value of ${12.9}\mathrm{k}\Omega$ .

Figure P4.4-2
4.4-3. The capacitances of M1 and M2 in Fig. P4.4-3 are ${C}_{gs1} = {C}_{gs2} = {200}\mathrm{{fF}},{C}_{gd1} =$ ${C}_{gd2} = {50}\mathrm{{fF}}$ , and ${C}_{bd1} = {C}_{bd2} = {100}\mathrm{{fF}}$ . Find the low-frequency current gain, ${i}_{\text{out }}/{i}_{\text{in }}$ , the input resistance seen by ${i}_{in}$ , the output resistance looking into the drain of M2, and the $- 3\mathrm{\;{dB}}$ frequency in $\mathrm{{Hz}}$ .

Figure P4.4-3
4.4-4. An NMOS 1:1 current mirror layout is shown in Fig. P4.4-4. Assume both transistors are in saturation and that ${V}_{DS1} = {V}_{DS2}$ . (a) If ${I}_{in} = {100\mu }\mathrm{A}$ , the value of ${I}_{\text{out }}$ should be ${100\mu }\mathrm{A}$ . Due to the layout, find the actual value of ${I}_{\text{out }}$ . Assume that ${K}^{\prime } = {110\mu }\mathrm{A}/{\mathrm{V}}^{2}$ , ${V}_{T} = {0.7}\mathrm{\;V}$ , the various sheet resistances are ${\mathrm{n}}^{ + }$ diffusion $= {35\Omega }$ /sq., polysilicon $= {25\Omega }$ / sq., and the metal 1 contact to ${\mathrm{p}}^{ + }$ or ${\mathrm{n}}^{ + }$ $\left( {{2\mu }\mathrm{m} \times  {2\mu }\mathrm{m}}\right)$ is ${4\Omega }$ . When counting squares, attribute 0.5 to a corner square. (b) How would you improve the error caused by the layout?

Figure P4.4-4
4.4-5 Four different layouts for an NMOS 1:2 current mirror are shown in Fig. P4.4-5. (a) Show how to connect the ${\mathrm{n}}^{ + }$ regions and the poly regions to form the current in mirror in each layout. Label the IN, OUT, and GRD nodes. (Just draw a line from the region to wherever to indicate the connection.) (b) Which of the four layouts has the most accurate current gain? Why? (c) Which of the four layouts has the least accurate current gain from physical parasitic considerations? Why?
4.5-1. Show that the sensitivity of the reference circuit shown in Fig. 4.5-2(b) is unity.
4.5-2. Fig. P4.5-2 illustrates a reference circuit that provides an interesting reference voltage output. Derive an expression for ${V}_{\mathrm{{REF}}}$ .

Figure P4.4-5

Figure P4.5-2
4.5-3. Figure P4.5-3 illustrates a current reference. The $W/L$ of M1 and M2 is ${100}/1$ . The resistor is made from n-well and its nominal value is ${500}\mathrm{k}\Omega$ at ${25}^{ \circ  }\mathrm{C}$ . Using Table 3.1-2 and an $n$ -well resistor with a sheet resistivity of $1\mathrm{k}\Omega /\square  \pm  {40}\%$ and temperature coefficient of ${8000}\mathrm{{ppm}}/{}^{ \circ  }\mathrm{C}$ , calculate the total variation of output current seen over process, temperature of $0 - {70}^{ \circ  }\mathrm{C}$ , and supply voltage variation of $\pm  {10}\%$ . Assume that the temperature coefficient of the threshold voltage is $- {2.3}\mathrm{{mV}}/{}^{ \circ  }\mathrm{C}$ .

Figure P4.5-3
4.5-4. Figure P4.5-4 illustrates a current reference circuit. Assume that M3 and M4 are identical in size. The sizes of M1 and M2 are different. Derive an expression for the output current ${I}_{\text{out }}$ .

Figure P4.5-4
4.5-5. Find the small-signal output resistance of Fig. 4.5-3(b) and Fig. 4.5-4(b).
4.5-6. Using the reference circuit illustrated in Fig. 4.5-3(b), design a voltage reference having ${V}_{\mathrm{{REF}}} = {2.5}$ when ${V}_{DD} = {5.0}\mathrm{\;V}$ . Assume that ${I}_{s} = 1\mathrm{{fA}}$ and ${\beta }_{\mathrm{F}} = {100}$ . Evaluate the sensitivity of ${V}_{\mathrm{{REF}}}$ with respect to ${V}_{DD}$ .
4.6-1. An improved bandgap reference generator is illustrated in Fig. P4.6-1. Assume that the devices M1 through M5 are identical in $W/L$ . Further assume that the area ratio for the bipolar transistors is 10:1. Design the components to achieve an output reference voltage of ${1.262}\mathrm{\;V}$ . Assume that the amplifier is ideal. What advantage, if any, is there in stacking the bipolar transistors?
4.6-2. In an attempt to reduce the noise output of the reference circuit shown in Fig. P4.6-1, a capacitor is placed on the gate of M5. Where should the other side of the capacitor be connected and why?
4.6-3. For the bandgap reference in Fig. P4.6-3, find ${V}_{\text{REF }}$ to the nearest $\mathrm{{mV}}$ at room temperature. Assume the NPN BJTs are modeled with ${I}_{s} = {100}\mathrm{{fA}},\beta  \approx  \infty$ , and ${V}_{th} = {26}\mathrm{\;{mV}}$ . Assume that the M1-M2 mirror is ideal and that all $W/L$ values are 10 .

Figure P4.6-1

Figure P4.6-3
4.6-4. Assuming all transistors in Fig. 4.6-8(b) are matched, $n = {10}$ , and ${R}_{1} = {10}\mathrm{k}\Omega$ , find the value of ${V}_{\mathrm{{REF}}}$ at room temperature and ${R}_{2}$ if ${V}_{DD}$ is large enough that all transistors are operating in the saturation region.
4.6-5. If the bipolar transistors in Fig. 4.6-8(a) are true vertical bipolar transistors (can be isolated from the substrate), compare the current flowing in the substrate between the two series, temperature-independent references in Fig. 4.6-8.
4.6-6. Repeat Example 4.6-2 if ${V}_{\mathrm{{REF}}} = 1\mathrm{\;V}$ .
4.6-7. Repeat Example 4.6-4 and assume that all resistors (except ${R}_{3}$ ) are equal. Assume all $W/L$ ratios of all transistors are 10 except for M23, M24, and M25 (diodes have the areas indicated in Fig. 4.6-14). Design the $W/L$ ratios of M23, M24, and M25 and the value of the equal resistors.
4.6-8. Extend Example 4.6-3 to the design of a temperature-independent current based on the circuit shown in Fig. P4.6-8. The temperature coefficient of the resistor ${R}_{4}$ is $+ {1500}\mathrm{{ppm}}/{}^{ \circ  }\mathrm{C}$ .

Figure P4.6-8 A temperature-independent reference current.
## References
1. K. Martin, "Improved Circuits for the Realization of Switched-Capacitor Filters," IEEE Trans. Circuits and Systems, Vol. CAS-27, No. 4, pp. 237-244, Apr. 1980.
2. B. J. Sheu and Chenming Hu, "Switch-Induced Error Voltage on a Switched Capacitor," IEEE J. Solid-State Circuits, Vol. SC-19, No. 4, pp. 519-525, Aug. 1984.
3. T. C. Choi, R. T. Kaneshiro, R. W. Brodersen, P. R. Gray, W. B. Jett, and M. Wilcox, "High-Frequency CMOS Switched-Capacitor Filters for Communications Applications," IEEE J. Solid-State Circuits, Vol. SC-18, No. 6, pp. 652-664, Dec. 1983.
4. E. J. Swanson, "Compound Current Mirror," U.S. Patent #4,477,782.
5. Todd L. Brooks and Mathew A. Rybicki, "Self-Biased Cascode Current Mirror Having High Voltage Swing and Low Power Consumption," U.S. Patent #5,359,296.
6. R. B. Blackman, "Effect of Feedback on Impedance," Bell Sys. Tech. J., Vol. 23, pp. 269-277, Oct. 1943.
7. P. R. Gray, P. J. Hurst, S. H. Lewis, and R. G. Meyer, Analysis and Design of Analog Integrated Circuits, 4th ed. New York: John Wiley & Sons, 2001, pp. 607-612.
8. G. R. Wilson, A Monolithic Junction FET-npn Operational Amplifier, IEEE J. Solid-State Circuits, Vol. SC-3, No. 5, pp. 341-348, Dec. 1968.
9. E. Sackinger and W. Guggenbuhl, "A Versatile Building Block: The CMOS Differential Difference Ampifier," IEEE J. Solid-State Circuits, Vol. SC-22, No. 2, pp. 287-294, Apr. 1987.
10. R. J. Widlar, "New Developments in IC Voltage Regulators," IEEE J. Solid-State Circuits, Vol. SC-6, No. 1, pp. 2-7, Feb. 1971.
11. K. E. Kujik, "A Precision Reference Voltage Source," IEEE J. Solid-State Circuits, Vol. SC-8, No. 3, pp. 222-226, June 1973.
12. B. S. Song and P. R. Gray, "A Precision Curvature-Corrected CMOS Bandgap Reference," IEEE J. Solid-State Circuits, Vol. SC-18, No. 6, pp. 634-643, Dec. 1983.
13. Y. P. Tsividis and R. W. Ulmer, "A CMOS Voltage Reference," IEEE J. Solid-State Circuits, Vol. SC-13, No. 6, pp. 774-778, Dec. 1982.
14. G. Tzanateas, C. A. T. Salama, and Y. P. Tsividis, "A CMOS Bandgap Voltage Reference," IEEE J. Solid-State Circuits, Vol. SC-14, No. 3, pp. 655-657, June 1979.
15. I. M. Gunawan, G. C. M. Meijer, J. Fonderie, and J.H. Huijsing, "A Curvature-Corrected Low-Voltage Bandgap Reference," IEEE J. Solid-State Circuits, Vol. SC-28, No. 6, pp. 667-670, June 1993.
16. G. A. Rincon-Mora and P. E. Allen, "A 1.1-V Current-Mode and Piecewise-Linear Curvature-Corrected Bandgap Reference," IEEE J. Solid-State Circuits, Vol. 33, No. 10, pp. 1551-1554, Oct. 1998.
17. B. Gilbert, "Monolithic Voltage and Current References: Themes and Variations." In: Analog Circuit Design, J. H. Huijsing, R. J. van de Plassche, and W. M. C. Sansen, eds. Boston, MA: Kluwer Academic Publishers, 1996, pp. 2269-2352.
18. B. S. Song and P. R. Gray, "A Precision Curvature-Corrected CMOS Bandgap Reference," IEEE J. Solid-State Circuits, Vol. SC-18, No. 6, pp. 634-643, Dec. 1983.
19. I. Lee et al., "Exponential Curvature-Compensated BiCMOS Bandgap References," IEEE J. Solid-State Circuits, Vol. SC-29, No. 11, pp. 1396-1403, Nov. 1994.
20. G. M. Meijer et al., "A New Curvature-Corrected Bandgap Reference," IEEE J. Solid-State Circuits, Vol. SC-17, No. 11, pp. 1139-1143, Dec. 1982.

Tthis chapter uses the basic subcircuits of the last chapter to develop various forms of CMOS amplifiers. We begin by examining the inverter-the most basic of all ampli- fiers. The order of presentation that follows has been arranged around the stages that might be put together to form a high-gain amplifier. The first circuit will be the differential amplifier. This serves as an excellent input stage. The next circuit will be the cascode amplifier, which is similar to the inverter, but has higher overall performance and more control over the small-signal performance. It makes an excellent gain stage and provides a means of compensation. The output stage comes next. The objective of the output stage is to drive an external load without deteriorating the performance of the high-gain amplifier. The final section of the chapter will examine how these circuits can be combined to achieve a given high-gain amplifier requirement.
The approach used will be the same as that of Chapter 4, namely, to present a general understanding of the circuit and how it works, followed by a large-signal analysis and a small-signal analysis. In this chapter we begin the transition in Fig. 4.0-1 from the lower to the upper level of simple circuits. At the end of this chapter, we will be in a position to consider complex analog CMOS circuits. The section on architectures for high-gain amplifiers will lead directly to the comparator and op amp.
As the circuits we study become more complex, we will have an opportunity to employ some of the analysis techniques detailed in Appendix A. We shall also introduce new techniques, where pertinent, in developing the subject of CMOS analog integrated-circuit design. An example of such a technique is the dominant pole approximation used for solving the roots of a second-order polynomial with algebraic coefficients.
Because of the commonality of amplifiers, we will use a uniform approach in their presentation. First, we will examine the large-signal input-output characteristics. This will provide information such as signal swing limits, operating regions (cutoff, active or saturated), and gain. Next, we will examine the small-signal performance in the region of operation where all transistors are saturated. This will provide insight into the input and output resistance and small-signal gain. Including the parasitic and intrinsic capacitors will illustrate the frequency response of the amplifier. Finally, we will examine other considerations such as noise, temperature dependence, and power dissipation where appropriate. More information on the topics of this chapter can be found in several excellent references [1-3].

### 5.1 Inverters
The inverter is the basic gain stage for CMOS circuits. Typically, the inverter uses the common-source configuration with either an active resistor for a load or a current sink/source as a load resistor. There are a number of ways in which the active load can be configured as shown in Fig. 5.1-1. These inverters include the active PMOS load inverter, current-source load inverter, and push-pull inverter. The small-signal gains increase from left to right in each of these circuits with everything else equal. The active PMOS load inverter, current-source inverter, and push-pull inverter will be considered in this chapter.
## Active Load Inverter
Many times a low-gain inverting stage is desired that has highly predictable small- and large-signal characteristics. One configuration that meets this need is shown in Fig. 5.1-1 and is the active PMOS load inverter (we will simply use the term "active load inverter"). The large-signal characteristics can be illustrated as shown in Fig. 5.1-2. This figure shows the ${i}_{D}$ versus ${v}_{DS}$ characteristics of M1 plotted on the same graph with the "load line" $\left( {i}_{D}\right.$ versus $\left. {v}_{DS}\right)$ characteristic of the p-channel, diode-connected, transistor, M2. The "load line" of the active resistor, M2, is simply the transconductance characteristic reversed and subtracted from ${V}_{DD}$ . It is apparent that the output-signal swing will experience a limitation for negative swings. ${v}_{\mathrm{{OUT}}}$ versus ${v}_{\mathrm{{IN}}}$ can be obtained by plotting the points marked $\mathrm{A},\mathrm{B},\mathrm{C}$ , and so on from the output characteristics to the output-input curve. The resulting curve is called a large-signal voltage-transfer function curve. It is obvious that this type of inverting amplifier has limited output voltage range and low gain (gain is determined by the slope of the ${v}_{\mathrm{{OUT}}}$ versus ${v}_{\mathrm{{IN}}}$ curve).
It is of interest to consider the large-signal swing limitations of the active-resistor load inverter. From Fig. 5.1-2 we see that the maximum output voltage, ${v}_{\mathrm{{OUT}}}\left( \max \right)$ , is equal to ${V}_{DD} -$ $\left| {V}_{TP}\right|$ . Therefore,
$$
{v}_{\mathrm{{OUT}}}\left( \max \right)  \cong  {V}_{DD} - \left| {V}_{TP}\right|  \tag{5.1-1}
$$
This limit ignores the subthreshold current that flows in every MOSFET. This very small current will eventually allow the output voltage to approach ${V}_{DD}$ .
In order to find ${v}_{\mathrm{{OUT}}}\left( \min \right)$ we first assume that M1 will be in the nonsaturated (active) region and that ${V}_{T1} = \left| {V}_{T2}\right|  = {V}_{T}$ . We have determined the region where M1 is active by plotting the equation
$$
{v}_{DS1} \geq  {v}_{GS1} - {V}_{TN} \rightarrow  {v}_{\text{OUT }} \geq  {v}_{\text{IN }} - {0.7}\mathrm{\;V} \tag{5.1-2}
$$

Figure 5.1-1 Various types of inverting CMOS amplifiers.

Figure 5.1-2 Graphical illustration of the voltage-transfer function for the active load inverter.
which corresponds to the saturation voltage of M1. The current through M1 is
$$
{i}_{D} = {\beta }_{1}\left( {\left( {{v}_{GS1} - {V}_{T}}\right) {v}_{DS1} - \frac{{v}_{DS1}^{2}}{2}}\right)  = {\beta }_{1}\left( {\left( {{V}_{DD} - {V}_{T}}\right) \left( {v}_{\mathrm{{OUT}}}\right)  - \frac{{\left( {v}_{\mathrm{{OUT}}}\right) }^{2}}{2}}\right)  \tag{5.1-3}
$$
and the current through $\mathrm{M}2$ is
$$
{i}_{D} = \frac{{\beta }_{2}}{2}{\left( {v}_{SG2} - \left| {V}_{T}\right| \right) }^{2} = \frac{{\beta }_{2}}{2}{\left( {V}_{DD} - {v}_{\mathrm{{OUT}}} - \left| {V}_{T}\right| \right) }^{2} = \frac{{\beta }_{2}}{2}{\left( {v}_{\mathrm{{OUT}}} + \left| {V}_{T}\right|  - {V}_{DD}\right) }^{2} \tag{5.1-4}
$$
Equating Eq. (5.1-3) to Eq. (5.1-4) and solving for ${v}_{\text{OUT }}$ gives
$$
{v}_{\mathrm{{OUT}}}\left( \min \right)  = {V}_{DD} - {V}_{T} - \frac{{V}_{DD} - {V}_{T}}{\sqrt{1 + \left( {{\beta }_{2}/{\beta }_{1}}\right) }} \tag{5.1-5}
$$
We have assumed in developing this expression that the maximum value of ${v}_{\mathrm{{IN}}}$ is equal to ${V}_{DD}$ . It is important to understand how the lower limit of Eq. (5.1-5) comes about. The reason that the output voltage cannot go to the lower limit (ground) is that the voltage across M2 produces current that must flow through M1. Any MOSFET can only have zero voltage across its drain-source if the drain current is zero. Consequently, the minimum value of ${v}_{\mathrm{{OUT}}}$ is equal to whatever drain-source drop across M1 is required to support the current defined by M2.

Figure 5.1-3 Development of the small-signal model for the active load inverter.
The small-signal voltage gain of the inverter with an active-resistor load can be found from Fig. 5.1-3. This gain can be expressed by summing the currents at the output to get
$$
{g}_{m1}{v}_{\text{in }} + {g}_{ds1}{v}_{\text{out }} + {g}_{m2}{v}_{\text{out }} + {g}_{ds2}{v}_{\text{out }} = 0 \tag{5.1-6}
$$
Solving for the voltage gain, ${v}_{\text{out }}/{v}_{\text{in }}$ , gives
$$
\frac{{v}_{\text{out }}}{{v}_{\text{in }}} = \frac{-{g}_{m1}}{{g}_{ds1} + {g}_{ds2} + {g}_{m2}} \cong   - \frac{{g}_{m1}}{{g}_{m2}} =  - {\left( \frac{{K}_{N}^{\prime }{W}_{1}{L}_{2}}{{K}_{P}^{\prime }{L}_{1}{W}_{2}}\right) }^{1/2} \tag{5.1-7}
$$
The small-signal output resistance can also be found from Fig. 5.1-3 as
$$
{R}_{\text{out }} = \frac{1}{{g}_{ds1} + {g}_{ds2} + {g}_{m2}} \cong  \frac{1}{{\mathrm{\;g}}_{m2}} \tag{5.1-8}
$$
The output resistance of the active-resistor load inverter will be low because of the low resistance of the diode-connected transistor M2. The resulting low-output resistance can be very useful in situations where a large bandwidth is required from an inverting gain stage.
The small-signal frequency response of the active-resistor load inverter will be examined next. Figure 5.1-4(a) shows a general inverter configuration and the important capacitors. The gate of M2 (point x) is connected to ${V}_{\text{out }}$ for the case of Fig. 5.1-3. ${C}_{gd1}$ and ${C}_{gd2}$ represent the overlap capacitances, ${C}_{bd1}$ and ${C}_{bd2}$ are the bulk capacitances, ${C}_{gs2}$ is the overlap plus gate capacitance, and ${C}_{L}$ is the load capacitance seen by the inverter, which can consist of the next gate(s) and any parasitics associated with the connections. Figure 5.1-4(b) illustrates the resulting small-signal model assuming that ${V}_{\text{in }}$ is a voltage source. (The case when ${V}_{\text{in }}$ has a high source resistance will be examined in Section 5.3, which deals with the cascode amplifier.) The frequency response of this circuit is
$$
\frac{{V}_{\text{out }}\left( s\right) }{{V}_{\text{in }}\left( s\right) } = \frac{-{g}_{m}{R}_{\text{out }}\left( {1 - s/{z}_{1}}\right) }{1 - s/{p}_{1}} \tag{5.1-9}
$$

Figure 5.1-4 (a) General configuration of an inverter illustrating the parasitic capacitances. (b) Small-signal model of (a).
where
$$
{g}_{m} = {g}_{m1} \tag{5.1-10}
$$
$$
{p}_{1} = \frac{-1}{{R}_{\text{out }}\left( {{C}_{\text{out }} + {C}_{M}}\right) } \approx  \frac{-{g}_{m2}}{{C}_{\text{out }} + {C}_{M}} = \frac{-\sqrt{2{K}_{N}\left( {{W}_{1}/{L}_{1}}\right) {I}_{D2}}}{{C}_{\text{out }} + {C}_{M}} \tag{5.1-11}
$$
$$
{z}_{1} = \frac{{g}_{m}}{{C}_{M}} \tag{5.1-12}
$$
and
$$
{R}_{\text{out }} = {\left( {g}_{ds1} + {g}_{ds2} + {g}_{m2}\right) }^{-1} \cong  {g}_{m2}^{-1} \tag{5.1-13}
$$
$$
{C}_{M} = {C}_{gd1} \tag{5.1-14}
$$
$$
{C}_{\mathrm{{OUT}}} = {C}_{bd1} + {C}_{bd2} + {C}_{gs2} + {C}_{L} \tag{5.1-15}
$$
It is seen that the inverting amplifier has a right half-plane zero and a left half-plane pole. Generally, the magnitude of the zero is larger than the pole so that the $- 3\mathrm{\;{dB}}$ frequency of the amplifier is equal to $1/\left\lbrack  {{R}_{\text{out }}\left( {{C}_{\text{out }} + {C}_{M}}\right) }\right\rbrack$ . Equation (5.1-11) shows that in this case, the -3 dB frequency of the active-resistor load inverter is approximately proportional to the square root of the drain current. As the drain current increases, the bandwidth will also increase because $R$ will decrease.
---
Example 5.1-1
---
## Performance of an Active-Resistor Load Inverter
Calculate the output-voltage swing limits for ${V}_{DD} = 5\mathrm{\;V}$ , the small-signal gain, the output resistance, and the $- 3\mathrm{\;{dB}}$ frequency of Fig. 5.1-3 if ${W}_{1}/{L}_{1}$ is ${2\mu }\mathrm{m}/{1\mu }\mathrm{m}$ and ${W}_{2}/{L}_{2} = {1\mu }\mathrm{m}/$ ${1\mu }\mathrm{m},{C}_{gd1} = {0.5}\mathrm{{fF}},{C}_{bd1} = {10}\mathrm{{fF}},{C}_{bd2} = {10}\mathrm{{fF}},{C}_{gs2} = 2\mathrm{{fF}},{C}_{L} = 1\mathrm{{pF}}$ , and ${I}_{D1} = {I}_{D2} =$ ${100\mu }\mathrm{A}$ , using the parameters in Table 3.1-2.
## SOLUTION
From Eqs. (5.1-1) and (5.1-5) we find that the ${v}_{\mathrm{{OUT}}}\left( \max \right)  = {4.3}\mathrm{\;V}$ and ${v}_{\mathrm{{OUT}}}\left( \min \right)  = {0.418}\mathrm{\;V}$ . Using Eq. (5.1-6) we find that the small-signal voltage gain is -2.098 V/V. From Eq. (5.1-8), we get an output resistance of ${9.17}\mathrm{k}\Omega$ if we include ${g}_{ds1}$ and ${g}_{ds2}$ and ${10}\mathrm{k}\Omega$ if we consider only ${g}_{m2}$ . Finally, the zero is at ${3.97} \times  {10}^{11}\mathrm{{rad}}/\mathrm{s}$ and the pole is at $- {106.7} \times  {10}^{6}\mathrm{{rad}}/\mathrm{s}$ . Thus, the $- 3\mathrm{\;{dB}}$ frequency is ${17}\mathrm{{MHz}}$ .
## Current-Source Inverter
Often an inverting amplifier is required that has gain higher than that achievable by the active load inverting amplifier. A second inverting amplifier configuration, which has higher gain, is the current-source inverter shown in Fig. 5.1-1. Instead of a PMOS diode as the load, a current-source load is used. The current source is a common-gate configuration using a p-channel transistor with the gate connected to a dc bias voltage, ${V}_{GG2}$ . The large-signal characteristics of this amplifier can be illustrated graphically. Figure 5.1-5 shows a plot of ${i}_{D}$ versus ${v}_{\mathrm{{OUT}}}$ . On this current-voltage characteristic the output characteristics of M1 are plotted. Since ${v}_{\mathrm{{IN}}}$ is the same as ${v}_{\mathrm{{GS}}1}$ , the curves have been labeled accordingly. Superimposed on these characteristics are the output characteristics of M2 with ${v}_{\mathrm{{OUT}}} = {V}_{DD} - {v}_{SD2}$ . The large-signal voltage-transfer function curve can be obtained in a manner similar to Fig. 5.1-2 for the active-resistor load inverter. Transferring the points $\mathrm{A},\mathrm{\;B},\mathrm{C}$ , and so on from the output characteristic of Fig. 5.1-5 for a given value of ${V}_{SG2}$ to the voltage-transfer curve of Fig. 5.1-5 results in the large-signal voltage-transfer function curve shown.
The regions of operation for the transistors of Fig. 5.1-5 are found by expressing the saturation relationship for each transistor. For M1, this relationship is
$$
{v}_{DS1} \geq  {v}_{GS1} - {V}_{TN} \rightarrow  {v}_{\text{OUT }} \geq  {v}_{\text{IN }} - {0.7}\mathrm{\;V} \tag{5.1-16}
$$
which is plotted on the voltage-transfer curve in Fig. 5.1-5. The equivalent relationship for $\mathrm{M}2$ requires careful attention to signs. This relationship is
$$
{v}_{SD2} \geq  {v}_{SG2} - \left| {V}_{TP}\right|  \rightarrow  {V}_{DD} - {V}_{\mathrm{{OUT}}} \geq  {V}_{DD} - {V}_{GG2} - \left| {V}_{TP}\right|  \rightarrow  {v}_{\mathrm{{OUT}}} \leq  {3.2}\mathrm{\;V}\text{(5.1-17)} \tag{5.1-17}
$$
In other words, when ${v}_{\mathrm{{OUT}}}$ is less than ${3.2}\mathrm{\;V},\mathrm{M}2$ is saturated. This is also plotted on Fig. 5.1-5. One must know in which region the transistors are operating to be able to perform the following analyses.

Figure 5.1-5 Graphical illustration of the voltage-transfer function for the current-source load inverter.
The limits of the large-signal output-voltage swing of the current-source load inverter can be found using an approach similar to that used for the active-resistor inverter. ${v}_{\mathrm{{OUT}}}\left( \max \right)$ is equal to ${V}_{DD}$ since when M1 is off, the voltage across M2 can go to zero, allowing the output voltage to equal ${V}_{DD}$ providing no output dc current is required. Thus, the maximum positive output voltage is
$$
{v}_{\text{OUT }}\left( \max \right)  \cong  {V}_{DD} \tag{5.1-18}
$$
The lower limit can be found by assuming that M1 will be in the nonsaturation region. ${v}_{\mathrm{{OUT}}}\left( \min \right)$ can be given as
$$
{v}_{\mathrm{{OUT}}}\left( \min \right)  = \left( {{V}_{DD} - {V}_{T1}}\right) \left\{  {1 - {\left\lbrack  1 - \left( \frac{{\beta }_{2}}{{\beta }_{1}}\right) {\left( \frac{{V}_{SG2} - \left| {\mathrm{V}}_{T2}\right| }{{V}_{DD} - {V}_{T1}}\right) }^{2}\right\rbrack  }^{1/2}}\right\}   \tag{5.1-19}
$$
This result assumes that ${v}_{\mathrm{{IN}}}$ is taken to ${V}_{DD}$ .
The small-signal performance can be found using the model of Fig. 5.1-3 with ${g}_{m2}{v}_{\text{out }} =$ 0 (this is to account for the fact that the gate of M2 is on ac ground). The small-signal voltage gain is given as
$$
\frac{{v}_{\text{out }}}{{v}_{\text{in }}} = \frac{-{g}_{m1}}{{g}_{ds1} + {g}_{ds2}} = {\left( \frac{2{K}_{N}^{\prime }{W}_{1}}{{L}_{1}{I}_{D}}\right) }^{1/2}\left( \frac{-1}{{\lambda }_{1} + {\lambda }_{2}}\right)  \propto  \frac{1}{\sqrt{{I}_{D}}} \tag{5.1-20}
$$
This is a significant result in that the gain increases as the dc current decreases. It is a result of the output conductance being proportional to the bias current, whereas the transconductance is proportional to the square root of the bias current. This of course assumes that the simple relationship for the output conductance expressed by Eq. (3.3-9) is valid. The increase of gain as ${I}_{D}$ decreases holds true until this current reaches the subthreshold region of operation, where weak inversion occurs. At this point the transconductance becomes proportional to the bias current and the small-signal voltage gain becomes a constant as a function of bias current. If we assume that the subthreshold current occurs at a level of approximately ${1\mu }\mathrm{A}$ and if ${\left( W/L\right) }_{1} = {\left( W/L\right) }_{2} = {10\mu }\mathrm{m}/{1\mu }\mathrm{m}$ , then using the parameter values in Table 3.1-2 gives the maximum gain of the current-load CMOS inverter of Fig. 5.1-5 as approximately -521 $\mathrm{V}/\mathrm{V}$ . Figure 5.1-6 shows the typical dependence of the inverter using a current-source load as a function of the dc bias current, assuming that the subthreshold effects occur at approximately ${1\mu }\mathrm{A}$ .

Figure 5.1-6 Illustration of the influence of the dc drain current on the small-signal voltage gain of the current-source inverting amplifier.
The small-signal output resistance of the CMOS inverter with a current-source load can be found from Fig. 5.1-3 (with ${g}_{m2}{v}_{\text{out }} = 0$ ) as
$$
{R}_{\text{out }} = \frac{1}{{g}_{ds1} + {g}_{ds2}} \cong  \frac{1}{{I}_{D}\left( {{\lambda }_{1} + {\lambda }_{2}}\right) } \tag{5.1-21}
$$
If ${I}_{D} = {200\mu }\mathrm{A}$ and using the parameters of Table 3.1-2, the output resistance of the current-source CMOS inverter is approximately ${56}\mathrm{k}\Omega$ , assuming channel lengths of ${1\mu }\mathrm{m}$ . Compared to the active load CMOS inverter, this output resistance is higher. Unfortunately, the result is a lower bandwidth.
The -3 dB frequency of the current-source CMOS inverter can be found from Fig. 5.1- 4 assuming that the gate of $\mathrm{M}2$ (point $\mathrm{x}$ ) is connected to a voltage source, ${V}_{GG2}$ . In this case, ${C}_{M}$ is given by Eq. (5.1-14) and ${R}_{\text{out }}$ and ${C}_{\text{out }}$ of Eqs. (5.1-13) and (5.1-15) become
$$
{R}_{\text{out }} = \frac{1}{{g}_{ds1} + {g}_{ds2}} \tag{5.1-22}
$$
$$
{C}_{M} = {C}_{gd1} \tag{5.1-23}
$$
$$
{C}_{\text{out }} = {C}_{gd2} + {C}_{bd1} + {C}_{bd2} + {C}_{L} \tag{5.1-24}
$$
The zero for the current-source inverter is given by Eq. (5.1-12). The pole is found to be
$$
{p}_{1} = \frac{-1}{{R}_{\text{out }}\left( {{C}_{\text{out }} + {C}_{M}}\right) } =  - \left( \frac{{g}_{ds1} + {g}_{ds2}}{{C}_{\text{out }} + {C}_{M}}\right)  \tag{5.1-25}
$$
The $- 3\mathrm{\;{dB}}$ frequency response can be expressed as the magnitude of ${p}_{1}$ , which is
$$
{\omega }_{1} = \frac{{g}_{ds1} + {g}_{ds2}}{{C}_{gd1} + {C}_{gd2} + {C}_{bd1} + {C}_{bd2} + {C}_{L}} \tag{5.1-26}
$$
assuming that the zero magnitude is greater than the magnitude of the pole. If the current-load inverter has a dc current of ${200\mu }\mathrm{A}$ and if the capacitors have the values given in Example 5.1-1 (with ${C}_{gd1} = {C}_{gd2}$ ), we find that the $- 3\mathrm{\;{dB}}$ frequency is ${1.91}\mathrm{{MHz}}$ (assuming channel lengths of ${1\mu }\mathrm{m}$ ). The difference between this frequency and that found in Example 5.1-1 is due to the larger output resistance.
---
Example 5.1-2
---
## Performance of a Current-Sink Inverter
The performance of a current-sink CMOS inverter is to be examined. The current-sink inverter is shown in Fig. 5.1-7. Assume that ${W}_{1} = {2\mu }\mathrm{m},{L}_{1} = {1\mu }\mathrm{m},{W}_{2} = {1\mu }\mathrm{m},{L}_{2} = {1\mu }\mathrm{m}$ , ${V}_{DD} = 5\mathrm{\;V},{V}_{GG1} = 3\mathrm{\;V}$ , and the parameters of Table 3.1-2 describe $\mathrm{M}1$ and $\mathrm{M}2$ . Use the capacitor values of Example 5.1-1 $\left( {{C}_{gd1} = {C}_{gd2}}\right)$ . Calculate the output-swing limits and the small-signal performance.

Figure 5.1-7 Current-sink CMOS inverter.
SOLUTION
To attain the output signal-swing limitations, we treat Fig. 5.1-7 as a current-source CMOS inverter with PMOS parameters for the NMOS and NMOS parameters for the PMOS and use Eqs. (5.1-18) and (5.1-19). When we convert the answers for the current-source CMOS inverter, the output signal-swing limitations for the current-sink CMOS inverter of Fig. 5.1-7 will be achieved. Using a prime notation to designate the results of the current-source CMOS inverter, which exchanges the PMOS and NMOS model parameters, we get
$$
{v}_{\text{OUT }}^{\prime }\left( \max \right)  = 5\mathrm{\;V}
$$
and
$$
{v}_{\mathrm{{OUT}}}^{\prime }\left( \min \right)  = \left( {5 - {0.7}}\right) \left\lbrack  {1 - \sqrt{1 - \left( \frac{{110} \cdot  1}{{50} \cdot  2}\right) {\left( \frac{3 - {0.7}}{5 - {0.7}}\right) }^{2}}}\right\rbrack   = {0.740}\mathrm{\;V}
$$
In terms of the current-sink CMOS inverter, these limits are subtracted from $5\mathrm{\;V}$ to get
$$
{v}_{\text{OUT }}\left( \max \right)  = {4.26}\mathrm{\;V}
$$
and
$$
{v}_{\mathrm{{OUT}}}\left( \min \right)  = 0\mathrm{\;V}
$$
To find the small-signal performance, we must first calculate the dc current. The dc current, ${I}_{D}$ , is
$$
{I}_{D} = \frac{{K}_{N}^{\prime }{W}_{1}}{2{L}_{1}}{\left( {V}_{GG1} - {V}_{TN}\right) }^{2} = \frac{{110} \cdot  1}{2 \cdot  1}{\left( 3 - {0.7}\right) }^{2} = {291\mu A}
$$
The small-signal gain can be calculated from Eq. (5.1-20) as -9.2. The output resistance and the $- 3\mathrm{\;{dB}}$ frequency are ${38.1}\mathrm{k}\Omega$ and ${4.09}\mathrm{{MHz}}$ , respectively.
## Push-Pull Inverter
If the gate of M2 in Fig. 5.1-5 or 5.1-7 is taken to the gate of M1, the push-pull CMOS inverter of Fig. 5.1-8 results. The large-signal voltage-transfer function plot for the push-pull inverter can be found in a similar manner as the plot for the current-source inverter. In this case the points $\mathrm{A},\mathrm{B},\mathrm{C}$ , and so on describe the load line of the push-pull inverter. The large-signal voltage-transfer function characteristic is found by projecting these points down to the horizontal axis and plotting the results on the lower right-hand plot of Fig. 5.1-8. In comparing the large-signal voltage-transfer function characteristics between the current-source and push-pull inverters, it is seen that the push-pull inverter has a higher gain assuming identical transistors. This is due to the fact that both transistors are being driven by ${v}_{\mathrm{{IN}}}$ . Another advantage of the push-pull inverter is that the output swing is capable of operation from rail-to-rail $\left( {V}_{DD}\right.$ to ground in this case).
The regions of operation for the push-pull inverter are shown on the voltage-transfer curve of Fig. 5.1-8. These regions are easily found using the definition of ${V}_{DS}$ (sat) given for the MOSFET. M1 is in the saturation region when
$$
{v}_{DS1} \geq  {v}_{GS1} - {V}_{T1} \rightarrow  {v}_{\text{OUT }} \geq  {v}_{\mathrm{{IN}}} - {0.7}\mathrm{\;V} \tag{5.1-27}
$$
$\mathrm{M}2$ is in the saturation region when
$$
{v}_{SD2} \geq  {v}_{SG2} - \left| {V}_{T2}\right|  \rightarrow  {V}_{DD} - {v}_{\mathrm{{OUT}}} \geq  {V}_{DD} - {v}_{\mathrm{{IN}}} - \left| {V}_{T2}\right|  \tag{5.1-28}
$$
$$
\rightarrow  {v}_{\mathrm{{OUT}}} \leq  {v}_{\mathrm{{IN}}} + {0.7}\mathrm{\;V}
$$
If we plot Eqs. (5.1-27) and (5.1-28) using the equality sign, then the two lines on the voltage-transfer curve of Fig. 5.1-8 result, with the regions appropriately labeled. An important principle emerges from this and the previous voltage-transfer functions. This principle is that the largest gain (steepest slope) always occurs when all transistors are saturated.

Figure 5.1-8 Graphical illustration of the voltage-transfer function for the push-pull inverter.

Figure 5.1-9 Small-signal model for the CMOS inverter of Fig. 5.1-8.
The small-signal performance of the push-pull inverter depends on its operating region. If we assume that both transistors, M1 and M2, are in the saturation region, then we will achieve the largest voltage gains. The small-signal behavior can be analyzed with the aid of Fig. 5.1-9.
The small-signal voltage gain is
$$
\frac{{v}_{\text{out }}}{{v}_{\text{in }}} = \frac{-\left( {{g}_{m1} + {\mathrm{g}}_{m2}}\right) }{{\mathrm{g}}_{ds1} + {\mathrm{g}}_{ds2}} =  - \sqrt{\left( 2/{I}_{D}\right) }\left\lbrack  \frac{\sqrt{{K}_{N}^{\prime }\left( {{W}_{1}/{L}_{1}}\right) } + \sqrt{{K}_{P}^{\prime }\left( {{W}_{2}/{L}_{2}}\right) }}{{\lambda }_{1} + {\lambda }_{2}}\right\rbrack   \tag{5.1-29}
$$
We note the same dependence of the gain on the dc current that was observed for the current-source/sink inverters. If ${I}_{D}$ is ${1\mu }\mathrm{A}$ and ${W}_{1}/{L}_{1} = {W}_{2}/{L}_{2} = 1$ , then using the parameters of Table 3.1-2, the maximum small-signal voltage gain is -276. The output resistance and the $- 3\mathrm{\;{dB}}$ frequency response of the push-pull inverter are identical to those of the current-source inverter given in Eqs. (5.1-22) through (5.1-26). The only difference is the right half-plane (RHP) zero, which is given as
$$
z = \frac{{g}_{m1} + {g}_{m2}}{{C}_{M}} = \frac{{g}_{m1} + {g}_{m2}}{{C}_{gd1} + {C}_{gd2}} \tag{5.1-30}
$$
This zero is normally larger than the pole so that the $- 3\mathrm{\;{dB}}$ frequency given by Eq. (5.1-26) is valid.
---
Example 5.1-3
---
## Performance of a Push-Pull Inverter
The performance of a push-pull CMOS inverter is to be examined. Assume that ${W}_{1} = {1\mu }\mathrm{m}$ , ${L}_{1} = {1\mu }\mathrm{m},{W}_{2} = {2\mu }\mathrm{m},{L}_{2} = {1\mu }\mathrm{m}$ , and ${V}_{DD} = 5\mathrm{\;V}$ , and use the parameters of Table 3.1-2 to model M1 and M2. Use the capacitor values of Example 5.1-1 $\left( {{C}_{gd1} = {C}_{gd2}}\right)$ . Calculate the output-swing limits and the small-signal performance assuming that ${I}_{D1} = {I}_{D2} = {300\mu }\mathrm{A}$ .
## SOLUTION
The output swing is seen to be from 0 to $5\mathrm{\;V}$ . In order to find the small-signal performance, we will make the important assumption that both transistors are operating in the saturation region. Therefore, the small-signal voltage gain is
$$
\frac{{v}_{\text{out }}}{{v}_{\text{in }}} = \frac{-{257\mu }\mathrm{S} - {245\mu }\mathrm{S}}{{1.2\mu }\mathrm{S} + {1.5\mu }\mathrm{S}} =  - {18.6}\mathrm{\;V}/\mathrm{V}
$$
The output resistance is ${37}\mathrm{k}\Omega$ and the $- 3\mathrm{\;{dB}}$ frequency is ${2.86}\mathrm{{MHz}}$ . The RHP zero is 399 MHz.
## Noise Analysis of Inverters
It is of interest to analyze the inverters of this section in terms of their noise performance. First consider the active load inverter of Fig. 5.1-3. Our approach will be to assume the source is on ac ground and reflect the mean-square channel current-noise spectral density ${i}_{n}^{2}$ to a mean-square input-voltage-noise spectral density ${e}_{n}^{2}$ in series with each gate of each device and then to calculate the output-voltage-noise spectral density ${e}_{\text{out }}^{2}$ . In this calculation, all sources are assumed to be additive. The circuit model for this calculation is given in Fig. 5.1-10.
Dividing ${e}_{\text{out }}^{2}$ by the square of the voltage gain of the inverter will give the equiv input-voltage-noise spectral density, ${e}_{\mathrm{{eq}}}^{2}$ . Applying this approach to Fig. 5.1-3 yields
$$
{e}_{\text{out }}^{2} = {e}_{n1}^{2}{\left( \frac{{g}_{m1}}{{g}_{m2}}\right) }^{2} + {e}_{n2}^{2} \tag{5.1-31}
$$
From Eq. (5.1-7) we can solve for the equivalent input-voltage-noise spectral density as
$$
{e}_{\mathrm{{eq}}} = {e}_{n1}\sqrt{{\left( 1 + \frac{{g}_{m2}}{{g}_{m1}}\right) }^{2}{\left( \frac{{e}_{n2}}{{e}_{n1}}\right) }^{2}} \tag{5.1-32}
$$
Substituting Eq. (3.2-15) and Eq. (3.3-6) into Eq. (5.1-32) gives, for 1/f noise,
$$
{e}_{\mathrm{{eq}}\left( {1/f}\right) } = {\left( \frac{{B}_{1}}{f{W}_{1}{L}_{1}}\right) }^{1/2}{\left\lbrack  1 + \left( \frac{{K}_{2}^{\prime }{B}_{2}}{{K}_{1}^{\prime }{B}_{1}}\right) {\left( \frac{{L}_{1}}{{L}_{2}}\right) }^{2}\right\rbrack  }^{1/2}\left( {\mathrm{\;V}/\sqrt{\mathrm{{Hz}}}}\right)  \tag{5.1-33}
$$
If the length of M1 is much smaller than that of M2, the input $1/f$ noise will be dominated by M1. To minimize the $1/f$ contribution due to M1, its width must be increased. For some processes, the p-channel transistor exhibits lower $1/f$ noise than n-channel transistors. For such cases, the p-channel transistor should be employed as the input device. The thermal-noise performance of this inverter is given as
$$
{e}_{\mathrm{{eq}}\left( {th}\right) } = {\left\{  \left( \frac{{8kT}\left( {1 + {\eta }_{1}}\right) }{3{\left\lbrack  2{K}_{1}^{\prime }{\left( W/L\right) }_{1}{I}_{1}\right\rbrack  }^{1/2}}\right) \left\lbrack  1 + {\left( \frac{{W}_{2}{L}_{1}{K}_{2}^{\prime }}{{L}_{2}{W}_{1}{K}_{1}^{\prime }}\right) }^{1/2}\left( \frac{1 + {\eta }_{2}}{1 + {\eta }_{1}}\right) \right\rbrack  \right\}  }^{1/2}\left( {\mathrm{V}/\sqrt{\mathrm{{Hz}}}}\right)  \tag{5.1-34}
$$
In calculating the output-voltage-noise spectral density of Eq. (5.1-31) we assumed that the gain from ${e}_{n2}^{2}$ to ${e}_{\text{out }}^{2}$ was unity. This can be verified by Fig. 5.1-11 in which we find that
$$
\frac{{e}_{\text{out }}^{2}}{{e}_{n2}^{2}} = {\left\lbrack  \frac{{g}_{m2}\left( {{r}_{ds1}\parallel {r}_{ds2}}\right) }{1 + {g}_{m2}\left( {{r}_{ds1}\parallel {r}_{ds2}}\right) }\right\rbrack  }^{2} \approx  1 \tag{5.1-35}
$$

Figure 5.1-10 Noise calculations in an active load inverter.

Figure 5.1-11 Illustration of the influence of ${e}_{n2}^{2}$ on the noise of Fig. 5.1-10.
The noise model for the current-source load inverter of Fig. 5.1-5 is shown in Fig. 5.1-12. The output-voltage-noise spectral density of this inverter can be written as
$$
{e}_{\text{out }}^{2} = {\left( {g}_{m1}{R}_{\text{out }}\right) }^{2}{e}_{n1}^{2} + {\left( {g}_{m2}{R}_{\text{out }}\right) }^{2}{e}_{n2}^{2} \tag{5.1-36}
$$
Dividing Eq. (5.1-36) by the square of the gain of this inverter and taking the square root results in an expression similar to Eq. (5.1-32). Thus, the noise performances of the two circuits are equivalent although the small-signal voltage gains are significantly different.
The output-voltage-noise spectral density of the push-pull inverter can be calculated using Fig. 5.1-13. Dividing this quantity by the square of the gain gives the equivalent input-voltage-noise spectral density of the push-pull inverter as
$$
{e}_{\mathrm{{eq}}} = \sqrt{{\left( \frac{{g}_{m1}{e}_{n1}}{{g}_{m1} + {g}_{m2}}\right) }^{2} + {\left( \frac{{g}_{m2}{e}_{n2}}{{g}_{m1} + {g}_{m2}}\right) }^{2}} \tag{5.1-37}
$$
If the transconductances are balanced $\left( {{g}_{m1} = {g}_{m2}}\right)$ , then the noise contribution of each device is divided by 2 . The total noise contribution can be reduced only by reducing the noise contributed by each device individually. The calculation of thermal and $1/f$ noise in terms of device dimensions and currents is left as an exercise for the reader.
The inverter is one of the basic amplifiers in analog circuit design. Three different configurations of the CMOS inverter have been presented in this section. If the inverter is driven from a voltage source, then the frequency response consists of a single dominant pole at the output of the inverter. The small-signal gain of the inverters with current-sink/source loads was found to be inversely proportional to the square root of the current, which led to high gains. However, the high gain of current-source/sink and push-pull inverters can present a problem when one is trying to establish dc biasing points. High-gain stages such as these will require the assistance of a dc negative feedback path in order to stabilize the biasing point. In other words, one should not expect to find the dc output voltage well defined if the input dc voltage is defined.

Figure 5.1-12 Noise calculations in a current-source load inverter.

Figure 5.1-13 Noise model for the push-pull CMOS inverter.

### 5.2 Differential Amplifiers
The differential amplifier is one of the more versatile circuits in analog circuit design. It is also very compatible with integrated-circuit technology and serves as the input stage to most op amps. Figure 5.2-1(a) shows a schematic model for a differential amplifier (actually this symbol will also be used for the comparator and op amp). Voltages ${v}_{1},{v}_{2}$ , and ${v}_{\mathrm{{OUT}}}$ are called single-ended voltages. This means that they are defined with respect to ground. The differential-mode input voltage, ${v}_{ID}$ , of the differential amplifier is defined as the difference between ${v}_{1}$ and ${v}_{2}$ . This voltage is defined between two terminals, neither of which is ground. The common-mode input voltage, ${v}_{IC}$ , is defined as the average value of ${v}_{1}$ and ${v}_{2}$ . These voltages are given as
$$
{v}_{ID} = {v}_{1} - {v}_{2} \tag{5.2-1}
$$
and
$$
{v}_{IC} = \frac{{v}_{1} + {v}_{2}}{2} \tag{5.2-2}
$$
Figure 5.2-1(b) illustrates these two voltages. Note that ${v}_{1}$ and ${v}_{2}$ can be expressed as
$$
{v}_{1} = {v}_{IC} + \frac{{v}_{ID}}{2} \tag{5.2-3}
$$
and
$$
{v}_{2} = {v}_{IC} - \frac{{v}_{ID}}{2} \tag{5.2-4}
$$

Figure 5.2-1 (a) Symbol for a differential amplifier. (b) Illustration of the differential mode, ${v}_{ID}$ , and common mode, ${v}_{IC}$ , input voltages.
The output voltage of the differential amplifier can be expressed in terms of its differential-mode and common-mode input voltages as
$$
{v}_{\mathrm{{OUT}}} = {A}_{VD}{v}_{ID} \pm  {A}_{VC}{v}_{IC} = {A}_{VD}\left( {{v}_{1} - {v}_{2}}\right)  \pm  {A}_{VC}\left( \frac{{v}_{1} + {v}_{2}}{2}\right)  \tag{5.2-5}
$$
where ${A}_{VD}$ is the differential-mode voltage gain and ${A}_{VC}$ is the common-mode voltage gain. The $\pm$ sign preceding the common-mode voltage gain implies that the polarity of this voltage gain is not known beforehand. The objective of the differential amplifier is to amplify only the difference between two different potentials regardless of the common-mode value. Thus, a differential amplifier can be characterized by its common-mode rejection ratio (CMRR), which is the ratio of the magnitude of the differential gain to the common-mode gain. An ideal differential amplifier will have a zero value of ${A}_{VC}$ and therefore an infinite CMRR. In addition, the input common-mode range (ICMR) specifies over what range of common-mode voltages the differential amplifier continues to sense and amplify the difference signal with the same gain. Another characteristic affecting performance of the differential amplifier is offset voltage. In CMOS differential amplifiers, the most serious offset is the offset voltage. Ideally, when the input terminals of the differential amplifier are connected together, the output voltage is at a desired quiescent point. In a real differential amplifier, the output-offset voltage is the difference between the actual output voltage and the ideal output voltage when the input terminals are connected together. If this offset voltage is divided by the differential voltage gain of the differential amplifier, then it is called the input-offset voltage $\left( {V}_{OS}\right)$ . Typically, the input-offset voltage of a CMOS differential amplifier is $5 - {20}\mathrm{{mV}}$ .
## Large-Signal Analysis
Let us begin our analysis of the differential amplifier with the large-signal characteristics. Figure 5.2-2 shows a CMOS differential amplifier that uses n-channel MOSFETs M1 and M2 to form a differential amplifier. M1 and M2 are biased with a current sink ${I}_{SS}$ connected to the sources of M1 and M2. This configuration of M1 and M2 is often called a source-coupled pair: M3 and M4 are an example of how the current sink ${I}_{SS}$ might be implemented.
Because the sources of M1 and M2 are not connected to ground, the question of where to connect the bulk arises. The answer depends on the technology. If we assume that the CMOS technology is p-well, then the n-channel transistors are fabricated in a p-well as shown in Fig. 5.2-3. There are two obvious places to connect the bulks of M1 and M2. The first is to connect the bulks to the sources of M1 and M2 and let the p-well containing M1 and M2 float. The second is to connect the bulks of M1 and M2 to ground. What differences exist between

Figure 5.2-2 CMOS differential amplifier using NMOS transistors.

Figure 5.2-3 Cross section of M1 and M2 of Fig. 5.2-2 in a p-well CMOS technology.
the two choices? If the p-well is connected to the sources of M1 and M2, then the threshold voltages are not increased because of the reverse-biased bulk-source junction. However, the capacitance at the source-coupled point to ground now becomes the entire reverse-biased pn junction between the p-well and the n-substrate. If the p-well is connected to lowest potential available (ground), then the threshold voltages will increase and vary with the common-mode input voltage but the capacitance from the source-coupled point to ground is reduced to the two reverse-biased pn junctions between the sources of M1 and M2 and the p-well. The choice depends on the application. For example, consider Fig. 5.2-4. In this figure we see two familiar configurations of the op amp. Figure 5.2-4(a) is the gain of -1 configuration and Fig. 5.2-4(b) is the gain of +1 . Normally the input to an op amp is a differential amplifier, and we have shown a possible implementation of just the differential input stage using NMOS transistors. In Fig. 5.2-4(a), the source-coupled node has little change in voltage with respect to ground when a $1\mathrm{\;V}$ step is applied at the input. However, in Fig. 5.2-4(b), the source-coupled node changes the same amount as the $1\mathrm{\;V}$ input step. In this case, a large capacitance from the source-coupled node to ground would have a deleterious effect on the circuit performance. In some cases, the designer may have no choice if the source-coupled pair consists of p-channel transistors in a p-well technology.
The large-signal analysis begins by assuming that M1 and M2 are perfectly matched. It is also not necessary for us to define the loads of M1 and M2 to understand the differential large-signal behavior. The large-signal characteristics can be developed by assuming that M1 and M2 of Fig. 5.2-2 are always in saturation. This condition is reasonable in most cases and illustrates the behavior even when this assumption is not valid. The pertinent relationships describing large-signal behavior are given as
$$
{v}_{ID} = {v}_{GS1} - {v}_{GS2} = {\left( \frac{2{i}_{D1}}{\beta }\right) }^{1/2} - {\left( \frac{2{i}_{D2}}{\beta }\right) }^{1/2} \tag{5.2-6}
$$
and
$$
{I}_{SS} = {i}_{D1} + {i}_{D2} \tag{5.2-7}
$$
Substituting Eq. (5.2-7) into Eq. (5.2-6) and forming a quadratic allows the solution for ${i}_{D1}$ and ${i}_{D2}$ as
$$
{i}_{D1} = \frac{{I}_{SS}}{2} + \frac{{I}_{SS}}{2}{\left( \frac{\beta {v}_{ID}^{2}}{{I}_{SS}} - \frac{{\beta }^{2}{v}_{ID}^{4}}{4{I}_{SS}^{2}}\right) }^{1/2} \tag{5.2-8}
$$

Figure 5.2-4 (a) Inverting configuration of the op amp with a gain of -1 . (b) Noninverting configuration of the op amp with a gain of +1 .
and
$$
{i}_{D2} = \frac{{I}_{SS}}{2} - \frac{{I}_{SS}}{2}{\left( \frac{\beta {v}_{ID}^{2}}{{I}_{SS}} - \frac{{\beta }^{2}{v}_{ID}^{4}}{4{I}_{SS}^{2}}\right) }^{1/2} \tag{5.2-9}
$$
where these relationships are only useful for ${v}_{ID} < 2{\left( {I}_{SS}/\beta \right) }^{1/2}$ . Figure 5.2-5 shows a plot of the normalized drain current of M1 versus the normalized differential input voltage. The dotted portions of the curves are meaningless and are ignored.
The above analysis has resulted in ${i}_{D1}$ or ${i}_{D2}$ in terms of the differential input voltage, ${v}_{ID}$ . It is of interest to determine the slope of this curve, which leads to one definition of transconductance for the differential amplifier. Differentiating Eq. (5.2-8) with respect to ${v}_{ID}$ and setting ${V}_{ID} = 0$ gives the differential transconductance of the differential amplifier as
$$
{g}_{m} = \frac{\partial {i}_{D1}}{\partial {v}_{ID}}\left( {{V}_{ID} = 0}\right)  = {\left( \beta {I}_{SS}/4\right) }^{1/2} = {\left( \frac{{K}_{1}^{\prime }{I}_{SS}{W}_{1}}{4{L}_{1}}\right) }^{1/2} \tag{5.2-10}
$$
We note in comparing this result to Eq. (3.3-6) with ${I}_{SS}/2 = {I}_{D}$ that a difference of 2 exists. The reason for this difference is that only half of ${v}_{ID}$ is being applied to M1. It is also interesting to note that as ${I}_{SS}$ is increased the transconductance also increases. The important property, that small-signal performance can be controlled by a dc parameter, is illustrated yet again.
The next step in the large-signal analysis of the CMOS differential amplifier is to examine the voltage-transfer curve. This requires inserting a load between the drains of M1 and M2 in Fig. 5.2-2 and the power supply, ${V}_{DD}$ . We have many choices including resistors, MOS diodes, or current sources. We will examine some of these choices later; however, for now let us select a widely used load consisting of a p-channel current mirror. This choice results in the circuit of Fig. 5.2-6. Under quiescent conditions (no applied differential signal, i.e., ${v}_{ID} = 0$ V), the two currents in M1 and M2 are equal and sum to ${I}_{SS}$ , the current in the current sink, M5. The current of M1 will determine the current in M3. Ideally, this current will be mirrored in M4. If ${v}_{GS1} = {v}_{GS2}$ and M1 and M2 are matched, then the currents in M1 and M2 are equal. Thus, the current that M4 sources to M2 should be equal to the current that M2 requires, causing ${i}_{\mathrm{{OUT}}}$ to be zero. In the above analysis, all transistors are assumed to be saturated.

Figure 5.2-5 Large-signal transconductance characteristic of a CMOS differential amplifier.

Figure 5.2-6 CMOS differential amplifier using a current-mirror load.
If these currents are not equal as in the following analysis, we assume because the external load resistance is infinite that the current flows in the self-resistance of M2 and M4 (due to the channel modulation effect). If ${v}_{GS1} > {v}_{GS2}$ , then ${i}_{D1}$ increases with respect to ${i}_{D2}$ since ${I}_{SS} = {i}_{D1} + {i}_{D2}$ . This increase in ${i}_{D1}$ implies an increase in ${i}_{D3}$ and ${i}_{D4}$ . However, ${i}_{D2}$ decreases when ${v}_{GS1}$ is greater than ${v}_{GS2}$ . Therefore, the only way to establish circuit equilibrium is for ${i}_{\mathrm{{OUT}}}$ to become positive and ${v}_{\mathrm{{OUT}}}$ to increase. It can be seen that if ${v}_{GS1} < {v}_{GS2}$ then ${i}_{\mathrm{{OUT}}}$ becomes negative and ${v}_{\mathrm{{OUT}}}$ decreases. This configuration provides a simple way in which the differential output signal of the differential amplifier can be converted back to a single-ended signal, that is, one referenced to ac ground.
If we assume that the currents in the current mirror are identical, then ${i}_{\mathrm{{OUT}}}$ can be found by subtracting ${i}_{D2}$ from ${i}_{D1}$ for the n-channel differential amplifier of Fig. 5.2-6. Since ${i}_{\mathrm{{OUT}}}$ is a differential output current, we distinguish this transconductance from that of Eq. (5.2-10) by using the notation ${g}_{md}$ . The differential-in, differential-out transconductance is twice ${g}_{m}$ and can be written as
$$
{g}_{md} = \frac{\partial {i}_{\mathrm{{OUT}}}}{\partial {v}_{ID}}\left( {{V}_{ID} = 0}\right)  = {\left( \frac{{K}_{1}^{\prime }{I}_{SS}{W}_{1}}{{L}_{1}}\right) }^{1/2} \tag{5.2-11}
$$
which is exactly equal to the transconductance of the common-source MOSFET if ${I}_{D}$ $= {I}_{SS}/2$ .
The large-signal voltage transfer function for the CMOS differential amplifier of Fig. 5.2-6 with the dashed battery at the output removed is shown in Fig. 5.2-7. The inputs have been applied according to the definitions of Fig. 5.2-1(b). The common-mode input has been fixed at ${2.0}\mathrm{\;V}$ and the differential input has been swept from -1 to +1 V. We note that the differential amplifier can be either inverting or noninverting depending on how the input signal is applied. If ${v}_{\mathrm{{IN}}} = {v}_{GS1} - {v}_{GS2}$ as is the case in Fig. 5.2-6, then the voltage gain from ${v}_{\mathrm{{IN}}}$ to ${v}_{\mathrm{{OUT}}}$ is noninverting.
The regions of operation for the pertinent transistors of Fig. 5.2-6 are shown on Fig. 5.2- 7. We note that the largest small-signal gain occurs when both M2 and M4 are saturated. M2 is saturated when
$$
{v}_{DS2} \geq  {v}_{GS2} - {V}_{TN} \rightarrow  {v}_{\mathrm{{OUT}}} - {\mathrm{V}}_{S1} \geq  {\mathrm{V}}_{IC} - {0.5}{\mathrm{v}}_{ID} - {\mathrm{V}}_{S1} - {\mathrm{V}}_{TN} \tag{5.2-12}
$$
$$
\rightarrow  {v}_{\mathrm{{OUT}}} \geq  {\mathrm{V}}_{IC} - {\mathrm{V}}_{TN}
$$
where we have assumed that the region of transition for $\mathrm{M}2$ is close to ${v}_{ID} = 0\mathrm{\;V}$ . M4 is saturated when
$$
{v}_{SD4} \geq  {v}_{SG4} - \left| {V}_{TP}\right|  \rightarrow  {V}_{DD} - {v}_{\text{OUT }} \geq  {v}_{SG4} - \left| {V}_{TP}\right|  \tag{5.2-13}
$$
$$
\rightarrow  {v}_{\mathrm{{OUT}}} \leq  {V}_{DD} - {v}_{SG4} + \left| {V}_{TP}\right|
$$

Figure 5.2-7 Voltage-transfer curve for the differential amplifier of Fig. 5.2-6.
The regions of operation for M2 and M4 on Fig. 5.2-7 have assumed the $W/L$ values of Fig. 5.2-6 and ${I}_{SS} = {100\mu }\mathrm{A}$ .
The output swing of the differential amplifier of Fig. 5.2-6 could be given by Eq. (5.2-12) for ${v}_{\mathrm{{OUT}}}\left( \min \right)$ and Eq. (5.2-13) for ${v}_{\mathrm{{OUT}}}\left( \max \right)$ . Obviously, the output swing exceeds these values as the magnitude of ${v}_{ID}$ becomes large. We will examine this question in more detail in the next chapter.
Figure 5.2-8 shows a CMOS differential amplifier that uses p-channel MOSFET devices, $\mathrm{M}1$ and $\mathrm{M}2$ , as the differential pair. The circuit operation is identical to that of Fig. 5.2-6. If the CMOS technology is n-well, then the bulks of the input p-channel MOSFET devices can connect either to ${V}_{DD}$ or to their sources assuming that M1 and M2 are fabricated in their own n-well that can float. The same considerations hold for capacitance at the source-coupled node as we discussed previously for the differential amplifier using n-channel MOSFETs as the input transistors.

Figure 5.2-8 CMOS differential amplifier using p-channel input MOSFETs.
Another important characteristic of a differential amplifier is input common-mode range, ICMR. The way that the ICMR is found is to set ${v}_{ID}$ to zero and vary ${v}_{IC}$ until one of the transistors in the differential amplifier is no longer saturated. We can think of this analysis as connecting the inputs together and sweeping the common-mode input voltage. For the differential amplifier of Fig. 5.2-6, the highest common-mode input voltage, ${V}_{IC}\left( \max \right)$ , is found as follows. There are two paths from ${V}_{IC}$ to ${V}_{DD}$ that we must examine. The first is from G1 through M1 and M3 to ${V}_{DD}$ . The second is from G2 through M2 and M4 to ${V}_{DD}$ . For the first path we can write
$$
{V}_{IC}\left( \max \right)  = {V}_{G1}\left( \max \right)  = {V}_{DD} - {V}_{SG3} - {V}_{DS1} + {V}_{GS1} \tag{5.2-14}
$$
The above equation can be rewritten as
$$
{V}_{IC}\left( \max \right)  = {V}_{DD} - {V}_{SG3} + {V}_{TN1} \tag{5.2-15}
$$
The second path can be written as
$$
{V}_{IC}{\left( \max \right) }^{\prime } = {V}_{DD} - {V}_{DS4}\left( \text{sat}\right)  - {V}_{DS2} + {V}_{GS2} = {V}_{DD} - {V}_{DS4}\left( \text{sat}\right)  + {\mathrm{V}}_{TN2} \tag{5.2-16}
$$
Since the second path allows a higher value of ${V}_{IC}\left( \max \right)$ , we will select the first path from a worst-case viewpoint. Thus, the maximum input common-mode voltage for Fig. 5.2-6 is equal to the power supply voltage minus the drop across M3 plus the threshold voltage of M1. If we want to increase the positive limit of ${V}_{IC}$ , we will need to select a load circuit that is different from the current mirror.
The lowest input voltage at the gate of M1 (or M2) is found to be
$$
{V}_{IC}\left( \min \right)  = {V}_{SS} + {V}_{DS5}\left( \mathrm{{sat}}\right)  + {V}_{GS1} = {V}_{SS} + {V}_{DS5}\left( \mathrm{{sat}}\right)  + {V}_{GS2} \tag{5.2-17}
$$
We assume that ${V}_{GS1}$ and ${V}_{GS2}$ will be equal during changes in the input common-mode voltage. Equations (5.2-15) and (5.2-17) are important when it comes to the design of a differential amplifier. For example, if the maximum and minimum input common-mode voltages are specified and the dc bias currents are known, then these equations can be used to design the value of $W/L$ for the various transistors involved. The value of ${W}_{3}/{L}_{3}$ will determine the value of ${V}_{IC}\left( \max \right)$ while the values of ${W}_{1}/{L}_{1}\left( {{W}_{2}/{L}_{2}}\right)$ and ${W}_{5}/{L}_{5}$ will determine the value of ${V}_{IC}\left( \min \right)$ . We will use these equations in later chapters to design the $W/L$ values of some of the transistors of the differential amplifier.
To design the differential amplifier to meet a specified negative common-mode range, the designer must consider the worst-case ${V}_{T}$ spread (specified by the process) and adjust ${I}_{SS}$ and ${\beta }_{3}$ to meet the requirements. The worst-case ${V}_{T}$ spread affecting positive common-mode range for the configuration of Fig. 5.2-6 is a high p-channel threshold magnitude $\left( \left| {V}_{T03}\right| \right)$ and a low n-channel threshold $\left( {V}_{T01}\right)$ .
An improvement can be obtained when the substrates of the input devices are connected to ground. This connection results in negative feedback to the sources of the input devices. For example, as the common-source node moves positive, the substrate bias increases, resulting in an increase in the threshold voltages $\left( {V}_{T1}\right.$ and $\left. {V}_{T2}\right)$ . Equation (5.2-15) shows that the positive common-mode range will increase as the magnitude of ${V}_{T1}$ increases.
A similar analysis can be used to determine the common-mode voltage range possible for the p-channel input differential amplifier of Fig. 5.2-8 (see Problem P5.2-3).
---
Example 5.2-1
---
## Calculation of the Worst-Case Input Common-Mode Range of the n-Channel Input, Differential Amplifier
Assume that ${V}_{DD}$ varies from 4 to $6\mathrm{\;V}$ and that ${V}_{SS} = 0$ , and use the values of Table 3.1-2 under worst-case conditions to calculate the input common-mode range of Fig. 5.2-6. Assume that ${I}_{SS}$ is ${100\mu }\mathrm{A},{W}_{1}/{L}_{1} = {W}_{2}/{L}_{2} = 5,{W}_{3}/{L}_{3} = {W}_{4}/{L}_{4} = 1$ , and ${V}_{DS5}\left( \text{sat}\right)  = {0.2}\mathrm{\;V}$ . Include worst-case variation in ${K}^{\prime }$ in your calculations.
SOLUTION
If ${V}_{DD}$ varies $5 \pm  1\mathrm{\;V}$ , then Eq. (5.2-15) gives
$$
{V}_{IC}\left( \max \right)  = 4 - \left( {\sqrt{\frac{2 \cdot  {50\mu }\mathrm{A}}{{45\mu }\mathrm{A}/{\mathrm{V}}^{2} \cdot  1}} + {0.85}}\right)  + {0.55} = 4 - {2.34} + {0.55} = {2.21}\mathrm{\;V}
$$
and Eq. (5.2-17) gives
$$
{V}_{G1}\left( \min \right)  = 0 + {0.2} + \left( {\sqrt{\frac{2 \cdot  {50\mu }\mathrm{A}}{{90\mu }\mathrm{A}/{\mathrm{V}}^{2} \cdot  5}} + {0.85}}\right)  = {0.2} + {1.30} = {1.50}\mathrm{\;V}
$$
which gives a worst-case input common-mode range of ${0.71}\mathrm{\;V}$ with a nominal $5\mathrm{\;V}$ power supply.
Reducing ${V}_{DD}$ by several volts more will result in a worst-case common-mode range of zero. We have assumed in this example that all bulk-source voltages are zero.
## Small-Signal Analysis
The small-signal analysis of the differential amplifier of Fig. 5.2-6 can be accomplished with the assistance of the model (ignoring body effect) shown in Fig. 5.2-9(a). This model can be simplified to that shown in Fig. 5.2-9(b) and is only appropriate for differential analysis when both sides of the amplifier are assumed to be perfectly matched.* If this condition is satisfied, then the point where the two sources of M1 and M2 are connected can be considered to be at ac ground. If we assume that the differential stage is unloaded, then with the output shorted to ac ground, the differential-transconductance gain can be expressed as
$$
{i}_{\text{out }}^{\prime } = \frac{{g}_{m1}{g}_{m3}{r}_{p1}}{1 + {g}_{m3}{r}_{p1}}{v}_{gs1} - {\mathrm{g}}_{m2}{v}_{gs2} \tag{5.2-18}
$$

Figure 5.2-9 Small-signal model for the CMOS differential amplifier. (a) Exact model. (b) Simplified equivalent model.
or
$$
{i}_{\text{out }}^{\prime } \cong  {g}_{m1}{v}_{gs1} - {g}_{m2}{v}_{gs2} = {g}_{md}{v}_{id} \tag{5.2-19}
$$
where ${g}_{m1} = {g}_{m2} = {g}_{md},{r}_{p1} = {r}_{ds1}\parallel {r}_{ds3}$ , and ${i}_{\text{out }}^{\prime }$ designates the output current into a short circuit.
The unloaded differential voltage gain can be determined by finding the small-signal output resistance of the differential amplifier. It is easy to see that ${r}_{\text{out }}$ is
$$
{r}_{\text{out }} = \frac{1}{{g}_{ds2} + {g}_{ds4}} \tag{5.2-20}
$$
Therefore, the voltage gain is given as the product of ${g}_{md}$ and ${r}_{\text{out }}$ :
$$
{A}_{v} = \frac{{v}_{\text{out }}}{{v}_{id}} = \frac{{g}_{md}}{{g}_{ds2} + {g}_{ds4}} \tag{5.2-21}
$$
If we assume that all transistors are in saturation and we replace the small-signal parameters of ${g}_{m}$ and ${r}_{ds}$ in terms of their large-signal model equivalents, we achieve
$$
{A}_{v} = \frac{{v}_{\text{out }}}{{v}_{\text{id }}} = \frac{{\left( {K}_{1}^{\prime }{I}_{SS}{W}_{1}/{L}_{1}\right) }^{1/2}}{\left( {{\lambda }_{2} + {\lambda }_{4}}\right) \left( {{I}_{SS}/2}\right) } = \frac{2}{{\lambda }_{2} + {\lambda }_{4}}{\left( \frac{{K}_{1}^{\prime }{W}_{1}}{{I}_{SS}{L}_{1}}\right) }^{1/2} \tag{5.2-22}
$$
Again we note the dependence of the small-signal gain on the inverse of ${I}_{SS}^{1/2}$ similar to that of the inverter. This relationship is in fact valid until ${I}_{SS}$ approaches subthreshold values. Assuming that ${W}_{1}/{L}_{1} = {2\mu }\mathrm{m}/{1\mu }\mathrm{m}$ and that ${I}_{SS} = {10\mu }\mathrm{A}$ , the small-signal voltage gain of the n-channel differential amplifier is 52 . The small-signal gain of the p-channel differential amplifier under the same conditions is 35 . This difference is due to the mobility difference between n-channel and p-channel MOSFETs.
The common-mode gain of the CMOS differential amplifiers shown in Fig. 5.2-6 is ideally zero. This is because the current-mirror load rejects any common-mode signal. The fact that a common-mode response might exist is due to the mismatches in the differential amplifier. These mismatches consist of a nonunity current gain in the current mirror and geometrical mismatches between M1 and M2 (see Section 4.4). In order to demonstrate how to analyze the small-signal, common-mode voltage gain of the differential amplifier, consider the differential amplifier shown in Fig. 5.2-10, which uses MOS diodes M3 and M4 as the load.
---
*It can be shown that the current mirror causes this assumption to be invalid because the drain loads of M1 and M2 are not matched. However, we will continue to use the assumption regardless.
---

Figure 5.2-10 Illustration of the simplications of the differential amplifier for small-signal, differential-mode, and common-mode analysis.
The differential amplifier of Fig. 5.2-10 is an excellent opportunity to illustrate the differences between the small-signal differential-mode and common-mode analyses. If the input transistors (M1 and M2) of the differential amplifier of Fig. 5.2-10 are matched, then for differential-mode analysis, the common source point can be ac grounded and the differential signal applied equally, but opposite to both M1 and M2 as shown by the left-half circuit of Fig. 5.2-10. For the small-signal, common-mode analysis, the current sink, ${I}_{SS}$ , can be divided into two parallel circuits with a current of ${0.5}{I}_{SS}$ and output resistance of $2{r}_{ds5}$ with the common-mode input voltage applied to both gates of M1 and M2. This equivalent circuit is shown in the right-hand circuit of Fig. 5.2-10.
The small-signal, differential-mode analysis of Fig. 5.2-10 is identical with the small-signal analysis of Fig. 5.1-3 except the input is reduced by a factor of 2. Thus, the small-signal, differential-mode voltage gain of Fig. 5.2-10 is given as
$$
\frac{{v}_{o1}}{{v}_{id}} =  - \frac{{g}_{m1}}{2{g}_{m3}} \tag{5.2-23}
$$
or
$$
\frac{{v}_{o2}}{{v}_{id}} =  + \frac{{g}_{m2}}{2{g}_{m4}} \tag{5.2-24}
$$
We see that the small-signal, differential-mode voltage gain of Fig. 5.2-10 is half of the small-signal voltage gain of the active load inverter. The reason is that, in Fig. 5.2-10, the input signal is divided half to M1 and half to M2.
The small-signal, common-mode voltage gain is found from the circuit at the right side of Fig. 5.2-10. Because we have not analyzed a circuit like this before, let us redraw this circuit in the small-signal model form of Fig. 5.2-11 (ignoring body effect). Note that $2{r}_{ds5}$ represents the small-signal output resistance of M5 $\times  {0.5}$ transistor. (If the dc current is decreased by one-half, the small-signal output resistance will be increased by a factor of 2.)

Figure 5.2-11 Small-signal model for common-mode analysis of Fig. 5.2-10.
The circuit of Fig. 5.2-11 is much simpler to analyze if we assume that ${r}_{ds1}$ is large and can be ignored. Under this assumption, we can write that
$$
{v}_{gs1} = {v}_{ic} - 2{g}_{m1}{r}_{ds5}{v}_{gs1} \tag{5.2-25}
$$
Solving for ${v}_{gs1}$ gives
$$
{v}_{gs1} = \frac{{v}_{ic}}{1 + 2{g}_{m1}{r}_{ds5}} \tag{5.2-26}
$$
The single-ended output voltage, ${v}_{o1}$ , as a function of ${v}_{ic}$ can be written as
$$
\frac{{v}_{o1}}{{v}_{ic}} =  - \frac{{g}_{m1}\left\lbrack  {{r}_{ds3}\parallel \left( {1/{g}_{m3}}\right) }\right\rbrack  }{1 + 2{g}_{m1}{r}_{ds5}} \approx   - \frac{\left( {g}_{m1}/{g}_{m3}\right) }{1 + 2{g}_{m1}{r}_{ds5}} \approx   - \frac{{g}_{ds5}}{2{g}_{m3}} \tag{5.2-27}
$$
Ideally, the common-mode gain should be zero. We see that if ${r}_{ds5}$ is large, the common-mode gain is reduced.
The common-mode rejection ratio (CMRR) can be found by the magnitude of the ratio of Eqs. (5.2-23) and (5.2-27) and is
$$
\text{ CMRR } = \frac{{g}_{m1}/2{g}_{m3}}{{g}_{ds5}/2{g}_{m3}} = {g}_{m1}{r}_{ds5} \tag{5.2-28}
$$
This is an important result and shows how to increase the CMRR. Obviously, the easiest way to increase the CMRR of Fig. 5.2-10 would be to use a cascode current sink in place of M5. This would increase the CMRR by a factor of ${g}_{m}{r}_{ds}$ at a cost of decreased ICMR.
The frequency response of the CMOS differential amplifier is due to the various parasitic capacitors at each node of the circuit. The parasitic capacitors associated with the CMOS differential amplifier are shown as the dotted capacitors in Fig. 5.2-9(b). ${C}_{1}$ consists of ${C}_{gd1}$ , ${C}_{bd1},{C}_{bd3},{C}_{gs3}$ , and ${C}_{gs4}.{C}_{2}$ consists of ${C}_{bd2},{C}_{bd4},{C}_{gd2}$ , and any load capacitance ${C}_{L}.{C}_{3}$ consists only of ${C}_{gd4}$ . In order to simplify the analysis, we shall assume that ${C}_{3}$ is approximately zero. In most applications of the differential amplifier, this assumption turns out to be valid. With ${C}_{3}$ approximately zero, the differential-mode analysis of Fig. 5.2-9(b) is straightforward. The voltage-transfer function can be written as
$$
{V}_{\text{out }}\left( s\right)  \cong  \frac{{g}_{m1}}{{g}_{ds2} + {g}_{ds4}}\left\lbrack  {\left( \frac{{g}_{m3}}{{g}_{m3} + s{C}_{1}}\right) {V}_{gs1}\left( s\right)  - {V}_{gs2}\left( s\right) }\right\rbrack  \left( \frac{{\omega }_{2}}{s + {\omega }_{2}}\right)  \tag{5.2-29}
$$
where ${\omega }_{2}$ is given as
$$
{\omega }_{2} = \frac{{g}_{ds2} + {g}_{ds4}}{{C}_{2}} \tag{5.2-30}
$$
If we further assume that
$$
\frac{{g}_{m3}}{{C}_{1}} \gg  \frac{{g}_{ds2} + {g}_{ds4}}{{C}_{2}} \tag{5.2-31}
$$
then the frequency response of the differential amplifier reduces to
$$
\frac{{V}_{\text{out }}\left( s\right) }{{V}_{id}\left( s\right) } \cong  \left( \frac{{g}_{m1}}{{g}_{ds2} + {g}_{ds4}}\right) \left( \frac{{\omega }_{2}}{s + {\omega }_{2}}\right)  \tag{5.2-32}
$$
Thus, the first-order analysis of the frequency response of the differential amplifier consists of a single pole at the output given by $- \left( {{g}_{ds2} + {g}_{ds4}}\right) /{C}_{2}$ . In the above analysis, we have ignored the zeros that occur due to ${C}_{gd1},{C}_{gd2}$ , and ${C}_{gd4}$ . We shall consider the frequency response of the differential amplifier in more detail when we consider the op amp.
## An Intuitive Method of Small-Signal Analysis
Understanding and designing analog circuits requires an excellent grasp of small-signal analysis. Small-signal analysis is used so often in analog circuits that it becomes desirable to find faster ways of performing this analysis on circuits. In CMOS analog circuits, a simpler method of making a small-signal analysis exists. We will call this method intuitive analysis. The method is based on the schematics of CMOS circuits and does not require redrawing a small-signal model. It focuses on the ac changes superimposed on dc variables. The technique identifies the transistor or transistors that convert input voltage to current. We will call these transistors the transconductance transistors. The currents that the transconductance transistors create are traced to where they flow into a resistance to ac ground. Multiplying this resistance by the current gives the voltage at this node. The method is quick and can be used to check a small-signal analysis using the small-signal model.
Let us illustrate the method on the differential amplifier of Fig. 5.2-6. Figure 5.2-12 repeats the differential amplifier of Fig. 5.2-6 with the ac voltages and currents identified. Note that ac currents can flow against the dc current. This simply means that the actual current is decreasing but not changing direction.
From Fig. 5.2-12, for differential-mode operation, we see that the ac currents in M1 and M2 are ${0.5}{g}_{m1}{v}_{id}$ and $- {0.5}{g}_{m2}{v}_{id}$ . The current ${0.5}{g}_{m1}{v}_{id}$ flows into the mirror consisting of M3 and M4 and is replicated at the output of the mirror as ${0.5}{g}_{m1}{v}_{id}$ . Thus, the sum of the ac currents flowing toward the output node (drains of M2 and M4) is ${g}_{m1}{v}_{id}$ or ${g}_{m2}{v}_{id}$ . If we recall that the output resistance of this differential amplifier is the parallel combination of ${r}_{ds2}$ and ${r}_{ds4}$ , then the output voltage can be written by inspection as
$$
{v}_{\text{out }} = \left( {{g}_{m1}{v}_{id}}\right) \left( {r}_{\text{out }}\right)  = \left( \frac{{g}_{m1}}{{g}_{ds2} + {g}_{ds4}}\right) {v}_{id} \tag{5.2-33}
$$
This calculation gives the small-signal, differential-mode voltage gain derived in Eq. (5.2-21) if ${g}_{md} = {g}_{m1} = {g}_{m2}$ .

Figure 5.2-12 Intuitive analysis of the CMOS differential amplifier of Fig. 5.2-6.
The intuitive small-signal analysis method illustrated above becomes very powerful if we will recall several things we have already learned. One is that the small-signal output resistance of the cascode configuration is approximately equal to the ${r}_{ds}$ of the common-source transistor multiplied by the ${g}_{m}{r}_{ds}$ of the common-gate transistor. This relationship is expressed as
$$
{r}_{\text{out }}\left( \text{ cascode }\right)  \approx  {r}_{ds}\text{ (common-source) } \times  {g}_{m}{r}_{ds}\text{ (common-gate) } \tag{5.2-34}
$$
In addition to this relationship, it is useful to examine the situation in Fig. 5.2-11, where the source of the transconductance transistor has a resistance connected from the source to ground. In this case, we can use Eq. (5.2-26) to show that the effective transconductance, ${g}_{m}\left( \text{eff}\right)$ , is given by
$$
{g}_{m}\left( \text{ eff }\right)  = \frac{{\mathrm{g}}_{m}}{1 + {g}_{m}R} \tag{5.2-35}
$$
where ${g}_{m}$ is the transconductance of the transistor and $R$ is the small-signal resistance connected from the source to ground. In the case of Eq. (5.2-26), $R = 2{r}_{ds5}$ and ${g}_{m} = {g}_{m1}$ . With Eqs. (5.2-34) and (5.2-35), the designer will be able to apply the intuitive approach to nearly all of the circuits that will be encountered in the remainder of this text. The intuitive approach is not useful for determining the small-signal frequency response although some aspects of it can be used (the poles in a MOSFET circuit are typically equal to the reciprocal product of the ac resistance from a node to ac ground times the capacitance connected to that node).
## Slew Rate and Noise
The slew-rate performance of the CMOS differential amplifier depends on the value of ${I}_{SS}$ and the capacitance from the output node to ac ground. Slew rate(SR)is defined as the maximum output-voltage rate, either positive or negative. Since the slew rate in the CMOS differential amplifier is determined by the amount of current that can be sourced or sunk into the output/ compensating capacitor, we find that the slew rates of the CMOS differential amplifiers of Figs. 5.2-6 and 5.2-8 are given by
$$
\text{Slew rate} = {I}_{SS}/C \tag{5.2-36}
$$
where $C$ is the total capacitance connected to the output node. For example, if ${I}_{SS} = {10\mu }\mathrm{A}$ and $C = 5\mathrm{{pF}}$ , the slew rate is found to be $2\mathrm{\;V}/\mu \mathrm{s}$ . The value of ${I}_{SS}$ must be increased to increase the slew-rate capability of the differential amplifier.
The noise performance of the CMOS differential amplifier can be due to both thermal and $1/f$ noise. Depending on the frequency range of interest, one source can be neglected in favor of the other. At low frequencies $1/f$ noise is important, whereas at high frequencies/low currents, thermal noise is important. Figure 5.2-13(a) shows the p-channel differential amplifier with equivalent-noise voltage sources shown at the input of each device. The equivalent-noise voltage sources are those given in Eq. (3.2-13) with the noise of ${I}_{DD}$ ignored. In this case we solve for the total output-noise current ${i}_{to}^{2}$ at the output of the circuit. Furthermore, let us assume that the output is shorted to ground to simplify calculations. The total output-noise current is found by summing each of the noise-current contributions to get
$$
{i}_{to}^{2} = {g}_{m1}^{2}{e}_{n1}^{2} + {g}_{m2}^{2}{e}_{n2}^{2} + {g}_{m3}^{2}{e}_{n3}^{2} + {g}_{m4}^{2}{e}_{n4}^{2} \tag{5.2-37}
$$
Since the equivalent output-noise current is expressed in terms of the equivalent input-noise voltage, we may use
$$
{i}_{to}^{2} = {g}_{m1}^{2}{e}_{\mathrm{{eq}}}^{2} \tag{5.2-38}
$$
to get
$$
{e}_{\mathrm{{eq}}}^{2} = {e}_{n1}^{2} + {e}_{n2}^{2} + {\left( \frac{{g}_{m3}}{{g}_{m1}}\right) }^{2}\left\lbrack  {{e}_{n3}^{2} + {e}_{n4}^{2}}\right\rbrack   \tag{5.2-39}
$$
We assume that ${g}_{m1} = {g}_{m2}$ and ${g}_{m3} = {g}_{m4}$ in the above. The resulting noise model is shown in Fig. 5.2-13(b).

Figure 5.2-13 (a) Noise model of a p-channel differential amplifier with equivalent-noise voltage sources at the input of each transistor. (b) Equivalent-noise model for (a).
Assuming that ${e}_{n1} = {e}_{n2},{e}_{n3} = {e}_{n4}$ substituting Eq. (3.2-15) into Eq. (5.2-39) results in
$$
{e}_{\mathrm{{eq}}}\left( {1/f}\right)  = \sqrt{\frac{2{B}_{p}}{f{W}_{1}{L}_{1}}}\sqrt{1 + \left( \frac{{K}_{N}^{\prime }{B}_{N}}{{K}_{P}^{\prime }{B}_{P}}\right) {\left( \frac{{L}_{1}}{{L}_{3}}\right) }^{2}}\left( {\mathrm{V}/\sqrt{\mathrm{{Hz}}}}\right)  \tag{5.2-40}
$$
which is the equivalent-input $1/f$ noise for the differential amplifier. By substituting the thermal noise relationship into Eq. (5.2-39) the equivalent-input thermal noise is seen to be
$$
{e}_{\mathrm{{eq}}\left( {th}\right) } = \sqrt{\frac{16kT}{3{\left\lbrack  2{K}_{P}^{\prime }{I}_{1}\left( {W}_{1}/{L}_{1}\right) \right\rbrack  }^{1/2}}}\sqrt{1 + \sqrt{\frac{{K}_{N}^{\prime }\left( {{W}_{3}/{L}_{3}}\right) }{{K}_{P}^{\prime }\left( {{W}_{1/}{L}_{1}}\right) }}}\left( {\mathrm{V}/\sqrt{\mathrm{{Hz}}}}\right)  \tag{5.2-41}
$$
If the load device length is much larger than that of the gain device, then the input-referred $1/f$ noise is determined primarily by the contribution of the input devices. Making the aspect ratio of the input device much larger than that of the load device ensures that the total thermal noise contribution is dominated by the input devices.
## Current-Source Load Differential Amplifier
Another configuration of interest to us is the CMOS differential amplifier that uses current-source loads. This configuration is shown in Fig. 5.2-14. It has the advantage of a larger input common-mode range voltage because M3 is no longer connected in the diode configuration. It can be shown that the differential-in, differential-out $\left( {{v}_{3} - {v}_{4}}\right)$ small-signal voltage gain is the same as that of Fig. 5.2-6. However, if the output voltage is taken at ${v}_{3}$ or ${v}_{4}$ , the small-signal voltage gain is half that of Fig. 5.2-6.
The differential amplifier of Fig. 5.2-14 presents a challenge that is not immediately obvious. Note that ${I}_{\mathrm{{BIAS}}}$ defines the currents in M3 and M4 as well as the current in M5. It is likely that these currents will not be exactly equal. What will happen in this case? In general, if a dc current flows through both a PMOS transistor and an NMOS transistor, the transistor with the larger dc current will become active. This is because the only way the currents can match is for the larger current to reduce, as shown in Fig. 5.2-15. The only way this can be done is to leave the saturation region. So, if ${I}_{3}$ is greater than ${I}_{1}$ , then M1 is saturated and M3 is active and vice versa.
How then can one use the current source as a load for the differential amplifier? The answer is found in knowing what is causing the problem. We have seen above that when the currents are not balanced the outputs of the differential amplifier will increase or decrease. The key to solving this problem is to note that both outputs will increase or decrease. Therefore, if we can provide a common-mode feedback scheme, we will be able to stabilize the common-mode output voltages of the differential amplifier while allowing the differential-mode output voltage to be determined by the differential input to the amplifier.

Figure 5.2-14 A current-source load, differential amplifier.

Figure 5.2-15 Illustration of influence of unequal drain currents in Fig. 5.2-14. (a) ${I}_{1} > {I}_{3}$ . (b) ${I}_{3} > {I}_{1}$ .
Figure 5.2-16 shows how common-mode feedback can be used to stabilize the common-mode output voltage ${v}_{3}$ and ${v}_{4}$ of Fig. 5.2-14. In this circuit, the average value of ${v}_{3}$ and ${v}_{4}$ is compared with ${V}_{CM}$ , and the currents in M3 and M4 are adjusted until the average of ${v}_{3}$ and ${v}_{4}$ is equal to ${V}_{CM}$ . Because the common-mode feedback circuit is forcing the average to equal ${V}_{CM}$ , the difference between ${v}_{3}$ and ${v}_{4}$ is ignored. For example, if ${v}_{3}$ and ${v}_{4}$ increase together (their average increases), the gate of MC2 increases, causing ${I}_{C3}$ to decrease and thus ${I}_{3}$ and ${I}_{4}$ to decrease. This causes ${v}_{3}$ and ${v}_{4}$ to decrease as desired. Normally, the common-mode feedback is taken from the final output of a differential amplifier where there is sufficient drive capability to handle the resistive load due to ${R}_{CM1}$ and ${R}_{CM2}$ . Nevertheless, these resistors must be large enough so as not to degrade performance in the differential signal path. The topic of common-mode feedback will be explored in much more detail in Section 7.3.
## Large-Signal Performance of the Differential Amplifier
In many cases, large signals are applied differentially to the differential amplifier. Assuming the differential amplifier is given in Fig. 5.2-6, the output current as a function of the input is given in Fig. 5.2-17(a). When the differential amplifier is used in the large-signal mode, generally the designer would like to have the output current become a linear function of the

Figure 5.2-16 Use of common-mode output voltage feedback to stabilize the bias currents of Fig. 5.2-14.

Figure 5.2-17 (a) Transconductance characteristic of Fig. 5.2-6. (b) Linearization of the transconductance characteristic.
differential input voltage as shown in Fig. 5.2-17(b). One of the ways to linearize the relationship between the output current and the differential input voltage is to degenerate the differential amplifier by separating the sources by a resistor. Figure 5.2-18 shows two ways of doing this. It can be shown that effective transconductance of the differential amplifiers in Fig. 5.2-18 is
$$
{g}_{m}\left( \mathrm{{eff}}\right)  = \frac{{i}_{OUT}}{{v}_{IN}} = \frac{{g}_{m}}{2 + {g}_{m}{R}_{S}} \tag{5.2-42}
$$
As ${g}_{m}{R}_{S} \gg  2$ , the effective transconductance becomes $1/{R}_{S}$ .
Although the linearization of the differential amplifier would be the same for both Figs. 5.2-18(a) and 5.2-18(b), there is an important difference in the two circuits. In Fig. 5.2-18(a), the current through M1 and M2 flows through the resistors, causing a voltage drop in series with these transistors. In Fig. 5.2-18(b), there is no quiescent current that flows through the degeneration resistor and therefore it is more attractive if the power supplies are not large.
If the degeneration resistor becomes large, then it may be more attractive to replace the resistor with the equivalents of Section 4.2 using MOSFETs. Figure 5.2-19 shows two possibilities. The MOSFETs replacing the degenerating resistors are operating in the triode region. M6 and M7 of Fig. 5.2-19(b) were illustrated in Problem 4.2-1.
## Design of a CMOS Differential Amplifier with a Current-Mirror Load
In addition to analyzing the various CMOS circuits and understanding how they work, it is important to go to the next step, which is design. In CMOS circuit design, like any other design, it is important to select the appropriate relationships that connect the design specifications to the design parameters. The design in most CMOS circuits consists of an architecture represented by a schematic, $W/L$ values, and dc currents. In the differential amplifier of Fig. 5.2-6, the design parameters are the $W/L$ values of M1 through M5 and the current in M5, ${I}_{5}$ . $\left( {V}_{\text{BIAS }}\right.$ is an external voltage that defines ${I}_{5}$ and generally is replaced by the input of a current mirror.)

Figure 5.2-18 Two different ways of degenerating the differential amplifier.

Figure 5.2-19 Implementation of RS of Fig. 5.2-18(b). (a) Single MOSFET in triode region. (b) Parallel MOSFET implementation of ${R}_{S}$ with both MOSFETs in the triode region.
The starting point of design consists of two types of information. One is the design constraints such as the power supply, the technology, and the temperature. The other type of information is the specifications. The specifications for the differential amplifier of Fig. 5.2-6 might consist of:
- Small-signal gain, ${A}_{v}$
- Frequency response for a given load capacitance, ${\omega }_{-3\mathrm{{dB}}}$
- Input common-mode range (ICMR) or maximum and minimum input common-mode voltage $\left\lbrack  {{V}_{IC}\left( \max \right) \text{and}{V}_{IC}\left( \min \right) }\right\rbrack$
- Slew rate for a given load capacitance, ${SR}$
- Power dissipation, ${P}_{\text{diss }}$
The design is implemented with the relationships that describe the specifications and the use of these relationships to solve for the dc currents and $W/L$ values of all transistors. The appropriate relationships for Fig. 5.2-6 are summarized below.
$$
{A}_{v} = {g}_{m1}{R}_{\text{out }} \tag{5.2-43}
$$
$$
{\omega }_{-3\mathrm{{dB}}} = \frac{1}{{R}_{\text{out }}{C}_{L}} \tag{5.2-44}
$$
$$
{V}_{IC}\left( \max \right)  = {V}_{DD} - {V}_{SG3} + {V}_{TN1} \tag{5.2-45}
$$
$$
{V}_{IC}\left( \min \right)  = {V}_{DS5}\left( \text{sat}\right)  + {V}_{GS1} = {V}_{DS5}\left( \text{sat}\right)  + {V}_{GS2} \tag{5.2-46}
$$
$$
{SR} = {I}_{5}/{C}_{L} \tag{5.2-47}
$$
and
$$
{P}_{\text{diss }} = \left( {{V}_{DD} + \left| {V}_{SS}\right| }\right) \left( {I}_{5}\right)  = \left( {{V}_{DD} + \left| {V}_{SS}\right| }\right) \left( {{I}_{3} + {I}_{4}}\right)  \tag{5.2-48}
$$

Figure 5.2-20 Design relationships for the differential amplifier of Fig. 5.2-6.
Figure 5.2-20 illustrates the relationships that are typically used to design the various parameters of the current-mirror load differential amplifier. From this figure, a design procedure can be developed and is summarized in Table 5.2-1.
## Table 5.2-1 Current-Mirror Load Differential Amplifier Design Procedure
This design procedure assumes that the small-signal differential voltage gain, ${A}_{v}$ ; the $- 3\mathrm{\;{dB}}$ frequency, ${\omega }_{-3\mathrm{\;{dB}}}$ ; the maximum input common mode voltage, ${V}_{IC}\left( \max \right)$ ; the minimum common mode voltage, ${V}_{IC}\left( \min \right)$ ; the slew rate, ${SR}$ ; and the power dissipation, ${\mathrm{P}}_{\text{diss }}$ , are given.
(1) Choose ${I}_{5}$ to satisfy the slew rate knowing ${C}_{L}$ or the power dissipation, ${P}_{\text{diss }}$ .
(2) Check to see if ${R}_{\text{out }}$ will satisfy the frequency response and if not, change ${I}_{5}$ or modify the circuit (choose a different topology).
(3) Design ${W}_{3}/{L}_{3}\left( {{W}_{4}/{L}_{4}}\right)$ to satisfy the upper ICMR.
(4) Design ${W}_{1}/{L}_{1}\left( {{W}_{2}/{L}_{2}}\right)$ to satisfy the small-signal differential voltage gain, ${A}_{v}$ .
(5) Design ${W}_{5}/{L}_{5}$ to satisfy the lower ICMR.
(6) Iterate where necessary.
---
Example 5.2-2
---
## Design of a Current-Mirror Load Differential Amplifier
Design the currents and $W/L$ values of the current-mirror load differential amplifier of Fig. 5.2-6 to satisfy the following specifications: ${V}_{DD} =  - {V}_{SS} = {2.5}\mathrm{\;V},{SR} \geq  {10}\mathrm{\;V}/\mu \mathrm{s}\left( {{C}_{L} = 5\mathrm{{pF}}}\right)$ , ${f}_{-3\mathrm{\;{dB}}} \geq  {100}\mathrm{{kHz}}\left( {{C}_{L} = 5\mathrm{{pF}}}\right)$ , a small-signal differential voltage gain of ${100}\mathrm{\;V}/\mathrm{V}, - {1.5}\mathrm{\;V} \leq$ ICMR $\leq  2\mathrm{\;V}$ , and ${P}_{\text{diss }} \leq  1\mathrm{\;{mW}}$ . Use the model parameters of ${K}_{N}^{\prime } = {110\mu }\mathrm{A}/{\mathrm{V}}^{2},{K}_{P}^{\prime } =$ ${50\mu }\mathrm{A}/{\mathrm{V}}^{2},{V}_{TN} = {0.7}\mathrm{\;V},{V}_{TP} =  - {0.7}\mathrm{\;V},{\lambda }_{N} = {0.04}{\mathrm{\;V}}^{-1}$ , and ${\lambda }_{P} = {0.05}{\mathrm{\;V}}^{-1}$ .
## SOLUTION
1. To meet the slew rate, ${I}_{5} \geq  {50\mu }\mathrm{A}$ . For maximum ${P}_{\text{diss }},{I}_{5} \leq  {200\mu }\mathrm{A}$ .
2. An ${f}_{-3\mathrm{\;{dB}}}$ of ${100}\mathrm{{kHz}}$ implies that ${R}_{\text{out }} \leq  {318}\mathrm{k}\Omega .{R}_{\text{out }}$ can be expressed as
$$
{R}_{\text{out }} = \frac{2}{\left( {{\lambda }_{N} + {\lambda }_{P}}\right) {I}_{5}} \leq  {318}\mathrm{\;k}\Omega
$$
which gives ${I}_{5} \geq  {70\mu }\mathrm{A}$ . Therefore, we will pick ${I}_{5} = {100\mu }\mathrm{A}$ .
3. The maximum input common-mode voltage gives
$$
{V}_{SG3} = {V}_{DD} - {V}_{IC}\left( \max \right)  + {V}_{TN1} = {2.5} - 2 + {0.7} = {1.2}\mathrm{\;V}
$$
Therefore, we can write
$$
{V}_{SG3} = {1.2}\mathrm{\;V} = \sqrt{\frac{2 \cdot  {50\mu }\mathrm{A}}{\left( {{50\mu }\mathrm{A}/{\mathrm{V}}^{2}}\right) \left( {{W}_{3}/{L}_{3}}\right) }} + {0.7}
$$
Solving for ${W}_{3}/{L}_{3}$ gives
$$
\frac{{W}_{3}}{{L}_{3}} = \frac{{W}_{4}}{{L}_{4}} = \frac{2}{{\left( {0.5}\right) }^{2}} = 8
$$
4. The small-signal gain specification gives
$$
{100}\mathrm{\;V}/\mathrm{V} = {g}_{m1}{R}_{\text{out }} = \frac{{g}_{m1}}{{g}_{ds2} + {g}_{ds4}} = \frac{\sqrt{\left( {2 \cdot  {110\mu }\mathrm{A}/{\mathrm{V}}^{2}}\right) \left( {{W}_{1}/{L}_{1}}\right) }}{\left( {{0.04} + {0.05}}\right) \sqrt{{50\mu }\mathrm{A}}} = {23.31}\sqrt{{W}_{1}/{L}_{1}}
$$
Solving for ${W}_{1}/{L}_{1}$ gives
$$
\frac{{W}_{1}}{{L}_{1}} = \frac{{W}_{2}}{{L}_{2}} = {18.4}
$$
5. Using the minimum input common-mode voltage gives
$$
{V}_{DS}\left( \text{sat}\right)  = {V}_{IC}\left( \min \right)  - {V}_{SS} - {V}_{GS1} =  - {1.5} + {2.5} - \sqrt{\frac{2 \cdot  {50\mu }\mathrm{A}}{{110\mu }\mathrm{A}/{\mathrm{V}}^{2}\left( {18.4}\right) }} - {0.7}
$$
$$
= {0.3} - {0.222} - {0.0777}\mathrm{\;V}
$$
This value of ${V}_{DS5}$ (sat) gives a ${W}_{5}/{L}_{5}$ of
$$
\frac{{W}_{5}}{{L}_{5}} = \frac{2{I}_{5}}{{K}_{N}^{\prime }{V}_{DS}{\left( \text{ sat }\right) }^{2}} = {301}
$$
We should probably increase ${W}_{1}/{L}_{1}$ to reduce ${V}_{GS1}$ , to allow for a variation in ${V}_{TN}$ . Therefore, select ${W}_{1}/{L}_{1}\left( {{W}_{2}/{L}_{2}}\right)  = {40}$ , which gives ${W}_{5}/{L}_{5} = {82}$ . The small-signal gain will increase to ${147}\mathrm{\;V}/\mathrm{V}$ , which should be okay.
Most of the useful configurations of the CMOS differential amplifier have been presented in this section. In later chapters we will show how to increase the gain, reduce the noise, and increase the bandwidth, as well as other performance enhancements of interest. The CMOS differential amplifier is widely used as the input stage to amplifiers and comparators. It has the feature of relying on matching for good performance, which is compatible with IC technology.

### 5.3 Cascode Amplifiers
The cascode amplifier has two distinct advantages over the inverting amplifiers of Section 5.1. First, it provides a higher output impedance similar to the cascode current sink of Fig. 4.3-4 and the cascode current mirror of Fig. 4.4-6. Second, it reduces the effect of the Miller capacitance on the input of the amplifier, which will be very important in designing the frequency behavior of the op amp. Figure 5.3-1 shows a simple cascode amplifier consisting of transistors M1, M2, and M3. Except for M2, the cascode amplifier is identical to the current-source CMOS inverter of Section 5.1. The primary function of M2 is to keep the small-signal resistance at the drain of M1 low. The small-signal resistance looking back into the drain of M2 is approximately ${r}_{ds1}{g}_{m2}{r}_{ds2}$ , which is much larger than that seen looking into M3, which is ${r}_{ds3}$ . The small-signal gain of the cascode amplifier is approximately twice that of the inverter because ${R}_{\text{out }}$ has increased by roughly a factor of 2 .
## Large-Signal Characteristics
The large-signal voltage-transfer curve of the cascode amplifier of Fig. 5.3-1 is obtained in the same manner as was used for the inverting amplifiers of Section 5.1. The primary difference in this case is that the output characteristics of the M1-M2 combination are much flatter than for the case of Fig. 5.1-5, as shown in Fig. 5.3-2.
The regions of operation for transistors M1 through M3 can be found as before. The operation region for M3 can be found from Eq. (5.1-17) and is a horizontal line at ${V}_{GG3} +$ $\left| {V}_{TP}\right|$ or ${3.0}\mathrm{\;V}$ . M2 is saturated when
$$
{V}_{DS2} \geq  {V}_{GS2} - {V}_{TN} \rightarrow  {v}_{\text{OUT }} - {V}_{DS1} \geq  {V}_{GG2} - {V}_{DS1} - {V}_{TN} \tag{5.3-1}
$$
$$
\rightarrow  {v}_{\mathrm{{OUT}}} \geq  {\mathrm{V}}_{GG2} - {\mathrm{V}}_{TN}
$$
which gives a horizontal line of ${2.7}\mathrm{\;V}$ on Fig. 5.3-2. Finally, the operating region for $\mathrm{M}1$ is found as
$$
{V}_{GG2} - {V}_{GS2} \geq  {V}_{GS1} - {V}_{TN} \rightarrow  {v}_{\mathrm{{IN}}} \leq  \frac{{V}_{GG2} + {V}_{TN}}{2} \tag{5.3-2}
$$
where we have assumed that ${V}_{GS1} = {V}_{GS2} = {v}_{\mathrm{{IN}}}$ . Equation (5.3-2) is a vertical line on Fig. 5.3-2 at ${v}_{\mathrm{{IN}}} = {2.05}\mathrm{\;V}$ . Note that the steepest region of the transfer curve is again where all transistors are in saturation (between ${v}_{\mathrm{{OUT}}}$ equal to 2.7 and ${3.0}\mathrm{\;V}$ ).
Figure 5.3-2 shows that the simple cascode amplifier is capable of swinging to ${V}_{DD}$ , like the previous NMOS-input inverting amplifiers, but cannot reach ground. The lower limit of

Figure 5.3-1 Simple cascode amplifier.

Figure 5.3-2 Graphical illustration of the voltage-transfer function for the cascode amplifier.
${v}_{\mathrm{{OUT}}}$ , designated as ${v}_{\mathrm{{OUT}}}\left( \min \right)$ , can be found as follows. First, assume that both M1 and M2 will be in the active region (which is consistent with Fig. 5.3-2). If we reference all potentials to the negative power supply (ground in this case), we may express the current through each of the devices, M1 through M3, as
$$
{i}_{D1} = {\beta }_{1}\left( {\left( {{V}_{DD} - {V}_{T1}}\right) {v}_{DS1} - \frac{{v}_{DS1}^{2}}{2}}\right)  \cong  {\beta }_{1}\left( {{V}_{DD} - {V}_{T1}}\right) {v}_{DS1} \tag{5.3-3}
$$
$$
{i}_{D2} = {\beta }_{2}\left( {\left( {{V}_{GG2} - {v}_{DS1} - {V}_{T2}}\right) \left( {{v}_{\mathrm{{OUT}}} - {v}_{DS1}}\right)  - \frac{{\left( {v}_{\mathrm{{OUT}}} - {V}_{DS1}\right) }^{2}}{2}}\right)  \tag{5.3-4}
$$
$$
\cong  {\beta }_{2}\left( {{V}_{GG2} - {v}_{DS1} - {V}_{T2}}\right) \left( {{v}_{\mathrm{{OUT}}} - {v}_{DS1}}\right)
$$
and
$$
{i}_{D3} = \frac{{\beta }_{3}}{2}{\left( {V}_{DD} - {V}_{GG3} - \left| {V}_{T3}\right| \right) }^{2} \tag{5.3-5}
$$
where we have also assumed that both ${v}_{DS1}$ and ${v}_{\mathrm{{OUT}}}$ are small, and ${v}_{\mathrm{{IN}}} = {V}_{DD}$ . We may solve for ${v}_{\mathrm{{OUT}}}$ by realizing that ${i}_{D1} = {i}_{D2} = {i}_{D3}$ and ${\beta }_{1} = {\beta }_{2}$ to get
$$
{v}_{\mathrm{{OUT}}}\left( \min \right)  = \frac{{\beta }_{3}}{2{\beta }_{2}}{\left( {V}_{DD} - {V}_{GG3} - \left| {V}_{T3}\right| \right) }^{2}\left( {\frac{1}{{V}_{GG2} - {V}_{T2}} + \frac{1}{{V}_{DD} - {V}_{T1}}}\right)  \tag{5.3-6}
$$
Calculation of the Minimum Output Voltage for the Simple Cascode Amplifier
Assume the values and parameters used for the cascode configuration plotted in Fig. 5.3-2 and calculate the value of ${v}_{\mathrm{{OUT}}}\left( \min \right)$ .
## SOLUTION
From Eq. (5.3-6) we find that ${v}_{\mathrm{{OUT}}}\left( \min \right)$ is ${0.50}\mathrm{\;V}$ . We note that simulation gives a value of about ${0.75}\mathrm{\;V}$ . If we include the influence of the channel modulation on $\mathrm{M}3$ in Eq. (5.3-6), the calculated value is ${0.62}\mathrm{\;V}$ , which is closer. The difference is attributable to the assumption that both ${v}_{DS1}$ and ${v}_{\text{OUT }}$ are small.
The values of ${v}_{\mathrm{{OUT}}}\left( \max \right)$ and ${v}_{\mathrm{{OUT}}}\left( \min \right)$ as calculated above represent the value of ${v}_{\mathrm{{OUT}}}$ when the input voltage is at its maximum and minimum values, respectively. While these values are important, they are often not of interest. What is of interest is the range of output voltages over which all transistors in the amplifier remain saturated. Under this condition, we know that the voltage gain should be the largest (steepest slope). These limits are very useful for designing transistors. Therefore, the largest output voltage for which all transistors of the cascode amplifier are in saturation is given as
$$
{v}_{\mathrm{{OUT}}}\left( \max \right)  = {V}_{DD} - {V}_{SD3}\left( \text{ sat }\right)  \tag{5.3-7}
$$
and the corresponding minimum output voltage is
$$
{v}_{\mathrm{{OUT}}}\left( \min \right)  = {V}_{DS1}\left( \text{ sat }\right)  + {V}_{DS2}\left( \text{ sat }\right)  \tag{5.3-8}
$$
For the cascode amplifier of Fig. 5.3-2, these limits are ${3.0}\mathrm{\;V}$ and ${2.7}\mathrm{\;V}$ . Consequently, the range over which all transistors are saturated is quite small. To achieve a larger range, we must reduce the saturation voltages by increasing the $W/L$ ratios. We will discuss this later when we consider the design of Fig. 5.3-1.
## Small-Signal Characteristics
The small-signal performance of the simple cascode amplifier of Fig. 5.3-1 can be analyzed using the small-signal model of Fig. 5.3-3(a), which has been simplified in Fig. 5.3-3(b). We have neglected the bulk effect on M2 for purposes of simplicity. The simplification uses the current-source rearrangement and substitution principles described in Appendix A. Using nodal analysis, we may write
$$
\left( {{g}_{ds1} + {g}_{ds2} + {g}_{m2}}\right) {v}_{1} - {g}_{ds2}{v}_{\text{out }} =  - {g}_{m1}{v}_{\text{in }} \tag{5.3-9}
$$
$$
- \left( {{g}_{ds2} + {g}_{m2}}\right) {v}_{1} + \left( {{g}_{ds2} + {g}_{ds3}}\right) {v}_{\text{out }} = 0 \tag{5.3-10}
$$
Solving for ${v}_{\text{out }}/{v}_{\text{in }}$ yields
$$
\frac{{v}_{\text{out }}}{{v}_{\text{in }}} = \frac{-{g}_{m1}\left( {{g}_{ds2} + {g}_{m2}}\right) }{{g}_{ds1}{g}_{ds2} + {g}_{ds1}{g}_{ds3} + {g}_{ds2}{g}_{ds3} + {g}_{ds2}{g}_{m2}} \cong  \frac{-{g}_{m1}}{{g}_{ds3}} =  - {\left( \frac{2{K}_{1}^{\prime }{W}_{1}}{{L}_{1}{I}_{D}{\lambda }_{3}^{2}}\right) }^{1/2} \tag{5.3-11}
$$
---
Example 5.3-1
---

Figure 5.3-3 (a) Small-signal model of Fig. 5.3-1 neglecting the bulk effect on M2. (b) Simplified equivalent model of Fig. 5.3-1.
The output resistance can be found by combining in parallel the small-signal output resistance of a cascoded current sink (M1 and M2) with ${r}_{ds3}$ of Fig. 5.3-1. Therefore, the small-signal output resistance of the cascode amplifier is given as
$$
{r}_{\text{out }} = \left\lbrack  {{r}_{ds1} + {r}_{ds2} + {g}_{m2}{r}_{ds1}{r}_{ds2}}\right\rbrack  \parallel {r}_{ds3} \cong  {r}_{ds3} \tag{5.3-12}
$$
We will see shortly how to take advantage of the potential increase in gain possible with the cascode amplifier.
Equation (5.3-12) should be compared with Eq. (5.1-21). The primary difference is that the cascode configuration has made the output resistance of M2 negligible compared with ${r}_{ds3}$ . We further note the dependence of small-signal voltage gain on the bias current as before. It is also of interest to calculate the small-signal voltage gain from the input ${v}_{\text{in }}$ to the drain of $\mathrm{M}1\left( {v}_{1}\right)$ . From Eqs. (5.3-9) and (5.3-10) we may write
$$
\frac{{v}_{1}}{{v}_{\text{in }}} = \frac{-{g}_{m1}\left( {{g}_{ds2} + {g}_{ds3}}\right) }{{g}_{ds1}{g}_{ds2} + {g}_{ds1}{g}_{ds3} + {g}_{ds2}{g}_{ds3} + {g}_{ds3}{g}_{m2}} \tag{5.3-13}
$$
$$
\approx  \left( \frac{{g}_{ds2} + {g}_{ds3}}{{g}_{ds3}}\right) \left( \frac{-{g}_{m1}}{{g}_{m2}}\right)  \cong  \frac{-2{g}_{m1}}{{g}_{m2}} =  - 2{\left( \frac{{W}_{1}{L}_{2}}{{L}_{1}{W}_{2}}\right) }^{1/2}
$$
It is seen that if the $W/L$ ratios of M1 and M2 are identical and ${g}_{ds2} = {g}_{ds3}$ , then ${v}_{1}/{v}_{\text{in }}$ is approximately -2 .
The reason that this gain is -2 is not immediately obvious. We would normally expect to see a resistance looking into the source of $\mathrm{M}2$ of $1/{g}_{m2}$ . However, this is obviously not the case. Let us take a closer look at the resistance ${R}_{s2}$ of Fig. 5.3-1, which is that resistance seen looking into the source of M2. A small-signal model for this calculation is shown in Fig. 5.3-4, which neglects the bulk effect $\left( {{g}_{mbs2} = 0}\right)$ .
To solve for the resistance designated as ${R}_{s2}$ in Fig. 5.3-4, we first write a voltage loop, which is
$$
{v}_{s2} = \left( {{i}_{1} - {g}_{m2}{v}_{s2}}\right) {r}_{ds2} + {i}_{1}{r}_{ds3} = {i}_{1}\left( {{r}_{ds2} + {r}_{ds3}}\right)  - {g}_{m2}{r}_{ds2}{v}_{s2} \tag{5.3-14}
$$
Solving this equation for the ratio of ${v}_{s2}$ to ${i}_{1}$ gives
$$
{R}_{s2} = \frac{{v}_{s2}}{{i}_{1}} = \frac{{r}_{ds2} + {r}_{ds3}}{1 + {g}_{m2}{r}_{ds2}} \tag{5.3-15}
$$

Figure 5.3-4 A small-signal model for calculating ${R}_{s2}$ , the input resistance looking into the source of M2.
We see that ${R}_{s2}$ is indeed equal to $2/{g}_{m2}$ if ${r}_{ds2} \approx  {r}_{ds3}$ . Thus, if ${g}_{m1} \approx  {g}_{m2}$ , the voltage gain from the input of the cascode amplifier of Fig. 5.3-1 to the drain of M1 or source of M2 is approximately -2 . Also, we note the important principle that the small-signal resistance looking into the source of a MOSFET depends on the resistance connected from its drain to ac ground.
How does the source resistance come to be dependent on the resistance connected from the drain to ground? The answer is easy to see if we consider the flow of signal current through the ${g}_{m2}{v}_{s2}$ -controlled current source of Fig. 5.3-4. This current has two components designated as ${i}_{A}$ and ${i}_{B}$ . Current ${i}_{A}$ flows through the loop containing ${r}_{ds3}$ and the voltage source, ${v}_{s2}$ . Current ${i}_{B}$ flows only through ${r}_{ds2}$ . Note that because the current ${i}_{1}$ is equivalent to ${i}_{A}$ , the resistance ${R}_{s2}$ is determined by this part of the ${g}_{m2}{v}_{s2}$ current. Basic circuit theory tells us that the currents will divide according to the resistance seen in the path. For example, if ${r}_{ds3} = 0$ , then ${R}_{s2} = 1/{g}_{m2}$ . However, if ${r}_{ds3} = {r}_{ds2}$ , as is the case with the cascode amplifier, then the currents split evenly and ${i}_{1}$ is reduced by a factor of 2 and ${R}_{s2}$ increases by this factor. Note that if the load resistance of the cascode amplifier is a cascoded current source, then the ${i}_{A}$ current is very small and the resistance ${R}_{s2}$ becomes equivalent to ${r}_{ds}$ ! This fact will play an important role in a very popular op amp architecture called the folded-cascode architecture that we will discuss in Chapter 6.
Let us further illustrate the intuitive approach by rederiving the small-signal voltage gain of the cascode amplifier of Fig. 5.3-1. In this circuit, the input signal, ${v}_{\text{in }}$ , is applied to the gate-source of M1. This creates a small-signal current flowing into the drain of M1 of ${g}_{m1}{v}_{\text{in }}$ . This current flows through M2 and creates a voltage at the output, which is the point where the drains of M2 and M3 connect. The resistance at this point is the parallel combination of ${r}_{ds1}{g}_{m2}{r}_{ds2}$ [see Eq. (5.2-34)] and ${r}_{ds3}$ . Since ${r}_{ds1}{g}_{m2}{r}_{ds2}$ is greater than ${r}_{ds3}$ , then ${R}_{\text{out }} \approx  {r}_{ds3}$ . Multiplying $- {g}_{m1}{v}_{\text{in }}$ by ${R}_{\text{out }}$ gives the small-signal voltage gain of Fig. 5.3-1 as $- {g}_{m1}{r}_{ds3}$ , which corresponds to Eq. (5.3-11).
## Frequency Response
The frequency behavior of the cascode can be studied by analyzing Fig. 5.3-3(b) with the capacitors indicated included, which assumes the resistance of the ${v}_{\text{in }}$ voltage source is small. ${C}_{1}$ includes only ${C}_{gd1}$ , while ${C}_{2}$ includes ${C}_{bd1},{C}_{bs2}$ , and ${C}_{gs2}$ and ${C}_{3}$ includes ${C}_{bd2}$ , ${C}_{bd3},{C}_{gd2},{C}_{gd3}$ , and any load capacitance ${C}_{L}$ . Including these capacitors, Eqs. (5.3-9) and (5.3-10) become (ignoring the body effect)
$$
\left( {{g}_{m2} + {g}_{ds1} + {g}_{ds2} + s{C}_{1} + s{C}_{2}}\right) {v}_{1} - {g}_{ds2}{v}_{\text{out }} =  - \left( {{g}_{m1} - s{C}_{1}}\right) {v}_{\text{in }} \tag{5.3-16}
$$
and
$$
- \left( {{g}_{ds2} + {g}_{m2}}\right) {v}_{1} + \left( {{g}_{ds2} + {g}_{ds3} + s{C}_{3}}\right) {v}_{\text{out }} = 0 \tag{5.3-17}
$$
Solving for ${V}_{\text{out }}\left( s\right) /{V}_{\text{in }}\left( s\right)$ gives
$$
\frac{{V}_{\text{out }}\left( s\right) }{{V}_{\text{in }}\left( s\right) } = \left( \frac{1}{1 + {as} + b{s}^{2}}\right) \left( \frac{-\left( {{g}_{m1} - s{C}_{1}}\right) \left( {{g}_{ds2} + {g}_{m2}}\right) }{{g}_{ds1}{g}_{ds2} + {g}_{ds3}\left( {{g}_{m2} + {g}_{ds1} + {g}_{ds2}}\right) }\right)  \tag{5.3-18}
$$
where
$$
a = \frac{{C}_{3}\left( {{g}_{ds1} + {g}_{ds2} + {g}_{m2}}\right)  + {C}_{2}\left( {{g}_{ds2} + {g}_{ds3}}\right)  + {C}_{1}\left( {{g}_{ds2} + {g}_{ds3}}\right) }{{g}_{ds1}{g}_{ds2} + {g}_{ds3}\left( {{g}_{m2} + {g}_{ds1} + {g}_{ds2}}\right) } \tag{5.3-19}
$$
and
$$
b = \frac{{C}_{3}\left( {{C}_{1} + {C}_{2}}\right) }{{g}_{ds1}{g}_{ds2} + {g}_{ds3}\left( {{g}_{m2} + {g}_{ds1} + {g}_{ds2}}\right) } \tag{5.3-20}
$$
One of the difficulties with straightforward algebraic analysis is that often the answer, while correct, is meaningless for purposes of understanding. Such is the case with Eqs. (5.3-18) through (5.3-20). We can observe that if $s = 0$ , Eq. (5.3-18) reduces to Eq. (5.3-11). Fortunately, we can make some simplifications that bring the results of the above analysis back into perspective. We will develop the method here since it will become useful later when considering the compensation of op amps. It also can be applied to the differential amplifier of Section 5.2.
A general second-order polynomial can be written as
$$
P\left( s\right)  = 1 + {as} + b{s}^{2} = \left( {1 - \frac{s}{{p}_{1}}}\right) \left( {1 - \frac{s}{{p}_{2}}}\right)  \tag{5.3-21}
$$
$$
= 1 - s\left( {\frac{1}{{p}_{1}} + \frac{1}{{p}_{2}}}\right)  + \frac{{s}^{2}}{{p}_{1}{p}_{2}}
$$
Now if we assume that $\left| {p}_{2}\right|  \gg  \left| {p}_{1}\right|$ , then Eq. (5.3-21) can be simplified as
$$
P\left( s\right)  \cong  1 - \frac{s}{{p}_{1}} + \frac{{s}^{2}}{{p}_{1}{p}_{2}} \tag{5.3-22}
$$
Therefore, we may write ${p}_{1}$ and ${p}_{2}$ in terms of $a$ and $b$ as
$$
{p}_{1} = \frac{-1}{a} \tag{5.3-23}
$$
and
$$
{p}_{2} = \frac{-a}{b} \tag{5.3-24}
$$
The key in this technique is the assumption that the magnitude of the root ${p}_{2}$ is greater than the magnitude of the root ${p}_{1}$ . Typically, we are interested in the smaller root so that this technique is very useful. Assuming that the roots of the denominator of Eq. (5.3-18) are sufficiently different, Eq. (5.3-22) gives
$$
{p}_{1} = \frac{-\left\lbrack  {{g}_{ds1}{g}_{ds2} + {g}_{ds3}\left( {{g}_{m2} + {g}_{ds1} + {g}_{ds2}}\right) }\right\rbrack  }{{C}_{3}\left( {{g}_{ds1} + {g}_{ds2} + {g}_{m2}}\right)  + {C}_{2}\left( {{g}_{ds2} + {g}_{ds3}}\right)  + {C}_{1}\left( {{g}_{ds2} + {g}_{ds3}}\right) } \tag{5.3-25a}
$$
$$
{p}_{1} \cong  \frac{-{g}_{ds3}}{{C}_{3}} \tag{5.3-25b}
$$
The nondominant root ${p}_{2}$ is given as
$$
{p}_{2} = \frac{-\left\lbrack  {{C}_{3}\left( {{g}_{ds1} + {g}_{ds2} + {g}_{m2}}\right)  + {C}_{2}\left( {{g}_{ds2} + {g}_{ds3}}\right)  + {C}_{1}\left( {{g}_{ds2} + {g}_{ds3}}\right) }\right\rbrack  }{{C}_{3}\left( {{C}_{1} + {C}_{2}}\right) } \tag{5.3-26a}
$$
$$
{p}_{2} \cong  \frac{-{g}_{m2}}{{C}_{1} + {C}_{2}} \tag{5.3-26b}
$$
Assuming that ${C}_{1},{C}_{2}$ , and ${C}_{3}$ are the same order of magnitude, and that ${g}_{m2}$ is greater than ${g}_{ds3}$ , then $\left| {p}_{1}\right|$ is in fact smaller than $\left| {p}_{2}\right|$ . Therefore, the approximation above is valid. Equations (5.3-25) and (5.3-26) show a typical trend of CMOS circuits. The poles of the frequency response tend to be associated with the inverse product of the resistance and capacitance of a node to ground. For example, the inverse ${RC}$ product of the output node is approximately ${g}_{ds3}/{C}_{3}$ , whereas the inverse ${RC}$ product of the node where ${v}_{1}$ is defined is approximately ${g}_{m2}/\left( {{C}_{1} + {C}_{2}}\right)$ .*
A zero also occurs in the frequency response and has the value of
$$
{z}_{1} = \frac{{g}_{m1}}{{C}_{1}} \tag{5.3-27}
$$
The intuitive reason for this zero is the result of two paths from the input to the output. One path couples directly through ${C}_{1}$ and the other goes through the ${g}_{m1}{v}_{\text{in }}$ -controlled source.
## Finding Roots by Inspection
Circuits containing MOSFETs generally are high impedance and lend themselves to methods of determining the roots of the circuit by inspection. We have illustrated this technique in the material above. The following guidelines can be used to find the poles of a circuit containing MOSFETs if the poles are on the negative real axis.
1. Typically, the magnitude of a pole at a node of a circuit is found to be the reciprocal product of the small-signal resistance from that node to ground times the sum of the capacitances connected to that node.
2. If there are multiple nodes in a circuit (multiple poles), then start with the node having the smallest magnitude and find the pole using the approach in (1). You may have to guess which node has the smallest magnitude and then verify your guess after calculating the pole.
---
*Equation (5.3-26b) seems to be contradictive to the inverse ${RC}$ product concept because in Eq. (5.3-15) we saw that the resistance looking into the source of $\mathrm{M}2$ is approximately $2/{g}_{m2}$ . This contradiction is resolved if we assume that capacitor ${C}_{3}$ of Fig. 5.3-3(b) shorts ${r}_{ds3}$ at the frequency of $\left| {p}_{2}\right|$ , which is the case if $\left| {p}_{1}\right|  < \left| {p}_{2}\right|$ .
---
3. Next, short the node having the smallest magnitude to ground and find the node having the next smallest magnitude and find the second pole using the approach in (1).
4. Now, short both of the previous nodes to ground and find the node having the next smallest magnitude and find the third pole using the approach in (1).
5. Continue this procedure until all the nodes have been evaluated.
6. Be careful of the influence of positive and negative feedback on the pole calculations (i.e., the Miller effect).
Zeros can also be identified by inspection. There are at least three sources of zeros, which are listed in the following guidelines for zeros on the real axis.
1. A pole in a feedback path will become a zero in the feed-forward path.
2. If there is more than one path from the input to the output in a circuit, then at some complex frequency the two paths will cancel each other, resulting in a zero. This case generally arises when a capacitor is connected or is inherent between the input and output of an amplifier.
3. Zeros can be found in simple ${RC}$ networks and are generally not easy to see by inspection.
It is always a good practice to use the methods of circuit analysis to find the roots when possible or at least to confirm the results found by inspection. We shall continue to use both methods in the material to follow.
## Driving Amplifiers from a High-Resistance Source: The Miller Effect
One of the most important aspects of the cascode amplifier has not yet been examined. This is because, up to this point, we assumed that the cascode amplifier was driven by a low-resistance source such as a voltage source. In general, the source resistance in a CMOS circuit is large enough so that it cannot be neglected as we have done. Let us see what happens to the normal inverting amplifier when it is driven from a high-impedance source. Figure 5.3- 5(a) shows a current-source load inverter driven from a source having high resistance designated as ${R}_{s}$ . Generally, ${R}_{s}$ is on the order of ${r}_{ds}$ .

Figure 5.3-5 (a) Current-source load inverter driven from a high-resistance source. (b) Equivalent small-signal model for (a).
Let us consider the small-signal circuit in Fig. 5.3-5(b). Assuming the input is ${I}_{\text{in }}$ , the nodal equations are
$$
\left\lbrack  {{G}_{1} + s\left( {{C}_{1} + {C}_{2}}\right) }\right\rbrack  {V}_{1} - s{C}_{2}{V}_{\text{out }} = {I}_{\text{in }} \tag{5.3-28}
$$
and
$$
\left( {{g}_{m1} - s{C}_{2}}\right) {V}_{1} + \left\lbrack  {{G}_{3} + s\left( {{C}_{2} + {C}_{3}}\right) }\right\rbrack  {V}_{\text{out }} = 0 \tag{5.3-29}
$$
The values of ${G}_{1}$ and ${G}_{3}$ are $1/{R}_{s}$ and ${g}_{ds1} + {g}_{ds2}$ , respectively. ${C}_{1}$ is ${C}_{gs1},{C}_{2}$ is ${C}_{gd1}$ , and ${C}_{3}$ is the sum of ${C}_{bd1},{C}_{bd2}$ , and ${C}_{gd2}$ . Solving for ${V}_{\text{out }}\left( s\right) /{V}_{\text{in }}\left( s\right)$ gives
$$
\begin{aligned} \frac{{V}_{\text{out }}\left( s\right) }{{V}_{\text{in }}\left( s\right) } = \frac{\left( {s{C}_{2} - {g}_{m1}}\right) {G}_{1}}{{G}_{1}{G}_{3} + s\left\lbrack  {{G}_{3}\left( {{C}_{1} + {C}_{2}}\right)  + {G}_{1}\left( {{C}_{2} + {C}_{3}}\right)  + {g}_{m1}{C}_{2}}\right\rbrack  } & \\   &  + \left( {{C}_{1}{C}_{2} + {C}_{1}{C}_{3} + {C}_{2}{C}_{3}}\right) {s}^{2} \end{aligned} \tag{5.3-30}
$$
or
$$
\frac{{V}_{\text{out }}\left( s\right) }{{V}_{\text{in }}\left( s\right) } = \left( \frac{-{g}_{m1}}{{G}_{3}}\right)
$$
$$
\times  \frac{\left\lbrack  1 - s\left( {C}_{2}/{g}_{m1}\right) \right\rbrack  }{1 + \left\lbrack  {{R}_{1}\left( {{C}_{1} + {C}_{2}}\right)  + {R}_{3}\left( {{C}_{2} + {C}_{3}}\right)  + {g}_{m1}{R}_{1}{R}_{3}{C}_{2}}\right\rbrack  s} \tag{5.3-31}
$$
$$
+ \left( {{C}_{1}{C}_{2} + {C}_{1}{C}_{3} + {C}_{2}{C}_{3}}\right) {R}_{1}{R}_{3}{s}^{2}
$$
Assuming that the poles are split allows the use of the previous technique to obtain
$$
{p}_{1} = \frac{-1}{{R}_{1}\left( {{C}_{1} + {C}_{2}}\right)  + {R}_{3}\left( {{C}_{2} + {C}_{3}}\right)  + {g}_{m1}{R}_{1}{R}_{3}{C}_{2}} \cong  \frac{-1}{{g}_{m1}{R}_{1}{R}_{3}{C}_{2}} \tag{5.3-32}
$$
and
$$
{p}_{2} \cong  \frac{-{g}_{m1}{C}_{2}}{{C}_{1}{C}_{2} + {C}_{1}{C}_{3} + {C}_{2}{C}_{3}} \tag{5.3-33}
$$
Obviously, ${p}_{1}$ is more dominant than ${p}_{2}$ so that the technique is valid. Equation (5.3-32) illustrates an important disadvantage of the regular inverter if it is driven from a high-resistance source. The Miller effect essentially takes the capacitance, ${C}_{2}$ , multiplies it by the low-frequency voltage gain from ${V}_{1}$ to ${V}_{\text{out }}$ , and places it in parallel with ${R}_{1}$ , resulting in a dominant pole (see Problem P5.3-9). The equivalent capacitance due to ${C}_{2}$ seen at node 1 is called the Miller capacitance. The Miller capacitance can have a negative effect on a circuit from several viewpoints. One is that it creates a dominant pole. A second is that it provides a large capacitive load to the driving circuit.
One of the advantages of the cascode amplifier is that it greatly reduces the Miller capacitance. This is accomplished by keeping the low-frequency voltage gain across M1 low so that ${C}_{2}$ is not multiplied by a large factor. Unfortunately, to repeat the analysis of Fig. 5.3-3(b) with a current-source driver would lead to a third-order denominator polynomial, which masks the results. An intuitive approach is to note that the cascode circuit essentially makes the load resistance in the above analysis approximately equal to twice the reciprocal of the transconductance of the cascode device, M2, in Fig. 5.3-1 (remember that this approximation deteriorates as the load impedance seen by the drain of M2 becomes much larger than ${r}_{ds2}$ ). Consequently, ${R}_{3}$ of Eq. (5.3-32) becomes approximately $2/{g}_{m}$ of the cascode device. Thus, if the two transconductances are approximately equal, the new location of the input pole is
$$
{p}_{1} \cong  \frac{-1}{{R}_{1}\left( {{C}_{1} + {C}_{2}}\right)  + 2\left( {{C}_{2} + {C}_{3}}\right) /{g}_{m} + 2{R}_{1}{C}_{2}} \cong  \frac{-1}{{R}_{1}\left( {{C}_{1} + 3{C}_{2}}\right) } \tag{5.3-34}
$$
which is much larger than that of Eq. (5.3-32). Equation (5.3-13) also confirms this result in that the gain across M1 is limited to less than 2 so that the Miller effect is minimized. This property of the cascode amplifier-removing a dominant pole at the input-is very useful in controlling the frequency response of an op amp.
We note that although the cascode configuration consisting of M1 and M2 has a high output resistance, the lower resistance of M3 does not allow the realization of the high output resistance. For this reason, the current-source load is often replaced by a cascode current-source load as shown in Fig. 5.3-6(a). The small-signal model of this circuit is shown in Fig. 5.3-6(b). It is more efficient to consider first the output resistance of this circuit. The small-signal output resistance can be found using the approach of Eq. (5.3-12) as
$$
{r}_{\text{out }} = \left\lbrack  {{r}_{ds1} + {r}_{ds2} + \left( {{g}_{m2} + {g}_{mbs2}}\right) {r}_{ds1}{r}_{ds2}}\right\rbrack  \left\lbrack  \left\lbrack  {{r}_{ds3} + {r}_{ds4} + \left( {{g}_{m3} + {g}_{mbs3}}\right) {r}_{ds3}{r}_{ds4}}\right. \right\rbrack   \tag{5.3-35}
$$
$$
\cong  \left\lbrack  {{g}_{m2}{r}_{ds1}{r}_{ds2}}\right\rbrack  \parallel \left\lbrack  {{g}_{m3}{r}_{ds3}{r}_{ds4}}\right\rbrack
$$
In terms of the large-signal model parameters, the small-signal output resistance is
$$
{r}_{\text{out }} \cong  \frac{{I}_{D}^{-{1.5}}}{\left( \frac{{\lambda }_{1}{\lambda }_{2}}{{\left\lbrack  2{K}_{2}^{\prime }{\left( W/L\right) }_{2}\right\rbrack  }^{1/2}}\right)  + \left( \frac{{\lambda }_{3}{\lambda }_{4}}{{\left\lbrack  2{K}_{3}^{\prime }{\left( W/L\right) }_{3}\right\rbrack  }^{1/2}}\right) } \tag{5.3-36}
$$

Figure 5.3-6 (a) Cascode amplifier with high gain and high output resistance. (b) Small-signal model of (a).
Knowing ${r}_{\text{out }}$ , the gain is simply
$$
{A}_{v} =  - {g}_{m1}{r}_{\text{out }} \cong   - {g}_{m1}\left\{  {\left\lbrack  {{g}_{m2}{r}_{ds1}{r}_{ds2}}\right\rbrack  \parallel \left\lbrack  {{g}_{m3}{r}_{ds3}{r}_{ds4}}\right\rbrack  }\right\}   \tag{5.3-37}
$$
$$
\cong  \frac{\left\{  {\left\lbrack  2{K}_{1}^{\prime }{\left( W/L\right) }_{1}\right\rbrack  }^{1/2}\right\}  {I}_{D}^{-1}}{\left( \frac{{\lambda }_{1}{\lambda }_{2}}{{\left\lbrack  2{K}_{2}^{\prime }{\left( W/L\right) }_{2}\right\rbrack  }^{1/2}}\right)  + \left( \frac{{\lambda }_{3}{\lambda }_{4}}{{\left\lbrack  2{K}_{3}^{\prime }{\left( W/L\right) }_{3}\right\rbrack  }^{1/2}}\right) }
$$
Equations (5.3-36) and (5.3-37) are rather surprising in that the voltage gain is proportional to ${I}_{D}^{-1}$ and the output resistance varies inversely with the $3/2$ power of ${I}_{D}$ . Let us consider an example to illustrate the characteristics of the cascode amplifier considered so far.
---
Example 5.3-2
---
## Comparison of the Cascode Amplifier Performance
Calculate the small-signal voltage gain, output resistance, dominant pole, and nondominant pole for the cascode amplifier of Figs. 5.3-1 and 5.3-6(a). Assume that ${I}_{D} = {200\mu }\mathrm{A}$ , that all $W/L$ ratios are ${2\mu }\mathrm{m}/{1\mu }\mathrm{m}$ , and that the parameters of Table 3.1-2 are valid. The capacitors are assumed to be ${C}_{gd} = {3.5}\mathrm{{fF}},{C}_{gs} = {30}\mathrm{{fF}},{C}_{bsn} = {C}_{bdn} = {24}\mathrm{{fF}},{C}_{bsp} = {C}_{bdp} = {12}\mathrm{{fF}}$ , and ${C}_{L} = 1\mathrm{{pF}}$ .
## SOLUTION
The simple cascode amplifier of Fig. 5.3-1 has a small-signal voltage of ${37.1}\mathrm{\;V}/\mathrm{V}$ as calculated from the approximate expression in Eq. (5.3-11). The output resistance is found from Eq. (5.3-12) as ${125}\mathrm{k}\Omega$ . The dominant pole is found from Eq. (5.3-25b) as ${1.22}\mathrm{{MHz}}$ . The nondominant pole is found from Eq. (5.3-26b) as 579 MHz.
The cascode amplifier of Fig. 5.3-6(a) has a voltage gain of -414 as found from Eq. (5.3-37). Equation (5.3-36) gives an output resistance of ${1.40}\mathrm{M}\Omega$ . The dominant pole is found from the relationship $1/{RC}$ , where $R$ is the output resistance and $C$ is the load capacitance. This calculation yields a dominant pole at ${109}\mathrm{{kHz}}$ . There is a nondominant pole associated with the source of M2. This pole is the same as that for the low-gain cas-code because the cascode load seen by the drain of M2 is shorted by ${C}_{L}$ . (See the footnote on page 224.)
The small-signal voltage gain of Fig. 5.3-1 [or Fig. 5.3-6(a)] can be increased by increasing the dc current in M1 without changing the current in M2 and the other transistors. This can be done by simply connecting a current source from ${V}_{DD}$ to the drain of $\mathrm{M}1$ (source of M2). It can be shown that the gain is increased by the square root of the ratio of ${I}_{D1}$ to ${I}_{D2}$ (see Problem P5.3-5).
## Designing Cascode Amplifiers
For the cascode amplifier of Fig. 5.3-1, the design parameters are ${W}_{1}/{L}_{1},{W}_{2}/{L}_{2},{W}_{3}/{L}_{3}$ , the dc current, and the bias voltages. Figure 5.3-7 shows the amplifier of Fig. 5.3-1 with the relationships indicated for the design of each of these parameters. Typical specifications for the cascode amplifier might be ${V}_{DD}$ , small-signal gain ${A}_{v}$ , maximum and minimum output voltage swings ${v}_{\mathrm{{OUT}}}\left( \max \right)$ and ${v}_{\mathrm{{OUT}}}\left( \min \right)$ , and power dissipation ${P}_{\text{diss }}$ . In the following example we will illustrate how to use these design relationships to design a cascode amplifier to a given set of specifications.

Figure 5.3-7 Pertinent design equations for the simple cascode amplifier of Fig. 5.3-1.
---
Example 5.3-3
---
## Design of a Cascode Amplifier
The specifications for a cascode amplifier are ${V}_{DD} = 5\mathrm{\;V},{P}_{\text{diss }} = 1\mathrm{\;{mW}},{A}_{v} =  - {50}\mathrm{\;V}/\mathrm{V}$ , ${v}_{\mathrm{{OUT}}}\left( \max \right)  = 4\mathrm{\;V}$ , and ${v}_{\mathrm{{OUT}}}\left( \min \right)  = {1.5}\mathrm{\;V}$ . The slew rate with a ${10}\mathrm{{pF}}$ load should be ${10}\mathrm{\;V}/\mathrm{{\mu s}}$ or greater.
## SOLUTION
In design, not all specifications are important to meet exactly. For example, the power supply must be exactly $5\mathrm{\;V}$ but the output swing can exceed the specifications if necessary for some other reason. Let us begin with the dc current. Both the power dissipation and the slew rate will influence the current. The slew rate requires a current greater than ${100\mu }\mathrm{A}$ while the power dissipation requires a current less than ${200\mu }\mathrm{A}$ . Let us compromise with a current of ${150\mu }\mathrm{A}$ .
We will first begin with M3 because the only unknown is ${W}_{3}/{L}_{3}$ . Solving the upper righthand relationship of Fig. 5.3-7 for ${W}_{3}/{L}_{3}$ , we get
$$
\frac{{W}_{3}}{{L}_{3}} = \frac{2I}{{K}_{p}^{\prime }{\left\lbrack  {V}_{DD} - {v}_{\mathrm{{OUT}}}\left( \max \right) \right\rbrack  }^{2}} = \frac{2 \cdot  {150}}{{50}{\left( 1\right) }^{2}} = 6
$$
The upper left-hand relationship of Fig. 5.3-7 gives ${W}_{4}/{L}_{4} = {W}_{3}/{L}_{3}$ if $I = {I}_{\text{BIAS }}$ . Next, we use the lower right-hand relationship of Fig. 5.3-7 to define ${W}_{1}/{L}_{1}$ as
$$
\frac{{W}_{1}}{{L}_{1}} = \frac{{\left( {A}_{v}\lambda \right) }^{2}I}{2{K}_{N}^{\prime }} = \frac{{\left( {50} \cdot  {0.04}\right) }^{2}\left( {150}\right) }{2 \cdot  {110}} = {2.73}
$$
To design ${W}_{2}/{L}_{2}$ , we will first calculate ${V}_{DS1}$ (sat) and use the ${v}_{\mathrm{{OUT}}}\left( \min \right)$ specification to define ${V}_{DS2}$ (sat). ${V}_{DS1}$ (sat) is given as
$$
{V}_{DS1}\left( \mathrm{{sat}}\right)  = \sqrt{\frac{2I}{{K}_{N}^{\prime }\left( {{W}_{1}/{L}_{1}}\right) }} = \sqrt{\frac{2 \cdot  {150}}{{110} \cdot  {2.73}}} = {0.8}\mathrm{\;V}
$$
Subtracting this value from ${1.5}\mathrm{\;V}$ gives ${V}_{DS2}\left( \text{sat}\right)  = {0.5}\mathrm{\;V}$ . Therefore, ${W}_{2}/{L}_{2}$ is
$$
\frac{{W}_{2}}{{L}_{2}} = \frac{2I}{{K}_{N}^{\prime }{V}_{DS2}{\left( \mathrm{{sat}}\right) }^{2}} = \frac{2 \cdot  {150}}{{110} \cdot  {0.5}^{2}} = {5.57}
$$
Finally, the lower left-hand relationship of Fig. 5.3-7 gives the value of ${V}_{GG2}$ as
$$
{V}_{GG2} = {V}_{DS1}\left( \mathrm{{sat}}\right)  + \sqrt{\frac{2I}{{K}_{N}^{\prime }\left( {{W}_{2}/{L}_{2}}\right) }} + {V}_{TN} = {1.0V} + {0.7V} + {0.7V} = {2.4V}
$$
$$
\frac{{W}_{5}}{{L}_{5}} = \frac{2{I}_{BIAS}}{{\left( {V}_{GG2} - {V}_{T}\right) }^{2}{K}_{N}^{\prime }} = \frac{2.150}{{1.7}^{2}\left( {110}\right) } = {0.94}
$$
This example illustrates that by varying the $W/L$ ratios of the transistors, an output voltage range of ${2.5}\mathrm{\;V}$ is achieved over which all transistors stay in saturation.
This section has introduced a very useful component in analog integrated-circuit design. The cascode amplifier is very versatile and gives the designer more control over the small-signal performance of the circuit than was possible with the inverter amplifier. In addition, the cascode circuit can provide extremely high voltage gains in a single stage with a well-defined dominant pole. Both of these characteristics will be used in the more complex circuits yet to be studied.

### 5.4 Current Amplifiers
Amplifier types are determined by whether the input and output variables are voltage or current. In turn, these variables are determined by the input and output resistance levels. For the amplifiers considered up to this point, the input resistance has been large, causing the input variable to be voltage. Although the output resistance was large in most MOSFET amplifiers, the output variable was chosen as voltage. This choice is consistent only if the output load is infinity (which is the case in most MOSFET circuits). Section 5.6 will examine these implications in more detail as we move from simple amplifiers to more complex amplifiers.
In this section, we want to examine amplifiers with a low input resistance, which implies that current is the appropriate input variable. Since the output resistance is already large in most MOSFET amplifiers, the output variable can be selected as current if the output load resistance is small rather than infinity. This type of amplifier will be called a current amplifier. It is a very useful amplifier and finds many applications in analog signal-processing circuits at low power-supply voltages and in discrete-time circuits [4,5].
## What Is a Current Amplifier?
As we have seen above, a current amplifier is an amplifier with low input resistance, high output resistance, and a defined relationship between the input and output currents. The current amplifier will typically be driven by a source with a large resistance and be loaded with a small resistance. Figure 5.4-1 shows the general implementation of a current amplifier. Normally, ${R}_{S}$ is very large and ${R}_{L}$ is very small. Figure 5.4-1(a) is a single-ended input current amplifier and Fig. 5.4-1(b) is a differential-input current amplifier. Although the outputs of the current amplifiers in Fig. 5.4-1 are single-ended, they could easily be differential outputs.
There are several important advantages of a current amplifier compared with voltage amplifiers. The first is that currents are not restricted by the power-supply voltages so that wider signal dynamic ranges may be possible at low power supply voltages. Eventually, the current will probably be converted into voltage, which may limit this advantage. The second advantage is that $- 3\mathrm{\;{dB}}$ bandwidth of a current amplifier using negative feedback is independent of the closed-loop gain. This is illustrated with the assistance of Fig. 5.4-2 using a differential-input current amplifier. If we assume that the small-signal input resistance looking into the + and - terminals of the current differential amplifier of Fig. 5.4-2 is smaller than ${R}_{1}$ or ${R}_{2}$ , then we can express ${i}_{o}$ as
$$
{i}_{o} = {A}_{i}\left( {{i}_{1} - {i}_{2}}\right)  = {A}_{i}\left( {\frac{{v}_{\text{in }}}{{R}_{1}} - {i}_{o}}\right)  \tag{5.4-1}
$$
Solving for ${i}_{o}$ gives
$$
{i}_{o} = \left( \frac{{A}_{i}}{1 + {A}_{i}}\right) \frac{{v}_{\text{in }}}{{R}_{1}} \tag{5.4-2}
$$
However, the output voltage, ${v}_{\text{out }}$ , can be expressed in terms of ${i}_{o}$ as
$$
{v}_{\text{out }} = {R}_{2}{i}_{o} = \frac{{R}_{2}}{{R}_{1}}\left( \frac{{A}_{i}}{1 + {A}_{i}}\right) {v}_{\text{in }} \tag{5.4-3}
$$
Equation (5.4-3) is an important result. If ${A}_{i}$ is frequency dependent and given by the following single-pole model
$$
{A}_{i}\left( s\right)  = \frac{{A}_{o}}{\left( {s/{\omega }_{A}}\right)  + 1} \tag{5.4-4}
$$
then it can be shown that the closed-loop $- 3\mathrm{\;{dB}}$ frequency is
$$
{\omega }_{-3\mathrm{\;{dB}}} = {\omega }_{A}\left( {1 + {A}_{o}}\right)  \tag{5.4-5}
$$
where ${\omega }_{A}$ is the magnitude of the single pole of ${A}_{i}\left( s\right)$ and ${A}_{o}$ is the dc current gain of the current amplifier. Note the unique characteristic that this result is independent of the closed-loop voltage gain, ${R}_{2}/{R}_{1}$ . This characteristic has been exploited to build high-frequency voltage amplifiers by following the output of Fig. 5.4-2 with a high-frequency buffer amplifier.

Figure 5.4-1 (a) Single-ended input current amplifier. (b) Differential-input current amplifier.

Figure 5.4-2 A current amplifier with resistive negative feedback applied.
## Single-Ended Input Current Amplifiers
The simple current mirror of Fig. 5.4-3(a) is a reasonably good implementation of a current amplifier. We saw from previous considerations that the small-signal input resistance was
$$
{R}_{\text{in }} = \frac{1}{{g}_{m1}} \tag{5.4-6}
$$
and the small-signal output resistance was
$$
{R}_{\text{out }} = \frac{1}{{\lambda }_{1}{I}_{2}} \tag{5.4-7}
$$
and the current gain was given ideally as
$$
{A}_{i} = \frac{{W}_{2}/{L}_{2}}{{W}_{1}/{L}_{1}} \tag{5.4-8}
$$
The frequency response of the simple current mirror can be found from the small-signal model of Fig. 5.4-3(b). Capacitor ${C}_{1}$ consists of ${C}_{bd1},{C}_{gs1},{C}_{gs2}$ , and any other capacitance connected to the input. Capacitor ${C}_{2}$ is equal to ${C}_{gd2}$ . Finally, capacitor ${C}_{3}$ consists of ${C}_{bd2}$ and any other capacitance connected to the output. This analysis is the same as that given earlier for the inverter driven from a high-resistance source (Fig. 5.3-5). We will simplify this analysis by assuming that ${R}_{L}$ approaches zero. In that case, ${C}_{3}$ is shorted out and ${C}_{2}$ is in parallel with ${C}_{1}$ . A single pole results given as
$$
{p}_{1} = \frac{-\left( {{g}_{m1} + {g}_{ds1}}\right) }{{C}_{1} + {C}_{2}} = \frac{-\left( {{g}_{m1} + {g}_{ds1}}\right) }{{C}_{bd1} + {C}_{gs1} + {C}_{gs2} + {C}_{gd2}} \approx  \frac{-{g}_{m1}}{{C}_{bd1} + {C}_{gs1} + {C}_{gs2} + {C}_{gd2}} \tag{5.4-9}
$$

Figure 5.4-3 (a) Simple current-mirror implementation of a current amplifier. (b) Small-signal model of (a).
## Performance of a Simple Current Mirror as a Current Amplifier
Find the small-signal current gain ${A}_{i}$ , the input resistance ${R}_{\mathrm{{in}}}$ , the output resistance ${R}_{\mathrm{{out}}}$ , and the $- 3\mathrm{\;{dB}}$ frequency in hertz for the current amplifier of Fig. 5.4-3(a) if ${10}{I}_{1} = {I}_{2} = {100\mu }\mathrm{A}$ and ${W}_{2}/{L}_{2} = {10}{W}_{1}/{L}_{1} = {10\mu }\mathrm{m}/{1\mu }\mathrm{m}$ . Assume that ${C}_{bd1} = {25}\mathrm{{fF}},{C}_{gs1} = {C}_{gs2} = {16}\mathrm{{fF}}$ , and ${C}_{gd2} = 3\mathrm{{fF}}$ .
## SOLUTION
Ignoring channel modulation and mismatch effects, the small-signal current gain ${A}_{i}$ will be given by the ratio of $W/L$ values and is $+ {10}\mathrm{\;A}/\mathrm{A}$ . The small-signal input resistance ${R}_{\text{in }}$ is approximately $1/{g}_{\mathrm{m}1}$ and is
$$
{R}_{\text{in }} \approx  \frac{1}{\sqrt{2{K}_{N}\left( {1/1}\right) {10\mu }\mathrm{A}}} = \frac{1}{{46.9\mu }\mathrm{S}} = {21.3}\mathrm{k}\Omega
$$
The small-signal output resistance ${R}_{\text{out }}$ is equal to $1/{\lambda }_{N}{I}_{2}$ and is ${250}\mathrm{k}\Omega$ . The $- 3\mathrm{\;{dB}}$ frequency is given by Eq. (5.4-9) and is
$$
{\omega }_{-3\mathrm{\;{dB}}} = \frac{{46.9\mu }\mathrm{S}}{{60}\mathrm{{fF}}} = {781.7} \times  {10}^{6}\mathrm{{rad}}/\mathrm{s} \rightarrow  {f}_{-3\mathrm{\;{dB}}} = {124}\mathrm{{MHz}}
$$
The self-biased, cascode current sink discussed in Section 4.4 can be used to achieve better performance as a current amplifier implementation. The self-biased cascode current mirror used as a current amplifier is shown in Fig. 5.4-4(a). We know that this current mirror has increased output resistance over the simple current mirror because of the cascode output. However, it is not clear what is the small-signal input resistance. Figure 5.4-4(b) can be used to answer this question. Writing a loop equation gives
$$
{v}_{\text{in }} = R{i}_{\text{in }} + {r}_{ds2}\left( {{i}_{\text{in }} - {g}_{m3}{v}_{gs3}}\right)  + {r}_{ds1}\left( {{i}_{\text{in }} - {g}_{m1}{v}_{gs1}}\right)  \tag{5.4-10}
$$

Figure 5.4-4 (a) Self-biased, cascode current-mirror implementation of a current amplifier. (b) Small-signal model to calculate ${R}_{\text{in }}$ .
---
Example 5.4-1
---
${v}_{gs1}$ and ${v}_{gs2}$ can be expressed in terms of ${i}_{\text{in }}$ and ${v}_{\text{in }}$ as
$$
{v}_{gs1} = {v}_{2} = {v}_{\text{in }} - {i}_{\text{in }}R \tag{5.4-11}
$$
and
$$
{v}_{gs3} = {v}_{\text{in }} - {v}_{1} = {v}_{\text{in }} - \left( {{i}_{\text{in }} - {g}_{m1}{v}_{gs1}}\right) {r}_{ds1} = {v}_{\text{in }}\left( {1 + {g}_{m1}{r}_{ds1}}\right)  - {i}_{\text{in }}{r}_{ds1}\left( {1 + {g}_{m1}R}\right)  \tag{5.4-12}
$$
Substituting Eqs. (5.4-11) and (5.4-12) into Eq. (5.4-10) gives
$$
{R}_{\text{in }} = \frac{{v}_{\text{in }}}{{i}_{\text{in }}} = \frac{R + {r}_{ds1} + {r}_{ds3} + {r}_{ds1}{g}_{m3}{r}_{ds3}\left( {1 + {g}_{m1}R}\right)  + {g}_{m1}{r}_{ds1}R}{1 + {g}_{m3}{r}_{ds3}\left( {1 + {g}_{m1}{r}_{ds1}}\right)  + {g}_{m1}{r}_{ds1}} \approx  R + \frac{1}{{g}_{m1}} \tag{5.4-13}
$$
Equation (5.4-13) is an interesting result. Due to negative feedback, the equivalent input resistance is approximately $R + 1/{g}_{m1}.R$ is designed by ${V}_{ON}/{I}_{1}$ , which can give a small value of ${R}_{\text{in }}$ . This value can easily be $1\mathrm{k}\Omega$ or less. The improved high-swing cascode current sink of Section 4.4 could be used to decrease the input resistance of the current amplifier in Fig. 5.4-4(a) to $1/{g}_{m1}$ .
---
Example 5.4-2
---
## Current Amplifier Implemented by the Self-Biased Cascode Current Mirror
Assume that ${I}_{1}$ and ${I}_{2}$ of Fig. 5.4-4(a) are ${100\mu }\mathrm{A}.R$ has been designed to give a ${V}_{ON}$ of ${0.1}\mathrm{\;V}$ . Thus, $R = 1\mathrm{k}\Omega$ . Find the value of ${R}_{\text{in }},{R}_{\text{out }}$ , and ${A}_{i}$ if the $W/L$ ratios of all transistors are ${182\mu }\mathrm{m}/{1\mu }\mathrm{m}$ .
## SOLUTION
From Eq. (5.4-13) we see that ${R}_{\text{in }} \approx  {1.5}\mathrm{k}\Omega$ . From our knowledge of the cascode configuration, the small-signal output resistance ${R}_{\text{out }}$ should be approximately ${g}_{m4}{r}_{ds4}{r}_{ds2}.{g}_{m4} = {2001}$ $\mu \mathrm{S}$ and ${r}_{ds2} = {r}_{ds4} = {250}\mathrm{k}\Omega$ . Thus, ${R}_{\text{out }} \approx  {125}\mathrm{M}\Omega$ . Because ${V}_{DS1} = {V}_{DS2}$ , the small-signal current gain is 1. Simulation results using the SPICE LEVEL 1 model for this example give ${R}_{\text{in }} = {1.497}\mathrm{k}\Omega ,{R}_{\text{out }} = {164.7}\mathrm{M}\Omega$ , and ${A}_{i} = {1.000}$ .
If we wish to decrease the input resistance below that possible for the self-biased cascode current amplifier, it will be necessary to employ negative feedback. Figure 5.4-5(a) shows how this can be accomplished. This circuit uses shunt negative feedback to reduce the small-signal input resistance below the value of $1/{g}_{m}$ . To keep the dc value of ${v}_{\mathrm{{IN}}}$ to a minimum, ${V}_{GG3}$ should be equal to ${V}_{ON}$ , which gives ${V}_{\text{in }}\left( \min \right)$ of ${V}_{T} + 2{V}_{ON}$ .
The small-signal input resistance can be calculated using the model of Fig. 5.4-5(b). The results are (see Problem 5.4-4)
$$
{R}_{\text{in }} = \frac{{v}_{\text{in }}}{{i}_{\text{in }}} = \frac{1}{{g}_{m1} + {g}_{m1}{g}_{m3}{r}_{ds3} + {g}_{ds1}} \approx  \frac{1}{{g}_{m1}{g}_{m3}{r}_{ds3}} \tag{5.4-14}
$$
We see that the input resistance of Fig. 5.4-5(a) is approximately ${g}_{m3}{r}_{ds3}$ less than the simple current-mirror input resistance. Unfortunately, further modification is necessary to achieve accurate current gains because ${V}_{DS1} \neq  {V}_{DS2}$ . If ${I}_{1} = 2{I}_{3} = {100\mu }\mathrm{A}$ and the $W/L$ ratios are all ${10\mu }\mathrm{m}/{1\mu }\mathrm{m}$ , the small-signal input resistance is approximately ${33.7\Omega }$ .

Figure 5.4-5 (a) Current amplifier using negative shunt feedback to reduce ${R}_{\text{in }}$ . (b) Small-signal model for calculating ${R}_{\text{in }}$ .
One of the disadvantages of using negative feedback to achieve low input resistances is that, at higher frequencies, the loop gain will decrease and the input resistance will increase. One must also be careful of the poles in the feedback loop, which will become zeros in the closed loop response. Often, these zeros will be close to other poles, resulting in a pole-zero doublet that can cause a slow transient response to be superimposed on the normal transient response [6].
## Differential-Input Current Amplifiers
A differential-input current amplifier is shown in Fig. 5.4-6. Let us now consider the implementation of such an amplifier. The differential-input current amplifier should have an output current relationship similar to the differential-input voltage amplifier of Eq. (5.2-5). Using Fig. 5.4-6, this relationship can be written as
$$
{i}_{O} = {A}_{ID}{i}_{ID} \pm  {A}_{IC}{i}_{IC} = {A}_{ID}\left( {{i}_{1} - {i}_{2}}\right)  \pm  {A}_{IC}\left( \frac{{i}_{1} + {i}_{2}}{2}\right)  \tag{5.4-15}
$$
where ${A}_{ID}$ is the differential-mode current gain and ${A}_{IC}$ is the common-mode current gain. The common-mode current gain is the result of imperfections in matching between the two inputs.
A straightforward implementation of a differential-input current amplifier is shown in Fig. 5.4-7(a). This implementation is based on an input-current differential amplifier using bipolar transistors [7]. The dc current sources at the input are necessary and should be larger than at least twice the maximum possible value of currents ${i}_{1}$ and ${i}_{2}$ . Note that the $W/L$ ratio of M3 and M4 can be used to achieve current gain. If more current gain is needed or a

Figure 5.4-6 Definitions for the differential-mode, $\left( {i}_{ID}\right)$ , and common-mode, $\left( {i}_{IC}\right)$ , input currents of the differential-input current amplifier.

Figure 5.4-7 (a) Current-mirror differential-input current amplifier. (b) Alternate differential-input current amplifier.
higher output resistance is required, the output can be modified accordingly. The current amplifier shown in Fig. 5.4-5(a) could be used to replace M1-M2 and M3-M4 to achieve a much lower input resistance. The differential-input current amplifier of Fig. 5.4-7(b) is an alternative approach. Both implementations have a small-signal input resistance of approximately $1/{g}_{m}$ . Note that both differential-input current amplifiers have a defined dc input potential. In some cases, the dc input potential can be adjusted by an external input [8].
This section has introduced the concept of a current amplifier and shown how it can be implemented in CMOS technology. The primary concern of a current amplifier is to achieve low input resistance. If feedback is not used, the smallest small-signal resistance achievable with MOSFETs is $1/{g}_{m}$ . There are many other configurations of current amplifiers, one of which uses the regulated cascode current mirror (see Problems 5.4-7 and 5.4-8). Current amplifiers will find applications in low-voltage and in switched-current circuits.

### 5.5 Output Amplifiers
The primary objective of an output amplifier is to efficiently drive signals into an output load. The output load may consist of a resistor, or a capacitor, or both. In general, the output resistor will be small, in the range of ${50} - {1000\Omega }$ , and the output capacitor will be large, in the range of $5 - {1000}\mathrm{{pF}}$ . The output amplifier should be capable of providing sufficient output signal (voltage, current, or power) into these types of loads.
The primary requirement of an output amplifier to drive a low-load resistor is to have a small-signal output resistance that is equal to or smaller than the load resistor. None of the three types of CMOS amplifiers considered so far have this characteristic although the output resistance of the active load inverters can approach ${1000\Omega }$ . The primary requirement for an output amplifier to drive a large capacitance is the ability to output a large sink or source current. An amplifier driving a large capacitance does not need to have a low output resistance.
The primary objective of the CMOS output amplifier is to function as a current transformer. Most output amplifiers have a high current gain and a low voltage gain. The specific requirements of an output stage might be (1) provide sufficient output power in the form of voltage or current, (2) avoid signal distortion, (3) be efficient, and (4) provide protection from abnormal conditions (short circuit, overtemperature, etc.). The second requirement results from the fact that the signal swings are large and that nonlinearities normally not encountered in small-signal amplifiers will become important. The third requirement is born out of the need to minimize power dissipation in the driver transistors themselves compared with that dissipated in the load. The fourth requirement is normally met with CMOS output stages since MOS devices are, by nature, thermally self-limiting.
We shall consider several approaches to implementing the output amplifier in this section. These approaches include the Class A amplifier, source followers, the push-pull amplifier, the use of the substrate bipolar junction transistor (BJT), and the use of negative feedback. Each one of these amplifiers will be considered briefly from the viewpoint of each of the above applicable requirements.
## Class A Amplifiers
In order to reduce the output resistance and increase the current driving capability, a straightforward approach is simply to increase the bias current in the output stage. Figure 5.5-1(a) shows a CMOS inverter with a current-source load. The load of this inverter consists of a resistance ${R}_{L}$ and a capacitance ${C}_{L}$ . There are several ways to specify the performance of the output amplifier. One is to specify the ac output resistance of the amplifier, which in the case of Fig. 5.5-1 is
$$
{r}_{\text{out }} = \frac{1}{{g}_{ds1} + {g}_{ds2}} = \frac{1}{\left( {{\lambda }_{1} + {\lambda }_{2}}\right) {I}_{D}} \tag{5.5-1}
$$
Another is to specify the output swing ${V}_{P}$ for a given ${R}_{L}$ . In this case, the maximum current to be sourced or sunk is equal to ${V}_{p}/{R}_{L}$ . The maximum sinking current of the simple output stage of Fig. 5.5-1 is given as
$$
{I}_{\mathrm{{OUT}}}^{ - } = \frac{{K}_{1}^{\prime }{W}_{1}}{2{L}_{1}}{\left( {V}_{DD} - {V}_{SS} - {V}_{T1}\right) }^{2} - {I}_{Q} \tag{5.5-2}
$$
where it has been assumed that ${v}_{\mathrm{{IN}}}$ can be taken to ${V}_{DD}$ . The maximum sourcing current of the simple output stage of Fig. 5.5-1 is given as
$$
{I}_{\mathrm{{OUT}}}^{ + } = \frac{{K}_{2}^{\prime }{W}_{2}}{2{L}_{2}}{\left( {V}_{DD} - {V}_{GG2} - \left| {V}_{T2}\right| \right) }^{2} \leq  {I}_{Q} \tag{5.5-3}
$$
where ${I}_{Q}$ is the dc current provided by the current source, M2. It can be seen from Eqs. (5.5-2) and (5.5-3) that the maximum sourcing current will typically be the limit of the output current. Generally, ${I}_{\mathrm{{OUT}}}^{ - } > {I}_{\mathrm{{OUT}}}^{ + }$ because ${v}_{\mathrm{{IN}}}$ can be taken to ${V}_{DD}$ strongly turning $\mathrm{M}1$ on and ${I}_{Q}$ is a fixed current that is normally a constant.

Figure 5.5-1 (a) Class A amplifier. (b) Load line for the amplifier of (a).
The capacitor ${C}_{L}$ of Fig. 5.5-1 also places a requirement on the output current through the slew-rate specification. This limit can be expressed as
$$
\left| {I}_{\mathrm{{OUT}}}\right|  \cong  {C}_{L}\left( \frac{d{v}_{\mathrm{{OUT}}}}{dt}\right)  = {C}_{L}\left( {SR}\right)  \tag{5.5-4}
$$
This approximation becomes poor when the load resistance shunting ${C}_{L}$ is low enough to divert a significant portion of ${I}_{\mathrm{{OUT}}}$ , making it unavailable as charging current. For such cases, the familiar exponential relationship describing the voltage across ${C}_{L}$ is needed for accuracy. Therefore, when designing an output stage, it is necessary to consider the effects of both ${R}_{L}$ and ${C}_{L}$ .
The small-signal performance of the Class A output amplifier of Fig. 5.5-1 has already been analyzed in Section 5.1. Figure 5.5-2 gives a small-signal model of Fig. 5.5-1 that includes the load capacitance and resistance. We can modify these results to include the load resistance and capacitance as follows. The small-signal voltage gain is
$$
\frac{{v}_{\text{out }}}{{v}_{\text{in }}} = \frac{-{g}_{m1}}{{g}_{ds1} + {g}_{ds2} + {G}_{L}} \tag{5.5-5}
$$
The small-signal output resistance is given by Eq. (5.1-21). The Class A output amplifier has a zero at
$$
z = \frac{{g}_{m1}}{{C}_{gd1}} \tag{5.5-6}
$$
and a pole at
$$
p = \frac{-\left( {{g}_{ds1} + {g}_{ds2} + {G}_{L}}\right) }{{C}_{gd1} + {C}_{gd2} + {C}_{bd1} + {C}_{bd2} + {C}_{L}} \tag{5.5-7}
$$
---
Example 5.5-1
---
## Design of a Simple Class A Output Stage
Use the values of Table 3.1-2 and design the $W/L$ ratios of M1 and M2 so that a voltage swing of $\pm  2\mathrm{\;V}$ and a slew rate of $\sim  1\mathrm{\;V}/\mu \mathrm{s}$ is achieved if ${R}_{L} = {20}\mathrm{k}\Omega$ and ${C}_{L} = {1000}\mathrm{{pF}}$ . Assume that ${V}_{DD} =  - \left| {V}_{SS}\right|  = 3\mathrm{\;V}$ and ${V}_{GG2} = 0\mathrm{\;V}$ . Let the channel lengths be ${2\mu }\mathrm{m}$ and assume that ${C}_{gd1} = {100}\mathrm{{fF}}$ .
## SOLUTION
Let us first consider the effects of ${R}_{L}$ . The peak output current must be $\pm  {100\mu }\mathrm{A}$ . In order to meet the ${SR}$ requirements a current magnitude of $\pm  1\mathrm{\;{mA}}$ is needed to charge the load capacitance. Since this current is so much larger than the current needed to meet the voltage specification across ${R}_{L}$ , we can safely assume that all of the current supplied by the inverter is available to charge ${C}_{L}$ . Using a value of $\pm  1\mathrm{\;{mA}},{W}_{1}/{L}_{1}$ needs to be approximately ${3\mu }\mathrm{m}/2$ $\mu \mathrm{m}$ and ${W}_{2}/{L}_{2},{15\mu }\mathrm{m}/{2\mu }\mathrm{m}$ .

Figure 5.5-2 Small-signal model for Fig. 5.5-1.
The small-signal gain of this amplifier is $- {8.21}\mathrm{\;V}/\mathrm{V}$ . This voltage gain is low because of the low output resistance in shunt with ${R}_{L}$ . The output resistance of the amplifier is ${50}\mathrm{k}\Omega$ . The zero is located at ${1.59}\mathrm{{GHz}}$ and the pole is located at $- {11.14}\mathrm{{kHz}}$ .
Efficiency is defined as the ratio of the power dissipated in ${R}_{L}$ to the power required from the power supplies. From Fig. 5.5-1(b), the efficiency is given as
$$
\text{ Efficiency } = \frac{{P}_{RL}}{{P}_{\text{Supply }}} = \frac{\frac{{v}_{\text{OUT }}{\left( \text{ peak }\right) }^{2}}{2{R}_{L}}}{\left( {{V}_{DD} - {V}_{SS}}\right) {I}_{Q}} = \frac{\frac{{v}_{\text{OUT }}{\left( \text{ peak }\right) }^{2}}{2{R}_{L}}}{\left( {{V}_{DD} - {V}_{SS}}\right) \left( \frac{{V}_{DD} - {V}_{SS}}{2{R}_{L}}\right) } \tag{5.5-8}
$$
$$
= {\left( \frac{{v}_{\mathrm{{OUT}}}\left( \text{ peak }\right) }{{V}_{DD} - {V}_{SS}}\right) }^{2}
$$
The maximum efficiency of the Class A output stage occurs when ${v}_{\mathrm{{OUT}}}\left( \text{peak}\right)$ is ${0.5}\left( {{V}_{DD} - }\right.$ ${V}_{SS}$ ), which is ${25}\%$ .
An amplifier's distortion can be characterized by the influence of the amplifier upon a pure sinusoidal signal. Distortion is caused by the nonlinearity of the transfer curve of the amplifier. If a pure sinusoid given as
$$
{V}_{in}\left( \omega \right)  = {V}_{p}\sin \left( {\omega t}\right)  \tag{5.5-9}
$$
is applied to the input, the output of an amplifier with distortion will be
$$
{V}_{\text{out }}\left( \omega \right)  = {a}_{1}{V}_{p}\sin \left( {\omega t}\right)  + {a}_{2}{V}_{p}\sin \left( {2\omega t}\right)  + \cdots  + {a}_{n}{V}_{p}\sin \left( {n\omega t}\right)  \tag{5.5-10}
$$
Harmonic distortion (HD) for the $i$ th harmonic can be defined as the ratio of the magnitude of the $i$ th harmonic to the magnitude of the fundamental. For example, second-harmonic distortion would be given as
$$
H{D}_{2} = \frac{{a}_{2}}{{a}_{1}} \tag{5.5-11}
$$
Total harmonic distortion (THD) is defined as the square root of the ratio of the sum of all of the second and higher harmonics to the magnitude of the first or fundamental harmonic. Thus, ${THD}$ can be expressed in terms of Eq. (5.5-10) as
$$
{THD} = \frac{{\left\lbrack  {a}_{2}^{2} + {a}_{3}^{2} + \cdots  + {a}_{n}^{2}\right\rbrack  }^{1/2}}{{a}_{1}} \tag{5.5-12}
$$
The distortion of Fig. 5.5-1 for maximum output swings will not be good because of the nonlinearity of the voltage-transfer curve for large-signal swing as shown in Section 5.1.
## Source Followers
A second approach to implementing an output amplifier is to use the common-drain or source-follower configuration of the MOS transistor. This configuration has both large current gain and low output resistance. Unfortunately, since the source is the output node, the MOS device becomes dependent on the body effect. The body effect causes the threshold voltage ${V}_{T}$ to increase as the output voltage is increased, creating a situation where the maximum output is substantially lower than ${V}_{DD}$ . Figure 5.5-3 shows two configurations for the CMOS source follower. It is seen that two n-channel devices are used, rather than a p-channel and an n-channel.
The large-signal considerations of the source follower will illustrate one of its disadvantages. Figure 5.5-3 shows that ${v}_{\mathrm{{OUT}}}\left( \min \right)$ can be essentially ${V}_{SS}$ because when ${v}_{\mathrm{{IN}}}$ approaches ${V}_{SS}$ , the current through M2 goes to zero, allowing the output voltage to go to zero. This result assumes that no current is required by the external load. If the source follower must sink external load current, then ${v}_{\mathrm{{OUT}}}\left( \min \right)$ will be greater than ${V}_{SS}$ . The maximum value of ${v}_{\mathrm{{OUT}}}$ is given as
$$
{v}_{\mathrm{{OUT}}}\left( \max \right)  = {V}_{DD} - {V}_{T1} - {V}_{ON1} \approx  {V}_{DD} - {V}_{T1} \tag{5.5-13}
$$
assuming that ${v}_{\mathrm{{IN}}}$ can be taken to ${V}_{DD}$ and no output current is flowing. However, ${V}_{T1}$ is a function of ${v}_{\mathrm{{OUT}}}$ so that we must substitute Eq. (3.1-2) into Eq. (5.5-13) and solve for ${v}_{\mathrm{{OUT}}}$ . To simplify the mathematics, we approximate Eq. (3.1-2) as
$$
{V}_{T1} \cong  {V}_{T0} + \gamma \sqrt{{v}_{SB}} = {V}_{T01} + {\gamma }_{1}\sqrt{{v}_{\text{out }}\left( \max \right)  - {V}_{SS}} \tag{5.5-14}
$$
Substituting Eq. (5.5-14) into Eq. (5.5-13) and solving for ${v}_{\text{OUT }}$ gives
$$
{v}_{\mathrm{{OUT}}}\left( \max \right)  \cong  {V}_{DD} + \frac{{\gamma }_{1}^{2}}{2} - {V}_{T01} - \frac{{\gamma }_{1}}{2}\sqrt{{\gamma }_{1}^{2} + 4\left( {{V}_{DD} - {V}_{SS} - {V}_{T01}}\right) } \tag{5.5-15}
$$
Using the nominal values of Table 3.1-2 and assuming that ${V}_{DD} =  - \left| {V}_{SS}\right|  = {2.5}\mathrm{\;V}$ , we find that ${v}_{\mathrm{{OUT}}}\left( \max \right)$ is approximately ${1.46}\mathrm{\;V}$ . This limit could be alleviated in a p-well process by placing M1 in its own p-well and connecting source to bulk.
The maximum output-current sinking and sourcing of the source follower is considered next. The maximum output-current sinking is determined by M2 just like the maximum output-current sourcing of M2 in Fig. 5.5-1. The maximum output-current sourcing is determined by M1 and ${v}_{\mathrm{{IN}}}$ . If we assume that ${v}_{\mathrm{{IN}}}$ can be taken to ${V}_{DD}$ , then the maximum value of ${I}_{\mathrm{{OUT}}}$ is given by
$$
{I}_{\mathrm{{OUT}}}^{ + } = \frac{{K}_{1}^{\prime }{W}_{1}}{2{L}_{1}}{\left\lbrack  {V}_{DD} - {v}_{\mathrm{{OUT}}} - {V}_{T1}\right\rbrack  }^{2} - {I}_{D2} \tag{5.5-16}
$$

Figure 5.5-3 (a) Source follower with an MOS diode load. (b) Source follower with a current-sink load.
Assuming a ${W}_{1}/{L}_{1}$ of 10, using the value of ${v}_{\mathrm{{OUT}}}$ of $0\mathrm{\;V}$ , and assuming ${I}_{\mathrm{D}2} = {0.5}\mathrm{\;{mA}}$ , the value of ${V}_{T1}$ is ${1.08}\mathrm{\;V}$ , giving a maximum value of ${I}_{\mathrm{{OUT}}}$ equal to ${0.608}\mathrm{\;{mA}}$ . However, as ${v}_{\mathrm{{OUT}}}$ increases above $0\mathrm{\;V}$ , the current rapidly decreases.
The maximum output-current sinking is determined by M2 of Fig. 5.5-3. In Fig. 5.5-3(a), the maximum output-current sinking is equal to the output voltage across the gate-drain-connected transistor. This current will decrease as ${v}_{\mathrm{{OUT}}}$ approaches zero. For Fig. 5.5-3(b), the maximum output-current sinking is determined by the value of ${V}_{GG}$ and the transistor and can be set to any value. Of course, this current will flow through the follower when no signal is applied and will dissipate power that will reduce the efficiency.
The efficiency of the source follower can be shown to be similar to the Class A amplifier of Fig. 5.5-1 (see Problem P5.5-7). The distortion of the source follower will be better than the Class A amplifier because of the inherent negative feedback of the source follower.
Figure 5.5-4 shows the small-signal model for the source follower of Fig. 5.5-3(a). If ${g}_{m2}$ is set to zero, this model is appropriate for Fig. 5.5-3(b). The effect of the bulk is implemented by the ${g}_{mbs1}$ transconductance. The small-signal voltage gain can be found as
$$
\frac{{V}_{\text{out }}}{{V}_{\text{in }}} = \frac{{g}_{m1}}{{G}_{L} + {g}_{ds1} + {g}_{ds2} + {g}_{m1} + {g}_{mbs1} + {g}_{m2}} \cong  \frac{{g}_{m1}}{{g}_{m1} + {g}_{mbs1} + {g}_{m2} + {G}_{L}} \tag{5.5-17}
$$
If we assume that ${V}_{DD} =  - {V}_{SS} = {2.5}\mathrm{\;V},{V}_{\text{out }} = 0\mathrm{\;V},{W}_{1}/{L}_{1} = {10\mu }\mathrm{m}/{1\mu }\mathrm{m},{W}_{2}/{L}_{2} = {1\mu }\mathrm{m}/$ ${1\mu }\mathrm{m},{G}_{L} = 0$ , and ${I}_{D} = {500\mu }\mathrm{A}$ , then using the parameters of Table 3.1-2 we find that the small-signal voltage gain of Fig. 5.5-3(a) is 0.682. If the bulk effect were not present, ${g}_{mbs1} =$ 0, the small-signal voltage gain would become 0.738 . For Fig. 5.5-3(b), we set ${g}_{m2} = 0$ to get a small-signal voltage gain of 0.869 and 0.963 if the bulk effects are ignored. Because of the bulk effect, the small-signal voltage gain of MOS source followers is always less than unity.
The output resistance of the source followers of Fig. 5.5-3 can be found from the small-signal model in Fig. 5.5-4 by setting ${v}_{\text{in }} = 0$ . The resulting small-signal output resistance is
$$
{R}_{\text{out }} = \frac{1}{{g}_{m1} + {g}_{mbs1} + {g}_{m2} + {g}_{ds1} + {g}_{ds2}} \tag{5.5-18}
$$
where ${g}_{m2} = 0$ for the source follower of Fig. 5.5-3(b) with a current-sink load. For the values above, the small-signal output resistance is ${651\Omega }$ for Fig. 5.5-3(a) and ${830\Omega }$ for Fig. 5.5-3(b). This level of output resistance is as small as possible in normal MOSFET circuits unless negative shunt feedback is used.

Figure 5.5-4 (a) Small-signal model for Fig. 5.5-3a. (b) Simplified small-signal model of (a).
The frequency response of the source follower is determined by two capacitances designated as ${C}_{1}$ and ${C}_{2}$ in the small-signal model of Fig. 5.5-4. ${C}_{1}$ consists of capacitances connected between the input and output of the source follower, which are primarily ${C}_{gs1}.{C}_{2}$ consists of capacitances connected from the output of the source follower to ground. This includes ${C}_{gd2}$ (or ${C}_{gs2}$ ), ${C}_{bd2},{C}_{bs1}$ , and ${C}_{L}$ of the next stage. The small-signal frequency response can be found as
$$
\frac{{V}_{\text{out }}\left( s\right) }{{V}_{\text{in }}\left( s\right) } = \frac{{g}_{m1} + s{C}_{1}}{{g}_{ds1} + {g}_{ds2} + {g}_{m1} + {g}_{mbs1} + {g}_{m2} + s\left( {{C}_{1} + {C}_{2}}\right)  + {G}_{L}} \tag{5.5-19}
$$
When ${G}_{L} = 0$ , the pole is located at approximately $- \left( {{g}_{m1} + {g}_{m2}}\right) /\left( {{C}_{1} + {C}_{2}}\right)$ , which is much greater than the dominant pole of the inverter, differential amplifier, or cascode amplifier. The presence of a left half-plane zero leads to the possibility that in most cases the pole and zero will provide some degree of cancellation, leading to a broadband response.
It is of interest to consider a push-pull-version of the source follower as shown in Fig. 5. 5-5(a). The floating batteries, ${V}_{\text{BIAS }}$ , are used to provide a gate-source bias to M1 and M2 in order to define the quiescent current in M1 and M2. Figure 5.5-5(b) shows the practical implementation of these batteries. An advantage of this circuit is that the currents are actively sourced and sunk. A disadvantage is that the output swings are at best limited to a threshold drop below the upper and above the lower power-supply voltages. These thresholds are increased due to the bulk effect and severely limit the output swing. (See Problem P5.5-12).
The efficiency of the push-pull-type amplifier can be much greater than the efficiency of the Class A amplifier. Push-pull amplifiers are called Class B or Class AB because the current in the output transistors is not flowing for the entire period of a sinusoidal output voltage. For a Class B, the current only flows in one transistor for ${180}^{ \circ  }$ of the ${360}^{ \circ  }$ period and for Class AB, the current only flows between ${180}^{ \circ  }$ and ${360}^{ \circ  }$ of the period. These concepts are illustrated in Fig. 5.5-6(a) for a Class B push-pull source follower and in Fig. 5.5-6(b) for a Class AB push-pull source follower.

Figure 5.5-5 (a) Push-pull, source follower. (b) Push-pull, source follower showing the implementation of the floating batteries, ${V}_{\text{BIAS }}$ .

Figure 5.5-6 Output voltage and current characteristics for the push-pull, source follower of Fig. 5.5-5(a) for (a) Class B and (b) Class AB operation. Operation in the shaded areas is not possible unless ${V}_{in}$ can be outside the rails.
For the Class A push-pull source follower of Fig. 5.5-6(a), M1 provides the current to the load ${R}_{L}\left( {1\mathrm{k}\Omega }\right)$ , when the output voltage is above zero. As ${v}_{\mathrm{{OUT}}}$ goes negative, M1 shuts off, and M2 sinks the current from the load ${R}_{L}$ . The crossover point between the two transistors is at the origin of Fig. 5.5-6(a). Figure 5.5-6(b) illustrates when the push-pull source follower operates in the Class AB mode. When the input voltage is above ${0.7}\mathrm{\;V}$ , only $\mathrm{M}1$ is on providing the current to the load. When the input voltage is between $- {0.7}\mathrm{\;V}$ and ${0.7}\mathrm{\;V}$ , both M1 and M2 are providing the currents to or from the load. When the input voltage is below -0.7 V, only M2 is on sinking current from the load. One important distinction between Class B and Class AB is that there is no bias current in the transistors when the output voltage is zero for the Class B. This means that the efficiency of the Class B will always be greater than that of Class AB. To minimize crossover distortion, it will be necessary to operate the push-pull follower slightly in Class AB mode.
The efficiency of a Class B amplifier can be calculated using the previous definition and assuming the output voltage is a sinusoid. The efficiency for a Class B amplifier can be expressed as
$$
\text{ Efficiency } = \frac{{P}_{RL}}{{P}_{\text{Supply }}} = \frac{\frac{{v}_{\text{OUT }}{\left( \text{ peak }\right) }^{2}}{2{R}_{L}}}{\left( {{V}_{DD} - {V}_{SS}}\right) \left( \frac{{v}_{\text{OUT }}\left( \text{ peak }\right) }{\pi {R}_{L}}\right) } = \frac{\pi }{2}\frac{{v}_{\text{OUT }}\left( \text{ peak }\right) }{{V}_{DD} - {V}_{SS}} \tag{5.5-20}
$$
The term ${v}_{\mathrm{{OUT}}}\left( \text{peak}\right) /\pi {R}_{L}$ in the denominator of the middle expression of Eq. (5.5-20) represents the average current flow for a half-wave rectified sinusoid. The maximum efficiency occurs when ${v}_{\mathrm{{OUT}}}$ (peak) is the largest, i.e. ${0.5}\left( {{V}_{DD} - {V}_{SS}}\right)$ , and is ${78.5}\%$ . The Class AB amplifier will have an efficiency between Eq. (5.5-20) and Eq. (5.5-8) depending on the biasing in Fig. 5.5-5.
The small-signal performance of the push-pull source follower of Fig. 5.5-5(a) can be determined from the small-signal model shown in Fig. 5.5-7. The small-signal voltage gain is given as
$$
\frac{{v}_{\text{out }}}{{v}_{\text{in }}} = \frac{{g}_{m1} + {g}_{m2}}{{g}_{ds1} + {g}_{ds2} + {g}_{m1} + {g}_{mbs1} + {g}_{m2} + {g}_{mbs2} + {G}_{L}} \tag{5.5-21}
$$
The small-signal output resistance ${R}_{\text{out }}$ is found as
$$
{R}_{\text{out }} = \frac{1}{{g}_{ds1} + {g}_{ds2} + {g}_{m1} + {g}_{mbs1} + {g}_{m2} + {g}_{mbs2} + {G}_{L}} \tag{5.5-22}
$$

Figure 5.5-7 (a) Small-signal model for Fig. 5.5-5(a). (b) Simplified small-signal model of (a).
If ${V}_{DD} = 5\mathrm{\;V}$ and the output is at ${2.5}\mathrm{\;V}$ , the value of bias current in $\mathrm{M}1$ and $\mathrm{M}2$ is ${500\mu }\mathrm{A}$ , the $W/L$ values are ${20\mu }\mathrm{m}/{2\mu }\mathrm{m}$ , the small-signal voltage gain is 0.895, and the small-signal output resistance is ${510\Omega }$ . A zero exists at
$$
z = \frac{{g}_{m1} + {g}_{m2}}{{C}_{1}} \tag{5.5-23}
$$
and a pole at
$$
p = \frac{-1}{\left( {{C}_{1} + {C}_{2}}\right) \left( {{g}_{ds1} + {g}_{ds2} + {g}_{m1} + {g}_{mbs1} + {g}_{m2} + {g}_{mbs2} + {G}_{L}}\right) } \tag{5.5-24}
$$
These roots will be high frequency because the resistance seen by the capacitors ${C}_{1}$ and ${C}_{2}$ are small. The above analysis assumes that both transistors are on (Class AB). If the push-pull source follower is operating in Class B, then either ${g}_{m1}$ and ${g}_{mbs1}$ or ${g}_{m2}$ and ${g}_{mbs2}$ must be zero.
## Push-Pull Common-Source Amplifiers
A third method of designing output amplifiers is to use the push-pull amplifier. The push-pull amplifier has the advantage of better efficiency. It is well known that a Class B push-pull amplifier has a maximum efficiency of 78.5%, which means that less quiescent current is needed to meet the output-current demands of the amplifier. Smaller quiescent currents imply smaller values of $W/L$ and smaller area requirements. There are many versions of the push-pull amplifier. For example, Fig. 5.5-1 could be a push-pull amplifier if the gate of $\mathrm{M}2$ is simply connected to ${v}_{\mathrm{{IN}}}$ . This configuration has the disadvantage that large quiescent current flows when operated in the high-gain region (i.e., Class AB operation). If voltage sources ${V}_{TR1}$ and ${V}_{TR2}$ are inserted between the gates as shown in Fig. 5.5-8, then higher efficiency can be obtained. The usefulness of this circuit is shown by considering the case when ${v}_{\mathrm{{IN}}}$ is precisely at the threshold of the n-channel device and ${V}_{TR1}$ and ${V}_{TR2}$ are such that the p-channel device is also operating at the verge of turn-on. If ${v}_{\mathrm{{IN}}}$ is perturbed in the positive direction, then the p-channel device turns off and all of the current in the n-channel sinks the load current. Similar action occurs when ${v}_{\mathrm{{IN}}}$ is perturbed negatively, with the result that all of the load current is sourced by the p-channel device. One can easily see that no current is wasted because all of the current supplied flows into (or out of) the load. This configuration does not reduce the output resistance although the distortion will be slightly improved because of the symmetry of the voltage-transfer curve around the midpoint.

Figure 5.5-8 Push-pull inverting CMOS amplifier.
An example of how Fig. 5.5-8 might be implemented is illustrated in Fig. 5.5-9. The operation (Class AB or B) can be determined by the voltages at the gates of M3 and M4. When the input is taken positive, the current in M1 increases and the current in M2 decreases. If the operation is Class B, then M2 turns off. As the current in M1 increases, it is mirrored as an increasing current in M8, which provides the sinking capability for the output current. When ${v}_{\mathrm{{IN}}}$ is decreased, $\mathrm{M}6$ can source output current.
The characteristics similar to Fig. 5.5-6 for the push-pull source follower can be illustrated for the push-pull inverting amplifier. Figure 5.5-10 shows the output voltage and current characteristics for the push-pull inverting amplifier of Fig. 5.5-8 operating in the Class B and Class AB modes. The $W/L$ of the NMOS transistor is ${20\mu }\mathrm{m}/{1\mu }\mathrm{m}$ , the $W/L$ of the PMOS transistor is ${40\mu }\mathrm{m}/{1\mu }\mathrm{m}$ , and the load resistor is $1\mathrm{k}\Omega$ . The improved linearity of the Class AB over Class B is very apparent. It can be shown that the efficiency of the Class B and Class AB push-pull inverting amplifiers is the same as for the Class B and Class AB push-pull source followers.

Figure 5.5-10 Output voltage and current characteristics for the push-pull, common-source amplifier of Fig. 5.5-8 for (a) Class B and (b) Class AB operation. Operation in the shaded areas is not possible unless ${V}_{in}$ can be outside the rails.
In order to reduce the output resistance and decrease the area of output stages, the substrate bipolar junction transistor available in the standard CMOS process has been used. For example, in a p-well process, a substrate NPN BJT is available (see Section 2.5). Since the collector must be tied to ${V}_{DD}$ , the push-pull follower configuration is suitable for the substrate BJT. The advantage of using the BJT is that the output resistance is approximately $1/{g}_{m}$ , which for a BJT can be less than ${100\Omega }$ . The disadvantage of the BJT is that the positive and negative parts of the voltage-transfer curve are not symmetrical and therefore large distortion is encountered. Another disadvantage of the BJT is that as it begins to source more current, more base current is required. It is difficult for the driver to provide this base current when the base is approaching ${V}_{D\mathrm{D}}$ .
A technique that has proved very useful in lowering the output resistance of a CMOS output stage and maintaining its other desirable properties is the use of negative shunt feedback. The push-pull inverting CMOS amplifier of Fig. 5.5-8 is very attractive from all viewpoints but output resistance. Figure 5.5-11 shows a configuration using two differential-error amplifiers to sample the output and input and apply negative shunt feedback to the gates of the common-source MOS transistors. The error amplifiers must be designed to turn on M1 (or M2) to avoid crossover distortion and yet maximize efficiency. The output resistance will be approximately equal to that of Fig. 5.5-8 divided by the loop gain.

Figure 5.5-11 Use of negative feedback to reduce the output resistance of Fig. 5.5-8.

Figure 5.5-12 Use of negative resistor feedback to reduce the output resistance of Fig. 5.5-8.
If the push-pull amplifier has sufficient gain, the error amplifiers can be replaced by a resistive feedback network as shown in Fig. 5.5-12. The resistors could be polysilicon or could be MOS transistors properly biased. If the resistors were equal, the output resistance of Fig. 5.5-8 would be divided by approximately ${g}_{m1}{R}_{L}/2$ (see Problem P5.5-15).
We have not discussed how to protect the output amplifier from abnormal conditions. This subject and others not included in this section are best left to specific applications in the following chapters. The general principles of output amplifiers have been identified and illustrated.

### 5.6 Summary
This chapter has introduced the important subject of basic CMOS amplifiers. The inverter, differential, cascode, current, and output amplifiers were presented. We then saw how the various stages could be assembled to implement a high-gain amplifier and identified the generic building blocks at the simple circuit level. Although we have now covered the primary building blocks, many different implementations have yet to be considered. Specific implementations will be given as needed in the use of simple circuits to realize complex circuits and complex circuits to realize systems.
The principles introduced in this chapter include the method of characterizing an amplifier from both a large-signal and small-signal basis. The dependence of small-signal performance on the dc or large-signal conditions continued to be evident and is a very important principle to grasp. Another important problem is that the analysis of a circuit can quickly become complicated beyond the designer's ability to interpret the results. It is always necessary to simplify the analysis and concepts in design as much as possible. Otherwise, the intuitive aspects of the circuit can be lost to the designer. A computer can always be used to perform a more detailed and extensive analysis of the design, but the computer is not yet capable of making design decisions and performing the synthesis of complex analog circuits.
With the background now assimilated, we shall move into the study of more complex analog circuits. Chapters 6 through 8 will cover operational amplifiers and comparators.
## Problems
5.1-1. Assume that M2 in Fig. 5.1-2 is replaced by a ${10}\mathrm{k}\Omega$ resistor. Use the graphical technique illustrated in this figure to obtain a voltage-transfer function of M1 with a 10 $\mathrm{k}\Omega$ load resistor. What is the maximum and minimum output voltages if the input is taken from 0 to $5\mathrm{\;V}$ ?
5.1-2. Using the large-signal model parameters of Table 3.1-2, use Eqs. (5.1-1) and (5.1-5) to calculate the values of ${v}_{\mathrm{{OUT}}}\left( \max \right)$ and ${v}_{\mathrm{{OUT}}}\left( \min \right)$ for the inverter of Fig. 5.1-2. Assume that ${W}_{1}/{L}_{1} = {5\mu }\mathrm{m}/{1\mu }\mathrm{m}$ and ${W}_{2}/{L}_{2} = {1\mu }\mathrm{m}/{1\mu }\mathrm{m}.$
5.1-3. What value of ${\beta }_{1}/{\beta }_{2}$ will give a voltage swing of ${80}\%$ of ${V}_{DD}$ if ${V}_{T}$ is ${20}\%$ of ${V}_{DD}$ ? What is the small-signal voltage gain corresponding to this value of ${\beta }_{1}/{\beta }_{2}$ ?
5.1-4. What value of ${V}_{\text{in }}$ will give a current in the active load inverter of ${100\mu }\mathrm{A}$ if ${W}_{1}/{L}_{1} = 5$ $\mu \mathrm{m}/{1\mu }\mathrm{m}$ and ${W}_{2}/{L}_{2} = {2\mu }\mathrm{m}/{1\mu }\mathrm{m}$ ? For this value of ${V}_{\text{in }}$ , what is the small-signal voltage gain and output resistance assuming all transistors are saturated?
5.1-5. Repeat Example 5.1-1 if the drain current in M1 and M2 is ${50\mu }\mathrm{A}$ .
5.1-6. Assume that $W/L$ ratios of Fig. P5.1-6 are ${W}_{1}/{L}_{1} = {2\mu }\mathrm{m}/{1\mu }\mathrm{m}$ and ${W}_{2}/{L}_{2} = {W}_{3}/{L}_{3} =$ ${W}_{4}/{L}_{4} = {1\mu }\mathrm{m}/{1\mu }\mathrm{m}$ . Find the dc value of ${V}_{\text{in }}$ that will give a dc current in M1 of ${110\mu }\mathrm{A}$ . Calculate the small-signal voltage gain and output resistance of Fig. P5.1-6 using the parameters of Table 3.1-2 assuming all transistors are saturated.

Figure P5.1-6
5.1-7. Find the small-signal voltage gain and the $- 3\mathrm{\;{dB}}$ frequency in hertz for the active load inverter, the current-source inverter, and the push-pull inverter if ${W}_{1} = {2\mu }\mathrm{m}$ , ${L}_{1} = {1\mu }\mathrm{m},{W}_{2} = {1\mu }\mathrm{m},{L}_{2} = {1\mu }\mathrm{m}$ , and the dc current is ${50\mu }\mathrm{A}$ . Assume that ${C}_{gd1}$ $= 4\mathrm{{fF}},{C}_{bd1} = {10}\mathrm{{fF}},{C}_{gd2} = 4\mathrm{{fF}},{C}_{bd2} =$ ${10}\mathrm{{fF}},{C}_{gs2} = 5\mathrm{{fF}}$ , and ${C}_{L} = 1\mathrm{{pF}}$ .
5.1-8. What is the small-signal voltage gain of a current-sink inverter with ${W}_{1} = {2\mu }\mathrm{m}$ , ${L}_{1} = {1\mu }\mathrm{m}$ , and ${W}_{2} = {L}_{2} = {1\mu }\mathrm{m}$ at ${I}_{D} =$ 0.1,5, and ${100\mu }\mathrm{A}$ ? Assume that the parameters of the devices are given by Table 3.1-2. Also, assume the transistors are in weak inversion for ${I}_{D} = {0.1\mu }\mathrm{A}$ and that ${n}_{n} = {1.5}{n}_{p} = {2.5}$ for the weak inversion model of Section 3.5. Note, you must differentiate the large signal, weak-inversion model appropriately to find ${g}_{m}$ and ${g}_{ds}$ .
5.1-9. A CMOS amplifier is shown in Fig. P5.1-9. Assume M1 and M2 operate in the saturation region.
(a) What value of ${V}_{GG}$ gives ${100\mu }\mathrm{A}$ through M1 and M2?
(b) What is the dc value of ${v}_{\mathrm{{IN}}}$ ?
(c) What is the small signal voltage gain, ${v}_{\text{out }}/{v}_{\text{in }}$ , for this amplifier?
(d) What is the $- 3\mathrm{\;{dB}}$ frequency in hertz of this amplifier if ${C}_{gd1} = {C}_{gd2} = 5\mathrm{{fF}}$ , ${C}_{bd1} = {C}_{bd2} = {30}\mathrm{{fF}}$ , and ${C}_{L} = {500}\mathrm{{fF}}$ ?

Figure P5.1-9
5.1-10. A current-source load amplifier is shown in Fig. P5.1-10.
(a) If ${C}_{bdn} = {C}_{bdp} = {10}\mathrm{{fF}},{C}_{gdn} = {C}_{gdp} =$ $5\mathrm{{fF}},{C}_{gsn} = {C}_{gsp} = {10}\mathrm{{fF}}$ , and ${C}_{L} = 1$ $\mathrm{{pF}}$ , find the $- 3\mathrm{\;{dB}}$ frequency in hertz.
(b) If Boltzmann’s constant is ${1.38} \times$ ${10}^{-{23}}\mathrm{\;J}/\mathrm{K}$ , find the equivalent-input thermal noise voltage of this amplifier at room temperature (ignore bulk effects, $\left. {{g}_{mbs} = 0}\right)$ .

## Figure P5.1-10
5.1-11. Six inverters are shown in Fig. P5.1-11 Assume that ${K}_{N}^{\prime } = 2{K}_{P}^{\prime }$ and that ${\lambda }_{N} = {\lambda }_{P}$ , and the dc bias current through each inverter is equal. Qualitatively select, without using extensive calculations, which inverter(s) has/have (a) the largest ac small-signal voltage gain, (b) the lowest ac small-signal voltage gain, (c) the highest ac output resistance, and (d) the lowest ac output resistance. Assume all devices are in saturation.
5.1-12. Derive the expression given in Eq. (5.1-29) for the CMOS push-pull inverter of Fig. 5.1-8. If ${C}_{gd1} = {C}_{gd2} = 5\mathrm{{fF}},{C}_{bd1} = {C}_{bd2} =$ ${50}\mathrm{{fF}},{C}_{L} = {10}\mathrm{{pF}}$ , and ${I}_{D} = {200\mu }\mathrm{A}$ , find the small-signal voltage gain and the $- 3\mathrm{\;{dB}}$ frequency if ${W}_{1}/{L}_{1} = {W}_{2}/{L}_{2} = 5$ of the CMOS push-pull inverter of Fig. 5.1-8.
5.1-13. For the active-resistor load inverter, the current-source load inverter, and the push-pull inverter, compare the active channel area assuming the length is ${1\mu }\mathrm{m}$ if the gain is to be $- {100}\mathrm{\;V}/\mathrm{V}$ at a current of ${I}_{D} = {10\mu }\mathrm{A}$ and the PMOS transistor has a $W/L$ of 1 .
5.1-14. For the CMOS push-pull inverter shown in Fig. P5.1-14, find the small-signal voltage gain ${A}_{v}$ , the output resistance ${R}_{\text{out }}$ , and the $- 3\mathrm{\;{dB}}$ frequency ${f}_{-3\mathrm{\;{dB}}}$ if ${I}_{D} = {200\mu }\mathrm{A}$ , ${W}_{1}/{L}_{1} = {W}_{2}/{L}_{2} = {5\mu }\mathrm{m}/{1\mu }\mathrm{m},{C}_{gd1} = {C}_{gd2}$ $= 5\mathrm{{fF}},{C}_{bd1} = {C}_{bd2} = {30}\mathrm{{fF}}$ , and ${C}_{L} =$ 10 pF.

Figure P5.1-14
5.2-1. Use the parameters of Table 3.1-2 to calculate the small-signal, differential-in, differential-out transconductance ${g}_{md}$ and voltage gain ${A}_{v}$ for the n-channel input differential amplifier of Fig. 5.2-6 when ${I}_{SS} = {100\mu }\mathrm{A}$ and ${W}_{1}/{L}_{1} = {W}_{2}/{L}_{2} = {W}_{3}/{L}_{3} = {W}_{4}/{L}_{4} = 1$ , assuming that all channel lengths are equal and have a value of ${1\mu }\mathrm{m}$ . Repeat if ${W}_{1}/{L}_{1}$ $= {W}_{2}/{L}_{2} = {10}{W}_{3}/{L}_{3} = {10}{W}_{4}/{L}_{4} = 1$ .
5.2-2. Repeat Problem 5.2-1 for the p-channel input differential amplifier.

Figure P5.1-11
5.2-3. Develop the expressions for ${V}_{IC}\left( \max \right)$ and ${V}_{IC}\left( \min \right)$ for the p-channel input differential amplifier of Fig. 5.2-8.
5.2-4. Find the maximum input common-mode voltage, ${v}_{IC}\left( \max \right)$ , and the minimum input common mode voltage, ${v}_{IC}$ (min), of the n-channel input differential amplifier of Fig. 5.2-6. Assume all transistors have a $W/L$ of ${10\mu }\mathrm{m}/{1\mu }\mathrm{m}$ and are in saturation, and ${I}_{SS} = {10\mu }\mathrm{A}$ . What is the input common-mode voltage range for this amplifier?
5.2-5. Find the small-signal voltage gain, ${v}_{o}/{v}_{i}$ , of the circuit in Problem 5.2-4 if ${v}_{\text{in }} = {v}_{1} - {v}_{2}$ . If a ${10}\mathrm{{pF}}$ capacitor is connected to the output to ground, what is the $- 3\mathrm{\;{dB}}$ frequency for ${V}_{\text{out }}\left( {j\omega }\right) /{V}_{\mathrm{{IN}}}\left( {j\omega }\right)$ in hertz? (Neglect any device capacitances.)
5.2-6. For the CMOS differential amplifier of Fig. 5.2-6, find the small-signal voltage gain, ${v}_{\text{out }}/{v}_{\text{in }}$ , and the output resistance, ${R}_{\text{out }}$ , if ${I}_{SS} = {10\mu }\mathrm{A}$ and ${v}_{\text{in }} = {v}_{gs1} - {v}_{gs2}$ . If the gates of M1 and M2 are connected together, find the minimum and maximum common-mode input voltage if all transistors must remain in saturation (ignore bulk effects).
5.2-7. Find the value of the unloaded differential-transconductance gain, ${g}_{md}$ , and the unloaded differential-voltage gain, ${A}_{v}$ , for the p-channel input differential amplifier of Fig. 5.2-8 when ${I}_{SS} = {10\mu }\mathrm{A}$ and ${I}_{SS} =$ ${1\mu }\mathrm{A}$ . Use the transistor parameters of Table 3.1-2.
5.2-8. What is the slew rate of the differential amplifier in Problem 5.2-7 if a ${100}\mathrm{{pF}}$ capacitor is attached to the output?
5.2-9. Assume that the current mirror of Fig. 5.2-6 has an output current that is $5\%$ larger than the input current. Find the small-signal common-mode voltage gain assuming that ${I}_{SS}$ is ${100\mu }\mathrm{A}$ and the $W/L$ ratios are ${2\mu }\mathrm{m}/$ ${1\mu }\mathrm{m}$ for $\mathrm{M}1,\mathrm{\;M}2$ , and $\mathrm{M}5$ and ${1\mu }\mathrm{m}/{1\mu }\mathrm{m}$ for M3 and M4.
5.2-10. Use the parameters of Table 3.1-2 to calculate the differential-in to single-ended-output voltage gain of Fig. 5.2-10. Assume that ${I}_{SS}$ is ${50\mu }\mathrm{A}$ .
5.2-11. Perform a small-signal analysis of Fig. 5.2-11 that does not ignore ${r}_{ds1}$ . Compare your results with Eq. (5.2-27).
5.2-12. Find the expressions for the maximum and minimum input voltages, ${v}_{G1}\left( \max \right)$ and ${v}_{G1}\left( \min \right)$ , for the n-channel differential amplifier with enhancement loads shown in Fig. 5.2-10.
5.2-13. If all the devices in the differential amplifier of Fig. 5.2-10 are saturated, find the worst-case input offset voltage, ${V}_{OS}$ , if $\left| {V}_{Ti}\right|$ $= 1 \pm  {0.01}\mathrm{\;V}$ and ${\beta }_{i} = {10}^{-5} \pm  5 \times  {10}^{-7}$ $\mathrm{A}/{\mathrm{V}}^{2}$ . Assume that
$$
{\beta }_{1} = {\beta }_{2} = {10}{\beta }_{3} = {10}{\beta }_{4}
$$
and
$$
\frac{\Delta {\beta }_{1}}{{\beta }_{1}} = \frac{\Delta {\beta }_{2}}{{\beta }_{2}} = \frac{\Delta {\beta }_{3}}{{\beta }_{3}} = \frac{\Delta {\beta }_{4}}{{\beta }_{4}}
$$
Carefully state any assumptions that you make in working this problem.
5.2-14. Repeat Example 5.2-1 for a p-channel input differential amplifier.
5.2-15. Five different CMOS differential amplifier circuits are shown in Fig. P5.2-15. Use the intuitive approach of finding the small-signal current caused by the application of a small-signal input, ${v}_{\text{in }}$ , and write by inspection the approximate small-signal output resistance, ${R}_{\text{out }}$ , seen looking back into each amplifier and the approximate small-signal differential-voltage gain, ${v}_{\text{out }}/{v}_{\text{in }}$ . Your answers should be in terms of ${g}_{mi}$ and ${g}_{dsi}, i = 1$ through 8 . (If you have to work out the details by small-signal model analysis, this problem will take too much time.)
5.2-16. If the equivalent-input-noise voltage of each transistor of the differential amplifier of Fig. 5.2-6 is $1\mathrm{{nV}}/{\mathrm{{Hz}}}^{1/2}$ , find the equivalent-input-noise voltage for this amplifier if ${W}_{1}/{L}_{1} = {W}_{2}/{L}_{2} = {2\mu }\mathrm{m}/{1\mu }\mathrm{m}$ , ${W}_{3}/{L}_{3} = {W}_{4}/{L}_{4} = {1\mu }\mathrm{m}/{1\mu }\mathrm{m}$ , and ${I}_{SS} = {50}$ $\mu \mathrm{A}$ . What is the equivalent-output-noise current under these conditions?

5.2-17. Use the small-signal model of the differential amplifier using a current-mirror load given in Fig. 5.2-9(a) and solve for the ac voltage at the sources of M1 and M2 when a differential-input signal, ${v}_{id}$ , is applied. What is the reason that this voltage is not zero?
5.2-18. The circuit shown Fig. P5.2-18 is called a folded-current-mirror differential amplifier and is useful for low values of power supply. Assume that the $W/L$ value of each transistor is ${100\mu }\mathrm{m}/{1\mu }\mathrm{m}$ .
(a) Find the maximum input common-mode voltage, ${v}_{IC}\left( \max \right)$ , and the minimum input common-mode voltage, ${v}_{IC}$ (min). Keep all transistors in saturation for this problem.
(b) What is the input common-mode voltage range, ICMR?
(c) Find the small-signal voltage gain, ${v}_{\mathrm{o}}/{v}_{\mathrm{{in}}}$ , if ${v}_{\mathrm{{in}}} = {v}_{1} - {v}_{2}$ .
(d) If a ${10}\mathrm{{pF}}$ capacitor is connected to the output to ground, what is the $- 3\mathrm{{dB}}$ frequency for ${V}_{o}\left( {j\omega }\right) /{V}_{\text{in }}\left( {j\omega }\right)$ in hertz? (Neglect any device capacitance.)

Figure P5.2-18
5.2-19. Find an expression for the equivalent-input-noise voltage of Fig. P5.2-18, ${v}_{\mathrm{{eq}}}^{2}$ , in terms of the small-signal model parameters and the individual equivalent-input-noise voltages, ${v}_{ni}^{2}$ , of each of the transistors $(i = 1$ through 7). Assume M1 and M2, M3 and M4, and M6 and M7 are matched.
5.2-20. Find the small-signal transfer function ${V}_{3}\left( s\right) /{V}_{\text{in }}\left( s\right)$ of Fig. P5.2-20, where ${V}_{\text{in }} =$ ${V}_{1} - {V}_{2}$ , including the capacitors shown in algebraic form (in terms of the small-signal model parameters and capacitance). Evaluate the low-frequency gain and all
zeros and poles if $I = {200\mu }\mathrm{A}$ and ${C}_{1} = {C}_{2}$
$= {C}_{3} = {C}_{4} = 1\mathrm{{pF}}$ . Let all $W/L = {10}$ .

## Figure P5.2-20
5.2-21. For the differential-in, differential-out amplifier of Fig. 5.2-14, assume that all $W/L$ values are equal and that each transistor has approximately the same current flowing through it. If all transistors are in the saturation region, find an algebraic expression for the voltage gain, ${v}_{\text{out }}/{v}_{\text{in }}$ , and the differential output resistance, ${R}_{\text{out }}$ , where ${v}_{\text{out }} = {v}_{3} - {v}_{4}$ and ${v}_{\text{in }} = {v}_{1} - {v}_{2}.{R}_{\text{out }}$ is the resistance seen between the output terminals.
5.2-22. Derive the maximum and minimum input common-mode voltages for Fig. 5.2-16 assuming all transistors remain in saturation. What is the minimum power-supply voltage, ${V}_{DD}$ , that will give zero input common-mode range that is within 0 to ${V}_{DD}$ ?
5.2-23. Find the slew rate, ${SR}$ , of the differential amplifier shown in Fig. P5.2-23, where the output is differential (ignore common-mode stability problems). Repeat this analysis if the two current sources, ${0.5}{I}_{SS}$ , are replaced by resistors of ${R}_{L}$ .
5.2-24. If all the devices in the differential amplifier shown in Fig. 5.2-6 are saturated, find the worst-case input-offset voltage ${V}_{OS}$ using the parameters of Table 3.1-2. Assume that ${10}\left( {{W}_{4}/{L}_{4}}\right)  = {10}\left( {{W}_{3}/{L}_{3}}\right)  = {W}_{2}/{L}_{2} = {W}_{1}/{L}_{1} =$ ${10\mu }\mathrm{m}/{10\mu }\mathrm{m}$ . State and justify any assumptions used in working this problem.

Figure P5.2-23
## 5.2-25 (Design Problem-this problem is self- grading.)
You are to design a CMOS differential gain block with a single-ended output using $\pm  5\mathrm{\;V}$ power supplies and only MOSFETs that will optimize the following scoring formula over a temperature range from ${0}^{ \circ  }\mathrm{C}$ to ${55}^{ \circ  }\mathrm{C}.W/L$ values should be between 1 and 100 .
$$
\text{ SCORE } = \min \left( {\mathrm{{ICMR}},{10}}\right)  + \frac{10}{\left| {{10} - \text{ Voltage gain }}\right|  + 1}
$$
$$
+ \min \left( {\frac{{f}_{-3\mathrm{\;{dB}}}}{1\mathrm{{MHz}}},{10}}\right)  + \frac{10}{\max \left( {{P}_{\mathrm{{diss}}},1\mathrm{{mW}}}\right) } \leq  {40}
$$
You must simulate your design at ${0}^{ \circ  }\mathrm{C}$ and ${55}^{ \circ  }\mathrm{C}$ using the parameters shown below in the table. In addition, you must connect a 1 pF capacitor from every node to ground. (Do not let SPICE add the inherent capacitances of the MOSFETs.)
<table><tr><td>T = 27 °C</td><td>${\mathrm{K}}^{\prime }\left( {{\mu A}/{\mathrm{V}}^{2}}\right)$</td><td>${V}_{T}\left( V\right)$</td><td>$\lambda \left( {V}^{-1}\right)$</td><td>$\gamma \left( \sqrt{\mathrm{V}}\right)$</td><td>$\phi$ (V)</td></tr><tr><td>NMOS</td><td>25</td><td>0.75</td><td>0.01</td><td>0.8</td><td>0.6</td></tr><tr><td>PMOS</td><td>10</td><td>-0.75</td><td>0.02</td><td>0.4</td><td>0.6</td></tr></table>
From your simulations (please attach input files and output info), fill out the following table.
The minimum input common mode range, min. ICMR, is determined by the difference between the lowest ${V}_{IC}\left( \max \right)$ and the highest ${V}_{IC}\left( \min \right)$ . The maximum gain deviation is determined by the largest deviation from the nominal gain of 10 . The minimum ${f}_{-3\mathrm{{dB}}}$ is the lowest ${f}_{-3\mathrm{{dB}}}$ at either temperature. ${P}_{\text{diss }}$ is the largest total power dissipation at either temperature.
<table><tr><td>Temp.</td><td>${V}_{IC}\left( \max \right)$</td><td>${V}_{IC}\left( \min \right)$</td><td>Min. ICMR</td><td>Voltage Gain</td><td>Max. Gain Deviation</td><td>Min. ${f}_{-3\mathrm{\;{dB}}}$ (Hz)</td><td>${P}_{\text{diss }}$</td></tr><tr><td>${0}^{ \circ  }\mathrm{C}$</td><td/><td/><td/><td/><td/><td/><td/></tr><tr><td>${55}^{ \circ  }\mathrm{C}$</td><td/><td/><td/><td/><td/><td/><td/></tr></table>
The values entered in the above SCORE formula must come from computer simulation. You are responsible for providing the supporting information necessary to verify how you determined the value of your SCORE along with a labeled schematic of your circuit.
5.3-1. Calculate the small-signal voltage gain for the cascode amplifier of Fig. 5.3-2 assuming that the dc value of ${v}_{\mathrm{{IN}}}$ is selected to keep all transistors in saturation. Compare this value with the slope of the voltage-transfer function given in this figure.
5.3-2. Show how to derive Eq. (5.3-6) from Eqs. (5.3-3) through (5.3-5). Hint: Assume that ${V}_{GG2} - {V}_{T2}$ is greater than ${v}_{DS1}$ and express Eq. (5.3-4) as ${i}_{D2} \approx  {\beta }_{2}\left( {{V}_{GG2} - {V}_{T2}}\right) {v}_{DS2}$ . Solve for ${v}_{\text{OUT }}$ as ${v}_{DS1} + {v}_{DS2}$ and simplify accordingly.
5.3-3. Rederive Eq. (5.3-6) accounting for the channel modulation where pertinent.
5.3-4. Show that the small-signal input resistance looking in the source of $\mathrm{M}2$ of the cascode amplifier of Fig. 5.3-1 is equal to ${r}_{ds}$ if the simple current source M3 is replaced by a cascode current source.
5.3-5. Show how, by adding a dc current source from ${V}_{DD}$ to the drain of M1 in Fig. 5.3-1, the small-signal voltage gain can be increased. Derive an expression similar to that of Eq. (5.3-11) in terms of ${I}_{D1}$ and ${I}_{D4}$ , where ${I}_{D4}$ is the current of the added dc current source. If ${I}_{D2} = {10\mu }\mathrm{A}$ , what value for this current source would increase the voltage gain by a factor of 10 . How is the output resistance affected?
5.3-6. Assume that the dc current in each transistor in Fig. P5.3-6 is ${100\mu }\mathrm{A}$ . If all transistors have a $W/L$ of ${10\mu }\mathrm{m}/{1\mu }\mathrm{m}$ , find the small-signal voltage gain, ${v}_{\text{out }}/{v}_{\text{in }}$ , and the small-signal output resistance, ${R}_{\text{out }}$ , if all transistors are in the saturated region.

## Figure P5.3-6
5.3-7. Six versions of a cascode amplifier are shown in Fig. P5.3-7. Assume that ${K}_{N}^{\prime } =$ $2{K}_{P}^{\prime },{\lambda }_{P} = 2{\lambda }_{N}$ , all $W/L$ ratios of all devices are equal, and all bias currents in each device are equal. Identify which circuit or circuits have the following characteristics: (a) highest small-signal voltage gain, (b) lowest small-signal voltage gain, (c) highest output resistance, (d) lowest output resistance, (e) lowest power dissipation, (f) highest ${v}_{o}\left( \max \right) ,\left( \mathrm{g}\right)$ lowest ${v}_{o}\left( \max \right) ,\left( \mathrm{h}\right)$ highest ${v}_{o}\left( \min \right)$ ,(i) lowest ${v}_{o}\left( \min \right)$ , and (j) highest $- 3\mathrm{{dB}}$ frequency.
5.3-8. All $W/L$ ratios of all transistors in the amplifier shown in Fig. P5.3-8 are ${10\mu }\mathrm{m}/1$ $\mu \mathrm{m}$ . Find the numerical value of the small-signal voltage gain, ${v}_{\text{out }}/{v}_{\text{in }}$ , and the output resistance, ${R}_{\text{out }}$ .
5.3-9. Use the Miller simplification described in Appendix A on the capacitor ${C}_{2}$ of Fig. 5.3- 5(b) and derive an expression for the pole, ${p}_{1}$ , assuming that the reactance of ${C}_{2}$ at the frequency of interest is greater than ${R}_{3}$ . Compare your result with Eq. (5.3-32).

Figure P5.3-7

Figure P5.3-8
5.3-10. Consider the current-source load inverter of Fig. 5.1-5 and the simple cascode amplifier of Fig. 5.3-1. If the $W/L$ ratio for $\mathrm{M}2$ is 1 $\mu \mathrm{m}/{1\mu }\mathrm{m}$ and for $\mathrm{M}1$ is ${3\mu }\mathrm{m}/{1\mu }\mathrm{m}$ of Fig. 5.1-5, and ${W}_{3}/{L}_{3} = {1\mu }\mathrm{m}/{1\mu }\mathrm{m},{W}_{2}/{L}_{2} =$ ${W}_{1}/{L}_{1} = {3\mu }\mathrm{m}/{1\mu }\mathrm{m}$ for Fig. 5.3-1, compare the minimum output-voltage swing, ${v}_{\mathrm{{OUT}}}\left( \min \right)$ , of both amplifiers if ${V}_{GG2} = 0\mathrm{\;V}$ and ${V}_{GG3} = {2.5}\mathrm{\;V}$ when ${V}_{DD} =  - {V}_{SS} = 5\mathrm{\;V}$ .
5.3-11. Use nodal analysis techniques on the cas-code amplifier of Fig. 5.3-6(b) to find ${v}_{\text{out }}/{v}_{\text{in }}$ . Verify the result with Eq. (5.3-37).
5.3-12. Find the numerical value of the small-signal voltage gain, ${v}_{\text{out }}/{v}_{\text{in }}$ , for the circuit of Fig. P5.3-12. Assume that all devices are saturated and use the parameters of Table 3.1-2. Assume that the dc voltage drop across M7 keeps M1 in saturation.

Figure P5.3-12
5.3-13. A cascoded differential amplifier is shown in Fig. P5.3-13.
(a) Assume all transistors are in saturation and find an algebraic expression for the small-signal voltage gain, ${v}_{\text{out }}/{v}_{\text{in }}$ .
(b) Sketch how you would implement ${V}_{\text{BIAS }}$ . (Use a minimum number of transistors.)
(c) Suppose that ${I}_{7} + {I}_{8} \neq  {I}_{9}$ . What would be the effect on this circuit and how would you solve it? Show a schematic of your solution. You should have roughly the same gain and the same output resistance.

Figure P5.3-13
5.3-14. Design a cascode CMOS amplifier using Fig. 5.3-7 for the following specifications: ${V}_{DD} = 5\mathrm{\;V},{P}_{\text{diss }} \leq  {0.5}\mathrm{\;{mW}},\left| {A}_{v}\right|  \geq  {100}\mathrm{\;V}/\mathrm{V}$ , ${v}_{\mathrm{{OUT}}}\left( \max \right)  = {3.5}\mathrm{\;V},{v}_{\mathrm{{OUT}}}\left( \min \right)  = {1.5}\mathrm{\;V}$ , and slew rate of greater than $5\mathrm{\;V}/\mu \mathrm{s}$ for a 5 pF capacitor load. Verify your design by simulation.
5.4-1. Assume that ${i}_{o} = {A}_{i}\left( {{i}_{p} - {i}_{n}}\right)$ of the current amplifier shown in Fig. P5.4-1. Find ${v}_{\text{out }}/{v}_{\text{in }}$ and compare with Eq. (5.4-3).

Figure P5.4-1
5.4-2. The simple current mirror of Fig. 5.4-3 is to be used as a current amplifier. If the $W/L$ of $\mathrm{M}1$ is ${1\mu }\mathrm{m}/{1\mu }\mathrm{m}$ , design the $W/L$ ratio of $\mathrm{M}2$ to give a gain of 10 . If the value of ${I}_{1}$ is ${100\mu }\mathrm{A}$ , find the input and output resistances assuming the current sources ${I}_{1}$ and ${I}_{2}$ are ideal. What is the actual value of the current gain when the input current is ${50\mu }\mathrm{A}$ ?
5.4-3. The capacitances of M1 and M2 in Fig. P5.4-3 are ${C}_{gs1} = {C}_{gs2} = {20}\mathrm{{fF}},{C}_{gd1} = {C}_{gd2}$ $= 5\mathrm{{fF}}$ , and ${C}_{bd1} = {C}_{bd2} = {10}\mathrm{{fF}}$ . Find the low-frequency current gain, ${i}_{\text{out }}/{i}_{\text{in }}$ , the input resistance seen by ${i}_{\text{in }}$ , the output resistance looking into the drain of M2, and the $- 3\mathrm{\;{dB}}$ frequency in hertz.

Figure P5.4-3
5.4-4. Derive an expression for the small-signal input resistance of the current amplifier of Fig. 5.4-5(a). Assume that the current sink, ${I}_{3}$ , has a small-signal resistance of ${r}_{ds4}$ in your derivation.
5.4-5. Use the intuitive analysis method to determine an expression for the input resistance, output resistance, and current gain of the current amplifier realization shown in Fig. P5.4-5. Assume ${g}_{mN} = 2{g}_{mP}$ and ${r}_{dsP} = 2{r}_{dsN}$ .

Figure P5.4-5
5.4-6. Show how to use the improved high-swing cascode current mirror of Section 4.4 to implement Fig. 5.4-7(a). Design the current amplifier so that the input resistance is $1\mathrm{\;k}\Omega$ and the dc bias current flowing into the input is ${100\mu }\mathrm{A}$ (when no input current signal is applied) and the dc voltage at the input is ${1.0}\mathrm{\;V}$ .
5.4-7. Show how to use the regulated cascode mirror of Section 4.4 to implement a single-ended input current amplifier. Calculate an algebraic expression for the small-signal input and output resistances of your current amplifier.
5.4-8. Find the exact expression for the small-signal input resistance of the circuit shown in Fig. P5.4-8 when the output is short-circuited. Assume all transistors have identical $W/L$ ratios and are in saturation; ignore the bulk effects. Simplify your expression by assuming that ${g}_{m} = {100}{g}_{ds}$ and that all transistors are identical. Sketch a plot of ${i}_{\text{out }}$ as a function of ${i}_{\text{in }}$ .

Figure P5.4-8
5.4-9. Find the exact small-signal expression for ${R}_{\text{in }}$ for the circuit in Fig. P5.4-9. Assume ${V}_{DC}$ causes the current flow through M1 and M2 to be identical. Assume M1 and M2 are identical transistors and that the small-signal ${r}_{ds}$ of M5 can be ignored (do not neglect ${r}_{ds1}$ and ${r}_{ds2}$ ).

Figure P5.4-9
5.4-10. A CMOS current amplifier is shown in Fig. P5.4-10. Find the small-signal values of the current gain, ${A}_{i} = {i}_{\text{out }}/{i}_{\text{in }}$ ; input resistance, ${R}_{\text{in }}$ ; and output resistance, ${R}_{\text{out }}$ . For ${R}_{\text{out }}$ , assume that ${g}_{ds2}/{g}_{m6}$ is equal to ${g}_{ds1}/{g}_{m5}$ . Use the parameters of Table 3.1-3.

Figure P5.4-10
5.4-11. Find the exact algebraic expression (ignoring bulk effects) for the following characteristics of the amplifier shown in Fig. P5.4-11. Express your answers in terms of ${g}_{m}$ and ${r}_{ds}$ in the form of the ratio of two polynomials.
(a) The small-signal voltage gain, ${A}_{v} =$ ${v}_{\text{out }}/{v}_{\text{in }}$ , and current gain, ${A}_{i} = {i}_{\text{out }}/{i}_{\text{in }}$
(b) The small-signal input resistance, ${R}_{\text{in }}$
(c) The small-signal output resistance, ${R}_{\text{out }}$

Figure P5.4-11
5.5-1. Use the values of Table 3.1-2 and design the $W/L$ ratios of M1 and M2 of Fig. 5.5-1 so that a voltage swing of $\pm  3\mathrm{\;V}$ and a slew rate of $5\mathrm{\;V}/\mu \mathrm{s}$ is achieved if ${R}_{L} = {10}\mathrm{k}\Omega$ and ${C}_{L} = 1\mathrm{{nF}}$ . Assume that ${V}_{DD} =  - {V}_{SS} =$ $5\mathrm{\;V}$ and ${V}_{GG2} = 2\mathrm{\;V}$ .
5.5-2. Find the $W/L$ of M1 for the source follower of Fig. 5.5-3(a) when ${V}_{DD} =  - {V}_{SS} = 5\mathrm{\;V}$ , ${V}_{\mathrm{{OUT}}} = 1\mathrm{\;V}$ , and ${W}_{2}/{L}_{2} = 1$ that will source $1\mathrm{{mA}}$ of output current. Use the parameters of Table 3.1-2.
5.5-3. Find the small-signal voltage gain and output resistance of the source follower of Fig. 5.5-3(b). Assume that ${V}_{DD} =  - {V}_{SS} = 5\mathrm{\;V}$ , ${V}_{\mathrm{{OUT}}} = 1\mathrm{\;V},{I}_{D} = {50\mu }\mathrm{A}$ , and the $W/L$ ratios of both M1 and M2 are ${2\mu }\mathrm{m}/{1\mu }\mathrm{m}$ . Use the parameters of Table 3.1-2 where pertinent.
5.5-4. An output amplifier is shown in Fig. P5.5-4. Assume that ${v}_{\mathrm{{IN}}}$ can vary from -2.5 to $+ {2.5}\mathrm{\;V}$ . Ignore bulk effects. Use the parameters of Table 3.1-2.

Figure P5.5-4
(a) Find the maximum value of output voltage, ${v}_{\mathrm{{OUT}}}\left( \max \right)$ .
(b) Find the minimum value of output voltage, ${v}_{\mathrm{{OUT}}}\left( \min \right)$ .
(c) Find the positive slew rate, $S{R}^{ + }$ , when ${v}_{\mathrm{{OUT}}} = 0\mathrm{\;V}$ in volts/microsecond.
(d) Find the negative slew rate, $S{R}^{ - }$ , when ${v}_{\mathrm{{OUT}}} = 0\mathrm{\;V}$ in volts/microseconds.
(e) Find the small-signal output resistance when ${v}_{\mathrm{{OUT}}} = 0\mathrm{\;V}$ .
5.5-5. Repeat Problem 5.5-4 if the input transistor is an NMOS with a $W/L$ ratio of ${100\mu }\mathrm{m}/$ ${1\mu }\mathrm{m}$ (i.e., interchange the current source and PMOS with a current sink and an NMOS).
5.5-6. For the devices shown in Fig. P5.5-6, find the small-signal voltage gain, ${v}_{\text{out }}/{v}_{\text{in }}$ , and the small-signal output resistance, ${R}_{\text{out }}$ . Assume that the dc value of ${v}_{\mathrm{{OUT}}}$ is $0\mathrm{\;V}$ and that the dc current through M1 and M2 is ${200}\mathrm{{\mu A}}$ .

Figure P5.5-6
5.5-7. Develop an expression for the efficiency of the source follower of Fig. 5.5-3(b) in terms of the maximum symmetrical peak-output voltage swing. Ignore the effects of the bulk-source voltage. What is the maximum possible efficiency?
5.5-8. Find the pole and zero lcations of the source followers of Figs. 5.5-3(a) and 5.5-3(b) if ${C}_{gs1} = {C}_{gd2} = 5\mathrm{{fF}},{C}_{bs1} = {C}_{bd2} = {30}\mathrm{{fF}}$ , and ${C}_{L} = 1\mathrm{{pF}}$ . Assume the device parameters of Table 3.1-2, ${I}_{D} = {100\mu }\mathrm{A},{W}_{1}/{L}_{1} =$ ${W}_{2}/{L}_{2} = {10\mu }\mathrm{m}/{1\mu }\mathrm{m}$ , and ${V}_{SB} = 5\mathrm{\;V}$ .
5.5-9. Six versions of a source follower are shown in Fig. P5.5-9. Assume that ${K}_{N}^{\prime } = 2{K}_{P}^{\prime },{\lambda }_{P}$ $= 2{\lambda }_{N}$ , all $W/L$ ratios of all devices are equal, and all bias currents in each device are equal. Neglect bulk effects in this problem. Identify which circuit or circuits have the following characteristics: (a) highest small-signal voltage gain, (b) lowest small-signal voltage gain, (c) highest output resistance, (d) lowest output resistance, (e) highest ${v}_{o}\left( \max \right)$ , and (f) lowest ${v}_{o}\left( \max \right)$ .

Figure P5.5-9
5.5-10. Prove that a Class B push-pull amplifier has a maximum efficiency of ${78.5}\%$ for a sinusoidal signal.
5.5-11. Assume the parameters of Table 3.1-2 are valid for the transistors of Fig. 5.5-5(a). Find an expression for ${V}_{\text{BIAS }}$ so that M1 and M2 are working in Class B operation, that is, M1 starts to turn on when M2 starts to turn off.
5.5-12. Find an expression for the maximum and minimum output-voltage swing for Fig. 5.5-5(a).
5.5-13. Repeat Problem 5.5-12 for Fig. 5.5-8.
5.5-14. Given the push-pull inverting CMOS amplifier shown in Fig. P5.5-14, show how short-circuit protection can be added to this amplifier. Note that ${R}_{1}$ could be replaced with an active load if desired.

Figure P5.5-14
5.5-15. If ${R}_{1} = {R}_{2}$ of Fig. 5.5-12, find an expression for the small-signal output resistance, ${R}_{\text{out }}$ . Repeat including the influence of ${R}_{L}$ on the output resistance.
5.5-16. Develop a table that expresses the dependence of the small-signal voltage gain, output resistance, and dominant pole as a function of dc drain current for the differential amplifier of Fig. 5.2-1, the cascode amplifier of Fig. 5.3-1, the high-output-resistance cascode of Fig. 5.3-6, the inverter of Fig. 5.5-1, and the source follower of Fig. 5.5-3(b).
For the following problems use appropriate circuits from Sections 5.1 through 5.5 to propose implementations of the amplifier architectures of Section 5.6. Do not make any dc or ac calculations. Give a circuit schematic that would be the starting point of a more detailed design.
5.5-17. A simple amplifier consisting of two cascaded CMOS inverters is shown in Fig. P5.5-17. By using one transistor (either NMOS or PMOS) and ideal current sources and batteries as necessary, show how you would reduce the output resistance to as small as possible. Estimate the output resistance of your circuit assuming that all transistors (those in the amplifier and the one you use) have the same value of ${g}_{m}$ and ${r}_{ds}$ . Further assume that the CMOS inverters are operating in Class AB.
5.5-18. A push-pull follower is shown with a ${500\Omega }$ load in Fig. P5.5-18. Assume that the MOSFETs have the following model parameters: ${K}_{N}^{\prime } = {100\mu }\mathrm{A}/{\mathrm{V}}^{2},{V}_{TN} = {0.5}\mathrm{\;V}$ , and ${K}_{P}^{\prime } = {50\mu }\mathrm{A}/{\mathrm{V}}^{2},\;{V}_{TP} =  - {0.5}\mathrm{\;V}$ . Ignore the bulk effects and assume $\lambda  = 0$ . (a) Find the small-signal voltage gain and the output resistance (not including ${R}_{L}$ ) if the dc current in M1 and M2 is ${100\mu }\mathrm{A}$ . (b) What is the output voltage when ${v}_{IN} = {0.5}\mathrm{\;V}$ ?

Figure P5.5-18
5.5-19. Find an algebraic expression for the voltage gain, ${v}_{\text{out }}/{v}_{\text{in }}$ , and the output resistance, ${R}_{\text{out }}$ , of the source follower in Fig. P5.5-19 in terms of the small-signal model parameters ${g}_{m}$ and ${R}_{L}$ (ignore ${r}_{ds}$ ). If the bias current is $1\mathrm{\;{mA}}$ , find the numerical value of the voltage gain and the output resistance. Assume that ${K}_{N}^{\prime } = {110\mu }\mathrm{A}/{\mathrm{V}}^{2},\;{V}_{TN} = {0.7}\;\mathrm{\;V}$ , and ${K}_{P}^{\prime } = {50\mu }\mathrm{A}/{\mathrm{V}}^{2},{V}_{TP} =  - {0.7}\mathrm{\;V}$ .

Figure P5.5-19
5.5-20. (Design problem-this problem is self-grading.)
You are to design a CMOS output amplifier having a single-ended input and single-ended output and a voltage gain of +1 . This amplifier is to use $\pm  2\mathrm{\;V}$ power supplies and all $W/L$ values should be between 1 and 100 . You may only use MOSFETs or substrate or vertical BJTs (only one type, NPN) in your design with the exception of a load capacitor $\left( {C}_{L}\right)$ and load resistor $\left( {R}_{L}\right)$ . You should use the model parameters for SPICE shown below. Use ${\beta }_{F} = {100}$ and ${I}_{s} = {10}\mathrm{{fA}}$ for the BJT.
The various definitions used in the specifications of this design are:
1. Slew rate(SR)is the smallest $\pm$ output voltage rate across a $1\mathrm{{nF}}$ load capacitance when the output voltage is between $\pm  1\mathrm{\;V}$ .
2. The peak output voltage $\left( {V}_{P}\right)$ is the minimum $\pm$ deviation from the quiescent output voltage when a sinusoid is applied to the input and a ${100\Omega }$ resistor is attached to the output.
<table><tr><td/><td>${\mathrm{K}}^{\prime }\left( {\mu \mathrm{A}/{\mathrm{V}}^{2}}\right)$</td><td>${V}_{T}\left( V\right)$</td><td>$\gamma \left( \sqrt{V}\right)$</td><td>$2{\phi }_{F}\left( V\right)$</td><td>$\lambda \left( {V}^{-1}\right)$</td></tr><tr><td>NMOS</td><td>110</td><td>0.7</td><td>0.4</td><td>0.7</td><td>${0.04}\left( {L = {1\mu }\mathrm{m}}\right)$ ${0.01}\left( {L = {2\mu }\mathrm{m}}\right)$</td></tr><tr><td>PMOS</td><td>50</td><td>-0.7</td><td>0.57</td><td>0.8</td><td>${0.05}\left( {L = {1\mu }\mathrm{m}}\right)$</td></tr><tr><td/><td/><td/><td/><td/><td>${0.01}\left( {L = {2\mu }\mathrm{m}}\right)$</td></tr></table>
3. Efficiency in percent $\left( \eta \right)$ is defined as
$$
\eta  = \left( \frac{\text{ Power to the load resistor of }{100\Omega }}{\text{ Power from the supplies }}\right)  \times  {100}
$$
4. Voltage gain $\left( {A}_{v}\right)$ is the output voltage (peak-to-peak) over the input voltage (peak-to-peak) when the output is loaded with a ${100\Omega }$ load resistor.
Your score for this problem will be determined as follows:
$$
\text{ SCORE } = {1.0} \times  {10}^{6} \cdot  \min \left\lbrack  {{SR},{10}\mathrm{\;V}/\mu \mathrm{s}}\right\rbrack
$$
$$
+ {10} \cdot  \min \left\lbrack  {{V}_{P},1}\right\rbrack
$$
$$
+ {0.4} \cdot  \min \left\lbrack  {\eta ,{25}}\right\rbrack   + \frac{10}{\left| {{A}_{v} - 1}\right|  + 1}
$$
Maximum SCORE $= {50}$ points
## References
1. P. R. Gray, "Basic MOS Operational Amplifier Design-An Overview." In: Analog MOS Integrated Circuits, A. B. Grebene, ed. New York: IEEE Press, 1980, pp. 28-49.
2. P. R. Gray and R. G. Meyer, Analysis and Design of Analog Integrated Circuits, 3rd ed. New York: Wiley, 1993.
3. Y. P. Tsividis, "Design Considerations in Single-Channel MOS Analog Integrated Circuits-A Tutorial," IEEE Solid-State Circuits, Vol. SC-13, No. 3, pp. 383-391, June 1978.
4. C. Toumazou, J. B. Hughes, and N. C. Battersby, Switched-Currents-An Analogue Technique for Digital Technology. London: Peter Peregrinus Ltd., 1993.
5. C. Toumazou, F. J. Lidgey, and D. G. Haigh, Analogue IC Design: The Current-Mode Approach. London: Peter Peregrinus Ltd., 1990.
6. P. R. Gray and R. G. Meyer, "Advances in Monolithic Operational Amplifier Design," IEEE Trans. Circuits Syst, Vol. CAS-21, pp. 317-327, May 1974.
7. T. M. Frederiksen, W. F. Davis, and D. W. Zobel, "A New Current-Differencing Single-Supply Operational Amplifier," IEEE J. Solid-State Circuits, Vol. SC-6, No. 6, pp. 340-347, Dec. 1991.
8. B. Wilson, "Constant Bandwidth Voltage Amplification using Current Conveyors," Inter. J. on Electronics, Vol. 65, No. 5, pp. 983-988, Nov. 1988.

T'he operational amplifier, which has become one of the most versatile and important building blocks in analog circuit design, is introduced in this chapter. The operational amplifier (op amp) fits into the scheme of Table 1.1-2 as an example of a complex circuit. The unbuffered operational amplifiers developed in this chapter might be better described as operational-transconductance amplifiers since the output resistance typically will be very high (hence the term "unbuffered"). The term "op amp" has become accepted for such circuits, so it will be used throughout this text. The terms "unbuffered" and "buffered" will be used to distinguish between high output resistance (operational-transconductance amplifiers or OTAs) and low output resistance amplifiers (voltage operational amplifiers). Chapter 7 will examine op amps that have low output resistance (buffered op amps).
Operational amplifiers are amplifiers (controlled sources) that have sufficiently high forward gain so that when negative feedback is applied, the closed-loop transfer function is practically independent of the gain of the op amp. This principle has been exploited to develop many useful analog circuits and systems. The primary requirement of an op amp is to have an open-loop gain that is sufficiently large to implement the negative feedback concept. Most of the amplifiers in Chapter 5 do not have a large enough gain. Consequently, most CMOS op amps use two or more stages of gain. One of the most popular op amps is a two-stage op amp. We will carefully examine the performance of this type of op amp for several reasons. The first is because it is a simple yet robust implementation of an op amp and second, it can be used as the starting point for the development of other types of op amps.
The two-stage op amp will be used to introduce the important concept of compensation. The goal of compensation is to maintain stability when negative feedback is applied around the op amp. An understanding of compensation, along with the previous concepts, provides the necessary design relationships to formulate a design approach for the two-stage op amp. In addition to the two-stage op amp, this chapter will examine the folded-cascode op amp. This amplifier was developed in order to improve the power-supply rejection ratio performance of the two-stage op amp. The folded-cascode op amp is also an example of a self-compensated op amp.
Simulation and measurement of op amp performance will be the final subjects of this chapter. Simulation is necessary to verify and refine the design. Experimental measurements are necessary to verify the performance of the op amp with the original design specifications. Typically, the techniques applicable to simulation are also suitable for experimental measurement.

### 6.1 Design of CMOS Op Amps
Figure 6.1-1 shows a block diagram that represents the important aspects of an op amp. CMOS op amps are very similar in architecture to their bipolar counterparts. The differential-transconductance stage introduced in Section 5.2 forms the input of the op amp and sometimes provides the differential to single-ended conversion. Normally, a good portion of the overall gain is provided by the differential-input stage, which improves noise and offset performance. The second stage is typically an inverter similar to that introduced in Section 5.1. If the differential-input stage does not perform the differential-to-single-ended conversion, then it is accomplished in the second-stage inverter. If the op amp must drive a low-resistance load, the second stage must be followed by a buffer stage whose objective is to lower the output resistance and maintain a large signal swing. Bias circuits are provided to establish the proper operating point for each transistor in its quiescent state. As noted in the introduction, compensation is required to achieve stable closed-loop performance. Section 6.2 will address this important topic.
## Ideal Op Amp
Ideally, an op amp has infinite differential-voltage gain, infinite input resistance, and zero output resistance. In reality, an op amp only approaches these values. For most applications where unbuffered CMOS op amps are used, an open-loop gain of 2000 or more is usually sufficient. The symbol for an op amp is shown in Fig. 6.1-2, where, in the nonideal case, the output voltage ${v}_{\text{OUT }}$ can be expressed as
$$
{v}_{\mathrm{{OUT}}} = {A}_{v}\left( {{v}_{1} - {v}_{2}}\right)  \tag{6.1-1}
$$
${A}_{v}$ is used to designate the open-loop differential-voltage gain. ${v}_{1}$ and ${v}_{2}$ are the input voltages applied to the noninverting and inverting terminals, respectively. The symbol in Fig. 6.1-2 also shows the power-supply connections of ${V}_{DD}$ and ${V}_{SS}$ . Generally, these connections are not shown but the designer must remember that they are an integral part of the op amp.

Figure 6.1-1 Block diagram of a general two-stage op amp.

Figure 6.1-3 General configuration of the op amp as a voltage amplifier.

Figure 6.1-2 Symbol for an operational amplifier.
If the gain of the op amp is large enough, the input port of the op amp becomes a null port when negative feedback is applied. A null port (or nullor) is a pair of terminals to a network where the voltage across the terminals is zero and the current flowing into or out of the terminals is also zero [1]. In terms of Fig. 6.1-2, if we define
$$
{v}_{i} = {v}_{1} - {v}_{2} \tag{6.1-2}
$$
and
$$
{i}_{i} = {i}_{1} =  - {i}_{2} \tag{6.1-3}
$$
then
$$
{v}_{i} = {i}_{i} = 0 \tag{6.1-4}
$$
This concept permits the analysis of op amp circuits with negative feedback to be very simple. This will be illustrated shortly.
Figure 6.1-3 shows the typical implementation of a voltage amplifier using an op amp. Returning the output through ${R}_{2}$ to the inverting input provides the negative feedback path. The input may be applied at the positive or negative inputs. If only ${v}_{\text{inp }}$ is applied $\left( {{v}_{\text{inn }} = 0}\right)$ , the voltage amplifier is called noninverting. If only ${v}_{\text{inn }}$ is applied $\left( {{v}_{\text{inp }} = 0}\right)$ , the voltage amplifier is called inverting.
---
Example 6.1-1
---
## Simplified Analysis of an ${Op}$ Amp Circuit
The circuit shown in Fig. 6.1-4 is an inverting voltage amplifier using an op amp. Find the voltage-transfer function, ${v}_{\text{out }}/{v}_{\text{in }}$ . SOLUTION

Figure 6.1-4 Inverting voltage amplifier using an op amp.
If the differential-voltage gain, ${A}_{v}$ , is large enough, then the negative feedback path through ${R}_{2}$ will cause the voltage ${v}_{i}$ and the current ${i}_{i}$ shown on Fig. 6.1-4 to both be zero. Note that the null port becomes the familiar virtual ground if one of the op amp input terminals is on ground. If this is the case, then we can write that
$$
{i}_{1} = \frac{{v}_{\text{in }}}{{R}_{1}}
$$
and
$$
{i}_{2} = \frac{{v}_{\text{out }}}{{R}_{2}}
$$
Since ${i}_{i} = 0$ , then ${i}_{1} + {i}_{2} = 0$ , giving the desired result as
$$
\frac{{v}_{\text{out }}}{{v}_{\text{in }}} =  - \frac{{R}_{2}}{{R}_{1}}
$$
## Characterization of Op Amps
In practice, the operational amplifier only approaches the ideal infinite-gain voltage amplifier. Some of its other nonideal characteristics are illustrated in Fig. 6.1-5. The finite differential-input impedance is modeled by ${R}_{id}$ and ${C}_{id}$ . The output resistance is modeled by ${R}_{\text{out }}$ . The common-mode input resistances are given as resistors of ${R}_{icm}$ connected from each of the inputs to ground. ${V}_{OS}$ is the input-offset voltage necessary to make the output voltage zero if both of the inputs of the op amp are grounded. ${I}_{OS}$ (not shown) is the input-offset current, which is necessary to make the output voltage zero if the op amp is driven from two identical current sources. Therefore, ${I}_{OS}$ is defined as the magnitude of the difference between the two input-bias currents ${I}_{B1}$ and ${I}_{B2}$ . Since the bias currents for a CMOS op amp are approximately zero, the offset current is also zero. The common-mode rejection ratio (CMRR) is modeled by the voltage-controlled voltage source indicated as ${v}_{1}/$ CMRR. This source approximately models the effects of the common-mode input signal on the op amp. The two sources designated as ${e}_{n}^{2}$ and ${i}_{n}^{2}$ are used to model the op amp noise. These are ${rms}$ voltage- and current-noise sources with units of mean-square volts and mean-square amperes, respectively. These noise sources have no polarity and are always assumed to add.

Figure 6.1-5 A model for a nonideal op amp showing some of the nonideal linear characteristics.
Not all of the nonideal characteristics of the op amp are shown in Fig. 6.1-5. Other pertinent characteristics of the op amp will now be defined. The output voltage of Fig. 6.1-2 can be defined as
$$
{V}_{\text{out }}\left( s\right)  = {A}_{v}\left( s\right) \left\lbrack  {{V}_{1}\left( s\right)  - {V}_{2}\left( s\right) }\right\rbrack   \pm  {A}_{c}\left( s\right) \left( \frac{{V}_{1}\left( s\right)  + {V}_{2}\left( s\right) }{2}\right)  \tag{6.1-5}
$$
where the first term on the right is the differential portion of ${V}_{\text{out }}\left( s\right)$ and the second term is the common-mode portion of ${V}_{\text{out }}\left( s\right)$ . The differential-frequency response is given as ${A}_{v}\left( s\right)$ while the common-mode frequency response is given as ${A}_{c}\left( s\right)$ . A typical differential-frequency response of an op amp is given as
$$
{A}_{v}\left( s\right)  = \frac{{A}_{v0}}{\left( {\frac{s}{{p}_{1}} - 1}\right) \left( {\frac{s}{{p}_{2}} - 1}\right) \left( {\frac{s}{{p}_{3}} - 1}\right) \cdots } \tag{6.1-6}
$$
where ${p}_{1},{p}_{2},\ldots$ are poles of the operational amplifier open-loop transfer function. In general, a pole designated as ${p}_{i}$ can be expressed as
$$
{p}_{i} =  - {\omega }_{i} \tag{6.1-7}
$$
where ${\omega }_{i}$ is the reciprocal time constant or break-frequency of the pole ${p}_{i}$ . While the operational amplifier may have zeros, they will be ignored at the present time. ${A}_{v0}$ or ${A}_{v}\left( 0\right)$ is the gain of the op amp as the frequency approaches zero. Figure 6.1-6 shows a typical frequency response of the magnitude of ${A}_{v}\left( s\right)$ . In this case we see that ${\omega }_{1}$ is much lower than the rest of the break-frequencies, causing ${\omega }_{1}$ to be the dominant influence in the frequency response. The frequency where the $- 6\mathrm{\;{dB}}/\mathrm{{oct}}$ . slope from the dominant pole intersects with the $0\mathrm{\;{dB}}$ axis is designated as the unity-gain bandwidth, abbreviated ${GB}$ , of the op amp. Even if the next higher order poles are smaller than ${GB}$ , we shall still continue to use the unity-gain bandwidth as defined above.

Figure 6.1-6 Typical frequency response of the magnitude of ${A}_{v}\left( {j\omega }\right)$ for an op amp.
Other nonideal characteristics of the op amp not defined by Fig. 6.1-5 include the power-supply rejection ratio, PSRR. The PSRR is defined as the product of the ratio of the change in supply voltage to the change in output voltage of the op amp caused by the change in the power supply and the open-loop gain of the op amp. Thus,
$$
\text{ PSRR } = \frac{\Delta {V}_{DD}}{\Delta {V}_{\text{OUT }}}{A}_{v}\left( s\right)  = \frac{{V}_{o}/{V}_{\text{in }}\left( {{V}_{dd} = 0}\right) }{{V}_{o}/{V}_{dd}\left( {{V}_{\text{in }} = 0}\right) } \tag{6.1-8}
$$
An ideal op amp would have an infinite PSRR. The reader is advised that both this definition for PSRR and its inverse will be found in the literature. The common-mode input range is the voltage range over which the input common-mode signal can vary. Typically, this range is $1 - 2\mathrm{\;V}$ less than ${V}_{DD}$ and $1 - 2\mathrm{\;V}$ more than ${V}_{SS}$ .
The output of the op amp has several important limits, one of which is the maximum output current sourcing and sinking capability. There is a limited range over which the output voltage can swing while still maintaining high-gain characteristics. The output also has a voltage rate limit called slew rate. The slew rate is generally determined by the maximum current available to charge or discharge a capacitance. Normally, slew rate is not limited by the output, but by the current sourcing/sinking capability of the first stage. The last characteristic of importance in analog sampled-data circuit applications is the settling time. This is the time needed for the output of the op amp to reach a final value (to within a predetermined tolerance) when excited by a small signal. This is not to be confused with slew rate, which is a large-signal phenomenon. Many times, the output response of an op amp is a combination of both large- and small-signal characteristics. Small-signal settling time can be completely determined from the location of the poles and zeros in the small-signal equivalent circuit, whereas slew rate is determined from the large-signal conditions of the circuit.
The importance of the settling time to analog sampled-data circuits is illustrated by Fig. 6.1-7. It is necessary to wait until the amplifier has settled to within a few tenths of a percent of its final value in order to avoid errors in the accuracy of processing analog signals. A longer settling time implies that the rate of processing analog signals must be reduced.
Fortunately, the CMOS op amp does not suffer from all of the nonideal characteristics previously discussed. Because of the extremely high input resistance of the MOS devices, both ${R}_{id}$ and ${I}_{OS}$ (or ${I}_{B1}$ and ${I}_{B2}$ ) are of no importance. A typical value of ${R}_{id}$ is in the range of ${10}^{14}\Omega$ . Also, ${R}_{icm}$ is extremely large and can be ignored. If an op amp is used in the configuration of Fig. 6.1-3 with the noninverting terminal on ac ground, then all common-mode characteristics are unimportant.
## Classification of Op Amps
In order to understand the design of CMOS op amps it is worthwhile to examine their classification and categorization. It is encouraging that op amps that we are totally unfamiliar with at this point can be implemented using the blocks of the previous two chapters. Table 6.1-1 gives a hierarchy of CMOS op amps that is applicable to nearly all CMOS op amps that will be presented in this chapter and the next. We see that the differential amplifier is almost ubiquitous in its use as the input stage. We will study several op amps in the next chapter that use a modified form of the differential amplifier of Section 5.2 but by and large the differential amplifier is the input stage of choice for most op amps.

Figure 6.1-7 Transient response of an op amp with negative feedback illustrating settling time ${T}_{S}.\varepsilon$ is the tolerance to the final value used to define the settling time.
As we have shown previously, amplifiers generally consist of a cascade of voltage-to-current or current-to-voltage converting stages. A voltage-to-current stage is called a transconductance stage and a current-to-voltage stage is called the load stage. In some cases, it is easier to think of a current-to-current stage, but eventually current will be converted back to voltage.
Based on the categorization in Table 6.1-1, there are two major op amp architectures that we will study in this chapter. The first is the two-stage op amp. It consists of a cascade of $V \rightarrow  I$ and $I \rightarrow  V$ stages and is shown in Fig. 6.1-8. The first stage consists of a differential amplifier converting the differential input voltage to differential currents. These differential currents are applied to a current-mirror load recovering the differential voltage. This of course is nothing more than the differential voltage amplifier of Fig. 5.2-5 or 5.2-7. The second stage consists of a common-source MOSFET converting the second-stage input voltage to current. This transistor is loaded by a current-sink load, which converts the current to voltage at the output. The second stage is also nothing more than the current-sink inverter of Fig. 5.1-7. This two-stage op amp is so widely used that we will call it the classical two-stage op amp; it has both MOSFET and BJT versions.
Table 6.1-1 Categorization of CMOS Op Amps

Figure 6.1-8 Classical two-stage CMOS op amp broken into voltage-to-current and current-to-voltage stages.
A second architecture that results is shown in Fig. 6.1-9. This architecture is commonly called the folded-cascode op amp. This architecture was developed in part to improve the input common-mode range and the power-supply rejection of the two-stage op amp. In this particular op amp, it is probably more efficient to consider it as the cascade of a differential-transconductance stage with a current stage followed by a cascode current-mirror load. One of the advantages of the folded-cascode op amp is that it has a push-pull output. That is, the op amp can actively sink or source current from the load. The output stage of the previous two-stage op amp is Class A, which means that either its sinking or sourcing capability is fixed.
Slight modifications in the two op amps of Figs. 6.1-8 and 6.1-9 result in many possible other forms (see Problems 6.1-5 and 6.1-6). However, for the purposes of space and simplicity we will restrict our present considerations to these two CMOS op amps.

Figure 6.1-9 Folded-cascode op amp broken into stages.
## Design of Op Amps
The design of an op amp can be divided into two distinct design-related activities that are for the most part independent of one another. The first of these activities involves choosing or creating the basic structure of the op amp. A diagram that describes the interconnection of all of the transistors results. In most cases, this structure does not change throughout the remaining portion of the design, but sometimes certain characteristics of the chosen design must be changed by modifying the structure.
Once the structure has been selected, the designer must select dc currents and begin to size the transistors and design the compensation circuit. Most of the work involved in completing a design is associated with this, the second activity of the design process. Devices must be properly scaled in order to meet all of the ac and dc requirements imposed on the op amp. Computer circuit simulations, based on hand calculations, are used extensively to aid the designer in this phase.
Before the actual design of an op amp can begin, though, one must set out all of the requirements and boundary conditions that will be used to guide the design. The following list describes many of the items that must be considered.
## Boundary conditions:
1. Process specification $\left( {{V}_{T},{K}^{\prime },{C}_{\mathrm{{ox}}}}\right.$ , etc.)
2. Supply voltage and range
3. Supply current and range
4. Operating temperature and range
Requirements:
1. Gain
2. Gain bandwidth
3. Settling time
4. Slew rate
5. Input common-mode range, ICMR
6. Common-mode rejection ratio, CMRR
7. Power-supply rejection ratio, PSRR
8. Output-voltage swing
9. Output resistance
10. Offset
11. Noise
12. Layout area
The typical specifications for an unbuffered CMOS op amp are listed in Table 6.1-2.
The block diagram of Fig. 6.1-1 is useful for guiding the CMOS op amp design process. The compensation method has a large influence on the design of each block. Two basic methods of compensation are suggested by the opposite parallel paths into the compensation block of Fig. 6.1-1. These two methods, feedback and feedforward, are developed in the following section. The method of compensation is greatly dependent on the number of stages present (differential, second, or buffer stages).
Table 6.1-2 Specifications for a Typical Unbuffered CMOS Op Amp
<table><tr><td>Boundary Conditions</td><td>Requirement</td></tr><tr><td>Process specification</td><td>See Tables 3.1-1, 3.1-2, and 3.2-1</td></tr><tr><td>Supply voltage</td><td>$\pm  {2.5}$ V $\pm  {10}\%$</td></tr><tr><td>Supply current</td><td>${100\mu }\mathrm{A}$</td></tr><tr><td>Temperature range</td><td>$0 - {70}^{ \circ  }\mathrm{C}$</td></tr><tr><td colspan="2">Specifications</td></tr><tr><td>Gain</td><td>$\geq  {70}\mathrm{\;{dB}}$</td></tr><tr><td>Gain bandwidth</td><td>$\geq  5\mathrm{{MHz}}$</td></tr><tr><td>Settling time</td><td>$\leq  {1\mu }\mathrm{s}$</td></tr><tr><td>Slew rate</td><td>$\geq  5\mathrm{\;V}/\mathrm{{\mu s}}$</td></tr><tr><td>ICMR</td><td>$\geq   \pm  {1.5}\mathrm{\;V}$</td></tr><tr><td>CMRR</td><td>$\geq  {60}\mathrm{\;{dB}}$</td></tr><tr><td>PSRR</td><td>$\geq  {60}\mathrm{\;{dB}}$</td></tr><tr><td>Output swing</td><td>$\geq   \pm  {1.5}\mathrm{\;V}$</td></tr><tr><td>Output resistance</td><td>$\mathrm{N}/\mathrm{A}$ , capacitive load only</td></tr><tr><td>Offset</td><td>$\leq   \pm  {10}\mathrm{{mV}}$</td></tr><tr><td>Noise</td><td>$\leq  {100}\mathrm{{nV}}/\sqrt{\mathrm{{Hz}}}$ at $1\mathrm{{kHz}}$</td></tr><tr><td>Layout area</td><td>$\leq  {5000} \times  {\left( \text{ minimum channel length }\right) }^{2}$</td></tr></table>
In designing an op amp, one can begin at many points. The design procedure must be iterative, since it is almost impossible to relate all specifications simultaneously. For a typical CMOS op amp design, the following steps may be appropriate.
## 1. Decide on a Suitable Configuration
After examining the specifications in detail, determine the type of configuration required. For example, if extremely low noise and offset are a must, then a configuration that affords high gain in the input stage is required. If there are low-power requirements, then a Class AB-type output stage may be necessary. This in turn will govern the type of input stage that must be used. Often, one must create a configuration that meets a specific application.
## 2. Determine the Type of Compensation Needed to Meet the Specifications
There are many ways to compensate amplifiers. Some have unique aspects that make them suitable for particular configurations or specifications. For example, an op amp that must drive very large load capacitances might be compensated at the output. If this is the case, then this requirement also dictates the types of input and output stages needed. As this example shows, iteration might be necessary between steps 1 and 2 of the design process.
## 3. Design Device Sizes for Proper dc, ac, and Transient Performance
This begins with hand calculations based on approximate design equations. Compensation components are also sized in this step of the procedure. After each device is sized by hand, a circuit simulator is used to fine-tune the design.
One may find during the design process that some specification may be difficult or impossible to meet with a given configuration. At this point the designer has to modify the configuration or search the literature for ideas particularly suited to the requirement. This literature search takes the place of creating a new configuration from scratch. For very critical designs, the hand calculations can achieve about ${80}\%$ of the complete job in roughly ${20}\%$ of the total job time. The remaining ${20}\%$ of the job requires ${80}\%$ of the time for completion. Sometimes hand calculations can be misleading due to their approximate nature. Nonetheless, they are necessary to give the designer a feel for the sensitivity of the design to parameter variation. There is no other way for the designer to understand how the various design parameters influence performance. Iteration by computer simulation gives the designer very little feeling for the design and is generally not a wise use of computer resources.*
In summary, the design process consists of two major steps. The first is the conception of the design and the second is the optimization of the design. The conception of the design is accomplished by proposing an architecture to meet the given specifications. This step is normally accomplished using hand calculations in order to maintain the intuitive viewpoint necessary for choices that must be made. The second step is to take the "first-cut" design and verify and optimize it. This is normally done by using computer simulation and can include such influences as environmental or process variations.

### 6.2 Compensation of Op Amps
Operational amplifiers are generally used in a negative-feedback configuration. In this way, the relatively high, inaccurate forward gain can be used with feedback to achieve a very accurate transfer function that is a function of the feedback elements only. Figure 6.2-1 illustrates a general negative-feedback configuration. $A\left( s\right)$ is the amplifier gain and will normally be the open-loop, differential-voltage gain of the op amp, and $F\left( s\right)$ is the transfer function for external feedback from the output of the op amp back to the input. The loop gain of this system will be defined as
$$
\text{Loop gain} = L\left( s\right)  =  - A\left( s\right) F\left( s\right)  \tag{6.2-1}
$$
Consider a case where the forward gain from ${V}_{\text{in }}$ to ${V}_{\text{out }}$ is to be unity. It is easily shown that if the open-loop gain at dc $A\left( 0\right)$ is between 1000 and 2000, and $F$ is equal to 1, the forward gain varies from 0.999 to 0.9995 . For very high loop gain (due primarily to a high amplifier gain), the forward transfer function ${V}_{\text{out }}/{V}_{\text{in }}$ is accurately controlled by the feedback network. This is the principle applied in using operational amplifiers.

Figure 6.2-1 A single-loop, negative-feedback system.
---
*A useful relationship in analog design is: (use of a simulator) $\times$ (common sense) $=$ (a constant).
---
## Small-Signal Dynamics of a Two-Stage Op Amp
It is of primary importance that the signal fed back to the input of the op amp be of such amplitude and phase that it does not continue to regenerate itself around the loop. Should this occur, the result will be either clamping of the output of the amplifier at one of the supply potentials (regeneration at dc), or oscillation (regeneration at some frequency other than dc). The requirement for avoiding this situation can be succinctly stated by the following equation:
$$
\left| {A\left( {j{\omega }_{{0}^{ \circ  }}}\right) F\left( {j{\omega }_{{0}^{ \circ  }}}\right) }\right|  = \left| {L\left( {j{\omega }_{{0}^{ \circ  }}}\right) }\right|  < 1 \tag{6.2-2}
$$
where ${\omega }_{{0}^{ \circ  }}$ is defined as
$$
\operatorname{Arg}\left\lbrack  {-A\left( {j{\omega }_{{0}^{ \circ  }}}\right) F\left( {j{\omega }_{{0}^{ \circ  }}}\right) }\right\rbrack   = \operatorname{Arg}\left\lbrack  {L\left( {j{\omega }_{{0}^{ \circ  }}}\right) }\right\rbrack   = {0}^{ \circ  } \tag{6.2-3}
$$
Another convenient way to express this requirement is
$$
\operatorname{Arg}\left\lbrack  {-A\left( {j{\omega }_{0\mathrm{{dB}}}}\right) F\left( {j{\omega }_{0\mathrm{{dB}}}}\right) }\right\rbrack   = \operatorname{Arg}\left\lbrack  {L\left( {j{\omega }_{0\mathrm{{dB}}}}\right) }\right\rbrack   > {0}^{ \circ  } \tag{6.2-4}
$$
where ${\omega }_{0\mathrm{\;{dB}}}$ is defined as
$$
\left| {A\left( {j{\omega }_{0\mathrm{\;{dB}}}}\right) F\left( {j{\omega }_{0\mathrm{\;{dB}}}}\right) }\right|  = \left| {L\left( {j{\omega }_{0\mathrm{\;{dB}}}}\right) }\right|  = 1 \tag{6.2-5}
$$
If these conditions are met, the feedback system is said to be stable (i.e., sustained oscillation cannot occur).
This second relationship given in Eq. (6.2-4) is best illustrated with the use of Bode diagrams. Figure 6.2-2 shows the response of $\left| {A\left( {j\omega }\right) F\left( {j\omega }\right) }\right|$ and $\operatorname{Arg}\left\lbrack  {-A\left( {j\omega }\right) F\left( {j\omega }\right) }\right\rbrack$ as a function of frequency. The requirement for stability is that the $\left| {A\left( {j\omega }\right) F\left( {j\omega }\right) }\right|$ curve cross the $0\mathrm{\;{dB}}$ point before the $\operatorname{Arg}\left\lbrack  {-A\left( {j\omega }\right) F\left( {j\omega }\right) }\right\rbrack$ reaches ${0}^{ \circ  }$ . A measure of stability is given by the value of the phase when $\left| {A\left( {j\omega }\right) F\left( {j\omega }\right) }\right|$ is unity, $0\mathrm{\;{dB}}$ . This measure is called phase margin and is described by the following relationship:
$$
\text{Phase margin} = {\Phi }_{M} = \operatorname{Arg}\left\lbrack  {-A\left( {j{\omega }_{0\mathrm{{dB}}}}\right) F\left( {j{\omega }_{0\mathrm{{dB}}}}\right) }\right\rbrack   = \operatorname{Arg}\left\lbrack  {L\left( {j{\omega }_{0\mathrm{{dB}}}}\right) }\right\rbrack   \tag{6.2-6}
$$
The importance of "good stability" obtained with adequate phase margin is best understood by considering the response of the closed-loop system in the time domain. Figure 6.2-3 shows the time response of a second-order closed-loop system with various phase margins. One can see that larger phase margins result in less "ringing" of the output signal. Too much ringing can be undesirable, so it is important to have adequate phase margin keeping the ringing to an acceptable level. It is desirable to have a phase margin of at least ${45}^{ \circ  }$ , with ${60}^{ \circ  }$ preferable in most situations. Appendix D develops the relationship between phase margin and time domain response for second-order systems.

Figure 6.2-2 Frequency and phase response of a second-order system.

Figure 6.2-3 Response of a second-order system with various phase margins.
Now consider the second-order, small-signal model for an uncompensated op amp shown in Fig. 6.2-4. In order to generalize the results, the components associated with the first stage have the subscript $I$ and those associated with the second stage have the subscript ${II}$ . The locations for the two poles are given by the following equations:
$$
{p}_{1}^{\prime } = \frac{-1}{{R}_{I}{C}_{I}} \tag{6.2-7}
$$
and
$$
{p}_{2}^{\prime } = \frac{-1}{{R}_{H}{C}_{H}} \tag{6.2-8}
$$
where ${R}_{I}\left( {R}_{II}\right)$ is the resistance to ground seen from the output of the first (second) stage and ${C}_{I}\left( {C}_{II}\right)$ is the capacitance to ground seen from the output of the first (second) stage. In a typical case, these poles are far away from the origin of the complex frequency plane and are relatively close together. Figure 6.2-5 illustrates the open-loop frequency response of a negative-feedback loop using the op amp modeled by Fig. 6.2-4 and a feedback factor of $F\left( s\right)  = 1$ . Note that $F\left( s\right)  = 1$ is the worst case for stability considerations. In Fig. 6.2-5, the phase margin is significantly less than ${45}^{ \circ  }$ , which means that the op amp should be compensated before using it in a closed-loop configuration.

Figure 6.2-4 Second-order, small-signal equivalent circuit for a two-stage op amp.

Figure 6.2-5 The open-loop frequency response of a negative-feedback loop using an uncompensated op amp and a feedback factor of $F\left( s\right)  = 1$ .
## Miller Compensation of the Two-Stage Op Amp
The first compensation method discussed here will be the "Miller" compensation technique [2]. This technique is applied by connecting a capacitor from the output to the input of the second transconductance stage ${g}_{mII}$ . The resulting small-signal model is illustrated in Fig. 6.2-6. Two results come from adding the compensation capacitor ${C}_{c}$ . First, the effective capacitance shunting ${R}_{I}$ is increased by the additive amount of approximately ${g}_{mII}\left( {R}_{II}\right) \left( {C}_{c}\right)$ . This moves ${p}_{1}$ (the new location of ${p}_{1}^{\prime }$ ) closer to the origin of complex frequency plane by a significant amount (assuming that the second-stage gain is large). Second, ${p}_{2}$ (the new location of ${p}_{2}^{\prime }$ ) is moved away from the origin of the complex frequency plane, resulting from the negative feedback reducing the output resistance of the second stage.
The following derivation illustrates this in a rigorous way. The overall transfer function that results from the addition of ${C}_{c}$ is
$$
\frac{{V}_{O}\left( s\right) }{{V}_{\text{in }}\left( s\right) } = \frac{\left( {g}_{ml}\right) \left( {g}_{mlI}\right) \left( {R}_{I}\right) \left( {R}_{II}\right) \left( {1 - s{C}_{c}/{g}_{mlI}}\right) }{1 + s\left\lbrack  {{R}_{I}\left( {{C}_{I} + {C}_{c}}\right)  + {R}_{II}\left( {{C}_{II} + {C}_{c}}\right)  + {g}_{mlI}{R}_{I}{R}_{II}{C}_{c}}\right\rbrack   + {s}^{2}{R}_{I}{R}_{II}\left\lbrack  {{C}_{I}{C}_{II} + {C}_{c}{C}_{I} + {C}_{c}{C}_{II}}\right\rbrack  } \tag{6.2-9}
$$

Figure 6.2-6 Miller capacitance applied to the two-stage op amp.
Using the approach developed in Section 5.3 for two widely spaced poles gives the following compensated poles:
$$
{p}_{1} \cong  \frac{-1}{{g}_{mII}{R}_{I}{R}_{II}{C}_{c}} \tag{6.2-10}
$$
and
$$
{p}_{2} \cong  \frac{-{g}_{mII}{C}_{c}}{{C}_{I}{C}_{II} + {C}_{II}{C}_{c} + {C}_{I}{C}_{c}} \tag{6.2-11}
$$
If ${C}_{II}$ is much greater than ${C}_{I}$ and ${C}_{c}$ is greater than ${C}_{I}$ , then Eq. (6.2-11) can be approximated by
$$
{p}_{2} \cong  \frac{-{g}_{mH}}{{C}_{II}} \tag{6.2-12}
$$
It is of interest to note that a zero occurs on the positive-real axis of the complex frequency plane and is due to the feedforward path through ${C}_{c}$ . The right half-plane zero is located at
$$
{z}_{1} = \frac{{g}_{mH}}{{C}_{c}} \tag{6.2-13}
$$
Figure 6.2-7(a) illustrates the movement of the poles from their uncompensated to their compensated positions on the complex frequency plane. Figure 6.2-7(b) shows results of compensation illustrated by an asymptotic magnitude and phase plot. Note that the second pole does not begin to affect the magnitude until after $\left| {A\left( {j\omega }\right) F\left( {j\omega }\right) }\right|$ is less than unity. The right half-plane (RHP) zero increases the phase shift [acts like a left half-plane (LHP) pole] but increases the magnitude (acts like an LHP zero). Consequently, the RHP zero causes the two worst things possible with regard to stability considerations. If either the zero $\left( {z}_{1}\right)$ or the pole $\left( {p}_{2}\right)$ moves toward the origin of the complex frequency plane, the phase margin will be degraded. The task in compensating an amplifier for closed-loop applications is to move all poles and zeros, except for the dominant pole $\left( {p}_{1}\right)$ , sufficiently away from the origin of the complex frequency plane (beyond the unity-gain bandwidth frequency) to result in a phase shift similar to Fig. 6.2-7(b).
Only a second-order (two-pole) system has been considered thus far. In practice, there are more than two poles in the transfer function of a CMOS op amp. The rest of this treatment will concentrate on the two most dominant (smaller) poles and the RHP zero. Figure 6.2-8 illustrates a typical CMOS op amp with various parasitic and circuit capacitances shown. The approximate pole and zero locations resulting from these capacitances are given below:
$$
{p}_{1} \cong  \frac{-{G}_{I}{G}_{II}}{{g}_{mII}{C}_{c}} = \frac{-\left( {{g}_{ds2} + {g}_{ds4}}\right) \left( {{g}_{ds6} + {g}_{ds7}}\right) }{{g}_{m6}{C}_{c}} \tag{6.2-14}
$$
$$
{p}_{2} \cong  \frac{-{g}_{mII}}{{C}_{II}} = \frac{-{g}_{m6}}{{C}_{2}} \tag{6.2-15}
$$

Figure 6.2-7 (a) Root locus plot of the loop gain $\left\lbrack  {F\left( s\right)  = 1}\right\rbrack$ resulting from the Miller compensation as ${C}_{C}$ is varied from 0 to the value used to achieve the unprimed roots. (b) The asymptotic magnitude and phase plots of the loop gain $\left\lbrack  {F\left( s\right)  = 1}\right\rbrack$ before and after compensation.
and
$$
{z}_{1} \cong  \frac{{g}_{mH}}{{C}_{c}} = \frac{{g}_{m6}}{{C}_{c}} \tag{6.2-16}
$$
The unity-gain bandwidth as defined in Section 6.1 is easily derived (see Problem 6.2-3) and is shown to be approximately
$$
{GB} \cong  \frac{{g}_{mI}}{{C}_{c}} = \frac{{g}_{m2}}{{C}_{c}} \tag{6.2-17}
$$

Figure 6.2-8 A two-stage op amp with various parasitic and circuit capacitances shown.

Figure 6.2-9 Illustration of the implementation of the dominant pole through the Miller effect on ${C}_{C}$ . M6 is treated as an NMOS for this illustration.
The above three roots are very important to the dynamic performance of the two-stage op amp. The dominant left-half plane pole, ${p}_{1}$ , is called the Miller pole and accomplishes the desired compensation. Intuitively, it is created by the Miller effect on the capacitance, ${C}_{c}$ , as illustrated in Fig. 6.2-9, where M6 is assumed to be an NMOS transistor. The capacitor ${C}_{c}$ is multiplied by approximately the gain of the second stage, ${g}_{II}{R}_{II}$ , to give a capacitor in parallel with ${R}_{I}$ of ${g}_{II}{R}_{II}{C}_{c}$ . Multiplying this capacitance times ${R}_{I}$ and inverting gives Eq. (6.2-14).
The second root of importance is ${p}_{2}$ . The magnitude of this root must be at least equal to ${GB}$ and is due to the capacitance at the output of the op amp. It is often called the output pole. Generally, ${C}_{H}$ is equal to the load capacitance, ${C}_{L}$ , which makes the output pole strongly dependent on the load capacitance. Figure 6.2-10 shows intuitively how this root develops. Since $\left| {p}_{2}\right|$ is near or greater than ${GB}$ , the reactance of ${C}_{c}$ is approximately $1/\left( {{GB} \cdot  {C}_{c}}\right)$ and is very small. For all practical purposes the drain of M6 is connected to the gate of M6, forming an MOS diode. We know that the small-signal resistance of an MOS diode is $1/{g}_{m}$ . Multiplying $1/{g}_{mII}$ by ${C}_{II}$ (or ${C}_{L}$ ) and inverting gives Eq. (6.2-15).
The third root is the RHP zero. This is a very undesirable root because it boosts the loop gain magnitude while causing the loop phase shift to become more negative. Both of these results worsen the stability of the op amp. In BJT op amps, the RHP zero was not serious because of the large values of transconductance. However, in CMOS op amps, the RHP zero cannot be ignored. This zero comes from the fact that there are two signal paths from the input to the output as illustrated in Fig. 6.2-11. One path is from the gate of M6 through the compensation capacitor, ${C}_{c}$ , to the output $\left( {{V}^{\prime \prime }\text{to}{V}_{\text{out }}}\right)$ . The other path is through the transistor, M6, to the output $\left( {{V}^{\prime }\text{to}{V}_{\text{out }}}\right)$ . At some complex frequency, the signals through these two paths will be equal and opposite and cancel, creating the zero. The RHP zero is developed by using superposition on these two paths as shown below:
$$
{V}_{\text{out }}\left( s\right)  = \left( \frac{-{g}_{m6}{R}_{II}\left( {1/s{C}_{c}}\right) }{{R}_{II} + 1/s{C}_{c}}\right) {V}^{\prime } + \left( \frac{{R}_{II}}{{R}_{II} + 1/s{C}_{c}}\right) {V}^{\prime \prime } = \frac{-{R}_{II}\left( {{g}_{m6}/s{C}_{c} - 1}\right) }{{R}_{II} + 1/s{C}_{c}}V \tag{6.2-18}
$$
where $V = {V}^{\prime } = {V}^{\prime \prime }$ .

Figure 6.2-10 Illustration of how the output pole in a two-stage op amp is created. M6 is treated as an NMOS for this illustration.

Figure 6.2-11 Illustration of how the RHP zero is developed. M6 is treated as an NMOS for this illustration.
As stated before, the goal of the compensation task is to achieve a phase margin greater than ${45}^{ \circ  }$ . It can be shown (see Problem 6.2-4) that if the zero is placed at least ten times higher than the ${GB}$ , then in order to achieve a ${45}^{ \circ  }$ phase margin, the second pole $\left( {p}_{2}\right)$ must be placed at least 1.22 times higher than ${GB}$ . In order to obtain ${60}^{ \circ  }$ of phase margin, ${p}_{2}$ must be placed about 2.2 times higher than ${GB}$ as shown in the following example.
---
Example 6.2-1
---
## Location of the Output Pole for a Phase Margin of ${60}^{ \circ  }$
For an op amp model with two poles and one RHP zero, prove that if the zero is ten times higher than ${GB}$ , then in order to achieve a ${60}^{ \circ  }$ phase margin, the second pole must be placed at least 2.2 times higher than ${GB}$ .
## SOLUTION
The requirement for a ${60}^{ \circ  }$ phase margin is given as
$$
{\Phi }_{M} =  \pm  {180}^{ \circ  } - \operatorname{Arg}\left\lbrack  {A\left( {j\omega }\right) F\left( {j\omega }\right) }\right\rbrack   =  \pm  {180}^{ \circ  } - {\tan }^{-1}\left( \frac{\omega }{\left| {p}_{1}\right| }\right)  - {\tan }^{-1}\left( \frac{\omega }{\left| {p}_{2}\right| }\right)  - {\tan }^{-1}\left( \frac{\omega }{{z}_{1}}\right)  = {60}^{ \circ  }
$$
Assuming that the unity-gain frequency is ${GB}$ , we replace $\omega$ by ${GB}$ to get
$$
{120}^{ \circ  } = {\tan }^{-1}\left( \frac{GB}{\left| {p}_{1}\right| }\right)  + {\tan }^{-1}\left( \frac{GB}{\left| {p}_{2}\right| }\right)  + {\tan }^{-1}\left( \frac{GB}{{z}_{1}}\right)  = {\tan }^{-1}\left\lbrack  {{A}_{v}\left( 0\right) }\right\rbrack   + {\tan }^{-1}\left( \frac{GB}{\left| {p}_{2}\right| }\right)  + {\tan }^{-1}\left( {0.1}\right)  \tag{0.1}
$$
Assuming that ${A}_{v}\left( 0\right)$ is large, then the above equation can be reduced to
$$
{24.3}^{ \circ  } \approx  {\tan }^{-1}\left( \frac{GB}{\left| {p}_{2}\right| }\right)
$$
which gives $\left| {p}_{2}\right|  \geq  {2.2GB}$ .
Assuming that a ${60}^{ \circ  }$ phase margin is required, the following relationships apply:
$$
\frac{{g}_{m6}}{{C}_{c}} > {10}\left( \frac{{g}_{m2}}{{C}_{c}}\right)  \tag{6.2-19}
$$
Therefore,
$$
{g}_{m6} > {10}{g}_{m2} \tag{6.2-20}
$$
Furthermore,
$$
\left( \frac{{g}_{m6}}{{C}_{2}}\right)  > {2.2}\left( \frac{{g}_{m2}}{{C}_{c}}\right)  \tag{6.2-21}
$$
Combining Eqs. (6.2-20) and (6.2-21) gives the following requirement:
$$
{C}_{c} > \frac{{2.2}{C}_{2}}{10} = {0.22}{C}_{2} \tag{6.2-22}
$$
Up to this point, we have neglected the influence of the capacitor, ${C}_{3}$ , associated with the current-mirror load of the input stage in Fig. 6.2-8. A small-signal model for the input stage of Fig. 6.2-8 that includes ${C}_{3}$ is shown in Fig. 6.2-12(a). The transfer function from the input to the output voltage of the first stage, ${V}_{\mathrm{o}1}\left( s\right)$ , can be written as
$$
\frac{{V}_{\mathrm{o}1}\left( s\right) }{{V}_{\mathrm{{in}}}\left( s\right) } = \frac{-{g}_{m1}}{2\left( {{g}_{ds2} + {g}_{ds4}}\right) }\left\lbrack  {\frac{{g}_{m3} + {g}_{ds1} + {g}_{ds3}}{{g}_{m3} + {g}_{ds1} + {g}_{ds3} + s{C}_{3}} + 1}\right\rbrack   \tag{6.2-23}
$$
$$
\approx  \frac{-{g}_{m1}}{2\left( {{g}_{ds2} + {g}_{ds4}}\right) }\left\lbrack  \frac{s{C}_{3} + 2{g}_{m3}}{s{C}_{3} + {g}_{m3}}\right\rbrack
$$
We see that there is a pole and a zero given as
$$
{p}_{3} =  - \frac{{g}_{m3}}{{C}_{3}}\;\text{ and }\;{z}_{3} =  - \frac{2{g}_{m3}}{{C}_{3}} \tag{6.2-24}
$$

Figure 6.2-12 (a) Influence of the mirror pole, ${p}_{3}$ , on the Miller compensation of a two-stage op amp. (b) The location of the open-loop and closed-loop roots.
Fortunately, the presence of the zero tends to negate the effect of the pole. Generally, the pole and zero due to ${C}_{3}$ is greater than ${GB}$ and will have very little influence on the stability of the two-stage op amp. Figure 6.2-12(b) illustrates the case where these roots are less than ${GB}$ and even then they have little effect on stability. In fact, they actually increase the phase margin slightly because ${GB}$ is decreased.
## Controlling the Right Half-Plane Zero
The RHP zero resulting from the feedforward path through the compensation capacitor tends to limit the ${GB}$ that might otherwise be achievable if the zero were not present. There are several ways of eliminating the effect of this zero. One approach is to eliminate the feed-forward path by placing a unity-gain buffer in the feedback path of the compensation capacitor [3]. This technique is shown in Fig. 6.2-13. Assuming that the output resistance of the unity-gain buffer is small $\left( {{R}_{o} \rightarrow  0}\right)$ , then the transfer function is given by the following equation:
$$
\frac{{V}_{o}\left( s\right) }{{V}_{\text{in }}\left( s\right) } = \frac{\left( {g}_{mI}\right) \left( {g}_{mII}\right) \left( {R}_{I}\right) \left( {R}_{II}\right) }{1 + s\left\lbrack  {{R}_{I}{C}_{I} + {R}_{II}{C}_{II} + {R}_{I}{C}_{c} + {g}_{mII}{R}_{I}{R}_{II}{C}_{c}}\right\rbrack   + {s}^{2}\left\lbrack  {{R}_{I}{R}_{II}{C}_{II}\left( {{C}_{I} + {C}_{c}}\right) }\right\rbrack  } \tag{6.2-25}
$$
Using the technique as before to approximate ${p}_{1}$ and ${p}_{2}$ results in the following:
$$
{p}_{1} \cong  \frac{-1}{{R}_{I}{C}_{I} + {R}_{II}{C}_{II} + {R}_{I}{C}_{c} + {g}_{mII}{R}_{I}{R}_{II}{C}_{c}} \cong  \frac{-1}{{g}_{mII}{R}_{I}{R}_{II}{C}_{c}} \tag{6.2-26}
$$
and
$$
{p}_{2} \cong  \frac{-{g}_{mII}{C}_{c}}{{C}_{II}\left( {{C}_{I} + {C}_{c}}\right) } \tag{6.2-27}
$$
Note that the poles of the circuit in Fig. 6.2-13 are approximately the same as before, but the zero has been removed. With the zero removed, the pole ${p}_{2}$ can be placed higher than the ${GB}$ in order to achieve a phase margin of ${45}^{ \circ  }$ . For a ${60}^{ \circ  }$ phase margin, ${p}_{2}$ must be placed 1.73 times greater than the ${GB}$ . Using the type of compensation scheme shown in Fig. 6.2-13 results in greater bandwidth capabilities as a result of eliminating the zero.

Figure 6.2-13 (a) Elimination of the feedforward path by a voltage amplifier. (b) Small-signal model for the two-stage op amp using the technique of (a).
The above analysis neglects the output resistance of the buffer amplifier ${R}_{o}$ , which can be significant. Taking the output resistance into account, and assuming that it is less than ${R}_{I}$ or ${R}_{II}$ , results in an additional pole ${p}_{4}$ and an LHP zero ${z}_{2}$ given by
$$
{p}_{4} \cong  \frac{-1}{{R}_{o}\left\lbrack  {{C}_{I}{C}_{c}/\left( {{C}_{I} + {C}_{c}}\right) }\right\rbrack  } \tag{6.2-28}
$$
$$
{z}_{2} \cong  \frac{-1}{{R}_{o}{C}_{c}} \tag{6.2-29}
$$
Although the LHP zero can be used for compensation, the additional pole makes this method less desirable than the following method. The most important aspect of this result is that it leads naturally to the next scheme for controlling the RHP zero.
Another means of eliminating the effect of the RHP zero resulting from feedforward through the compensation capacitor ${C}_{c}$ is to insert a nulling resistor in series with ${C}_{c}$ [4]. Figure 6.2-14 shows the application of this technique. This circuit has the following node-voltage equations:
$$
{g}_{mI}{V}_{\text{in }} + \frac{{V}_{I}}{{R}_{I}} + s{C}_{I}{V}_{I} + \left( \frac{s{C}_{c}}{1 + s{C}_{c}{R}_{z}}\right) \left( {{V}_{I} - {V}_{\text{out }}}\right)  = 0 \tag{6.2-30}
$$
$$
{g}_{mII}{V}_{I} + \frac{{V}_{o}}{{R}_{II}} + s{C}_{II}{V}_{\text{out }} + \left( \frac{s{C}_{c}}{1 + s{C}_{c}{R}_{z}}\right) \left( {{V}_{\text{out }} - {V}_{I}}\right)  = 0 \tag{6.2-31}
$$
These equations can be solved to give
$$
\frac{{V}_{\text{out }}\left( s\right) }{{V}_{\text{in }}\left( s\right) } = \frac{a\left\{  {1 - s\left\lbrack  {\left( {{C}_{c}/{g}_{mII}}\right)  - {R}_{z}{C}_{c}}\right\rbrack  }\right\}  }{1 + {bs} + c{s}^{2} + d{s}^{3}} \tag{6.2-32}
$$
where
$$
a = {g}_{mI}{g}_{mII}{R}_{I}{R}_{II} \tag{6.2-33}
$$
$$
b = \left( {{C}_{II} + {C}_{c}}\right) {R}_{II} + \left( {{C}_{I} + {C}_{c}}\right) {R}_{I} + {g}_{mII}{R}_{I}{R}_{II}{C}_{c} + {R}_{z}{C}_{c} \tag{6.2-34}
$$
$$
c = \left\lbrack  {{R}_{I}{R}_{II}\left( {{C}_{I}{C}_{II} + {C}_{c}{C}_{I} + {C}_{c}{C}_{II}}\right)  + {R}_{z}{C}_{c}\left( {{R}_{I}{C}_{I} + {R}_{II}{C}_{II}}\right) }\right\rbrack   \tag{6.2-35}
$$
$$
d = {R}_{I}{R}_{II}{R}_{z}{C}_{I}{C}_{II}{C}_{c} \tag{6.2-36}
$$

Figure 6.2-14 (a) Use of a nulling resistor, ${R}_{z}$ , to control the RHP zero. (b) Small-signal model of the nulling resistor applied to a two-stage op amp.
If ${R}_{z}$ is assumed to be less than ${R}_{I}$ or ${R}_{II}$ and the poles are widely spaced, then the roots of Eq. (6.2-32) can be approximated as
$$
{p}_{1} \cong  \frac{-1}{\left( {1 + {g}_{mII}{R}_{II}}\right) {R}_{I}{C}_{c}} \cong  \frac{-1}{{g}_{mII}{R}_{II}{R}_{I}{C}_{c}} \tag{6.2-37}
$$
$$
{p}_{2} \cong  \frac{-{g}_{mII}{C}_{c}}{{C}_{I}{C}_{II} + {C}_{c}{C}_{I} + {C}_{c}{C}_{II}} \cong  \frac{-{g}_{mII}}{{C}_{II}} \tag{6.2-38}
$$
$$
{p}_{4} = \frac{-1}{{R}_{z}{C}_{I}} \tag{6.2-39}
$$
and
$$
{z}_{1} = \frac{1}{{C}_{c}\left( {1/{g}_{mII} - {R}_{z}}\right) } \tag{6.2-40}
$$
It is easy to see how the nulling resistor accomplishes the control over the RHP zero. Figure 6.2-15 shows the output stage broken into two parts, similar to what was done in Fig. 6.2-11. The output voltage, ${V}_{\text{out }}$ , can be written as
$$
{V}_{\text{out }} = \frac{-{g}_{m6}{R}_{II}\left( {{R}_{z} + \frac{1}{s{C}_{c}}}\right) }{{R}_{II} + {R}_{z} + \frac{1}{s{C}_{c}}}{V}^{\prime } + \frac{{R}_{II}}{{R}_{II} + {R}_{z} + \frac{1}{s{C}_{c}}}{V}^{\prime \prime } = \frac{-{R}_{II}\left( {{g}_{m6}{R}_{z} + \frac{{g}_{m6}}{s{C}_{c}} - 1}\right) }{{R}_{II} + {R}_{z} + \frac{1}{s{C}_{c}}} \tag{6.2-41}
$$
Setting the numerator equal to zero gives Eq. (6.2-40), assuming ${g}_{m6} = {g}_{mII}$ .
The resistor ${R}_{z}$ allows independent control over the placement of the zero. In order to remove the RHP zero, ${R}_{z}$ must be set equal to $1/{g}_{mII}$ . Another option is to move the zero from the RHP to the LHP and place it on top of ${p}_{2}$ . As a result, the pole associated with the output loading capacitance is canceled. To accomplish this, the following condition must be satisfied:
$$
{z}_{1} = {p}_{2} \tag{6.2-42}
$$
which results in
$$
\frac{1}{{C}_{c}\left( {1/{g}_{mII} - {R}_{z}}\right) } = \frac{-{g}_{mII}}{{C}_{II}} \tag{6.2-43}
$$

plishes the control of the RHP zero.
Figure 6.2-15 Illustration of how the nulling resistor accom-
The value of ${R}_{z}$ can be found as
$$
{R}_{z} = \left( \frac{{C}_{c} + {C}_{H}}{{C}_{c}}\right) \left( \frac{1}{{g}_{mH}}\right)  \tag{6.2-44}
$$
With ${p}_{2}$ canceled, the remaining roots are ${p}_{1}$ and ${p}_{3}$ . For unity-gain stability, all that is required is that the magnitudes of ${p}_{3}$ and ${p}_{4}$ be sufficiently greater than ${GB}$ . Therefore
$$
\left| {p}_{3}\right|  > {A}_{v}\left( 0\right) \left| {p}_{1}\right|  = \frac{{A}_{v}\left( 0\right) }{{g}_{mII}{R}_{II}{R}_{I}{C}_{c}} = {GB} \tag{6.2-45}
$$
$$
\left| {p}_{4}\right|  = \left( {1/{R}_{z}{C}_{I}}\right)  > \left( {{g}_{mI}/{C}_{c}}\right)  \tag{6.2-46}
$$
Substituting Eq. (6.2-44) into Eq. (6.2-46) and assuming ${C}_{H} \gg  {C}_{c}$ results in
$$
{C}_{c} > \sqrt{\frac{{g}_{mI}}{{g}_{mII}}{C}_{I}{C}_{II}} \tag{6.2-47}
$$
The nulling resistor approach has been used in the two-stage op amp with excellent results. The op amp can have good stability properties even with a large load capacitor. The only drawback is that the output pole, ${p}_{2}$ , cannot change after the compensation has been designed (as it will if ${C}_{L}$ changes).
The magnitude of the output pole, ${p}_{2}$ , can be increased by introducing gain in the Miller capacitor feedback path as done by M8 in Fig. 6.2-16(a) [5]. The small-signal model of Fig. 6.2-16(a) is shown in Fig. 6.2-16(b). The resistors ${R}_{1}$ and ${R}_{2}$ are defined as
$$
{R}_{1} = \frac{1}{{g}_{ds2} + {g}_{ds4} + {g}_{ds9}} \tag{6.2-48}
$$

Figure 6.2-16 (a) Circuit to increase the magnitude of the output pole. (b) Small-signal model of (a). (c) Simplified version of (b). (d) Resulting poles and zeros of (a).
and
$$
{R}_{2} = \frac{1}{{g}_{ds6} + {g}_{ds7}} \tag{6.2-49}
$$
where transistors M2 and M4 are the output transistors of the first stage. In order to simplify the analysis, we have rearranged the controlled source, ${g}_{m8}{V}_{s8}$ , and have ignored ${r}_{ds8}$ . The simplified small-signal model of Fig. 6.2-16(a) is given in Fig. 6.2-16(c). The nodal equations of this circuit are
$$
{I}_{\text{in }} = {G}_{1}{V}_{1} - {g}_{m8}{V}_{s8} = {G}_{1}{V}_{1} - \left( \frac{{g}_{m8}s{C}_{c}}{{g}_{m8} + s{C}_{c}}\right) {V}_{\text{out }} \tag{6.2-50}
$$
and
$$
0 = {g}_{m6}{V}_{1} + \left( {{G}_{2} + s{C}_{2} + \frac{{g}_{m8}s{C}_{c}}{{g}_{m8} + s{C}_{c}}}\right) {V}_{\text{out }} \tag{6.2-51}
$$
Solving for the transfer function ${V}_{\text{out }}/{I}_{\text{in }}$ gives
$$
\frac{{V}_{\text{out }}}{{I}_{\text{in }}} = \left( \frac{-{g}_{m6}}{{G}_{1}{G}_{2}}\right) \left\lbrack  \frac{\left( 1 + \frac{s{C}_{c}}{{g}_{m8}}\right) }{1 + s\left( {\frac{{C}_{c}}{{g}_{m8}} + \frac{{C}_{2}}{{G}_{2}} + \frac{{C}_{c}}{{G}_{2}} + \frac{{g}_{m6}{C}_{c}}{{G}_{1}{G}_{2}}}\right)  + {s}^{2}\left( \frac{{C}_{c}{C}_{2}}{{g}_{m8}{G}_{2}}\right) }\right\rbrack   \tag{6.2-52}
$$
Using the approximate method of solving for the roots of the denominator illustrated earlier gives
$$
{p}_{1} = \frac{-1}{\frac{{C}_{c}}{{g}_{m8}} + \frac{{C}_{c}}{{G}_{2}} + \frac{{C}_{2}}{{G}_{2}} + \frac{{g}_{m6}{C}_{c}}{{G}_{1}{G}_{2}}} \approx  \frac{-6}{{g}_{m6}{r}_{ds}^{2}{C}_{c}} \tag{6.2-53}
$$
and
$$
{p}_{2} \approx  \frac{\frac{{g}_{m6}{r}_{ds}^{2}{C}_{c}}{6}}{\frac{{C}_{c}{C}_{2}}{{g}_{m8}{G}_{2}}} = \frac{{g}_{m8}{r}_{ds}^{2}{G}_{2}}{6}\left( \frac{{g}_{m6}}{{C}_{2}}\right)  = \left( \frac{{g}_{m8}{r}_{ds}}{3}\right) \left| {p}_{2}^{\prime }\right|  \tag{6.2-54}
$$
where all the various channel resistances have been assumed to equal ${r}_{ds}$ and ${p}_{2}^{\prime }$ is the output pole for normal Miller compensation. The result of Fig. 6.2-16(a) is to keep the dominant pole approximately the same and to multiply the output pole by roughly the gain of a single stage $\left( {{g}_{m}{r}_{ds}}\right)$ . In addition to the poles, there is an LHP zero at ${g}_{m8}/s{C}_{c}$ , which can be used to enhance the compensation. Note in Fig. 6.2-16(d) that there is still an RHP zero in the compensation scheme of Fig. 6.2-16 because of the feedforward path through ${C}_{gd6}$ shown as the dashed path on Figs. 6.2-16(b) and 6.2-16(c).

Figure 6.2-17 Illustration of how the output pole is increased by Fig. 6.2-16(a).
Figure 6.2-17 shows intuitively how the output pole is increased by the addition of M8 in the feedback path around M6. At frequencies near ${GB}$ , the reactance of ${C}_{c}$ can be considered small. Under these assumptions, M6 approximates an MOS diode with a gain of ${g}_{m8}{r}_{ds8}$ in the feedback path. This makes the output resistance seen by ${C}_{2}\left( {C}_{H}\right)$ to be approximately
$$
{R}_{\text{out }} = {R}_{II}\parallel \left( \frac{1}{{g}_{m6}{g}_{m8}{r}_{ds8}}\right)  \approx  \frac{1}{{g}_{m6}{g}_{m8}{r}_{ds8}} \tag{6.2-55}
$$
Multiplying this resistance by ${C}_{2}$ and inverting gives Eq. (6.2-54), ignoring the influence of the channel resistances of other transistors, which leads to the 3 in the denominator.
## Feedforward Compensation
Another compensation technique used in CMOS op amps is the feedforward scheme shown in Fig. 6.2-18(a). In this circuit, the buffer is used to break the bidirectional path through the compensation capacitor. Unfortunately, this circuit will result in a zero that is in the right half-plane. If either the polarity of the buffer or the high-gain amplifier is reversed, the zero will be in the left half-plane. Figure 6.2-18(b) shows a feedforward compensation technique that has a zero in the left half-plane because the gain of the buffer is inverted. Figure 6.2-18(c) can be used as a model for this circuit. The voltage-transfer function ${V}_{\text{out }}\left( s\right) /{V}_{\text{in }}\left( s\right)$ can be found to be
$$
\frac{{V}_{\text{out }}\left( s\right) }{V\left( s\right) } = \frac{-A{C}_{c}}{{C}_{c} + {C}_{II}}\left( \frac{s + {g}_{mII}/A{C}_{c}}{s + 1/\left\lbrack  {{R}_{II}\left( {{C}_{c} + {C}_{II}}\right) }\right\rbrack  }\right)  \tag{6.2-56}
$$

Figure 6.2-18 (a) Feedforward resulting in an RHP zero. (b) Feedforward resulting in an LHP zero. (c) Small-signal model for (b).

Figure 6.2-19 Feedforward compensation around a noninverting amplifier.
In order to use the circuit in Fig. 6.2-18(b) to achieve compensation, it is necessary to place the zero located at ${g}_{mII}/A{C}_{c}$ above the value of ${GB}$ so that the boosting of the magnitude will not negate the desired effect of positive phase shift caused by the zero. Fortunately, the phase effects extend over a much broader frequency range than the magnitude effects so that this method will contribute additional phase margin to that provided by the feedback compensation technique. It is quite possible that several zeros can be generated in the transfer function of the op amp. These zeros should all be placed above ${GB}$ and should be well controlled to avoid large settling times caused by poles and zeros that are close together in the transient response [6].
Another form of feedforward compensation is to provide a feedforward path around a noninverting amplifier. This is shown in Fig. 6.2-19. This type of compensation is often used in source followers, where a capacitor is connected from the gate to source of the source follower. The capacitor will provide a path that bypasses the transistor at high frequencies.

### 6.3 Design of the Two-Stage Op Amp
The previous two sections described the general approach to op amp design and compensation. In this section, a procedure will be developed that will enable a first-cut design of the two-stage op amp shown in Fig. 6.3-1. In order to simplify the notation, it is convenient to define the notation ${S}_{i} = {W}_{i}/{L}_{i} = {\left( W/L\right) }_{i}$ , where ${S}_{i}$ is the ratio of $W$ and $L$ of the $i$ th transistor.

Figure 6.3-1 Schematic of an unbuffered, two-stage CMOS op amp with an n-channel input pair.
## Design Procedure for the Two-Stage CMOS Op Amp
Before beginning this task, important relationships describing op amp performance will be summarized from Section 6.2, assuming that ${g}_{m1} = {g}_{m2} = {g}_{ml},{g}_{m6} = {g}_{mIl},{g}_{ds2} + {g}_{ds4} = {G}_{l}$ , and ${g}_{ds6} + {g}_{ds7} = {G}_{H}$ . These relationships are based on the circuit shown in Fig. 6.3-1.
$$
\text{Slew rate}{SR} = \frac{{I}_{5}}{{C}_{c}} \tag{6.3-1}
$$
$$
\text{First-stage gain}{A}_{v1} = \frac{-{g}_{m1}}{{g}_{ds2} + {g}_{ds4}} = \frac{-2{g}_{m1}}{{I}_{5}\left( {{\lambda }_{2} + {\lambda }_{4}}\right) } \tag{6.3-2}
$$
$$
\text{Second-stage gain}{A}_{v2} = \frac{-{g}_{m6}}{{g}_{ds6} + {g}_{ds7}} = \frac{-{g}_{m6}}{{I}_{6}\left( {{\lambda }_{6} + {\lambda }_{7}}\right) } \tag{6.3-3}
$$
$$
\text{ Gain bandwidth }{GB} = \frac{{g}_{m1}}{{C}_{c}} \tag{6.3-4}
$$
$$
\text{Output pole}{p}_{2} = \frac{-{g}_{m6}}{{C}_{L}} \tag{6.3-5}
$$
$$
\text{ RHP zero }{z}_{1} = \frac{{g}_{m6}}{{C}_{c}} \tag{6.3-6}
$$
$$
\text{Positive CMR}{V}_{\text{in }}\left( \max \right)  = {V}_{DD} - \sqrt{\frac{{I}_{5}}{{\beta }_{3}}} - \left| {V}_{T03}\right| \left( \max \right)  + {V}_{T1}\left( \min \right)  \tag{6.3-7}
$$
$$
\text{Negative CMR}{V}_{\text{in }}\left( \min \right)  = {V}_{SS} + \sqrt{\frac{{I}_{5}}{{\beta }_{1}}} + {V}_{T1}\left( \max \right)  + {V}_{DS5}\left( \text{sat}\right)  \tag{6.3-8}
$$
$$
\text{Saturation voltage}{V}_{DS}\left( \text{sat}\right)  = \sqrt{\frac{2{I}_{DS}}{\beta }} \tag{6.3-9}
$$
It is assumed that all transistors are in saturation for the above relationships.
The following design procedure assumes that specifications for the following parameters are given:
1. Gain at $\mathrm{{dc}},{A}_{v}\left( 0\right)$
2. Gain bandwidth, ${GB}$
3. Input common-mode range, ICMR
4. Load capacitance, ${C}_{L}$
5. Slew rate, ${SR}$
6. Output voltage swing
7. Power dissipation, ${P}_{\text{diss }}$
The design procedure begins by choosing a device length to be used throughout the circuit. This value will determine the value of the channel length modulation parameter $\lambda$ , which will be a necessary parameter in the calculation of amplifier gain. Because transistor modeling varies strongly with channel length, the selection of a device length to be used in the design (where possible) allows for more accurate simulation models. Having chosen the nominal transistor device length, one next establishes the minimum value for the compensation capacitor ${C}_{c}$ . It was shown in Section 6.2 that placing the output pole ${p}_{2}{2.2}$ times higher than the ${GB}$ permitted a ${60}^{ \circ  }$ phase margin (assuming that the RHP zero ${z}_{1}$ is placed at or beyond ten times ${GB}$ ). It was shown in Eq. (6.2-22) that such pole and zero placements result in the following requirement for the minimum value for ${C}_{c}$ :
$$
{C}_{c} > \left( {{2.2}/{10}}\right) {C}_{L} \tag{6.3-10}
$$
Next, determine the minimum value for the tail current ${I}_{5}$ , based on slew-rate requirements. Using Eq. (6.3-1), the value for ${I}_{5}$ is determined to be
$$
{I}_{5} = {SR}\left( {C}_{c}\right)  \tag{6.3-11}
$$
If the slew-rate specification is not given, then one can choose a value based on settling-time requirements. Determine a value that is roughly ten times faster than the settling-time specification, assuming that the output slews approximately one-half of the supply rail. The value of ${I}_{5}$ resulting from this calculation can be changed later if need be. The aspect ratio of M3 can now be determined by using the requirement for positive input common-mode range. The following design equation for ${\left( W/L\right) }_{3}$ was derived from Eq. (6.3-7):
$$
{S}_{3} = {\left( W/L\right) }_{3} = \frac{{I}_{5}}{\left( {K}_{3}^{\prime }\right) {\left\lbrack  {V}_{DD} - {V}_{\text{in }}\left( \max \right)  - \left| {V}_{T03}\right| \left( \max \right)  + {V}_{T1}\left( \min \right) \right\rbrack  }^{2}} \tag{6.3-12}
$$
If the value determined for ${\left( W/L\right) }_{3}$ is less than one, then it should be increased to a value that minimizes the product of $W$ and $L$ . This minimizes the area of the gate region, which in turn reduces the gate capacitance. This gate capacitance contributes to the mirror pole, which may cause a degradation in phase margin.
Requirements for the transconductance of the input transistors can be determined from knowledge of ${C}_{c}$ and ${GB}$ . The transconductance ${g}_{m1}$ can be calculated using the following equation:
$$
{g}_{m1} = {GB}\left( {C}_{c}\right)  \tag{6.3-13}
$$
The aspect ratio ${\left( W/L\right) }_{1}$ is directly obtainable from ${g}_{m1}$ as shown below:
$$
{S}_{1} = {\left( W/L\right) }_{1} = \frac{{g}_{m1}^{2}}{\left( {K}_{1}^{\prime }\right) \left( {I}_{5}\right) } \tag{6.3-14}
$$
Enough information is now available to calculate the saturation voltage of transistor M5. Using the negative ICMR equation, calculate ${V}_{DS5}$ using the following relationship derived from Eq. (6.3-8):
$$
{V}_{DS5} = {V}_{\text{in }}\left( \min \right)  - {V}_{SS} - {\left( \frac{{I}_{5}}{{\beta }_{1}}\right) }^{1/2} - {V}_{T1}\left( \max \right)  \tag{6.3-15}
$$
If the value for ${V}_{DS5}$ is less than about ${100}\mathrm{{mV}}$ , then the possibility of a rather large ${\left( W/L\right) }_{5}$ may result. This may not be acceptable. If the value for ${V}_{DS5}$ is less than zero, then the ICMR specification may be too stringent. To solve this problem, ${I}_{5}$ can be reduced or ${\left( W/L\right) }_{1}$ increased. The effects of these changes must be accounted for in previous design steps. One must iterate until the desired result is achieved. With ${V}_{DS5}$ determined, ${\left( W/L\right) }_{5}$ can be extracted using Eq. (6.3-9) in the following way:
$$
{S}_{5} = {\left( W/L\right) }_{5} = \frac{2\left( {I}_{5}\right) }{{K}_{5}^{\prime }{\left( {V}_{DS5}\right) }^{2}} \tag{6.3-16}
$$
At this point, the design of the first stage of the op amp is complete. We next consider the output stage.
For a phase margin of ${60}^{ \circ  }$ , the location of the output pole was assumed to be placed at 2.2 times ${GB}$ . Based on this assumption and the relationship for $\left| {p}_{2}\right|$ in Eq. (6.3-5), the transconductance ${g}_{m6}$ can be determined using the following relationship:
$$
{g}_{m6} = {2.2}\left( {g}_{m2}\right) \left( {{C}_{L}/{C}_{c}}\right)  \tag{6.3-17}
$$
Generally, for reasonable phase margin, the value of ${g}_{m6}$ is approximately ten times the input stage transconductance ${g}_{m1}$ . At this point, there are two possible approaches to completing the design of $\mathrm{M}6$ (i.e., ${W}_{6}/{L}_{6}$ and ${I}_{6}$ ). The first is to achieve proper mirroring of the first-stage current-mirror load of Fig. 6.3-1 (M3 and M4). This requires that ${V}_{SG4} = {V}_{SG6}$ . Using the formula for ${g}_{m}$ , which is ${K}^{\prime }S\left( {{V}_{GS} - {V}_{T}}\right)$ , we can write that if ${V}_{SG4} = {V}_{SG6}$ , then
$$
{S}_{6} = {S}_{4}\frac{{g}_{m6}}{{g}_{m4}} \tag{6.3-18}
$$
Knowing ${g}_{m6}$ and ${S}_{6}$ will define the dc current ${I}_{6}$ using the following equation:
$$
{I}_{6} = \frac{{g}_{m6}^{2}}{\left( 2\right) \left( {K}_{6}^{\prime }\right) {\left( W/L\right) }_{6}} = \frac{{g}_{m6}^{2}}{2{K}_{6}^{\prime }{S}_{6}} \tag{6.3-19}
$$
One must now check to make sure that the maximum output voltage specification is satisfied. If this is not true, then the current or $W/L$ ratio can be increased to achieve a smaller ${V}_{DS}$ (sat). If these changes are made to satisfy the maximum output voltage specification, then the proper current mirroring of M3 and M4 is no longer guaranteed.
The second approach to designing the output stage is to use the value of ${g}_{m6}$ and the required ${V}_{DS}$ (sat) of M6 to find the current. Combining the defining equation for ${g}_{m}$ and ${V}_{DS}$ (sat) results in an equation relating $\left( {W/L}\right) ,{V}_{DS}$ (sat), ${g}_{m}$ , and process parameters. Using this relationship, given below, with the ${V}_{DS}$ (sat) requirement taken from the output range specification one can determine ${\left( W/L\right) }_{6}$ .
$$
{S}_{6} = {\left( W/L\right) }_{6} = \frac{{g}_{m6}}{{K}_{6}^{\prime }{V}_{DS6}\left( \mathrm{{sat}}\right) } \tag{6.3-20}
$$
Equation (6.3-19) is used as before to determine a value for ${I}_{6}$ . In either approach to finding ${I}_{6}$ , one also should check the power dissipation requirements since ${I}_{6}$ will most likely determine the majority of the power dissipation.
The device size of M7 can be determined from the balance equation given below:
$$
{S}_{7} = {\left( W/L\right) }_{7} = {\left( W/L\right) }_{5}\left( \frac{{I}_{6}}{{I}_{5}}\right)  = {S}_{5}\left( \frac{{I}_{6}}{{I}_{5}}\right)  \tag{6.3-21}
$$
The first-cut design of all $W/L$ ratios is now complete. Figure 6.3-2 illustrates the above design procedure showing the various design relationships and where they apply in the two-stage CMOS op amp.
At this point in the design procedure, the total amplifier gain must be checked against the specifications.
$$
{A}_{v} = \frac{\left( 2\right) \left( {g}_{m2}\right) \left( {g}_{m6}\right) }{{I}_{5}\left( {{\lambda }_{2} + {\lambda }_{4}}\right) {I}_{6}\left( {{\lambda }_{6} + {\lambda }_{7}}\right) } \tag{6.3-22}
$$
If the gain is too low, a number of things can be adjusted. The best way to do this is to use Table 6.3-1, which shows the effects of various device sizes and currents on the different parameters generally specified. Each adjustment may require another pass through this design procedure in order to ensure that all specifications have been met. Table 6.3-2 summarizes the above design procedure.
No attempt has been made to account for noise or PSRR thus far in the design procedure. Now that the preliminary design is complete, these two specifications can be addressed. The input-referred noise voltage results primarily from the load and input transistors of the first stage. Each of these contributes both thermal and $1/f$ noise. The $1/f$ noise contributed by any transistor can be reduced by increasing device area (e.g., increase ${WL}$ ). Thermal noise contributed by any transistor can be reduced by increasing its ${g}_{m}$ . This is accomplished by an increase in $W/L$ , an increase in current, or both. Effective input-noise voltage attributed to the load transistors can be reduced by reducing the ${g}_{m3}/{g}_{m1}\left( {{g}_{m4}/{g}_{m2}}\right)$ ratio. One must be careful that these adjustments to improve noise performance do not adversely affect some other important performance parameter of the op amp.

Figure 6.3-2 Illustration of the design relationship and the circuit for a two-stage CMOS op amp.
Table 6.3-1 Dependence of the Performance of Fig. 6.3-1 on dc Current, W/L Ratios, and the Compensating Capacitor
<table><tr><td rowspan="2"/><td colspan="2">Drain Current</td><td colspan="2">M1 and M2</td><td colspan="2">M3 and M4</td><td>Inverter</td><td colspan="2">Inverter Load</td><td>Compensation Capacitor</td></tr><tr><td>${l}_{5}$</td><td>${l}_{7}$</td><td>W/L</td><td>L</td><td>$W$</td><td>L</td><td>${W}_{6}/{L}_{6}$</td><td>${W}_{7}$</td><td>${L}_{7}$</td><td>${C}_{c}$</td></tr><tr><td>Increase dc Gain</td><td>${\left(  \downarrow  \right) }^{1/2}$</td><td>${\left(  \downarrow  \right) }^{1/2}$</td><td>${\left(  \uparrow  \right) }^{1/2}$</td><td>↑</td><td/><td>↑</td><td>${\left(  \uparrow  \right) }^{1/2}$</td><td/><td>↑</td><td/></tr><tr><td>Increase ${GB}$</td><td>${\left(  \uparrow  \right) }^{1/2}$</td><td/><td>${\left(  \uparrow  \right) }^{1/2}$</td><td/><td/><td/><td/><td/><td/><td>↓</td></tr><tr><td>Increase RHP Zero</td><td/><td>${\left(  \uparrow  \right) }^{1/2}$</td><td/><td/><td/><td/><td>${\left(  \uparrow  \right) }^{1/2}$</td><td/><td/><td>↓</td></tr><tr><td>Increase Slew Rate</td><td>↑</td><td/><td/><td/><td/><td/><td/><td/><td/><td>↓</td></tr><tr><td>Increase ${C}_{L}$</td><td/><td/><td/><td/><td/><td/><td/><td/><td/><td>↑</td></tr></table>
## Table 6.3-2 Unbuffered Op Amp Design Procedure
This design procedure assumes that the gain at dc $\left( {A}_{v}\right)$ , unity-gain bandwidth(GB), input common-mode range $\left\lbrack  {{V}_{\text{in }}\left( \min \right) \text{and}{V}_{\text{in }}\left( \max \right) }\right\rbrack$ , load capacitance $\left( {C}_{L}\right)$ , slew rate(SR), settling time $\left( {T}_{s}\right)$ , output voltage swing $\left\lbrack  {{V}_{\text{out }}\left( \max \right) \text{and}{V}_{\text{out }}\left( \min \right) }\right\rbrack$ , and power dissipation $\left( {P}_{\text{diss }}\right)$ are given.
1. Choose the smallest device length that will keep the channel modulation parameter constant and give good matching for current mirrors.
2. From the desired phase margin, choose the minimum value for ${C}_{c}$ ; that is, for a ${60}^{ \circ  }$ phase margin we use the following relationship. This assumes that $z \geq  {10}\mathrm{{GB}}$ .
$$
{C}_{c} > {0.22}{C}_{L}
$$
3. Determine the minimum value for the "tail current" $\left( {I}_{5}\right)$ from the largest of the two values.
$$
{I}_{5} = {SR} \cdot  {C}_{c}
$$
4. Design for ${S}_{3}$ from the maximum input voltage specification.
$$
{S}_{3} = \frac{2{I}_{3}}{{K}_{3}^{\prime }{\left\lbrack  {V}_{DD} - {V}_{\text{in }}\left( \max \right)  - \left| {V}_{T03}\right| \left( \max \right)  + {V}_{T1}\left( \min \right) \right\rbrack  }^{2}} \geq  1
$$
5. Verify that the pole and zero due to ${C}_{gs3}$ and ${C}_{gs4}\left( { = {0.67}{W}_{3}{L}_{3}{C}_{ox}}\right)$ will not be dominant by assuming ${p}_{3}$ to be greater than ${10GB}$ . Note that a zero exists at $2{p}_{3}$ and will diminish the influence of ${p}_{3}$ on the op amp.
$$
\frac{{g}_{m3}}{2{C}_{gs3}} > {10}\mathrm{{GB}}
$$
6. Design for ${S}_{1}\left( {S}_{2}\right)$ to achieve the desired ${GB}$ .
$$
{g}_{m1} = {GB} \cdot  {C}_{c} \Rightarrow  {S}_{1} = {S}_{2} = \frac{{g}_{m2}^{2}}{{K}_{2}^{\prime }{I}_{5}}
$$
## Table 6.3-2 (continued)
7. Design for ${S}_{5}$ from the minimum input voltage. First calculate ${V}_{DS5}$ (sat) and then find ${S}_{5}$ .
$$
{V}_{DS5}\left( \mathrm{{sat}}\right)  = {V}_{\mathrm{{in}}}\left( \min \right)  - {V}_{SS} - \sqrt{\frac{{I}_{5}}{{\beta }_{1}}} - {V}_{T1}\left( \max \right)  \geq  {100}\mathrm{{mV}}
$$
$$
{S}_{5} = \frac{2{I}_{5}}{{K}_{5}^{\prime }{\left\lbrack  {V}_{DS5}\left( \mathrm{{sat}}\right) \right\rbrack  }^{2}}
$$
8. Find ${S}_{6}$ and ${I}_{6}$ by letting the second pole $\left( {p}_{2}\right)$ be equal to 2.2 times ${GB}$ .
$$
{g}_{m6} = {2.2}{g}_{m2}\left( {{C}_{L}/{C}_{c}}\right)
$$
Let ${V}_{SG4} = {V}_{SG6}$ , which gives
$$
{S}_{6} = {S}_{4}\frac{{g}_{m6}}{{g}_{m4}}
$$
Knowing ${g}_{m6}$ and ${S}_{6}$ allows us to solve for ${I}_{6}$ as
$$
{I}_{6} = \frac{{g}_{m6}^{2}}{2{K}_{6}^{\prime }{S}_{6}}
$$
9. Alternately, ${I}_{6}$ can be calculated by solving for ${S}_{6}$ using
$$
{S}_{6} = \frac{{g}_{m6}}{{K}_{6}^{\prime }{V}_{DS6}\left( \mathrm{{sat}}\right) }
$$
and then using the previous relationship to find ${I}_{6}$ . Of course, the proper mirror between M3 and M4 is no longer guaranteed.
10. Design ${S}_{7}$ to achieve the desired current ratios between ${I}_{5}$ and ${I}_{6}$ .
$$
{S}_{7} = \left( {{I}_{6}/{I}_{5}}\right) {S}_{5}
$$
11. Check gain and power dissipation specifications.
$$
{A}_{v} = \frac{2{g}_{m2}{g}_{m6}}{{I}_{5}\left( {{\lambda }_{2} + {\lambda }_{3}}\right) \left( {{\lambda }_{6} + {\lambda }_{7}}\right) }
$$
$$
{P}_{\text{diss }} = \left( {{I}_{5} + {I}_{6}}\right) \left( {{V}_{DD} + \left| {V}_{SS}\right| }\right)
$$
12. If the gain specification is not met, then the currents ${I}_{5}$ and ${I}_{6}$ can be decreased or the $W/L$ ratios of M2 and/or M6 increased. The previous calculations must be rechecked to ensure that they have been satisfied. If the power dissipation is too high, then one can only reduce the currents ${I}_{5}$ and ${I}_{6}$ . Reduction of currents will probably necessitate an increase of some of the $W/L$ ratios to satisfy input and output swings.
13. Simulate the circuit to check to see that all specifications are met.
The power-supply rejection ratio is to a large degree determined by the configuration used. Some improvement in negative PSRR can be achieved by increasing the output resistance of M5. This is usually accomplished by increasing both ${W}_{5}$ and ${L}_{5}$ proportionately without seriously affecting any other performance. Transistor M7 should be adjusted accordingly for proper matching. A more detailed analysis of the PSRR of the two-stage op amp will be considered in the next section.
The following example illustrates the steps in designing the op amp described.
---
Example 6.3-1
---
## Design of a Two-Stage Op Amp
Using the material and device parameters given in Tables 3.1-1 and 3.1-2, design an amplifier similar to that shown in Fig. 6.3-1 that meets the following specifications with a phase margin of ${60}^{ \circ  }$ . Assume the channel length is to be ${1\mu }\mathrm{m}$ .
$$
{A}_{v} > {5000}\mathrm{\;V}/\mathrm{V}
$$
$$
{V}_{DD} = {2.5}\mathrm{\;V}
$$
$$
{V}_{SS} =  - {2.5}\mathrm{\;V}
$$
$$
{GB} = 5\mathrm{{MHz}}
$$
$$
{C}_{L} = {10}\mathrm{{pF}}
$$
$$
{SR} > {10}\mathrm{\;V}/\mathrm{{\mu s}}
$$
$$
{V}_{\text{out }}\text{range} =  \pm  2\mathrm{\;V}
$$
ICMR $=  - 1$ to $2\mathrm{\;V}$
$$
{P}_{\text{diss }} \leq  2\mathrm{\;{mW}}
$$
## SOLUTION
The first step is to calculate the minimum value of the compensation capacitor ${C}_{c}$ , which is
$$
{C}_{c} > \left( {{2.2}/{10}}\right) \left( {{10}\mathrm{{pF}}}\right)  = {2.2}\mathrm{{pF}}
$$
Choose ${C}_{c}$ as $3\mathrm{{pF}}$ . Using the slew-rate specification and ${C}_{c}$ calculate ${I}_{5}$ .
$$
{I}_{5} = \left( {3 \times  {10}^{-{12}}}\right) \left( {{10} \times  {10}^{6}}\right)  = {30\mu }\mathrm{A}
$$
Next calculate ${\left( W/L\right) }_{3}$ using ICMR requirements. Using Eq. (6.3-12) we have
$$
{\left( W/L\right) }_{3} = \frac{{30} \times  {10}^{-6}}{\left( {{50} \times  {10}^{-6}}\right) {\left\lbrack  {2.5} - 2 - {0.85} + {0.55}\right\rbrack  }^{2}} = {15}
$$
Therefore,
$$
{\left( W/L\right) }_{3} = {\left( W/L\right) }_{4} = {15}
$$
Now we can check the value of the mirror pole, ${p}_{3}$ , to make sure that it is in fact greater than ${10GB}$ . Assume the ${C}_{\mathrm{{ox}}} = {2.47}\mathrm{{fF}}/\mu {\mathrm{m}}^{2}$ . The mirror pole can be found as
$$
{p}_{3} \approx  \frac{-{g}_{m3}}{2{C}_{gs3}} = \frac{-\sqrt{2{K}_{p}^{\prime }{S}_{3}{I}_{3}}}{2\left( {0.667}\right) {W}_{3}{L}_{3}{C}_{\mathrm{{ox}}}} = {2.81} \times  {10}^{9}\mathrm{{rad}}/\mathrm{s}
$$
or ${448}\mathrm{{MHz}}$ . Thus, ${p}_{3}$ and ${z}_{3}$ are not of concern in this design because ${p}_{3} \gg  {10GB}$ .
The next step in the design is to calculate ${g}_{m1}$ using Eq. (6.3-13).
$$
{g}_{m1} = \left( {5 \times  {10}^{6}}\right) \left( {2\pi }\right) \left( {3 \times  {10}^{-{12}}}\right)  = {94.25\mu }\mathrm{S}
$$
Therefore, ${\left( W/L\right) }_{1}$ is
$$
{\left( W/L\right) }_{1} = {\left( W/L\right) }_{2} = \frac{{g}_{m1}^{2}}{2{K}_{N}^{\prime }{I}_{1}} = \frac{{\left( {94.25}\right) }^{2}}{2 \cdot  {110} \cdot  {15}} = {2.79} \approx  {3.0}
$$
Next, calculate ${V}_{DS5}$ using Eq. (6.3-15).
$$
{V}_{DS5} = \left( {-1}\right)  - \left( {-{2.5}}\right)  - \sqrt{\frac{{30} \times  {10}^{-6}}{{110} \times  {10}^{-6} \cdot  3}} - {0.85} = {0.35}\mathrm{\;V}
$$
Using ${V}_{DS5}$ calculate ${\left( W/L\right) }_{5}$ from Eq. (6.3-16).
$$
{\left( W/L\right) }_{5} = \frac{2\left( {{30} \times  {10}^{-6}}\right) }{\left( {{110} \times  {10}^{-6}}\right) {\left( {0.35}\right) }^{2}} = {4.49} \approx  {4.5}
$$
From Eq. (6.2-20), we know that
$$
{g}_{m6} \geq  {10}{g}_{m1} \geq  {942.5\mu }\mathrm{S}
$$
Assuming that ${g}_{m6} = {942.5\mu }\mathrm{S}$ and calculating ${g}_{m4}$ as ${150\mu }\mathrm{S}$ , we use Eq. (6.3-18) to get
$$
{S}_{6} = {S}_{4}\frac{{g}_{m6}}{{g}_{m4}} = {15} \cdot  \frac{942.5}{150} = {94.25} \approx  {94}
$$
Calculate ${I}_{6}$ using Eq. (6.3-19).
$$
{I}_{6} = \frac{{\left( {942.5} \times  {10}^{-6}\right) }^{2}}{\left( 2\right) \left( {{50} \times  {10}^{-6}}\right) \left( {94}\right) } = {94.5\mu }\mathrm{A} \approx  {95\mu }\mathrm{A}
$$
Designing ${S}_{6}$ by using Eq. (6.3-20) gives ${S}_{6} \approx  {15}$ . Since the $W/L$ ratio of 94 from above is greater, the maximum output voltage specification will be met.
Finally, calculate ${\left( W/L\right) }_{7}$ using Eq. (6.3-21).
$$
{\left( W/L\right) }_{7} = {4.5}\left( \frac{{95} \times  {10}^{-6}}{{30} \times  {10}^{-6}}\right)  = {14.25} \approx  {14}
$$
Let us check the ${V}_{\text{out }}\left( \min \right)$ specification although the $W/L$ of M7 is large enough that this is probably not necessary. The value of ${V}_{\text{out }}\left( \min \right)$ is
$$
{V}_{\min }\left( \text{ out }\right)  = {V}_{DS7}\left( \text{ sat }\right)  = \sqrt{\frac{2 \cdot  {95}}{{110} \cdot  {14}}} = {0.351}\mathrm{\;V}
$$
which is less than required. At this point, the first-cut design is complete.
The power dissipation can be calculated as
$$
{P}_{\text{diss }} = 5\mathrm{\;V} \cdot  \left( {{30\mu }\mathrm{A} + {95\mu }\mathrm{A}}\right)  = {0.625}\mathrm{{mW}}
$$
Now check to see that the gain specification has been met.
$$
{A}_{v} = \frac{\left( 2\right) \left( {{92.45} \times  {10}^{-6}}\right) \left( {{942.5} \times  {10}^{-6}}\right) }{{30} \times  {10}^{-6}\left( {{0.04} + {0.05}}\right) {95} \times  {10}^{-6}\left( {{0.04} + {0.05}}\right) } = {7696}\mathrm{\;V}/\mathrm{V}
$$
which meets specifications. If more gain were desired, an easy way to achieve it would be to increase the $W$ and $L$ values by a factor of 2, which because of the decreased value of $\lambda$ would increase the gain by a factor of 20. Figure 6.3-3 shows the results of the first-cut design. The next phase requires simulation.

Figure 6.3-3 Result of Example 6.3-1.
## Nulling Resistor, Miller Compensation
It may likely occur that the undesired RHP zero may not be negligible in the above design procedure. This would occur if the ${GB}$ specification was large or if the output stage transconductance $\left( {g}_{m6}\right)$ was not large. In this case, it becomes necessary to employ the nulling resistor compensation method. We shall use the results of Section 6.2 to illustrate how to apply this solution.
Section 6.2 described a technique whereby the RHP zero can be moved to the left half-plane and placed on the highest nondominant pole. To accomplish this, a resistor is placed in series with the compensation capacitor. Figure 6.3-4 shows a compensation scheme using transistor M8 as a resistor. This transistor is controlled by a control voltage ${V}_{c}$ that adjusts the resistor so that it maintains the proper value over process variations [6].
With the addition of the resistor in the compensation scheme, the resulting poles and zeros are [see Eqs. (6.2-37) to (6.2-40)]
$$
{p}_{1} =  - \frac{{g}_{m2}}{{A}_{v}{C}_{c}} =  - \frac{{g}_{m1}}{{A}_{v}{C}_{c}} \tag{6.3-23}
$$
$$
{p}_{2} =  - \frac{{g}_{m6}}{{C}_{L}} \tag{6.3-24}
$$
$$
{p}_{4} =  - \frac{1}{{R}_{z}{C}_{I}} \tag{6.3-25}
$$
$$
{z}_{1} = \frac{-1}{{R}_{z}{C}_{c} - {C}_{c}/{g}_{m6}} \tag{6.3-26}
$$

Figure 6.3-4 CMOS two-stage op amp using nulling resistor compensation.
where ${A}_{v} = {g}_{m1}{g}_{m6}{R}_{I}{R}_{II}$ . In order to place the zero on top of the second pole $\left( {p}_{2}\right)$ , the following relationship must hold:
$$
{R}_{z} = \frac{1}{{g}_{m6}}\left( \frac{{C}_{L} + {C}_{c}}{{C}_{c}}\right)  = \left( \frac{{C}_{c} + {C}_{L}}{{C}_{c}}\right) \frac{1}{\sqrt{2{K}_{P}^{\prime }{S}_{6}{I}_{6}}} \tag{6.3-27}
$$
The resistor ${R}_{z}$ is realized by the transistor M8, which is operating in the active region because the dc current through it is zero. Therefore, ${R}_{z}$ can be written as
$$
{R}_{z} = {\left. \frac{\partial {v}_{DS8}}{\partial {i}_{D8}}\right| }_{{V}_{DS8} = 0} = \frac{1}{{K}_{P}^{\prime }{S}_{8}\left( {{V}_{SG8} - \left| {V}_{TP}\right| }\right) } \tag{6.3-28}
$$
The bias circuit is designed so that voltage ${V}_{A}$ is equal to ${V}_{B}$ . As a result,
$$
\left| {V}_{GS10}\right|  - \left| {V}_{T}\right|  = \left| {V}_{GS8}\right|  - \left| {V}_{T}\right|  \tag{6.3-29}
$$
In the saturation region
$$
\left| {V}_{GS10}\right|  - \left| {V}_{T}\right|  = \sqrt{\frac{2\left( {I}_{10}\right) }{{K}_{P}^{\prime }\left( {{W}_{10}/{L}_{10}}\right) }} = \left| {V}_{GS8}\right|  - \left| {V}_{T}\right|  \tag{6.3-30}
$$
Substituting into Eq. (6.3-28) yields
$$
{R}_{z} = \frac{1}{{K}_{P}^{\prime }{S}_{8}}\sqrt{\frac{{K}_{P}^{\prime }{S}_{10}}{2{I}_{10}}} = \frac{1}{{S}_{8}}\sqrt{\frac{{S}_{10}}{2{K}_{P}^{\prime }{I}_{10}}} \tag{6.3-31}
$$
Equating Eq. (6.3-27) to Eq. (6.3-31) gives
$$
\left( \frac{{W}_{8}}{{L}_{8}}\right)  = \left( \frac{{C}_{c}}{{C}_{L} + {C}_{c}}\right) \sqrt{\frac{{S}_{10}{S}_{6}{I}_{6}}{{I}_{10}}} \tag{6.3-32}
$$
This relationship must be met in order for Eq. (6.3-27) to hold. To complete the design of this compensation circuit, M11 must be designed to meet the criteria set forth in Eq. (6.3-29). To accomplish this ${V}_{SG11}$ must be equal to ${V}_{SG6}$ . Therefore,
$$
\left( \frac{{W}_{11}}{{L}_{11}}\right)  = \left( \frac{{I}_{10}}{{I}_{6}}\right) \left( \frac{{W}_{6}}{{L}_{6}}\right)  \tag{6.3-33}
$$
The example that follows illustrates the design of this compensation scheme.
---
Example 6.3-2
---
## RHP Zero Compensation
Use results of Example 6.3-1 and design compensation circuitry so that the RHP zero is moved from the RHP to the LHP and placed on top of the output pole ${p}_{2}$ . Use device data given in Example 6.3-1.
## SOLUTION
The task at hand is the design of transistors $\mathrm{M}8,\mathrm{M}9,\mathrm{M}{10},\mathrm{M}{11}$ , and bias current ${I}_{10}$ . The first step in this design is to establish the bias components. In order to set ${V}_{A}$ equal to ${V}_{B},{V}_{SG10}$ must be equal to ${V}_{SG6}$ . Therefore,
$$
{S}_{11} = \left( {{I}_{11}/{I}_{6}}\right) {S}_{6}
$$
Choose ${I}_{11} = {I}_{10} = {I}_{9} = {15\mu }\mathrm{A}$ , which gives ${S}_{11} = \left( {{15\mu }\mathrm{A}/{95\mu }\mathrm{A}}\right)  \cdot  {94} = {14.8} \approx  {15}$ .
The aspect ratio of M10 is essentially a free parameter and will be set equal to 1 . There must be sufficient supply voltage to support the sum of ${V}_{SG11},{V}_{SG10}$ , and ${V}_{DS9}$ . The ratio of ${I}_{10}/{I}_{5}$ determines the $\left( {W/L}\right)$ of M9. This ratio is
$$
{\left( W/L\right) }_{9} = \left( {{I}_{10}/{I}_{5}}\right) {\left( W/L\right) }_{5} = \left( {{15}/{30}}\right) \left( {4.5}\right)  = {2.25} \approx  2
$$
Now using design Eq. (6.3-32), ${\left( W/L\right) }_{8}$ is determined to be
$$
{\left( W/L\right) }_{8} = \left( \frac{3\mathrm{{pF}}}{3\mathrm{{pF}} + {10}\mathrm{{pF}}}\right) \sqrt{\frac{1 \cdot  {94} \cdot  {95\mu }\mathrm{A}}{{15\mu }\mathrm{A}}} = {5.63} \approx  6
$$
It is worthwhile to check that the RHP zero has been moved on top of ${p}_{2}$ . To do this, first calculate the value of ${R}_{z}.{V}_{SG8}$ must first be determined. It is equal to ${V}_{SG10}$ , which is
$$
{V}_{SG10} = \sqrt{\frac{2{I}_{10}}{{K}_{p}^{\prime }{S}_{10}}} + \left| {V}_{TP}\right|  = \sqrt{\frac{2 \cdot  {15}}{{50} \cdot  1}} + {0.7} = {1.474}\mathrm{\;V}
$$
Next, determine ${R}_{z}$ .
$$
{R}_{z} = \frac{1}{{K}_{P}^{\prime }{S}_{8}\left( {{V}_{SG10} - \left| {V}_{TP}\right| }\right) } = \frac{{10}^{6}}{{50} \cdot  {5.63}\left( {{1.474} - {0.7}}\right) } = {4.590}\mathrm{k}\Omega
$$
Using Eq. (6.3-26), the location of ${z}_{1}$ is calculated to be
$$
\frac{-1}{\left( {{4.590} \times  {10}^{3}}\right) \left( {3 \times  {10}^{-{12}}}\right)  - \frac{3 \times  {10}^{-{12}}}{{942.5} \times  {10}^{-6}}} =  - {94.46} \times  {10}^{6}\mathrm{{rad}}/\mathrm{s}
$$
The output pole, ${p}_{2}$ , is found from Eq. (6.3-24) and is
$$
{p}_{2} = \frac{{942.5} \times  {10}^{-6}}{{10} \times  {10}^{-{12}}} =  - {94.25} \times  {10}^{6}\mathrm{{rad}}/\mathrm{s}
$$
Thus, we see that, for all practical purposes, the output pole is canceled by the zero that has been moved from the RHP to the LHP.
The results of this design are summarized below.
$$
{W}_{8} = {6\mu }\mathrm{m}
$$
$$
{W}_{9} = {2\mu }\mathrm{m}
$$
$$
{W}_{10} = {1\mu }\mathrm{m}
$$
$$
{W}_{11} = {15\mu }\mathrm{m}
$$
Because we are trying to cancel a pole with a zero, let us examine the dependence of the nulling resistor technique on temperature and the process variations. The key relationship is given in Eq. (6.3-26), where ${R}_{z}$ is canceling $1/{g}_{m6}$ . If we think of the technique as ${g}_{m6}$ canceling $1/{R}_{z}$ , the answer is clear. One of the forms for the small-signal transconductance is
$$
{g}_{m6} = {K}_{P}^{\prime }\left( {{W}_{6}/{L}_{6}}\right) \left( {{V}_{SG6} - \left| {V}_{TP}\right| }\right)  \tag{6.3-34}
$$
From Eq. (6.3-28), we see that $1/{R}_{z}$ has exactly the same form. As long as we keep M6, M8, and M10 the same type of transistor, the temperature and process tracking should be good. One could replace the resistor by an MOS diode and also achieve good temperature and process tracking (see Problem 6.3-13).
## Simulation of the Electrical Design
After the design has been developed using the above procedures, the next step is to simulate the circuit using more accurate models of the transistor. In most cases, the BSIM2 [7] or BSIM3 [8] model is sufficient. The designer should be sure the computer simulation makes sense with the hand design. The computer simulation will take into account many of the details that have been neglected such as the bulk effect. While the designer can make minor modifications in the design, one should resist the temptation to use the computer to make major design changes, such as an architecture change. The function of simulation is to verify and to explore the influence of things like matching, process variations, temperature changes, and power-supply changes. If one does not have information on how the process parameters vary, a good substitute is to examine the circuit at high and low temperatures. These simulations will give some idea of the circuit's dependence on process parameter changes. Also, simulators can be used with Monte Carlo methods to investigate the influence of statistical variations in the values of components.
Although the circuit has not yet been designed physically, it is a good practice to include some of the parasitics that will be due to the physical layout. This will minimize the differences between the simulation performance before layout and after layout. At this point, the designer only knows the $W/L$ values and the dc currents. The area and shape of the source and drain are not yet determined. Unfortunately, the parasitic capacitances due to the reverse-biased bulk-source and bulk-drain cannot be modeled until the area and periphery of the source and drain are known.
A technique that will allow the designer to include the bulk-source and drain-source capacitance parasitics is outlined below. In Fig. 6.3-5, a simple rectangular MOSFET layout is shown. The minimum possible source or drain area would be that indicated by the sum of the lengths L1, L2, and L3 times W. The lengths L1, L2, and L3 are related to the design rules for a given process and are as follows:
$\mathrm{L}1 =$ Minimum allowable distance between the contact in $\mathrm{S}/\mathrm{D}$ and the poly
$\mathrm{L}2 =$ Width of a minimum size contact to diffusion
$\mathrm{L}3 =$ Minimum allowable distance from the contact in $\mathrm{S}/\mathrm{D}$ to the edge of the $\mathrm{S}/\mathrm{D}$
These rules are easily found from the technology information. Thus, the minimum area of the drain and source is $\left( {\mathrm{L}1 + \mathrm{L}2 + \mathrm{L}3}\right)  \times  W$ and the corresponding periphery is $2(\mathrm{L}1 + \mathrm{L}2 +$ L3) +2W. A conservative approach might be to double this area to account for connection parasitics between the source (drain) and their respective destinations.

Figure 6.3-5 Method of estimating the source and drain areas and peripheries.
---
Example 6.3-3
---
## Estimation of Bulk-Source and Bulk-Drain Capacitive Parasitics
Use the above method to estimate the area and periphery of a transistor that has a width of ${10\mu }\mathrm{m}$ and a length of ${1\mu }\mathrm{m}$ if $\mathrm{L}1 = \mathrm{L}2 = \mathrm{L}3 = {2\mu }\mathrm{m}$ .
## SOLUTION
The area of the source and drain is ${6\mu }\mathrm{m}$ times the width of ${10\mu }\mathrm{m}$ , resulting in an area of ${60\mu }{\mathrm{m}}^{2}$ . The periphery is $2 \times  {10\mu }\mathrm{m}$ plus $2 \times  {6\mu }\mathrm{m}$ or ${32\mu }\mathrm{m}$ . If this information is entered into the simulator (see Section 3.6), it will calculate the value of depletion capacitance corresponding to the value of reverse-bias voltage.
## Physical Design of Analog Circuits
The next phase in the design process after satisfactory simulation results have been achieved is the physical design. One of the unmistakable trends in CMOS analog IC design is that the physical aspects of the design have a strong influence on the electrical performance. It is not possible to assume that the design is complete without carefully considering the physical implementation. A good electrical design can be ruined by a poor physical design or layout.
The goals of physical design go beyond simply minimizing the area required. The primary goal is to enhance the electrical performance. Because IC design depends on matching, physical design that enables better matching is extremely important. Good matching depends on how similar are the two items to be matched. The unit-matching principle is very useful in achieving good matching. The replication principle starts with a unit value of a device to be matched (transistor, resistor, capacitor, etc.). Next, the unit value is stepped-and-repeated using the same orientation. The unit value must be designed so that the influence of its connections is identical for both devices. Figure 6.3-6 shows two layouts for a 5-to-1 current mirror. In Fig. 6.3-6(a), a single transistor shown between the two vertical dashed lines has been repeated five times but the diffusion area has been combined to save area. In Fig. 6.3-6(b), the transistor on the left between the vertical dashed lines has been repeated five times to form the transistor on the right. While the layout in Fig. 6.3-6(a) is minimum area, the layout in Fig. 6.3-6(b) has better matching because the drain/source areas are identical. In Fig. 6.3-6(a), the drains and sources of the inner transistors are shared. This causes the depletion capacitance of the bulk-drain and bulk-source junctions to be different from the unit transistor on the left. Not only are the capacitances different, but also the bulk resistances that account for the resistivity in the drains and sources are different.

Figure 6.3-6 The layout of a 5-to-1 current mirror. (a) Layout that minimizes area at the sacrifice of matching. (b) Layout that optimizes matching.
If noninteger ratios are required, more than one unit can be used for the smaller. For example, 2 units compared with 3 give a 1.5 ratio. In this case, one can use a common-centroid geometry approach to get less dependence on the location at which the transistor is built. Figure 6.3-7 shows a good method of getting a 1.5 ratio using five individual transistors. The transistors labeled " 2 " and " 1 " are interleaved. If all three terminals of each transistor are to be available, then it is necessary to use a second layer of metal to provide external connections.
One can also use the geometry to improve the electrical performance of the circuit. A good example of this is shown in Fig. 6.3-8. In this figure, a transistor has been laid out as a square "donut." The objective is to reduce the value of ${C}_{gd}$ at the sacrifice of the value of ${C}_{gs}$ . Since the capacitor ${C}_{gd}$ is often multiplied by the Miller effect, it is important to be able to keep it small. The donut transistor structure also has the advantage of being very area efficient. The approximate $W$ is the length of the dotted centerline of the polysilicon modified by the influence of the corners.
In addition to matching between components, the designer must avoid unnecessary voltage drops. Unsilicided polysilicon should never be used for connections because of its high resistivity compared with metal. Even when the polysilicon is used to connect to gates and no dc current flows, one still needs to be careful of transient currents that must flow to charge and discharge parasitic capacitances. Even the low resistivity $\left( {{50}\mathrm{m}\Omega /\square }\right)$ of metal can cause problems when the current flow is large. Consider an aluminum conductor 1000 $\mu \mathrm{m}$ long and ${2\mu }\mathrm{m}$ wide. This conductor has ${500}\square$ between ends and thus has a resistance of ${500}\square$ times ${0.05\Omega }/\square$ or ${25\Omega }$ . If $1\mathrm{\;{mA}}$ is flowing through this conductor, a voltage drop of ${25}\mathrm{{mV}}$ is experienced. A ${25}\mathrm{{mV}}$ drop between ends is sufficient to cause serious problems in a sensitive circuit. For example, suppose an analog signal is being converted to an 8 bit digital signal and the reference voltage is $1\mathrm{\;V}$ (see Chapter 9). This means the least-significant bit (LSB) has a value of $1\mathrm{\;V}/{256}$ or $4\mathrm{\;{mV}}$ . Therefore, the ${25}\mathrm{\;{mV}}$ voltage drop on the conductor could have a deteriorating influence on the analog-digital converter. The ohmic drops in power-supply buses can be avoided by converting the bias voltage to current and routing the current across the chip. The bias voltage is recreated at the physical location where it is to be applied, avoiding the voltage drops in the buses. Figure 6.3-9 shows an implementation of this concept. The bandgap voltage, ${V}_{BG}$ , is generated and distributed via M13-M14 to the slave bias circuits consisting of all transistors with an "A." The slave bias circuit generates the necessary bias voltages at a portion of the chip remote from the reference voltage.

Figure 6.3-7 The layout of two transistors with a 1.5-to-1 matching using centroid geometry to improve matching.

Figure 6.3-8 Reduction of ${C}_{gs}$ by a donut-shaped transistor.
In addition to the voltage drop caused by conductors, there is also a thermal noise generated by resistances. This is particularly important where polysilicon is used to connect the MOSFET gates to the signal source. Even though no dc current flows, a significant resistance results and will cause the noise to be increased. Most modern processes allow the siliciding of polysilicon to reduce its resistivity to much lower levels than normal polysilicon.
The influence of the physical layout on the electrical performance is becoming greater as more and more circuits are placed on a single integrated-circuit chip. The presence of noise in the substrate and on the connections at the surface can no longer be neglected $\left\lbrack  {9,{10}}\right\rbrack$ . This is a problem that must be approached from both the electrical and physical design viewpoints. Electrically, the designer can use differential circuits and design circuits with large values of power-supply rejection and common-mode rejection. From the physical viewpoint, the designer must try to keep the power supplies and grounds as free from noise as possible. This can be achieved by separating digital and analog power supplies and by routing all power supplies to a circuit back to a common point. One should never power digital and analog circuits from the same power-supply buses.

Figure 6.3-9 Generation of a reference voltage that is distributed on the chip as a current to slave bias circuits.
Physical separation of noisy circuits from sensitive circuits does not offer any significant improvement in processes that have a lightly doped epitaxial layer on top of a heavily doped substrate. What appears to be the best approach is to use multiple (parallel) bond wires off the chip to reduce the lead inductance from off-chip power supplies to on-chip grounds such as the substrate or well. When guard rings are used, they are most effective if they have their own off-chip bond wire and do not share the off-chip bond wires of another area with the same dc potential. As frequencies increase and more circuitry is put on a single chip, the interference problem will get worse. This factor certainly seems to be the biggest impediment to a single-chip solution of many mixed-signal applications.
Once the op amp (or other circuitry) is physically designed, it is then necessary to do two important steps. The first is to make sure that the physical design represents the electrical design. This is done by using a CAD tool called the layout versus schematic (LVS) checker. This tool checks to make sure the electrical schematic and the physical layout are in agreement. This step avoids making misconnections or leaving something out of the physical design. The second important step is to extract the parasitics of the circuit now that the physical implementation is known. Once the parasitics (typically capacitive and resistive) have been extracted, the simulation is performed again. If the simulation performance meets the specifications, then the circuit is ready for fabrication. This concludes the first two steps of an analog design, namely, the electrical and physical design. A third important step will be discussed later in this chapter and that is testing and debugging. A successful product must successfully pass all three steps.
Several aspects of the performance of the two-stage op amp will be considered in later sections. These performance considerations include PSRR (Section 6.4) and noise (Section 7.5). This section has introduced a procedure for the electrical design of a two-stage, unbuffered CMOS op amp. In addition, some important considerations of the physical design of analog integrated circuits have been presented. More information on the influence of the layout on analog design can be found in a book on the subject [11].

### 6.4 Power-Supply Rejection Ratio of Two-Stage Op Amps
The two-stage, unbuffered op amp of the last section has been used in many commercial products, particularly in the telecommunications area. After the initial successes, it was noted that this op amp suffers from a poor power-supply rejection ratio (PSRR). The ripple on the power supplies contributed too much noise at the output of the op amp. In order to illustrate this problem consider the op amp of Fig. 6.2-8. The definition of PSRR given in Eq. (6.1-8) is stated as the ratio of the differential gain ${A}_{v}$ to the gain from the power-supply ripple to the output with the differential input set to zero $\left( {A}_{dd}\right)$ . Thus, PSRR can be written as
$$
\operatorname{PSRR} = \frac{{A}_{v}\left( {{V}_{dd} = 0}\right) }{{A}_{dd}\left( {{V}_{\text{in }} = 0}\right) } \tag{6.4-1}
$$
While one can calculate ${A}_{v}$ and ${A}_{dd}$ and combine the results, it is easier to use the unity-gain configuration of Fig. 6.4-1(a). Using the model of the op amp shown in Fig. 6.4-1(b) to represent the two gains of Eq. (6.4-1), we can show that
$$
{V}_{\text{out }} = \frac{{A}_{dd}}{1 + {A}_{v}}{V}_{dd} \cong  \frac{{A}_{dd}}{{A}_{v}}{V}_{dd} = \frac{1}{{\mathrm{{PSRR}}}^{ + }}{V}_{dd} \tag{6.4-2}
$$
where ${V}_{dd}$ is the power-supply ripple of ${V}_{DD}$ and ${\mathrm{{PSRR}}}^{ + }$ is the PSRR for ${V}_{DD}$ . Therefore, if we connect the op amp in the unity-gain mode and input an ac signal of ${V}_{dd}$ in series with the ${V}_{DD}$ power supply, ${V}_{o}/{V}_{dd}$ will be equal to the inverse of ${\mathrm{{PSRR}}}^{ + }$ . This approach will be taken to calculate the PSRR of the two-stage op amp.
## Positive PSRR
The two-stage op amp of Fig. 6.2-8 is shown in Fig. 6.4-2(a) connected in the unity-gain mode with an ac ripple of ${V}_{dd}$ on the positive power supply. The two possible connections for the negative terminal of ${V}_{\text{BIAS }}$ will become important later in the calculation for the negative power-supply rejection ratio. As before, ${C}_{I}$ and ${C}_{II}$ are the parasitic capacitances to ground at the output of the first and second stages, respectively. The unsimplified, small-signal model corresponding to the PSRR ${}^{ + }$ calculation is shown in Fig. 6.4-2(b). This model has been simplified as shown in Fig. 6.4-2(c), where ${V}_{5}$ is assumed to be zero and the current ${I}_{3}$ flowing through $1/{g}_{m3}$ is replaced by
$$
{I}_{3} = {g}_{m1}{V}_{\text{out }} + {g}_{ds1}\left( {{V}_{dd} - \frac{{I}_{3}}{{g}_{m3}}}\right)  \cong  {g}_{m1}{V}_{\text{out }} + {g}_{ds1}{V}_{dd} \tag{6.4-3}
$$
Equation (6.4-3) assumes that ${g}_{m3}{r}_{ds1} > 1$ . The dotted line represents the portion of Fig. 6.4-2(b) in parallel with ${V}_{dd}$ and thus is not important to the model.
The nodal equations for the voltages ${V}_{1}$ and ${V}_{\text{out }}$ of Fig. 6.4-2(c) can be written as follows. For the node at ${V}_{1}$ we have
$$
\left( {{g}_{ds1} + {g}_{ds4}}\right) {V}_{dd} = \left( {{g}_{ds2} + {g}_{ds4} + s{C}_{c} + s{C}_{I}}\right) {V}_{1} - \left( {{g}_{m1} + s{C}_{c}}\right) {V}_{\text{out }} \tag{6.4-4}
$$
and for the output node we have
$$
\left( {{g}_{m6} + {g}_{ds6}}\right) {V}_{dd} = \left( {{g}_{m6} - s{C}_{c}}\right) {V}_{1} + \left( {{g}_{ds6} + {g}_{ds7} + s{C}_{c} + s{C}_{H}}\right) {V}_{\text{out }} \tag{6.4-5}
$$

Figure 6.4-1 (a) Method for calculating PSRR. (b) Model (a).

Figure 6.4-2 (a) Method for calculating the ${\mathrm{{PSRR}}}^{ + }$ of the two-stage op amp. (b) Model of (a). (c) Simplified equivalent of (b) assuming that ${V}_{5} \approx  0$ .
Using the generic notation for the two-stage op amp allows Eqs. (6.4-4) and (6.4-5) to be rewritten as
$$
{G}_{I}{V}_{dd} = \left( {{G}_{I} + s{C}_{c} + s{C}_{I}}\right) {V}_{1} - \left( {{g}_{mI} + s{C}_{c}}\right) {V}_{\text{out }} \tag{6.4-6}
$$
and
$$
\left( {{g}_{mII} + {g}_{ds6}}\right) {V}_{dd} = \left( {{g}_{mII} - s{C}_{c}}\right) {V}_{1} + \left( {{G}_{II} + s{C}_{c} + s{C}_{II}}\right) {V}_{\text{out }} \tag{6.4-7}
$$
where
$$
{G}_{I} = {g}_{ds1} + {g}_{ds4} = {g}_{ds2} + {g}_{ds4} \tag{6.4-8}
$$
$$
{G}_{H} = {g}_{ds6} + {g}_{ds7} \tag{6.4-9}
$$
$$
{g}_{mI} = {g}_{m1} = {g}_{m2} \tag{6.4-10}
$$
and
$$
{g}_{mII} = {g}_{m6} \tag{6.4-11}
$$
Solving for the transfer function, ${V}_{\text{out }}/{V}_{dd}$ , and inverting the transfer function gives the following result:
$$
{s}^{2}\left\lbrack  {{C}_{c}{C}_{I} + {C}_{I}{C}_{II} + {C}_{II}{C}_{c}}\right\rbrack   + s\left\lbrack  {{G}_{I}\left( {{C}_{c} + {C}_{II}}\right)  + {G}_{II}\left( {{C}_{c} + {C}_{I}}\right) }\right.
$$
$$
\frac{{V}_{dd}}{{V}_{\text{out }}} = \frac{+{C}_{c}\left( {{g}_{mII} - {g}_{mI}}\right)  + {G}_{I}{G}_{II} + {g}_{mI}{g}_{mII}}{s\left\lbrack  {{C}_{c}\left( {{g}_{mII} + {G}_{I} + {g}_{ds6}}\right)  + {C}_{I}\left( {{g}_{mII} + {g}_{ds6}}\right) }\right\rbrack   + {G}_{I}{g}_{ds6}} \tag{6.4-12}
$$
Using the technique described in Section 6.3, we may solve for the approximate roots of Eq. (6.4-12) as
$$
{\mathrm{{PSRR}}}^{ + } = \frac{{V}_{dd}}{{V}_{\text{out }}} \cong  \left( \frac{{g}_{ml}{g}_{mII}}{{G}_{I}{g}_{ds6}}\right) \left\lbrack  \frac{\left( {\frac{s{C}_{c}}{{g}_{mI}} + 1}\right) \left( {\frac{s\left( {{C}_{c}{C}_{I} + {C}_{I}{C}_{II} + {C}_{c}{C}_{II}}\right) }{{g}_{mII}{C}_{c}} + 1}\right) }{\left( \frac{s{g}_{mII}{C}_{c}}{{G}_{I}{g}_{ds6}} + 1\right) }\right\rbrack   \tag{6.4-13}
$$
where we have assumed that ${g}_{mII}$ is greater than ${g}_{mI}$ and that all transconductances are larger than the channel conductances. For all practical purposes, Eq. (6.4-13) reduces to
$$
{\mathrm{{PSRR}}}^{ + } = \frac{{V}_{dd}}{{V}_{\text{out }}} = \left( \frac{{g}_{mI}{g}_{mII}}{{G}_{I}{g}_{ds6}}\right) \left\lbrack  \frac{\left( {\frac{s{C}_{c}}{{g}_{mI}} + 1}\right) \left( {\frac{s{C}_{II}}{{g}_{mII}} + 1}\right) }{\frac{s{g}_{mII}{C}_{c}}{{G}_{I}{g}_{ds6}} + 1}\right\rbrack   \tag{6.4-14}
$$
$$
= \left( \frac{{G}_{II}{A}_{v}\left( 0\right) }{{g}_{ds6}}\right) \frac{\left( {\frac{s}{GB} + 1}\right) \left( {\frac{s}{\left| {p}_{2}\right| } + 1}\right) }{\left( \frac{s{G}_{II}{A}_{v}\left( 0\right) }{{g}_{ds6}{GB}} + 1\right) }
$$
Figure 6.4-3 illustrates the results of this analysis. It is seen that at a frequency of ${GB}/{A}_{v}\left( 0\right)$ the PSRR ${}^{ + }$ begins to roll off with a $- {20}\mathrm{\;{dB}}/$ decade slope. Consequently, the PSRR ${}^{ + }$ becomes degraded at high frequencies, which is a disadvantage of the two-stage, unbuffered op amp.

Figure 6.4-3 Magnitude of the PSRR ${}^{ + }$ for a two-stage op amp.
The above calculation probably represents the most difficult encountered yet in this text. Unfortunately, while the results are clear, what causes the poor ${\mathrm{{PSRR}}}^{ + }$ is not. Because $\mathrm{M}6$ is biased by the M7 current source, the gate-source voltage of M6 must remain constant. This requirement forces the gate of $\mathrm{M}6$ to track the changes in ${V}_{DD}$ , which are in turn transmitted by ${C}_{c}$ to the output of the amplifier. This path from the power-supply ripple, ${V}_{dd}$ , to the output is shown by the shaded arrow on Fig. 6.4-2(a). As the frequency increases, the impedance of the compensation capacitor, ${C}_{c}$ , becomes low and the gate and drain of M6 begin to track one another and the gain from ${V}_{dd}$ to ${V}_{\text{out }}$ becomes approximately unity. Thus, the PSRR ${}^{ + }$ has the approximate frequency response of ${A}_{v}\left( s\right)$ until the zeros at $- {GB}$ and $- {p}_{2}$ influence the frequency response. For the value of Example 6.3-1, the dc value of ${\mathrm{{PSRR}}}^{ + }$ is ${68.8}\mathrm{\;{dB}}$ and the roots are ${z}_{1} =  - 5\mathrm{{MHz}},{z}_{2} =  - {15}\mathrm{{MHz}}$ , and ${p}_{1} =  - {906.6}\mathrm{\;{Hz}}$ . Figures ${6.6} - {18}$ (a) and 6.6-18(b) are the simulated response of the PSRR ${}^{ + }$ of Example 6.3-1 and compare very closely with these results.
## Negative PSRR
Figure 6.4-4(a) shows the two-stage op amp in the configuration for calculating the negative PSRR (PSRR ${}^{ - }$ ). The analysis of the PSRR ${}^{ - }$ depends on where the voltage ${V}_{\text{BIAS }}$ is connected. Normally, ${V}_{\text{BIAS }}$ would be a voltage generated by a current derived from ${V}_{DD}$ flowing into an MOS diode. If this is the case, then the gate-source voltage of M5 and M7 would remain constant if the current is independent of ${V}_{ss}$ . For this reason it is a good practice to use the current sources of Section 4.5 that are independent of power supply (or Fig. 6.3-9) to provide bias currents that are not influenced by power-supply changes. If for some reason ${V}_{\text{BIAS }}$ was connected to ground, then as the power-supply changes, ${V}_{ss}$ would cause a change in the gate-source voltage of M5 and M7 and this change would result in a change of currents in the drains. While the common-mode rejection of the first stage would diminish the ac current in the drain of M5, the ac current in M7 would be multiplied by ${R}_{H}$ and appear at the output as a change due to ${V}_{ss}$ . The small-signal model for this case is shown in Fig. 6.4-4(b). The nodal equations corresponding to Fig. 6.4-4(b) are
$$
0 = \left( {{G}_{I} + s{C}_{c} + s{C}_{I}}\right) {V}_{1} - \left( {{g}_{mI} + s{C}_{c}}\right) {V}_{o} \tag{6.4-15}
$$

Figure 6.4-4 (a) Circuit for calculating the PSRR ${}^{ - }$ of the two-stage op amp. (b) Model of (a) when ${V}_{\text{BIAS }}$ is grounded. (c) Model of (a) when ${V}_{\text{BIAS }}$ is independent of ${V}_{SS}$ .
and
$$
{g}_{m7}{V}_{ss} = \left( {{g}_{mII} - s{C}_{c}}\right) {V}_{1} + \left( {{G}_{II} + s{C}_{c} + s{C}_{II}}\right) {V}_{o} \tag{6.4-16}
$$
Solving for ${V}_{\text{out }}/{V}_{ss}$ and inverting gives
$$
{s}^{2}\left\lbrack  {{C}_{c}{C}_{I} + {C}_{I}{C}_{II} + {C}_{II}{C}_{c}}\right\rbrack   + s\left\lbrack  {{G}_{I}\left( {{C}_{c} + {C}_{II}}\right)  + {G}_{II}\left( {{C}_{c} + {C}_{I}}\right) }\right.
$$
$$
\frac{{V}_{ss}}{{V}_{\text{out }}} = \frac{+{C}_{c}\left( {{g}_{mII} - {g}_{mI}}\right)  + {G}_{I}{G}_{II} + {g}_{mI}{g}_{mII}}{\left\lbrack  {s\left( {{C}_{c} + {C}_{I}}\right)  + {G}_{I}}\right\rbrack  {g}_{m7}} \tag{6.4-17}
$$
Again, using the technique described in Section 6.3, we may solve for the approximate roots of Eq. (6.4-17) as
$$
{\mathrm{{PSRR}}}^{ - } = \frac{{V}_{ss}}{{V}_{\text{out }}} \cong  \left( \frac{{g}_{ml}{g}_{mII}}{{G}_{I}{g}_{m7}}\right) \left\lbrack  \frac{\left( {\frac{s{C}_{c}}{{g}_{mI}} + 1}\right) \left( {\frac{s\left( {{C}_{c}{C}_{I} + {C}_{I}{C}_{II} + {C}_{c}{C}_{II}}\right) }{{g}_{mII}{C}_{c}} + 1}\right) }{\left( \frac{s\left( {{C}_{c} + {C}_{I}}\right) }{{G}_{I}} + 1\right) }\right\rbrack   \tag{6.4-18}
$$
Equation (6.4-18) can be rewritten as approximately
$$
{\mathrm{{PSRR}}}^{ - } = \frac{{V}_{ss}}{{V}_{\text{out }}} \cong  \left( \frac{{g}_{ml}{g}_{mlI}}{{G}_{l}{g}_{m7}}\right) \left\lbrack  \frac{\left( {\frac{s{C}_{c}}{{g}_{mI}} + 1}\right) \left( {\frac{s{C}_{II}}{{g}_{mII}} + 1}\right) }{\left( \frac{s{C}_{c}}{{G}_{l}} + 1\right) }\right\rbrack   = \left( \frac{{G}_{II}{A}_{v}\left( 0\right) }{{g}_{m7}}\right) \left\lbrack  \frac{\left( {\frac{s}{GB} + 1}\right) \left( {\frac{s}{\left| {p}_{2}\right| } + 1}\right) }{\left( \frac{s}{GB}\frac{{g}_{mI}}{{G}_{l}} + 1\right) }\right\rbrack   \tag{6.4-19}
$$
Comparing this result with the PSRR ${}^{ + }$ shows that the zeros are identical but the dc gain is smaller by nearly the amount of the second-stage gain and the pole is lower by the amount of the first-stage gain. Assuming the values of Example 6.3-1 gives a gain of ${23.7}\mathrm{\;{dB}}$ and a pole at $- {147}\mathrm{{kHz}}$ . The dc value of ${\mathrm{{PSRR}}}^{ - }$ is very poor for this case; however, this case can be avoided by correctly implementing ${V}_{\text{Bias }}$ , which we consider next.
If the value of ${V}_{\text{Bias }}$ is independent of ${V}_{ss}$ , then the model of Fig. 6.4-4(c) results. The nodal equations for this model are
$$
0 = \left( {{G}_{I} + s{C}_{c} + s{C}_{I}}\right) {V}_{1} - \left( {{g}_{mI} + s{C}_{c}}\right) {V}_{\text{out }} \tag{6.4-20}
$$
and
$$
\left( {{g}_{ds7} + s{C}_{gd7}}\right) {V}_{ss} = \left( {{g}_{mII} - s{C}_{c}}\right) {V}_{1} + \left( {{G}_{II} + s{C}_{c} + s{C}_{II} + s{C}_{gd7}}\right) {V}_{\text{out }} \tag{6.4-21}
$$
Again, solving for ${V}_{\text{out }}/{V}_{ss}$ and inverting gives
$$
{s}^{2}\left\lbrack  {{C}_{c}{C}_{I} + {C}_{I}{C}_{II} + {C}_{II}{C}_{c} + {C}_{I}{C}_{gd7} + {C}_{c}{C}_{gd7}}\right\rbrack   + s\left\lbrack  {{G}_{I}\left( {{C}_{c} + {C}_{II} + {C}_{gd7}}\right) }\right.
$$
$$
\frac{{V}_{ss}}{{V}_{\text{out }}} = \frac{+{G}_{II}\left( {{C}_{c} + {C}_{I}}\right)  + {C}_{c}\left( {{g}_{mII} - {g}_{mI}}\right)  + {G}_{I}{G}_{II} + {g}_{mI}{g}_{mII}}{\left( {s{C}_{gd7} + {g}_{ds7}}\right) \left( {s\left( {{C}_{I} + {C}_{c}}\right)  + {G}_{I}}\right) } \tag{6.4-22}
$$
Solving for the approximate roots of both the numerator and denominator gives
$$
{\mathrm{{PSRR}}}^{ - } = \frac{{V}_{ss}}{{V}_{\text{out }}} \cong  \left( \frac{{g}_{ml}{g}_{mII}}{{G}_{I}{g}_{d57}}\right) \left\lbrack  \frac{\left( {\frac{s{C}_{c}}{{g}_{mI}} + 1}\right) \left( {\frac{s\left( {{C}_{c}{C}_{I} + {C}_{I}{C}_{II} + {C}_{c}{C}_{II}}\right) }{{g}_{mII}{C}_{c}} + 1}\right) }{\left( {\frac{s{C}_{gd7}}{{g}_{ds7}} + 1}\right) \left( {\frac{s\left( {{C}_{I} + {C}_{c}}\right) }{{G}_{I}} + 1}\right) }\right\rbrack   \tag{6.4-23}
$$
Equation (6.4-23) can be rewritten as
$$
{\mathrm{{PSRR}}}^{ - } = \frac{{V}_{ss}}{{V}_{\text{out }}} \approx  \left( \frac{{G}_{II}{A}_{v}\left( 0\right) }{{g}_{ds7}}\right) \left\lbrack  \frac{\left( {\frac{s}{GB} + 1}\right) \left( {\frac{s}{\left| {p}_{2}\right| } + 1}\right) }{\left( {\frac{s{C}_{gd7}}{{g}_{ds7}} + 1}\right) \left( {\frac{s{C}_{c}}{{G}_{I}} + 1}\right) }\right\rbrack   \tag{6.4-24}
$$
This time the dc gain has been increased by the ratio of ${G}_{H}$ to ${g}_{ds7}$ and instead of one pole there are two. However, the pole at $- {g}_{ds7}/{C}_{gd7}$ is very large and can be ignored. The general frequency response of the negative PSRR is shown in Fig. 6.4-5. Again, assuming the values of Example 6.3-1, we find the dc gain as ${76.7}\mathrm{\;{dB}}$ . To find the poles we must assume a value of ${C}_{gd7}$ . Let us assume a value of ${10}\mathrm{{fF}}$ for ${C}_{gd7}$ . This gives the pole locations as $- {71.2}\mathrm{{kHz}}$ and $- {149}\mathrm{{kHz}}$ . The higher poles allow the PSRR to be much larger as the frequency increases compared to the positive PSRR. The result is that ${\mathrm{{PSRR}}}^{ - }$ for the n-channel input, two-stage op amp is always greater than ${\mathrm{{PSRR}}}^{ + }$ . Of course, this is reversed if a p-channel input op amp is used. Alternate methods of calculating the PSRR can be found in the literature [5,12].
The power-supply rejection ratio of the two-stage op amp has been shown to be poor because of the path from the power-supply ripple through the compensating capacitor to the output. We shall next examine the use of cascoding to improve the performance of the two-stage op amp. Cascoding will also allow a much better power-supply rejection ratio to be achieved.

Figure 6.4-5 Magnitude of the PSRR for a two-stage op amp.

### 6.5 Cascode Op Amps
Previously, we introduced the design of a two-stage CMOS op amp. This op amp is probably one of the most widely used CMOS amplifiers to date. Its performance is well understood and experimental results compare closely to the design results. However, there are a number of unbuffered applications in which the performance of the two-stage op amp is not sufficient. Performance limitations of the two-stage op amp include insufficient gain, limited stable bandwidth caused by the inability to control the higher-order poles of the op amp, and a poor power-supply rejection ratio.
In this section we introduce several versions of the cascode CMOS op amp that offer improved performance in the above three areas. Three cascode op amp topologies will be discussed. The primary difference between these three topologies is where the cascode stage is applied in the block diagram of a general op amp shown in Fig. 6.1-1. First we will apply cas-coding to the first stage followed by applying it to the second stage. Finally, we will examine a very useful version of the cascode op amp called the folded-cascode op amp. Throughout our presentation, we will illustrate how the gain of the cascode op amp can be enhanced using feedback.
## Use of Cascoding in the First Stage
The motivation for using the cascode configuration to increase the gain can be seen by examining how the gain of the two-stage op amp could be increased. There are three ways in which the gain could be increased: (1) add additional gain stages, (2) increase the transconductance of the first or second stage, and (3) increase the output resistance seen by the first or second stage. Due to possible instability, the first approach is not attractive. Of the latter two approaches, the third is the more attractive because the output resistance increases in proportion to a decrease in bias current whereas the transconductance increases as the square root of the increase in bias current. Thus, it is generally more power efficient to increase ${r}_{\text{out }}$ rather than ${g}_{m}$ . Also, ${r}_{\text{out }}$ can be dramatically increased by using special circuit techniques such as the cascode structure introduced in Sections 4.3 and 5.3 and the regulated cascode structure of Section 4.4.
Let us start by considering cascoding only the first stage of the two-stage op amp. Figure 6.5-1(a) shows the replacement of the transistors M1-M4 of Fig. 5.2-6 with the cascode configuration. Note that the bias for the cascode transistors, MC1 and MC2, is referenced to the common source node. If this were not the case, then the input common mode range would be severely limited. Using intuitive analysis to find the gain of this circuit, we see that ${v}_{in}$ causes a current in M1 flowing downward of ${0.5}{g}_{m1}{v}_{in}$ and a current in M2 flowing upward of ${0.5}{g}_{m2}{v}_{in}$ . These two currents flow toward the output of the amplifier creating the output voltage of ${g}_{m1}{R}_{\text{out }}{v}_{\text{in }}$ (where ${g}_{m1} = {g}_{m2}$ ). Thus, we can write the gain as
$$
{A}_{v} = \frac{{v}_{\text{out }}}{{v}_{\text{in }}} = {g}_{m1}{R}_{\text{out }} \approx  {g}_{m1}\left( {{g}_{mC2}{r}_{dsC2}{r}_{ds2}}\right) \parallel \left( {{g}_{mC4}{r}_{dsC4}{r}_{ds4}}\right)  \tag{6.5-1}
$$
If ${g}_{mN} = {g}_{mP}$ and ${r}_{dsN} = 2{r}_{dsP}$ , then an estimate for the open-loop voltage gain, ${A}_{v}$ , is
$$
{A}_{v} \approx  {0.2}{g}_{mN}^{2}{r}_{dsN}^{2} \tag{6.5-2}
$$
which is approximately equal to that of a two-stage op amp. The dominant pole of Fig. 6.5-1(a) is given by the output resistance and the capacitance. If ${C}_{L}$ is the capacitance connected to the output, the magnitude of the dominant pole is
$$
\left| {p}_{1}\right|  \approx  \frac{1}{{R}_{\text{out }}{C}_{L}} \tag{6.5-3}
$$
If all higher-order poles are greater than the gain bandwidth, ${GB}$ , then the gain bandwidth can be written as
$$
{GB} = {A}_{v}\left| {p}_{1}\right|  = \frac{{g}_{m1}}{{C}_{L}} \tag{6.5-4}
$$
It is seen that Fig. 6.5-1(a) is self-compensated and should have good stability characteristics as long as the output is connected to a capacitor. With very little capacitance at the output, the nondominant poles may cause the phase margin of ${90}^{ \circ  }$ to decrease. Also, because the amplifier is self-compensated, there is no Miller capacitor to deteriorate the PSRR. Consequently, Fig. 6.5-1 should have much better PSRR than the two-stage op amp using Miller compensation.
The floating battery, ${V}_{\text{Bias }}$ , is used to bias MC1 and MC2 and to set the dc values of the drain-source voltages of M1 and M2. Typically, these voltage are close to ${V}_{ds}$ (sat). In fact, if one wants to linearize the differential output current as a function of the differential input voltage, the transistors M1 and M2 can be operated in the linear or active region where the transconductance characteristics of the MOSFET are linear. The floating battery is implemented by the shaded area in Fig. 6.5-1(b) consisting of transistors MB1 through MB5. The common mode voltage is taken from the drains of MB1 and MB2 and applied to the input of a p-channel current mirror, MB3. MB4 provides the bias current for the MOS diode MB5, which implements the floating battery. The dc currents through MB1 and MB2 are determined by the $W/L$ ratios between M1 and M2 and MB1 and MB2. ${I}_{MB1} + {I}_{MB2}$ will flow through MB5 creating ${V}_{\text{Bias }}$ . The sinking current of M5 should be increased to accommodate ${I}_{MB1}$ and ${I}_{MB2}$ .

Figure 6.5-1 (a) Cascoding of the first stage of the two-stage op amp. (b) Implementation of the floating voltage, ${V}_{\text{Bias }}$ .
## Single-Stage Cascode Op Amp Performance
Assume that all $W/L$ ratios are ${10\mu }\mathrm{m}/{1\mu }\mathrm{m}$ , and that ${I}_{DS1} = {I}_{DS2} = {50\mu }\mathrm{A}$ of Fig. 6.5-1(a). Find the voltage gain of this op amp and the value of ${C}_{I}$ if ${GB} = {10}\mathrm{{MHz}}$ . Use the model parameters of Table 3.1-2.
## SOLUTION
The device transconductances are ${g}_{m1} = {g}_{m2} = {g}_{mI} = {331.7\mu }\mathrm{S},{g}_{mC2} = {331.7\mu }\mathrm{S}$ , and ${g}_{mC4} = {223.6\mu }\mathrm{S}$ . The output resistance of the NMOS and PMOS devices is ${0.5}\mathrm{M}\Omega$ and 0.4 $\mathrm{M}\Omega$ , respectively, giving an output resistance, ${R}_{\text{out }}$ , of ${25}\mathrm{M}\Omega$ . Therefore, the voltage gain is ${8290}\mathrm{\;V}/\mathrm{V}$ . For a unity-gain bandwidth of ${10}\mathrm{{MHz}}$ , the value of ${C}_{\mathrm{I}}$ is ${5.28}\mathrm{{pF}}$ .
If higher gain or lower output resistance is required, then Fig. 6.5-1 needs to be cascaded with a second stage. However, we note that the output dc voltage of Fig. 6.5-1 is farther away from ${V}_{DD}$ than that of the two-stage op amp. Driving a common-source PMOS output transistor from this stage would result in a large ${V}_{DS}$ (sat), which would degrade the output-swing performance. To optimize the output swing of the second stage, it is better to perform a voltage translation before driving the gate of the output PMOS transistor. This is accomplished very easily using Fig. 6.5-2. MT1 and MT2 serve the function of level translation between the first and second stage. MT2 is a current source that biases the source follower, MT1. The current-voltage plot in Fig. 6.5-2 shows that without the level translation, the $W/L$ of M6 would have to be reduced, lowering the output transconductance and increasing the saturation voltage. The small-signal gain from the output of the differential stage to the output of the voltage translator is close to unity with a small amount of phase shift. Compensation of Fig. 6.5-2 can be performed using Miller compensation techniques on the second stage as was illustrated in Section 6.2. One must be careful that the level shifter (MT1 and MT2) does not cause problems by introducing a pole at the gate of M6. Generally, the value of this pole is high enough not to cause problems. The typical voltage gain of this op amp could easily be 100,000 V/V.
An alternate approach to increasing the voltage gain of Fig. 6.5-1 is to use gain enhancement. Figure 6.5-3(a) shows the gain enhancement in Fig. 6.5-1 through the use of inverting amplifiers having a gain of $- A$ . In Fig. 6.5-3(b) the gain amplifiers are simple inverters. Note that it is no longer necessary to implement the ${V}_{\text{Bias }}$ voltage in Fig. 6.5-1. Through negative feedback, the current flowing in M13, M14, and M16 is forced through M11, M12, and M15, respectively. This sets the drain-source voltage of M1 and M2 and the source-drain voltage of M8. These voltages are not optimized for maximum output swing although it is possible to do so using a different version of the inverting amplifiers, illustrated later.

Figure 6.5-2 Two-stage op amp with a cascoded first stage.
---
Example 6.5-1
---

Figure 6.5-3 (a) Application of gain-enhancement amplifiers to increase the gain of Fig. 6.5-1. (b) Implementation of the gain-enhancement amplifiers in Fig. 6.5-3(a).
The gain of Fig. 6.5-3(a) can be written by inspection or intuitive analysis methods. The input voltage ${v}_{in}$ causes a current in M1 flowing downward of ${0.5}{g}_{m1}{v}_{in}$ and a current flowing upward in $\mathrm{M}2$ of ${0.5}{g}_{m2}{v}_{in}$ . In contrast to Fig. 6.5-1, the output resistance is boosted by the magnitude of the gain-enhancement amplifiers. An approximation for the output resistance of Fig. 6.5-3 is
$$
{R}_{\text{out }} \approx  \left( {A{r}_{ds6}{g}_{m6}{r}_{ds8}}\right) \parallel \left( {A{r}_{ds2}{g}_{m4}{r}_{ds4}}\right)  \tag{6.5-5}
$$
If $A \approx  {0.5}{g}_{m}{r}_{ds},{g}_{mN} = {g}_{mP}$ , and ${r}_{dsN} = 2{r}_{dsP}$ , then the output resistance becomes approximately
$$
{R}_{\text{out }} \approx  {0.5}{g}_{m}{r}_{ds}\left( {{0.2}{g}_{m}{r}_{ds}^{2}}\right)  = {0.1}{g}_{m}^{2}{r}_{ds}^{3} \tag{6.5-6}
$$
Therefore, an estimate of the open-loop voltage gain of Fig. 6.5-3 is
$$
{A}_{v} = \frac{{v}_{\text{out }}}{{v}_{\text{in }}} = {g}_{m1}{R}_{\text{out }} \approx  {0.1}{g}_{m}^{3}{r}_{m}^{3} \tag{6.5-7}
$$
If ${g}_{m}{r}_{ds} \approx  {100}$ , then the voltage gain is ${100},{000}\mathrm{\;V}/\mathrm{V}$ . The magnitude of the dominant pole is given by Eq. (6.5-3), but for Fig. 6.5-3 the output resistance is larger, causing the dominant pole to be smaller. Figure 6.5-4 illustrates the relationship between the frequency response of Fig. 6.5-1 and Fig. 6.5-3. As with Fig. 6.5-1, the op amp of Fig. 6.5-3 should have good PSRR characteristics.
## Use of Cascoding in the Second Stage
Figure 6.5-5 shows the two-stage op amp with a cascaded second stage. The gain of the second stage will be increased, which enhances the Miller compensation. The approximate differential voltage gain will be $x{\left( {g}_{m}{r}_{ds}\right) }^{3}$ , where $x$ is a constant between 0 and 1 and depends on the relative values of the p- and n-channel transconductances and conductances. Typically, $x$ is close to 0.5 . The increased gain is due to the increased output resistance of the second stage. The output pole, RHP zero, and ${GB}$ of this op amp are the same as the two-stage op amp if ${C}_{c}$ is the same. Lastly, the PSRR will be poor because of the Miller compensation. The relationship of the frequency response of Fig. 6.5-5 to a two-stage op amp is given by Fig. 6.5-4 where $A$ would be the increased gain due to the cas-coded second stage.
A balanced, two-stage op amp using a cascoded second stage is shown in Fig. 6.5-6. In this op amp, the first stage has been replaced with an MOS diode-loaded differential amplifier. The identical loads in the first stage create a balanced op amp (the resistance seen looking into the sources of M1 and M2 are identical). The currents in M3 and M4 are mirrored into M8 and M6, respectively, and then combined at the output to create the voltage gain. The small-signal differential voltage gain can written by inspection. The input differential voltage, ${v}_{in}$ , causes a current of ${0.5}{g}_{mN}{v}_{in}$ flowing downward in $\mathrm{M}1$ and a current ${0.5}{g}_{m\mathrm{\;N}}{v}_{in}$ flowing upward in M2. Assuming a current mirror gain of $k\left( {k = {g}_{m8}/{g}_{m3} = {g}_{m6}/{g}_{m4}}\right)$ , the output voltage is found by summing the two currents flowing into the output resistance, ${R}_{\text{out }}$ . Therefore, the voltage gain by inspection is
$$
{A}_{v} = \frac{{v}_{\text{out }}}{{v}_{\text{in }}} = {g}_{mN}k{R}_{\text{out }} \tag{6.5-8}
$$

Figure 6.5-4 Comparison of the frequency response of Figs. 6.5-1 and 6.5-3.

Figure 6.5-5 Two-stage op amp with a cascode second stage.
where
$$
{R}_{\text{out }} \approx  \left( {{g}_{mN}{r}_{{ds}{N}^{2}}}\right) \parallel \left( {{g}_{mP}{r}_{{ds}{P}^{2}}}\right)  \tag{6.5-9}
$$
The actual value of the voltage gain depends on the value of $k$ and the relative values of the $p$ and $n$ channel transconductances and conductances.
This op amp is self-compensated as the poles in the first stage are now much larger because of the lower-resistance loads of the first stage. The noise performance of this op amp may not be good unless some gain is realized in the first stage. This implies that ${g}_{mN} > {g}_{mP}$ in the first stage. The ${GB}$ of this op amp is larger than the normal op amp by the factor of the current mirror gain, $k$ .
---
Example 6.5-2
---
## Balanced Two-Stage Op Amp Performance
Assume that all the n-channel transistors of Fig. 6.5-6 have the small-signal parameters of ${g}_{mN}$ and ${r}_{dsN}$ where ${g}_{mN}{r}_{dsN} = {100}\mathrm{\;V}/\mathrm{V}$ . Furthermore, assume that ${g}_{mP} = {0.5}{g}_{mN}$ and ${r}_{dsP} =$ ${0.5}{r}_{dsN}$ . Find the small-signal differential voltage gain of the op amp and the first-stage gain if $k = {10}$ .
## SOLUTION
From Eq. (6.5-9) we see that
$$
{R}_{\text{out }} \approx  \left( {{g}_{mN}{r}_{{ds}{N}^{2}}}\right) \parallel \left( {{0.125}{g}_{mN}{r}_{{ds}{N}^{2}}}\right)  = {0.11}{g}_{mN}{r}_{{ds}{N}^{2}}
$$
From Eq. (6.5-8) we see that the small-signal differential voltage gain is ${1.1}{g}_{{\mathrm{{mN}}}^{2}}{r}_{dsN}{}^{2}$ or 11,000 V/V.
If $k = {10}$ , then the transconductance and conductances of M3 and M4 are ${0.1}{g}_{mP} =$ ${0.05}{g}_{mN}$ . The voltage gain of the first stage is
$$
{A}_{v1} =  - {0.5}\left( {{g}_{mN}/{0.05}{g}_{mN}}\right)  =  - {10}\mathrm{\;V}/\mathrm{V}
$$
This amount of first-stage voltage gain should be sufficient to maintain reasonable noise performance for Fig. 6.5-6.

Figure 6.5-6 Op amp using cascode output stage.
The parasitic capacitance of op amps with a cascaded stage can be improved if a double polysilicon process is available [13]. Because the source and drain of a cascode pair are not connected externally, it is possible to treat the cascode pair as a dual-gate MOSFET. This is illustrated by considering the cascode pair shown in Fig. 6.5-7(a). The parasitic capacitance associated with the common drain/source connection can be virtually eliminated, as shown in Fig. 6.5-7(b), if a double polysilicon process is available. Obviously, one wants to minimize the overlap of the polysilicon layers in order to reduce the shunt input capacitance to the cas-code pair. If the technology only has single polysilicon, then the layout should try to minimize the active area between the polysilicon of the cascoding transistor and the polysilicon of the cascoded transistor as shown in Fig. 6.5-7(c).
## Folded-Cascode Op Amp
Figure 6.1-9 showed the architecture of an op amp called the folded-cascode op amp. This op amp uses cascoding in the output stage combined with an unusual implementation of the differential amplifier to achieve good input common-mode range. Thus, the folded-cascode op amp offers self-compensation, good input common-mode range, and the gain of a two-stage op amp. Let us examine this op amp in more detail and develop a design procedure that can be used as a starting point in its design.
To understand how the folded-cascode op amp optimizes the input common-mode range, consider Fig. 6.5-8. This figure shows the input common-mode range for an n-channel differential amplifier with a current mirror load and current source loads. From this figure and our previous considerations in Section 5.2, we know that Fig. 6.5-8(b) has a higher positive input common-mode voltage. In fact, if ${V}_{SD3}$ is less than ${V}_{TN}$ , then the positive input common-mode voltage of Fig. 6.5-8(b) can exceed ${V}_{DD}$ . Figure 5.2-14 is one possible practical implementation of Fig. 6.5-8(b).

Figure 6.5-7 (a) Cascode amplifier with parasitic capacitance. Method of reducing source/drain-to-bulk capacitance for (b) a double poly technology and (c) a single poly technology.

Figure 6.5-8 Input common-mode range for an n-channel input differential amplifier with (a) a current mirror load and (b) current source loads.
The problem with the differential amplifier of Fig. 6.5-8(b) is that it is difficult to get the single-ended output voltage without losing half the gain. One could follow Fig. 6.5-8(b) with another differential amplifier such as Fig. 6.5-8(a), which would achieve the desired result; however, compensation becomes more complex. A better approach is found in the folded topology op amps where the signal current is steered in the opposite direction of dc polarity. Problem 5.2-18 is an example of this architecture using a simple current mirror. However, the gain of this configuration is just that of a single stage. A better approach is to use a cascode mirror that achieves the gain of a two-stage op amp and allows for self-compensation. The basic form of an n-channel input, folded-cascode op amp is shown in Fig. 6.5-9 [12].
Note that the folded cascode does not require perfect balance of currents in the differential amp because excess dc current can flow into or out of the current mirror. Because the drains of M1 and M2 are connected to the drains of M4 and M5, the extended positive input common-mode voltage of Fig. 6.5-8(b) is achieved. The bias currents ${I}_{3},{I}_{4}$ , and ${I}_{5}$ of the folded-cascode op amp should be designed so that the dc current in the cascode mirror never goes to zero. If the current should go to zero, this requires a delay in turning the mirror back on because of the parasitic capacitances that must be charged. For example, suppose ${v}_{in}$ is large enough so that $\mathrm{M}2$ is on and $\mathrm{M}1$ is off. Then, all of ${I}_{3}$ flows through $\mathrm{M}1$ and none through M2, resulting in ${I}_{1} = {I}_{3}$ and ${I}_{2} = 0$ . If ${I}_{4}$ and ${I}_{5}$ are not greater than ${I}_{3}$ , then the current ${I}_{6}$ will be zero. To avoid this, the values of ${I}_{4}$ and ${I}_{5}$ are normally between the value of ${I}_{3}$ and $2{I}_{3}$ .

Figure 6.5-9 (a) Simplified version of an n-channel input, folded-cascode op amp. (b) Practical version (a).
First, we will find the small-signal voltage gain by inspection and then repeat the small-signal circuit analysis. Figure 6.5-10 shows how a small voltage of ${\Delta V}$ applied at the differential input will create the small-signal currents in the folded-cascode amplifier of Fig. 6.5-9(b). Note that it has been assumed that the current flowing upward in M2 sees the same resistance in the drain of M5 as in the source of M7. This is because a cascode circuit (M9 and M11) is connected from the drain of M7 to ground. In Section 5.3, we learned that the resistance looking into the sources of the cascode transistors, M6 and M7, is
$$
{R}_{A}\left( {\mathrm{\;M}6}\right)  \approx  1/{g}_{m6} \tag{6.5-10}
$$
and
$$
{R}_{B}\left( {\mathrm{\;M}7}\right)  \approx  {r}_{ds} \tag{6.5-11}
$$
We see that the current flowing into the output resistance, ${R}_{out}$ , is ${0.5}\left( {{g}_{m1} + {0.5}{g}_{m2}}\right) {v}_{in}$ . The approximate value of the output resistance is given as
$$
{R}_{\text{out }} \approx  \left( {{g}_{m9}{r}_{ds9}{r}_{ds11}}\right) \parallel \left\lbrack  {{g}_{m7}{r}_{ds7}\left( {{r}_{ds2}\parallel {r}_{ds5}}\right) }\right\rbrack   \approx  x\left( {{g}_{mN}{r}_{{ds}{N}^{2}}}\right)  \tag{6.5-12}
$$
where $x$ is a constant between 0 and 1 depending on the relative values of the n - and p-transistor transconductances and conductances. $x = {0.0769}$ if ${g}_{mP} = {0.5}{g}_{mN}$ and ${r}_{dsP} = {0.5}{r}_{dsN}$ . Note the term ${r}_{ds2}\parallel {r}_{ds5}$ in the expression for the output resistance. This term comes about because M7 cascodes the parallel combination of M2 and M5. Finally, the small-signal differential voltage gain is written as
$$
{A}_{v} = \frac{{v}_{\text{out }}}{{v}_{\text{in }}} = {0.5}\left( {{g}_{mN} + {0.5}{g}_{mN}}\right) {R}_{\text{out }} \approx  \frac{3}{4}{g}_{mN}{R}_{\text{out }} \approx  \frac{3}{4}x{\left( {g}_{mN}{r}_{dsN}\right) }^{2} \tag{6.5-13}
$$
If $x = {0.0769}$ , the differential voltage gain is ${769}\mathrm{\;V}/\mathrm{V}$ assuming that ${g}_{mN}{r}_{dsN} = {100}$ . We see that the gain of the folded-cascode op amp is similar to that of the two-stage op amp.

Figure 6.5-10 Intuitive analysis of the folded-cascode op amp of Fig. 6.5-9(b).
Unfortunately, we do not know exactly how the current flowing upward in M2 splits into M5 and M7. To examine this further, we will use small-signal circuit analysis methods to find the exact voltage gain of Fig. 6.5-9 approximated in Eq. (6.5-13). Figure 6.5-11 shows a model for the exact small-signal analysis. The resistances designated as ${R}_{A}$ and ${R}_{B}$ are the resistances looking into the sources of M6 and M7, respectively. ${R}_{A}$ and ${R}_{B}$ can be found using Eq. (5.3-15) of Section 5.3:
$$
{R}_{A} = \frac{{r}_{ds6} + 1/{g}_{m10}}{1 + {g}_{m6}{r}_{ds6}} \approx  \frac{1}{{g}_{m6}} \tag{6.5-14}
$$
and
$$
{R}_{B} = \frac{{r}_{ds7} + {R}_{9}}{1 + {g}_{m7}{r}_{ds7}} \approx  \frac{{R}_{9}}{{g}_{m7}{r}_{ds7}} \approx  {r}_{ds} \tag{6.5-15}
$$
where
$$
{R}_{9} \approx  {g}_{m9}{r}_{ds9}{r}_{ds11} \tag{6.5-16}
$$
The small-signal voltage transfer function of Fig. 6.5-11 can be found as follows. The current ${i}_{10}$ is written as
$$
{i}_{10} = \frac{-{g}_{m1}\left( {{r}_{ds1}\parallel {r}_{ds4}}\right) {v}_{in}}{2\left\lbrack  {{R}_{A} + \left( {{r}_{ds1}\parallel {r}_{ds4}}\right) }\right\rbrack  } \approx  \frac{-{g}_{m1}{v}_{in}}{2} \tag{6.5-17}
$$
and the current ${i}_{7}$ can be expressed as
$$
{i}_{7} = \frac{{g}_{m2}\left( {{r}_{ds2} \mid  {r}_{ds5}}\right) {v}_{in}}{2\left\lbrack  {\frac{{R}_{9}}{{g}_{m7}{r}_{ds7}} + \left( {{r}_{ds2} \mid  {r}_{ds5}}\right) }\right\rbrack  } = \frac{{g}_{m2}{v}_{in}}{\left( 1 + \frac{{R}_{9}\left( {{g}_{ds2} + {g}_{ds5}}\right) }{{g}_{m7}{r}_{ds7}}\right) } = \frac{{g}_{m2}{v}_{in}}{2\left( {1 + k}\right) } \tag{6.5-18}
$$
where a low-frequency unbalance factor, $k$ , is defined as
$$
k = \frac{{R}_{9}\left( {{g}_{ds2} + {g}_{ds5}}\right) }{{g}_{m7}{r}_{ds7}} \tag{6.5-19}
$$

Figure 6.5-11 Small-signal model of Fig. 6.5-9(b).
Typical values of $k$ are greater than one. The output voltage, ${v}_{\text{out }}$ , is equal to the sum of ${i}_{7}$ and ${i}_{10}$ flowing through ${R}_{\text{out }}$ . Thus,
$$
\frac{{v}_{\text{out }}}{{v}_{\text{in }}} = \left( {\frac{{g}_{m1}}{2} + \frac{{g}_{m2}}{2\left( {1 + k}\right) }}\right) {R}_{\text{out }} = \left( \frac{2 + k}{2 + {2k}}\right) {g}_{mI}{R}_{\text{out }} \tag{6.5-20}
$$
where the output resistance, ${R}_{\text{out }}$ , was given in Eq. (6.5-12). Comparing Eq. (6.5-20) with Eq. (6.5-13), we see that the intuitive approach assumes that $k = 1$ .
The poles of the folded-cascode op amp occur at the nodes in Fig. 6.5-9(b) indicated by black dots. It can be seen that there are six poles. The dominant pole is the one at the output and is given as
$$
{p}_{\text{out }} = \frac{-1}{{R}_{\text{out }}{C}_{\text{out }}} \tag{6.5-21}
$$
The nondominant poles are given below.
Pole at node $\mathrm{A}$ :
$$
{p}_{A} \approx  \frac{-{g}_{m6}}{{C}_{gs} + 2{C}_{bd}} \tag{6.5-22}
$$
Pole at node B:
$$
{p}_{B} \approx  \frac{-{g}_{m7}}{{C}_{gs} + 2{C}_{bd}} \tag{6.5-23}
$$
Pole at drain of M6:
$$
{p}_{6} \approx  \frac{-{g}_{m10}}{2{C}_{gs} + 2{C}_{bd}} \tag{6.5-24}
$$
Pole at source of M8:
$$
{p}_{8} \approx  \frac{-{g}_{m8}{r}_{ds8}{g}_{m10}}{{C}_{gs} + {C}_{bd}} \tag{6.5-25}
$$
Pole at source of M9:
$$
{p}_{9} \approx  \frac{-{g}_{m9}}{{C}_{gs} + {C}_{bd}} \tag{6.5-26}
$$
It is interesting to note that the shunt feedback loop of M10 around M8 causes the resistance at the source of M8 to be extremely small. Consequently, ${p}_{8}$ is much larger than the other four nondominant poles.
## Folded-Cascode Op Amp Performance
Assume that all the n-channel transistors of Fig. 6.5-9(b) have the small-signal parameters of ${g}_{mN} = {100\mu }\mathrm{S},{r}_{dsN} = 2\mathrm{M}\Omega ,{g}_{mP} = {50\mu }\mathrm{S},{r}_{dsP} = 1\mathrm{M}\Omega$ , and ${C}_{L} = {10}\mathrm{{pF}}$ . Find the small-signal differential voltage gain, the output resistance, the dominant pole, and the ${GB}$ of the folded-cascode op amp.
## SOLUTION
From Eq. (6.5-12) we get
$$
{R}_{\text{out }} \approx  \left( {{g}_{m9}{r}_{ds9}{r}_{ds11}}\right) \parallel \left\lbrack  {{g}_{m7}{r}_{ds7}\left( {{r}_{ds2}\parallel {r}_{ds5}}\right) }\right\rbrack
$$
$$
= {400}\mathrm{M}\Omega \parallel {33.33}\mathrm{M}\Omega  = {30.77}\mathrm{M}\Omega
$$
From Eq. (6.5-19), $k$ is equal to
$$
k = \frac{{R}_{9}\left( {{g}_{ds2} + {g}_{ds5}}\right) }{{g}_{m7}{r}_{ds7}} = \frac{{400}\mathrm{M}\Omega \left( {{0.5\mu }\mathrm{S} + {1\mu }\mathrm{S}}\right) }{50} = {12}
$$
From Eq. (6.5-20) we get
$$
\frac{{v}_{\text{out }}}{{v}_{\text{in }}} = \left( \frac{2 + k}{2 + {2k}}\right) {g}_{mN}{R}_{\text{out }} = \frac{7}{13}\left( {{100\mu }\mathrm{S}}\right) \left( {{30.77}\mathrm{M}\Omega }\right)  = {1657}\mathrm{\;V}/\mathrm{V}
$$
The dominant pole is given as
$$
{p}_{\text{out }} = \frac{-1}{{R}_{\text{out }}{C}_{L}} = \frac{-1}{\left( {{30.77}\mathrm{M}\Omega }\right) \left( {{10}\mathrm{{pF}}}\right) } = {3250}\mathrm{{rads}}/\mathrm{s}\left( {{517}\mathrm{{Hz}}}\right)
$$
Therefore, the ${GB} = \left( {1657}\right) \left( {3250}\right)  = {5.385}\mathrm{{Mrads}}/\mathrm{s}\left( {{0.857}\mathrm{{MHz}}}\right)$
The power-supply rejection ratio of the folded-cascode op amp of Fig. 6.5-9(b) has been greatly improved over the two-stage op amp. To examine the power-supply rejection properties consider the partial circuit of Fig. 6.5-9(b) shown in Fig. 6.5-12(a). The negative power-supply ripple is transferred directly to the gates M3, M8, M9, M10, and M11. Figure 6.5-12(a) ignores the coupling through the input differential amplifier. We note that the ripple also appears at the source of M9, preventing feedthrough of ${V}_{ss}$ through ${C}_{gd11}$ or ${r}_{ds11}$ . Therefore, the only path for the ripple on ${V}_{SS}$ is through ${C}_{gd9}$ as indicated on Fig. 6.5-12.
Let us take a slightly different approach to calculate the PSRR. In this case, we will find the transfer function from the ripple to the output rather than the PSRR. We know that for good PSRR, this transfer function should be small. Figure 6.5-12(b) gives a small-signal model equivalent of Fig. 6.5-12(a). The transfer function of ${V}_{\text{out }}/{V}_{ss}$ can be found as
$$
\frac{{V}_{\text{out }}}{{V}_{\text{ss }}} \approx  \frac{s{C}_{gd9}{R}_{\text{out }}}{s{C}_{\text{out }}{R}_{\text{out }} + 1} \tag{6.5-27}
$$
---
Example 6.5-3
---

Figure 6.5-12 (a) Portion of Fig. 6.5-9(b) used to examine PSRR ${}^{ - }$ . (b) Model of (a).
Assuming the ${C}_{gd9}{R}_{\text{out }}$ is less than ${C}_{\text{out }}{R}_{\text{out }}$ allows us to sketch the response of Eq. (6.5-27) and the dominant pole differential frequency response as shown on Fig. 6.5-13. At low frequencies, we are assuming that other sources of ${V}_{ss}$ injection become significant. Therefore, depending on the magnitude of other sources of ${V}_{ss}$ injection, the magnitude of ${V}_{\text{out }}/{V}_{ss}$ starts flat and then increases up to the dominant pole frequency and then remains flat. We see that this leads to a negative PSRR, which is at least as large as the magnitude of the differential voltage gain.
The positive power-supply injection is similar to the negative power-supply injection. The ripple appears at the gates of M4, M5, M6, and M7. The primary source of injection is through the gate-drain capacitor of M7, which is the same situation as for the negative power-supply injection.

Figure 6.5-13 Approximate graphical illustration of the ${\mathrm{{PSRR}}}^{ - }$ for the folded-cascode op amp.
A typical approach to designing the folded-cascode op amp is illustrated below. Example
## Design of a Folded-Cascode Op Amp
6.5-4 Follow the procedure of Table 6.5-1 to design the folded-cascode op amp of Fig. 6.5-9(b) when the slew rate is ${10}\mathrm{\;V}/\mu \mathrm{s}$ , the load capacitor is ${10}\mathrm{{pF}}$ , the maximum and minimum output voltages are $2\mathrm{\;V}$ and ${0.5}\mathrm{\;V}$ for a ${2.5}\mathrm{\;V}$ power supply, the ${GB}$ is ${10}\mathrm{{MHz}}$ , the minimum input common-mode voltage is $+ 1\mathrm{\;V}$ , and the maximum input common-mode voltage is ${2.5}\mathrm{\;V}$ . The differential voltage gain should be greater than ${3000}\mathrm{\;V}/\mathrm{V}$ and the power dissipation should be less than $5\mathrm{\;{mW}}$ . Use ${K}_{N}^{\prime } = {120\mu }\mathrm{A}/{\mathrm{V}}^{2},{K}_{P}^{\prime } = {25\mu }\mathrm{A}/{\mathrm{V}}^{2},{V}_{TN} = \left| {V}_{TP}\right|  = {0.5}\mathrm{\;V},{\lambda }_{N} =$ ${0.06}{\mathrm{\;V}}^{-1}$ , and ${\lambda }_{P} = {0.08}{\mathrm{\;V}}^{-1}$ . Let $L = {0.5\mu }\mathrm{m}$ . SOLUTION
Table 6.5-1 Design Approach for the Folded-Cascode Op Amp
<table><tr><td>Step</td><td>Relationship</td><td>Design Equation/Constraint</td><td>Comments</td></tr><tr><td>1</td><td>Slew rate</td><td>${I}_{3} = {SR} \cdot  {C}_{L}$</td><td/></tr><tr><td>2</td><td>Bias currents in output cascodes</td><td>${I}_{4} = {I}_{5} = {1.2}{I}_{3}$ to ${1.5}{I}_{3}$</td><td>Avoid zero current in cascodes</td></tr><tr><td>3</td><td>Maximum output voltage, ${v}_{\text{out }}\left( \max \right)$</td><td>${S}_{5} = \frac{2{I}_{5}}{{K}_{P}{}^{\prime }{V}_{SD5}^{2}},{S}_{7} = \frac{2{I}_{7}}{{K}_{P}{}^{\prime }{V}_{SD7}^{2}},\left( {{S}_{4} = {S}_{5}\text{ and }{S}_{6} = {S}_{7}}\right)$</td><td>${V}_{SD5}\left( \text{sat}\right)  = {V}_{SD7}\left( \text{sat}\right)$ $= {0.5}\left\lbrack  {{V}_{DD} - {V}_{out}\left( \max \right) }\right\rbrack$</td></tr><tr><td>4</td><td>Minimum output voltage, ${v}_{\text{out }}\left( \min \right)$</td><td>${S}_{11} = \frac{2{I}_{11}}{{K}_{N}^{\prime }{V}_{DS11}^{2}},{S}_{9} = \frac{2{I}_{9}}{{K}_{N}^{\prime }{V}_{DS9}^{2}},\left( {{S}_{10} = {S}_{11}}\right.$ and $\left. {{S}_{8} = {S}_{9}}\right)$</td><td>${V}_{DS9}\left( \text{sat}\right)  = {V}_{DS11}\left( \text{sat}\right)$ $= {0.5}\left\lbrack  {{V}_{\text{out }}\left( \min \right)  - {V}_{SS}}\right\rbrack$</td></tr><tr><td>5</td><td>${GB} = \frac{{g}_{m1}}{{C}_{L}}$</td><td>${S}_{1} = {S}_{2} = \frac{{g}_{m1}^{2}}{{K}_{N}{}^{\prime }{I}_{3}} = \frac{G{B}^{2}{C}_{L}^{2}}{{K}_{N}{}^{\prime }{I}_{3}}$</td><td/></tr><tr><td>6</td><td>Minimum input CM</td><td>${S}_{3} = \frac{2{I}_{3}}{{K}_{N}{}^{\prime }{\left( {V}_{in}\left( \min \right)  - {V}_{SS} - \sqrt{\left( {I}_{3}{K}_{N}{}^{\prime }{S}_{1}\right) } - {V}_{T1}\right) }^{2}}$</td><td/></tr><tr><td>7</td><td>Maximum input CM</td><td>${S}_{4} = {S}_{5} = \frac{2{I}_{4}}{{K}_{P}^{\prime }\left( {{V}_{DD} - {V}_{in}\left( \max \right)  + {V}_{T1}}\right) }2$</td><td>${S}_{4}$ and ${S}_{5}$ must meet or exceed value in step 3</td></tr><tr><td>8</td><td>Differential-voltage gain</td><td>$\frac{{v}_{\text{out }}}{{v}_{\text{in }}} = \left( {\frac{{g}_{m1}}{2} + \frac{{g}_{m2}}{2\left( {1 + k}\right) }}\right) {R}_{\text{out }} = \left( \frac{2 + k}{2 + {2k}}\right) {g}_{mI}{R}_{\text{out }}$</td><td>$k = \frac{{R}_{H}\left( {{g}_{ds2} + {g}_{ds4}}\right) }{{g}_{m7}{r}_{ds7}}$</td></tr><tr><td>9</td><td>Power dissipation</td><td>${P}_{\text{diss }} = \left( {{V}_{DD} - {V}_{SS}}\right) \left( {{I}_{3} + {I}_{10} + {I}_{11}}\right)$</td><td/></tr></table>
Following the approach outlined in Table 6.5-1 we obtain the following results:
$$
{I}_{3} = {SR} \cdot  {C}_{L} = {10} \times  {10}^{6} \cdot  {10}^{-{11}} = {100\mu }\mathrm{A}
$$
Select ${I}_{4} = {I}_{5} = {125\mu }\mathrm{A}$ .
Next, we see that the value of ${0.5}\left\lbrack  {{V}_{DD} - {V}_{out}\left( \min \right) }\right\rbrack$ is ${0.5}\mathrm{\;V}/2$ or ${0.25}\mathrm{\;V}$ . Thus,
$$
{S}_{4} = {S}_{5} = \frac{2 \cdot  {125\mu }\mathrm{A}}{{25\mu }\mathrm{A}/{\mathrm{V}}^{2} \cdot  {\left( {0.25}\mathrm{\;V}\right) }^{2}} = \frac{2 \cdot  {125} \cdot  {16}}{225} = {160}
$$
and assuming worst-case currents in M6 and M7 gives
$$
{S}_{6} = {S}_{7} = \frac{2 \cdot  {125\mu }\mathrm{A}}{{25\mu }\mathrm{A}/{\mathrm{V}}^{2}{\left( {0.25}\mathrm{\;V}\right) }^{2}} = \frac{2 \cdot  {125} \cdot  {16}}{25} = {160}
$$
The value of ${0.5}\left\lbrack  {{V}_{\text{out }}\left( \min \right)  - \left| {V}_{SS}\right| }\right\rbrack$ is also ${0.25}\mathrm{\;V}$ , which gives the value of ${S}_{8},{S}_{9},{S}_{10}$ , and ${S}_{11}$ as
$$
{S}_{8} = {S}_{9} = {S}_{10} = {S}_{11} = \frac{2 \cdot  {I}_{8}}{{K}_{N}{}^{\prime }{V}_{DS8}{}^{2}} = \frac{2 \cdot  {125}}{{120} \cdot  {\left( {0.25}\right) }^{2}} = {20}
$$
In step 5, the value of ${GB}$ gives ${S}_{1}$ and ${S}_{2}$ as
$$
{S}_{1} = {S}_{2} = \frac{G{B}^{2} \cdot  {C}_{L}^{2}}{{K}_{N}{}^{\prime }{I}_{3}} = \frac{{\left( {20}\pi  \times  {10}^{6}\right) }^{2}{\left( {10}^{-{11}}\right) }^{2}}{{120} \times  {10}^{-6} \cdot  {100} \times  {10}^{-6}} = {32.9} \approx  {33}
$$
The minimum input common-mode voltage defines ${S}_{3}$ as
$$
{S}_{3} = \frac{2{I}_{3}}{{K}_{N}{}^{\prime }{\left( {V}_{in}\left( \min \right)  - {V}_{SS} - \sqrt{\frac{{I}_{3}}{{K}_{N}{}^{\prime }{S}_{1}}} - {V}_{T1}\right) }^{2}}
$$
$$
= \frac{{200} \times  {10}^{-6}}{{110} \times  {10}^{-6}{\left( -{1.5} + {2.5} - \sqrt{\frac{100}{{120} \cdot  {35.9}}} - {0.75}\right) }^{2}} = {14.3} \approx  {15}
$$
We need to check that the values of ${S}_{4}$ and ${S}_{5}$ are large enough to satisfy the maximum input common-mode voltage. The maximum input common-mode voltage of 2.5 requires
$$
{S}_{4} = {S}_{5} \geq  \frac{2{I}_{4}}{{K}_{P}^{\prime }\left\lbrack  {{V}_{DD} - {V}_{in}\left( \max \right)  + {V}_{T1}}\right\rbrack  } = \frac{2 \cdot  {125\mu }\mathrm{A}}{{25} \times  {10}^{-6}\mu \mathrm{A}/{\mathrm{V}}^{2}{\left\lbrack  {0.5}\mathrm{\;V}\right\rbrack  }^{2}} = {40}
$$
which is much less than 160 . In fact, with ${S}_{4} = {S}_{5} = {160}$ , the maximum input common-mode voltage is ${2.75}\mathrm{\;V}$ .
The power dissipation is found to be
$$
{P}_{\text{diss }} = {2.5}\mathrm{\;V}\left( {{125\mu }\mathrm{A} + {125\mu }\mathrm{A} + {125\mu }\mathrm{A}}\right)  = {0.625}\mathrm{\;{mW}}
$$
The small-signal voltage gain requires the following values to evaluate:
$$
{S}_{4},{S}_{5} : {g}_{m} = \sqrt{2 \cdot  {125} \cdot  {25} \cdot  {160}} = {1000\mu }\mathrm{S}\text{and}{g}_{ds} = {125} \times  {10}^{-6} \cdot  {0.08} = {10\mu }\mathrm{S}
$$
$$
{S}_{6},{S}_{7} : {g}_{m} = \sqrt{2 \cdot  {75} \cdot  {25} \cdot  {160}} = {774.6\mu }\mathrm{S}\text{and}{g}_{ds} = {75} \times  {10}^{-6} \cdot  {0.08} = {6\mu }\mathrm{S}
$$
$$
{S}_{8},{S}_{8},{S}_{10},{S}_{11} : {g}_{m} = \sqrt{2 \cdot  {75} \cdot  {120} \cdot  {20}} = {600\mu }\mathrm{S}\text{and}{g}_{ds} = {75} \times  {10}^{-6} \cdot  {0.06} = {4.5\mu }\mathrm{S}
$$
$$
{S}_{1},{S}_{2} : {g}_{mI} = \sqrt{2 \cdot  {50} \cdot  {120} \cdot  {33}} = {629\mu }\mathrm{S}\text{and}{g}_{ds} = {50} \times  {10}^{-6}\left( {0.06}\right)  = {3\mu }\mathrm{S}
$$
Thus,
$$
{R}_{9} \approx  {g}_{m9}{r}_{ds9}{r}_{ds11} = \left( {{600\mu }\mathrm{S}}\right) \left( \frac{1}{{4.5\mu }\mathrm{S}}\right) \left( \frac{1}{{4.5\mu }\mathrm{S}}\right)  = {29.63}\mathrm{M}\Omega
$$
$$
{R}_{\text{out }} \approx  \left( {{29.63}\mathrm{M}\Omega }\right) \parallel \left( {{774.6\mu }\mathrm{S}}\right) \left( \frac{1}{{6\mu }\mathrm{S}}\right) \left( \frac{1}{{10\mu }\mathrm{S} + {3\mu }\mathrm{S}}\right)  = {7.44}\mathrm{M}\Omega
$$
$$
k = \frac{{R}_{9}\left( {{g}_{ds2} + {g}_{ds5}}\right) }{{g}_{m7}{r}_{ds7}} = \frac{{7.44}\mathrm{M}\Omega \left( {{3\mu }\mathrm{S} + {10\mu }\mathrm{S}}\right) \left( {{6\mu }\mathrm{S}}\right) }{{774.6\mu }\mathrm{S}} = {0.75}
$$
The small-signal differential-input voltage gain is
$$
{A}_{vd} = \left( \frac{2 + k}{2 + {2k}}\right) {g}_{mI}{R}_{out} = \left( \frac{2 + {0.75}}{2 + {1.5}}\right) {0.629} \times  {10}^{-3} \cdot  {7.44} \times  {10}^{6} = \left( {0.786}\right) \left( {4680}\right)  = {3678}\mathrm{\;V}/\mathrm{V}
$$
The gain is slightly larger than required by the specifications but this should be okay.
As before, we can enhance the gain of the folded-cascode op amp using inverting amplifiers with a gain of $- A$ in Fig. 6.5-14. A p-channel differential input has been used just to remind the reader that either type of input stage can be used. In the case of Fig. 6.5-14, the lower ICMR could include the lower rail. The output resistance and the voltage gain of the folded cascode are all increased by the magnitude of $A$ .
The enhancement amplifiers used to increase the gain are examined in more detail. Figure 6.5-15 shows one implementation of the lower and upper enhancement amplifiers in

Figure 6.5-14 Enhanced-gain folded-cascode op amp.

Figure 6.5-15 Enhancement amplifier realizations for (a) the upper amplifier and (b) the lower amplifier.
Fig. 6.5-14. These amplifiers could be used in any of the previous op amps that used enhancement amplifiers. The gain of the upper enhancement amplifier of Fig. 6.5-15(a) is
$$
{A}_{v}\left( \text{ upper }\right)  \approx   - {0.5}{g}_{m1}{r}_{ds6} =  - {0.5}{g}_{mN}{r}_{dsN} \tag{6.5-28}
$$
and the gain of the lower enhancement amplifier of Fig. 6.5-15(b) is
$$
{A}_{v}\left( \text{ lower }\right)  \approx   - {0.5}{g}_{m1}{r}_{ds6} =  - {0.5}{g}_{mP}{r}_{dsP} \tag{6.5-29}
$$
We see that the enhancement amplifiers use a folded-cascode architecture with a uncascoded load.
We can see that through negative feedback, the voltage at the input of the enhancement amplifier is equal to the voltage connected to the gate of M2. It helps to remember that the output of the enhancement amplifier is connected back to the input through a source follower. Typically, the gate voltage of M2 of lower enhancement amplifiers in Fig. 6.5-15(b) is selected to make the drain-source voltage of M4 and M5 in Fig. 6.5-14 equal to ${V}_{DS}$ (sat). Similarly, the gate voltage of M2 in the upper enhancement amplifier of Fig. 6.5-15(a) is selected to make the source-drain voltage of M11 in Fig. 6.5-14 equal to ${V}_{SD}$ (sat).
The total transistor realization of Fig. 6.5-14 is shown in Fig. 6.5-16. The shaded areas are the enhancement amplifiers. We examine the performance of this amplifier in the following example.
---
Example 6.5-5
---
## Performance of the Enhanced Gain Folded-Cascode Op Amp
Assume that all the n-channel transistors of Fig. 6.5-16 have the small-signal parameters of ${g}_{mN} = {100\mu }\mathrm{S},{r}_{dsN} = 2\mathrm{M}\Omega ,{g}_{mP} = {50\mu }\mathrm{S},{r}_{\mathrm{{dsP}}} = 1\mathrm{M}\Omega$ , and ${C}_{L} = {10}\mathrm{{pF}}$ . Find the small-signal differential voltage gain, the output resistance, the dominant pole, and the ${GB}$ of the folded-cascode op amp.
## SOLUTION
The output resistance of Fig. 6.5-16 can be approximated as
$$
{R}_{\text{out }} \approx  \left\lbrack  {{A}_{v}\text{ (upper) }{g}_{m9}{r}_{d9}{r}_{ds11}}\right\rbrack  \parallel \left\lbrack  {{A}_{v}\text{ (lower) }{g}_{m7}{r}_{ds7}\left( {{r}_{ds2}\parallel {r}_{ds5}}\right) }\right\rbrack
$$
$$
= \left\lbrack  {\left( {{g}_{mN}{r}_{dsN}}\right) {g}_{mP}{r}_{{ds}{P}^{2}}}\right\rbrack  \parallel \left\lbrack  {\left( {{g}_{mP}{r}_{dsP}}\right) {g}_{mN}{r}_{dsN}\left( {{r}_{dsP}\parallel {r}_{dsN}}\right) }\right\rbrack
$$
$$
= \left( {{10}\mathrm{G}\Omega }\right) \parallel \left( {{6.67}\mathrm{G}\Omega }\right)  = 4\mathrm{G}\Omega
$$

Figure 6.5-16 Complete transistor realization of the enhanced gain folded-cascode op amp.
If we assume the current flowing from M1 divides evenly between M5 and the upper path (M7), then the output voltage can be written as
$$
{A}_{v} = \frac{{V}_{\text{out }}}{{v}_{\text{in }}} = {0.5}\left( {{g}_{mP} + {0.5}{g}_{mP}}\right) {R}_{\text{out }} = {0.75}{g}_{mP}{R}_{\text{out }} = {150},{000}\mathrm{\;V}/\mathrm{V}
$$
The dominant pole of this op amp is
$$
{p}_{\text{dominant }} \approx  \frac{1}{{R}_{\text{out }}{C}_{L}} = {25}\text{ rads/s }\left( {4\mathrm{\;{Hz}}}\right)
$$
Within all inverting enhancement amplifiers with any appreciable gain, there is a dominant pole. We can see from Fig. 6.5-15 that the enhancement amplifier pole is approximately
$$
{p}_{\text{enhancement }} \approx  \frac{1}{{r}_{ds}\left( {{C}_{gs} + 2{C}_{db} + 2{C}_{gd}}\right) } \tag{6.5-30}
$$
As the frequency increases, the magnitude of $A$ will decrease. This will cause the output resistance to decrease. However, since the magnitude of the pole of the enhancement amplifier is normally much larger than the magnitude of the dominant pole, the load capacitor has shorted out any influence a change in ${R}_{\text{out }}$ might have.
The higher-order poles of the enhanced gain folded-cascode op amp of Fig. 6.5-16 are listed below.
1. Pole at the source of M6:
$$
{p}_{6} \approx  \frac{-A{g}_{m6}}{2{C}_{gs} + 2{C}_{bd}} \tag{6.5-31}
$$
2. Pole at the source of M7:
$$
{p}_{7} \approx  \frac{-A{g}_{m7}}{2{C}_{gs} + 2{C}_{bd}} \tag{6.5-32}
$$
3. Pole at the drain of M8:
$$
{p}_{8} \approx  \frac{-A{g}_{m10}}{2{C}_{gs} + 2{C}_{bd}} \tag{6.5-33}
$$
4. Pole at the source of M9:
$$
{p}_{9} \approx  \frac{-A{g}_{m9}}{2{C}_{gs} + {C}_{bd}} \tag{6.5-34}
$$
5. Pole at the drain of M10:
$$
{p}_{10} \approx  \frac{-{g}_{m8}{r}_{ds8}{g}_{m10}}{{C}_{gs} + {C}_{bd}} \tag{6.5-35}
$$
Although it looks like most of the nondominant poles of Fig. 6.5-16 are increased by the magnitude of $A$ , the fact that the enhancement amplifier gain will decrease because of the pole of the enhancement amplifier will cause the nondominant poles of the enhanced gain folded-cascode op amp to approach those of the folded-cascode op amp.
Op amps using the cascode configuration enable the designer to optimize some of the second-order performance specifications not possible with the classical two-stage op amp. In particular, the cascode technique is useful for increasing the gain and increasing the value of PSRR, and it allows self-compensation when used at the output. This flexibility has allowed the development of high-performance unbuffered op amps suitable for CMOS technology. Such amplifiers are widely used in present-day integrated circuits for telecommunications applications.

### 6.6 Simulation and Measurement of Op Amps
In designing a CMOS op amp, the designer starts with building blocks whose performance can be analyzed to a first-order approximation by hand/calculator methods of analysis. The advantage of this step is the insight it provides to the designer as the design of the circuit develops. However, at some point the designer must turn to a better means of simulation. For the CMOS op amp this is generally a computer-analysis program such as SPICE. With the insight of the first-order analysis and the modeling capability of SPICE, the circuit design can be optimized and many other questions (such as tolerances, stability, and noise) can be examined.
Fabrication follows the simulation and layout of the MOS op amp. After fabrication the MOS op amp must be tested and evaluated. The techniques for testing various parameters of the op amp can be as complex as the design of the op amp itself. Each specification must be verified over a large number of op amps to ensure a working op amp in case of process variations.
## Simulation and Measurement Techniques
The objective of this section is to provide the background for simulating and testing a CMOS op amp. We shall consider methods of simulating an op amp that are appropriate to SPICE but the concepts are applicable to other types of computer-simulation programs. Because the simulation and measurement of the CMOS op amp are almost identical, they are presented simultaneously. The only differences found are in the parasitics that the actual measurement introduces in the op amp circuit and the limited bandwidths of the instrumentation.
The categories of op amp measurements and simulations discussed include open-loop gain, open-loop frequency response (including the phase margin), input-offset voltage, common-mode gain, power-supply rejection ratio, common-mode input- and output-voltage ranges, open-loop output resistance, and transient response including slew rate. Configurations and techniques for each of these measurements will be presented in this section.
Simulating or measuring the op amp in an open-loop configuration is one of the most difficult steps to perform successfully. The reason is the high differential gain of the op amp. Figure 6.6-1 shows how this step might be performed. The op amp under test or simulation is shaded to differentiate it from other op amps that may be used to implement the test or simulation. ${V}_{OS}$ is an external voltage whose value is adjusted to keep the dc value of ${v}_{\mathrm{{OUT}}}$ between the power-supply limits. Without ${V}_{OS}$ the op amp will be driven to the positive or negative power supply for either the measurement or simulation cases. The resolution necessary to find the correct value of ${V}_{OS}$ usually escapes the novice designer. It is necessary to be able to find ${V}_{OS}$ to the accuracy of the magnitude of the power supply divided by the low-frequency differential gain (typically in the range of millivolts). Although this method works well for simulation, the practical characteristics of the op amp make the method almost impossible to use for measurement.
A method more suitable for measuring the open-loop gain is shown in the circuit of Fig. 6.6-2. In this circuit it is necessary to select the reciprocal ${RC}$ time constant a factor of ${A}_{v}\left( 0\right)$ less than the anticipated dominant pole of the op amp. Under these conditions, the op amp has total dc feedback, which stabilizes the bias. The dc value of ${v}_{\mathrm{{OUT}}}$ will be exactly the dc value of ${v}_{\mathrm{{IN}}}$ . The true open-loop frequency characteristics will not be observed until the frequency is approximately ${A}_{v}\left( 0\right)$ times $1/{RC}$ . Above this frequency, the ratio of ${v}_{\mathrm{{OUT}}}$ to ${v}_{\mathrm{{IN}}}$ is essentially the open-loop gain of the op amp. This method works well for both simulation and measurement.

Figure 6.6-1 Open-loop mode with offset compensation.

Figure 6.6-2 (a) A method of measuring the open-loop characteristics with dc bias stability. (b) Asymptotic magnitude plot of the voltage-transfer function.
Simulation or measurement of the open-loop gain of the op amp will characterize the open-loop transfer curve, the open-loop output-swing limits, the phase margin, the dominant pole, the unity-gain bandwidth, and other open-loop characteristics. The designer should connect the anticipated loading at the output in order to get meaningful results. In some cases, where the open-loop gain is not too large, the open-loop gain can be measured by applying ${v}_{\mathrm{{IN}}}$ in Fig. 6.6-3 and measuring ${v}_{\mathrm{{OUT}}}$ and ${v}_{I}$ . In this configuration, one must be careful that $R$ is large enough not to cause a dc current load on the output of the op amp.
The dc input-offset voltage can be measured using the circuit of Fig. 6.6-4. If the dc input-offset voltage is too small, it can be amplified by using a resistor divider in the negative-feedback path. One must remember that ${V}_{OS}$ will vary with time and temperature and is very difficult to precisely measure experimentally. Interestingly enough, ${V}_{OS}$ cannot be simulated. The reason is that the input-offset voltage is not only due to the bias mismatches as discussed for the two-stage op amp (systematic offset) but is due to device and component mismatches. Presently, most simulators do not have the ability to predict device and component mismatches.

Figure 6.6-3 Configuration for simulating or measuring the open-loop frequency response for moderate-gain op amps.

Figure 6.6-4 Configuration for measuring the input-offset voltage and the simulation of the systematic offset voltage of an op amp.
The common-mode gain is most easily simulated or measured using Fig. 6.6-5. It is seen that if ${V}_{OS}$ fails to keep the op amp in the linear region, this configuration will fail, which is often the case in experimental measurements. More often than not, the designer wishes to measure or simulate the CMRR. The common-mode gain could be derived from the CMRR and the open-loop gain if necessary.
A method of measuring the CMRR of an op amp, which is more robust, is given in Fig. 6.6-6 [14]. While the method can be used for dynamic characterization, we will explain the operation from a static viewpoint. Assume that first all ${v}_{\mathrm{{SET}}}$ voltage sources are increased by some amount, say, 1 V. This causes the output and the power supplies to the op amp under test to be increased by $1\mathrm{\;V}$ . As a result of this a voltage, ${v}_{l}$ , will appear at the input of the op amp under test. ${v}_{I}$ will be equal to the common-mode output voltage of $1\mathrm{\;V}$ divided by the differential voltage gain of the op amp under test. This change in ${v}_{I}$ can be measured at ${v}_{OS}$ as approximately ${1000}{v}_{I}$ . Let this value of ${v}_{OS}$ be designated as ${V}_{OS1}$ . Next, all ${v}_{\mathrm{{SET}}}$ voltage sources are decreased by the same amount (in order to cancel any positive or negative signal differences). This measure of ${v}_{OS}$ is designated as ${V}_{OS2}$ . The CMRR can be found as
$$
\text{ CMRR } = \frac{2000}{\left| {V}_{OS1} - {V}_{OS2}\right| } \tag{6.6-1}
$$
If the ${v}_{\mathrm{{SET}}}$ sources are replaced by a small-signal voltage called ${v}_{icm}$ , then it can be shown (in Problem 6.6-4) that the CMRR can be given as
$$
\text{ CMRR } = \frac{{1000}{v}_{\text{icm }}}{{v}_{\text{os }}} \tag{6.6-2}
$$
Using this approach, one could apply ${v}_{icm}$ and sweep the frequency to measure ${v}_{os}$ and the CMRR as a function of frequency.
Another way to measure the CMRR would be to measure first the differential voltage gain in $\mathrm{{dB}}$ and then the common-mode voltage gain in $\mathrm{{dB}}$ by applying a common-mode signal to the input. The CMRR in dB could be found by subtracting the common-mode voltage gain in $\mathrm{{dB}}$ from the differential-mode voltage gain in $\mathrm{{dB}}$ . If the measurement system is associated with a controller or computer, this could be done automatically.

Figure 6.6-5 Configuration for simulating the common-mode gain.

Figure 6.6-6 Circuit used to measure CMMR and PSRR.
While the above methods could be used for simulation of the CMRR, there are easier methods if simulation of CMRR is the goal. The objective of simulation is to get an output that is equal to CMRR or can be related to CMRR. Figure 6.6-7(a) shows a method that can accomplish this objective. Two identical voltage sources designated as ${V}_{cm}$ are placed in series with both op amp inputs where the op amp is connected in the unity-gain configuration. A model of this circuit is shown in Fig. 6.6-7(b). It can be shown that
$$
\frac{{V}_{\text{out }}}{{V}_{cm}} = \frac{\pm {A}_{c}}{1 + {A}_{v} - \left( {\pm {A}_{c}/2}\right) } \cong  \frac{\left| {A}_{c}\right| }{{A}_{v}} = \frac{1}{\mathrm{{CMRR}}} \tag{6.6-3}
$$
Computer simulation can be used to calculate Eq. (6.6-3) directly. If the simulator has a postprocessing capability, then it is usually possible to plot the reciprocal of the transfer function so that CMRR can be plotted directly. Figure 6.6-8(a) shows the simulation results of the magnitude of the CMRR for the op amp of Example 6.3-1 and Fig. 6.6-8(b) gives the phase response of the CMRR. It is seen that the CMRR is quite large for frequencies up to ${100}\mathrm{{kHz}}$ .
The configuration of Fig. 6.6-6 can also be used to measure the power-supply rejection ratio, PSRR. The procedure sets all ${v}_{\text{SET }}$ voltage sources to zero except for the one in series with ${V}_{DD}$ . Set this source equal to $+ 1\mathrm{\;V}$ . In this case, ${v}_{I}$ is the input-offset voltage for ${V}_{DD} + 1\mathrm{\;V}$ .

Figure 6.6-7 (a) Configuration for the direct simulation of CMRR. (b) Model for (a).

Figure 6.6-8 CMRR frequency response of Example 6.3-1 with ${C}_{c} = {10}\mathrm{{pF}}$ . (a) Magnitude response. (b) Phase response.
Measure ${V}_{OS}$ under these conditions and designate it as ${V}_{OS3}$ . Next, set ${V}_{DD}$ to ${V}_{DD} - 1\mathrm{\;V}$ using the ${v}_{\mathrm{{SET}}}$ source in series with ${V}_{DD}$ ; measure ${V}_{OS}$ and designate it as ${V}_{OS4}$ . The PSRR of the ${V}_{DD}$ supply is given as
$$
\text{ PSRR of }{V}_{DD} = \frac{2000}{\left| {V}_{OS3} - {V}_{OS4}\right| } \tag{6.6-4}
$$
Similarly for the ${V}_{SS}$ rejection ratio, change ${V}_{SS}$ and keep ${V}_{DD}$ constant while ${V}_{\text{OUT }}$ is at $0\mathrm{\;V}$ . The above formula can be applied in the same manner to find the negative power-supply rejection ratio. This approach is also suitable for measuring PSRR as a function of frequency if the appropriate ${v}_{\mathrm{{SET}}}$ voltage sources are replaced with a sinusoid.
Figure 6.6-9 shows a configuration similar to Fig. 6.4-1 that is suitable for measuring the PSRR as a function of frequency. A small sinusoidal voltage is inserted in series with ${V}_{DD}$ $\left( {V}_{SS}\right)$ to measure ${\mathrm{{PSRR}}}^{ + }\left( {\mathrm{{PSRR}}}^{ - }\right)$ . From Eq. (6.4-2) it was shown that
$$
\frac{{V}_{\text{out }}}{{V}_{dd}} \cong  \frac{1}{{\mathrm{{PSRR}}}^{ + }}\;\text{ or }\;\frac{{V}_{\text{out }}}{{V}_{ss}} \cong  \frac{1}{{\mathrm{{PSSR}}}^{ - }} \tag{6.6-5}
$$
This procedure was the method by which PSRR was calculated for the two-stage op amp in Section 6.4. This method works well as long as the CMRR is much greater than 1.

Figure 6.6-9 (a) Configuration for the direct simulation or measurement of PSRR. (b) Model of (a) with ${V}_{SS} = 0$ .

Figure 6.6-10 Measurement of the input common-mode voltage range of an op amp.
The input and output common-mode voltage range can be defined for both the open-loop and closed-loop modes of the op amp. For the open-loop case, only the output CMR makes sense. One of the configurations of Fig. 6.6-1 or 6.6-3 can be used to measure the output CMR. Typically, the open-loop, output CMR is about half the power-supply range. Because the op amp is normally used in a closed-loop mode, it makes more sense to measure or simulate the input and output CMR for this case. The unity-gain configuration is useful for measuring or simulating the input CMR. Figure 6.6-10 shows the configuration and the anticipated results. The linear part of the transfer curve where the slope is unity corresponds to the input common-mode voltage range. The initial jump in the voltage sweep from negative values of ${v}_{\mathrm{{IN}}}$ to positive values is due to the turn-on of M5. In the simulation of the input CMR of Fig. 6.6-10, it is also useful to plot the current in M1 because there may be a small range of ${v}_{\mathrm{{IN}}}$ before $\mathrm{M}1$ begins to conduct after $\mathrm{M}5$ is turned on (e.g., see Fig. 6.6-17).
In the unity-gain configuration, the linearity of the transfer curve is limited by the ICMR. Using a configuration of higher gain, the linear part of the transfer curve corresponds to the output-voltage swing of the amplifier. This is illustrated in Fig. 6.6-11 for an inverting gain of 10 configuration. The amount of current flowing in ${R}_{L}$ will have a strong influence on the output-voltage swing and should be selected to represent the actual circumstance.
The output resistance can be measured by connecting a load resistance ${R}_{L}$ to the op amp output in the open-loop configuration. The measurement configuration is shown in Fig. 6.6-12.

Figure 6.6-11 Measurement of the output-voltage swing.

Figure 6.6-12 Measurement of the open-loop output resistance.
The voltage drop caused by ${R}_{L}$ at a constant value of ${v}_{\mathrm{{IN}}}$ can be used to calculate the output resistance as
$$
{R}_{\text{out }} = {R}_{L}\left( {\frac{{V}_{O1}}{{V}_{O2}} - 1}\right)  \tag{6.6-6}
$$
An alternate approach is to vary ${R}_{L}$ until ${V}_{O2} = {V}_{O1}/2$ . Under this condition ${R}_{\text{out }} = {R}_{L}$ . If the op amp must be operated in the closed-loop mode, then the effects of the feedback on the measured output resistance must be considered. The best alternative is to use Fig. 6.6-13, where the value of the open-loop gain ${A}_{v}$ is already known. In this case, the output resistance is
$$
{R}_{\text{out }} = {\left( \frac{1}{{R}_{o}} + \frac{1}{100R} + \frac{{A}_{v}}{{100}{R}_{o}}\right) }^{-1} \cong  \frac{{100}{R}_{o}}{{A}_{v}} \tag{6.6-7}
$$
It is assumed that ${A}_{v}$ is in the range of 1000 and that $R$ is greater than ${R}_{o}$ . Measuring ${R}_{\text{out }}$ and knowing ${A}_{v}$ allows one to calculate the output resistance of the op amp ${R}_{o}$ from Eq. (6.6-7). Other schemes for measuring the output impedance of op amps can be found in the literature $\left\lbrack  {{15},{16}}\right\rbrack$ .
The configuration of Fig. 6.6-14 is useful for measuring the slew rate and the settling time. Figure 6.6-14 gives the details of the measurement. For best accuracy, the slew rate and settling time should be measured separately. If the input step is sufficiently small (<0.5V), the output should not slew and the transient response will be a linear response. The settling time can easily be measured. (Appendix D shows how the unity-gain step response can be related to the phase margin, making this configuration a quick method of measuring the phase margin.) If the input step magnitude is sufficiently large, the op amp will slew by virtue of not having enough current to charge or discharge the compensating and/or load capacitances. The slew rate is determined from the slope of the output waveform during the rise or fall of the output. The output loading of the op amp should be present during the settling-time and slew-rate measurements. The unity-gain configuration places the severest requirements on stability and slew rate because its feedback is the largest, resulting in the largest values of loop gain, and should always be used as a worst-case measurement.

Figure 6.6-13 An alternative method of measuring the open-loop output resistance ${R}_{o}$ .

Figure 6.6-14 Measurement of slew rate (SR) and settling time.
Other simulations (such as noise, tolerances, process-parameter variations, and temperature) can also be performed. At this point, one could breadboard the op amp. However, if the accuracy of the simulation models is sufficient this step is questionable. An example of using SPICE to simulate a CMOS op amp is given in the following.
---
Example 6.6-1
---
## Simulation of the CMOS Op Amp of Example 6.3-1
The op amp designed in Example 6.3-1 and shown in Fig. 6.3-3 is to be analyzed by SPICE to determine if the specifications are met. The device parameters to be used are those of Tables 3.1-2 and 3.2-1. In addition to verifying the specifications of Example 6.3-1, we will simulate ${\mathrm{{PSRR}}}^{ + }$ and ${\mathrm{{PSRR}}}^{ - }$ .
## SOLUTION
The op amp will be treated as a subcircuit in order to simplify the repeated analyses. Table 6.6-1 gives the SPICE subcircuit description of Fig. 6.3-3. While the values of ${AD},{AS},{PD}$ , and ${PS}$ could be calculated if the physical layout was complete, we will make an educated estimate of these values by using the following approximations.
$$
{AS} = {AD} \cong  W\left\lbrack  {{L1} + {L2} + {L3}}\right\rbrack
$$
$$
{PS} = {PD} \cong  {2W} + 2\left\lbrack  {{L1} + {L2} + {L3}}\right\rbrack
$$
where ${L1}$ is the minimum allowable distance between the polysilicon and a contact in the moat (Rule 5C of Table B-1), L2 is the length of a minimum-size square contact to moat (Rule $5\mathrm{\;A}$ of Table $\mathrm{B} - 1$ ), and ${L3}$ is the minimum allowable distance between a contact to moat and the edge of the moat (Rule 5D of Table B-1).
The first analysis to be made involves the open-loop configuration of Fig. 6.6-1. A coarse sweep of ${v}_{\mathrm{{IN}}}$ is made from -5 to $+ 5\mathrm{\;V}$ to find the value of ${v}_{\mathrm{{IN}}}$ where the output makes the transition from ${V}_{SS}$ to ${V}_{DD}$ . Once the transition range is found, ${v}_{\mathrm{{IN}}}$ is swept over values that include only the transition region. The result is shown in Fig. 6.6-15. From this data, the value of ${V}_{OS}$ in Fig. 6.6-1 can be determined. While ${V}_{OS}$ need not make ${v}_{\text{OUT }}$ exactly zero, it should keep the output in the linear range so that when SPICE calculates the bias point for small-signal analysis, reasonable results are obtained. Since when ${v}_{\mathrm{{IN}}} = 0\mathrm{\;V}$ the op amp is still in the linear region, no offset was used to obtain the following open-loop performances.
Table 6.6-1 SPICE Subcircuit Description of Fig. 6.3-3
---
SUBCKT OPAMP 1 2 6 8 9
M1 4 2 3 3 NMOS1 W = 3U L = 1U AD = 18P AS = 18P PD = 18U PS =
+ 18U
M2 5 1 3 3 NMOS1 W = 3U L = 1U AD = 18P AS = 18P PD = 18U PS =
+ 18U
M3 4 4 8 8 PMOS1 W = 15U L = 1U AD = 90P AS = 90P PD = 42U PS = 42U
M4 5 4 8 8 PMOS1 W = 15U L = 1U AD = 90P AS = 90P PD = 42U PS = 42U
M5 3 7 9 9 NMOS1 W = 4.5U L = 1U AD = 27P AS = 27P PD = 21U PS = 21U
M6 6 5 8 8 PMOS1 W = 94U L = 1U AD = 564P AS = 564P PD = 200U PS = 200U
M7 6 7 9 9 NMOS1 W = 14U L = 1U AD = 84P AS = 84P PD = 40U PS = 40U
M8 7 7 9 9 NMOS1 W = 4.5U L = 1U AD = 27P AS = 27P PD = 21U PS = 21U
CC 5 6 3.0P
. MODEL NMOS1 NMOS VTO = 0.70 KP = 110U GAMMA = 0.4 LAMBDA = 0.04 PHI =
$+ {0.7}\mathrm{{MJ}} = {0.5}\mathrm{{MJSW}} = {0.38}\mathrm{{CGBO}} = {700}\mathrm{P}\mathrm{{CGSO}} = {220}\mathrm{P}\mathrm{{CGDO}} = {220}\mathrm{P}\mathrm{{CJ}}$
$+  = {770}\mathrm{U}\;\mathrm{{CJSW}} = {380}\mathrm{P}\;\mathrm{{LD}} = {0.016}\mathrm{U}\;\mathrm{{TOX}} = {14}\mathrm{\;N}$
. MODEL PMOS1 PMOS VTO $=  - {0.7}\mathrm{{KP}} = {50}\mathrm{U}$ GAMMA $= {0.57}$ LAMBDA $= {0.05}\mathrm{{PHI}}$
$+  = {0.8}\mathrm{{MJ}} = {0.5}\mathrm{{MJSW}} = {.35}\mathrm{{CGBO}} = {700}\mathrm{P}\mathrm{{CGSO}} = {220}\mathrm{P}\mathrm{{CGDO}} = {220}\mathrm{P}\mathrm{{CJ}}$
$+  = {560}\mathrm{U}\;\mathrm{{CJSW}} = {350}\mathrm{P}\;\mathrm{{LD}} = {0.014}\mathrm{U}\;\mathrm{{TOX}} = {14}\mathrm{\;N}$
IBIAS 8 7 30U
.ENDS
---
At this point, the designer is ready to begin the actual simulation of the op amp. In the open-loop configuration the voltage-transfer curve, the frequency response, the small-signal gain, and input and output resistances can be simulated. The SPICE input deck using the PC version of SPICE (PSPICE) is shown in Table 6.6-2. Figure 6.6-16 shows the results of this simulation. The open-loop voltage gain is ${10},{530}\mathrm{\;V}/\mathrm{V}$ (determined from the output file), ${GB}$ is $5\mathrm{{MHz}}$ , output resistance is ${122.5}\mathrm{k}\Omega$ (determined from the output file), power dissipation is ${0.806}\mathrm{\;{mW}}$ (determined from the output file), phase margin for a ${10}\mathrm{{pF}}$ load is ${65}^{ \circ  }$ , and the open-loop output-voltage swing is +2.3 to -2.2 V. The simulation results compare well with the original specifications.

Figure 6.6-15 Open-loop transfer characteristic of Example 6.6-1 illustrating ${V}_{OS}$ .
Table 6.6-2 PSPICE Input File for the Open-Loop Configuration
---
EXAMPLE 6.6-1 OPEN LOOP CONFIGURATION
OPTION LIMPTS = 1000
VIN + 1 0 DC 0 AC 1.0
VDD 4 0 DC 2.5
VSS 0 5 DC 2.5
VIN - 2 0 DC 0
CL 3 0 1 0 P
X1 1 2 3 4 5 OPAMP
-
(Subcircuit of Table 6.6-1)
. OP
. TF $V\left( 3\right) \;$ VIN+
. DC VIN + -0.005 0.005 100U
PRINT DC V(3)
AC DEC 10 1 10MEG
PRINT AC VDB (3) VP (3)
.PROBE (This entry is unique to PSPICE)
. END
---
The next configuration is the unity-gain configuration of Fig. 6.6-10. From this configuration, the ICMR, ${\mathrm{{PSRR}}}^{ + },{\mathrm{{PSRR}}}^{ - }$ , slew rate, and settling time can be determined. Table 6.6-3 gives the SPICE input file to accomplish this $\left( {{\mathrm{{PSRR}}}^{ + }\text{and}{\mathrm{{PSRR}}}^{ - }}\right.$ must be done on separate runs). The results of this simulation are shown in the following figures. The ICMR is -1.2 to $+ {2.3}\mathrm{\;V}$ as seen on Fig. 6.6-17. Note that the lower limit of the ICMR is determined by when the current in M5 reaches its quiescent value. ${\mathrm{{PSRR}}}^{ + }$ is shown in Fig. ${6.6} - {18}$ and ${\mathrm{{PSRR}}}^{ - }$ is shown in Fig. 6.6-19.

Figure 6.6-16 (a) Open-loop transfer function magnitude response of Example 6.6-1. (b) Open-loop transfer function phase response of Example 6.6-1.
TABLE 6.6-3 Input File for the Unity-Gain Configuration
---
EXAMPLE 6.6-1 UNITY GAIN CONFIGURATION.
OPTION LIMPTS = 501
$\mathrm{{VIN}} + \begin{array}{llllllllllllll} 1 & 0 & \mathrm{{PWL}}(0 &  - 2 & {10}\mathrm{\;N} &  - 2 & {20}\mathrm{\;N} & 2 & 2\mathrm{\;U} & 2 & 2.\;{01}\mathrm{\;U} &  - 2 & 4\mathrm{\;U} &  - 2 \end{array}$
+ 4.01U -.1 6U -.1 6.01U .1 8U .1 8.01U -.1 10U -.1)
VDD 4 0 DC 2.5 AC 1.0
VSS 0 5 DC 2.5
CL 3 0 2 0 P
X1 1 3 3 4 5 OPAMP
-
(Subcircuit of Table 6.6-1)
-
-
-
. DC VIN + -2.5 2.5 0.1
PRINT DC V (3)
. TRAN 0.05U 10U 0 10N
PRINT TRAN V ( 3 ) V ( 1 )
AC DEC 10 1 10MEG
PRINT AC VDB (3) VP (3)
.PROBE (This entry is unique to PSPICE)
. END
---
The large-signal and small-signal transient responses were made by applying a $4\mathrm{\;V}$ pulse and a ${0.2}\mathrm{\;V}$ pulse to the unity-gain configuration. The results are illustrated in Fig. 6.6-20. From these data the positive slew rate is seen to be ${10}\mathrm{\;V}/\mu \mathrm{s}$ but the negative slew rate is closer to $- {6.7}\mathrm{\;V}/\mu \mathrm{s}$ and has a large negative overshoot. The reason for the poorer negative slew rate is due to the limited current available to discharge the ${10}\mathrm{{pF}}$ load capacitance. At a slew rate of $- {6.7}\mathrm{\;V}/\mu \mathrm{s}$ , the current through the compensating capacitor, ${C}_{c}$ , is about ${20\mu }\mathrm{A}$ . Therefore, the current remaining to discharge the load capacitor is ${95\mu }\mathrm{A}$ minus ${20\mu }\mathrm{A}$ or ${70\mu }\mathrm{A}$ . Thus, the slew rate of the negative transition is limited by the load capacitance rather than the compensation capacitance and is about $- 7\mathrm{\;V}/\mu \mathrm{s}$ . This could easily be solved by increasing the bias current in the output stage from ${95\mu }\mathrm{A}$ to ${130\mu }\mathrm{A}({30\mu }\mathrm{A}$ for ${C}_{c}$ and ${100\mu }\mathrm{A}$ for $\left. {C}_{L}\right)$ .

Figure 6.6-17 Input common-mode simulation of Example 6.6-1.

Figure 6.6-18 (a) ${\mathrm{{PSRR}}}^{ + }$ magnitude response of Example 6.6-1. (b) ${\mathrm{{PSRR}}}^{ + }$ phase response of Example 6.6-1.

Figure 6.6-19 (a) ${\mathrm{{PSRR}}}^{ - }$ magnitude response of Example 6.6-1. (b) ${\mathrm{{PSRR}}}^{ - }$ phase response of Example 6.6-1.

Figure 6.6-20 (a) Unity-gain transient response of Example 6.6-1. (b) Unity-gain, small-signal transient response of Example 6.6-1.
The large overshoot on the negative slew is due to the fact that there is no current in M6 because all of the ${95\mu }\mathrm{A}$ from M7 is being used to discharge capacitances ${C}_{c}$ and ${C}_{L}$ and none is left to flow through M6. On the positive slew, M6 can provide whatever current is needed so it can respond immediately to changes. However, the negative slew continues past the final point until the output stage can respond accordingly through the unity-gain feedback network.
The overshoot is seen to be very small. The settling time to within $\pm  5\%$ is approximately ${0.5\mu }\mathrm{s}$ as determined from the output file. The relatively large-value compensation capacitor is preventing the ${10}\mathrm{{pF}}$ load from causing significant ringing in the transient response. An interesting question that is pursued further in Problem 6.6-11 is why the negative overshoot is greater than the positive overshoot. Slewing is no longer a concern because the op amp is operating in the linear mode.
The specifications resulting from this simulation are compared to the design specifications in Table 6.6-4. It is seen that the design is almost satisfactory. Slight adjustments can be made in the $W/L$ ratios or dc currents to bring the amplifier within the specified range. The next step in simulation would be to vary the values of the model parameters, typically ${K}^{\prime },{V}_{T}$ , $\gamma$ , and $\lambda$ , to ensure that the specifications are met even if the process varies.
TABLE 6.6-4 Comparison of the Simulation with Specifications of Example 6.3-1
<table><tr><td>Specification (Power supply $=  \pm  {2.5}\mathrm{\;V}$ )</td><td>Design (Example 6.3-1)</td><td>Simulation (Example 6.6-1)</td></tr><tr><td>Open-loop gain</td><td>＞5000</td><td>10,000</td></tr><tr><td>${GB}$ (MHz)</td><td>$5\mathrm{{MHz}}$</td><td>$5\mathrm{{MHz}}$</td></tr><tr><td>ICMR (volts)</td><td>-1to $2\mathrm{\;V}$</td><td>$+ {2.4}\mathrm{\;V}, - {1.2}\mathrm{\;V}$</td></tr><tr><td>Slew rate (V/μs)</td><td>>10 (V/μs)</td><td>$+ {10}, - 7\left( {\mathrm{\;V}/\mathrm{{\mu s}}}\right)$</td></tr><tr><td>${P}_{\text{diss }}\left( \mathrm{{mW}}\right)$</td><td><2 mW</td><td>0.625 mW</td></tr><tr><td>${V}_{\text{out }}$ range (V)</td><td>$\pm  2\mathrm{\;V}$</td><td>$+ {2.3}\mathrm{\;V}, - {2.2}\mathrm{\;V}$</td></tr><tr><td>${\mathrm{{PSRR}}}^{ + }\left( 0\right) \left( \mathrm{{dB}}\right)$</td><td>-</td><td>87</td></tr><tr><td>${\mathrm{{PSRR}}}^{ - }\left( 0\right) \left( \mathrm{{dB}}\right)$</td><td>-</td><td>106</td></tr><tr><td>Phase margin (degrees)</td><td>${60}^{ \circ  }$</td><td>${65}^{ \circ  }$</td></tr><tr><td>Output resistance ( $\mathrm{k}\Omega$ )</td><td>-</td><td>122.5 kΩ</td></tr></table>
The measurement schemes of this section will work reasonably well as long as the open-loop gain is not large. If the gain should be large, techniques applicable to bipolar op amps must be employed. A test circuit for the automatic measurement of integrated-circuit op amps in the frequency domain has been developed and described [17]. This method supplements the approaches given in this section. Data books, websites, and technical literature are also good sources of information on this topic.

### 6.7 Summary
This chapter has presented the design, simulation, and measurement considerations of unbuffered CMOS op amps. The general approach to designing op amps concentrates first on establishing dc conditions that are process insensitive. This results in defining some of the ratios of the devices and establishing constraints between the device ratios. Next, the ac performance is achieved by selecting dc current levels and the remaining device ratios. Constraints are then developed in order to achieve satisfactory frequency response. This procedure for designing simple CMOS op amps was seen to be reasonably straightforward, and a design procedure was developed for the two-stage CMOS op amp that ensures a first-cut design for most specifications.
One important aspect of the op amp is its stability characteristics, which are specified by the phase margin. Several compensation procedures that allow the designer to achieve reasonably good phase margins even with large capacitive loads were discussed. The stability of the op amp was also important in the settling time of the pulse response. The Miller compensation method of pole splitting, used together with a nulling resistor to eliminate the effects of the RHP zero, was found to be satisfactory.
The design of the CMOS op amp given in Sections 6.3 and 6.4 resulted in a first-cut design for a two-stage op amp or a cascode op amp. The two-stage op amp was seen to give satisfactory performance for most typical applications. The cascode configuration of Section 6.3 was used to improve the performance of the two-stage op amp in the areas of gain, stability, and PSRR. If all internal nodes of an op amp are low impedance, compensation can be accomplished by a shunt capacitance to ground at the output. This configuration is self-compensating for large capacitive loads. Although the output resistance of the cascode op amp was generally large, this is not a problem if the op amp is to drive capacitive loads.
Sections 6.3 and 6.4 show how the designer can obtain the approximate values for the performance of the op amp. However, it is necessary to simulate the performance of the CMOS op amp to refine the design and to check to make sure no errors were made in the design. Refining the design also means varying the process parameters in order to make sure the op amp still meets its specifications under given process variations. Finally, it is necessary to be able to measure the performance of the op amp when it is fabricated. So, techniques of simulation and measurement applicable to the CMOS op amp were presented.
This chapter has presented the principles and procedures by which the reader can design op amps for applications not requiring low output resistance. This information serves as the basis for improving the performance of op amps, the topic to be considered in the next chapter.
## Problems
6.1-1. Use the null port concept to find the voltage-transfer function of the noninverting voltage amplifier shown in Fig. P6.1-1.

Figure P6.1-1
6.1-2. Show that if the voltage gain of an op amp approaches infinity, the differential input becomes a null port. Assume that the output is returned to the input by means of negative feedback.
6.1-3. Show that the controlled source of Fig. 6.1- 5 designated as ${v}_{1}/\mathrm{{CMRR}}$ is in fact a suitable model for the common-mode behavior of the op amp.
6.1-4. Show how to incorporate the PSRR effects of the op amp into the model of the nonideal effects of the op amp given in Fig. 6.1-5.
6.1-5. Replace the current-mirror load of Fig. 6.1- 8 with two separate current mirrors and show how to recombine these currents in an output stage to get a push-pull output. How can you increase the gain of the configuration equivalent to a two-stage op amp?
6.1-6. Replace the $I \rightarrow  I$ stage of Fig. 6.1-9 with a current-mirror load. How would you increase the gain of this configuration to make it equivalent to a two-stage op amp?
6.2-1. Develop the expression for the dominant pole in Eq. (6.2-10) and the output pole in Eq. (6.2- 11) from the transfer function of Eq. (6.2-9).
6.2-2. Figure 6.2-7 uses asymptotic plots to illustrate the difference between an uncompensated and compensated op amp. What is the approximate value of the real phase margin using the actual curves and not the asymptotic approximations?
6.2-3. Derive the relationship for ${GB}$ given in Eq. (6.2-17).
6.2-4. For an op amp model with two poles and one RHP zero, prove that if the zero is ten times larger than ${GB}$ , then in order to achieve a ${45}^{ \circ  }$ phase margin, the second pole must be placed at least 1.22 times higher than ${GB}$ .
6.2-5. For an op amp model with three poles and no zero, prove that if the highest pole is ten times ${GB}$ , then in order to achieve ${60}^{ \circ  }$ phase margin, the second pole must be placed at least 2.2 times ${GB}$ .
6.2-6. Derive the relationships given in Eqs. (6.2- 37) through (6.2-40).
6.2-7. Physically explain why the RHP zero occurs in the Miller compensation scheme illustrated in the op amp of Fig. 6.2-8. Why does the RHP zero have a stronger influence on a CMOS op amp than on a similar-type BJT op amp?
6.2-8. A two-stage, Miller-compensated CMOS op amp has an RHP zero at ${20GB}$ , a dominant pole due to the Miller compensation, a second pole at ${p}_{2}$ , and another pole at $- {3GB}$ .
(a) If ${GB}$ is $1\mathrm{{MHz}}$ , find the location of ${p}_{2}$ corresponding to a ${45}^{ \circ  }$ phase margin.
(b) Assume that in part (a) $\left| {p}_{2}\right|  = {2GB}$ and a nulling resistor is used to cancel ${p}_{2}$ . What is the new phase margin assuming that ${GB} = 1\mathrm{{MHz}}$ ?
(c) Using the conditions of (b), what is the phase margin if ${C}_{L}$ is increased by a factor of 4 ?
6.2-9. Derive Eq. (6.2-56).
6.2-10. For the two-stage op amp of Fig. 6.2-8, find ${W}_{1}/{L}_{1},{W}_{6}/{L}_{6}$ , and ${C}_{c}$ if ${GB} = 1\mathrm{{MHz}},\left| {p}_{2}\right|$ $= {5GB}, z = {3GB}$ , and ${C}_{L} = {C}_{2} = {20}\mathrm{{pF}}$ . Use the parameter values of Table 3.1-2 and consider only the two-pole model of the op amp. The bias current in M5 is ${40\mu }\mathrm{A}$ and in M7 is ${320\mu }\mathrm{A}$ .
6.2-11. In Fig. 6.2-14, assume that ${R}_{I} = {150}\mathrm{k}\Omega ,{R}_{II}$ $= {100}\mathrm{k}\Omega ,{g}_{mII} = {500\mu }\mathrm{S},{C}_{I} = 1\mathrm{{pF}},{C}_{II} =$ $5\mathrm{{pF}}$ , and ${C}_{c} = {30}\mathrm{{pF}}$ . Find the value of ${R}_{z}$ and the locations of all roots for (a) the case where the zero is moved to infinity and (b) the case where the zero cancels the next highest pole.
6.2-12. A self-compensated op amp has three higher-order poles grouped closely around $- 1 \times  {10}^{9}$ radians/s. What should be the ${GB}$ of this op amp in $\mathrm{{Hz}}$ to achieve a ${60}^{ \circ  }$ phase margin? If the low-frequency gain of the op amp is ${80}\mathrm{\;{dB}}$ , where is the location of the dominant pole, ${p}_{1}$ ? If the output resistance of this amplifier is ${10}\mathrm{M}\Omega$ , what is the value of ${C}_{L}$ that will give this location for ${p}_{1}$ ? (Ignore any other capacitance at the output for this part of the problem.)
6.3-1. For the CMOS op amp shown in Fig. P6.3-1, assume the model parameters for the transistors are ${K}_{N}^{\prime } = {110\mu }\mathrm{A}/{\mathrm{V}}^{2},{K}_{P}^{\prime } = {50}$ $\mu \mathrm{A}/{\mathrm{V}}^{2},{V}_{TN} = {0.7}\mathrm{\;V},{V}_{TP} =  - {0.7}\mathrm{\;V},{\lambda }_{N} =$ ${0.04}{\mathrm{\;V}}^{-1}$ , and ${\lambda }_{P} = {0.05}{\mathrm{\;V}}^{-1}$ . Let all transistor lengths be ${1\mu }\mathrm{m}$ and design the widths of every transistor and the dc currents ${I}_{5}$ and ${I}_{7}$ to satisfy the following specifications:
$$
\text{Slew rate} = {10}\mathrm{\;V}/\mathrm{{\mu s}}
$$
$$
+ \mathrm{{ICMR}} = {0.8}\mathrm{\;V}
$$
$$
- \mathrm{{ICMR}} = 0\mathrm{\;V}
$$
$$
{GB} = {10}\mathrm{{MHz}}
$$
Phase margin $= {60}^{ \circ  }\left( {{g}_{mII} = {10}{g}_{mI}}\right.$ and
$$
{V}_{SG4} = {V}_{SG6})
$$

Figure P6.3-1
6.3-2. Develop the relationship given in step 5 of Table 6.3-2.
6.3-3. Show that the relationship between the $W/L$ ratios of Fig. 6.3-1, which guarantees that ${V}_{SG4} = {V}_{SG6}$ , is given by
$$
\frac{{S}_{6}}{{S}_{4}} = 2\frac{{S}_{7}}{{S}_{5}}
$$
where ${S}_{i} = {W}_{i}/{L}_{i}$ .
6.3-4. Draw a schematic of the op amp similar to Fig. 6.3-1 but using p-channel input devices. Assuming that same bias currents flow in each circuit, list all characteristics of these two circuits that might be different and tell which is better or worse than the other and by what amount (if possible).
6.3-5. Use the op amp designed in Example 6.3-1 and assume that the input transistors M1 and M2 have their bulks connected to -2.5 V. How will this influence the performance of the op amp designed in Example 6.3-1? Use the $W/L$ values of Example 6.3-1 for this problem. Wherever the performance is changed, calculate the new value of performance and compare with the old.
6.3-6. Repeat Example 6.3-1 for a p-channel input, two-stage op amp. Choose the same currents for the first stage and second stage as in Example 6.3-1.
6.3-7. For the p-channel input, CMOS op amp of Fig. P6.3-7, calculate the open-loop, low-frequency differential gain; the output resistance; the power consumption; the power-supply rejection ratio at $\mathrm{{dc}}$ ; the input common-mode range; the output-voltage swing; the slew rate; and the unity-gain bandwidth for a load capacitance of ${20}\mathrm{{pF}}$ . Assume the model parameters of Table 3.1-2. Design the $W/L$ ratios of M9 and M10 to give a resistance of $1/{g}_{m6}$ and use the simulation program SPICE to find the phase margin and the 1% settling time for no load and for a ${20}\mathrm{{pF}}$ load.

Figure P6.3-7

Figure P6.3-8
6.3-8. Design the values of $W$ and $L$ for each transistor of the CMOS op amp in Fig. P6.3-8 to achieve a differential voltage gain of 4000. Assume that ${K}_{N}^{\prime } = {110\mu }\mathrm{A}/{\mathrm{V}}^{2},{K}_{P}^{\prime } =$ ${50\mu }\mathrm{A}/{\mathrm{V}}^{2},{V}_{TN} =  - {V}_{TP} = {0.7}\mathrm{\;V}$ , and ${\lambda }_{N} =$ ${\lambda }_{P} = {0.01}{\mathrm{\;V}}^{-1}$ . Also, assume that the minimum device dimension is ${2\mu }\mathrm{m}$ and choose the smallest devices possible. Design ${C}_{c}$ and ${R}_{z}$ to give ${GB} = 1\mathrm{{MHz}}$ and to eliminate the influence of the RHP zero. How much load capacitance should this op amp be capable of driving without suffering a degradation in the phase margin? What is the slew rate of this op amp? Assume ${V}_{DD}$ $=  - {V}_{SS} = {2.5}\mathrm{\;V}$ and ${R}_{B} = {100}\mathrm{k}\Omega$ .
6.3-9. Use the electrical model parameters of the previous problem to design ${W}_{3},{L}_{3},{W}_{4},{L}_{4}$ , ${W}_{5},{L}_{5},{C}_{c}$ , and ${R}_{z}$ of Fig. P6.3-8 if the dc currents are increased by a factor of 2 and if ${W}_{1} = {L}_{1} = {W}_{2} = {L}_{2} = {2\mu }\mathrm{m}$ to obtain a low-frequency, differential voltage gain of 5000 and a ${GB}$ of $1\mathrm{{MHz}}$ . All devices should be in saturation under normal operating conditions and the effect of the RHP should be canceled. How much load capacitance should this op amp be able to drive before suffering a degradation in the phase margin? What is the slew rate of this op amp?
6.3-10. For the op amp shown in Fig. P6.3-10, assume all transistors are operating in the saturation region and find (a) the dc value of ${I}_{5},{I}_{7}$ , and ${I}_{8}$ ,(b) the low-frequency differential voltage gain, ${A}_{vd}\left( 0\right)$ ,(c) the ${GB}$ in $\mathrm{{Hz}}$ ,(d) the negative slew rate,(e) the power dissipation, and (f) the phase margin assuming that the open-loop unity gain is 1 $\mathrm{{MHz}}$ . Assume the parameters of the MOSFETs are given in Table 3.1-2. find the numerical value of the small-signal differential voltage gain ${v}_{\text{out }}/{v}_{\text{in }}$ , output resistance ${R}_{\text{out }}$ , the dominant pole ${p}_{1}$ , the unity-gain bandwidth ${GB}$ , the slew rate ${SR}$ , and the dc power dissipation. ${K}_{N}^{\prime } = {24}$ $\mu \mathrm{A}/{\mathrm{V}}^{2},{K}_{P}^{\prime } = {8\mu }\mathrm{A}/{\mathrm{V}}^{2},{V}_{TN} =  - {V}_{TP} =$ ${0.75}\mathrm{\;V},{\lambda }_{N} = {0.01}{\mathrm{\;V}}^{-1}$ , and ${\lambda }_{P} = {0.02}{\mathrm{\;V}}^{-1}$ .

Figure P6.3-10
6.3-11. A simple CMOS op amp is shown Fig. P6.3-11. Use the following model parameters and

Figure P6.3-11
6.3-12. On a log-log plot with the vertical axis having a range of ${10}^{-3}$ to ${10}^{+3}$ and the horizontal axis having a range of 10 to 1000 $\mu \mathrm{A}$ , plot the low-frequency gain ${A}_{v}\left( 0\right)$ , the unity-gain bandwidth ${GB}$ , the power dissipation ${P}_{\text{diss }}$ , the slew rate ${SR}$ , the output resistance ${R}_{\text{out }}$ , the magnitude of the dominant pole $\left| {p}_{1}\right|$ , and the magnitude of the RHP zero $z$ , all normalized to their respective values at ${I}_{B} = {10\mu }\mathrm{A}$ as a function of ${I}_{B}$ from ${10} - {1000\mu }\mathrm{A}$ for the standard two-stage CMOS op amp. Assume the current in M5 is ${k}_{1}{I}_{B}$ and the output current (in M6) is ${k}_{2}{I}_{B}$ .
6.3-13. Develop the expression similar to Eq. (6.3- 32) for the $W/L$ ratio of $\mathrm{M}6\mathrm{\;B}$ in Fig. P6.3-13 that will cause the RHP zero to cancel the output pole. Repeat Example 6.3-2 using the circuit of Fig. P6.3-13 and the values of the transistors in Example 6.3-1.
6.3-15. A CMOS op amp capable of operating from a 1.5 V power supply is shown in Fig. P6.3- 15. All device lengths are ${1\mu }\mathrm{m}$ and are to operate in the saturation region. Design all of the $W$ values of every transistor of this op amp to meet the following specifications:
<table><tr><td>Slew rate $=$ ${V}_{\text{out }}\left( \max \right)  =$ ${V}_{\text{out }}\left( \min \right)  = {0.75}\mathrm{\;V}$ $\pm  {10}\mathrm{\;V}/\mathrm{{\mu s}}$1.25 V</td></tr><tr><td>${V}_{ic}\left( \min \right)  = 1\mathrm{\;V}{V}_{ic}\left( \max \right)  = 2\mathrm{\;V}\;{GB} = {10}\mathrm{{MHz}}$</td></tr><tr><td>Phase margin $= {60}^{ \circ  }$ when the output pole $= {2GB}$ and the RHP zero $= {10}\mathrm{{GB}}$ . Keep the mirror pole $\geq  {10GB}\left( {{C}_{\mathrm{{ox}}} = {0.5}\mathrm{{fF}}/\mu {\mathrm{m}}^{2}}\right)$ .</td></tr></table>
Your design should meet or exceed these specifications. Ignore bulk effects in this problem and summarize your $W$ values to the nearest micron, the value of ${C}_{c}\left( \mathrm{{pF}}\right)$ , and $I\left( {\mu \mathrm{A}}\right)$ in the following table. Use the following model parameters: ${K}^{\prime }{}_{N} = {24}$ $\mu \mathrm{A}/{\mathrm{V}}^{2},{K}_{P}^{\prime } = {8\mu }\mathrm{A}/{\mathrm{V}}^{2},{V}_{TN} =  - {V}_{TP} =$ ${0.75}\mathrm{\;V},{\lambda }_{N} = {0.01}{\mathrm{\;V}}^{-1}$ , and ${\lambda }_{P} = {0.02}{\mathrm{\;V}}^{-1}$ .
<table><tr><td>${C}_{c}$</td><td>$I$</td><td>$\mathrm{W}1 = \mathrm{W}2$</td><td>W3=W4</td><td>W5=W8</td><td>W6</td><td>W7</td><td>W9=W10</td><td>W11=W12</td><td>${P}_{\text{diss }}$</td></tr></table>

Figure P6.3-13 Nulling resistor implemented by an MOS diode.
6.3-14. Use the intuitive approach presented in Section 5.2 to calculate the small-signal differential voltage gain of the two-stage op amp of Fig. 6.3-1.

Figure P6.3-15
6.3-16. The CMOS op amp shown in Fig. P6.3-16 was designed, fabricated, and tested. It worked satisfactorily except that when the op amp was used in a unity-gain configuration, the positive peak of a $\pm  {1.5}\mathrm{\;V}$ sinusoid oscillated as illustrated. What caused this oscillation and how can it be fixed? Assume that the electrical parameters of this op amp are ${V}_{TN} =  - {V}_{TP} =$ ${0.7}\mathrm{\;V},{K}_{N}^{\prime } = {28\mu }\mathrm{A}/{\mathrm{V}}^{2},{K}_{P}^{\prime } = {8\mu }\mathrm{A}/{\mathrm{V}}^{2},{\lambda }_{N} =$ ${\lambda }_{P} = {0.01}{\mathrm{\;V}}^{-1},{\gamma }_{N} = {0.35}{\mathrm{\;V}}^{1/2},{\gamma }_{N} = {0.9}{\mathrm{\;V}}^{1/2}$ , and $2\left| {\phi }_{F}\right|  = {0.5}\mathrm{\;V}$ .

Figure P6.3-16
## 6.3-17. (Design problem-this problem is self- grading.)
The operational transconductance amplifier (OTA) shown in Fig. P6.3-17 is powered from $\pm  {2.5}\mathrm{\;V}$ power supplies. You are to perform a design of an OTA using only MOSFETs to best meet the following specifications using the model parameters in Table 3.1-2. Let all channel lengths be ${1\mu }\mathrm{m}$ and keep the values of $W$ between ${1\mu }\mathrm{m}$ and ${100\mu }\mathrm{m}$ .
1. The differential voltage gain: ${A}_{vd} \geq  {80}\mathrm{\;{dB}}$
2. Output voltage swing range: OVSR = $\left| {{V}_{o}\left( \max \right) }\right|  + \left| {{V}_{o}\left( \min \right) }\right|  \geq  {4.5}\mathrm{\;V}$ .
The OVSR is determined by the maximum and minimum output voltages for which ${50\mu }\mathrm{A}$ can be sourced or sunk into a load.
3. Slew rate: ${SR} \geq  {10}\mathrm{\;V}/\mu \mathrm{S}$ into ${10}\mathrm{{pF}}$
4. Differential input resistance: ${R}_{id} \geq  1\mathrm{M}\Omega$
5. Input common mode range: $\operatorname{ICMR} \geq  3\mathrm{\;V}$ . Please note that input ICMR is measured by sweeping the input common mode voltage and monitoring both the output voltage and input stage current (see Fig. 6.6-17).
6. The common mode rejection ratio: CMRR $\geq  {60}\mathrm{\;{dB}}$
7. Gain bandwidth: ${GB} \geq  {25}\mathrm{{MHz}}$ with a ${10}\mathrm{{pF}}$ load capacitance
8. Phase margin: $\phi \left( {GB}\right)  \geq  {60}^{ \circ  }$ with a 10 pF load capacitance
9. Power dissipation: ${P}_{\text{diss }} \leq  1\mathrm{\;{mW}}$
When you have completed your design and have made hand calculations to support your performance expectations, use the SPICE models on the following pages and verify your design using SPICE. Use the simplest models possible although you must include all capacitances. Use the following approximations to estimate the size of the D/S areas and perimeters.
$$
{AD} = {AS} = \left( {W \times  {10\mu }\mathrm{m}}\right)
$$
$$
{PS} = {PS} = {2W} + {20\mu }\mathrm{m}
$$
Please fill out the table on p. 348 to be included in your problem submission.
The score on this design problem will be as follows:
$$
\text{ Score } = \min \left\lbrack  {5,5\left( \frac{{A}_{vd}}{{10}^{4}}\right) }\right\rbrack   + \min \left\lbrack  {5,5\left( \frac{\text{ OVRS }}{4.5}\right) }\right\rbrack
$$
$$
+ \min \left\lbrack  {5,5\left( \frac{SR}{{10}\mathrm{\;V}/\mathrm{{\mu s}}}\right) }\right\rbrack   + \min \left\lbrack  {5,5\left( \frac{{R}_{id}}{1\mathrm{M}\Omega }\right) }\right\rbrack
$$
$$
+ \min \left\lbrack  {5,5\left( \frac{\mathrm{{ICMR}}}{3\mathrm{\;V}}\right) }\right\rbrack   + \min \left\lbrack  {5,5\left( \frac{\mathrm{{CMRR}}}{{10}^{3}}\right) }\right\rbrack
$$
$$
+ \min \left\lbrack  {5,5\left( \frac{GB}{{25}\mathrm{{MHz}}}\right) }\right\rbrack   + \min \left\lbrack  {5,5\left( \frac{\phi \left( {GB}\right) }{{60}^{ \circ  }}\right) }\right\rbrack
$$
$$
+ \min \left\lbrack  {5,5\left( \frac{1\mathrm{{mW}}}{{P}_{\text{diss }}}\right) }\right\rbrack   + \min \left\lbrack  {5,\text{ Simplicity factor }}\right\rbrack
$$
<table><tr><td/><td>${A}_{vd}$</td><td>OVSR</td><td>${SR}$</td><td>${R}_{id}$</td><td>ICMR</td><td>CMRR</td><td>${GB}$</td><td>$\phi \left( {GB}\right)$</td><td>${P}_{\text{diss }}$</td></tr><tr><td>Hand Values</td><td/><td/><td/><td/><td/><td/><td/><td/><td/></tr><tr><td>SPICE Values</td><td/><td/><td/><td/><td/><td/><td/><td/><td/></tr></table>
You are responsible for verifying your score via the correct SPICE analysis. Evaluate your own score providing sufficient detail to verify your assessment of your grade. The simplicity factor is based on your ability to keep the design straightforward and simple $(1 =$ complex design and $5 =$ simple design). This project is simply an exercise in learning design; do not spend more time on it than can be justified!

Figure P6.3-17
6.4-1. Sketch the asymptotic frequency response of ${\mathrm{{PSRR}}}^{ + }$ and ${\mathrm{{PSRR}}}^{ - }$ of the two-stage op amp designed in Example 6.3-1.
6.4-2. Find the low-frequency PSRR and all roots of the positive and negative power-supply rejection ratio performance for the two-stage op amp of Fig. P6.3-10.
6.4-3. Qualitatively compare the ${\mathrm{{PSRR}}}^{ + }$ of Fig. 6.4-2(a) with Fig. P6.4-3. Which has the best (highest) ${\mathrm{{PSRR}}}^{ + }$ and why?

Figure P6.4-3
6.4-4. In Fig. P6.4-4, find ${v}_{\text{out }}/{v}_{\text{ground }}$ and identify the low-frequency gain and the roots. This represents the case where a noisy ac ground can influence the noise performance of the two-stage op amp.
6.5-1. Assume that in Fig. 6.5-1(a) the currents in $\mathrm{M}1$ and $\mathrm{M}2$ are ${50\mu }\mathrm{A}$ and the $W/L$ values of the NMOS transistors are 10 and of the PMOS transistors are 5 . What is the value of ${V}_{\text{BIAS }}$ that will cause the drain-source voltage of M1 and M2 to be equal to ${V}_{ds}$ (sat)? Design the value of $R$ to keep the source-drain voltage of M3 and M4 equal to ${V}_{sd}$ (sat). Find an expression for the small-signal voltage gain of ${v}_{o1}/{v}_{\text{in }}$ for Fig. 6.5-1(a).

Figure P6.4-4
6.5-2. If the $W/L$ values of $\mathrm{M}1,\mathrm{\;M}2,\mathrm{{MC}}1$ , and MC2 in Fig. 6.5-1(b) are 10 and the currents in M1 and M2 are ${50\mu }\mathrm{A}$ , find the $W/L$ values of MB1 through MB5 that will cause the drain-source voltage of M1 and M2 to be equal to ${V}_{ds}$ (sat). Assume that $\mathrm{{MB}}3 = \mathrm{{MB}}4$ and the current through MB5 is ${5\mu }\mathrm{A}$ . What will be the current flowing through M5?
6.5-3. Use intuitive analysis methods to find the resistance looking into the sources of MC1 and MC2 of Fig. 6.4-1(a) assuming (a) the output is open-circuited and (b) the output is short-circuited.
6.5-4. Repeat Example 6.5-1 to find new values of ${W}_{1}$ and ${W}_{2}$ that will give a voltage gain of 10,000 .
6.5-5. Find the differential voltage gain of Fig. 6.5-1(a) where the output is taken at the drains of MC2 and $\mathrm{{MC}}4,{W}_{1}/{L}_{1} = {W}_{2}/{L}_{2} = {10\mu }\mathrm{m}/{1\mu }\mathrm{m}$ , ${W}_{\mathrm{C}1}/{L}_{\mathrm{C}1} = {W}_{\mathrm{C}2}/{L}_{\mathrm{C}2} = {W}_{\mathrm{C}3}/{L}_{\mathrm{C}3} = {W}_{\mathrm{C}4}/{L}_{\mathrm{C}4} =$ ${1\mu }\mathrm{m}/{1\mu }\mathrm{m},{W}_{3}/{L}_{3} = {W}_{4}/{L}_{4} = {1\mu }\mathrm{m}/{1\mu }\mathrm{m}$ , and ${I}_{5} = {100\mu }\mathrm{A}$ . Use the model parameters of Table 3.1-2. Ignore the bulk effects.
6.5-6. Discuss the influence that the pole at the gate of M6 in Fig. 6.5-2 will have on the Miller compensation of this op amp. Sketch an approximate root-locus plot as ${C}_{c}$ is varied from zero to the value used for compensation.
6.5-7. Assume that ${g}_{mN} = 2{g}_{mP},{r}_{dsN} = 2{r}_{dsP}$ , and $\left| A\right|  = {0.5}{g}_{m}{r}_{ds}$ . Use intuitive analysis methods to find an expression for the resistance and the small-signal differential voltage gain of Fig. 6.5-3. If ${g}_{mN}{r}_{dsP} = {100}\mathrm{\;V}/\mathrm{V}$ , what is an estimate of the voltage gain?
6.5-8. Repeat Example 6.5-2 if ${g}_{mN} = {g}_{mP}$ and ${r}_{dsN}$ $= 2{r}_{dsP}$ .
6.5-9. An internally compensated, cascode op amp is shown in Fig. P6.5-9. (a) Derive an expression for the common-mode input range. (b) Find ${W}_{1}/{L}_{1},{W}_{2}/{L}_{2},{W}_{3}/{L}_{3}$ , and ${W}_{4}/{L}_{4}$ when ${I}_{\text{Bias }}$ is ${80\mu }\mathrm{A}$ and the ICMR is -3.5to ${3.5}\mathrm{\;V}$ . Use ${K}_{N}^{\prime } = {25\mu }\mathrm{A}/{\mathrm{V}}^{2},{K}_{P}^{\prime } =$ ${11\mu }\mathrm{A}/{\mathrm{V}}^{2}$ , and $\left| {V}_{T}\right|  = {0.8} - {1.0}\mathrm{\;V}$ .
6.5-10. Develop an expression for the small-signal differential voltage gain and output resistance of the cascode op amp of Fig. P6.5-9.
6.5-11. If ${g}_{mN} = {g}_{mP}$ and ${r}_{dsN} = 2{r}_{dsP}$ , use intuitive analysis methods to find an expression for the resistance and the small-signal differential voltage gain of Fig. 6.5-6. If ${g}_{mN}{r}_{dsP} = {100}$ $\mathrm{V}/\mathrm{V}$ , what is an estimate of the voltage gain?

Figure P6.5-9
6.5-12. If ${g}_{mN} = {100\mu }\mathrm{S},{g}_{mP} = {50\mu }\mathrm{S},{r}_{dsN} = 2\mathrm{M}\Omega$ , ${r}_{dsN} = 1\mathrm{M}\Omega ,{C}_{gs} = {100}\mathrm{{fF}}$ , and ${C}_{db} = {10}\mathrm{{fF}}$ for all transistors and ${C}_{L} = {10}\mathrm{{pF}}$ , find all poles of the folded-cascode op amp of Fig. 6.5-9(b).
6.5-13. A CMOS op amp that uses a $5\mathrm{\;V}$ power supply is shown in Fig. P6.5-13. All transistor lengths are ${1\mu }\mathrm{m}$ and operate in the saturation region. Design all of the $W$ values of every transistor of this op amp to meet the following specifications:
$$
\text{Slew rate} = \;{V}_{\text{out }}\left( \max \right)  = 4\mathrm{\;V}\;{V}_{\text{out }}\left( \min \right)  = 1\mathrm{\;V}
$$
$$
\pm  {10}\mathrm{\;V}/\mathrm{{\mu s}}
$$
$$
{V}_{ic}\left( \min \right)  = {1.5}\mathrm{\;V}{V}_{ic}\left( \max \right)  = 4\mathrm{\;V}\;{GB} = {10}\mathrm{{MHz}}
$$

Figure P6.5-13
Your design should meet or exceed these specifications. Ignore bulk effects and summarize your $W$ values to the nearest micron, the bias current ${I}_{5}\left( {\mu \mathrm{A}}\right)$ , the power dissipation, the differential voltage gain ${A}_{vd}$ , and ${V}_{BP}$ and ${V}_{BN}$ in the following table:
<table><tr><td>$\mathrm{W}1 = \mathrm{W}2$</td><td>W3 = W4 = $\mathrm{W}6 = \mathrm{W}7 = \mathrm{W}8$</td><td>W9 = W10 $= \mathrm{W}{11}$</td><td>W5</td><td>${I}_{5}\left( {\mu \mathrm{A}}\right)$</td><td>${A}_{vd}$</td><td>${V}_{BP}$</td><td>${V}_{BN}$</td><td>${P}_{\text{diss }}$</td></tr></table>
6.5-14. Repeat Example 6.5-4 if the differential input pair consists of PMOS transistors (i.e., all NMOS transistors become PMOS and all PMOS transistors become NMOS and the power supplies are reversed).
6.5-15. This problem deals with the op amp shown in Fig. P6.5-15. All device lengths are ${1\mu }\mathrm{m}$ , the slew rate is $\pm  {10}\mathrm{\;V}/\mu \mathrm{s}$ , the ${GB}$ is 10 $\mathrm{{MHz}}$ , the maximum output voltage is $+ 2\mathrm{\;V}$ , the minimum output voltage is $- 2\mathrm{\;V}$ , and the input common-mode range is from -1 to $+ 2\mathrm{\;V}$ . Design all $W$ values of all transistors in this op amp. Your design must meet or exceed the specifications. When calculating the maximum or minimum output voltages, divide the voltage drop across series transistors equally. Ignore bulk effects in this problem. When you have completed your design, find the value of the small-signal differential voltage gain, ${A}_{vd} = {v}_{\text{out }}/{v}_{id}$ , where ${v}_{id} = {v}_{1} - {v}_{2}$ and the small-signal output resistance, ${R}_{\text{out }}$ .
6.5-16. The small-signal resistances looking into the sources of M6 and M7 of Fig. P6.5-15 will be different based on what we learned for the cascode amplifier of Chapter 5. Assume that the capacitances from each of these nodes (sources of M6 and M7) are identical and determine the influence of these poles on the small-signal differential frequency response.
6.5-17. Repeat Example 6.5-5 if ${g}_{mN} = {100\mu }\mathrm{S},{g}_{mP}$ $= {25\mu }\mathrm{S},{r}_{dsN} = 2\mathrm{M}\Omega$ , and ${r}_{dsP} = {0.5}\mathrm{M}\Omega$ .
6.5-18. Use small-signal analysis methods to check the validity of Eqs. (6.5-28) and (6.5-29).
6.6-1. How large could the offset voltage in Fig. 6.6-1 be before this method of measuring the open-loop response would be useless if the open-loop gain is ${5000}\mathrm{\;V}/\mathrm{V}$ and the power supplies are $\pm  {2.5}\mathrm{\;V}$ ?
6.6-2. Develop the closed-loop frequency response for Fig. 6.6-2(a), thereby verifying the asymptotic magnitude response of Fig. 6.6-2(b). Sketch the closed-loop frequency response of the magnitude of Fig. 6.6-2(a) if the low-frequency gain is 4000 $\mathrm{V}/\mathrm{V}$ , the ${GB} = 1\mathrm{{MHz}}, R = {10}\mathrm{M}\Omega$ , and $C = {10\mu }\mathrm{F}$ .
6.6-3. Show how to modify Fig. 6.6-6 in order to measure the open-loop frequency response of the op amp under test and describe the procedure to be followed.

Figure P6.5-15
6.6-4. Verify the relationships given in Eqs. (6.6- 1) and (6.6-2).
6.6-5. Sketch a circuit configuration suitable for simulating the following op amp characteristics: (a) slew rate, (b) transient response, (c) ICMR, and (d) output-voltage swing. Repeat for the measurement of the above op amp characteristics. What changes are made and why?
6.6-6. Using two identical op amps, show how to use SPICE to obtain a voltage that is proportional to CMRR rather than the inverse relationship given in Section 6.6.
6.6-7. Repeat Problem 6.6-6 for PSRR.
6.6-8. Show how to use Fig. 6.6-6 to measure the open-loop gain of an op amp. Analyze this circuit to prove that it will indeed measure the open-loop gain of the op amp under test.
6.6-9. Use SPICE to simulate the op amp of Example 6.5-4. The differential frequency response, power dissipation, phase margin, input common-mode range, output-voltage range, slew rate, and settling time are to be simulated with a load capacitance of ${20}\mathrm{{pF}}$ . Use the model parameters of Table 3.1-2.
6.6-10. Figure P6.6-10 shows a possible scheme for simulating the CMRR of an op amp. Find the value of ${V}_{\text{out }}/{V}_{cm}$ and show that it is approximately equal to $1/\mathrm{{CMRR}}$ . What problems might result in an implementation of this circuit?

Figure P6.6-10
6.6-11. Explain why the positive overshoot of the simulated positive step response of the op amp shown in Fig. 6.6-20(b) is smaller than the negative overshoot for the negative step response. Use the op amp values given in Example 6.3-1 and the information given in Tables 6.6-1 and 6.6-3.
## References
1. H. J. Carlin, "Singular Network Elements," IEEE Trans. Circuit Theory, Vol. CT-11, pp. 66-72, Mar. 1964.
2. A. S. Sedra and K. C. Smith, Microelectronic Circuits, 3rd ed. New York: Oxford University Press, 1991.
3. Y. P. Tsividis and P. R. Gray, "An Integrated NMOS Operational Amplifier with Internal Compensation," IEEE J. Solid-State Circuits, Vol. SC-11, No. 6, pp. 748-753, Dec. 1976.
4. W. J. Parrish, "An Ion Implanted CMOS Amplifier for High Performance Active Fitters," Ph.D. Dissertation, University of California, Santa Barbara, 1976.
5. B. K. Ahuja, "An Improved Frequency Compensation Technique for CMOS Operational Amplifiers," IEEE J. Solid-State Circuits, Vol. SC-18, No. 6, pp. 629-633, Dec. 1983.
6. W. C. Black, D. J. Allstot, and R. A. Reed, "A High Performance Low Power CMOS Channel Filter," IEEE J. Solid-State Circuits, Vol. SC-15, No. 6, pp. 929-938, Dec. 1980.
7. M. C. Jeng, "Design and Modeling of Deep-Submicrometer MOSFETs," ERL Memorandum ERL M90/90, University of California, Berkeley, 1990.
8. Y. Cheng and C. Hu, MOSFET Modeling & BSIM3 User's Guide. Norwell, MA: Kluwer Academic Publishers, 1999.
9. D. K. Su, M. J. Loinaz, S. Masui, and B. A. Wooley, "Experimental Results and Modeling Techniques for Substrate Noise in Mixed-Signal IC's," J. Solid-State Circuits, Vol. 28, No. 4, pp. 420-430, Apr. 1993.
10. K. M. Fukuda, T. Anbo, T. Tsukada, T. Matsuura, and M. Hotta, "Voltage-Comparator-Based Measurement of Equivalently Sampled Substrate Noise Waveforms in Mixed-Signal ICs," J. Solid-State Circuits, Vol. 31, No. 5, pp. 726-731, May 1996.
11. Alan Hastings, The Art of Analog Layout. Upper Saddle River, NJ: Prentice-Hall, Inc., 2001.
12. D. B. Ribner and M. A. Copeland, "Design Techniques for Cascode CMOS Op Amps with Improved PSRR and Common-Mode Input Range," IEEE J. Solid-State Circuits, Vol. SC-19, No. 6, pp. 919-925, Dec. 1984.
13. S. Masuda, Y. Kitamura, S. Ohya, and M. Kikuchi, "CMOS Sampled Differential, Push-Pull Cascode Operational Amplifier," Proceedings of the 1984 International Conference on Circuits and Systems, Montreal, Canada, May 1984, pp. 1211-1214.
14. G. G. Miller, "Test Procedures for Operational Amplifiers," Application Note 508, Harris Linear & Data Acquisition Products, 1977. Harris Semiconductor Corporation, Box 883, Melbourne, FL 32901.
15. W. G. Jung, IC Op Amp Cookbook. Indianapolis, IN: Howard W. Sams, 1974.
16. J. G. Graeme, G. E. Tobey, and L. P. Huelsman, Operational Amplifiers-Design and Applications. New York: McGraw-Hill, 1974.
17. W. M. C. Sansen, M. Steyaert, and P. J. V. Vandeloo, "Measurement of Operational Amplifier Characteristics in the Frequency Domain," IEEE Trans. Instrum. Meas., Vol. IM-34, No. 1, pp. 59-64, Mar. 1985.
CHAPTER 7
# High-Performance CMOS Op Amps
$\mathrm{n}$ the previous chapter we introduced the analysis and design of general unbuffered CMOS op amps with an eye to developing the principles associated with the design of CMOS op amps. However, in many applications the performance of the unbuffered CMOS op amp is not sufficient. In this chapter, CMOS op amps with improved performance will be considered. These op amps should be capable of meeting the specifications of most designs.
Typically, the areas where increased performance is desired include lower output resistance, larger output-signal swing, increased slew rate, increased gain bandwidth, lower noise, lower power dissipation, and/or lower input-offset voltage. Of course, not all of these characteristics will be obtained at the same time. In many cases, simply including the buffer of Fig. 7.1-1 will achieve the desired performance. We shall examine several types of buffers that can be used to increase the capabilities of the unbuffered CMOS op amp.
The first topic of this chapter deals with the reduction of the output resistance of the op amp in order to drive resistive loads. Such op amps are called buffered op amps. The first approach uses a MOSFET in the source-follower configuration to achieve lower output resistance. As we know, the lowest output resistance without using negative feedback is $1/{g}_{m}$ . The second approach uses negative feedback to achieve output resistances in the range of ${10\Omega }$ . Unfortunately, there are two problems that occur that must be addressed. One is the addition of a third stage and the implication on compensation. The second is the control of the bias current in the output stage. A third approach to implementing buffered op amps is to use the BJT as a source follower. This will give output resistances in the range of ${50\Omega }$ but has the disadvantage of asymmetry because both NPN and PNP BJTs are not simultaneously available.
The second topic of this chapter focuses on extending the frequency performance of the op amp. The fundamental frequency limit of the two-stage op amp is first presented. This limit is the ratio of the transconductance that converts the input voltage to current to the capacitor that determines the dominant pole. It is shown how to optimize the frequency performance of the various types of op amps. A second approach uses what is called switched op amps. This approach replaces the biasing circuitry with charged capacitors, which reduces the normal parasitics and increases the frequency performance of the op amp. However, this approach is still constrained by the fundamental frequency limit. It turns out that amplifiers that use current feedback are not constrained by the fundamental limit of ${g}_{m}/C$ . The third approach deals with op amps that use current feedback. An op amp design is shown that has a ${GB}$ well over ${500}\mathrm{{MHz}}$ . A fourth approach uses parallel path op amps. This approach combines a high-gain, low-frequency path with a low-gain, high-frequency path to achieve large bandwidths.
The next topic is that of differential-output op amps. This section is a reminder to the reader of the importance of differential signal processing in the practical implementation of these op amps. It is shown how to achieve differential outputs and to solve the resulting problems of compensation and common-mode output voltage stabilization. This topic is followed by low-power op amps. The transistors in these op amps typically work in the subthreshold region. While the power dissipation in micropower op amps is extremely small, the output currents are small unless special techniques are used. Several ways to boost the output current are shown. These methods use positive feedback with loop gain less than unity and are also applicable to any op amp that requires large output currents.
The next section deals with the topic of low-noise op amps. This is particularly important in CMOS op amps because of the $1/f$ noise. The principles by which the noise can be minimized are illustrated with several examples. The use of lateral BJTs results in a low-noise CMOS op amp that is as good as the best discrete low-noise op amps. The use of chopper stabilization to achieve low noise and low offset voltage is also illustrated in this section.
The last section discusses op amps that can work at low-voltage supplies. Of course, the op amps working in subthreshold are capable of operating at low power-supply voltages but do not have the frequency capability because of the small currents. The implications of low power-supply voltages on op amp design are discussed followed by methods of designing the input stage, biasing stages, and gain stages at small power-supply voltages. Two examples of an op amp that can work with a power-supply voltage of $2\mathrm{\;V}$ and $1\mathrm{\;V}$ are presented.
The topics of this chapter illustrate the method of optimizing one or more performance specifications at the expense of others to achieve a high performance in a given area. They serve as a reminder that the design of a complex circuit such as an op amp is by no means unique and that the designer has many degrees of freedom as well as a choice of different circuit architectures that can be used to enhance performance for a given application.

### 7.1 Buffered Op Amps
The op amps of the previous chapter all had a high output impedance and were classified as unbuffered op amps. While these op amps could drive a moderate load capacitance, they were not able to drive low-resistance output loads. In this section, we shall examine methods of improving the ability to drive both large load capacitances and small load resistances. Our goal will be to accomplish these objectives without significantly increasing the power dissipation in the op amp. The op amps of this section have the capability to drive high-capacitive/ low-resistive output loads.
## Buffered Op Amps Using MOSFETs
Without using negative feedback, the lowest output resistance available using MOSFETs is approximately $1/{g}_{m}$ . An op amp that achieves this output resistance for sinking and sourcing is shown in Fig. 7.1-1. This op amp uses a push-pull source-follower output stage that achieves a low output resistance. This op amp is capable of high-frequency and high-slew-rate performance [1]. The output buffer consists of transistors M17 through M22. The unbuffered op amp is essentially a cascade of a differential-transconductance input stage and a current-amplifier second stage. The voltage gain is achieved by the high-resistance node at the drains of M10 and M15. The frequency response of the unbuffered amplifier is good because all nodes are low impedance except for the above node. ${C}_{c}$ is used to compensate the amplifier by introducing a dominant pole. The output stage is used to buffer the load and provide a low output resistance. If the output is biased Class AB, the small-signal output resistance is
$$
{r}_{\text{out }} \approx  \frac{1}{{g}_{m21} + {g}_{m22}} \tag{7.1-1}
$$

Figure 7.1-1 Low output resistance CMOS operational amplifier suitable for driving resistive and capacitive loads.
Depending on the size of the output devices and their bias currents, the output resistance can be less than ${1000\Omega }$ .
The transistors M17 and M20 actively bias M18 and M19, which are complementary to M22 and M21, respectively. Ideally, the gate voltages of M18 and M22 and M19 and M21 compensate each other and therefore the output voltage is zero for a zero voltage input. The bias current flowing in M21 and M22 can be controlled through a gate-source loop consisting of M18, M22, M21, and M19. The measured no-load low-frequency gain was about ${65}\mathrm{\;{dB}}$ for ${I}_{\mathrm{{BIAS}}} = {50\mu }\mathrm{A}$ and the measured unity-gain bandwidth was about ${60}\mathrm{{MHz}}$ for ${C}_{L}$ of $1\mathrm{{pF}}$ . Although the slew rate with a load capacitance was not measured, it should be large because the output devices can continue to turn on to provide the current necessary to enable the source to "follow" the gate. The influence of the bulk-source voltages on M21 and M22 will make it impossible to pull the output voltage close to ${V}_{DD}$ or ${V}_{SS}$ and still provide a large output current. A large capacitive load will introduce poles into the output stage, eventually deteriorating the stability of the closed-loop configuration.
Another approach that can provide large amounts of power into a small load resistance is shown in Fig. 7.1-2. This op amp is capable of delivering ${160}\mathrm{\;{mW}}$ of power to a ${100\Omega }$ load while only dissipating $7\mathrm{{mW}}$ of quiescent power [2]. This amplifier consists of three stages. The first stage is the differential amplifier of Fig. 5.2-5. The output driver consists of a crossover stage and an output stage. The two inverters consisting of M1, M3 and M2, M4 are the crossover stage. The purpose of this stage is to provide gain, compensation, and drive to the two output transistors, M5 and M6. The output stage is a transconductance amplifier designed to have a gain of unity when loaded with a specified load resistance.

Figure 7.1-2 A CMOS op amp with low-impedance drive capability.
The dc transfer function of the two inverters is qualitatively shown in Fig. 7.1-3. The two voltage-transfer characteristics represent the inverters M1, M3 and M2, M4 and are the drive voltages to the output devices, M5 and M6, respectively. The crossover voltage is defined as
$$
{V}_{C} = {V}_{B} - {V}_{A} \tag{7.1-2}
$$
where ${V}_{B}$ and ${V}_{A}$ are the input voltages to the inverters that result in cutting off M5 and M6, respectively. ${V}_{C}$ must be close to zero for low quiescent power dissipation but not too small to prevent unacceptable crossover distortion. In order to prevent a "glitch" in the output waveform during slewing, ${V}_{C}$ should be designed carefully. An approach that yields satisfactory crossover distortion and ensures that ${V}_{C} \geq  0$ is to ratio the inverters so that the drives to the output stage are matched. Thus, ${V}_{C}$ is designed to be small and positive by proper ratioing of M2 to M4 and M1 to M3. Worst-case variations of a typical process result in a maximum ${V}_{C}$ of less than ${110}\mathrm{{mV}}$ and greater than zero.
The use of an output buffer to permit an unbuffered op amp to drive large capacitors or low resistances requires reconsideration of the compensation. Figure 7.1-4 shows the general form of the buffered op amp. The unbuffered op amp with no compensation generally has two poles, ${p}_{1}^{\prime }$ and ${p}_{2}^{\prime }$ . The buffer will introduce another pole, ${p}_{3}^{\prime }$ . With no compensation, the open-loop voltage gain of the op amp is given as
$$
\frac{{V}_{\text{out }}\left( s\right) }{{\mathrm{V}}_{\text{in }}\left( s\right) } = \frac{-{A}_{vo}}{\left( {\frac{s}{{p}_{-1}^{\prime }} - 1}\right) \left( {\frac{s}{{p}_{-2}^{\prime }} - 1}\right) \left( {\frac{s}{{p}_{-3}^{\prime }} - 1}\right) } \tag{7.1-3}
$$

Figure 7.1-3 Idealized voltage-transfer characteristic of the crossover inverters.

Figure 7.1-4 Source of uncompensated poles in a buffered op amp.
where ${p}_{1}^{\prime }$ and ${p}_{2}^{\prime }$ are the uncompensated poles of the unbuffered op amp and ${p}_{3}^{\prime }$ is the pole due to the output stage. We shall assume that $\left| {p}_{1}^{\prime }\right|  < \left| {p}_{2}^{\prime }\right|  < \left| {p}_{3}^{\prime }\right|$ . It should also be noted that $\left| {p}_{3}^{\prime }\right|$ will decrease as ${C}_{L}$ or ${R}_{L}$ is increased. If Miller compensation is applied around the second and third stages, the new poles shown by squares in Fig. 7.1-5(a) result. This method has a potential problem in that the locus of the roots of ${p}_{2}^{\prime }$ and ${p}_{3}^{\prime }$ as ${C}_{c}$ is increased bend toward the ${j\omega }$ axis and can lead to poor phase margin.
If the Miller compensation is applied around the second stage, then the closed-loop roots of Fig. 7.1-5(b) occur. The bending locus is no longer present. However, the output pole, ${p}_{3}^{\prime }$ , has not moved to the left on the negative real axis as was the case in Fig. 7.1-5(a). Which approach one chooses depends on the anticipated output loading and the desired phase margin. The nulling technique can be used to control the zero as was done for the two-stage op amp.
The compensation of the amplifier in Fig. 7.1-2 uses the method depicted in Fig. 7.1-5(b). However, since the output stage is working in Class B operation, two compensation capacitors are required, one for the M1, M3 inverter and one for the M2, M4 inverter. The advantage of this configuration is that the output loading does not cause ${p}_{2}$ to move back to the origin. Of course, ${p}_{3}$ must be above ${p}_{2}$ in order for this compensation scheme to work successfully. For low values of ${R}_{L}$ this requirement will be satisfied. As ${R}_{L}$ is increased, the unity-gain frequency of the output stage becomes larger and ${p}_{3}$ will move on the negative real axis away from the origin. Thus, the amplifier is conditionally stable with respect to the output resistive loading.

Figure 7.1-5 Root locus of the poles of the op amp with Miller compensation applied (a) around both the second and third stages or (b) around the second stage only.
Table 7.1-1 Performance Results for the CMOS Op Amp of Fig. 7.1-2
<table><tr><td>Specification</td><td>Performance</td></tr><tr><td>Supply voltage</td><td>$\pm  6\mathrm{\;V}$</td></tr><tr><td>Quiescent power</td><td>7 mW</td></tr><tr><td>Output swing (100 $\Omega$ load)</td><td>8.1 Vpp</td></tr><tr><td>Open-loop gain (100 $\Omega$ load)</td><td>${78.1}\mathrm{\;{dB}}$</td></tr><tr><td>Unity-gain bandwidth</td><td>${260}\mathrm{{kHz}}$</td></tr><tr><td>Voltage spectral noise density at $1\mathrm{{kHz}}$</td><td>${1.7\mu }\mathrm{V}/\mathrm{{VHz}}$</td></tr><tr><td>PSRR at $1\mathrm{{kHz}}$</td><td>55 dB</td></tr><tr><td>CMRR at $1\mathrm{{kHz}}$</td><td>42 dB</td></tr><tr><td>Input-offset voltage (typical)</td><td>10 mV</td></tr></table>
The CMOS op amp of Fig. 7.1-2 was fabricated in a standard CMOS process using minimum gate lengths of ${5.5\mu }\mathrm{m}$ and ${7.5\mu }\mathrm{m}$ for the NMOS and PMOS devices, respectively. The results are shown in Table 7.1-1. The amplifier dissipated only $7\mathrm{{mW}}$ of quiescent power and was capable of providing ${160}\mathrm{\;{mW}}$ of peak output power.
To obtain a lower output resistance than that of Fig. 7.1-1, it is necessary to use shunt negative feedback. The concept that will be used was shown in Fig. 5.5-11. The simplified schematic of a buffered CMOS op amp using an MOS output stage with shunt negative feedback is shown in Fig. 7.1-6 [3]. This example consists of the combination of an unbuffered op amp and a negative-feedback output stage. If M8 is replaced by a short and M8A through M13 are ignored, the output stage is essentially that of Fig. 5.5-11. The output of the unbuffered op amp drives the inverter (M16, M17), which in turn drives the negative terminal of the error amplifiers, which in turn drive the output devices, M6 and M6A. In most cases, the unbuffered op amp is simply a transconductance differential amplifier and M16 and M17 form the second-stage inverter with the capacitor ${C}_{c}$ serving as the Miller compensation of the first two stages of the op amp. The amplifier A1 and transistor M6 form the unity-gain amplifier for the positive half of the output-voltage swing. Similarly, the amplifier A2 and transistor M6A form the unity-gain amplifier for the negative half of the output-voltage swing. Since the output amplifier is operating in a Class AB mode, the operation of the negative half-swing circuit is an inverted mirror image of the positive half-swing circuit. Components performing similar functions in each circuit are designated by the additional subscript $\mathrm{A}$ for the negative half of the output swing.

Figure 7.1-6 Simplified schematic of the low output resistance buffered op amp.
Figure 7.1-7 shows the circuit of the amplifier A1. It is seen that this is simply a two-stage op amp with the current-sink load of the second-stage inverter provided by the output stage of amplifier A2. The current in the output driver, M6, is typically controlled by the current mirror developed in the differential amplifier of the positive unity-gain amplifier and matches the current set in the negative-output driver device M6A by the negative unity-gain amplifier. However, if an offset occurs between amplifiers $\mathrm{A}1$ and $\mathrm{A}2\left( {V}_{OS}\right.$ in Fig. 7.1-6), then the current balance between the output drivers M6 and M6A no longer exists and the current flow through these devices is uncontrolled. The feedback loop consisting of transistors M8, $\mathrm{M}9,\mathrm{M}{10},\mathrm{M}{11},\mathrm{M}{12}$ , and $\mathrm{M}8\mathrm{\;A}$ stabilizes the current in $\mathrm{M}6$ and $\mathrm{M}6\mathrm{\;A}$ if an offset voltage ${V}_{OS}$ occurs between A1 and A2. The feedback loop operates as follows. Assume that an offset voltage exists as shown in Fig. 7.1-6. An increase in offset voltage causes the output of A1 to rise, causing the current in M6 and M9 to decrease. The decrease of current through M9 is mirrored into a current decrease through M8A. The decrease of current in M8A causes a decrease in the gate-source voltage of M8A, which balances out the increase in offset voltage in the error loop consisting of $\mathrm{M}8,{V}_{OS}$ , and $\mathrm{M}8\mathrm{\;A}$ . In this manner, the currents in $\mathrm{M}6$ and M6A can be balanced.
Because the output-stage current feedback is not unity gain, some current variation in transistors M6 and M6A occurs. Offsets between amplifiers A1 and A2 can produce a 2:1 variation in dc current over temperature and process variations. This change in output current $\Delta {I}_{O}$ can be predicted by assuming that ${v}_{\mathrm{{OUT}}}$ is at ground and any offset between amplifiers A1 and A2 can be reflected as a difference between the inputs of A1. The result is given as
$$
\Delta {I}_{O} =  - {g}_{{m6}\mathrm{\;A}}{A}_{2}\left( {{V}_{OS} - {\left( \frac{2{\beta }_{9}{\beta }_{12}}{{\beta }_{8\mathrm{\;A}}{\beta }_{6}{\beta }_{11}}\right) }^{1/2}\left\{  {\left\lbrack  {I}_{B1}\left( \frac{{\beta }_{6}{\beta }_{11}}{{\beta }_{9}{\beta }_{12}} + \frac{{\beta }_{5}{\beta }_{6}}{2{\beta }_{7}{\beta }_{3}}\right)  + \Delta {I}_{O}\right\rbrack  }^{1/2}\right. }\right.
$$
$$
\left. \left. {-{\left\lbrack  {I}_{B1}\left( \frac{{\beta }_{6}{\beta }_{11}}{{\beta }_{9}{\beta }_{12}} + \frac{{\beta }_{5}{\beta }_{6}}{2{\beta }_{7}{\beta }_{3}}\right) \right\rbrack  }^{1/2}}\right\}  \right)  \tag{7.1-4}
$$
where ${I}_{B1} = {I}_{17}$ and $\beta  = {K}^{\prime }\left( {W/L}\right)$ or ${\mu }_{o}{C}_{\text{ox }}\left( {W/L}\right)$ .

Figure 7.1-7 Positive output stage, unity-gain amplifier.
Because transistor M6 can supply large amounts of current, care must be taken to ensure that this transistor is off during the negative half-cycle of the output-voltage swing. For large negative swings, the drain of transistor M5 pulls to ${V}_{SS}$ , turning off the current source that biases the error amplifier A1. As the bias is turned off, the gate of transistor M6 floats and tends to pull toward ${V}_{SS}$ , turning on transistor M6. Figure 7.1-8 shows the complete schematic of the output amplifier of Fig. 7.1-6. This circuit includes the means to ensure that M6 remains off for large negative voltage swings. As transistor M5 turns off, transistors M3H and $\mathrm{M}4\mathrm{H}$ pull up the drains of transistors $\mathrm{M}3$ and $\mathrm{M}4$ , respectively. As a result, transistor $\mathrm{M}6$ is turned off and any floating nodes in the differential amplifier are eliminated. Positive-swing protection is provided for the negative half-cycle circuit by transistors M3HA and M4HA, which operate in a manner similar to that described above for the negative-swing protection circuit. The swing protection circuit will degrade the step response of the power amplifier because the unity-gain amplifier not in operation is completely turned off.
Short-circuit protection is also included in the design of the amplifier. From Fig. 7.1-8, we see that transistor MP3 senses the output current through transistor M6, and in the event of excessively large output currents, the biased inverter formed by transistors MP3 and MN3 trips, thus enabling transistor MP5. Once transistor MP5 is enabled, the gate of transistor M6 is pulled up toward the positive supply ${V}_{DD}$ . Therefore, the current in M6 is limited to approximately ${60}\mathrm{\;{mA}}$ . In a similar manner, transistors MN3A, MP3A, MP4A, MN4A, and MN5A provide short-circuit protection for current sinking.
The op amp of Fig. 7.1-8 is compensated by methods studied in Chapter 6. Each amplifier, $\mathrm{A}1$ and $\mathrm{A}2$ , is individually compensated by the Miller method $\left( {C}_{c1}\right.$ and $\left. {C}_{c2}\right)$ including a nulling resistor (MR1 and MR2). ${C}_{c}$ is used to compensate the second stage as discussed in Section 6.2.
The total amplifier circuit is capable of driving ${300\Omega }$ and ${1000}\mathrm{{pF}}$ to ground. The unity-gain bandwidth is approximately ${0.5}\mathrm{{MHz}}$ and is limited by the ${1000}\mathrm{{pF}}$ load capacitance. The output stage has a bandwidth of approximately $1\mathrm{{MHz}}$ . The performance of this amplifier is summarized in Table 7.1-2. The component sizes of the devices in Fig. 7.1-8 are given in Table 7.1-3.

Figure 7.1-8 Complete schematic of the buffered, low-output resistance op amp using negative shunt feedback.
Table 7.1-2 Performance Characteristics of the Op Amp of Fig. 7.1-8
<table><tr><td>Specification</td><td>Simulated Results</td><td>Measured Results</td></tr><tr><td>Power dissipation</td><td>7.0 mW</td><td>5.0 mW</td></tr><tr><td>Open-loop voltage gain</td><td>82 dB</td><td>83 dB</td></tr><tr><td>Unity-gain bandwidth</td><td>${500}\mathrm{{kHz}}$</td><td>${420}\mathrm{{kHz}}$</td></tr><tr><td>Input-offset voltage</td><td>0.4 mV</td><td>1 mV</td></tr><tr><td>${\mathrm{{PSRR}}}^{ + }\left( 0\right) /{\mathrm{{PSRR}}}^{ - }\left( 0\right)$</td><td>85 dB/104 dB</td><td>86 dB/106 dB</td></tr><tr><td>${\mathrm{{PSRR}}}^{ + }\left( {1\mathrm{{kHz}}}\right) /{\mathrm{{PSRR}}}^{ - }\left( {1\mathrm{{kHz}}}\right)$</td><td>81 dB/98 dB</td><td>80 dB/98 dB</td></tr><tr><td colspan="3">THD $\left( {{V}_{\text{in }} = {3.3}{V}_{\mathrm{{pp}}}}\right)$</td></tr><tr><td>${R}_{L} = {300\Omega }$</td><td>0.03%</td><td>0.13%(1 kHz)</td></tr><tr><td>${C}_{L} = {1000}\mathrm{{pF}}$</td><td>0.08%</td><td>0.32%(4 kHz)</td></tr><tr><td colspan="3">THD $\left( {{V}_{\text{in }} = {4.0}{V}_{\mathrm{{pp}}}}\right)$</td></tr><tr><td>${R}_{L} = {15}\mathrm{k}\Omega$</td><td>0.05%</td><td>0.13%(1 kHz)</td></tr><tr><td>${C}_{L} = {200}\mathrm{{pF}}$</td><td>0.16%</td><td>0.20%(4 kHz)</td></tr><tr><td>Settling time (0.1%)</td><td>${3\mu }\mathrm{s}$</td><td>< 5 μs</td></tr><tr><td>Slew rate</td><td>0.8 V/μs</td><td>0.6 V/μs</td></tr><tr><td>1/F Noise at $1\mathrm{{kHz}}$</td><td>-</td><td>130 nV/VHz</td></tr><tr><td>Broadband noise</td><td>-</td><td>${49}\mathrm{{nV}}/\mathrm{{VHz}}$</td></tr></table>
Figure 7.1-9 shows a simpler method of achieving low output resistance using the above concept of shunt negative feedback. The circuit of Fig. 7.1-9 is simply a unity-gain buffer with the open-loop gain of approximately a single-stage amplifier. Blackman's impedance relationship [4] can be used to express the output resistance of this amplifier as
$$
{R}_{\text{out }} = \frac{{R}_{o}}{1 + {LG}} \tag{7.1-5}
$$
Table 7.1-3 Component Sizes for the Op Amp of Fig. 7.1-8
<table><tr><td>Transistor/Capacitor</td><td>μm/μm or pF</td><td>Transistor/Capacitor</td><td>$\mu \mathrm{m}/\mu \mathrm{m}$ or $\mathrm{{pF}}$</td></tr><tr><td>M16</td><td>184/9</td><td>M8A</td><td>481/6</td></tr><tr><td>M17</td><td>66/12</td><td>$\mathrm{M}{13}$</td><td>66/12</td></tr><tr><td>M8</td><td>184/6</td><td>M9</td><td>27/6</td></tr><tr><td>M1, M2</td><td>36/10</td><td>M10</td><td>6/22</td></tr><tr><td>M3, M4</td><td>194/6</td><td>M11</td><td>14/6</td></tr><tr><td>M3H, M4H</td><td>16/12</td><td>M12</td><td>140/6</td></tr><tr><td>M5</td><td>145/12</td><td>MP3</td><td>8/6</td></tr><tr><td>M6</td><td>2647/6</td><td>MN3</td><td>244/6</td></tr><tr><td>MRC</td><td>48/10</td><td>MP4</td><td>43/12</td></tr><tr><td>${C}_{C}$</td><td>11.0</td><td>MN4</td><td>12/6</td></tr><tr><td>M1A, M2A</td><td>88/12</td><td>MP5</td><td>6/6</td></tr><tr><td>M3A, M4A</td><td>196/6</td><td>MN3A</td><td>6/6</td></tr><tr><td>M3HA, M4HA</td><td>10/12</td><td>MP3A</td><td>337/6</td></tr><tr><td>M5A</td><td>229/12</td><td>MN4A</td><td>24/12</td></tr><tr><td>M6A</td><td>2420/6</td><td>MP4A</td><td>20/12</td></tr><tr><td>${C}_{F}$</td><td>10.0</td><td>MN5A</td><td>6/6</td></tr></table>

Figure 7.1-9 Simple shunt negative-feedback buffer.
where ${R}_{o}$ is the output resistance with the feedback loop open and ${LG}$ is the loop gain of the feedback loop. ${R}_{o}$ is equal to
$$
{R}_{o} = \frac{1}{{g}_{ds6} + {g}_{ds7}} \tag{7.1-6}
$$
By inspection, the loop gain can be written as
$$
\left| {LG}\right|  = \frac{1}{2}\frac{{g}_{m2}}{{g}_{m4}}\left( {{g}_{m6} + {g}_{m8}}\right) {R}_{o} \tag{7.1-7}
$$
Therefore, the output resistance of Fig. 7.1-9 is
$$
{R}_{\text{out }} = \frac{1}{1 + \left( {{g}_{ds6} + {g}_{ds7}}\right) \left\lbrack  {1 + \left( \frac{{g}_{m2}}{{g}_{m4}}\right) \left( {{g}_{m6} + {g}_{m8}}\right) {R}_{o}}\right\rbrack  } \tag{7.1-8}
$$
---
Example 7.1-1
---
Low Output Resistance Using the Simple Shunt Negative-Feedback Buffer of Fig. 7.1-9
Find the output resistance of Fig. 7.1-9 using the model parameters of Table 3.1-2.
SOLUTION
The current flowing in the output transistors, M6 and M7, is $1\mathrm{\;{mA}}$ , which gives ${R}_{o}$ of
$$
{R}_{o} = \frac{1}{\left( {{\lambda }_{N} + {\lambda }_{P}}\right) 1\mathrm{\;{mA}}} = \frac{1000}{0.09} = {11.11}\mathrm{\;k}\Omega
$$
To calculate the loop gain, we find that
$$
{g}_{m2} = \sqrt{2{K}_{N}^{\prime } \cdot  {10} \cdot  {100\mu }\mathrm{A}} = {469\mu }\mathrm{S}
$$
$$
{g}_{m4} = \sqrt{2{K}_{N}^{\prime } \cdot  1 \cdot  {100\mu }\mathrm{A}} = {100\mu }\mathrm{S}
$$
and
$$
{g}_{m6} = \sqrt{2{K}_{P}^{\prime } \cdot  {10} \cdot  {1000\mu }\mathrm{A}} = 1\mathrm{{mS}}
$$
Therefore, the loop gain from Eq. (7.1-7) is
$$
\left| {LG}\right|  = \frac{1}{2}\frac{469}{100}2 \cdot  {11.11} = {52.1}
$$
Solving for the output resistance, ${R}_{\text{out }}$ , from Eq. (7.1-8) gives
$$
{R}_{\text{out }} = \frac{{11.11}\mathrm{k}\Omega }{1 + {52.1}} = {209\Omega }
$$
This calculation assumes that the load resistance is large and does not influence the loop gain.
## Buffered Op Amp Using BJTs
In the standard CMOS process, a substrate bipolar junction transistor is available and can be used to lower the output resistance of the op amp when used in the emitter-follower configuration. Because the transconductance of the BJT is much larger than the transconductance of a MOSFET with a moderate $W/L$ ratio, the output resistance will be lower. Figure 7.1-10 shows how a substrate NPN transistor is obtained in a p-well CMOS technology.
A two-stage op amp using an NPN substrate BJT output stage is shown in Fig. 7.1-11. The output stage is shown inside the dotted box. It consists of the cascade of an MOS follower and a BJT follower. The MOS follower (M8-M9) is necessary for two reasons. The first is that the output resistance includes whatever resistance is seen to ac ground from the base of the BJT divided by $1 + {\beta }_{F}$ . This resistance could easily be larger than the output resistance due to just the BJT. For Fig. 7.1-11, the small-signal output resistance can be written as
$$
{R}_{\text{out }} \approx  \frac{1}{{g}_{m10}} + \frac{1}{{g}_{m9}\left( {1 + {\beta }_{F}}\right) } \tag{7.1-9}
$$
where ${\beta }_{F}$ is the current gain of the BJT from the base to the collector. If ${500\mu }\mathrm{A}$ is flowing in $\mathrm{Q}{10} - \mathrm{M}{11}$ and ${100\mu }\mathrm{A}$ in $\mathrm{M}8 - \mathrm{M}9,{W}_{9}/{L}_{9} = {100}$ , and ${\beta }_{F}$ is 100, the output resistance of Fig. 7.1-11 is ${58.3\Omega }$ , where the first term of Eq. (7.1-9) is ${51.6\Omega }$ and the second term is ${6.7\Omega }$ . Without the MOS follower, the output resistance would be over ${1000\Omega }$ . A second reason for the MOS follower is that if the BJT is directly coupled to the drains of M6 and M7, it would load the second stage with a resistance of ${r}_{\pi } + \left( {1 + {\beta }_{F}}\right) {R}_{L}$ and cause the gain of the overall op amp to decrease.

Figure 7.1-10 Illustration of an NPN substrate BJT from a p-well CMOS technology.

Figure 7.1-11 Two-stage op amp with a Class A, BJT output buffer stage.
We will find that the BJT follower is not able to pull the output voltage all the way to ${V}_{DD}$ . If ${R}_{L}$ is large, the maximum output voltage for Fig. 7.1-11 is given as
$$
{v}_{\mathrm{{OUT}}}\left( \max \right)  = {V}_{DD} - {V}_{SD8}\left( \mathrm{{sat}}\right)  - {v}_{BE10} = {V}_{DD} - \sqrt{\frac{2{K}_{P}^{\prime }}{{I}_{8}\left( {{W}_{8}/{L}_{8}}\right) }} - {V}_{t}\ln \left( \frac{{I}_{c10}}{{I}_{s10}}\right)  \tag{7.1-10}
$$
Note that if ${R}_{L}$ is small then ${I}_{c10}$ will be large causing ${v}_{\mathrm{{OUT}}}\left( \max \right)$ to be reduced. If the output current is too large, M8 will be unable to provide the necessary base current and a maximum voltage limit will occur from the current limit. The minimum output voltage is equal to the ${V}_{DS11}$ (sat) assuming that this current sink is designed to sink the necessary current when Q10 is cutoff.
The slew rate of the BJT buffered op amp of Fig. 7.1-11 is limited to the amount of current that one can sink or source into ${C}_{c}$ and ${C}_{L}$ . The slew-rate limit due to ${C}_{c}$ is equal to ${I}_{5}/{C}_{c}$ and the slew-rate limit due to ${C}_{L}$ is ${I}_{11}/{C}_{L}$ . For large slew rates, both of these currents will have to be large, causing increased power dissipation. Also, the Class A output buffer leads to asymmetric slew rates. The current that can be sourced into ${C}_{L}$ is typically much larger than the current that can be sunk $\left( {I}_{11}\right)$ .
With the use of the MOS follower, M8-M9, the gain of this amplifier is equal to a two-stage op amp times the gain (attenuation) of the MOS follower and output BJT follower. This gain can be expressed as
$$
\frac{{v}_{\text{out }}}{{v}_{\text{in }}} \approx  \left( \frac{{g}_{m1}}{{g}_{ds2} + {g}_{ds4}}\right) \left( \frac{{g}_{m6}}{{g}_{ds6} + {g}_{ds7}}\right) \left( \frac{{g}_{m9}}{{g}_{m9} + {g}_{mbs9} + {g}_{ds8} + {g}_{\pi 10}}\right) \left( \frac{{g}_{m10}{R}_{L}}{1 + {g}_{m10}{R}_{L}}\right)  \tag{7.1-11}
$$
where we have assumed that the load reflected from the emitter to base of Q10 is negligible with respect to ${r}_{\pi 10}$ . We see that the gain consists of the cascade of four stages. This creates a challenge for compensation because the output of each stage typically has a pole. The compensation approach chosen in Fig. 7.1-11 is to use compensation only for the first two poles and ignore any poles due to the two follower stages. This may lead to stability problems, particularly if ${C}_{L}$ becomes large or if the gain bandwidth is designed to be larger.
## Designing the Class A, Buffered Op Amp of Fig. 7.1-11
Use the parameters of Table 3.1-2 along with the BJT parameters of ${I}_{s} = {10}^{-{14}}\mathrm{\;A}$ and ${\beta }_{F} =$ 100 to design the Class A, buffered op amp to give the following specifications. Assume the channel length to be ${1\mu }\mathrm{m}$ .
$$
{V}_{DD} = {2.5}\mathrm{\;V}
$$
$$
{V}_{SS} =  - {2.5}\mathrm{\;V}
$$
$$
{A}_{vd}\left( 0\right)  \geq  {5000}\mathrm{\;V}/\mathrm{V}
$$
$$
\text{Slew rate} \geq  {10}\mathrm{\;V}/\mu \mathrm{s}
$$
$$
{GB} = 5\mathrm{{MHz}}
$$
$$
\text{ICMR} =  - 1\text{to}2\mathrm{\;V}
$$
$$
{R}_{\text{out }} \leq  {100\Omega }
$$
$$
{R}_{L} = {500\Omega }
$$
## SOLUTION
Because the specifications above are similar to the two-stage design of Example 6.3-1, we can use the results of that example for the first two stages of our design. However, we must convert the results of Example 6.3-1 to a PMOS input stage. The results of doing this give ${W}_{1}/{L}_{1} = {W}_{2}/{L}_{2} = {6\mu }\mathrm{m}/{1\mu }\mathrm{m},{W}_{3}/{L}_{3} = {W}_{4}/{L}_{4} = {7\mu }\mathrm{m}/{1\mu }\mathrm{m},{W}_{5}/{L}_{5} = {11\mu }\mathrm{m}/{1\mu }\mathrm{m},{W}_{6}/{L}_{6} =$ ${43\mu }\mathrm{m}/{1\mu }\mathrm{m}$ , and ${W}_{7}/{L}_{7} = {34\mu }\mathrm{m}/{1\mu }\mathrm{m}$ (see Problem 6.3-6). Let the value of ${I}_{\text{BIAS }}$ be 30 $\mu \mathrm{A}$ and the values of ${W}_{12}$ and ${W}_{13}$ be ${44\mu }\mathrm{m}$ .
The design of the two followers is next. Let us begin with the BJT follower designed to meet the slew-rate specification. The current required for a ${100}\mathrm{{pF}}$ capacitor is $1\mathrm{{mA}}$ . Therefore, we want ${I}_{11}$ to be $1\mathrm{\;{mA}}$ . This means that ${W}_{11}$ must be equal to ${44\mu }\mathrm{m}({1000}\mathrm{{\mu A}}$ / ${30\mu }\mathrm{A}) = {1467\mu }\mathrm{m}$ . The $1\mathrm{{mA}}$ bias current through the BJT means that the output resistance will be ${0.0258}\mathrm{\;V}/1\mathrm{\;{mA}}$ or ${25.8\Omega }$ , which is less than ${100\Omega }$ . The ${1000\mu }\mathrm{A}$ flowing in the BJT will require ${10\mu }\mathrm{A}$ from the MOS follower stage. Therefore, let us select a bias current of ${100\mu }\mathrm{A}$ for $\mathrm{M}8$ . If ${W}_{12} = {44\mu }\mathrm{m}$ , then ${W}_{8} = {44\mu }\mathrm{m}\left( {{100\mu }\mathrm{A}/{30\mu }\mathrm{A}}\right)  = {146\mu }\mathrm{m}$ . If $1/{g}_{m10}$ is ${25.8\Omega }$ , then we can use Eq. (7.1-9) to design ${g}_{m9}$ as
$$
{g}_{m9} = \frac{1}{\left( {{R}_{\text{out }} - \frac{1}{{g}_{m10}}}\right) \left( {1 + {\beta }_{F}}\right) } = \frac{1}{\left( {{100} - {25.8}}\right) \left( {101}\right) } = {133.4\mu }\mathrm{S}
$$
Solving for the $W/L$ of M9 given ${g}_{m9}$ gives a $W/L$ of 0.809 . Let us select $W/L$ to be 10 for M9 in order to make sure that the contribution of M9 to the output resistance is sufficiently small and to increase the gain closer to unity. This will also help the fact that Eq. (7.1-9) neglects the bulk contribution to this resistance [see Eq. (5.5-18)]. This gives a transconductance for M9 of ${300\mu }\mathrm{S}$ .
---
Example 7.1-2
---
To calculate the voltage gain of the MOS follower we need to find ${g}_{mbs9}$ . This value is given as
$$
{g}_{mbs9} = \frac{{g}_{m9}{\gamma }_{N}}{2\sqrt{2{\phi }_{F} + {V}_{BS9}}} = \frac{{300} \cdot  {0.4}}{2\sqrt{{0.7} + 2}} = {36.5\mu }\mathrm{S}
$$
where we have assumed that the value of ${V}_{BS9}$ is approximately $- 2\mathrm{\;V}$ . Therefore,
$$
{A}_{\mathrm{{MOS}}} = \frac{{300\mu }\mathrm{S}}{{300\mu }\mathrm{S} + {36.5\mu }\mathrm{S} + {4\mu }\mathrm{S} + {5\mu }\mathrm{S}} = {0.8683}\mathrm{\;V}/\mathrm{V}
$$
The voltage gain of the BJT follower is
$$
{A}_{\mathrm{{BJT}}} = \frac{500}{{25.8} + {500}} = {0.951}\mathrm{\;V}/\mathrm{V}
$$
Thus, the gain of the op amp is
$$
{A}_{vd}\left( 0\right)  = \left( {7777}\right) \left( {0.8683}\right) \left( {0.951}\right)  = {6422}\mathrm{\;V}/\mathrm{V}
$$
which meets the specification. The power dissipation of this amplifier is given as
$$
{P}_{\text{diss }} = 5\mathrm{\;V}\left( {{30\mu }\mathrm{A} + {30\mu }\mathrm{A} + {95\mu }\mathrm{A} + {100\mu }\mathrm{A} + {1000\mu }\mathrm{A}}\right)  = {6.27}\mathrm{\;{mW}}
$$
One of the ways to decrease the power dissipation of the Class A, buffered op amp of Fig. 7.1-11 is to use a Class AB mode by replacing the current sink, M11, by an actively driven transistor. This will permit more of a balance between the sinking and sourcing capability. We can achieve this by simply connecting the gate of M11 to the gate of M6 in Fig. 7.1-11, resulting in Fig. 7.1-12, where M11 is now designated as M9. We have also eliminated the MOS follower, which makes this op amp less suitable for driving small values of ${R}_{L}$ . The MOS follower could be included if this is the case. Therefore, except for Q8 and M9, Fig. 7.1-12 is a two-stage op amp.

Figure 7.1-12 Two-stage op amp with a Class AB, BJT output buffer stage.
The large-signal performance of this circuit is similar to Fig. 7.1-11 except for the slew rate. As we examine the slew rate, it is important to remember that we assume that the output voltage is midrange, which is the optimum case. Obviously, the slew rate will worsen as the power supplies are approached because of reduced current drive capability. The positive slew rate of Fig. 7.1-12 can be expressed as
$$
S{R}^{ + } = \frac{{I}_{\mathrm{{OUT}}}^{ + }}{{C}_{L}} = \frac{\left( {1 + {\beta }_{F}}\right) {I}_{7}}{{C}_{L}} \tag{7.1-12}
$$
where it has been assumed that the slew rate is due to ${C}_{L}$ and not the internal capacitances of the op amp. Assuming that ${\beta }_{F} = {100},{C}_{L} = {1000}\mathrm{{pF}}$ , and the bias current in $\mathrm{M}7$ is ${95\mu }\mathrm{A}$ , the positive slew rate becomes ${8.6}\mathrm{\;V}/\mu \mathrm{s}$ . The negative slew rate is determined by assuming that the gate of $\mathrm{M}9$ can be taken to ${\mathrm{V}}_{DD} - 1\mathrm{\;V}$ . Therefore, the negative slew rate is
$$
S{R}^{ - } = \frac{{\beta }_{9}{\left( {V}_{DD} - 1\mathrm{\;V} + \left| {V}_{SS}\right|  - {V}_{T0}\right) }^{2}}{2{C}_{L}} \tag{7.1-13}
$$
Assuming a ${\left( W/L\right) }_{9}$ of ${60},{\mathrm{\;K}}_{N}^{\prime } = {110\mu }\mathrm{A}/{\mathrm{V}}^{2}, \pm  {2.5}\mathrm{\;V}$ power supplies, and a load capacitance of ${1000}\mathrm{{pF}}$ gives a negative slew rate of ${35.9}\mathrm{\;V}/\mu \mathrm{s}$ . The reason for the larger slew rate for the negative-going output is that the current is not limited as it is by ${I}_{7}$ for the positive-going output. The $W/L$ of 60 for M9 implies that the quiescent current flow in Q8 and M9 is ${95\mu }\mathrm{A}\left( {{60}/{43}}\right)  = {133\mu }\mathrm{A}$ .
The small-signal characteristics of Fig. 7.1-12 are developed using the model shown in Fig. 7.1-13. The controlled source representing the gain of the BJT has been simplified using the techniques in Appendix A. The result is a three-node circuit containing the Miller compensating capacitor ${C}_{c}$ and the input capacitance ${C}_{\pi }$ for the BJT. The approximate nodal equations describing this model are given as follows:
$$
{g}_{mI}{V}_{\text{in }} = \left( {{G}_{I} + s{C}_{c}}\right) {V}_{1} - s{C}_{c}{V}_{2} + 0{V}_{\text{out }} \tag{7.1-14}
$$
$$
0 = \left( {{g}_{mII} - s{C}_{c}}\right) {V}_{1} + \left( {{G}_{II} + {g}_{\pi } + s{C}_{c} + s{C}_{\pi }}\right) {V}_{2} - \left( {{g}_{\pi } + s{C}_{\pi }}\right) {V}_{\text{out }} \tag{7.1-15}
$$
$$
0 \cong  {g}_{m9}{V}_{1} - \left( {{g}_{m8} + s{C}_{\pi }}\right) {V}_{2} + \left( {{g}_{m8} + s{C}_{\pi }}\right) {V}_{\text{out }} \tag{7.1-16}
$$

Figure 7.1-13 An ac model for Fig. 7.1-12.
In the last equation, ${g}_{m8}$ has been assumed to be larger than ${g}_{\pi }$ and ${G}_{3}$ . Using the method illustrated in Sections 5.3 and 6.2, the approximate voltage-transfer function can be found as
$$
\frac{{V}_{9}\left( s\right) }{{V}_{\text{in }}\left( s\right) } = {A}_{v0}\frac{\left( {\frac{s}{{z}_{1}} - 1}\right) \left( {\frac{s}{{z}_{2}} - 1}\right) }{\left( {\frac{s}{{p}_{1}} - 1}\right) \left( {\frac{s}{{p}_{2}} - 1}\right) } \tag{7.1-17}
$$
where
$$
{A}_{v0} = \frac{-{g}_{mI}{g}_{mII}}{{G}_{I}{G}_{II}} \tag{7.1-18}
$$
$$
{z}_{1} = \frac{1}{\frac{{C}_{c}}{{g}_{mII}} - \frac{{C}_{\pi }}{{g}_{m8}}\left\lbrack  {1 + \frac{{g}_{m9}}{{g}_{mII}}}\right\rbrack  } \tag{7.1-19}
$$
$$
{z}_{2} =  - \frac{{g}_{m8}}{{C}_{\pi }} + \frac{{g}_{mII}}{{C}_{c}}\left\lbrack  {1 + \frac{{g}_{m9}}{{g}_{mII}}}\right\rbrack   \tag{7.1-20}
$$
$$
{p}_{1} = \frac{-{G}_{I}{G}_{II}}{{g}_{mII}{C}_{c}}\left\lbrack  \frac{1}{1 + \frac{{g}_{m9}}{{\beta }_{F}{g}_{mII}} + \frac{{C}_{\pi }}{{C}_{c}}\left( \frac{{G}_{I}{G}_{II}}{{g}_{m8}{g}_{mII}}\right) }\right\rbrack   \tag{7.1-21}
$$
$$
{p}_{2} \cong  \frac{-{g}_{m8}{g}_{mH}}{\left( {{g}_{mH} + {g}_{m9}}\right) {C}_{\pi }} \tag{7.1-22}
$$
The influence of the BJT output stage can be seen from the above results. The low-frequency, differential gain is unchanged. The presence of the BJT has caused the RHP zero to move further away from the origin, which should help stability. The second zero should normally be an LHP zero and can also be used to help stability. The dominant pole ${p}_{1}$ is essentially that of the simple unbuffered two-stage op amp if the quantity in the brackets of Eq. (7.1-21) approaches one, which should normally be the case. The second pole will be above the unity-gain bandwidth. However, the shunt capacitances at the base and collector of Q8 were neglected in the above analysis so that we may expect ${p}_{2}$ to be modified in a more complete analysis.
The primary objective in using the BJT in the output stage was to reduce the small-signal output resistance. This resistance can be calculated from Fig. 7.1-13 after ${V}_{\text{in }}$ is set to zero. The results are
$$
{r}_{\text{out }} = \frac{{r}_{\pi 8} + {R}_{2}}{1 + {\beta }_{F}} \tag{7.1-23}
$$
The success of the BJT in the output stage depends on keeping ${R}_{2}$ small, which may require the MOS follower of Fig. 7.1-11. If the current in M7 and M6 is ${95\mu }\mathrm{A}$ , the value of ${R}_{2}$ is approximately ${117}\mathrm{k}\Omega$ , which gives approximately ${1.275}\mathrm{k}\Omega$ if ${\beta }_{F}$ is 100 . This value is not as low as one might like when driving low-resistance loads such as ${100\Omega }$ .
Another consideration the designer must remember to take into account is the need for a dc base current. If the collector current is ${133\mu }\mathrm{A}$ , then ${1.3\mu }\mathrm{A}$ is required from the drain current of M7, causing the drain current of M6 to be ${1.3\mu }\mathrm{A}$ less. Under quiescent conditions this result is not significant. However, it can become the limit of output current sourced through $\mathrm{Q}8$ to the load.
The maximum output voltage of Fig. 7.1-12 can be determined by two approaches. One is the maximum current available to a load, ${R}_{L}$ , when M9 is off. This is given as
$$
{V}_{\mathrm{{OUT}}}\left( \max \right)  \approx  \left( {1 + {\beta }_{\mathrm{F}}}\right) {I}_{7}{R}_{L} \tag{7.1-24}
$$
If ${I}_{7}$ or ${R}_{L}$ is large enough, then the output is determined by Eq. (7.1-10). In either case, the maximum positive output voltage will be much more limited than the maximum negative output voltage, which will be close to ${V}_{SS}$ . This is due to the fact that M9 can sink much more current than the BJT can source.
The buffered op amp of Fig. 7.1-12 can be designed by using the design approach for the two-stage op amp to design all devices except M9 and Q8. M9 should be designed to sink the current required for the maximum negative slew rate given by Eq. (7.1-13). The only designable parameter of the BJT is the emitter area, which has little effect on the performance of the transistor. Thus, one usually chooses a size large enough to dissipate the power but small enough to avoid large device capacitances.
The ability to produce an output voltage across a small load resistor by the op amp of Figure 7.1-12 is shown in Fig. 7.1-14. Figure 7.1-14 shows the voltage-transfer function from the output of the first stage (gate of $\mathrm{M}6$ ) to the output of the amplifier as a function of the load resistance. Simulation results give the current flowing in the buffer as ${133\mu }\mathrm{A}$ in $\mathrm{Q}8$ and M9,95 $\mu \mathrm{A}$ in M7, and ${94\mu }\mathrm{A}$ in M6. The base current of Q8 is ${1.5\mu }\mathrm{A}$ . The currents correspond to a zero output voltage. The small-signal voltage gain from the output of the first stage to the op amp output gave $- {55.8}\mathrm{\;V}/\mathrm{V}$ with ${R}_{L} = {1000\Omega }$ to $- {4.8}\mathrm{\;V}/\mathrm{V}$ with ${R}_{L} = {50}$ $\Omega$ . It is interesting to note that the BJT has a difficult time in pulling the output voltage to the upper power supply while the MOSFET can pull the output voltage almost to the lower rail. One of the problems that manifests itself here is the increased demand for base current from M7 as the load current becomes larger. When the base current is limited, the output sourcing current is also limited and the output voltage becomes limited. Another important aspect of this circuit is that the output is severely distorted because of the difference in output resistance for positive and negative swings.

Figure 7.1-14 Influence of ${R}_{L}$ on the output voltage of Fig. 7.1-12.
---
Example 7.1-3
---
## Performance of the Output Buffer of Fig. 7.1-12
Using the transistor currents given above for the output stages (output stage of the two-stage op amp and the buffer stage) of Fig. 7.1-12, find the small-signal output resistance and the maximum output voltage when ${R}_{L} = {50\Omega }$ . Use the $W/L$ values of Example 7.1-2 and assume that the NPN BJT has the parameters of ${\beta }_{F} = {100}$ and ${I}_{S} = {10}\mathrm{{fA}}$ .
## SOLUTION
The small-signal output resistance is given by Eq. (7.1-23). This resistance is
$$
{r}_{\text{out }} = \frac{{r}_{\pi 8} + {r}_{ds6}\parallel {r}_{ds7}}{1 + {\beta }_{F}} = \frac{{19.668}\mathrm{\;k}\Omega  + {116.96}\mathrm{\;k}\Omega }{101} = {1353\Omega }
$$
Obviously, the MOS buffer of Fig. 7.1-11 would decrease this value.
The maximum output voltage given by Eq. (7.1-10) is only valid if the load current is small. If this is not the case, then a better approach is to assume that all of the current in M7 becomes base current for Q8 and to use Eq. (7.1-24). Using Eq. (7.1-24), we calculate ${v}_{\mathrm{{OUT}}}\left( \max \right)$ as ${101} \cdot  {95\mu }\mathrm{A} \cdot  {50\Omega }$ or ${0.48}\mathrm{\;V}$ , which is very close to the simulation results in Fig. 7.1-14 using the parameters of Table 3.1-2.
This section has shown how to decrease the output resistance of op amps in order to drive low-resistance loads. To achieve low output resistance using only MOSFETs, it is necessary to employ shunt negative feedback. If a BJT is used as an output follower, it is important to keep the resistance seen from the base of the BJT to ac ground as small as possible so that ${R}_{2}$ in Eq. (7.1-23) is less than ${r}_{\pi 8}$ . When output stages are added to the two-stage op amp, compensation will become more complex. The key to successful compensation is to make sure that the roots of the buffer stage are higher than the ${GB}$ of the two-stage op amp.

### 7.2 High-Speed/Frequency CMOS Op Amps
The op amp is the one block in analog circuits that is most like the gate in digital circuits in that it can be used for many different applications. In order to accomplish this generality, feedback is used to permit the transfer function to be defined by the feedback elements rather than the op amp. However, as the frequency is increased, the gain of the op amp decreases and eventually is not large enough to allow the transfer function to be independent of the op amp. This situation is illustrated in Fig. 7.2-1 for a gain of -10 . We see that the $- 3\mathrm{{dB}}$ bandwidth of this amplifier is approximately ${GB}/{10}$ . Therefore, if the frequency bandwidth of the transfer function is large, the op amp gain bandwidth must also be large. It is the objective of this section to explore op amps having a large gain bandwidth.
## Extending the Gain Bandwidth of the Conventional Op Amp
It is important to understand what determines the value of ${GB}$ . In Eq. (6.2-17), it was shown that the unity-gain bandwidth, ${GB}$ , of the two-stage op amp is equal to the product of the

Figure 7.2-1 Illustration of the influence of ${GB}$ on the frequency response of an amplifier using an op amp.
low-frequency gain and the magnitude of the dominant pole, ${\omega }_{A}$ . A more general expression for ${GB}$ is the ratio of the input-stage transconductance divided by whatever capacitance determines the dominant pole expressed as
$$
{GB} = \frac{{g}_{mI}}{{C}_{A}} \tag{7.2-1}
$$
For the two-stage op amp, ${C}_{A}$ is the capacitor ${C}_{c}$ , connected around the second stage. In the folded-cascode-type op amp, ${C}_{A}$ is the capacitance attached to the output to ground. Thus, for a high-frequency op amp, it is necessary to make the input-stage transconductance large and the capacitor causing the dominant pole small.
For the above considerations to be valid, the magnitude of all other higher-order poles must be greater than ${GB}$ . If this is not the case, then the op amp will have poor stability and the actual $- 3\mathrm{\;{dB}}$ frequency will be reduced, as seen in Fig. 7.2-2. As a matter of fact, the actual $- 3\mathrm{\;{dB}}$ frequency is slightly to the left of the breakpoint intersection of the two dark lines on Fig. 7.2-2. Also, a useful rule of thumb for op amp stability is that the difference in the slopes of the closed-loop response and the op amp response where they intersect should be equal to ${20}\mathrm{\;{dB}}/$ decade. If this slope difference is ${40}\mathrm{\;{dB}}/$ decade, as is the case in Fig. 7.2-2, the op amp will have poor stability. As one designs for higher values of ${GB}$ , the higher-order poles will eventually cause a limit. To achieve higher frequency response means that the higher-order poles must also be increased.
If higher-order poles do not limit the increase of ${GB}$ , then practical values of MOSFET op amps are determined by the largest practical ${g}_{mI}$ and the smallest capacitance that causes the dominant pole. Assuming an input transconductance of $1\mathrm{{mA}}/\mathrm{V}$ and a $1\mathrm{{pF}}$ capacitance gives a unity-gain bandwidth of ${159}\mathrm{{MHz}}$ . The advantage of bipolar technology is clear in this situation where a transconductance of ${20}\mathrm{{mA}}/\mathrm{V}$ is easy to achieve giving a BJT op amp ${GB}$ for $1\mathrm{{pF}}$ of ${3.18}\mathrm{{GHz}}$ . The key to achieving these values in either technology is the ability to push the higher-order poles above ${GB}$ .

Figure 7.2-2 Illustration of the influence of the next higher-order pole on the frequency response of an amplifier using an op amp.
The two-stage op amp can be designed for high frequencies by using the nulling resistor compensation method to cancel the closest pole above the dominant pole. The poles and zeros of a two-stage op amp using nulling resistor compensation were derived in Section 6.2 and are listed below. In the following, we will neglect the LHP zero associated with ${p}_{3}$ .
$$
{p}_{1} = \frac{-{g}_{m1}}{{A}_{v}{C}_{c}}\;\text{ (dominant pole) } \tag{7.2-2}
$$
$$
{p}_{2} = \frac{-{g}_{m6}}{{C}_{L}}\;\text{ (output pole) } \tag{7.2-3}
$$
$$
{p}_{3} = \frac{-{g}_{m3}}{{C}_{gs3} + {C}_{gs4}}\;\text{ (mirror pole) } \tag{7.2-4}
$$
$$
{p}_{4} = \frac{-1}{{R}_{z}{C}_{I}}\;\text{ (nulling pole) } \tag{7.2-5}
$$
and
$$
{z}_{1} = \frac{-1}{{R}_{z}{C}_{c} - {C}_{c}/{g}_{m6}}\;\text{ (nulling zero) } \tag{7.2-6}
$$
The approach focuses on the output pole, nulling pole, and mirror pole. The smallest of these is canceled by the nulling zero (as in Example 6.3-2). The magnitude of the next smallest pole would be equated to ${GB}/{2.2}$ (to give a ${60}^{ \circ  }$ phase margin), which would define the ${GB}$ . Finally, the dominant pole would be designed to give this value of ${GB}$ . Figure 7.2-3 shows the procedure, assuming that $\left| {p}_{2}\right|  < \left| {p}_{4}\right|  < \left| {p}_{3}\right|$ . This figure shows the op amp with the nulling zero not present (dotted line) and when the nulling zero is used to remove ${p}_{2}$ . The following example will illustrate this approach to increasing the bandwidth of a two-stage op amp.

Figure 7.2-3 Illustration of cancelling the pole at $- {p}_{2}$ with the nulling zero to extend the gain bandwidth.
## Increasing the Gain Bandwidth of the Two-Stage Op Amp Designed in Example 6.3-1
Use the two-stage op amp designed in Example 6.3-1 and apply the above approach to increase the gain bandwidth as much as possible.
## SOLUTION
We must first find the values of ${p}_{2},{p}_{3}$ , and ${p}_{4}$ . From Example 6.3-2, we see that ${p}_{2} =$ $- {94.25} \times  {10}^{6}$ rad/s. ${p}_{3}$ was found in Example 6.3-1 as $- {2.81} \times  {10}^{9}$ rad/s. To find ${p}_{4}$ , we must find ${C}_{I}$ , which is the output capacitance of the first stage of the op amp. ${C}_{I}$ consists of the following capacitors:
$$
{C}_{I} = {C}_{bd2} + {C}_{bd4} + {C}_{gs6} + {C}_{gd2} + {C}_{gd4}
$$
Use the approach described in Section 6.3 for estimating the source/drain areas where L1 + $\mathrm{L}2 + \mathrm{L}3 = {3\mu }\mathrm{m}$ . Therefore, for the two bulk-drain capacitors ( $\mathrm{M}2$ and $\mathrm{M}4$ ) we get a source/drain area of ${9\mu }{\mathrm{m}}^{2}$ for $\mathrm{M}2$ and ${45\mu }{\mathrm{m}}^{2}$ for $\mathrm{M}4$ and a source/drain periphery of ${12\mu }\mathrm{m}$ for M2 and ${36\mu }\mathrm{m}$ for M4. From Table 3.2-1 we can write
$$
{C}_{bd2} = \left( {{9\mu }{\mathrm{m}}^{2}}\right) \left( {{770} \times  {10}^{-6}\mathrm{\;F}/{\mathrm{m}}^{2}}\right)  + \left( {{12\mu }\mathrm{m}}\right) \left( {{380} \times  {10}^{-{12}}\mathrm{\;F}/\mathrm{m}}\right)
$$
$$
= {6.93}\mathrm{{fF}} + {4.56}\mathrm{{fF}} = {11.5}\mathrm{{fF}}
$$
$$
{C}_{bd4} = \left( {{45\mu }{\mathrm{m}}^{2}}\right) \left( {{560} \times  {10}^{-6}\mathrm{\;F}/{\mathrm{m}}^{2}}\right)  + \left( {{36\mu }\mathrm{m}}\right) \left( {{350} \times  {10}^{-{12}}\mathrm{\;F}/\mathrm{m}}\right)
$$
$$
= {25.2}\mathrm{{fF}} + {12.6}\mathrm{{fF}} = {37.8}\mathrm{{fF}}
$$
$$
{C}_{gs6} = \mathrm{{CGDO}} \times  {2\mu }\mathrm{m} + {0.67}\left( {{C}_{\mathrm{{ox}}} \cdot  {W}_{6} \cdot  {L}_{6}}\right)
$$
$$
= \left( {{220} \times  {10}^{-{12}}}\right) \left( {{94} \times  {10}^{-6}}\right)  + \left( {0.67}\right) \left( {{24.7} \times  {10}^{-4}}\right) \left( {{94} \times  {10}^{-{12}}}\right)
$$
$$
= {20.7}\mathrm{{fF}} + {154.8}\mathrm{{fF}} = {175.5}\mathrm{{fF}}
$$
$$
{C}_{gd2} = \left( {{220} \times  {10}^{-2}}\right) \left( {3 \times  {10}^{-6}}\right)  = {0.66}\mathrm{{fF}}
$$
and
$$
{C}_{gd4} = \left( {{220} \times  {10}^{-{12}}}\right) \left( {{15} \times  {10}^{-6}}\right)  = {3.3}\mathrm{{fF}}
$$
Therefore,
$$
{C}_{I} = {11.5}\mathrm{{fF}} + {37.8}\mathrm{{fF}} + {175.5}\mathrm{{fF}} + {0.66}\mathrm{{fF}} + {3.3}\mathrm{{fF}} = {228.8}\mathrm{{fF}}
$$
Although ${C}_{bd2}$ and ${C}_{bd4}$ will be reduced with a reverse bias, let us use these values to provide a margin. In fact, we probably ought to double the whole capacitance to make sure that other layout parasitics are included. Thus, let ${C}_{I}$ be 300 fF. In Example 6.3-2, ${R}_{z}$ was 4.591 $\mathrm{k}\Omega$ , which gives ${p}_{4} =  - {0.726} \times  {10}^{9}\mathrm{{rad}}/\mathrm{s}$ .
---
Example 7.2-1
---
Using the nulling zero ${z}_{1}$ to cancel ${p}_{2}$ gives ${p}_{4}$ as the next smallest pole. The ${GB}$ can be found by dividing $\left| {p}_{4}\right|$ by 2.2 if the next smallest pole is more than 10 times the new ${GB}$ . Although ${p}_{3}$ is about four times larger than ${p}_{4}$ , let us choose ${GB}$ by dividing ${p}_{4}$ by 2.2, giving the new ${GB} = {0.330} \times  {10}^{9}\mathrm{{rad}}/\mathrm{s}$ or ${52.5}\mathrm{{MHz}}$ . This is reasonable because of the left-hand plane zero at twice $- {p}_{3}$ . The compensating capacitor or ${g}_{m1}\left( {g}_{m2}\right)$ is designed from the relationship that ${GB} = {g}_{m1}/{C}_{c}$ to give this value of ${GB}$ . If we choose ${g}_{m1}$ to redesign, then it will become larger and will cause ${C}_{bd2}$ to increase. In this example, ${C}_{bd2}$ was not important but should M2 become large, this could influence the location of ${p}_{4}$ and demand an iterative solution. Instead, the new value of ${C}_{c}$ is given by ${g}_{m1}/{GB} = {286}\mathrm{{fF}}$ . We need to keep in mind the value of ${C}_{gd6}$ , which is ${20.7}\mathrm{{fF}}$ . When ${C}_{c}$ starts to approach ${C}_{gd6}$ , the method does not work.
In this example, we have extended the gain bandwidth of Example 6.3-1 from 5 to 52.5 $\mathrm{{MHz}}$ . The success of this method assumes that we know the values of the necessary capacitors and that there are no other roots with a magnitude smaller than ${10}\mathrm{{GB}}$ . We also assume that there are no complex roots.
The above procedure can also be applied to the cascode op amp of Fig. 6.5-7 because all of the poles are much higher than the dominant pole. Equations (6.5-21) through (6.5-26) give the approximate value of the dominant pole and all other higher-order poles. We see there are five poles that are larger in magnitude than the dominant pole $\left( {p}_{\text{out }}\right)$ . In this case, there is no nulling zero that is available to cancel the next smallest pole. To find the maximum value of ${GB}$ , we must identify which of the five poles has the smallest magnitude and set the ${GB}$ to the magnitude of this pole divided by 2.2 if the next higher pole is ten times greater than the new ${GB}$ . Then either or both the input-stage transconductance or the output capacitor would be designed to give the desired ${GB}$ . The following example illustrates how the gain bandwidth of the folded-cascode op amp of Example 6.5-3 can be extended.
---
Example 7.2-2
---
## Increasing the Gain Bandwidth of the Folded-Cascode Op Amp of Example 6.5-1
Use the folded-cascode op amp designed in Example 6.5-4 and apply the above approach to increase the gain bandwidth as much as possible. Assume that the drain/source areas are equal to ${2\mu }\mathrm{m}$ times the width of the transistor and that all voltage-dependent capacitors are at zero voltage.
## SOLUTION
The nondominant poles of the folded-cascode op amp were given in Eqs. (6.5-22) through (6.5-26). They are listed here for convenience.
$$
{p}_{A} \approx  \frac{-1}{{R}_{A}{C}_{A}} \approx  \frac{-{g}_{m6}}{{C}_{A}}
$$
[pole at the source of M6 of Fig. 6.5-9(b)]
$$
{p}_{B} \approx  \frac{-1}{{R}_{B}{C}_{B}} \approx  \frac{-{g}_{m7}}{{C}_{B}}
$$
[pole at the source of M7 of Fig. 6.5-9(b)]
$$
{p}_{6} \approx  \frac{-{g}_{m10}}{{C}_{6}}
$$
[pole at the drain of M6 of Fig. 6.5-9(b)]
$$
{p}_{8} \approx  \frac{-{g}_{m8}{r}_{ds8}{g}_{m10}}{{C}_{8}}\;\text{[pole at the source of M8 of Fig. 6.5-9(b)]}
$$
and
$$
{p}_{9} \approx  \frac{-{g}_{m9}}{{C}_{9}}\;\text{[pole at the source of M9 of Fig. 6.5-9(b)]}
$$
Let us evaluate each of these poles. For ${p}_{A}$ , the resistance ${R}_{A}$ is approximately equal to ${g}_{m6}$ and ${C}_{A}$ is given as
$$
{C}_{A} = {C}_{gs6} + {C}_{bd1} + {C}_{gd1} + {C}_{bd4} + {C}_{bs6} + {C}_{gd4}
$$
From Example 6.5-4, ${g}_{m6} = {774\mu }\mathrm{S}$ and capacitors constituting ${C}_{A}$ are found using the parameters of Table 3.2-1 as
$$
{C}_{gs6} = \left( {{220} \times  {10}^{-{12}} \cdot  {160} \times  {10}^{-6}}\right)  + \left( {0.67}\right) \left( {{160} \times  {10}^{-6} \cdot  {10}^{-6} \cdot  {24.7} \times  {10}^{-4}}\right)  = {355}\mathrm{{fF}}
$$
$$
{C}_{bd1} = \left( {{770} \times  {10}^{-6}}\right) \left( {{33} \times  {10}^{-6} \cdot  2 \times  {10}^{-6}}\right)  + \left( {{380} \times  {10}^{-{12}}}\right) \left( {2 \cdot  {70} \times  {10}^{-6}}\right)  = {77.4}\mathrm{{fF}}
$$
$$
{C}_{gd1} = \left( {{220} \times  {10}^{-{12}} \cdot  {33} \times  {10}^{-6}}\right)  = {7.3}\mathrm{{fF}}
$$
$$
{C}_{bd4} = {C}_{bs6} = \left( {{560} \times  {10}^{-6}}\right) \left( {{160} \times  {10}^{-6} \cdot  2 \times  {10}^{-6}}\right)  + \left( {{350} \times  {10}^{-{12}}}\right)
$$
$$
\left( {{2.162} \times  {10}^{-6}}\right)  = {293}\mathrm{{fF}}
$$
and
$$
{C}_{gd4} = \left( {{220} \times  {10}^{-{12}}}\right) \left( {{160} \times  {10}^{-6}}\right)  = {35.2}\mathrm{{fF}}
$$
Therefore,
$$
{C}_{A} = {355}\mathrm{{fF}} + {77.4}\mathrm{{fF}} + {7.3}\mathrm{{fF}} + {293}\mathrm{{fF}} + {35.2}\mathrm{{fF}} + {293}\mathrm{{fF}} = {1.061}\mathrm{{pF}}
$$
Thus,
$$
{p}_{A} = \frac{-{774} \times  {10}^{-6}}{{1.061} \times  {10}^{-{12}}} =  - {0.702} \times  {10}^{6}\mathrm{{rad}}/\mathrm{s}
$$
For the pole ${p}_{B}$ , the capacitance connected to this node is
$$
{C}_{B} = {C}_{gs7} + {C}_{bd2} + {C}_{gd2} + {C}_{bd5} + {C}_{bs7} + {C}_{gd5}
$$
The value of ${C}_{B}$ is the same as ${C}_{A}$ and ${g}_{m6}$ is assumed to be the same as ${g}_{m7}$ , giving ${p}_{B} = {p}_{A} =$ $- {0.702} \times  {10}^{6}\mathrm{{rad}}/\mathrm{s}$ .
For the pole ${p}_{6}$ , the capacitance connected to this node is
$$
{C}_{6} = {C}_{bd6} + {C}_{gd6} + {C}_{gs10} + {C}_{gs11} + {C}_{bd8} + {C}_{gd8}
$$
The various capacitors above are found as
$$
{C}_{bd6} = \left( {{560} \times  {10}^{-6}}\right) \left( {{160} \times  {10}^{-6} \cdot  2 \times  {10}^{-6}}\right)  + \left( {{350} \times  {10}^{-{12}}}\right) \left( {2 \cdot  {162} \times  {10}^{-6}}\right)  = {293}\mathrm{{fF}}
$$
$$
{C}_{gs10} = {C}_{gs11} = \left( {{220} \times  {10}^{-{12}} \cdot  {20} \times  {10}^{-6}}\right)  + \left( {0.67}\right) \left( {{20\mu }\mathrm{m} \cdot  {0.5\mu }\mathrm{m} \cdot  6\mathrm{{fF}}/\mu {\mathrm{m}}^{2}}\right)  = {44.4}\mathrm{{fF}}
$$
$$
{C}_{bd8} = \left( {{770} \times  {10}^{-6}}\right) \left( {{20} \times  {10}^{-6} \cdot  2 \times  {10}^{-6}}\right)  + \left( {{380} \times  {10}^{-{12}}}\right) \left( {{2.22} \times  {10}^{-6}}\right)  = {47.5}\mathrm{{fF}}
$$
$$
{C}_{gd8} = \left( {{220} \times  {10}^{-{12}}}\right) \left( {{20} \times  {10}^{-6}}\right)  = {4.4}\mathrm{{fF}}\text{ and }{C}_{gd6} = {C}_{gd5} = {35.2}\mathrm{{fF}}
$$
Therefore,
$$
{C}_{6} = {293}\mathrm{{fF}} + {35.2}\mathrm{{fF}} + {44.4}\mathrm{{fF}} + {44.4}\mathrm{{fF}} + {47.5}\mathrm{{fF}} + {4.4}\mathrm{{fF}} = {0.469}\mathrm{{pF}}
$$
From Example 6.5-4, ${g}_{m6} = {744.6} \times  {10}^{-6}$ . Therefore, ${p}_{6}$ can be expressed as
$$
- {p}_{6} = \frac{{774.6} \times  {10}^{-6}}{{0.469} \times  {10}^{-{12}}} = {1.652} \times  {10}^{9}\mathrm{{rads}}/\mathrm{s}
$$
Next, we consider the pole, ${p}_{8}$ . The capacitance conneted to this node is
$$
{C}_{8} = {C}_{bd10} + {C}_{gd10} + {C}_{gs8} + {C}_{bs8}
$$
These capacitors are given as
$$
{C}_{bs8} = {C}_{bd10} = \left( {{770} \times  {10}^{-6}}\right) \left( {{20} \times  {10}^{-6} \cdot  2 \times  {10}^{-6}}\right)  + \left( {{380} \times  {10}^{-{12}}}\right)
$$
$$
\left( {{2.22} \times  {10}^{-6}}\right)  = {47.5}\mathrm{{fF}}
$$
$$
{C}_{gs8} = \left( {{220} \times  {10}^{-{12}} \cdot  {20} \times  {10}^{-6}}\right)  + \left( {0.67}\right) \left( {{20} \times  {10}^{-6} \cdot  {10}^{-6} \cdot  {24.7} \times  {10}^{-4}}\right)  = {44.4}\mathrm{{fF}}
$$
and
$$
{C}_{gd10} = \left( {{220} \times  {10}^{-{12}}}\right) \left( {{20} \times  {10}^{-6}}\right)  = {4.4}\mathrm{{fF}}
$$
The capacitance ${C}_{8}$ is equal to
$$
{C}_{8} = {47.5}\mathrm{{fF}} + {4.4}\mathrm{{fF}} + {44.4}\mathrm{{fF}} + {47.5}\mathrm{{fF}} = {144}\mathrm{{pF}}
$$
Using the value of ${g}_{m8}$ found in Example 6.5-4 of ${774.6\mu }\mathrm{S}$ , the pole ${p}_{8}$ is found as $- {p}_{8} =$ $\left( {{g}_{m8}{r}_{ds8}{g}_{m10}}\right) /{C}_{8} = \left( {{600\mu }\mathrm{S} \times  {600\mu }\mathrm{S}}\right) /\left( {{4.5\mu }\mathrm{S} \times  {144}\mathrm{{fF}}}\right)  =  - {555} \times  {10}^{9}\mathrm{{rad}}/\mathrm{s}$ .
The capacitance for the pole at ${p}_{9}$ is identical with ${C}_{8}$ . Therefore, since ${g}_{m9}$ is ${600\mu }\mathrm{S}$ , the pole ${p}_{9}$ is, $- {p}_{9} = {4.167} \times  {10}^{9}\mathrm{{rad}}/\mathrm{s}$ .
The poles are summarized below:
$$
{p}_{A} =  - {0.702} \times  {10}^{9}\mathrm{{rad}}/\mathrm{s}\;{p}_{B} =  - {0.702} \times  {10}^{9}\mathrm{{rad}}/\mathrm{s}\;{p}_{6} =  - {1.652} \times  {10}^{9}\mathrm{{rad}}/\mathrm{s}
$$
$$
{p}_{8} =  - {555} \times  {10}^{9}\mathrm{{rad}}/\mathrm{s}\;{p}_{9} =  - {4.176} \times  {10}^{9}\mathrm{{rad}}/\mathrm{s}
$$
The smallest of these poles is ${p}_{A}$ or ${p}_{B}$ . Since ${p}_{6}$ is not much larger than ${p}_{A}$ or ${p}_{B}$ , we will find the new ${GB}$ by dividing ${p}_{A}$ or ${p}_{B}$ by 4 (which is a guess rather than 2.2) to get ${176} \times  {10}^{6}$ rads/s. Thus, the new ${GB}$ will be ${176} \times  {10}^{6}/{2\pi }$ or ${28}\mathrm{{MHz}}$ .
Checking our guess gives a phase margin of
$$
\mathrm{{PM}} = {90}^{ \circ  } - 2{\tan }^{-1}\left( {{0.176}/{0.702}}\right)  - {\tan }^{-1}\left( {{0.176}/{1.652}}\right)  = {56}^{ \circ  }
$$
which is satisfactory. The magnitude of the dominant pole is given as
$$
{p}_{\text{dominant }} = {GB}/{A}_{vd}\left( 0\right)  = {176} \times  {10}^{6}/{3678} = {47},{600}\text{ rads/s }
$$
The value of load capacitor that will give this pole is
$$
{C}_{L} = {\left( {p}_{\text{dominant }} \cdot  {R}_{\text{out }}\right) }^{-1} = {\left( {47.6} \times  {10}^{3} \cdot  {7.44}\mathrm{M}\Omega \right) }^{-1} = {2.81}\mathrm{{pF}}
$$
Thus, the load capacitor of the folded-cascode op amp of Example 6.5-4 can be reduced to ${2.81}\mathrm{{pF}}$ without sacrificing the phase margin. Therefore, the new ${GB} = {28}\mathrm{{MHz}}$ compared with the old ${GB} = {10}\mathrm{{MHz}}$ . This example has not resulted in much bandwidth improvement and illustrates the influence of large transistors (M5, M6, M7, and M8) and the resulting parasitic poles.
## Switched Op Amps
We have seen from the above considerations that all of the higher-order roots of an op amp must be greater than the desired value of ${GB}$ in order for Eq. (7.2-1) to be valid. This places a frequency response limit that is difficult to overcome. To reduce the number of higher-order roots, it is necessary to keep the circuitry as simple as possible.
One approach that has been used to simplify the circuitry is switched op amps. A switched op amp uses dynamic biasing to simplify the biasing circuitry and therefore reduces the number of higher-order roots. Figure 7.2-4 shows a simple dynamically biased inverter using the switches and capacitors to achieve the biasing. Such a circuit only functions for a limited time period and must be "refreshed." This type of amplifier would be limited to sampled-data applications such as switched capacitor circuits.

Figure 7.2-4 Illustration of a dynamically biased inverting amplifier.
The dynamically biased inverter establishes the bias conditions during the ${\phi }_{1}$ phase. M1 and M2 are connected as two series MOS diodes. The source-gate potential of M2 is established on the bias capacitor, ${C}_{B}$ . At the same time, the offset voltage of the amplifier is referenced to ground by the capacitor ${C}_{OS}$ . During the second phase, ${\phi }_{2}$ , the input is connected in series with ${C}_{OS}$ . Thus, the voltage applied to the gate of $\mathrm{M}1$ is the dc value necessary to bias M1 superimposed with the input signal. ${C}_{B}$ causes M2 to function as a current-source load for M1.
The switched amplifier illustrates the concept of dynamic biasing but is too simple to effectively reduce the parasitics in a comparable continuous time amplifier. The dynamically biased cascode amplifier of Fig. 7.2-5 is a better example of reducing the parasitics by using switched amplifiers [5]. The NMOS transistors M1 and M2 and the PMOS transistors M3 and M4 constitute the push-pull cascode output stage. The six switches and the capacitors ${C}_{1}$ and ${C}_{2}$ represent the differential-input stage of the op amp. NMOS transistors M5 and M6 and the PMOS transistors M7 and M8 generate the bias voltages for the op amp. The channel lengths for M1, M2, M3, and M4 are equal to those of M5, M6, M7, and M8, respectively. Therefore, the push-pull cascode output stage will be properly biased when ${V}_{B1}$ and ${V}_{B2}$ are applied to the gates of M1 and M4, respectively.
The basic operation of the dynamic op amp is explained in the following. During ${\phi }_{1},{C}_{1}$ and ${C}_{2}$ are charged by the bias voltages referenced to ${v}_{\mathrm{{IN}}}^{ + }$ . This is illustrated in Fig. 7.2-6(a). Next, the capacitors are referenced to ${v}_{\mathrm{{IN}}}^{ - }$ and applied to the gates of M1 and M4 as shown in Fig. 7.2-6(b). Note that the voltages applied to these gates consist of the desired dc bias voltage added to the differential input voltage.
Advantages of Fig. 7.2-5 include a Class AB push-pull operation that enables fast settling time with little power dissipation. The voltage swing at the input of the push-pull cascode stage is limited by the supply voltage, because large voltage swings will cause the switch-terminal diffusions to become forward biased for bulk CMOS switches. The maximum input-voltage swing is approximately equal to the bias voltages ${V}_{B1}$ and ${V}_{B2}$ . If the dynamic op amp must operate on both clock phases the circuit is simply doubled, as shown in Fig. 7.2-7.
When the op amp of Fig. 7.2-7 was fabricated using a ${1.5\mu }\mathrm{m}$ , n-well, double-poly, double-metal, CMOS technology, it was found to have a gain bandwidth of ${127}\mathrm{{MHz}}$ with a ${2.2}\mathrm{{pF}}$ load capacitance. The low-frequency gain was ${51}\mathrm{\;{dB}}$ . The common-mode input range

Figure 7.2-5 Simplified schematic of a dynamic, push-pull cascode op amp.

Figure 7.2-6 (a) Equivalent circuit for Fig. 7.2-5 during the ${\phi }_{1}$ clock period. (b) Equivalent circuit for Fig. 7.2-5 during the ${\phi }_{2}$ clock period.
was ${1.5} - {3.5}\mathrm{\;V}$ for a $5\mathrm{\;V}$ power supply. The settling time was ${10}\mathrm{\;{ns}}$ for a $5\mathrm{{pF}}$ load capacitance. The PSRR for both positive and negative power supplies was ${33}\mathrm{\;{dB}}$ at ${100}\mathrm{{kHz}}$ . Equivalent input noise was ${0.1\mu }\mathrm{V}/\mathrm{{VHz}}$ at ${100}\mathrm{{kHz}}$ for a ${\Delta f}$ of $1\mathrm{{kHz}}$ . The power dissipation was ${1.6}\mathrm{\;{mW}}$ . The key to the high performance of this circuit was the simplification due to dynamic-circuit techniques and the clever use of a high-speed technology. Figure 7.2-8 shows how the capacitance parasitics can be minimized by reducing the area of the drain-source between M1 and M2 (M3 and M4) to zero by taking advantage of the double-poly process to form a dual-gate MOSFET. If a double-poly process is not available, the common drain/source area of the cascodes can be minimized by careful layout.

Figure 7.2-7 A version of Fig. 7.2-5 that will operate on both clock phases.

Figure 7.2-8 Use of double-poly process to minimize drain-source to bulk capacitance between M1 and M2.
## Current Feedback Op Amps
Op amps that use current feedback have an important property that allows increased bandwidth when used as a voltage amplifier. This property is that the closed-loop $- 3\mathrm{\;{dB}}$ frequency remains constant as a function of the magnitude of the closed-loop voltage gain. The result is voltage amplifiers with a very high unity-gain bandwidth. While Eq. (5.4-5) verified this property, let us redevelop it using a different configuration. Consider the inverting voltage amplifier using current amplifier with current feedback shown in Fig. 7.2-9.
Let us assume that the differential current gain of the current amplifier is given by Eq. (5.4-4), which has a low-frequency current gain of ${A}_{i}$ and a dominant pole at $- {\omega }_{A}$ . The output current, ${i}_{o}$ , of the current amplifier can be written as
$$
{i}_{o} = {A}_{i}\left( s\right) \left( {{i}_{1} - {i}_{2}}\right)  =  - {A}_{i}\left( s\right) \left( {{i}_{\text{in }} + {i}_{o}}\right)  \tag{7.2-7}
$$
The closed-loop current gain, ${i}_{o}/{i}_{\text{in }}$ , can be found as
$$
\frac{{i}_{o}}{{i}_{\text{in }}} = \frac{-{A}_{i}\left( s\right) }{1 + {A}_{i}\left( s\right) } \tag{7.2-8}
$$
However, ${v}_{\text{out }} = {i}_{o}{R}_{2}$ and ${v}_{\text{in }} = {i}_{\text{in }}{R}_{1}$ . Solving for the voltage gain, ${v}_{\text{out }}/{v}_{\text{in }}$ , gives
$$
\frac{{v}_{\text{out }}}{{v}_{\text{in }}} = \frac{{i}_{o}{R}_{2}}{{i}_{\text{in }}{R}_{1}} = \left( \frac{-{R}_{2}}{{R}_{1}}\right) \left( \frac{{A}_{i}\left( s\right) }{1 + {A}_{i}\left( s\right) }\right)  \tag{7.2-9}
$$
Note that Eq. (7.2-9) is the inverting form of Eq. (5.4-3). Substituting Eq. (5.4-4) into Eq. (7.2-9) gives
$$
\frac{{v}_{\text{out }}}{{v}_{\text{in }}} = \left( \frac{-{R}_{2}}{{R}_{1}}\right) \left( \frac{{A}_{o}}{1 + {A}_{o}}\right) \left( \frac{{\omega }_{A}\left( {1 + {A}_{o}}\right) }{s + {\omega }_{A}\left( {1 + {A}_{o}}\right) }\right)  \tag{7.2-10}
$$

Figure 7.2-9 An inverting voltage amplifier using a current amplifier with negative-current feedback.
We see that the voltage gain is
$$
{A}_{v}\left( 0\right)  = \frac{-{R}_{2}{A}_{o}}{{R}_{1}\left( {1 + {A}_{o}}\right) } \tag{7.2-11}
$$
and the $- 3\mathrm{{dB}}$ frequency is
$$
{\omega }_{-3\mathrm{\;{dB}}} = {\omega }_{A}\left( {1 + {A}_{o}}\right)  \tag{7.2-12}
$$
which is consistent with the results of Section 5.4.
We note that if the low-frequency current gain of the current amplifier, ${A}_{o}$ , is much greater than one, the voltage gain of Fig. 7.2-9 is $- {R}_{2}/{R}_{1}$ . On the other hand, if ${A}_{o}$ is not greater than one, the voltage gain is reduced but is not a function of frequency. Quite often, current amplifiers with a gain of one $\left( {{A}_{o} = 1}\right)$ are used, which simply multiplies the gain by $\frac{1}{2}$ .
The advantage of current feedback is that the $- 3\mathrm{\;{dB}}$ frequency is not a function of ${R}_{2}$ or ${R}_{1}$ . This advantage is illustrated in Fig. 7.2-10, where the $- 3\mathrm{\;{dB}}$ frequency is constant regardless of the value of ${R}_{2}/{R}_{1}$ . Therefore, the amplifier unity-gain bandwidth is the product of Eqs. (7.2-11) and (7.2-12) and is given as
$$
{GB} = \left| {{A}_{v}\left( 0\right) }\right| {\omega }_{-3\mathrm{\;{dB}}} = \frac{{R}_{2}{A}_{o}{\omega }_{A}}{{R}_{1}} = \frac{{R}_{2}}{{R}_{1}}G{B}_{i} \tag{7.2-13}
$$
where $G{B}_{i}$ is the unity-gain bandwidth of the current amplifier. If $G{B}_{i}$ is constant, then increasing ${R}_{2}/{R}_{1}$ (the voltage gain) increases the unity-gain bandwidth of the voltage amplifier. This is in fact what happens and is limited only by higher-order poles of the current amplifier or by the limitations on the ${R}_{2}/{R}_{1}$ ratio [6]. Typically, the current amplifier has a nonzero input resistance, ${R}_{i}$ . When the value of ${R}_{1}$ approaches this value, the above relationships are no longer valid.
At first one might feel that the advantage gained by the current feedback is lost in the voltage buffer at the output. However, the $- 3\mathrm{\;{dB}}$ frequency of the voltage buffer is equal to the ${GB}$ of the op amp, which must be greater than the ${GB}$ of the voltage amplifier $\left( {G{B}_{1}}\right.$ and $G{B}_{2}$ in Fig. 7.2-10). If this is not the case, then a second pole will occur and the slopes of the voltage amplifier will increase and the actual ${GB}$ will be less than that predicted by Eq. (7.2-13).
A simple implementation of the concept shown in Fig. 7.2-9 is given in Fig. 7.2-11. The current amplifier has a gain of one and the resistor ratio of ${R}_{2}/{R}_{1}$ is 20, giving a voltage gain of $- {10}\mathrm{\;V}/\mathrm{V}$ . The dominant pole, ${\omega }_{A}$ , is given by the reciprocal product of ${R}_{2}$ and the capacitance seen from the output of the current amplifier to ground $\left( {C}_{o}\right)$ . If ${R}_{2}$ is kept constant and ${R}_{1}$ is varied, then ${\omega }_{A}$ will remain constant as the ${R}_{2}/{R}_{1}$ ratio changes. If we assume that the input resistance of the current amplifier $\left( {1/{g}_{m1}}\right)$ is less than ${R}_{1}$ , then the unity-gain bandwidth of the voltage amplifier will be
$$
{GB} = \frac{{R}_{2}\left( 1\right) }{{R}_{1}}\left( \frac{1}{{R}_{2}{C}_{o}}\right)  = \frac{1}{{R}_{1}{C}_{o}} \tag{7.2-14}
$$

Figure 7.2-10 Illustration of how the unity-gain bandwidths of the voltage amplifiers $\left( {G{B}_{1}}\right.$ and $\left. {G{B}_{2}}\right)$ are greater than the unity-gain bandwidth of the current amplifier $\left( {G{B}_{i}}\right)$ .

Figure 7.2-11 A simple MOSFET implementation of Fig. 7.2-9.
If ${R}_{1} = {10}\mathrm{k}\Omega$ and ${C}_{o} = {500}\mathrm{{fF}}$ , then the unity-gain bandwidth would be 31.83 MHz.
Unfortunately, there is a problem with Fig. 7.2-11 that will limit its usefulness. It is necessary for ${R}_{1}$ to be greater than the input resistance of the current amplifier $\left( {1/{g}_{m1}}\right)$ and for ${R}_{2}$ to be less than the output resistance of the current amplifier $1/\left( {{g}_{ds2} + {g}_{ds6}}\right)$ . To make ${g}_{m1}$ large will make ${g}_{ds2} + {g}_{ds6}$ large, which limits the ratio of ${R}_{2}/{R}_{1}$ or the closed-loop gain. The input and output resistances of the current amplifier can be separated for low-voltage gains, but the result is large $W/L$ values, which will cause the ${GB}$ to be reduced (see Problem 7.2.-5). A version of Fig. 7.2-11 that avoids this problem is shown in Fig. 7.2-12.
Figure 7.2-12 allows more flexibility in satisfying the requirements for a high ${GB}$ . The first requirement is that ${R}_{3}$ be much less than ${R}_{1}$ . The reason for this requirement is seen in Eq. (7.2-14), where ${R}_{1}$ should be small for high ${GB}$ , but ${R}_{3}$ limits the minimum value of ${R}_{1}$ . Therefore, let us choose ${R}_{1} = {10}{R}_{3}$ . The second requirement is to keep ${C}_{o}$ , the capacitance connected to the drains of M4 and M6 (also gate of M12), small. In order to accomplish this, the geometry of M4, M6, and M12 should be small. Beyond this we assume that the output resistance of the current amplifier (same node as ${C}_{o}$ ) will be much larger than ${R}_{2}$ , which is easy to satisfy in Fig. 7.2-12. The following example will illustrate the use of Fig. 7.2-12 to obtain a voltage amplifier having a gain of -10 with a -3 dB frequency of ${50}\mathrm{{MHz}}$ .

Figure 7.2-12 A practical version of Fig. 7.2-11.
## Design of a High-GB Voltage Amplifier Using Current Feedback
Design the voltage amplifier of Fig. 7.2-12 to achieve a gain of $- {10}\mathrm{\;V}/\mathrm{V}$ and a ${GB}$ of ${500}\mathrm{{MHz}}$ , which corresponds to a $- 3\mathrm{\;{dB}}$ frequency of ${50}\mathrm{{MHz}}$ .
## SOLUTION
Since we know what the gain is to be, let us assume that ${C}_{o}$ will be ${100}\mathrm{{fF}}$ . Thus, to get a ${GB}$ of ${500}\mathrm{{MHz}},{R}_{1}$ must be ${3.2}\mathrm{k}\Omega$ and ${R}_{2} = {32}\mathrm{k}\Omega$ . Therefore, ${R}_{3}$ must be less than ${300\Omega }.{R}_{3}$ is designed by ${\Delta V}/I$ , where ${\Delta V}$ is the saturation voltage of M1-M4. Therefore, we can write
$$
{R}_{3} = \frac{\Delta V}{I} = {\left( \frac{2}{I{K}^{\prime }\left( {W/L}\right) }\right) }^{1/2} = {300\Omega } \rightarrow  {22.2} \times  {10}^{-6} = {K}^{\prime }I\frac{W}{L}
$$
or the product of $I$ and $\left( {W/L}\right)$ must be equal to 0.202 . At this point we have a problem because if $W/L$ is small to minimize ${C}_{o}$ , the current will be too high. If we select $W/L = {200\mu }\mathrm{m}/$ ${1\mu }\mathrm{m}$ we will get a current of $1\mathrm{{mA}}$ . However, using this $W/L$ for $\mathrm{M}4$ and $\mathrm{M}6$ will give a value of ${C}_{o}$ that is greater than ${100}\mathrm{{fF}}$ . The solution to this problem is to select the $W/L$ of 200 for $\mathrm{M}1,\mathrm{\;M}3,\mathrm{\;M}5$ , and $\mathrm{M}7$ and a smaller $W/L$ for $\mathrm{M}2,\mathrm{\;M}4,\mathrm{\;M}6$ , and $\mathrm{M}8$ . Let us choose a $W/L =$ ${20\mu }\mathrm{m}/{1\mu }\mathrm{m}$ for $\mathrm{M}2,\mathrm{M}4,\mathrm{M}6$ , and $\mathrm{M}8$ , which gives a current in these transistors of ${100\mu }\mathrm{A}$ . However, now we are multiplying the ${R}_{2}/{R}_{1}$ ratio by $1/{11}$ according to Eq. (7.2-10). Thus, we will select ${R}_{2}{110}$ times ${R}_{1}$ or ${352}\mathrm{k}\Omega$ .
Now select a $W/L$ for M12 of ${20\mu }\mathrm{m}/{1\mu }\mathrm{m}$ , which will now permit us to calculate ${C}_{o}$ . We will assume zero bias on all voltage-dependent capacitors. Furthermore, we will assume the diffusion area as ${2\mu }\mathrm{m}$ times the $W.{C}_{o}$ can be written as
$$
{C}_{o} = {C}_{gd4} + {C}_{bd4} + {C}_{gd6} + {C}_{bd6} + {C}_{gs12}
$$
The information required to calculate these capacitors is found from Table 3.2-1. The various capacitors are
$$
{C}_{gd4} = {C}_{gd6} = \mathrm{{CGDO}} \times  {10\mu }\mathrm{m} = \left( {{220} \times  {10}^{-{12}}}\right) \left( {{20} \times  {10}^{-6}}\right)  = {4.4}\mathrm{{fF}}
$$
$$
{C}_{bd4} = \mathrm{{CJ}} \times  {\mathrm{{AD}}}_{4} + \mathrm{{CJSW}} \times  {\mathrm{{PD}}}_{4}
$$
$$
= \left( {{770} \times  {10}^{-6}}\right) \left( {{20} \times  {10}^{-{12}}}\right)  + \left( {{380} \times  {10}^{-{12}}}\right) \left( {{44} \times  {10}^{-6}}\right)  = {15.4}\mathrm{{fF}}
$$
$$
+ {16.7}\mathrm{{fF}} = {32.1}\mathrm{{fF}}
$$
$$
{C}_{bd6} = \left( {{560} \times  {10}^{-6}}\right) \left( {{20} \times  {10}^{-{12}}}\right)  + \left( {{350} \times  {10}^{-{12}}}\right) \left( {{44} \times  {10}^{-6}}\right)  = {26.6}\mathrm{{fF}}
$$
$$
{C}_{gs12} = \left( {{220} \times  {10}^{-{12}}}\right) \left( {{20} \times  {10}^{-6}}\right)  + \left( {0.67}\right) \left( {{20} \times  {10}^{-6} \cdot  {10}^{-6} \cdot  {24.7} \times  {10}^{-4}}\right)  = {37.3}\mathrm{{fF}}
$$
Therefore,
$$
{C}_{o} = {4.4}\mathrm{{fF}} + {32.1}\mathrm{{fF}} + {4.4}\mathrm{{fF}} + {26.6}\mathrm{{fF}} + {37.3}\mathrm{{fF}} = {105}\mathrm{{fF}}
$$
---
Example 7.2-3
---
Note that if we had not reduced the $W/L$ of M2, M4, M6, and M8 then ${C}_{o}$ would have easily exceeded ${100}\mathrm{{fF}}$ . Since ${105}\mathrm{{fF}}$ is close to our original guess of ${100}\mathrm{{fF}}$ , let us keep the values of ${R}_{1}$ and ${R}_{2}$ . If this value was significantly different, then we would adjust the values of ${R}_{1}$ and ${R}_{2}$ so that the ${GB}$ is ${500}\mathrm{{MHz}}$ . One must also check to make sure that the input pole is greater than ${500}\mathrm{{MHz}}$ (see Problem 7.2-6).
The design can be completed by assuming that ${I}_{\mathrm{{BIAS}}} = {100\mu }\mathrm{A}$ and that the current in M9 through M12 is ${100\mu }\mathrm{A}$ . Thus, ${W}_{13}/{L}_{13} = {W}_{14}/{L}_{14} = {20\mu }\mathrm{m}/{1\mu }\mathrm{m}$ and ${W}_{9}/{L}_{9}$ through ${W}_{12}/{L}_{12}$ are ${20\mu }\mathrm{m}/{1\mu }\mathrm{m}$ . Figure 7.2-13 shows the simulated frequency response of this design. The $- 3\mathrm{\;{dB}}$ frequency is seen to be close to ${38}\mathrm{{MHz}}$ and the ${GB}$ approximately 300 $\mathrm{{MHz}}$ . The gain loss of $- 2\mathrm{\;{dB}}$ is due to the source-follower loss and the fact that ${R}_{1}$ is larger than ${3.2}\mathrm{k}\Omega$ because of ${R}_{3}$ . A second pole occurs slightly above $1\mathrm{{GHz}}$ . To get these results, it was necessary to bias the input at $- {1.7}\mathrm{V}\mathrm{{dc}}$ using $\pm  3\mathrm{\;V}$ power supplies. The difference between the desired $- 3\mathrm{\;{dB}}$ frequency and the simulated is probably due to the fact that ${R}_{1}$ is larger than ${3.2}\mathrm{k}\Omega$ and that the actual capacitance may be slightly larger than that calculated in this example.

Figure 7.2-13 Simulation of the magnitude of Fig. 7.2-12 for Example 7.2-3.
Also shown on Fig. 7.2-13 is the magnitude response for the case of decreasing ${R}_{1}$ to $1\mathrm{\;k}\Omega$ . The gain is more than doubled(26.4dB)and the new $- 3\mathrm{\;{dB}}$ frequency is ${32}\mathrm{{MHz}}$ . The new unity-gain bandwidth is ${630}\mathrm{{MHz}}$ ! This illustrates the inherent ability of current feedback to increase the value of ${GB}$ as the closed-loop gain increases.
It would seem logical to use a current amplifier/mirror such as that of Fig. 5.4-5(a) that has an extremely small input resistance, $1/\left( {{g}_{m}^{2}{r}_{ds}}\right)$ . The input resistance of such an amplifier could easily be ${10\Omega }$ . The problem with this is that a shunt, negative-feedback loop is used to create the low resistance and, at high frequencies, the loop gain decreases, giving worse results than Fig. 7.2-12, which does not use feedback.
The use of current feedback is an effective way of creating voltage amplifiers with large ${GB}$ . Equation (7.2-14) is the key equation to achieving large ${GB}.{R}_{1}$ and ${C}_{o}$ must be as small as possible at high frequencies. Summing voltage amplifiers can be developed by using additional resistors such as ${R}_{1}$ connected from another input voltage to the input of the current amplifier. Furthermore, if one is careful about stability, the voltage amplifiers with large ${GB}$ can be used to create high-frequency buffer amplifiers by using another external negative-feedback path.

Figure 7.2-14 (a) Illustration of the parallel amplifier approach to achieving larger ${GB}$ . (b) Magnitude responses for (a).
## Parallel Path Op Amps
Another approach to achieving high- ${GB}$ op amps is to put a high-gain, low-frequency op amp in parallel with a low-gain, high-frequency op amp to achieve a single high- ${GB}$ op amp. The concept is illustrated in Fig. 7.2-14 [7]. The idea is to use a low-frequency op amp to achieve the high gain at low frequencies. However, this op amp has higher-order poles, which will make it conditionally stable. An op amp is conditionally stable if for some values of feedback, the feedback amplifier will be unstable. This typically occurs for small values of closed-loop gain. The lower gain op amp is designed to extend the $- {20}\mathrm{\;{dB}}/$ decade slope beyond the second pole $\left( {p}_{2}\right)$ of the higher gain op amp. The result is an op amp with a dominant pole at ${p}_{1}$ and a ${GB}$ that is the product of $\left| {p}_{1}\right|$ and $\left| {{A}_{vd1}\left( 0\right)  \cdot  {A}_{vd2}\left( 0\right) }\right|$ .
In order for this technique to work, the sign of the gains of both op amps should be the same, either positive or negative. If they are different, an RHP zero occurs and the stability is jeopardized. Figure 7.2-15 shows in more detail how this idea can be used with a three-stage amplifier. The technique is called multipath nested Miller compensation [7]. The LHP zero that is created by adding the two paths is used to cancel the second higher-order pole of the high-gain path, causing the $- {20}\mathrm{\;{dB}}/$ decade slope to extend to the second higher-order pole of the low-gain path. One must be careful that the RHP zeros generated by Miller compensation are canceled and that pole-zero doublets do not cause a problem with slow time constants. The equations for the analysis of Fig. 7.2-15 and other configurations are given in detail in Eschauzier and Huijsing [7] for the interested reader.

Figure 7.2-15 Example of a multipath nested Miller compensated amplifier.
This section has shown some of the approaches that could be taken to extend the frequency response of op amps. In all amplifiers, the frequency response is limited by the unity-gain bandwidth. In most MOSFET op amps, the unity-gain bandwidth is given by the ratio of the input transconductance divided by the capacitor causing the dominant pole. Unity-gain bandwidths beyond ${100}\mathrm{{MHz}}$ are difficult to achieve with CMOS technology. In many applications, the op amp is used to build a lower gain amplifier by the use of negative feedback. If current feedback is used, then it was seen that the ${GB}$ limit can actually be exceeded. The success of any method to extend the bandwidth will depend on the location of higher-order poles and their subsequent influence on the method.

### 7.3 Differential-Output Op Amps
In most applications of integrated-circuit op amps, it is desirable to have differential signals. Differential signals have the advantage of canceling unwanted common-mode signals/noise and increasing the signal swing by a factor of 2 over single-ended signals. Differential operation is a good way to minimize the influence of clock feedthrough. In order to process differential signals, the op amp must have both differential inputs and differential outputs. Up to this point in our study, we have only considered op amps having differential inputs and single-ended output. In this section, we wish to consider the implementation of op amps having both differential inputs and differential outputs.
## Considerations of Differential Signal Processing
One advantage of differential signal processing is the common-mode signal rejection property. This was demonstrated in Section 5.2 with the concept of common-mode rejection ratio. We saw that the common-mode input signal to a differential-input op amp was rejected in favor of the differential-mode input signal. This rejection is limited by the matching of each side of the differential signal processing circuitry. It also is important to realize that the even-order harmonics of the differential signal will also be rejected. Because differential signals have odd symmetry, the even-order terms of the harmonics will be canceled to within the degree of matching of the odd symmetry.
Another advantage of differential operation is that the amplitude of the signal is increased by a factor of 2 over the single-ended signal. This is illustrated in Fig. 7.3-1 and becomes important when the power supplies are small and dynamic range must be large. ${v}_{1}$ and ${v}_{2}$ are single-ended signals and ${v}_{1} - {v}_{2}$ is the differential signal.
Besides the differential-mode signal, one must also consider the common-mode signal. If the common-mode signal is not zero, then the differential-mode signals will be limited. In fact, it is necessary to provide some means of common-mode stabilization in order to use the differential mode. For signals at the input of the op amp, this is no problem because the input signal defines the common-mode signal. However, at the output of an op amp, the common mode is influenced by the mismatches and loads and can be at any value. Figure 7.3-2 illustrates what happens to a differential-mode signal having a peak-to-peak value of ${V}_{DD} + \left| {V}_{SS}\right|$ when the common-mode signal is not zero. It therefore becomes necessary to provide some form of common-mode stabilization. We will examine ways of implementing this stabilization after we introduce the various types of differential-in, differential-out op amps.

Figure 7.3-1 Illustration of how differential signals have twice the amplitude of a single-ended signal.

Figure 7.3-2 Influence of the common-mode (CM) signal on the differential-mode signal. (a) $\mathrm{{CM}} = 0$ . (b) $\mathrm{{CM}} = {0.5}{V}_{DD}$ . (c) $\mathrm{{CM}} = {0.5}{V}_{SS}$ .
## Differential-In, Differential-Out Op Amp Topologies
The implementation of a differential-output op amp is easy to do from a single-ended output op amp. For example, consider the two-stage op amp of Fig. 6.3-1. We will call this op amp the two-stage Miller op amp to distinguish it from the various op amps to be considered. In the op amp of Fig. 6.3-1, we note that the conversion point from a differential signal to a single-ended signal took place at the current mirror of the first stage. Since we do not want to convert to a single-ended signal the current mirror is replaced by two current-source loads. Unless the channel conductances are large, one will probably have to use a circuit such as Fig. 5.2-15 in order to resolve the dc current conflicts in the differential-input stage. To complete the design, we simply duplicate the second stage twice as shown in Fig. 7.3-3. Note that each second stage is compensated with its own Miller capacitance, ${C}_{c}$ , along with a nulling resistor, ${R}_{z}$ .
The differential-in, differential-out voltage gain is exactly equal to that of the single-ended output version. The subscripts on the input and output voltages have been chosen so that a positive voltage applied at ${v}_{i1}$ creates a positive voltage at ${v}_{o1}$ and a negative voltage at ${v}_{o2}$ . Similarly, a positive voltage applied at ${v}_{i2}$ creates a negative voltage at ${v}_{o1}$ and a positive voltage at ${v}_{o2}$ . The output common-mode range, OCMR, is equal to
$$
\text{OCMR} = {V}_{DD} + \left| {V}_{SS}\right|  - {V}_{SDP}\left( \text{sat}\right)  - {V}_{DSN}\left( \text{sat}\right)  \tag{7.3-1}
$$
where ${V}_{SDP}$ (sat) is the saturation voltage of M6 or M7 and ${V}_{DSN}$ (sat) is the saturation voltage of M8 or M9. The maximum peak-to-peak output voltage can be no larger than the OCMR of the op amp.

Figure 7.3-3 Two-stage Miller differential-in, differential-out op amp.
The two-stage Miller op amp of Fig. 7.3-3 is compensated in a manner similar to the single-ended two-stage Miller op amp. In differential applications, the load capacitor is connected differentially between the two outputs of Fig. 7.3-3. If we take this load capacitor, ${C}_{L}$ , and separate it into equal capacitors in series each of value $2{C}_{L}$ and ground the midpoint, then a single-ended equivalent circuit results. This step is illustrated in Fig. 7.3-4. Using a single-ended load capacitance of $2{C}_{L}$ allows us to use the previous compensation procedure developed for the single-ended output, two-stage Miller op amp.
The folded-cascode op amp of Fig. 6.5-7 can be converted into a differential output in a manner similar to the two-stage Miller op amp. The result is shown in Fig. 7.3-5. One of the advantages of differential-output op amps is that they are balanced; that is, the loads seen from the drains of the source-coupled input pair are equal. Again, the differential voltage gain is identical to the single-ended output version. The output common-mode range is given as
$$
\mathrm{{OCMR}} = {V}_{DD} + \left| {V}_{SS}\right|  - 2{V}_{SDP}\left( \mathrm{{sat}}\right)  - 2{V}_{DSN}\left( \mathrm{{sat}}\right)  \tag{7.3-2}
$$
where ${V}_{SDP}$ (sat) is the saturation voltage of M4 through M7 and ${V}_{DSN}$ (sat) is the saturation voltage of M8 through M11. Compensation is accomplished through the load capacitance, which would normally be connected differentially. Figure 7.3-4 can be employed to determine the dominant pole of each side of the differential output. The unity-gain bandwidth of this op amp can be quite large if the load capacitance is small and the input transconductance is large.
The input common-mode range of the differential-out op amps may appear to be better because of the current source loads (M3 and M4 of Fig. 7.3-3). However, the upper input common-mode range becomes restricted by M6 and M7 of Fig. 7.3-3. For example, in Fig. 7.3-3, the upper input common-mode range is ${V}_{DD} + {V}_{SD}$ (sat) whereas it is ${V}_{DD} -$ ${V}_{SD}$ (sat) $+ {V}_{T}$ for the folded-cascode differential output op amp of Fig. 7.3-6.
The outputs of the two-stage Miller op amp of Fig. 7.3-3 can be push-pull if we drive the current sinks/sources with the proper output of the first stage. Figure 7.3-5 shows this type of differential-output op amp [8]. This op amp has the same output common-mode range as Fig. 7.3-3. The primary difference is that the output-stage currents are very small under quiescent conditions (and not well defined). During large changes in the input, the output is able to actively sink or source current into the load. The compensation is slightly different from Fig. 7.3-3 in that the second-stage gain is increased by roughly a gain of 2 (if ${K}_{N}W/L = {K}_{P}L/W$ of the output transistors). This allows the Miller compensation to be accomplished with half of ${C}_{c}$ .

Figure 7.3-4 Conversion between differential outputs to single-ended ouputs.
tial-in, differential-out op amp with a

Figure 7.3-5 Two-stage Miller differen-push-pull output stage.
A differential-output, folded-cascode, Class A op amp is shown in Fig. 7.3-6 [9,10]. This folded-cascode op amp no longer has the low-frequency unbalance seen in Section 6.5. The lower cascode transistors, M8-M11, form a cascode current sink and therefore Class A operation. The maximum sinking or sourcing current in the load capacitors, ${C}_{L}$ , is ${I}_{3}$ . If the single-ended output resistance of the folded-cascode amplifier is given by Eq. (6.5-12), then the differential-output, differential-input voltage gain is given as
$$
{A}_{vd} = \frac{{v}_{\text{out }}}{{v}_{\text{in }}} = x{\left( {g}_{mN}{r}_{dsN}\right) }^{2} \tag{7.3-3}
$$
where $x$ is a constant between 0 and 1 depending on the relative values of the n - and p-transistor transconductances and conductances. The dominant pole is at the output and is given as
$$
\left| {p}_{\text{dominant }}\right|  = \frac{1}{\left( {2{R}_{\text{out }}}\right) \left( {{0.5}{C}_{L}}\right) } = \frac{1}{{R}_{\text{out }}{C}_{L}} \tag{7.3-4}
$$
where ${R}_{\text{out }}$ and ${C}_{L}$ are the singled-ended resistance and capacitance (from each differential-output node to ground), respectively.

Figure 7.3-6 Folded-cascode, differential-output op amp.

Figure 7.3-7 (a) Enhanced-gain, folded-cascode, differential-output op amp. (b) Implementation of the upper $A$ amplifier.
As in Section 6.5, we can enhance the gain of the folded-cascode op amp of Fig. 7.3-6 by the use of enhancement amplifiers. In this case we use two differential-in, differential-out enhancement amplifiers as shown in Fig. 7.3-7(a). The differential voltage gain of the enhanced-gain, folded-cascode op amp should be increased by the effective gain of the enhancement amplifiers and the magnitude of the dominant pole should be decreased by the same amount. The upper enhancement amplifier is shown in Fig. 7.3-7(b). ${V}_{\text{Bias }}$ is used to set the dc voltage at the inputs of the enhancement amplifier through negative feedback. From inspection, the small-signal currents in M1 through M4 due to the differential-input voltage ${v}_{in}$ are ${0.25}{g}_{m1}{v}_{in}, - {0.25}{g}_{m2}{v}_{in},{0.25}{g}_{m3}{v}_{in}$ , and $- {0.25}{g}_{m4}{v}_{in}$ , respectively. Assuming that ${g}_{m1} = {g}_{m2} = {g}_{m3} = {g}_{m4} = {g}_{mN}$ allows us to write the single-ended output voltages as
$$
{v}_{\text{out }}^{ + } \approx  {0.5}{g}_{mN}{r}_{dsN}{v}_{\text{in }} \tag{7.3-5a}
$$
and
$$
{v}_{\text{out }}^{ - } \approx   - {0.5}{g}_{mN}{r}_{dsN}{v}_{\text{in }} \tag{7.3-5b}
$$
The differential-output voltage is written as
$$
{v}_{\text{out }} = {v}_{\text{out }}^{ + } - {v}_{\text{out }}^{ + } \approx  {g}_{mN}{r}_{dsN}{v}_{\text{in }} \tag{7.3-6}
$$
Therefore, the differential-output, differential-input voltage gain of the upper enhancement amplifier is ${g}_{mN}{r}_{dsN}$ . By duality, the differential-output, differential-input voltage gain of the lower enhancement amplifier is ${g}_{mP}{r}_{dsP}$ (see Section 7.3 problems).
A class B, differential-output, folded-cascode op amp is shown in Fig. 7.3-8. This implementation is one of many that are possible. The intuitive analysis of the gain of this amplifier is superimposed on the schematic in Fig. 7.3-8. If the single-ended output resistances are given by Eq. (6.5-12), then the differential-output voltage gain is given as
$$
{A}_{vd} = \frac{{v}_{\text{out }}}{{v}_{\text{in }}} = x\left( {1 + k}\right) {\left( {g}_{mN}{r}_{dsN}\right) }^{2} \tag{7.3-7}
$$

Figure 7.3-8 Class B, folded-cascode, differential-output op amp.
where $k$ is the amount of small-signal current that flows in M8 (M9) due to the current in M2 (M4) and $x$ is a constant between 0 and 1 depending on the relative values of the n - and p-transistor transconductances and conductances.
The gain of Fig. 7.3-8 can be enhanced as before, resulting in Fig. 7.3-9. The enhancement amplifiers can be the same as used in Fig. 7.3-7 and will increase the effective gain of the Class B, differential-output, folded-cascode op amp by a factor of $x{g}_{mN}{r}_{dsN}$ , where $x$ is 1 for the upper enhancement amplifier and a constant between 0 and 1 for the lower amplifier. The value of $x$ depends on the relative values of the n- and p-transistor transconductances and conductances. The differential gain can easily approach ${\left( {g}_{mN}{r}_{dsN}\right) }^{3}$ .

Figure 7.3-9 Enhanced-gain, Class B, folded-cascode, differential-output op amp.
The last differential-in, differential-out op amp that will be considered employs an unusual form of the differential amplifier [11]. In fact, all op amp input stages to this point have used the source-coupled pair, which makes this amplifier unique among op amps with voltage inputs. The differential-input circuit called a cross-coupled differential-input stage is shown in Fig. 7.3-10.
The operation of the cross-coupled differential-input stage is understood by writing a voltage loop between the differential inputs, ${v}_{i1}$ and ${v}_{i2}$ . There are two loops and they are expressed as,
$$
{v}_{i1} - {v}_{i2} =  - {V}_{GS1} + {v}_{GS1} + {v}_{SG4} - {V}_{SG4} = {V}_{SG3} - {v}_{SG3} - {v}_{GS2} + {V}_{GS2} \tag{7.3-8}
$$
However, the total gate-source voltage consists of the dc term, ${V}_{GS}$ , and the ac term, ${v}_{gs}$ . Using this notation, Eq. (7.3-8) becomes
$$
{v}_{i1} - {v}_{i2} = {v}_{id} = \left( {{v}_{gs1} + {v}_{sg4}}\right)  =  - \left( {{v}_{sg3} + {v}_{gs2}}\right)  \tag{7.3-9}
$$
so in effect, the differential-input signal is applied across the gate-sources of M1 and M4 and M2 and M3. If the ${K}^{\prime }W/L$ of all transistors are equal, then the differential-input voltage is divided equally across each of the two source-gates. A positive value of ${v}_{id}$ will increase ${i}_{1}$ and decrease ${i}_{2}$ . These small-signal currents can be expressed as
$$
{i}_{1} = \frac{{g}_{m1}{v}_{id}}{2} = \frac{{g}_{m4}{v}_{id}}{2} \tag{7.3-10}
$$
and
$$
{i}_{2} =  - \frac{{g}_{m2}{v}_{id}}{2} =  - \frac{{g}_{m3}{v}_{id}}{2} \tag{7.3-11}
$$
We note that small-signal performance of Fig. 7.3-10 is equivalent to a source-coupled differential-input pair. In fact, the cross-coupled differential-input stage is simply two cross-connected source-coupled differential pairs where one transistor is NMOS and the other PMOS. The complete op amp is shown in Fig. 7.3-11. We see that the currents generated by the cross-coupled differential-input stage are simply steered to a push-pull cascode load to give the equivalent gain of a two-stage op amp.

Figure 7.3-10 Cross-coupled differential-input stage.

Figure 7.3-11 Class AB differential-output op amp using a cross-coupled differential-input stage.
The input common-mode range of Fig. 7.3-11 is much less than the other amplifiers presented above. The negative input common mode voltage is
$$
{V}_{icm}\left( \min \right)  = {V}_{SS} + {V}_{gs6} + {V}_{ds4}\left( \operatorname{sat}\right)  + {V}_{gs1} = {V}_{SS} + 2{V}_{T} + {3\Delta V} \tag{7.3-12}
$$
where ${V}_{gs} = {V}_{T} + {\Delta V} \cdot  2{V}_{T} + {3\Delta V}$ could be as much as $2\mathrm{\;V}$ . The gain is equivalent to a two-stage op amp and compensation is accomplished by the capacitance to ground at each output.
## Common-Mode Output Voltage Stabilization
The purpose of common-mode stabilization is to keep the common-mode voltage midway between the limits of the signal swing (normally power-supply voltages). This can be done using internal or external common-mode feedback. The concept of an internal common-mode feedback scheme is illustrated in Fig. 7.3-12. Figure 7.3-12(a) models the output of a Class A differential-output op amp and Fig. 7.3-12(b) models the output of a Class B (or Class AB) differential-output op amp. The basic issue with the output common-mode voltage is that the upper sourcing currents must match the lower sinking currents for the output common-mode voltage to be stabilized. However, as we have seen this is never the case, particularly when the output resistances are large such as the cascoded and enhanced-gain cas-coded op amps.

Figure 7.3-12 Common-mode output model for (a) Class A and (b) Class B differential-output op amps.
The conceptual view of common-mode feedback is illustrated in Fig. 7.3-13. If the common-mode output voltage increases, the function of the common-mode feedback circuit is to decrease the upper current sources or increase the lower current until the common-mode voltage is equal to ${V}_{CMREF}$ . If the common-mode output voltage decreases, the common-mode feedback circuit should increase the upper current sources or decrease the lower current sink until the common-mode voltage is equal to ${V}_{CMREF}$ . With proper selection of the correction circuitry, common-mode stabilization can be referenced to the desired value of common-mode output voltage (see Problem 7.3-10). Since the common-mode stabilization techniques are a form of negative feedback, one must be careful to ensure that high-gain loops are stable. If the output of the differential-output op amp uses the cascode configuration, the common-mode loop gain can easily be equivalent to a two-stage op amp.
A simple, unreferenced, common-mode feedback scheme for the two-stage Miller compensated op amp is shown in Fig. 7.3-14. The transistors M10 and M11 serve as the common-mode feedback and are operating in the triode region. The feedback works as follows. If the common-mode output voltage increases, the source-gate voltages of M10 and M11 decrease and the currents flowing through these transistors decrease. This means that the currents flowing in M6 and M7 also decrease. When these currents decrease below what is desired by M8 and M9, then the common-mode output voltage will decrease in opposition to the assumed increase. If the common-mode output voltage decreases, the common-mode feedback scheme in Fig. 7.3-14 will oppose this increase. This type of common-mode feedback is called unreferenced because the actual value of the common-mode output voltage is not well defined. This type of feedback will drive the common-mode output voltage away from the rails, but the value depends on other parameters. Figures 5.2-16 and 7.3-13 are examples of self-referencing common-mode feedback schemes. These feedback circuits will drive the output common-mode voltage to a specified reference voltage.
Using the above principles, one should be able to implement a successful output common-mode feedback scheme for each of the differential-output op amps considered in this section. Let us now consider the frequency behavior of the output common-mode feedback loop. Figure 7.3-15 illustrates an output common-mode feedback circuit for the differential-output,

Figure 7.3-13 Conceptual view of output common-mode feedback.

Figure 7.3-14 Two-stage Miller differential-in, differential-out op amp with common-mode stabilization
Class A, folded-cascode op amp. The use of resistors to sense the output, common-mode feedback is for the purpose of simplifying this discussion and would probably not be used in practice, because unless the resistors were very large, they will decrease the differential voltage gain.
First, let us estimate the feedback loop gain in Fig. 7.3-15. Starting at the gate of M13, we have a voltage gain of $x{g}_{mN}{r}_{dsN}$ to the gates of M10 and M11, where $x$ is a constant between 0 and 1 and depends on the relative values of the n- and p-channel transconductances and conductances. The voltage at the gates of M10 and M11 creates currents in the cascoded output, giving a common-mode loop gain of
$$
{A}_{cm} = x{\left( {g}_{mN}{r}_{dsN}\right) }^{3} \tag{7.3-13}
$$
where $x$ has the same definition but a different value. The common-mode feedback loop has two poles: one at the drains of M14 and M16 (gates of M10 and M11) and the second pole is the dominant pole of the differential-output op amp. To make the loop stable would require compensation. The dashed capacitors, ${C}_{c}$ , in Fig. 7.3-15 show one method of compensation using Miller compensation.
Observing that the feedback loop gain of Fig. 7.3-15 is very large [Eq. (7.3-13)] allows us to modify the common-mode feedback loop to a scheme that is self-compensated. Converting the feedback scheme of Fig. 7.3-15 to that shown in Fig. 7.3-16 results in a much improved frequency response of the feedback loop. The pole at the drain of M14 is no longer significant because of the low resistance of the drain-gate connected M15. The current in M15 is mirrored to the cascodes consisting of M16 and M18 and M17 and M19. Note that the common-mode feedback current is connected directly to the single-ended outputs of the differential-output op amp. Therefore, the only significant pole in the feedback circuit is the dominant pole of the differential-output op amp. The gain of the common-mode feedback circuit in Fig. 7.3-16 is
$$
{A}_{cm} = x{\left( {g}_{mN}{r}_{dsN}\right) }^{2} \tag{7.3-14}
$$

Figure 7.3-15 Frequency response of the common-mode feedback circuit.

Figure 7.3-16 Improvement of the frequency response of Fig. 7.3-15.
which is sufficient to accomplish the output, common-voltage stabilization. Note in both Figs. 7.3-15 and 7.3-16 that the feedback schemes are self-referencing. The additional transistors connected to the differential-output cascodes (M16 and M18 and M17 and M19) will decrease the differential voltage gain slightly and must be taken into account.
The above common-mode output voltage stabilization schemes were internal to the op amp. In many applications it is possible to stabilize the common-mode output voltage using external circuitry. This is particularly attractive for switched-capacitor circuits. Figure 7.3-17 shows how a differential-output op amp can be stabilized by external means [12].
In this type of circuit, the op amp is used only during the ${\phi }_{2}$ phase. The terminal of the op amp, designated as CMbias, is an input that determines the common-mode output voltage. During the ${\phi }_{1}$ phase, the two capacitors, ${C}_{cm}$ , are charged to the desired value of the output common-mode voltage, ${V}_{ocm}$ . Note that ${V}_{ocm}$ is connected to CMbias during this phase. During the ${\phi }_{2}$ phase, the ${C}_{cm}$ capacitors that have been charged to ${V}_{ocm}$ are connected between the differential outputs and the CMbias node. Even though a differential-output voltage may exist, the average voltage applied to the CMbias node will be ${V}_{\text{ocm }}$ . It is assumed that the phase periods are small enough that the voltage across ${C}_{cm}$ does not change.

Figure 7.3-17 An external-output, common-mode voltage stabilization scheme.

Figure 7.3-18 Example of a common-mode output voltage stabilization scheme for discrete-time applications.
Figure 7.3-18 shows an example of applying the external-output, common-mode voltage stabilization scheme of Fig. 7.3-17 to a differential-output, folded-cascode op amp. There are two phases of operation for this circuit. The first is called the common-mode adjustment phase and the second is the amplification phase. During the common-mode adjustment phase, the switches $\mathrm{S}1,\mathrm{\;S}2$ , and $\mathrm{S}3$ are closed. The capacitors ${C}_{1}$ and ${C}_{2}$ are charged to the value necessary for ${I}_{12}$ and ${I}_{13}$ to keep the common-mode output voltage at ${V}_{CM}$ . During the amplification phase, switches $\mathrm{S}4$ and $\mathrm{S}5$ are closed. If the common-mode output voltage is not ${V}_{CM}$ , the currents ${I}_{12}$ and ${I}_{13}$ will change and force the value of the common-mode output voltage back to ${V}_{CM}$ .
In many cases, the voltage range of the differential-output op amp is very limited because of low voltage supplies. In this case, it is important to establish the output, common-mode voltage very precisely to get maximum signal swing. If discrete-time, common-mode stabilization techniques are used, it may be necessary to account for the charge transfer that occurs during the operation of the switches. Through simulation, these errors can be predicted and corrected by applying a correction signal superimposed on the error signal used to achieve the desired (target) common-mode output voltage.
Many other types of common-mode output voltage stabilization techniques are possible but they all follow the general principles illustrated above. Most practical realizations of integrated circuits using op amps will use differential-output op amps to increase the signal swing and remove odd harmonics. In addition, common noise such as charge injection from switches is greatly diminished. While we will continue to develop various types of op amps using single-ended outputs, the reader must keep in mind this is primarily for purposes of simplification and not necessarily the most practical form of a particular op amp implementation.
### 7.4 Micropower Op Amps
In this section, op amps that require minimum power are considered. This type of op amp primarily operates in the weak inversion region. Op amps operating in the weak inversion region have become very useful [13-17] because they operate not only at low power-supply currents but also at very low power-supply voltages. Our first task in this section is to develop the small-signal equations for transistors operating in weak inversion. These will be applied to understanding a few basic amplifier architectures that work well using micropower techniques. The techniques that are introduced in this section to create high current overdrive can be used in strong inversion circuits as well.
## Two-Stage Miller Op Amp Operating in Weak Inversion
First, consider the equations that model the large-signal behavior of transistors operating at very low current densities. Assuming operation in the saturation region, subthreshold drain current was given in Eq. (3.5-5) as
$$
{i}_{D} = \frac{W}{L}{I}_{DO}\exp \left( \frac{q{v}_{GS}}{nkT}\right)  \tag{7.4-1}
$$
From this equation, the transconductance can easily be derived as
$$
{g}_{m} = \frac{{I}_{D}}{{nkT}/q} \tag{7.4-2}
$$
This result is very interesting in that it shows a linear relationship between transconductance and drain current. Furthermore, the transconductance is independent of device geometry. These two characteristics set the subthreshold region apart from the strong inversion region, where the relationship between ${g}_{m}$ and ${I}_{D}$ is a square-law one and also a function of device geometry. In fact, the transconductance of the MOS device operating in the weak inversion region looks very much like that of a bipolar transistor.
Equation (7.4-1) shows no dependence of drain current on drain-source voltage. If such were the case, then the device output impedance would be infinite (which is obviously not correct). The dependence of ${i}_{D}$ on ${v}_{DS}$ can be approximated in the same way as it was for the simple strong inversion model, where the drain current is modulated by the term $1 + \lambda {v}_{DS}$ . Note that the weak inversion $\lambda$ may not necessarily be the same as that extracted from strong inversion measurements. The expression for output resistance in weak inversion is
$$
{r}_{o} \cong  \frac{1}{\lambda {I}_{D}} \tag{7.4-3}
$$
Like the transconductance, the output resistance is also independent of device aspect ratio, $W/L$ (at constant current). Since $\lambda$ is a function of channel length, it is the only control the designer has on the gain $\left( {{g}_{m}{r}_{o}}\right)$ of a single stage operating in weak inversion. With these things in mind, consider the simple op amp shown in Fig. 7.4-1. The dc gain of this amplifier is
$$
{A}_{vo} = {g}_{m2}{g}_{m6}\left( \frac{{r}_{o2}{r}_{o4}}{{r}_{o2} + {r}_{o4}}\right) \left( \frac{{r}_{o6}{r}_{o7}}{{r}_{o6} + {r}_{o7}}\right)  \tag{7.4-4}
$$
In terms of device parameters this gain can be expressed as
$$
{A}_{vo} = \frac{1}{{n}_{2}{n}_{6}{\left( kT/q\right) }^{2}\left( {{\lambda }_{2} + {\lambda }_{4}}\right) \left( {{\lambda }_{6} + {\lambda }_{7}}\right) } \tag{7.4-5}
$$

Figure 7.4-1 Two-stage Miller op amp operating in weak inversion.
The gain bandwidth ${g}_{m1}/{C}_{c}$ is
$$
{GB} = \frac{{I}_{D1}}{\left( {{n}_{1}{kT}/q}\right) {C}_{c}} \tag{7.4-6}
$$
It is interesting to note that while the dc gain of the op amp is independent of ${I}_{D}$ , the ${GB}$ is not. This becomes a limiting factor in the dynamic performance of the op amp operating in weak inversion because the dc current is small and thus the ${GB}$ is small. The slew rate of this amplifier is
$$
{SR} = \frac{{I}_{D5}}{{C}_{c}} = 2\frac{{I}_{D1}}{{C}_{c}} = {2GB}\left( {{n}_{1}\frac{kT}{q}}\right)  = {2GB}{n}_{1}{V}_{t} \tag{7.4-7}
$$
---
Example 7.4-1
---
## Gain and ${GB}$ Calculations for Subthreshold Op Amp
Calculate the gain, ${GB}$ , and ${SR}$ of the op amp shown in Fig. 7.4-1. The current, ${I}_{D5}$ , is 200 nA. The device lengths are ${1\mu }\mathrm{m}$ . Values for $n$ are 1.5 and 2.5 for p-channel and n-channel transistors, respectively. The compensation capacitor is $5\mathrm{{pF}}$ . Use Table 3.1-2 as required. Assume that the temperature is ${27}^{ \circ  }\mathrm{C}$ .
SOLUTION
Using Eq. (7.4-5), the gain is
$$
{A}_{v} = \frac{1}{\left( {1.5}\right) \left( {2.5}\right) {\left( {0.026}\right) }^{2}\left( {{0.04} + {0.05}}\right) \left( {{0.04} + {0.05}}\right) } = {48},{701}\mathrm{\;V}/\mathrm{V}
$$
The gain bandwidth is
$$
{GB} = \frac{{100} \times  {10}^{-9}}{{2.5}\left( {0.026}\right) \left( {5 \times  {10}^{-{12}}}\right) } = {307},{690}\mathrm{{rps}} \cong  {49.0}\mathrm{{kHz}}
$$
$$
{SR} = \left( 2\right) \left( {{307},{690}}\right) \left( {2.5}\right) \left( {0.026}\right)  = {0.04}\mathrm{\;V}/\mu \mathrm{s}
$$
## Other Op Amps Operating in the Weak Inversion Region
Consider the circuit shown in Fig. 7.4-2 as an alternative to the two-stage op amp described above. The differential gain of the first stage is
$$
{A}_{vo} = \frac{{g}_{m2}}{{g}_{m4}} \tag{7.4-8}
$$
In terms of device parameters, this gain can be expressed as
$$
{A}_{vo} = \frac{{I}_{D2}{n}_{4}{V}_{t}}{{I}_{D4}{n}_{2}{V}_{t}} = \frac{{I}_{D2}{n}_{4}}{{I}_{D4}{n}_{2}} \cong  1 \tag{7.4-9}
$$
Very little if any gain is available from the first stage. The second stage, however, does provide a reasonable amount of gain. The total gain of the circuit is best calculated assuming that the device pairs M3-M8, M4-M6, and M9-M7 act as current mirrors. Therefore,
$$
{A}_{vo} = \frac{{g}_{m1}\left( {{S}_{6}/{S}_{4}}\right) }{\left( {g}_{ds6} + {g}_{ds7}\right) } = \frac{\left( {S}_{6}/{S}_{4}\right) }{\left( {{\lambda }_{6} + {\lambda }_{7}}\right) {n}_{1}{V}_{t}} \tag{7.4-10}
$$
At room temperature $\left( {{V}_{t} = {0.0259}\mathrm{\;V}}\right)$ and for typical device lengths, gains on the order of ${60}\mathrm{\;{dB}}$ can be obtained. The gain bandwidth can be expressed as
$$
{GB} = \frac{{g}_{m1}}{C}\left( \frac{{S}_{6}}{{S}_{4}}\right)  = \frac{{g}_{m1}b}{C} \tag{7.4-11}
$$
where the coefficient $b$ is the ratio of ${W}_{6}/{L}_{6}$ to ${W}_{4}/{L}_{4}\left( {{W}_{8}/{L}_{8}}\right.$ to $\left. {{W}_{3}/{L}_{3}}\right)$ . If higher gains are required using this basic circuit, two things can be done. The first is to bleed off some of the current flowing in devices M3 and M4 so that their transconductances will be lower than the input devices, thus giving the first stage a gain greater than one. Only a small improvement can be obtained with this technique. The other way to increase the gain is to replace the output stage with a cascode as illustrated in Fig. 7.4-3. The gain of this amplifier is
$$
{A}_{vo} = \left( \frac{{I}_{5}}{2{I}_{7}}\right) \frac{b/{n}_{n}}{{V}_{t}^{2}\left( {{\lambda }_{p}^{2}{n}_{p} + {\lambda }_{n}^{2}{n}_{n}}\right) } \tag{7.4-12}
$$

Figure 7.4-2 Push-pull output op amp for operation in weak inversion.
A simple calculation shows that this cascode amplifier can achieve gains greater than ${80}\mathrm{\;{dB}}$ and all of the gain is achieved at the output.
## Increasing the Output Current for Weak Inversion Operation
The disadvantage of the amplifiers presented thus far is their inability to provide large output currents while still maintaining micropower consumption during quiescent conditions. An interesting solution to this problem has been presented in the literature [13]. The basic idea, shown in Fig. 7.4-4, is to provide a boost of tail current (which is ultimately available at the output through mirroring) whenever there is a differential-input voltage. Figure 7.4-4 consists of the circuit shown within the dotted box of Fig. 7.4-3 plus the circuitry necessary to boost the tail current, ${I}_{5}$ , when a differential-input signal is applied.
Assume that transistors M18 through M21 are equal to M3 and M4 and that transistors M22, M23, M24, M25, M26, and M27 are all equal. Further assume that M28 and M29 are related in the following way:
$$
\frac{{W}_{28}}{{L}_{28}} = A\left( \frac{{W}_{26}}{{L}_{26}}\right)  \tag{7.4-13}
$$
$$
\frac{{W}_{29}}{{L}_{29}} = A\left( \frac{{W}_{27}}{{L}_{27}}\right)  \tag{7.4-14}
$$

Figure 7.4-3 Op amp of Fig. 7.4-2 using cascode outputs for gain improvement in weak inversion operation.

Figure 7.4-4 Dynamically biased differential amplifier input stage.
During quiescent conditions, the currents ${i}_{1}$ and ${i}_{2}$ are equal; therefore, the current in M24 is equal to the current supplied by M19. As a result, no current flows in M26, and thus none in M28. Similarly, no current flows in M29. Therefore, no additional current is provided for the differential stage. However, if ${v}_{i1} > {v}_{i2}$ , then ${i}_{2} > {i}_{1}$ and the tail current supplied to the differential stage is increased by the amount of $A\left( {{i}_{2} - {i}_{1}}\right)$ . If ${v}_{i1} < {v}_{i2}$ , then ${i}_{2} < {i}_{1}$ and the tail current is increased by the amount of $A\left( {{i}_{1} - {i}_{2}}\right)$ .
We can solve for the amount of output current available by assuming the ${v}_{\mathrm{{IN}}}$ , which is equal to ${v}_{i1} - {v}_{i2}$ , is positive. Therefore, ${i}_{2} > {i}_{1}$ and we can write that
$$
{i}_{1} + {i}_{2} = {I}_{5} + A\left( {{i}_{2} - {i}_{1}}\right)  \tag{7.4-15}
$$
From the relationship for the drain current in weak inversion and the definition of ${v}_{\mathrm{{IN}}}$ , we can express ${i}_{2}/{i}_{1}$ as
$$
\frac{{i}_{2}}{{i}_{1}} = \exp \left( \frac{{v}_{\mathrm{{IN}}}}{n{V}_{t}}\right)  \tag{7.4-16}
$$
If we define the output current as $b$ times ${i}_{2} - {i}_{1}$ , we may write the output current, ${i}_{\mathrm{{OUT}}}$ , as
$$
{i}_{\mathrm{{OUT}}} = \frac{b{I}_{5}\left( {\exp \left( \frac{{v}_{\mathrm{{IN}}}}{n{V}_{t}}\right)  - 1}\right) }{\left( {1 + A}\right)  - \left( {A - 1}\right) \exp \left( \frac{{v}_{\mathrm{{IN}}}}{n{V}_{t}}\right) } \tag{7.4-17}
$$
In Fig. 7.4-3, $b$ is the ratio of M6 to M4 (and also M8 to M3 where M7 equals M9). Figure 7.4-5 shows parametric curves of normalized output current as a function of input voltage for various values of $A$ . This configuration can be very useful when very low quiescent current is required and considerable transient currents may be needed to drive capacitors in sampled-data filter applications.
The enhanced performance of Fig. 7.4-4 is a result of both negative and positive feedback. This can be seen by tracing the signal path from the gate of M28 through M2 to the gate of M19 and back to the gate of M28. The negative-feedback path starts at the gate of M28

Figure 7.4-5 Parametric curves showing normalized output current versus input voltage for different values of $A$ .
through M1 to the gate of M20 and through M24 back to the gate of M28. For this system to be stable during linear operation, the influence of the negative-feedback path must overwhelm the positive-feedback path. It is easy to see that the gain of the positive-feedback loop is
$$
\text{Positive-feedback loop gain} = \left( \frac{{g}_{m28}}{{g}_{m4}}\right) \left( \frac{{g}_{m19}}{{g}_{m26}}\right)  = A\frac{{g}_{m19}}{{g}_{m4}} = A \tag{7.4-18}
$$
The gain of the negative-feedback path is
$$
\text{Negative-feedback loop gain} = \left( \frac{{g}_{m28}}{{g}_{m3}}\right) \left( \frac{{g}_{m20}}{{g}_{m22}}\right) \left( \frac{{g}_{m24}}{{g}_{m26}}\right)  = A \tag{7.4-19}
$$
As a voltage difference is applied at the input, the currents in the two paths change and the gain of the positive-feedback path increases while the gain of the negative-feedback path decreases. This leads to the overdrive seen in Fig. 7.4-5. If $A$ becomes too large, then the system is indeed unstable and the current will tend to infinity. The current, however, will not reach infinity. The input transistors will leave the weak inversion region and Eq. (7.4-17) is no longer valid. It has been shown that from a large-signal viewpoint, this system is stable [13]. The maximum possible output current will be determined by the product of ${K}^{\prime }$ and $W/L$ and the supply voltage. The above analysis assumes ideal matching of the current mirrors. If better current mirrors are not used, this mismatch must be considered.
Another advantage of operating the transistors in the subthreshold region is that the gate-source voltage applied for proper circuit operation can easily be below the threshold voltage by ${100}\mathrm{{mV}}$ or more. Therefore, the ${v}_{DS}$ saturation voltage is typically below ${100}\mathrm{{mV}}$ . As a result of these small voltage drops, the op amp operating in weak inversion can easily function with a ${1.5}\mathrm{\;V}$ supply, provided that signal swings are kept small. Because of this low-voltage operation, circuits operating in weak inversion are very amenable to implantable, biomedical applications, where battery size and capacity are limited.

Figure 7.4-6 (a) Current mirror with M2 operating in the active region. (b) Illustration of the drain currents of M1 and M2.
## Increasing the Output Current for Strong Inversion Operation
The technique used above for boosting the output current can also be used for amplifiers working in strong inversion. In this case, $A$ should be less than one since no mechanism exists to limit the current as it increases except the power supplies. Other techniques exist that allow boosting of the output current above the quiescent value. One of these is shown in Fig. 7.4-6. This is a simple current mirror with the output transistor operating in the active region. If the mirror is designed so that M1 and M2 have equal currents when M2 is in the active region, then if M2 can be moved from the active region to the saturation region, the current mirror will experience a current gain. Let us consider an example to illustrate this concept.
---
Example 7.4-2
---
## Current Mirror with M2 Operating in the Active Region
Assume that M2 has a voltage across the drain-source of ${0.1}{V}_{ds}$ (sat). Design the ${W}_{2}/{L}_{2}$ ratio so that ${I}_{1} = {I}_{2} = {100\mu }\mathrm{A}$ if ${W}_{1}/{L}_{1} = {10}$ . Find the value of ${I}_{2}$ if $\mathrm{M}2$ is saturated.
## SOLUTION
Using the parameters of Table 3.1-2, we find that the saturation voltage of M2 is
$$
{V}_{ds1}\left( \mathrm{{sat}}\right)  = \sqrt{\frac{2{I}_{1}}{{K}_{N}^{\prime }\left( {{W}_{1}/{L}_{1}}\right) }} = \sqrt{\frac{200}{{110} \cdot  {10}}} = {0.4264}\mathrm{\;V}
$$
Now, using the active equation of $\mathrm{M}2$ , we set ${I}_{2} = {100\mu }\mathrm{A}$ and solve for ${W}_{2}/{L}_{2}$ .
$$
{100\mu }\mathrm{A} = {K}_{N}^{\prime }\left( {{W}_{2}/{L}_{2}}\right) \left\lbrack  {{V}_{ds1}\left( \mathrm{{sat}}\right)  \cdot  {V}_{ds2} - {0.5}{V}_{ds2}^{2}}\right\rbrack
$$
$$
= {110\mu }\mathrm{A}/{\mathrm{V}}^{2}\left( {{W}_{2}/{L}_{2}}\right) \left\lbrack  {{0.426} \cdot  {0.0426} - {0.5} \cdot  {0.0426}^{2}}\right\rbrack  {\mathrm{V}}^{2} = {1.883} \times  {10}^{-6}\left( {{W}_{2}/{L}_{2}}\right)
$$
Thus,
$$
{100} = {1.883}\left( {{W}_{2}/{L}_{2}}\right)  \rightarrow  \frac{{W}_{2}}{{L}_{2}} = {53.12}
$$
Now if M2 should become saturated, the value of the output current of the mirror with 100 $\mu \mathrm{A}$ input would be ${531\mu }\mathrm{A}$ or a boosting of 5.31 times ${I}_{1}$ .

Figure 7.4-7 Implementation of the current-mirror boosting concept using the differential-output op amp of Fig. 7.3-11.
The above example illustrates the concept. The implementation of this concept is shown in Fig. 7.4-7 and is easy to do using the differential-output op amps considered in Section 7.3. The current mirrors that have the boosting applied to them consist of M7 and M9, M8 and M10, M5 and M11, and M6 and M12. Normally, M9, M10, M11, and M12 are operating in the active region because the gate-source drops of M13 and M21, M14 and M22, M15 and M23, and M16 and M24 are designed to put these transistors in the active region when the quiescent value of ${i}_{1}$ or ${i}_{2}$ is flowing. Assume that when a differential input is applied, ${i}_{1}$ will increase and ${i}_{2}$ decrease. The increased value of ${i}_{1}$ flowing through M21 and M24 will bring M9 and M12 back into saturation, allowing the current mirrors M7 and M9 and M6 and M12 to achieve a current gain of $k$ , where $k$ is the boosting factor of the mirror $(k = {5.31}$ in Example 7.4-2). The current mirrors in the ${i}_{2}$ path will have a gain less than one, which also increases the current available at the differential outputs. Unfortunately, as M9, M10, M11, and M12 move toward the saturation region as the gate-source voltages of M21, M22, M23, and M24 increase, the gate-source voltage of M13, M14, M15, and M16 also increase, keeping M9 through M12 from becoming saturated. The current mirror boosting concept applied to the regulated-cascode current mirror avoids this problem and gives better performance.
A good example of a low-power op amp with the ability to sink and source large output currents is found in a commercially available CMOS op amp [18]. Figure 7.4-8 shows the details of this op amp. The gain stages are included within the op amp symbol and the transistors shown are for the purposes of providing the large sink and source output currents. The key to this design is the floating battery (which of course is implemented by MOSFETs) designed to give the threshold voltage plus 0.1 V across the gate-sources of M2 and M3. In other words, the value of this battery voltage is
$$
{V}_{\text{Bat }} = \left| {V}_{TP}\right|  + {0.1}\mathrm{\;V} + {V}_{TN} + {0.1}\mathrm{\;V} = \left| {V}_{TP}\right|  + {V}_{TN} + {0.2}\mathrm{\;V} \tag{7.4-20}
$$
Also, the quiescent voltage, ${V}_{1}\left( Q\right)$ , of the output of the gain stage is assumed to be equal to
$$
{V}_{1}\left( Q\right)  = {V}_{DD} - \left| {V}_{TP}\right|  - {0.1}\mathrm{\;V} \tag{7.4-21}
$$

Figure 7.4-8 Output circuit of a low-power, high-output-current op amp.
Note that the gate-source voltage of M3, which is ${V}_{TN} + {0.1}\mathrm{\;V}$ , is translated to the gate-source of M1 via the path M4-M5-M6. Also note that the path M4-M5-M6-M7 is positive feedback but the presence of ${V}_{\text{Bat }}$ makes the gain close to zero (the impedance of the ${V}_{\text{Bat }}$ implementation will be of importance).
Assume that the output voltage of the gain stage, ${v}_{1}$ , increases by an amount ${\Delta v}$ . In this case, the gate-source voltage of $\mathrm{M}1$ is ${V}_{TN} + {0.1}\mathrm{\;V} + {\Delta v}$ and the source-gate voltage of $\mathrm{M}2$ is $\left| {V}_{TP}\right|  + {0.1}\mathrm{\;V} - {\Delta v}$ . Therefore, $\mathrm{M}1$ is on and $\mathrm{M}2$ is off. If ${v}_{1}$ decreases by an amount ${\Delta v}$ , M1 will be off and M2 on. This particular op amp is specified as having a quiescent current of ${1.2\mu }\mathrm{A}$ and typical sink/source output currents of ${300\mu }\mathrm{A}/{600\mu }\mathrm{A}$ for power supplies that vary from 2.5 to ${10}\mathrm{\;V}$ . The following example illustrates the degree of overdrive current available in this op amp.
---
Example 7.4-3
---
## Overdrive Current Available in Fig. 7.4-8
Assume that ${v}_{1}$ varies about ${V}_{1}\left( Q\right)$ by $\pm  {0.3}\mathrm{\;V}$ and that the $W/L$ values of $\mathrm{M}1$ and $\mathrm{M}2$ are 50 and 150 , respectively. Calculate the sink/source output currents.
## SOLUTION
If ${v}_{1} =  \pm  {0.1}\mathrm{\;V}$ , then, effectively, $\pm  {0.2}\mathrm{\;V}$ about the quiescent value of gate-source voltage is applied to M1 and M2. The sinking current will occur when M1 is on and M2 is off because ${v}_{1} > 0$ . When ${v}_{1} = {V}_{1}\left( Q\right)  + {0.3}\mathrm{\;V}$ , the current in $\mathrm{M}1$ is
$$
{i}_{D1} = \frac{{K}_{N}^{\prime } \cdot  {W}_{1}}{2{L}_{1}}{\left( {0.4}\mathrm{\;V}\right) }^{2} = \frac{{110} \cdot  {50}}{2}\left( {0.16}\right) \mu \mathrm{A} = {440\mu }\mathrm{A}
$$
When ${v}_{1} = {V}_{1}\left( Q\right)  - {0.3}\mathrm{\;V}$ , the current in $\mathrm{M}2$ is
$$
{i}_{D2} = \frac{{K}_{P}^{\prime } \cdot  {W}_{2}}{2{L}_{2}}{\left( {0.4}\mathrm{\;V}\right) }^{2} = \frac{{50} \cdot  {150}}{2}\left( {0.16}\right) \mu \mathrm{A} = {600\mu }\mathrm{A}
$$
As the variation around ${V}_{1}\left( Q\right)$ increases, the output sink/source currents will also increase. In this particular op amp, the output sink/source currents can be as large as $2\mathrm{{mA}}$ .
This section has examined the subject of low-power op amps. In most low-power op amps, the transistors are working in the subthreshold or weak inversion region. This also allows the power supplies to be small, which is an advantage for battery-powered circuits. The disadvantage of weak inversion operation is that the small currents imply low bandwidths. Under dynamic conditions, it is possible to achieve large output currents using techniques that boost the output sink/source current capability.
### 7.5 Low-Noise Op Amps
Low-noise op amps are important in applications where a large dynamic range is required. The dynamic range can be expressed as the signal-to-noise ratio (SNR). The significance of dynamic range can be appreciated when considering the dynamic range necessary for signal resolution in terms of digital bits. It will be shown in Chapter 9 that a dynamic range of $6\mathrm{\;{dB}}$ is required for every bit of resolution. Thus, if an op amp is processing a signal that will be converted into a 14 bit digital signal, a dynamic range of over ${84}\mathrm{\;{dB}}$ or16,400is required. As CMOS technology continues to improve, the power supplies are decreasing and maximum signal levels of $1\mathrm{\;V}$ are not unusual. The rms value of a sinusoid with a $1\mathrm{\;V}$ peak-to-peak value is 0.354 Vrms. If this is divided by 16,400, then the op amp must have a noise floor that is less than 21.6 $\mu \mathrm{V}$ rms.
In addition to noise as a lower limit, one must also consider the linearity of the op amp. If the op amp is nonlinear, then a pure sinusoidal signal will generate harmonics. If the total harmonic distortion (THD) of these harmonics exceeds the noise, then nonlinearity becomes the limiting factor. Sometimes the notation of signal-to-noise plus distortion (SNDR) is used to include both noise and distortion in the dynamic range consideration. One should also consider the influence of unwanted signals such as power-supply injection or charge injection (due to switches). Low-noise op amps must have a sufficiently high PSRR in order to achieve the desired lower limit of the dynamic range. In this section, we will make the important assumption that the op amps are linear and have a high PSRR and focus only on the noise.
In Section. 3.2, the noise performance of a MOSFET was described. The noise in a MOSFET was modeled as a mean-square current generator in the channel given in Eq. (3.2-12), repeated here for convenience.
$$
{i}_{N}^{2} = \left\lbrack  {\frac{{8kT}{g}_{m}\left( {1 + \eta }\right) }{3} + \frac{\left( \mathrm{{KF}}\right) {I}_{D}}{f{C}_{\mathrm{{ox}}}{L}^{2}}}\right\rbrack  {\Delta f}\;\left( {\mathrm{\;A}}^{2}\right)  \tag{7.5-1}
$$
It is customary to reflect this noise as a mean-square voltage generator in series with the gate by dividing Eq. (7.5-1) by ${g}_{m}^{2}$ to get Eq. (3.2-13), also repeated here for convenience.
$$
{e}_{\text{eq }}^{2} = \left\lbrack  {\frac{{8kT}\left( {1 + \eta }\right) }{3{g}_{m}} + \frac{\mathrm{{KF}}}{{2f}{C}_{\text{ox }}{WL}{K}^{\prime }}}\right\rbrack  {\Delta f}\;\left( {\mathrm{\;V}}^{2}\right)  \tag{7.5-2}
$$
It is important to remember that Eq. (7.5-2) is only valid for the case where the source of the MOSFET is on ac ground. For example, Eq. (7.5-2) would not be valid if the transistor was in the cascode configuration. In that case, one would either use the effective transconductance [see Eq. (5.2-35)] or simply use Eq. (7.5-1).
The noise of the MOSFET consists of two parts as shown in Eq. (7.5-1) or (7.5-2). The first part is the thermal noise and the second is called the $1/f$ noise. In many respects, the thermal noise of a MOSFET device is equivalent to the thermal noise of a BJT. Unfortunately, the 1/f noise of a MOSFET is much larger than the $1/f$ noise of a BJT. One might feel that the $1/f$ noise is only important at low frequencies because it varies inversely with frequency. However, the $1/f$ noise is aliased around clock frequencies and therefore becomes significant even at higher frequencies. For example, when MOSFETs are used to build a high-frequency VCO, the spectral purity of the sinusoid is limited among other things by the $1/f$ noise [19].
Minimizing the thermal noise of op amps is reasonably straightforward. From the first term in Eq. (7.5-2), we see that we want the small-signal transconductance, ${g}_{m}$ , to be large to minimize the equivalent input-mean-square noise voltage. This can be done by large dc currents or large $W/L$ ratios. For the $1/f$ noise, there are at least three approaches to minimizing the $1/f$ noise of CMOS op amps. The first is to minimize the noise contribution of the MOSFETs through circuit topology and transistor selection (NMOS versus PMOS), dc currents, and W/L ratios. The second is to replace the MOSFETs by BJTs to avoid the $1/f$ noise. The third is to use external means, such as chopper stabilization, to minimize the $1/f$ noise. Since the $1/f$ noise is generally more crucial, we will focus on reducing this noise in the remainder of this section.
## Low-Noise Op Amps Using MOSFETs
The first approach to minimizing the $1/f$ noise uses circuit topology and transistor selection. The transistor selection is easy. Empirically, PMOS transistors have about two to five times less 1/f noise than NMOS transistors.* Therefore, PMOS transistors should be used where it is important to reduce the $1/f$ noise. The circuit topology is also straightforward. The one principle that is key in minimizing noise is to make the first stage gain as high as possible. This means that if the input is a differential amplifier, the source-coupled transistors should be PMOS and the gain of the differential amplifier must be as large as possible. This was shown to be true in Section 5.2 for the differential amplifier, where it was found that the lengths of the load transistors should be greater than the lengths of the input transistors to minimize the $1/f$ noise.
Figure 7.5-1 shows a CMOS op amp that achieves low noise by careful selection of the $W/L$ ratios [20]. This op amp is similar to the two-stage op amp of Section 6.3 except for the cascode devices, M8 and M9, which are used to improve the PSRR as discussed in Section 6.4. Also, returning the compensation capacitor to the source of M9 allows the output pole to be increased [see Fig. 6.2-16(a)]. PMOS devices are selected for the input of the differential stage because of their lower $1/f$ noise. Figure 7.5-2 gives a noise model for the op amp of Fig. 7.5-1 ignoring the noise contributed by the dc current sources. Ignoring the current sources is justified because their gates are usually connected to a low impedance.
The noise model of Fig. 7.5-1 is shown in Fig. 7.5-2. We have ignored the noise contributed by M5 in this model. The total output-voltage-noise spectral density ${\mathrm{e}}_{to}^{2}$ is given in Eq. (7.5-3), where we have assumed that the effective transconductance of M8 and M9 used to calculate the contribution of the noise of these transistors to the output noise is approximately $1/{r}_{ds1}$ ; that is, ${g}_{m8}/\left( {1 + {g}_{m8}{r}_{ds1}}\right)  \approx  1/{r}_{ds1}$ .
$$
{e}_{to}^{2} = {g}_{m2}^{2}{R}_{II}^{2}\left\lbrack  {{e}_{n6}^{2} + {e}_{n7}^{2} + {R}_{I}^{2}\left( {{g}_{m1}^{2}{e}_{n1}^{2} + {g}_{m2}^{2}{e}_{n2}^{2} + {g}_{m3}^{2}{e}_{n3}^{2} + {g}_{m4}^{2}{e}_{n4}^{2} + \frac{{e}_{n8}^{2}}{{r}_{ds1}^{2}} + \frac{{e}_{n9}^{2}}{{r}_{ds2}^{2}}}\right) }\right\rbrack   \tag{7.5-3}
$$
---
*Values for KF for a ${0.6\mu }\mathrm{m}$ TSMC CMOS technology are KF $= 1 \times  {10}^{-{23}}\mathrm{\;F} - \mathrm{A}$ for the n-channel and $\mathrm{{KF}} = 5 \times  {10}^{-{24}}\mathrm{\;F} - \mathrm{A}$ for the p-channel.
---

Figure 7.5-1 A low-noise CMOS op amp.
The equivalent input-voltage-noise spectral density can be found by dividing Eq. (7.5-3) by the differential gain of the op amp ${g}_{m1}{R}_{I}{g}_{m6}{R}_{II}$ to get
$$
{e}_{\mathrm{{eq}}}^{2} = \frac{{e}_{to}^{2}}{\left( {g}_{m1}{g}_{m6}{R}_{I}{R}_{II}\right) } = \frac{2{e}_{n6}^{2}}{{g}_{m1}^{2}{R}_{I}^{2}} + 2{e}_{n1}^{2}\left\lbrack  {1 + {\left( \frac{{g}_{m3}}{{g}_{m1}}\right) }^{2}{\left( \frac{{e}_{n3}^{2}}{{e}_{n1}^{2}}\right) }^{2} + \frac{{e}_{n8}^{2}}{{g}_{m1}^{2}{r}_{d51}^{2}{e}_{n1}^{2}}}\right\rbrack   \tag{7.5-4}
$$
where ${e}_{n6}^{2} = {e}_{n7}^{2},{e}_{n3}^{2} = {e}_{n4}^{2},{e}_{n1}^{2} = {e}_{n2}^{2}$ , and ${e}_{n8}^{2} = {e}_{n9}^{2}$ . It is seen from Eq. (7.5-4) that the noise contribution of the second stage is divided by the gain of the first stage and can therefore be neglected. Also, the noise of the cascode transistors, M8 and M9, is divided by ${\left( {g}_{m1}{r}_{ds1}\right) }^{2}$ , which means that their contribution can be neglected. The resulting equivalent input-voltage-noise spectral density can be approximately expressed as
$$
{e}_{\mathrm{{eq}}}^{2} \approx  2{e}_{n1}^{2}\left\lbrack  {1 + {\left( \frac{{g}_{m3}}{{g}_{m1}}\right) }^{2}\left( \frac{{e}_{n3}^{2}}{{e}_{n1}^{2}}\right) }\right\rbrack   \tag{7.5-5}
$$

Figure 7.5-2 Noise model for Fig. 7.5-1.
Now we must select the model to be inserted in the spectral density noise sources in Fig. 7.5-2. Because we are focusing on $1/f$ noise we will replace these sources by
$$
{e}_{ni}^{2} = \frac{B}{f{W}_{i}{L}_{i}}\;\left( {{\mathrm{V}}^{2}/\mathrm{{Hz}}}\right)  \tag{7.5-6}
$$
if the source is voltage and
$$
{i}_{ni}^{2} = \frac{{2B}{K}^{\prime }{I}_{i}}{f{L}_{i}^{2}}\;\left( {{\mathrm{\;A}}^{2}/\mathrm{{Hz}}}\right)  \tag{7.5-7}
$$
if the source is current. Equation (7.5-6) is identical with Eq. (3.2-15). Substituting the appropriate choice for the spectral density noise sources into Eq. (7.5-5) gives
$$
{e}_{\mathrm{{eq}}}^{2} = 2{e}_{n1}^{2}\left\lbrack  {1 + \left( \frac{{K}_{N}^{\prime }{B}_{N}}{{K}_{P}^{\prime }{B}_{P}}\right) {\left( \frac{{L}_{1}}{{L}_{3}}\right) }^{2}}\right\rbrack  \;\left( {{\mathrm{V}}^{2}/\mathrm{{Hz}}}\right)  \tag{7.5-8}
$$
To minimize the noise of Fig. 7.5-1, Eq. (7.5-8) must be minimized. Because we have selected PMOS devices as the input (M1 and M2) the value of ${e}_{n1}^{2}$ has been minimized if we choose the product of ${W}_{1}$ and ${L}_{1}\left( {W}_{2}\right.$ and $\left. {L}_{2}\right)$ large. Next, we want to reduce the value of the term in the square brackets of Eq. (7.5-8). The only variable available to do so is the ratios of ${L}_{1}$ to ${L}_{3}$ . Selecting these ratios less than one gives an equivalent input spectral noise density of $2{e}_{n1}^{2}$ .
For completeness sake, let us find the equivalent input spectral noise density if thermal noise is of concern. Equations (7.5-6) and (7.5-7) become
$$
{e}_{ni}^{2} \approx  \frac{8kT}{3{g}_{m}}\;\left( {{\mathrm{\;V}}^{2}/\mathrm{{Hz}}}\right)  \tag{7.5-9}
$$
if the source is voltage and
$$
{i}_{ni}^{2} \approx  \frac{{8kT}{g}_{m}}{3}\;\left( {{\mathrm{\;A}}^{2}/\mathrm{{Hz}}}\right)  \tag{7.5-10}
$$
if the source is current and the influence of the bulk can be ignored $\left( {\eta  = 0}\right)$ . Substituting the appropriate choice for the spectral density noise sources into Eq. (7.5-5) gives
$$
{e}_{\mathrm{{eq}}}^{2} = 2{e}_{n1}^{2}\left\lbrack  {1 + \frac{{g}_{m3}}{{g}_{m1}}\left( \frac{{e}_{n3}^{2}}{{e}_{n1}^{2}}\right) }\right\rbrack   = 2{e}_{n1}^{2}\left\lbrack  {1 + \sqrt{\frac{{K}_{N}{W}_{3}{L}_{1}}{{K}_{P}{W}_{1}{L}_{3}}}}\right\rbrack  \left( {{\mathrm{V}}^{2}/\mathrm{{Hz}}}\right)  \tag{7.5-11}
$$
We see that the choices to reduce the $1/f$ noise will also reduce the thermal noise.
Once the equivalent input spectral noise density is known, the rms value of the noise can be found by integrating the input spectral noise density over the bandwidth. The noise corner where the thermal noise is equal to the $1/f$ noise can be found for a single transistor by equating Eqs. (7.5-6) and (7.5-9) to get
$$
{f}_{c} = \frac{3{g}_{m}B}{8kTWL} \tag{7.5-12}
$$
The following example illustrates the design of a CMOS op amp to minimize the $1/f$ noise.
## Design of Fig. 7.5-1 for Low 1/f Noise Performance
Use the parameters of Table 3.1-2 along with the value of $\mathrm{{KF}} = 4 \times  {10}^{-{28}}\mathrm{\;F} - \mathrm{A}$ for NMOS and ${0.5} \times  {10}^{-{28}}\mathrm{\;F} - \mathrm{A}$ for PMOS and design the op amp of Fig. 7.5-1 to minimize the $1/f$ noise. Calculate the corresponding thermal noise and solve for the noise corner frequency. From this information, estimate the rms noise in a frequency range of $1\mathrm{\;{Hz}}$ to ${100}\mathrm{{kHz}}$ . What is the dynamic range of this op amp if the maximum signal is a $1\mathrm{\;V}$ peak-to-peak sinusoid?
## SOLUTION
First, we must calculate the various parameters needed. The $1/f$ noise constants, ${B}_{N}$ and ${B}_{P}$ , are calculated as follows:
$$
{B}_{N} = \frac{\mathrm{{KF}}}{2{C}_{\mathrm{{ox}}}{K}_{N}^{\prime }} = \frac{4 \times  {10}^{-{28}}\mathrm{\;F} - \mathrm{A}}{2 \cdot  {24.7} \times  {10}^{-4}\mathrm{\;F}/{\mathrm{m}}^{2} \cdot  {110} \times  {10}^{-6}{\mathrm{\;A}}^{2}/\mathrm{V}} = {7.36} \times  {10}^{-{22}}{\left( V - m\right) }^{2}
$$
and
$$
{B}_{P} = \frac{\mathrm{{KF}}}{2{C}_{\mathrm{{ox}}}{K}_{P}^{\prime }} = \frac{{0.5} \times  {10}^{-{28}}\mathrm{\;F} - \mathrm{A}}{2 \cdot  {24.7} \times  {10}^{-4}\mathrm{\;F}/{\mathrm{m}}^{2} \cdot  {50} \times  {10}^{-6}{\mathrm{\;A}}^{2}/\mathrm{V}} = {2.02} \times  {10}^{-{22}}{\left( V - m\right) }^{2}
$$
Now let us select the geometry of the various transistors that influence the noise performance. To keep ${e}_{n1}^{2}$ small, let ${W}_{1} = {100\mu }\mathrm{m}$ and ${L}_{1} = {1\mu }\mathrm{m}$ . Select ${W}_{3} = {100\mu }\mathrm{m}$ and ${L}_{3} =$ ${20\mu }\mathrm{m}$ and let the $W$ and $L$ of M8 be the same as M1 since it has little influence on the noise. Of course, M1 is matched with M2, M3 with M4, and M8 with M9. To check the impact of these choices, let us evaluate Eq. (7.5-8).
First, use Eq. (7.5-6) to calculate ${e}_{n1}^{2}$ .
$$
{e}_{n1}^{2} = \frac{{B}_{p}}{f{W}_{1}{L}_{1}} = \frac{{2.02} \times  {10}^{-{22}}}{f \cdot  {100\mu }\mathrm{m} \cdot  {1\mu }\mathrm{m}} = \frac{{2.02} \times  {10}^{-{12}}}{f}{\mathrm{\;V}}^{2}/\mathrm{{Hz}}
$$
Evaluating Eq. (7.5-8) gives
$$
{e}_{\mathrm{{eq}}}^{2} = 2 \times  \frac{{2.02} \times  {10}^{-{12}}}{f}\left\lbrack  {1 + \left( \frac{{110} \cdot  {7.36}}{{50} \cdot  {2.02}}\right) {\left( \frac{1}{100}\right) }^{2}}\right\rbrack   = \frac{{4.04} \times  {10}^{-{12}}}{f}{1.0008}
$$
$$
= \frac{{4.043} \times  {10}^{-{12}}}{f}{\mathrm{\;V}}^{2}/\mathrm{{Hz}}
$$
To help interpret this result, at ${100}\mathrm{\;{Hz}}$ , the voltage noise in a $1\mathrm{\;{Hz}}$ band is approximately $4 \times  {10}^{-{14}}{\left( {\mathrm{\;V}}_{\mathrm{{rms}}}\right) }^{2}$ or ${0.202\mu }\left( {\mathrm{V}}_{\mathrm{{rms}}}\right)$ .
The thermal noise is calculated from Eqs. (7.5-9) and (7.5-11). From Eq. (7.5-9) let us assume that ${I}_{1} = {50\mu }\mathrm{A}$ . Therefore, at room temperature, we get
$$
{e}_{n1}^{2} = \frac{8kT}{3{g}_{m}} = \frac{8 \cdot  {1.38} \times  {10}^{-{23}} \cdot  {300}}{3 \cdot  {707} \times  {10}^{-6}} = {1.562} \times  {10}^{-{17}}{\mathrm{\;V}}^{2}/\mathrm{{Hz}}
$$
---
Example 7.5-1
---
Putting this value into Eq. (7.5-11) gives
$$
{e}_{\mathrm{{eq}}}^{2} = 2 \cdot  {1.562} \times  {10}^{-{17}}\left\lbrack  {1 + \sqrt{\frac{{110} \cdot  {100} \cdot  1}{{50} \cdot  {100} \cdot  {20}}}}\right\rbrack   = {3.124} \times  {10}^{-{17}} \cdot  {1.33}
$$
$$
= {4.164} \times  {10}^{-{17}}{\mathrm{\;V}}^{2}/\mathrm{{Hz}}
$$
The noise corner frequency is found by equating the two expressions for ${e}_{\mathrm{{eq}}}^{2}$ to get
$$
{f}_{c} = \frac{{4.043} \times  {10}^{-{12}}}{{4.164} \times  {10}^{-{17}}} = {97.1}\mathrm{{kHz}}
$$
This noise corner is indicative of the fact that the thermal noise is much less than the $1/f$ noise.
To estimate the rms noise in the bandwidth from $1\mathrm{\;{Hz}}$ to ${100}\mathrm{{kHz}}$ , we will ignore the thermal noise and consider only the $1/f$ noise. Performing the integration gives
$$
{V}_{\mathrm{{eq}}}^{2}\left( \mathrm{{rms}}\right)  = {\int }_{1}^{100,000}\frac{{4.066} \times  {10}^{-{12}}}{f}{df} = {4.066} \times  {10}^{-{12}}\left\lbrack  {\ln \left( {{100},{000}}\right)  - \ln \left( 1\right) }\right\rbrack
$$
$$
= {0.468} \times  {10}^{-{10}}{\left( {\mathrm{\;V}}_{\mathrm{{rms}}}\right) }^{2} = {6.84\mu }{\mathrm{V}}_{\mathrm{{rms}}}
$$
The maximum signal in rms is ${0.353}\mathrm{\;V}$ . Dividing this by ${6.84\mu }\mathrm{V}$ gives51,594or ${94.25}\mathrm{\;{dB}}$ , which is equivalent to about 16 bits of resolution.
The design of the remainder of the op amp will have little influence on the noise and is not included in this example.
The limit of noise reduction is the thermal noise. In the above example, the $1/f$ noise was dominant throughout most of the effective bandwidth of the op amp so that this noise limit is never reached. To reduce the $1/f$ noise in this example, the value of ${e}_{n1}^{2}$ must be reduced. The only parameters available to the designer are the product of $W$ and $L$ . In order to reduce the noise by a factor of 10, the ${WL}$ product must be increased by a factor of 10 (see Problem 7.5-2). A low-noise op amp should have a thermal noise less than ${10}\mathrm{{nV}}/\mathrm{{VHz}}$ . We note that the thermal noise of the op amp in Example 7.5-1 is $\sqrt{{2.548} \times  {10}^{-{17}}}V/\sqrt{\mathrm{{Hz}}} = {5.05}\mathrm{{nV}}/$ VHz. Unfortunately, the 1/f noise prevents the low thermal noise from being realized.
## Low-Noise Op Amps Using Both MOSFETs and Lateral BJTs
Because the $1/f$ noise of BJTs is lower than the $1/f$ noise of MOSFETs, the corner frequency (the intersection of the $1/f$ and thermal noise) is lower for BJTs. Consequently, one would prefer to use BJT devices rather than MOS devices if noise at low frequencies (less than $1\mathrm{{kHz}}$ ) is important. For example, the corner frequency of a typical BJT may be in the vicinity of ${10}\mathrm{\;{Hz}}$ compared to ${1000}\mathrm{\;{Hz}}$ for the typical MOS. Unfortunately, the CMOS process as presented in Chapter 2 does not appear to allow uncommitted BJTs to be fabricated. However, it has been shown that a good bipolar junction transistor can be achieved that is compatible with any bulk CMOS technology [21]. This BJT is a lateral BJT, which is illustrated in Fig. 7.5-3(a). We see that the lateral BJT requires a well that can be reverse biased to electrically isolate it from the substrate. The well becomes the base of the BJT and the diffusions for the source/drain become the emitter and collector. The carriers injected from the emitter have two possible collectors. One collector is the diffused collector, which typically surrounds the emitter for more efficiency. The other collector is the substrate. The substrate collector must be connected to the highest or lowest dc potential depending on the type of substrate. Figure 7.5-3(b) shows the symbol that represents the double-collector BJT of Fig. 7.5-3(a). Lateral current will flow toward the desired collectors while vertical current will flow to the substrate. It is usually desired to make the portion of emitter current that reaches the lateral collector as large as possible. Typical factors of ${60} - {70}\%$ result from most technologies.

Figure 7.5-3 (a) Cross section of an NPN lateral BJT. (b) Symbol for (a).
Most lateral BJTs fabricated from a CMOS process use the polysilicon gate to define the separation between the emitter and collector and to force the carriers to flow below the surface. This is accomplished by a gate voltage, which does not allow the surface under the gate to invert. Another important property of the lateral BJT is that it acts like a photodetector with good efficiency. Hole-electron pairs in the reverse-biased collector-base junction can be generated by incident light. Such devices can be used to form the photodetector in light-sensitive arrays. Figure 7.5-4(a) shows the cross section of what is called the field-aided lateral BJT. Figure 7.5-4(b) shows the symbol for this device.
Figure 7.5-5 shows the top view of the field-aided lateral BJT using a p-well CMOS technology. Generally, the geometry shown is made as small as possible and then paralleled with identical geometries to form a single lateral BJT. A PNP lateral transistor using 40 parallel minimum size structures fabricated in a ${1.2\mu }\mathrm{m}$ CMOS process gave the performance summarized in Table 7.5-1 [22].

Figure 7.5-4 (a) Cross section of a field-aided NPN lateral BJT. (b) Symbol for (a).

Figure 7.5-5 Geometry of a lateral NPN transistor.
We note that from a noise viewpoint, the lateral BJT is an excellent solution. The 1/f noise has a corner frequency of ${3.2}\mathrm{\;{Hz}}$ , which is orders of magnitude less than normal CMOS op amps. The only disadvantages of the lateral are a large area and low ${f}_{T}$ . Fortunately, only the source-coupled transistors in the input differential amplifier need to be BJTs so the area is not a great concern. An ${f}_{T}$ of ${85}\mathrm{{MHz}}$ is sufficient to build an op amp with respectable ${GB}$ . Because the BJT has current flowing in the base, the equivalent input current noise is also shown.
A low-noise op amp was designed and fabricated using the above lateral BJT as the input transistors [22]. The op amp is shown in Fig. 7.5-6 and is a two-stage Miller op amp with a push-pull output. The equivalent input noise for this op amp is shown in Fig. 7.5-7. This noise performance equals that of low-noise op amps using JFET inputs to achieve low-noise performance. The performance of Fig. 7.5-6 is summarized in Table 7.5-2.
Table 7.5-1 Performance of an Experimental Lateral PNP Transistor
<table><tr><td>Characteristic</td><td>Value</td></tr><tr><td>Transistor area</td><td>${0.006}\;\mathrm{m}{\mathrm{m}}^{2}$</td></tr><tr><td>Lateral $\beta$</td><td>90</td></tr><tr><td>Lateral efficiency</td><td>70%</td></tr><tr><td>Base resistance</td><td>150 Ω</td></tr><tr><td>${e}_{n}$ at $5\mathrm{\;{Hz}}$</td><td>2.46 nV/VHz</td></tr><tr><td>${e}_{n}$ (midband)</td><td>${1.92}\mathrm{{nV}}/\mathrm{{VHz}}$</td></tr><tr><td>${f}_{c}\left( {e}_{n}\right)$</td><td>${3.2}\mathrm{\;{Hz}}$</td></tr><tr><td>${i}_{n}$ at $5\mathrm{\;{Hz}}$</td><td>${3.53}\mathrm{{pA}}/\mathrm{{VHz}}$</td></tr><tr><td>${i}_{n}$ (midband)</td><td>${0.61}\mathrm{{pA}}/\mathrm{{VHz}}$</td></tr><tr><td>${f}_{c}\left( {i}_{n}\right)$</td><td>${162}\mathrm{\;{Hz}}$</td></tr><tr><td>${f}_{T}$</td><td>85 MHz</td></tr><tr><td>Early voltage</td><td>16 V</td></tr></table>

Figure 7.5-6 A low-noise op amp using lateral BJTs at the input.
## Chopper-Stabilized Op Amps
Many imperfections of an op amp fall into the category of low-frequency or dc noise. Such imperfections include $1/f$ noise and input-offset voltage. It is possible to use circuitry to remove or diminish these imperfections. One such approach is the use of chopper stabilization [23].
The concept of chopper stabilization has been used for many years in designing precision dc amplifiers. The principle of chopper stabilization is illustrated in Fig. 7.5-8. Here, a two-stage amplifier and an input signal spectrum are shown. Inserted at the input and the output of the first stage are two multipliers, which are controlled by a chopping square wave of amplitude $+ 1$ and-1. After the first multiplier, ${V}_{A}$ , the signal is modulated and translated to the odd harmonic frequencies of the chopping square wave. At ${V}_{B}$ , the undesired signal ${V}_{w}$ which represents sources of noise or distortion, is added to the spectrum as shown in Fig. 7.5-8. After the second multiplier, ${V}_{C}$ , the signal is demodulated back to the original one and the undesired signal has been modulated as shown in Fig. 7.5-8. This chopping operation results in an equivalent input spectrum of the undesired signal as shown in Fig. 7.5-9. Here we see that the spectrum of the undesired signal has been shifted to the odd harmonic frequencies of the chopping square wave. Note that the spectrum of ${v}_{w}{V}_{u}\left( f\right)$ , has been folded back around the chopping frequency. If the chopper frequency is much higher than the signal bandwidth, then the amount of undesired signal in the passband of the signal will be greatly reduced. Since the undesired signal will consist of $1/f$ noise and the dc offset of the amplifier, the influence of this source of undesired signal is mixed out of the desired range of operation.

Figure 7.5-7 Experimental noise performance of Fig. 7.5-6.
Table 7.5-2 Summary of Experimental Performance for Fig. 7.5-6
<table><tr><td>Experimental Performance</td><td>Value</td></tr><tr><td>Circuit area $\left( {{1.2\mu }\mathrm{m}}\right)$</td><td>${0.211}\;\mathrm{m}{\mathrm{m}}^{2}$</td></tr><tr><td>Supply voltages</td><td>$\pm  {2.5}\mathrm{\;V}$</td></tr><tr><td>Quiescent current</td><td>${2.1}\mathrm{\;{mA}}$</td></tr><tr><td>$- 3\mathrm{\;{dB}}$ Frequency (at a gain of ${20.8}\mathrm{\;{dB}}$ )</td><td>11.1 MHz</td></tr><tr><td>${e}_{n}$ at $1\mathrm{\;{Hz}}$</td><td>23.8 nV/VHz</td></tr><tr><td>${e}_{n}$ (midband)</td><td>3.2 nV/V $\mathrm{{Hz}}$</td></tr><tr><td>${f}_{c}\left( {e}_{n}\right)$</td><td>55 Hz</td></tr><tr><td>${i}_{n}$ at $1\mathrm{\;{Hz}}$</td><td>${5.2}\mathrm{{pA}}/\mathrm{{VHz}}$</td></tr><tr><td>${i}_{n}$ (midband)</td><td>0.73 pA/VHz</td></tr><tr><td>${f}_{c}\left( {i}_{n}\right)$</td><td>50 Hz</td></tr><tr><td>Input bias current</td><td>${1.68\mu }\mathrm{A}$</td></tr><tr><td>Input-offset current</td><td>14.0 nA</td></tr><tr><td>Input-offset voltage</td><td>1.0 mV</td></tr><tr><td>CMRR(dc)</td><td>99.6 dB</td></tr><tr><td>PSRR ${}^{ + }$ (dc)</td><td>67.6 dB</td></tr><tr><td>PSRR ${}^{ - }$ (dc)</td><td>73.9 dB</td></tr><tr><td>Positive slew rate ( ${60}\mathrm{{pF}},{10}\mathrm{k}\Omega$ load)</td><td>39.0 V/μs</td></tr><tr><td>Negative slew rate ( ${60}\mathrm{{pF}},{10}\mathrm{k}\Omega$ load)</td><td>42.5 V/μs</td></tr></table>

Figure 7.5-8 Illustration of the concept of chopper stabilization to remove the undesired signal, ${v}_{u}$ , from the desired signal, ${v}_{\text{in }}$ .

Figure 7.5-9 Equivalent undesired signal input voltage spectrum for Fig. 7.5-8.
Figure 7.5-10(a) shows how the principle of chopper stabilization can be applied to a CMOS op amp. The multipliers are implemented by two cross-coupled switches, which are controlled by two nonoverlapping clocks. Figure 7.5-10(b) shows the operation of Fig. 7.5-10(a). When ${\phi }_{1}$ is on and ${\phi }_{2}$ is off, the equivalent undesired-input signal is equal to the equivalent undesired-input signal of the first stage plus that of the second divided by the gain of the first stage. Thus, the equivalent noise at the input during this phase is
$$
{v}_{\text{ueq }}\left( {\phi }_{1}\right)  = {v}_{u1} + \frac{{v}_{u2}}{{A}_{1}} \tag{7.5-13}
$$
In Fig. 7.5-10(c), ${\phi }_{1}$ is off and ${\phi }_{2}$ is on and the equivalent undesired-input signal is equal to the negative of the previous value, assuming that there has been no change in the undesired signal from the previous phase period. Again, the equivalent noise at the input during the ${\phi }_{2}$ phase is
$$
{v}_{\text{ueq }}\left( {\phi }_{2}\right)  =  - {v}_{u1} + \frac{{v}_{u2}}{{A}_{1}} \tag{7.5-14}
$$
The average of the equivalent input noise over the entire period can be expressed as
$$
{v}_{\text{ueq }}\left( \text{ aver }\right)  = \frac{{v}_{\text{ueq }}\left( {\phi }_{1}\right)  + {v}_{\text{ueq }}\left( {\phi }_{2}\right) }{2} = \frac{{v}_{u2}}{{A}_{1}} \tag{7.5-15}
$$
Through the chopping effect, the equivalent undesired-input signal has been removed. If the voltage gain of the first stage is high enough, then the contribution of the undesired signal from the second stage can be neglected. Consequently, the equivalent input noise (particularly the $1/f$ noise) of the chopper-stabilized op amp will be greatly reduced.
Figure 7.5-11(a) illustrates the experimental input noise of the op amp with the chopper at two different chopping frequencies and without the chopper. These results show that lower noise and offset voltage will be achieved using the chopper technique. It is seen that the higher the chopping frequency, the lower the noise. Figure 7.5-11(b) shows the experimental and calculated results where the chopper amplifier is used in a filter. The noise reduction at 1000 $\mathrm{{Hz}}$ is about ${10}\mathrm{\;{dB}}$ , which agrees closely with the predicted total output spectrum shown on the same plot. The $1/f$ noise is dominant in the filter without chopper stabilization and the thermal noise of the op amps is dominant with chopper stabilization. Despite a ${40}\mathrm{\;{dB}}$ noise reduction in the op amps at ${1000}\mathrm{\;{Hz}}$ , only ${10}\mathrm{\;{dB}}$ of improvement is noted in the filter noise. This occurs because the aliased thermal noise of the op amps becomes the dominant noise when the chopper is operating.

Figure 7.5-10 (a) Implementation of the chopper-stabilized circuit of Fig. 7.5-9. (b) Circuit equivalent during ${\phi }_{1}$ phase. (c) Circuit equivalent during ${\phi }_{2}$ phase.
While chopper stabilization could be used to further reduce the noise of the op amps discussed previously, one must be careful that the noise due to the switches called ${kT}/C$ noise does not destroy the benefits of chopper stabilization. ${kT}/C$ noise will be discussed in Chapter 9 and acts like the thermal noise. Thus, as more switches are used, the thermal noise level will increase. Therefore, chopper stabilization allows a trade-off between the $1/f$ noise and thermal noise. As a consequence, chopper stabilization would probably not result in improved noise performance for an op amp that already has low $1/f$ noise such as Fig. 7.5-6.
This section has presented techniques and methods that reduce the noise in op amps. It was shown that noise in MOSFET op amps consists of $1/f$ noise and thermal noise. At low frequencies, the $1/f$ noise becomes dominant. It can be reduced by using p-channel MOSFETs as input transistors and by getting as much gain at the input of the op amp as possible. Beyond this, the input transistors can be replaced by bipolar junction transistors, which have much less $1/f$ noise. Finally, the $1/f$ noise of an op amp can be pushed to a higher frequency using the principle of chopper stabilization. This principle also decreases the dc input-offset voltage of the CMOS op amp.

Figure 7.5-11 (a) Experimentally observed op amp equivalent input noise for various chopping frequencies. (b) Experimentally observed filter output noise with and without chopper, compared to theoretically predicted total noise.
As the noise in the op amp is lowered, one must be careful that other sources of distortion do not become more significant. This includes the harmonics created by distortion and the power-supply injection. Low-noise op amps must be linear and have very large power-supply rejection ratios.

### 7.6 Low-Voltage Op Amps
As CMOS technology continues to shrink in size, there are several important implications that result. Figure 7.6-1 shows the history and projection of the typical power-supply voltage, ${V}_{DD}$ ; the threshold voltage, ${V}_{T}$ ; and the minimum channel length, ${L}_{\min }$ $\left( {\mu \mathrm{m}}\right)$ [24]. The data from 2008 to 2010 are an extrapolation of the source indicated in the reference. The motivation for decreasing the channel length is to increase the MOSFET ${f}_{T}$ and to allow more circuits to be implemented in the same physical area, which sustains the move from very large-scale integrated (VLSI) circuits to ultralarge-scale integrated (ULSI) circuits. The reduction in voltage comes about because the reduced dimensions reduce the voltage breakdowns of the technology. In addition, the power dissipation in digital circuits is proportional to the square of the power supply. In order to reduce the power dissipation in ULSI circuits, it is necessary to either cool the chip or reduce the power supply or both.
However, from the viewpoint of the analog designer, the trends indicated on Fig. 7.6-1 become a problem. As the power-supply voltages are decreased, the dynamic range of the analog signals is decreased. If the threshold voltage is scaled with the power-supply voltage, the dynamic range would not be strongly affected. The reason that the threshold does not significantly decrease is because of the digital logic. We recall that current flows in the MOSFET even below the threshold voltage, which is the weak inversion region. If the threshold voltage is too close to zero, appreciable current would flow in the MOSFET logic devices even when they are off. If this small current is multiplied by thousands of devices, it becomes a significant amount of power dissipation.

Figure 7.6-1 Projection for CMOS technology.
CMOS technology can be modified to have lower threshold voltages and have no leakage current but this will probably not become a standard for the CMOS technology because it is not needed from the digital designer's viewpoint. The best threshold for logic to give the highest noise margin is approximately halfway between power supply. If a ${1.5}\mathrm{\;V}$ power supply is used, then ${0.75}\mathrm{\;V}$ thresholds give more noise margin. Consequently, the analog designer will have to face the issue of decreasing power supplies with approximately constant threshold voltages. This section addresses solutions to this problem. We will assume that the transistors are working in strong inversion. If weak inversion is used, then the amplifiers discussed in Section 7.4 would be suitable for low-voltage power supplies.
## Implications of Low-Voltage, Strong Inversion Operation
Figure 7.6-2 shows a slightly different perspective of the decrease in power supply with time. Figure 7.6-2 [25] is a roadmap developed from information on the world wide web, which represents the general trends of the semiconductor industry. In this roadmap for power-supply voltages as a function of time, a distinction is made between desktop and battery-powered power-supply voltages.
What are the implications of the decrease in power supply to analog circuits? Some of the implications are decreased dynamic range, decreased input common-mode range (ICMR), increased capacitance, and the inability to turn on or off floating switches. We will discuss each of these in more detail.
As the power supply decreases, the dynamic range will decrease. Use of differential operation will help to increase the signal swing. The lower limit of the dynamic range is also of concern. For the dynamic range to decrease proportionally with the power supply, the noise and nonlinearity must remain constant. Unfortunately, with reduced power supply, the nonlinearity will general increase. Typically, the $W/L$ values of MOSFETs are very large in order to make ${V}_{DS}$ (sat) small so that the noise tends to remain constant or decrease.
Probably one of the biggest concerns with reduced power supplies is the ICMR. Recall that the ICMR is the input common-mode voltage over which the differential input works as desired. Even if the ICMR is sufficiently large, it is also necessary that it be centered within the power-supply range. The ICMR is important because it determines if the output of a stage can interface with the input of another different or similar stage.

Figure 7.6-2 Roadmap for supply voltage for CMOS technology.
The pn-junction capacitances of the MOSFET increase as the power supply is lowered because less reverse-biased voltage can be placed across the pn junctions. To see this, recall that the depletion capacitance becomes smaller as the magnitude of the reverse-biased voltage gets larger. Also, the lower power supplies have a negative effect on the intrinsic capacitances. This influence comes from the fact that to lower ${V}_{DS}$ (sat), large values of $W/L$ are required. The larger geometries lead to larger capacitances.
Finally, low-voltage power supplies make it difficult to use switches. If the switch has one terminal referenced to the upper or lower power supply, it will function properly. The difficult switch is the one that is floating. The only solution for these switches is to use a charge pump to increase the magnitude of the gate drive. This technique was illustrated in Section 4.1.
## Low-Voltage Input Stages
Probably the most serious influence of low-voltage power supplies is on the input stage of the op amp. The most appropriate input stage for low voltages is shown in Fig. 7.6-3 and is a simple differential amplifier with current-source loads. The minimum value of power supply that can be used is given as
$$
{V}_{DD}\left( \min \right)  = {V}_{SD3}\left( \mathrm{{sat}}\right)  - {V}_{T1} + {V}_{GS1} + {V}_{DS5}\left( \mathrm{{sat}}\right)  = {V}_{SD3}\left( \mathrm{{sat}}\right)  + {V}_{DS1}\left( \mathrm{{sat}}\right)
$$
$$
+ {V}_{DS5}\text{(sat)} \tag{7.6-1}
$$
This value of power supply gives a zero value of the input common-mode range, ICMR. Assuming equal saturation voltages of ${0.3}\mathrm{\;V}$ and a threshold voltage of ${0.7}\mathrm{\;V}$ gives a power supply of ${0.9}\mathrm{\;V}$ . If the power supply is greater than ${V}_{DD}\left( \min \right)$ , the ICMR will have an upper limit and a lower limit. The upper limit is given as
$$
{V}_{icm}\left( \text{upper}\right)  = {V}_{DD} - {V}_{SD3}\left( \text{sat}\right)  + {V}_{T1} \tag{7.6-2}
$$
and the lower limit as
$$
{V}_{icm}\left( \text{ lower }\right)  = {V}_{DS5}\left( \text{ sat }\right)  + {V}_{GS1} \tag{7.6-3}
$$

Figure 7.6-3 Input common-mode range of a differential-input stage.
If the power supply was ${1.5}\mathrm{\;V}$ , then the ICMR would be ${0.6}\mathrm{\;V}$ . This ICMR goes from ${V}_{cm}$ (lower) of ${1.3}\mathrm{\;V}$ to ${V}_{cm}$ (upper) of ${1.9}\mathrm{\;V}$ or ${0.4}\mathrm{\;V}$ above ${V}_{DD}$ . It is preferable that the ICMR is more centered in the power-supply range, which is not the case.
One of the solutions to this problem is to use both an n-channel differential-input stage and a p-channel differential-input stage in parallel. Figure 7.6-4 shows the concept. The minimum value of ${V}_{DD}$ is the same as for a single differential-input stage but the ICMR can now extend above and below the power-supply limits. This seems like an ideal solution; however, if we carefully examine the operation of Fig. 7.6-4 over the input common-mode range, we find that there are three regions of operation. For example, when ${V}_{icm}$ is less than ${V}_{DSN5}\left( \text{sat}\right)  +$ ${V}_{GSN1}$ , not all of the transistors in the n-channel input are operating in saturation. In fact, what happens is that the currents in MN1 and MN2 continue to flow because of the current sources MN3 and MN4. Thus, ${V}_{GSN1}$ remains constant and the current sink of the n-channel differential amplifier, MN5, goes into the active region. As this happens, the current in MN1 and MN2 decreases, causing the drains of MN1 and MN2 (MN3 and MN4) to go to ${V}_{DD}$ , turning off the n-channel stage. The voltage ${V}_{DSN5}\left( \text{sat}\right)  + {V}_{GSN1}$ will be called the turn-on voltage for the n-channel differential input stage. It is given as
$$
{V}_{\text{onn }} = {V}_{DSN5}\left( \text{sat}\right)  + {V}_{GSN1} \tag{7.6-4}
$$

Figure 7.6-4 Parallel n-channel and p-channel differential input stage.
A similar occurrence happens to the p-channel input differential amplifier when ${V}_{icm}$ is above ${V}_{DD} - {V}_{SDP5}$ (sat) $- {V}_{SGP1}$ . This voltage will be called the turn-on voltage for the p-channel differential-input stage and is given as
$$
{V}_{\text{onp }} = {V}_{DD} - {V}_{SDP5}\left( \text{ sat }\right)  - {V}_{SGP1} \tag{7.6-5}
$$
Note that the sum of ${V}_{onn}$ and ${V}_{onp}$ equals the minimum possible power supply.
Between these voltages, all transistors of both differential inputs are in saturation. The difficulty with this result is that the small-signal input transconductance varies as a function of the common-mode input signal, ${V}_{icm}$ . This can be seen by assuming that when the input differential amplifier leaves its common-mode range, it turns off. Therefore, there are three ranges of operation, each with its own value on input transconductance. The regions are given as follows:
$$
{V}_{DD} > {V}_{icm} > {V}_{onp} : \text{(n-channel on and p-channel off)}
$$
$$
{g}_{m}\left( \mathrm{{eq}}\right)  = {g}_{mN} \tag{7.6-6}
$$
$$
{V}_{\text{onp }} \geq  {V}_{\text{icm }} \geq  {V}_{\text{onn }} : \text{(n-channel on and p-channel on)}
$$
$$
{g}_{m}\left( \mathrm{{eq}}\right)  = {g}_{mN} + {g}_{mP} \tag{7.6-7}
$$
$$
{V}_{\text{onn }} > {V}_{\text{icm }} > 0\text{: (n-channel off and p-channel on)}
$$
$$
{g}_{m}\left( \mathrm{{eq}}\right)  = {g}_{mP} \tag{7.6-8}
$$
where ${g}_{m}\left( \mathrm{{eq}}\right)$ is the equivalent input transconductance of Fig. 7.6-4, ${g}_{mN}$ is the input transconductance for the n-channel input, and ${g}_{mP}$ is the input transconductance for the p-channel input. The term "on" above means all transistors are operating in the saturation region. Figure 7.6-5 shows what the small-signal equivalent transconductance might look like for Fig. 7.6-4 as a function of the input common-mode voltage. Such a characteristic would introduce nonlinearity and create difficulty with compensation as a function of the input common-mode voltage. Both are undesirable results.
Various methods have been used to try to maintain the effective input transconductance constant as a function of the input common-mode voltage [26,27]. One method used to maintain ${g}_{m}$ (eff) constant is to change the dc currents in the input stages as ${V}_{icm}$ changes. In saturation, the small-signal differential transconductance is proportional to the square root of the dc current. When one stage shuts off, the dc current in the other is increased by a factor of 4 . For example, when the p-channel stage is off, then ${g}_{mN}$ of Eq. (7.6-6) is increased by a factor of 2 . If ${g}_{mN} =$ ${g}_{mP}$ , then the effective input transconductance is kept constant. The same technique is used for ${g}_{mP}$ of Eq. (7.6-8). Figure 7.6-6 shows how this method could be implemented.

Figure 7.6-5 Effective input transconductance of Fig. 7.6-4 as a function of ${V}_{icm}$ .
When both the n-channel and p-channel stages are operating, the currents ${I}_{pp}$ and ${I}_{nn}$ are zero and the bias currents of the n-channel $\left( {I}_{n}\right)$ and p-channel $\left( {I}_{p}\right)$ stages are ${I}_{b}$ . In this range the effective input transconductance is
$$
{g}_{m}\left( \mathrm{{eff}}\right)  = {g}_{mN} + {g}_{mP} = \sqrt{\frac{2{K}_{N}^{\prime }{W}_{N}{I}_{b}}{{L}_{N}}} + \sqrt{\frac{2{K}_{P}^{\prime }{W}_{P}{I}_{b}}{{L}_{P}}} \tag{7.6-9}
$$
If ${K}_{N}^{\prime }{W}_{N}/{L}_{N}$ is equal to ${K}_{P}^{\prime }{W}_{p}/{L}_{p}$ , then Eq. (7.6-9) becomes
$$
{g}_{m}\left( \mathrm{{eff}}\right)  = \frac{{K}_{N}^{\prime }{W}_{L}}{{L}_{N}}\left( {\sqrt{{I}_{b}} + \sqrt{{I}_{b}}}\right)  = \frac{{K}_{N}^{\prime }{W}_{L}}{{L}_{N}}\left( {2\sqrt{{I}_{b}}}\right)  \tag{7.6-10}
$$
Now suppose that ${V}_{icm}$ starts to increase toward ${V}_{DD}$ . If ${V}_{B2}$ is set equal to ${V}_{onp}$ , then when ${V}_{icm}$ increases above ${V}_{onn}$ , MP1 and MP2 shut off. The p-channel bias current, ${I}_{b}$ , becomes equal to ${I}_{nn}$ and flows into the 3:1 current mirror at the lower left. The bias current in the n-channel stage will become $4{I}_{b}$ , which causes the effective input transconductance above ${V}_{\text{onp }}$ to be
$$
{g}_{m}\left( \mathrm{{eff}}\right)  = \frac{{K}_{N}^{\prime }{W}_{L}}{{L}_{N}}\left( {2\sqrt{{I}_{b}}}\right)  \tag{7.6-11}
$$
which is the same as Eq. (7.6-10). If ${V}_{B1}$ is set equal to ${V}_{onn}$ and ${V}_{icm}$ decreases below ${V}_{onn}$ , MN1 and MN2 shut off and through identical means, the p-channel bias current becomes $4{I}_{b}$ , keeping the effective input transconductance constant. In reality, the transistors do not switch from off to on at a certain value of ${V}_{icm}$ but make a gradual transition. Figure 7.6-7 shows what the typical results of this method might look like. The parallel input stage approach works well for power-supply voltages in the range of $2 - 3\mathrm{\;V}$ . For less than these voltages, the parallel input stage approach is difficult to implement because of the externally required circuits.

Figure 7.6-6 Illustration of keeping ${g}_{m}$ (eff) constant using current compensation.

Figure 7.6-7 Typical results in making ${g}_{m}$ (eff) constant.
If the power supply is ${1.5}\mathrm{\;V}$ or less, generally a single differential-input stage is used at the sacrifice of the ICMR. It is possible to still get reasonable values of ICMR with power-supply voltages down to $1\mathrm{\;V}$ using the MOSFET in the bulk-driven mode [28]. Figure 7.6-8 shows how the MOSFET is driven by the bulk. The current control mechanism becomes the depletion region formed between the well and the channel. As this depletion region widens, it pinches off the channel. The resulting characteristic is similar to a junction field-effect transistor (JFET) with a pinch-off voltage of -2 to $- 4\mathrm{\;V}$ for an n-channel MOSFET. Like normal JFETs, the bulk should not be forward biased with respect to the source. Thus, the bulk-driven MOSFET operates identically to a JFET, which is a depletion device. The depletion characteristic allows the ICMR to extend below the negative power supply for an n-channel input.
The bulk-driven operation requires that the channel be formed, which is accomplished by a fixed bias applied to the gate terminal of the MOSFET. When a negative potential is applied to the bulk with respect to the source, the channel-bulk depletion region becomes reverse biased and widens. If the negative bulk voltage is large enough, the channel will pinch off. Figure 7.6-9 shows the drain current of the same n-channel MOSFET when the bulk-source voltage is varied and when the gate-source voltage is varied. The large-signal equation for the bulk-driven MOSFET is
$$
{i}_{D} = \frac{{K}_{N}^{\prime }W}{2L}{\left\lbrack  {V}_{GS} - {V}_{T0} - \gamma \sqrt{2\left| {\phi }_{F}\right|  - {v}_{BS}} + \gamma \sqrt{2\left| {\phi }_{F}\right| }\right\rbrack  }^{2} \tag{7.6-12}
$$

Figure 7.6-8 Cross section of an n-channel bulk-driven MOSFET.

Figure 7.6-9 Transconductance characteristic of the same MOSFET for bulk-source-driven and gate-source-driven modes of operation.
The small-signal transconductance is given in Eq. (3.3-8) and is repeated here as
$$
{g}_{mbs} = \frac{\gamma \sqrt{\left( {2{K}_{N}^{\prime }W/L}\right) {I}_{D}}}{2\sqrt{\left( 2\left| {\phi }_{F}\right|  - {V}_{BS}\right) }} \tag{7.6-13}
$$
The small-signal channel conductance does not change for bulk-driving. Normally, ${v}_{BS}$ is negative but sometimes it is useful to operate the bulk-driven MOSFET with the bulk-source junction slightly forward biased. One advantage is that the transconductance of Eq. (7.6-13) would increase and could become larger than the top gate transconductance. One must be careful that the current flow in the bulk-source junction is not large because it gets multiplied by the current gain of the parasitic bipolar junction transistors of Fig. 7.6-8.
The bulk-source-driven transistor can be used as the source-coupled pair in a differential amplifier as shown in Fig. 7.6-10. The depletion characteristics of the bulk-source-driven transistors will allow the ICMR to extend below the negative power supply for an n-channel input. As the input common-mode voltage of Fig. 7.6-10 begins to increase the small-signal transconductance increases. This can be seen as follows. First, we note that if the current through M1 and M2 is constant due to M5, then ${V}_{BS}$ must be constant. Therefore, if ${V}_{icm}$ increases, the sources of M1 and M2 increase. However, if the sources of M1 and M2 increase, then ${V}_{GS}$ decreases and the current would not remain constant. In order to maintain the currents in M1 and M2 constant, the bulk-source junction becomes less reverse biased, causing the effective threshold voltage to decrease. If ${V}_{icm}$ is increased more, the bulk-source junctions of M1 and M2 will become more forward biased and input current will start to flow. As a consequence of these changes in ${V}_{BS}$ , the transconductance of Eq. (7.6-13) increases because ${V}_{BS}$ is becoming less negative and then becoming positive. The increase can be as much as 100% over the input common-mode range, which makes it difficult to compensate the op amp. The practical upper input common-mode voltage is about ${0.3} - {0.4}\mathrm{\;V}$ below ${V}_{DD}$ .

Figure 7.6-10 Low-voltage differential input using bulk-source-driven input transistors.
## Low-Voltage Bias and Load Circuits
In addition to the input stage of an op amp, the biasing and load circuits can become a limit to power-supply reduction. In this section we will consider current mirrors and low-voltage bandgap references that can work down to $1\mathrm{\;V}$ . We have seen that the simple current mirror requires a gate-source voltage drop at the input to function properly. This voltage can be as much as $1\mathrm{\;V}$ or more depending on the $W/L$ and the current. The minimum power supply would be the voltage plus a saturation voltage of a current source or sink. Consequently, the minimum power supply would be
$$
{V}_{DD}\left( \min \right)  = {V}_{T} + 2{V}_{DS}\left( \text{ sat }\right)  \tag{7.6-14}
$$
Of course, this situation becomes worse if cascode current mirrors are used. The minimum input voltage for the self-biased cascode current mirror is the same as that of Eq. (7.6-14). There are two ways of decreasing the voltage required across the input of the current mirror. One is to use bulk-driven devices and the other is to level shift the drain voltage below the gate voltage.
We noted above that the bulk-driven MOSFET is normally operated in the depletion region but that it is possible to slightly forward bias the bulk-source junction. Under these conditions, the bulk-driven MOSFET can yield a low-voltage current mirror [29]. A simple current mirror using bulk-driven MOSFETs is shown in Fig. 7.6-11(a). The gates are taken to ${V}_{DD}$ to form the channels in M1 and M2. If the value of ${i}_{\mathrm{{IN}}}$ is greater than ${I}_{DSS}$ , then ${V}_{BS}$ is greater than zero and the current mirror functions as a normal current mirror. With the value of ${V}_{BS}$ slightly greater than zero, the value of ${\mathrm{V}}_{\mathrm{{MIN}}}$ at the input across the current source can be small. Experimental results show that ${V}_{BS}$ is less than ${0.4}\mathrm{\;V}$ for currents up to ${500\mu }\mathrm{A}$ . The small-signal input resistance is $1/{g}_{mbs}$ and the small-signal output resistance is ${r}_{ds}$ , the same as that of a gate-driven current mirror.

Figure 7.6-11 (a) Simple bulk-driven current mirror. (b) Cascode bulk-driven current mirror.

Figure 7.6-12 Experimental results of a bulk-driven cascode current mirror (four samples).
Figure 7.6-11(b) shows a cascode current mirror using bulk-driven MOSFETs. The minimum input voltage of the current mirror is equal to the sum of the bulk-source voltages for M1 and M3. Again, the value of ${i}_{\mathrm{{IN}}}$ must be greater than ${I}_{DSS}$ of the transistors. The minimum input voltage is less than ${0.5}\mathrm{\;V}$ for most currents under ${100\mu }\mathrm{A}$ . The advantage of the cas-code current mirror is better matching and higher output resistance. Figure 7.6-12 shows the experimental output currents for a ${2\mu }\mathrm{m}$ , p-well CMOS technology.
Another approach to low-voltage current mirrors is to level shift the drain below the gate. This approach is illustrated in Fig. 7.6-13, where the base-emitter voltage of a BJT is used to accomplish the voltage shift. We know that the drain can be ${V}_{T}$ less than the gate and still be in saturation. Therefore, as long as the base-emitter drop of the BJT is less than ${V}_{T}$ , this method will allow the input voltage of the simple current mirror to approach ${V}_{DS1}$ (sat). Unfortunately, this method only works for either an n-channel or a p-channel mirror but not both because the BJT requires a floating well and only one type of well is available in most processes. Note that the BJT can be lateral or vertical.

Figure 7.6-13 Simple current mirror with level shifting of the drain of M1.
The classical bandgap voltage generator discussed in Section 4.6 uses the summation of a voltage that is proportional to absolute temperature (PTAT) and a voltage whose temperature coefficient is based on that of a pn junction. When these voltages are in series, the bandgap topology is called the voltage mode. This mode of operation is shown in Fig. 7.6-14(a). Unfortunately, it requires at least the bandgap voltage of silicon ( ${1.205}\mathrm{\;V}$ at ${27}^{ \circ  }\mathrm{C}$ ) plus a MOSFET saturation voltage. This means that the minimum power-supply voltage would be around ${1.5}\mathrm{\;V}$ . If better current mirrors are used in the bandgap generator as was the case for Fig. 6.3-9, the minimum power supply voltage would be the bandgap voltage plus a diode drop plus five MOSFET saturation voltages. This could easily be a minimum of ${2.5}\mathrm{\;V}$ . Consequently, the current mode of voltage-current-mode architectures of Figs. 7.6-14(b) and 7.6-14(c) are more suitable for low-power-supply voltage operation. $\left( {I}_{\mathrm{{NL}}}\right.$ in these figures is a nonlinear current used to correct for the bandgap curvature problem.)
It was shown in Section 4.6 how to create a voltage that is PTAT. When this voltage is placed across a resistor, the current is PTAT. Even though the temperature coefficient of the resistor may make this current different from a PTAT current, when this current is replicated in another resistor with the same temperature coefficient, the voltage across that resistor will be PTAT. This approach is illustrated in Fig. 7.6-15 for generating currents with temperature coefficients of ${V}_{BE}$ and ${V}_{\mathrm{{PTAT}}}$ and was developed in Section 4.6.
The PTAT current is generated by the difference of the base-emitter drops of Q1 and Q2 superimposed across ${R}_{1}$ . This current flows through diode-connected M4. Any p-channel transistor whose source and gate are connected to M4 will create a PTAT current. For example, the voltage ${V}_{\text{out }}$ can be expressed as
$$
{V}_{\text{out }1} = {I}_{\mathrm{{PTAT}}}{R}_{2} = \left( \frac{{V}_{\mathrm{{PTAT}}}}{{R}_{1}}\right) {R}_{2} = {V}_{\mathrm{{PTAT}}}\frac{{R}_{2}}{{R}_{1}} \tag{7.6-15}
$$
If the temperature coefficients of ${R}_{2}$ and ${R}_{1}$ are identical, then ${V}_{\text{out }}$ will be PTAT. The current, which has a temperature coefficient of the base-emitter, ${I}_{VBE}$ , is generated by putting ${R}_{3}$ across the base-emitter junction of Q1. Note that PTAT current flows through Q1. The current

Figure 7.6-14 (a) Voltage-mode bandgap topology. (b) Current-mode bandgap topology. (c) Voltage-current-mode bandgap topology.

Figure 7.6-15 Method of generating currents with temperature coefficients equal to that of ${V}_{BE}$ and ${V}_{\text{PTAT }}$ .
${I}_{VBE}$ is generated by the negative-feedback loop consisting of $\mathrm{Q}1,\mathrm{M}6,\mathrm{M}7,\mathrm{M}8$ , and ${R}_{3}$ . This feedback loop causes the current in Q1 to be PTAT and causes the current in M8 to be ${I}_{VBE}$ . Any p-channel transistor whose source and gate are connected to the source and gate of M8 will have a current whose temperature coefficient is that of a base-emitter junction. This current can be used to create a voltage with a temperature coefficient of ${V}_{BE}$ . This is seen in the following equation:
$$
{V}_{\text{out }2} = {I}_{VBE}{R}_{4} = \left( \frac{{V}_{BE}}{{R}_{3}}\right) {R}_{4} = {V}_{BE}\frac{{R}_{4}}{{R}_{3}} \tag{7.6-16}
$$
Again, if the temperature coefficients of ${R}_{3}$ and ${R}_{4}$ are identical, then ${V}_{\text{out }2}$ has the temperature coefficient of a base-emitter junction.
Unfortunately, the temperature dependence of the base-emitter voltage is not linear and therefore does not cancel the PTAT linear temperature dependence of the difference between two base-emitter voltages. This leads to the need to correct the curvature of the temperature coefficient of the bandgap reference. Ways of doing this at high voltage have been explored previously. We will show a method of correcting the curvature that is suitable for bandgap references that can work between 1.2 and ${10}\mathrm{\;V}\left\lbrack  {30}\right\rbrack$ . The method is based on the circuit of Fig. 7.6-16(a).

Figure 7.6-16 (a) Circuit to generate nonlinear correction term, ${I}_{\mathrm{{NL}}}$ . (b) Illustration of the various currents in (a).
Transistor M2 acts like a nonideal current source with a current that is proportional to a base-emitter voltage. For the lower half of the temperature range, the PTAT current, ${K}_{1}{I}_{\text{PTAT }}$ , is less than the current ${K}_{2}{I}_{VBE}$ . Under this condition M2 is in the active region and M3, while saturated, is off. At the point where ${I}_{2}$ is greater than or equal to ${K}_{1}{I}_{\text{PTAT }},\mathrm{M}2$ becomes saturated and M3 is still saturated but a current ${I}_{\mathrm{{NL}}}$ begins to flow. The current ${I}_{\mathrm{{NL}}}$ is equal to the difference between ${K}_{1}{I}_{\text{PTAT }}$ and ${I}_{2} = {K}_{2}{I}_{VBE}$ . The resulting current, which is mirrored and flows through M4, can be used to correct for the bandgap curvature. The value of ${I}_{\mathrm{{NL}}}$ can be expressed as
$$
{I}_{\mathrm{{NL}}} = \left\{  \begin{array}{ll} 0, & {K}_{2}{I}_{VBE} > {K}_{1}{I}_{\text{PTAT }} \\  {K}_{1}{I}_{\text{PTAT }} - {K}_{2}{I}_{VBE}, & {K}_{2}{I}_{VBE} < {K}_{1}{I}_{\text{PTAT }} \end{array}\right.  \tag{7.6-17}
$$
The constants ${K}_{1},{K}_{2}$ , and ${K}_{3}$ can be used to adjust the characteristic to minimize the temperature dependence of the bandgap reference. The voltage-current-mode bandgap topology of Fig. 7.6-14(c) has been used along with Figs. 7.6-15 and 7.6-16(a) to implement a curvature-corrected bandgap reference of ${0.596}\mathrm{\;V}$ with a temperature coefficient of less than ${20}\mathrm{{ppm}}/{\mathrm{C}}^{ \circ  }$ over the range of -15 to ${90}{\mathrm{C}}^{ \circ  }$ . It is important that the resistors that make up ${R}_{1}$ through ${R}_{3}$ and the resistor that generates the ${I}_{\mathrm{{PTAT}}}$ have the same temperature coefficient. The circuit showed a line regulation of ${408}\mathrm{{ppm}}/\mathrm{V}$ for values of ${V}_{DD}$ from 1.2 to ${10}\mathrm{\;V}$ and ${2000}\mathrm{{ppm}}/\mathrm{V}$ for ${1.1}\mathrm{\;V} \leq  {V}_{DD} \leq  {10}\mathrm{\;V}$ . The quiescent current was ${14\mu }\mathrm{A}$ .
## Low-Voltage Op Amps
In most op amps, design difficulties occur with lower power supplies at a level of about $2{V}_{T}$ . The limit of the op amp in low-power-supply voltage is related to the desired input common-mode range. Thus, down to ${V}_{DD} = 2{V}_{T}$ , normal methods of designing op amps can be used with care. As an example consider the op amp of Fig. 7.6-17, which is designed for the voltage range down to $2{V}_{T}$ . The input stage is the simple n-channel differential amplifier with current-source loads shown in Fig. 7.6-3. This gives the widest possible input common-mode range for enhancement MOSFETs without using the parallel input stages of Fig. 7.6-4. The p-channel transistors whose sources are connected to the output of the differential amplifier are biased so that the voltage across the source-drains of the current-source loads is ${V}_{SD}$ (sat) $\left( {V}_{ON}\right)$ . This gives the maximum input common-mode voltage and allows the power supply to vary without limiting the positive input common-mode voltage. The signal currents of the differential output are folded through these transistors (M6 and M7) and converted to single-ended signals with the n-channel current mirror (M8 and M9). Finally, a simple Class A output stage using Miller compensation is used for the second-stage gain. This op amp will have the same performance as a the classical two-stage op amp but can be used at a lower power-supply voltage. It has the advantage over the classical two-stage op amp that the loads of the input differential stage are balanced.

Figure 7.6-17 A low-voltage, two-stage op amp having ${V}_{DD} \geq  {V}_{T}$ .
---
Example 7.6-1
---
## Design of a Low-Voltage Op Amp Using the Topology of Fig. 7.6-17
Use the parameters of Table 3.1-2 to design the op amp of Fig. 7.6-17 to meet the specifications given below.
$$
{V}_{DD} = 2\mathrm{\;V}
$$
$$
{V}_{icm}\left( \max \right)  = {2.5}\mathrm{\;V}\;{V}_{icm}\left( \min \right)  = 1\mathrm{\;V}
$$
$$
{V}_{\text{out }}\left( \max \right)  = {1.75}\mathrm{\;V}
$$
$$
{V}_{\text{out }}\left( \min \right)  = {0.5}\mathrm{\;V}\;{GB} = {10}\mathrm{{MHz}}
$$
Slew rate $=  \pm  {10}\mathrm{\;V}/\mu \mathrm{s}$ Phase margin $= {60}^{ \circ  }$ for ${C}_{L} = {10}\mathrm{{pF}}$
## SOLUTION
Assuming the conditions for a two-stage op amp necessary to achieve a ${60}^{ \circ  }$ phase margin and that the RHP zero is at least ${10GB}$ gives
$$
{C}_{c} = {0.2}{C}_{L} = 2\mathrm{{pF}}
$$
The slew rate is directly related to the current in M5 and gives
$$
{I}_{5} = {C}_{c} \cdot  {SR} = 2 \times  {10}^{-{11}} \cdot  {10}^{7} = {20\mu }\mathrm{A}
$$
We also know the input transconductances from ${GB}$ and ${C}_{c}$ . They are given as
$$
{g}_{m1} = {g}_{m2} = {GB} \cdot  {C}_{c} = {20\pi } \times  {10}^{6} \cdot  2 \times  {10}^{-{12}} = {125.67\mu }\mathrm{S}
$$
Knowing the current flow in M1 and M2 gives the $W/L$ ratios as
$$
\frac{{W}_{1}}{{L}_{1}} = \frac{{W}_{2}}{{L}_{2}} = \frac{{g}_{m1}^{2}}{2{K}_{N}^{\prime }\left( {{I}_{1}/2}\right) } = \frac{{\left( {125.67} \times  {10}^{-6}\right) }^{2}}{2 \cdot  {110} \times  {10}^{-6} \cdot  {10} \times  {10}^{-6}} = {7.18}
$$
Next, we find the $W/L$ of M5 that will satisfy the ${V}_{icm}\left( \min \right)$ specification.
$$
{V}_{icm}\left( \min \right)  = {V}_{DS5}\left( \mathrm{{sat}}\right)  + {V}_{GS1}\left( {{10\mu }\mathrm{A}}\right)  = 1\mathrm{\;V}
$$
This gives
$$
{V}_{DS5}\left( \mathrm{{sat}}\right)  = 1 - \sqrt{\frac{2 \cdot  {10}}{{110} \cdot  {7.18}}} - {0.75} = 1 - {0.159} - {0.75} = {0.0909}\mathrm{\;V}
$$
Therefore,
$$
{V}_{DS5}\left( \mathrm{{sat}}\right)  = {0.0909} = \sqrt{\frac{2{I}_{5}}{{K}_{N}^{\prime }\left( {{W}_{5}/{L}_{5}}\right) }} \rightarrow  \frac{{W}_{5}}{{L}_{5}} = \frac{2 \cdot  {20}}{{110} \cdot  {\left( {0.0909}\right) }^{2}} = {44}
$$
The design of M3 and M4 is accomplished from the upper input common-mode voltage and is
$$
{V}_{icm}\left( \max \right)  = {V}_{DD} - {V}_{SD3}\left( \mathrm{{sat}}\right)  + {V}_{TN} = 2 - {V}_{SD3}\left( \mathrm{{sat}}\right)  + {0.75} = {2.5}\mathrm{\;V}
$$
Solving for ${V}_{SD3}$ (sat) gives 0.25 V. Let us assume that the currents in M6 and M7 are ${20\mu }\mathrm{A}$ . This gives a current of ${30\mu }\mathrm{A}$ in M3 and M4. Knowing the current in M3 (M4) gives
$$
{V}_{SD3}\left( \text{ sat }\right)  \leq  \sqrt{\frac{2 \cdot  {30}}{{50} \cdot  \left( {{W}_{3}/{L}_{3}}\right) }} \rightarrow  \frac{{W}_{3}}{{L}_{3}} = \frac{{W}_{4}}{{L}_{4}} \geq  \frac{2 \cdot  {30}}{{\left( {0.25}\right) }^{2} \cdot  {50}} = {19.2}
$$
Next, using the ${V}_{SD}\left( \text{sat}\right)  = {V}_{ON}$ of M3 and M4, design M10 through M12. Let us assume that ${I}_{10} = {I}_{5} = {20\mu }\mathrm{A}$ , which gives ${W}_{10}/{L}_{10} = {44}.{R}_{1}$ is designed as ${R}_{1} = {0.25}\mathrm{\;V}/{20\mu }\mathrm{A} =$ ${12.5}\mathrm{k}\Omega$ . The $W/L$ ratios of M11 and M12 can be expressed as
$$
\frac{{W}_{11}}{{L}_{11}} = \frac{{W}_{12}}{{L}_{12}} = \frac{2 \cdot  {I}_{11}}{{K}_{P}^{\prime }{V}_{SD11}^{2}\left( \mathrm{{sat}}\right) } = \frac{2 \cdot  {20}}{{50} \cdot  {\left( {0.25}\right) }^{2}} = {12.8}
$$
It turns out that since the source-gate voltages and currents of M6 and M7 are the same as $\mathrm{M}{11}$ and $\mathrm{M}{12}$ , the $W/L$ values are equal. Thus,
$$
\frac{{W}_{6}}{{L}_{6}} = \frac{{W}_{7}}{{L}_{7}} = {12.8}
$$
M8 and M9 should be as small as possible to reduce the parasitic (mirror) pole. However, the voltage drop across M4, M6, and M8 must be less than the power supply. Using this to design the gate-source voltage of M8 gives
$$
{V}_{GS8} = {V}_{DD} - 2{V}_{ON} = 2\mathrm{\;V} - 2 \cdot  {0.25} = {1.5}\mathrm{\;V}
$$
Thus,
$$
\frac{{W}_{8}}{{L}_{8}} = \frac{{W}_{9}}{{L}_{9}} = \frac{2 \cdot  {I}_{8}}{{K}_{N}^{\prime } \cdot  {V}_{DS8}^{2}\left( \mathrm{{sat}}\right) } = \frac{2 \cdot  {20}}{{110} \cdot  {\left( {0.8}\right) }^{2}} = {0.57} \approx  1
$$
This value suggests that it might be possible to make M8 and M9 a cascode current mirror, which would boost the gain (see Problem 7.6-9). Because M8 and M9 are small, the mirror pole will be insignificant. The next poles of interest would be those at the sources of M6 and M7. These poles are given as
$$
{p}_{6} \approx  \frac{{g}_{m6}}{{C}_{GS6}} = \frac{\sqrt{2{K}_{p}^{\prime } \cdot  \left( {{W}_{6}/{L}_{6}}\right)  \cdot  {I}_{6}}}{\left( \frac{2}{3}\right)  \cdot  {W}_{6} \cdot  {L}_{6} \cdot  {C}_{\mathrm{{ox}}}} = \frac{\sqrt{2 \cdot  {50} \cdot  {12.8} \cdot  {20} \times  {10}^{-6}}}{\left( \frac{2}{3}\right)  \cdot  {12.8} \cdot  1 \cdot  {2.47} \times  {10}^{-{15}}} = {7.59} \times  {10}^{9}\mathrm{{rad}}/\mathrm{s}
$$
We have assumed that the channel length is ${1\mu }\mathrm{m}$ in the above calculation. This value is about 100 times greater than ${GB}$ so we should be okay even though we have neglected the drain-ground capacitances of M1 and M3.
Finally, the $W/L$ ratios of the second stage must be designed. We can either use the relationship for a ${60}^{ \circ  }$ phase margin of ${g}_{m14} = {10}{g}_{m1} = {1256.7\mu }\mathrm{S}$ or consider proper mirroring between M9 and M14. Combining the equations for saturation region, we get
$$
\frac{W}{L} = \frac{{g}_{m}}{{K}_{N}^{\prime }{V}_{DS}\left( \mathrm{{sat}}\right) }
$$
Substituting ${1256.7\mu }\mathrm{S}$ for ${g}_{m1}$ and ${0.5}\mathrm{\;V}$ for ${V}_{DS14}$ gives ${W}_{14}/{L}_{14} = {22.85}$ . The current corresponding to this ${g}_{m}$ and $W/L$ is ${I}_{14} = {314\mu }\mathrm{A}$ . The $W/L$ of M13 is designed by the necessary current ratio desired between the two transistors and is
$$
\frac{{W}_{13}}{{L}_{13}} = \frac{{I}_{13}}{{I}_{12}}{I}_{12} = \frac{314}{20} \cdot  {12.8} = {201}
$$
Now, we must check to make sure that the ${V}_{\text{out }}\left( \max \right)$ is satisfied. The saturation voltage of M13 is
$$
{V}_{SD13}\left( \text{ sat }\right)  = \sqrt{\frac{2 \cdot  {I}_{13}}{{K}_{P}^{\prime }\left( {{W}_{13}/{L}_{13}}\right) }} = \sqrt{\frac{2 \cdot  {314}}{{50} \cdot  {201}}} = {0.25}\mathrm{\;V}
$$
which exactly meets the specification. For proper mirroring, the $W/L$ ratio of M9 should be
$$
\frac{{W}_{9}}{{L}_{9}} = \frac{{I}_{9}}{{I}_{14}}\frac{{W}_{14}}{{L}_{14}} = {1.42}
$$
Since ${W}_{9}/{L}_{9}$ was selected as 1, this is close enough.
Let us check to see what gain is achieved at low frequencies. The small-signal voltage gain can be written as
$$
\frac{{v}_{\text{out }}}{{v}_{\text{in }}} = \left( \frac{{g}_{m1}}{{g}_{ds7} + {g}_{ds9}}\right) \left( \frac{{g}_{m14}}{{g}_{ds13} + {g}_{ds14}}\right)
$$
${g}_{ds7} = {1\mu }\mathrm{S},{g}_{ds8} = {0.8\mu }\mathrm{S},{g}_{ds13} = {15.7\mu }\mathrm{S}$ , and ${g}_{ds14} = {12.56\mu }\mathrm{S}$ . Putting these values in the above equation gives
$$
\frac{{v}_{\text{out }}}{{v}_{\text{in }}} = \left( \frac{125.6}{1.8}\right) \left( \frac{1256.7}{28.26}\right)  = {69.78} \cdot  {44.47} = {3103}\mathrm{\;V}/\mathrm{V}
$$
The power dissipation, including ${I}_{\text{BIAS }}$ of ${20\mu }\mathrm{A}$ , is ${708\mu }\mathrm{W}$ . The minimum power supply possible with no regard to the input common-mode voltage range is ${V}_{T} + 3{V}_{ON}$ . With ${V}_{T} = {0.7}\mathrm{\;V}$ and ${V}_{ON} \approx  {0.25}\mathrm{\;V}$ , this op amp should be capable of operating with a power supply of ${1.5}\mathrm{\;V}$ .
The op amp of Fig. 7.6-17 is a good example of a low-voltage op amp using standard techniques of designing op amps. If the voltage decreases below $2{V}_{T}$ , then problems start to arise. These problems include a decreased input common-mode voltage range. This can be somewhat alleviated by using the parallel input stage of Fig. 7.6-4. The other major problem is that most of the transistors will have a drain-source voltage that is close to the saturation voltage. This means that ${g}_{ds}$ will be larger (or ${r}_{ds}$ smaller). This will cause the gain to decrease significantly. In the above example, if the transistor lambdas are increased to 0.12 for the NMOS and 0.15 for the PMOS the gain decreases by nine, resulting in a gain of 345 $\mathrm{V}/\mathrm{V}$ . Of course, one can use longer channel lengths to compensate this reduction but the penalty is much larger areas and more capacitance. Typically, what must happen is that more stages of gain are required. It may be necessary to follow the output of the op amp of Fig. 7.6-17 with two or more stages. This causes the compensation to become more complex as the number of gain stages increases. The multipath nested Miller compensation method discussed briefly at the end of Section 7.2 is found in more detail in the literature [7,31].
To build CMOS op amps that operate at power supplies less than ${1.5} - 2\mathrm{\;V}$ requires a reduction in the threshold voltage or the use of different approaches. Many CMOS technologies have what is called a natural transistor. This transistor is the normal NMOS transistor without the implant to shift the threshold to a larger voltage. The threshold of the natural MOSFET is around ${0.1} - {0.2}\mathrm{\;V}$ . Such a transistor can be used where needed in the op amp to provide the necessary input common-mode voltage range and the gain. One must remember that the natural transistors do not go to zero current when the gate-source voltage is zero, which is not a problem with most analog applications.
The alternative to using a modified technology is to use the bulk-driven technique discussed earlier in this section. This technique will be used to illustrate an op amp that can work with a power-supply voltage of ${1.25}{V}_{T}$ . We will use this approach to implement a CMOS op amp working from a $1\mathrm{\;V}$ power supply having an input common-mode voltage range of ${25}\mathrm{{mV}}$ of the rail, an output swing within ${25}\mathrm{{mV}}$ of the rail, and a gain of 275 [29]. The gain could be increased by adding more gain stages as suggested above.
Figure 7.6-18 shows a 1 V CMOS op amp using bulk-driven PMOS devices and the input transistors for the differential-input stage. The current mirror consisting of M3, M4, and Q5 is the one shown in Fig. 7.6-13. Q6 is a buffer and maintains the symmetry of the mirror. The output stage is a simple Class A output. Long channel lengths were used to try to maintain the gain. The performance of this is summarized in Table 7.6-1. The gain could be increased by using the cascade of several more Class A inverting stages compensated with the multipath nested Miller compensation approach. The technique of forward biasing some of the bulk-source junctions of a CMOS op amp has been used to implement a folded-cascade op amp having a gain of almost ${70}\mathrm{\;{dB}}$ for a $1\mathrm{\;V}$ power supply [32].

Figure 7.6-18 A 1 V, two-stage operational amplifier.
TABLE 7.6-1 Performance Results for the CMOS Op Amp of Fig. 7.6-18
<table><tr><td>Specification $\left( {{\mathrm{V}}_{\mathrm{{DD}}} = {0.5}\mathrm{\;V},{\mathrm{\;V}}_{\mathrm{{SS}}} =  - {0.5}\mathrm{\;V}}\right)$</td><td>Measured Performance $\left( {{\mathrm{C}}_{\mathrm{L}} = {22}\mathrm{{pF}}}\right)$</td></tr><tr><td>dc Open-loop gain</td><td>${49}\mathrm{\;{dB}}\left( {{\mathrm{\;V}}_{icm}\text{midrange}}\right)$</td></tr><tr><td>Power-supply current</td><td>${300}\mathrm{{\mu A}}$</td></tr><tr><td>Unity-gain bandwidth (GB)</td><td>1.3 MHz ( ${V}_{icm}$ midrange)</td></tr><tr><td>Phase margin</td><td>${57}^{ \circ  }\left( {{V}_{icm}\text{midrange}}\right)$</td></tr><tr><td>Input-offset voltage</td><td>$\pm  3\mathrm{{mV}}$</td></tr><tr><td>Input common-mode voltage range</td><td>-0.475to ${0.450}\mathrm{\;V}$</td></tr><tr><td>Output swing</td><td>-0.475to ${0.491}\mathrm{\;V}$</td></tr><tr><td>Positive slew rate</td><td>+0.7 μV/s</td></tr><tr><td>Negative slew rate</td><td>-1.6 μV/s</td></tr><tr><td>THD, closed-loop gain of -1 V/V</td><td>$- {60}\mathrm{\;{dB}}\left( {{0.75}\mathrm{\;{Vpp}},1\mathrm{{kHz}}\text{ sine wave }}\right)$ $- {59}\mathrm{{dB}}\left( {{0.75}\mathrm{{Vpp}},{10}\mathrm{{kHz}}\text{sine wave}}\right)$</td></tr><tr><td>THD, closed-loop gain of +1 V/V</td><td>$- {59}\mathrm{{dB}}\left( {{0.75}\mathrm{{Vpp}},1\mathrm{{kHz}}\text{sine wave}}\right)$ $- {57}\mathrm{\;{dB}}\left( {{0.75}\mathrm{\;{Vpp}},{10}\mathrm{{kHz}}\text{sine wave}}\right)$</td></tr><tr><td>Spectral noise voltage density</td><td>367 nV/VHz @ 1 kHz ${181}\mathrm{{nV}}/\sqrt{}\mathrm{{Hz}}@{10}\mathrm{{kHz}}$ ${81}\mathrm{{nV}}/\sqrt{}\mathrm{{Hz}}@{100}\mathrm{{kHz}}$ 444 nV/VHz @ 1 MHz</td></tr><tr><td>Positive power supply rejection</td><td>${61}\mathrm{\;{dB}}$ at ${10}\mathrm{{kHz}}$ ${55}\mathrm{\;{dB}}$ at ${100}\mathrm{{kHz}}$ ${22}\mathrm{\;{dB}}$ at $1\mathrm{{MHz}}$</td></tr><tr><td>Negative power supply rejection</td><td>${45}\mathrm{\;{dB}}$ at ${10}\mathrm{{kHz}}$ ${27}\mathrm{\;{dB}}$ at ${100}\mathrm{{kHz}}$</td></tr><tr><td/><td>$5\mathrm{{dB}}$ at $1\mathrm{{MHz}}$</td></tr></table>
Unfortunately, as the power-supply voltage is decreased, the power dissipated in low-voltage op amps does not decrease proportionally. This is due to the fact that the gain is proportional to the ${g}_{m}{r}_{ds}$ product. As ${r}_{ds}$ decreases because of the increasing value of lambda (channel modulation parameter), the value of ${g}_{m}$ must go up. However, the transconductance is increased by larger $W/L$ values and more current. As large $W/L$ values are approached, more area is used and larger parasitic capacitances result. Therefore, the dc currents tend to be large, resulting in higher power dissipation. This is an area where bipolar junction transistors have a significant advantage because they can achieve much larger values of transconduc-tances at lower currents.

### 7.7 Summary
This chapter has discussed CMOS op amps with performance capabilities that exceed those of the unbuffered CMOS op amps of the previous chapter. The primary difference between the two types is the addition of an output stage to the high-performance op amps. Output stages presented include those that use only MOS devices and those that use both MOS and bipolar devices. The output resistance of the source- or emitter-follower outputs could be reduced even further by using negative feedback. Adding the output stage usually introduces more poles in the open-loop gain of the operational amplifier, making it more difficult to compensate. The primary function of the buffered op amps is to drive a low-resistance and a large-capacitance load.
Another area of improvement was in the frequency response. Understanding what limits the frequency response of the op amp allowed the unity-gain bandwidth to be optimized. The use of current feedback actually allows the above frequency limit to be exceeded, resulting in very-high-frequency op amps. This chapter also included the differential output op amp. Examples of converting single-ended output op amps to differential output op amps were given. This section was important because most analog signal processing done today uses a differential signal to reject noise and increase the dynamic range.
As the analog content of large mixed-signal integrated circuits increases, it is important to minimize the power dissipation. Op amps with minimum power dissipation were introduced along with the means of increasing the output current when driving large capacitive loads. It was seen that a low-power op amp could be obtained at the expense of frequency response and other desirable characteristics. Most low-power op amps work in the weak inversion mode in order to reduce dissipation and therefore perform like BJT op amp circuits.
As the power-supply voltages decrease because of technology improvements and the desire to minimize power dissipation, many challenges face the analog designer. One is to keep the noise level as low as possible. Methods of designing low-noise op amps were presented along with several examples. In addition, the op amps must be designed to work with the ever decreasing power-supply voltages. As power-supply voltages begin to approach $2{V}_{T}$ , new techniques must be used. Two solutions are to use technologies that have special transistors such as the natural MOSFET or to use the MOSFETs in an unconventional way like the bulk-driven MOSFETs.
The CMOS op amp designs of this chapter are a good example of the principle of trading decreased performance in one area for increased performance in another. Depending on the application of the op amp, this trade-off leads to increased system performance. The circuits and techniques presented in this chapter should find application in many practical areas of CMOS analog circuit design.
## Problems
7.1-1. Assume that ${V}_{DD} =  - {V}_{SS}$ and ${I}_{17}$ and ${I}_{20}$ in Fig. 7.1-1 are ${100\mu }\mathrm{A}$ . Design ${W}_{18}/{L}_{18}$ and ${W}_{19}/{L}_{19}$ to get ${V}_{SG18} = {V}_{SG19} = {1.5}\mathrm{\;V}$ . Design ${W}_{21}/{L}_{21}$ and ${W}_{22}/{L}_{22}$ so that the quiescent current in M21 and M22 is also ${100\mu }\mathrm{A}$ .
7.1-2. Calculate the value of ${V}_{A}$ and ${V}_{B}$ in Fig. 7.1-2 and therefore the value of ${V}_{C}$ .
7.1-3. Assume that ${K}_{N}^{\prime } = {47\mu }\mathrm{A}/{\mathrm{V}}^{2},{K}_{P}^{\prime } = {17}$ $\mu \mathrm{A}/{\mathrm{V}}^{2},{V}_{TN} = {0.7}\mathrm{\;V},{V}_{TP} =  - {0.9}\mathrm{\;V},{\gamma }_{N} =$ ${0.85}{\mathrm{\;V}}^{1/2},{\gamma }_{P} = {0.25}{\mathrm{\;V}}^{1/2},2\left| {\phi }_{F}\right|  = {0.62}\mathrm{\;V}$ , ${\lambda }_{N} = {0.05}{\mathrm{\;V}}^{-1}$ , and ${\lambda }_{P} = {0.04}{\mathrm{\;V}}^{-1}$ . Use SPICE to simulate Fig. 7.1-2 and obtain the simulated equivalent of Fig. 7.1-3.
7.1-4. Use SPICE to plot the total harmonic distortion (THD) of the output stage of Fig. 7.1-2 as a function of the rms output voltage at $1\mathrm{{kHz}}$ for an input-stage bias current of ${20\mu }\mathrm{A}$ . Use the SPICE model parameters given in Problem 7.1-3.
7.1-5. An MOS output stage is shown in Fig. P7.1-5. Draw a small-signal model and calculate the ac voltage gain at low frequency. Assume that bulk effects can be neglected.

7.1-6. Find the value of the small-signal output resistance of Fig. 7.1-9 if the $W$ values of $\mathrm{M}1$ and $\mathrm{M}2$ are increased from ${10\mu }\mathrm{m}$ to ${100\mu }\mathrm{m}$ . Use the model parameters of Table 3.1-2. What is the $- 3\mathrm{\;{dB}}$ frequency of this buffer if ${C}_{L} = {10}\mathrm{{pF}}$ ?
7.1-7. A CMOS circuit used as an output buffer for an OTA is shown in Fig. P7.1-7. Find the value of the small-signal output resistance, ${R}_{\text{out }}$ , and from this value estimate the $- 3\mathrm{\;{dB}}$ bandwidth if a ${50}\mathrm{{pF}}$ capacitor is attached to the output. What is the maximum and minimum output voltage if a $1\mathrm{\;k}\Omega$ resistor is attached to the output? What is the quiescent power dissipation of this circuit?

Figure P7.1-7
7.1-8. What type of BJT is available with a bulk CMOS p-well technology? A bulk CMOS n-well technology? Discuss the pros and cons of using a BJT in a Class A output.
7.1-9. Assume that Q10 of Fig. 7.1-11 is connected directly to the drains of M6 and M7 and that M8 and M9 are not present. Give an expression for the small-signal output resistance and compare this with Eq. (7.1- 9). If the current in $\mathrm{Q}{10} - \mathrm{M}{11}$ is ${500\mu }\mathrm{A}$ , the current in M6 and M7 is ${100\mu }\mathrm{A}$ , and ${\beta }_{F} = {100}$ , use the parameters of Table 3.1- 2assuming ${1\mu }\mathrm{m}$ channel lengths and calculate this resistance at room temperature.
7.1-10. Find the dominant roots of the MOS follower and the BJT follower for the buffered, Class A op amp of Example 7.1-2. Use the capacitances of Table 3.2-1. Compare these root locations with the fact that ${GB} = 5$ MHz. Assume ${C}_{\pi } = {10}\mathrm{{pF}}$ and ${C}_{\mu } = 1\mathrm{{pF}}$ .
7.1-11. Given the op amp in Fig. P7.1-11, find the quiescent currents flowing in the op amp and the small-signal voltage gain, ignoring any loading produced by the output stage. Assume ${K}_{N}^{\prime } = {25\mu }\mathrm{A}/{\mathrm{V}}^{2}$ and ${K}_{P}^{\prime } = {10}$ $\mu \mathrm{A}/{\mathrm{V}}^{2}$ . Find the small-signal output resistance assuming that $\lambda  = {0.04}{\mathrm{\;V}}^{-1}$ .
7.2-1. Find the ${GB}$ of a two-stage op amp using Miller compensation using a nulling resistor that has a ${60}^{ \circ  }$ phase margin where the second pole is $- {10} \times  {10}^{6}\mathrm{{rad}}/\mathrm{s}$ and two higher poles both at $- {100} \times  {10}^{6}\mathrm{{rad}}/\mathrm{s}$ . Assume that the RHP zero is used to cancel the second pole and that the load capacitance stays constant. If the input transconductance is ${500\mu }\mathrm{A}/\mathrm{V}$ , what is the value of ${C}_{c}$ ?
7.2-2. For an op amp where the second pole is smaller than any larger poles by a factor of 10, we can set the second pole at ${2.2GB}$ to get a ${60}^{ \circ  }$ phase margin. Use the pole locations determined in Example 7.2-2 and find the constant multiplying ${GB}$ that designs ${p}_{6}$ for a ${60}^{ \circ  }$ phase margin.
7.2-3. What will be the phase margin of Example 7.2-2 if ${C}_{L} = 1\mathrm{{pF}}$ ?

Figure P7.1-11
7.2-4. Use the technique of Example 7.2-2 to extend the ${GB}$ of the cascode op amp of Example 6.5-3 as much as possible while maintaining a ${60}^{ \circ  }$ phase margin. What is the minimum value of ${C}_{L}$ for the maximum ${GB}$ ?
7.2-5. For the voltage amplifier using a current mirror shown in Fig. 7.2-11, design the currents in M1, M2, M5, and M6 and the $W/L$ ratios to give an output resistance that is at least $1\mathrm{M}\Omega$ and an input resistance that is less than $1\mathrm{k}\Omega$ . (This would allow a voltage gain of -10 to be achieved using ${R}_{1} =$ ${10}\mathrm{k}\Omega$ and ${R}_{2} = 1\mathrm{M}\Omega$ .)
7.2-6. In Example 7.2-3, calculate the value of the input pole of the current amplifier and compare with the magnitude of the output pole.
7.2-7. Add a second input to the voltage amplifier of Fig. 7.2-12 using another ${R}_{1}$ resistor connected from this input to the input of the current amplifier. Using the configuration of Fig. P7.2-7, calculate the input resistance, output resistance, and $- 3\mathrm{{dB}}$ frequency of this circuit. Assume the values for Fig. 7.2-12 as developed in Example 7.2-3 but let the two ${R}_{1}$ resistors each be ${1000\Omega }$ .

Figure P7.2-7
7.2-8. Replace ${R}_{1}$ in Fig. 7.2-12 with a differential amplifier using a current-mirror load. Design the differential transconductance, ${g}_{m}$ , so that it is equal to $1/{R}_{1}$ .
7.3-1. Compare the differential-output op amps of Figs. 7.3-3, 7.3-5, 7.3-6, 7.3-8, and 7.3-11 from the viewpoint of (a) noise, (b) PSRR, (c) ICMR $\left\lbrack  {{V}_{ic}\left( \max \right) \text{and}{V}_{ic}\left( \min \right) }\right\rbrack$ ,(d) OCMR $\left\lbrack  {{V}_{o}\left( \max \right) \text{and}{V}_{o}\left( \min \right) }\right\rbrack$ , and (d) ${SR}$ assuming that all input differential currents are identical.
7.3-2. Find the single-ended equivalent loads for Fig. 7.3-4. What would be the single-ended equivalent loads if ${C}_{L}$ was replaced with a resistor, ${R}_{L}$ ?
7.3-3. Two differential-output op amps are shown in Fig. P7.3-3. (a) Show how to compensate these op amps. (b) If all dc currents through all transistors are ${50\mu }\mathrm{A}$ and all $W/L$ values are ${10\mu }\mathrm{m}/{1\mu }\mathrm{m}$ , use the parameters of Table 3.1-2 and find the differential-in, differential-out small-signal voltage gain.
7.3-4. If ${g}_{mN} = {g}_{mP}$ and ${r}_{dsN} = {r}_{dsP}$ , find an approximate expression for the small-signal differential-in, differential-out voltage gain and the small-signal differential output resistance of Fig. 7.3-3.
7.3-5. If ${g}_{mN} = {g}_{mP}$ and ${r}_{dsN} = {r}_{dsP}$ , find the approximate small-signal differential-in, differential-out voltage gain and the small-signal differential-output resistance of Fig. P7.3-5.

7.3-6. If ${g}_{mN} = {g}_{mP}$ and ${r}_{dsN} = {r}_{dsP}$ , find an approximate expression for the differential voltage gain and differential-output resistance of the folded-cascode, differential-output op amp of Fig. 7.3-6.
7.3-7. If ${g}_{mN} = {g}_{mP}$ and ${r}_{dsN} = {r}_{dsP}$ , find the approximate expression for the differential voltage gain of the enhancement amplifier of the enhanced-gain, folded-cascode, differential-output op amp in Fig. 7.3-7(b).
7.3-8. If ${g}_{mN} = {g}_{mP}$ and ${r}_{dsN} = {r}_{dsP}$ , find the differential voltage gain and the differential output resistance of the Class B, folded-cascode, push-pull, differential-output op amp in Fig. 7.3-8.
7.3-9. If ${g}_{mN} = {g}_{mP}$ and ${r}_{dsN} = {r}_{dsP}$ , find the differential voltage gain and differential-output resistance of the Class AB, differential-output op amp using a cross-coupled differential-input stage shown in Fig. 7.3-11.
7.3-10. Use the common-mode output stabilization circuit of Fig. P7.3-10 to stabilize the differential output op amp of Fig. 7.3-3 to ground assuming that the power supplies are split around ground $\left( {{V}_{DD} = \left| {V}_{SS}\right| }\right)$ . Design a correction circuit that will function properly.
7.3-11. (a) If all transistors in Fig. 7.3-14 have a dc current of ${50\mu }\mathrm{A}$ and a $W/L$ of ${10\mu }\mathrm{m}/{1\mu }\mathrm{m}$ , find the gain of the common-mode feedback loop. (b) If the output of this amplifier is cas-coded, then repeat part (a).

Figure P7.3-10
7.3-12. Show how to use the common feedback circuit of Fig. 5.2-16 to stabilize the common-mode output voltage of Fig. 7.3-5. What would be the approximate gain of the common-mode feedback loop (in terms of ${g}_{m}$ and ${r}_{ds}$ ) and how would you compensate the common-mode feedback loop?
7.3-13. If ${g}_{mN} = {g}_{mP}$ and ${r}_{dsN} = {r}_{dsP}$ , find the loop gain of the common-mode feedback circuit shown in Fig. 7.3-15.
7.3-14. If ${g}_{mN} = {g}_{mP}$ and ${r}_{dsN} = {r}_{dsP}$ , find the loop gain of the common-mode feedback circuit shown in Fig. 7.3-16.
7.4-1. Calculate the gain, ${GB},{SR}$ , and ${P}_{\text{diss }}$ for the folded-cascode op amp of Fig. 6.5-7(b) if ${V}_{DD} =  - {V}_{SS} = {1.5}\mathrm{\;V}$ ; the current in the differential amplifier pair is ${50}\mathrm{{nA}}$ each; and the current in the sources, M4 and M5, is 150 nA. Assume the transistors are all ${10\mu }\mathrm{m}/{1\mu }\mathrm{m}$ and the load capacitor is $2\mathrm{{pF}}$ .
7.4-2. Calculate the gain, ${GB},{SR}$ , and ${P}_{\text{diss }}$ for the op amp of Fig. 7.4-3, where ${I}_{5} = {100}\mathrm{{nA}}$ , transistors M1 through M11 widths are 10 $\mu \mathrm{m}$ and lengths are ${1\mu }\mathrm{m}$ , and ${V}_{DD} =  - {V}_{SS}$ $= {1.5}\mathrm{\;V}$ . If the saturation voltage is ${0.1}\mathrm{\;V}$ , design the $W/L$ values of M12 through M15 that achieve maximum and minimum output swing assuming the transistors M12 and M15 have ${50}\mathrm{{nA}}$ . Assume that ${I}_{DO} = 2$ $\mathrm{{nA}},{n}_{p} = {1.5},{n}_{n} = {2.5}$ , and ${V}_{t} = {26}\mathrm{{mV}}$ .
7.4-3. Derive Eq. (7.4-17). If $A = 2$ , at what value of ${v}_{\mathrm{{IN}}}/n{V}_{t}$ will ${i}_{\mathrm{{OUT}}} = 5{I}_{5}$ ?
7.4-4. Design the current boosting mirror of Fig. ${7.4} - 6\left( \mathrm{a}\right)$ to achieve ${100\mu }\mathrm{A}$ output when M2 is saturated. Assume that ${i}_{1} = {10\mu }\mathrm{A}$ and ${W}_{1}/{L}_{1} = {10}$ . Find ${W}_{2}/{L}_{2}$ and the value of ${V}_{DS2}$ where ${i}_{2} = {10\mu }\mathrm{A}$ .
7.4-5. In the op amp of Fig. 7.4-7, the current boosting idea illustrated in Fig. 7.4-6 suffers from the problem that as the gate of M15 or $\mathrm{M}{16}$ is increased to achieve current boosting, the gate-source drop of these transistors increases and prevents the ${v}_{DS}$ of the boosting transistor (M11 and M12) from reaching saturation. Show how to solve this problem.
7.5-1. For the transistor amplifier in Fig. P7.5-1, what is the equivalent input-noise voltage due to thermal noise? Assume the transistor has a dc drain current of ${20\mu }\mathrm{A}, W/L = {150\mu }\mathrm{m}/{10}$ $\mu \mathrm{m},{K}_{N}^{\prime } = {25\mu }\mathrm{A}/{\mathrm{V}}^{2}$ , and ${R}_{D}$ is ${100}\mathrm{k}\Omega$ .

Figure P7.5-1
7.5-2. Repeat Example 7.5-1 with ${W}_{1} = {W}_{2} =$ ${500\mu }\mathrm{m}$ and ${L}_{1} = {L}_{2} = {0.5\mu }\mathrm{m}$ to decrease the noise by a factor of 10 .
7.5-3. Interchange all n-channel and p-channel transistors in Fig. 7.5-1 and using the $W/L$ values designed in Example 7.5-1, find the input equivalent $1/f$ noise, the input equivalent thermal noise, the noise corner frequency, and the rms noise in a $1\mathrm{\;{Hz}}$ to100 $\mathrm{{kHz}}$ bandwidth.
7.5-4. Find the input equivalent rms noise voltage of the op amp designed in Example 6.3-1 over a bandwidth of $1\mathrm{\;{Hz}}$ to ${100}\mathrm{{kHz}}$ .
7.5-5. Find the input equivalent rms noise voltage of the op amp designed in Example 6.5-2 over a bandwidth of $1\mathrm{\;{Hz}}$ to ${100}\mathrm{{kHz}}$ .
7.6-1. If the $W$ and $L$ of all transistors in Fig. 7.6- 3are ${100\mu }\mathrm{m}$ and ${1\mu }\mathrm{m}$ , respectively, find the lowest supply voltage that gives a zero value of ICMR within the power-supply rails if the dc current in M5 is ${100\mu }\mathrm{A}$ .
7.6-2. Repeat Problem 7.6-1 if M1 and M2 are natural MOSFETs with a ${V}_{T} = {0.1}\mathrm{\;V}$ and the other MOSFET parameters are given in Table 3.1-2.
7.6-3. Repeat Problem 7.6-1 if M1 and M2 are depletion MOSFETs with a ${V}_{T} =  - 1\mathrm{\;V}$ and the other MOSFET parameters are given in Table 3.1-2.
7.6-4. Find the values of ${V}_{onn}$ and ${V}_{onp}$ of Fig. 7.6-4 if the $W$ and $L$ values of all transistors are ${10\mu }\mathrm{m}$ and ${1\mu }\mathrm{m}$ , respectively, and the bias currents in MN5 and MP5 are ${100\mu }\mathrm{A}$ each.
7.6-5. Two n-channel source-coupled pairs, one using regular transistors and the other with depletion transistors having a ${V}_{T} =  - 1\mathrm{\;V}$ , are connected with their gates common and the sources taken to individual current sinks. The transistors are modeled by Table 3.1-2 except the threshold is $- 1\mathrm{\;V}$ for the depletion transistors. Design the combined source-coupled pairs to achieve rail-to-rail for a $0 - 2\mathrm{\;V}$ power supply. Try to keep the equivalent input transconductance constant over the ICMR. Show how to recombine the drain currents from each source-coupled pair in order to drive a second-stage, single-ended.
7.6-6. Show how to create current mirrors by appropriately modifying the circuits in Section 4.4 that will have excellent matching and a ${V}_{MIN}\left( \mathrm{{in}}\right)  = {V}_{ON}$ and ${V}_{MIN}\left( \text{out}\right)  = {V}_{ON}$ .
7.6-7. Show how to modify Fig. 7.6-16 to compensate for the temperature range to the left of where the two characteristics cross.
7.6-8. For the op amp of Example 7.6-1, find the output and higher-order poles while increasing the ${GB}$ as much as possible and still maintaining a ${60}^{ \circ  }$ phase margin. Assume that $\mathrm{L}1 + \mathrm{L}2 + \mathrm{L}3 = {2\mu }\mathrm{m}$ in order to calculate the bulk-source/drain depletion capacitors (assume zero voltage bias). What is the new value of ${GB}$ and the value of ${C}_{c}$ ?
7.6-9. Assume that the input transistors of the folded-cascode op amp of Fig. 7.3-6 are NMOS native transistors with a threshold voltage of $0\mathrm{\;V}$ . Find the upper and lower input common-mode range. What is the ICMR (within the rails) if ${V}_{DD} = {1.5}\mathrm{\;V}$ , the magnitude of the p-channel and n-channel devices is ${0.5}\mathrm{\;V}$ , and the magnitude of the drain-source saturation voltage is ${0.2}\mathrm{\;V}$ ?
7.6-10. Repeat Problem 7.6-9 if M1 and M2 are depletion devices with a threshold of $- {0.5}\mathrm{\;V}$ .
## References
1. M. Milkovic, "Current Gain High-Frequency CMOS Operational Amplifiers," IEEE J. Solid-State Circuits, Vol. SC-20, No. 4, pp. 845-851, Aug. 1985.
2. D. G. Maeding, "A CMOS Operational Amplifier with Low Impedance Drive Capability," IEEE J. Solid-State Circuits, Vol. SC-18, No. 2, pp. 227-229, Apr. 1983.
3. K. E. Brehmer and J. B. Wieser, "Large Swing CMOS Power Amplifier," IEEE J. Solid-State Circuits, Vol. SC-18, No. 6, pp. 624-629, Dec. 1983.
4. R. B. Blackman, "Effect of Feedback on Impedance," Bell Syst. Tech. J., Vol. 22, pp. 269-277, 1943.
5. S. Masuda, Y. Kitamura, S. Ohya, and M. Kikuchi, "CMOS Sampled Differential, Push Pull Cascode Operational Amplifier," Proceedings of the 1984 International Symposium on Circuits and Systems, Montreal, Canada, May 1984, pp. 1211-1214.
6. P. E. Allen, and M. B. Terry, "The Use of Current Amplifiers for High Performance Voltage Amplification," IEEE J. Solid-State Circuits, Vol. SC-15, No. 2, pp. 155-162, Apr. 1980.
7. R. G. H. Eschauzier and J. H. Huijsing, Frequency Compensation Techniques for Low-Power Operational Amplifiers, Norwell, MA: Kluwer Academic Publishers, 1995, Chap. 6.
8. S. Rabii and B. A. Wooley, "A 1.8 V Digital-Audio Sigma-Delta Modulator in 0.8 μ.m CMOS," IEEE J. Solid-State Circuits, Vol. 32, No. 6, pp. 783-796, June 1997.
9. T. C. Choi, R. T. Kaneshiro, R. W. Broderson, P. R. Gray, W. B. Jett, and M. Wilcox, "High-Frequency CMOS Switched-Capacitor Filters for Communication Applications," IEEE J. Solid-State Circuits, Vol. SC-18, pp. 652-664, Dec. 1983.
10. P. R. Gray, P. J. Hurst, S. H. Lewis, and R. G. Meyer, Analysis and Design of Analog Integrated Circuits, 4th ed. New York: Wiley, 2001, p. 655.
11. P. W. Li, M. J. Chin, P. R. Gray, and R. Castello, "A Ratio-Independent Algorithmic Analog-to-Digital Conversion Technique," IEEE. J. Solid-State Circuits, Vol. SC-19, No. 6, pp. 828-836, Dec. 1984.
12. S. Lewis and P. Gray, "A Pipelined 5-Msample/s 9-bit Analog-to-Digital Converter," IEEE J. Solid-State Circuits, Vol. SC-22, No. 6, pp. 954-961, Dec. 1987.
13. M. G. Degrauwe, J. Rijmenants, E. A. Vittoz, and H. J. De Man, "Adaptive Biasing CMOS Amplifiers," IEEE J. Solid-State Circuits, Vol. SC-17, No. 3, pp. 522-528, June 1982.
14. M. Degrauwe, E. Vittoz, and I. Verbauwhede, "A Micropower CMOS-Instrumentation Amplifier," IEEE J. Solid-State Circuits, Vol. SC-20, No. 3, pp. 805-807, June 1985.
15. P. Van Peteghem, I. Verbauwhede, and W. Sansen, "Micropower High-Performance SC Building Block for Integrated Low-Level Signal Processing," IEEE J. Solid-State Circuits, Vol. SC-2, No. 4, pp. 837-844, Aug. 1985.
16. D. C. Stone, J. E. Schroeder, R. H. Kaplan, and A. R. Smith, "Analog CMOS Building Blocks for Custom and Semicustom Applications," IEEE J. Solid-State Circuits, Vol. SC-19, No. 1, pp. 55-61, Feb. 1984.
17. F. Krummenacher, "Micropower Switched Capacitor Biquadratic Cell," IEEE J. Solid-State Circuits, Vol. SC-17, No. 3, pp. 507-512, June 1982.
18. MAX406 Data Sheet, "1.2 μA Max, Single/Dual/Quad, Single-Supply Op Amps," Maxim Integrated Products, Sunnyvale, CA, 1993.
19. B. Razavi, "A Study of Phase Noise in CMOS Oscillators," IEEE J. Solid-State Circuits, Vol. SC-31, No. 3, pp. 331-343, Mar. 1996.
20. R. D. Jolly and R. H. McCharles, "A Low-Noise Amplifier for Switched Capacitor Filters," IEEE J. Solid-State Circuits, Vol. SC-17, No. 6, pp. 1192-1194, Dec. 1982.
21. E. A. Vittoz, "MOS Transistors Operated in the Lateral Bipolar Mode and Their Application in CMOS Technology," IEEE J. Solid-State Circuits, Vol. SC-18, No. 3, pp. 273-279, June 1983.
22. W. T. Holman and J. A. Connelly, "A Compact Low Noise Operational Amplifier for a 1.2 µm Digital CMOS Technology," IEEE J. Solid-State Circuits, Vol. SC-30, No. 6, pp. 710-714, June 1995.
23. K. C. Hsieh, P. R. Gray, D. Senderowicz, and D. G. Messerschmitt, "A Low-Noise Chopper-Stabilized Switched-Capacitor Filtering Technique," IEEE J. Solid-State Circuits, Vol. SC-16, No. 6, pp. 708-715, Dec. 1981.
24. C. Hu, "Future CMOS Scaling and Reliability," Proc. IEEE, Vol. 81, No. 5, May 1993.
25. International Technology Roadmap for Semiconductors (ITRS 2000), http://public.itrs.net.
26. R. Hogervorst et al.,"CMOS Low-Voltage Operational Amplifiers with Constant- ${g}_{m}$ Rail-to-Rail Input Stage," Analog Integrated Circuits and Signal Processing, Vol. 5, No. 4, pp. 135-146, Mar. 1994.
27. J. H. Botma et al.,"Rail-to-Rail Constant- ${G}_{m}$ Input Stage and Class AB Output Stage for Low-Voltage CMOS Op Amps," Analog Integrated Circuits and Signal Processing, Vol. 6, No. 2, pp. 121-133, Sept. 1994.
28. B. J. Blalock, P. E. Allen, and G. A. Rincon-Mora, "Designing 1-V Op Amps Using Standard Digital CMOS Technology," IEEE Trans. Circuits and Syst. II, Vol. 45, No. 7, pp. 769-780, July 1998.
29. B. J. Blalock and P. E. Allen, "A One-Volt, 120-μW, 1-MHz OTA for Standard CMOS Technology," Proc. ISCAS, Vol. 1, pp. 305-307, 1996.
30. G. A. Rincon-Mora and P. E. Allen, "A 1.1-V Current-Mode and Piecewise-Linear Curvature-Corrected Bandgap Reference," IEEE J. Solid-State Circuits, Vol. 33, No. 10, pp. 1551-1554, Oct. 1998.
31. R. G. H. Eschauzier and J. H. Huijsing, Frequency Compensation Techniques for Low-Power Operational Amplifiers. Norwell, MA: Kluwer Academic Publishers, 1995.
32. T. Lehmann and M. Cassia, "1V Power Supply CMOS Cascade Amplifier," IEEE J. Solid-State Circuits, Vol. SC-36, No. 7, pp. 1082-1086, July 2001.

$\mathrm{n}$ the previous two chapters, we have focused on the op amp and its design. Before considering how the op amp is used to accomplish various types of analog signal processing
and analog-digital conversion, we will examine the comparator. The comparator is a circuit that compares an analog signal with another analog signal or reference and outputs a binary signal based on the comparison. What is meant here by an analog signal is one that can have any of a continuum of amplitude values at a given point in time (see Section 1.1). In the strictest sense a binary signal can have only one of two given values at any point in time, but this concept of a binary signal is too ideal for real-world situations, where there is a transition region between the two binary states. It is important for the comparator to pass quickly through the transition region.
The comparator is widely used in the process of converting analog signals to digital signals. In the analog-to-digital conversion process, it is necessary to first sample the input. This sampled signal is then applied to a combination of comparators to determine the digital equivalent of the analog signal. In its simplest form, the comparator can be considered as a 1-bit analog-digital converter. The application of the comparator in analog-to-digital converters will be presented in Chapter 9.
The presentation on comparators will first examine the requirements and characterization of comparators. It will be seen that comparators can be divided into open-loop and regenerative comparators. The open-loop comparators are basically op amps without compensation. Regenerative comparators use positive feedback, similar to sense amplifiers or flip-flops, to accomplish the comparison of the magnitude between two signals. A third type of comparator emerges that is a combination of the open-loop and regenerative comparators. This combination results in comparators that are extremely fast.

### 8.1 Characterization of a Comparator
Figure 8.1-1 shows the circuit symbol for the comparator that will be used throughout this book. This symbol is identical to that for an operational amplifier, because a comparator has many of the same characteristics as a high-gain amplifier. A positive voltage applied at the ${v}_{P}$ input will cause the comparator output to go positive, whereas a positive voltage applied at the ${v}_{N}$ input will cause the comparator output to go negative. The upper and lower voltage limits of the comparator output are defined as ${V}_{OH}$ and ${V}_{OL}$ , respectively.

Figure 8.1-1 Circuit symbol for a comparator.
## Static Characteristics
A comparator was defined above as a circuit that has a binary output whose value is based on a comparison of two analog inputs. This is illustrated in Fig. 8.1-2. As shown in this figure, the output of the comparator is high $\left( {V}_{OH}\right)$ when the difference between the noninverting and inverting inputs is positive, and low $\left( {V}_{OL}\right)$ when this difference is negative. Even though this type of behavior is impossible in a real-world situation, it can be modeled with ideal circuit elements with mathematical descriptions. One such circuit model is shown in Fig. 8.1-3. It comprises a voltage-controlled voltage source (VCVS) whose characteristics are described by the mathematical formulation given on the figure.
The ideal aspect of this model is the way in which the output makes a transition between ${V}_{OL}$ and ${V}_{OH}$ . The output changes states for an input change of ${\Delta V}$ , where ${\Delta V}$ approaches zero. This implies a gain of infinity, as shown below.
$$
\text{ Gain } = {A}_{v} = \mathop{\lim }\limits_{{{\Delta V} \rightarrow  0}}\frac{{V}_{OH} - {V}_{OL}}{\Delta V} \tag{8.1-1}
$$
Figure 8.1-4 shows the dc transfer curve of a first-order model that is an approximation to a realizable comparator circuit. The difference between this model and the previous one is the gain, which can be expressed as
$$
{A}_{v} = \frac{{V}_{OH} - {V}_{OL}}{{V}_{IH} - {V}_{IL}} \tag{8.1-2}
$$
where ${V}_{IH}$ and ${V}_{IL}$ represent the input-voltage difference ${v}_{P} - {v}_{N}$ needed to just saturate the output at its upper and lower limit, respectively. This input change is called the resolution of the comparator. Gain is a very important characteristic describing comparator operation, for it defines the minimum amount of input change (resolution) necessary to make the output swing between the two binary states. These two output states are usually defined by the input requirements of the digital circuitry driven by the comparator output. The voltages ${V}_{OH}$ and ${V}_{OL}$ must be adequate to meet the ${V}_{IH}$ and ${V}_{IL}$ requirements of the following digital stage. For CMOS technology, these values are usually ${70}\%$ and ${30}\%$ , respectively, of the rail-to-rail supply voltage.

Figure 8.1-2 Ideal transfer curve of a comparator.

Figure 8.1-3 Model for an ideal comparator.
The transfer curve of Fig. 8.1-4 is modeled by the circuit of Fig. 8.1-5. This model looks similar to the model of Fig. 8.1-3, the only difference being the functions ${f}_{1}$ and ${f}_{0}$ .
The second nonideal effect seen in comparator circuits is input-offset voltage, ${V}_{OS}$ . In Fig. 8.1-2 the output changes as the input difference crosses zero. If the output did not change until the input difference reached a value $+ {V}_{OS}$ , then this difference would be defined as the offset voltage. This would not be a problem if the offset could be predicted, but it varies randomly from circuit to circuit [1] for a given design. Figure 8.1-6 illustrates offset in the transfer curve for a comparator, with the circuit model including an offset generator shown in Fig. 8.1-7. The $\pm$ sign of the offset voltage accounts for the fact that ${V}_{OS}$ is unknown in polarity.
In addition to the above characteristics, the comparator can have a differential-input resistance and capacitance and an output resistance. In addition, there will also be an input common-mode resistance, ${R}_{icm}$ . All these aspects can be modeled in the same manner as was done for the op amp in Section 6.1. Because the input to the comparator is usually differential, the input common-mode range is also important. The ICMR for a comparator would be that range of input common-mode voltage over which the comparator functions normally. This input common-mode range is generally the range where all transistors of the comparator remain in saturation. Even though the comparator is not designed to operate in the transition region between the two binary output states, noise is still important to the comparator. The noise of a comparator is modeled as if the comparator were biased in the transition region of the voltage-transfer characteristics. The noise will lead to an uncertainty in the transition region as shown in Fig. 8.1-8. The uncertainty in the transition region will lead to jitter or phase noise in the circuits where the comparator is employed.
## Dynamic Characteristics
The dynamic characteristics of the comparator include both small-signal and large-signal behavior. We do not know, at this point, how long it takes for the comparator to respond to the given differential input. The characteristic delay between input excitation and output transition is the time response of the comparator. Figure 8.1-9 illustrates the response of a comparator to an input as a function of time. Note that there is a delay between the input excitation and the output response. This time difference is called the propagation delay time of the comparator. It is a very important parameter since it is often the speed limitation in the conversion rate of an $\mathrm{A}/\mathrm{D}$ converter. The propagation delay time in comparators generally varies as a function of the amplitude of the input. A larger input will result in a smaller delay time. There is an upper limit at which a further increase in the input voltage will no longer affect the delay. This mode of operation is called slewing or slew rate.

Figure 8.1-4 Transfer curve of a comparator with finite gain.

Figure 8.1-5 Model for a comparator with finite gain.
The small-signal dynamics are characterized by the frequency response of the comparator. A simple model of this behavior assumes that the differential voltage gain, ${A}_{v}$ , is given as
$$
{A}_{v}\left( s\right)  = \frac{{A}_{v}\left( 0\right) }{\frac{s}{{\omega }_{c}} + 1} = \frac{{A}_{v}\left( 0\right) }{s{\tau }_{c} + 1} \tag{8.1-3}
$$
where ${A}_{v}\left( 0\right)$ is the dc gain of the comparator and ${\omega }_{c} = 1/{\tau }_{c}$ is the $- 3\mathrm{\;{dB}}$ frequency of the single (dominant) pole approximation to the comparator frequency response. Normally, the ${A}_{v}\left( 0\right)$ and ${\omega }_{c}$ of the comparator are smaller and larger, respectively, than for an op amp.
Let us assume that the minimum change of voltage at the input of the comparator is equal to the resolution of the comparator. We will define this minimum input voltage to the comparator as
$$
{V}_{\text{in }}\left( \min \right)  = \frac{{V}_{OH} - {V}_{OL}}{{A}_{v}\left( 0\right) } \tag{8.1-4}
$$
For a step input voltage, the output of the comparator modeled by Eq. (8.1-3) rises (or falls) with a first-order exponential time response from ${V}_{OL}$ to ${V}_{OH}$ (or ${V}_{OH}$ to ${V}_{OL}$ ) as shown in

Figure 8.1-6 Transfer curve of a comparator including input-offset voltage.

Figure 8.1-7 Model for a comparator including input-offset voltage.
Fig. 8.1-10. If ${V}_{\text{in }}$ is larger than ${V}_{\text{in }}\left( \min \right)$ , the output rise or fall time is faster. When ${V}_{\text{in }}\left( \min \right)$ is applied to the comparator, we can write the following equation:
$$
\frac{{V}_{OH} - {V}_{OL}}{2} = {A}_{v}\left( 0\right) \left\lbrack  {1 - {e}^{-{t}_{p}/{\tau }_{c}}}\right\rbrack  {V}_{\text{in }}\left( \min \right)  = {A}_{v}\left( 0\right) \left\lbrack  {1 - {e}^{-{t}_{p}/{\tau }_{c}}}\right\rbrack  \left( \frac{{V}_{OH} - {V}_{OL}}{{A}_{v}\left( 0\right) }\right)  \tag{8.1-5}
$$
Therefore, the propagation delay time for an input step of ${v}_{\text{in }}\left( \min \right)$ can be expressed as
$$
{t}_{p}\left( \max \right)  = {\tau }_{c}\ln \left( 2\right)  = {0.693}{\tau }_{c} \tag{8.1-6}
$$
This propagation delay time will be valid for either positive-going or negative-going comparator outputs. Note in Fig. 8.1-10 that if the applied input is $k$ times greater than ${V}_{\text{in }}\left( \min \right)$ , then the propagation delay time is given as
$$
{t}_{p} = {\tau }_{c}\ln \left( \frac{2k}{{2k} - 1}\right)  \tag{8.1-7}
$$
Figure 8.1-8 Influence of noise on a comparator.

Figure 8.1-9 Propagation delay time of a noninverting comparator.
where
$$
k = \frac{{V}_{\text{in }}}{{V}_{\text{in }}\left( \min \right) } \tag{8.1-8}
$$
Obviously, the more overdrive applied to the input of this comparator, the smaller the propagation delay time.
As the overdrive increases to the comparator eventually the comparator enters a large-signal mode of operation. Under large-signal operation, a slew-rate limit will occur due to limited current to charge or discharge capacitors. If the propagation delay time is determined by the slew-rate of the comparator, then this time can be written as
$$
{t}_{p} = {\Delta T} = \frac{\Delta V}{SR} = \frac{{V}_{OH} - {V}_{OL}}{2 \cdot  {SR}} \tag{8.1-9}
$$
In the case where the propagation time is determined by the slew rate, the most important factor to decrease the propagation time is increasing the sinking or sourcing capability of the comparator.
---
Example 8.1-1
---
## Propagation Delay Time of a Comparator
Find the propagation delay time of an open-loop comparator that has a dominant pole at ${10}^{3}\mathrm{{rad}}/\mathrm{s}$ , a dc gain of ${10}^{4}$ , a slew rate of $1\mathrm{\;V}/\mu \mathrm{s}$ , and a binary output voltage swing of $1\mathrm{\;V}$ . Assume the applied input voltage is ${10}\mathrm{{mV}}$ .
## SOLUTION
The input resolution for this comparator is $1\mathrm{\;V}/{10}^{4}$ or ${0.1}\mathrm{\;{mV}}$ . Therefore, the ${10}\mathrm{\;{mV}}$ input is 100 times larger than ${v}_{\text{in }}\left( \min \right)$ , giving a $k$ of 100 . From Eq. (8.1-7) we get
$$
{t}_{p} = \frac{1}{{10}^{3}}\ln \left( \frac{2 \cdot  {100}}{2 \cdot  {100} - 1}\right)  = {10}^{-3}\ln \left( \frac{200}{199}\right)  = {5.01\mu }\mathrm{s}
$$
From Eq. (8.1-9) we get
$$
{t}_{p} = \frac{1}{{2.1} \times  {10}^{6}} = {0.5\mu }\mathrm{s}
$$
Therefore, the propagation delay time for this case is the larger or ${5.01\mu }\mathrm{s}$ .

Figure 8.1-10 Small-signal transient response for a comparator.

### 8.2 Two-Stage, Open-Loop Comparators
A close examination of the previous requirements for a comparator reveal that it requires a differential input and sufficient gain to be able to achieve the desired resolution. As a result, the two-stage op amp of Chapter 6 makes an excellent implementation of the comparator [1]. A simplification occurs because the comparator will generally be used in an open-loop mode and therefore it is not necessary to compensate the comparator. In fact, it is preferred not to compensate the comparator so that it has the largest bandwidth possible, which will give a faster response. Therefore, we will examine the performance of the two-stage, uncompensated op amp shown in Fig. 8.2-1 used as a comparator.
## Two-Stage, Open-Loop Comparator Performance
The first item of interest is the values of ${V}_{OH}$ and ${V}_{OL}$ for the two-stage comparator of Fig. 8.2- 1. Since the output stage is a current-sink inverter, the approach used in Section 5.1 for the current-sink/source inverter can be used. The maximum output voltage, assuming that the gate of M6 has a minimum voltage given as ${V}_{G6}$ (min), can be expressed as
$$
{V}_{OH} = {V}_{DD} - \left( {{V}_{DD} - {V}_{G6}\left( \min \right)  - \left| {V}_{TP}\right| }\right) \left\lbrack  {1 - \sqrt{1 - \frac{2{I}_{7}}{{\beta }_{6}{\left( {V}_{DD} - {V}_{G6}\left( \min \right)  - \left| {V}_{TP}\right| \right) }^{2}}}}\right\rbrack   \tag{8.2-1}
$$
The minimum output voltage is
$$
{V}_{OL} = {V}_{SS} \tag{8.2-2}
$$
The small-signal gain of the comparator was developed in Section 6.2 and is given as
$$
{A}_{v}\left( 0\right)  = \left( \frac{{g}_{m1}}{{g}_{ds2} + {g}_{ds4}}\right) \left( \frac{{g}_{m6}}{{g}_{ds6} + {g}_{ds7}}\right)  \tag{8.2-3}
$$
Using Eqs. (8.2-1) through (8.2-3) and Eq. (8.1-4) gives the resolution of the comparator, which is ${V}_{\text{in }}\left( \min \right)$ .
Figure 8.2-1 Two-stage comparator.

The comparator of Fig. 8.2-1 has two poles of interest. One is the output pole of the first stage, ${p}_{1}$ , and the second is the output pole of the second stage, ${p}_{2}$ . These poles are expressed as
$$
{p}_{1} = \frac{-\left( {{g}_{ds2} + {g}_{ds4}}\right) }{{C}_{I}} \tag{8.2-4a}
$$
and
$$
{p}_{2} = \frac{-\left( {{g}_{ds6} + {g}_{ds7}}\right) }{{C}_{II}} \tag{8.2-4b}
$$
where ${C}_{I}$ is the sum of the capacitances connected to the output of the first stage and ${C}_{II}$ is the sum of the capacitances connected to the output of the second stage. ${C}_{H}$ will generally be dominated by ${C}_{L}$ . The frequency response of the two-stage comparator can be expressed using the above results as
$$
{A}_{v}\left( s\right)  = \frac{{A}_{v}\left( 0\right) }{\left( {\frac{s}{{p}_{1}} - 1}\right) \left( {\frac{s}{{p}_{2}} - 1}\right) } \tag{8.2-5}
$$
The following example illustrates the practical values for the two-stage, open-loop comparator.
---
Example 8.2-1
---
## Performance of a Two-Stage Comparator
Evaluate ${V}_{OH},{V}_{OL},{A}_{v}\left( 0\right) ,{V}_{\text{in }}\left( \min \right) ,{p}_{1}$ , and ${p}_{2}$ for the two-stage comparator shown in Fig. 8.2-1. Assume that this comparator is the circuit of Example 6.3-1 with no compensation capacitor, ${C}_{c}$ , and the minimum value of ${V}_{G6} = 0\mathrm{\;V}$ . Also, assume that ${C}_{I} = {0.2}\mathrm{{pF}}$ and ${C}_{II} = 5\mathrm{{pF}}$ .
## SOLUTION
Using Eq. (8.2-1), we find that
$$
{V}_{OH} = {2.5} - \left( {{2.5} - 0 - {0.7}}\right) \left\lbrack  {1 - \sqrt{1 - \frac{2 \cdot  {95} \times  {10}^{-6}}{{50} \times  {10}^{-6} \cdot  {14}{\left( {2.5} - 0 - {0.7}\right) }^{2}}}}\right\rbrack   = {2.42}\mathrm{\;V}
$$
The value of ${V}_{OL}$ is found from Eq. (8.2-2) and is -2.5 V. Equation (8.2-3) was evaluated in Example 6.3-1 as ${A}_{v}\left( 0\right)  = {7696}$ . Thus, from Eq. (8.1-2) we find the input resolution as
$$
{V}_{\text{in }}\left( \min \right)  = \frac{{V}_{OH} - {V}_{OL}}{{A}_{v}\left( 0\right) } = \frac{{4.92}\mathrm{\;V}}{7696} = {0.640}\mathrm{{mV}}
$$
Next, we find the poles of the comparator, ${p}_{1}$ and ${p}_{2}$ . From Example 6.3-1 we find that
$$
{p}_{1} =  - \frac{{g}_{ds2} + {g}_{ds4}}{{C}_{I}} =  - \frac{{15} \times  {10}^{-6}\left( {{0.04} + {0.05}}\right) }{{0.2} \times  {10}^{-{12}}} =  - {6.75} \times  {10}^{6}\left( {{1.074}\mathrm{{MHz}}}\right)
$$
and
$$
{p}_{2} =  - \frac{{g}_{ds6} + {g}_{ds7}}{{C}_{H}} =  - \frac{{95} \times  {10}^{-6}\left( {{0.04} + {0.05}}\right) }{5 \times  {10}^{-{12}}} =  - {1.71} \times  {10}^{6}\left( {{0.670}\mathrm{{MHz}}}\right)
$$
The response of a two-stage, open-loop comparator having two poles to a step input of ${V}_{\text{in }}$ is given as
$$
{v}_{\text{out }}\left( t\right)  = {A}_{v}\left( 0\right) {V}_{\text{in }}\left\lbrack  {1 + \frac{{p}_{2}{e}^{-t{p}_{1}}}{{p}_{1} - {p}_{2}} - \frac{{p}_{1}{e}^{-t{p}_{2}}}{{p}_{1} - {p}_{2}}}\right\rbrack   \tag{8.2-6}
$$
where ${p}_{1} \neq  {p}_{2}$ . Equation (8.2-6) is valid for the output unless the rate of rise or fall of the output exceeds the slew rate of the output of the comparator. The slew rate of the output is similar to a Class A inverter and the negative slew rate is
$$
S{R}^{ - } = \frac{{I}_{7}}{{C}_{II}} \tag{8.2-7}
$$
The positive slew rate is determined by the current sourced by M6. This slew rate is expressed as
$$
S{R}^{ + } = \frac{{I}_{6} - {I}_{7}}{{C}_{II}} = \frac{{\beta }_{6}{\left( {V}_{DD} - {V}_{G6}\left( \min \right)  - \left| {V}_{TP}\right| \right) }^{2} - {I}_{7}}{{C}_{II}} \tag{8.2-8}
$$
If the rate of rise or fall of Eq. (8.2-6) exceeds the positive or negative slew rate, then the output response is simply a ramp whose slope is given by Eq. (8.2-7) or (8.2-8).
Assuming that slew does not occur, the step response of the two-pole comparator of Eq. (8.2-6) can be plotted by normalizing the amplitude and time. The result is
$$
{v}_{\text{out }}^{\prime }\left( {t}_{n}\right)  = \frac{{v}_{\text{out }}\left( {t}_{n}\right) }{{A}_{v}\left( 0\right) {V}_{\text{in }}} = 1 - \frac{m}{m - 1}{e}^{-{t}_{n}} + \frac{1}{m - 1}{e}^{-m{t}_{n}} \tag{8.2-9}
$$
where
$$
m = \frac{{p}_{2}}{{p}_{1}} \neq  1 \tag{8.2-10}
$$
and
$$
{t}_{n} =  - t{p}_{1} \tag{8.2-11}
$$
If $m = 1$ , then Eq. (8.2-9) becomes
$$
{v}_{\text{out }}^{\prime }\left( {t}_{n}\right)  = 1 - {e}^{tp1} + t{p}_{1}{e}^{-{tp1}} = 1 - {e}^{-{t}_{n}} - {t}_{n}{e}^{-{t}_{n}} \tag{8.2-12}
$$
Equations (8.2-9) and (8.2-12) are shown in Fig. 8.2-2 for values of $m$ from 0.25 to 4 .
If the input step is larger than ${v}_{\text{in }}\left( \min \right)$ , then the amplitudes of the curves in Fig. 8.2-2 become limited at ${V}_{OH}$ . We note with interest that the slope at $t = 0$ is zero. This can be seen by differentiating Eq. (8.2-9) and letting $t = 0$ . The steepest slope of Eq. (8.2-9) occurs at
$$
{t}_{n}\left( \max \right)  = \frac{\ln \left( m\right) }{m - 1} \tag{8.2-13}
$$
which is found by differentiating Eq. (8.2-9) twice and setting the result equal to zero. The slope at ${t}_{n}\left( \max \right)$ can be written as
$$
\frac{d{v}_{\text{out }}^{\prime }\left( {{t}_{n}\left( \max \right) }\right) }{d{t}_{n}} = \frac{m}{m - 1}\left\lbrack  {\exp \left( \frac{-\ln \left( m\right) }{m - 1}\right)  - \exp \left( {-m\frac{\ln \left( m\right) }{m - 1}}\right) }\right\rbrack   \tag{8.2-14}
$$
If the slope of the linear response exceeds the slew rate, then the step response becomes slew limited. If the slew rate is close to the value of Eq. (8.2-14) it is not clear how to model the step response. One could assume a slew limited response until the slope of the linear response becomes less than the slew rate but this point is not easy to find. If the comparator is overdriven, ${V}_{\text{in }} > {V}_{\text{in }}\left( \min \right)$ , then if the slew rate is smaller than Eq. (8.2-14), the slew rate can be used to predict the step response.

Figure 8.2-2 Linear step response of a comparator with two real axis poles, ${p}_{1}$ and ${p}_{2}$ .
## Step Response of Example 8.2-1
Find the maximum slope of Example 8.2-1 and the time at which it occurs if the magnitude of the input step is ${V}_{\text{in }}\left( \min \right)$ . If the dc bias current in M7 of Fig. 8.2-1 is ${100\mu }\mathrm{A}$ , at what value of load capacitance, ${C}_{L}$ , would the transient response become slew limited? If the magnitude of the input step is ${100}{V}_{\text{in }}\left( \min \right)$ and ${V}_{OH} - {V}_{OL} = 1\mathrm{\;V}$ , what would be the new value of ${C}_{L}$ at which slewing would occur?
## SOLUTION
The poles of the comparator were given in Example 8.2-1 as ${p}_{1} =  - {6.75} \times  {10}^{6}\mathrm{{rad}}/\mathrm{s}$ and ${p}_{2} =  - {1.71} \times  {10}^{6}\mathrm{{rad}}/\mathrm{s}$ . This gives a value of $m = {0.253}$ . From Eq. (8.2-13), the maximum slope occurs at ${t}_{n}\left( \max \right)  = {1.84}\mathrm{\;s}$ . Dividing by $\left| {p}_{1}\right|$ gives $t\left( \max \right)  = {0.273\mu }\mathrm{s}$ . The slope of the transient response at this time is found from Eq. (8.2-14) as
$$
\frac{d{v}_{\text{out }}^{\prime }\left( {{t}_{n}\left( \max \right) }\right) }{d{t}_{n}} =  - {0.338}\left\lbrack  {\exp \left( {-{1.84}}\right)  - \exp \left( {-{0.253} \cdot  {1.84}}\right) }\right\rbrack   = {0.159}\mathrm{\;V}/\mathrm{s}
$$
Multiplying the above by $\left| {p}_{1}\right|$ gives
$$
\frac{d{v}_{\text{out }}^{\prime }\left( {t\left( \max \right) }\right) }{dt} = {1.072}\mathrm{\;V}/\mu \mathrm{s}
$$
Therefore, if the slew rate of the comparator is less than ${1.072}\mathrm{\;V}/\mu \mathrm{s}$ , the transient response will experience slewing. If the load capacitance, ${C}_{L}$ , becomes larger than $\left( {{100\mu }\mathrm{A}}\right) /$ $\left( {{1.072}\mathrm{\;V}/\mu \mathrm{s}}\right)$ or ${93.3}\mathrm{{pF}}$ , the comparator will experience slewing.
If the comparator is overdriven by a factor of ${100}{V}_{\text{in }}\left( \min \right)$ , then we must unnormalize the output slope as follows:
$$
\frac{d{v}_{\text{out }}^{\prime }\left( {t\left( \max \right) }\right) }{dt} = \frac{{v}_{\text{in }}}{{V}_{\text{in }}\left( \min \right) }\frac{d{v}_{\text{out }}^{\prime }\left( {t\left( \max \right) }\right) }{dt} = {100} \cdot  {1.072}\mathrm{\;V}/\mu \mathrm{s} = {107.2}\mathrm{\;V}/\mathrm{s}
$$
Therefore, the comparator will now slew with a load capacitance of ${0.933}\mathrm{{pF}}$ . For large overdrives, the comparator will generally experience slewing.
It is of interest to predict the propagation delay time for the two-pole comparator when slewing does not occur. To do this, we set Eq. (8.2-9) equal to ${0.5}\left( {{V}_{OH} + {V}_{OL}}\right)$ and solve for the propagation delay time, ${t}_{p}$ . Unfortunately, this equation is not easily solved. An alternate approach is to replace the exponential terms in Eq. (8.2-9) with their power series representations. This results in
$$
{v}_{\text{out }}\left( {t}_{n}\right)  \approx  {A}_{v}\left( 0\right) {V}_{\text{in }}\left\lbrack  {1 - \frac{m}{m - 1}\left( {1 - {t}_{n} + \frac{{t}_{n}^{2}}{2} + \cdots }\right) }\right.  \tag{8.2-15}
$$
$$
\left. {+\frac{1}{m - 1}\left( {1 - m{t}_{n} + \frac{{m}^{2}{t}_{n}^{2}}{2} + \cdots }\right) }\right\rbrack
$$
---
Example 8.2-2
---
Equation (8.2-15) can be simplified to
$$
{v}_{\text{out }}\left( {t}_{n}\right)  \approx  \frac{m{t}_{n}^{2}{A}_{v}\left( 0\right) {V}_{\text{in }}}{2} \tag{8.2-16}
$$
Setting ${v}_{\text{out }}\left( {t}_{n}\right)$ equal to ${0.5}\left( {{V}_{OH} + {V}_{OL}}\right)$ and solving for ${t}_{n}$ gives the normalized propagation delay time, ${t}_{pn}$ , as
$$
{t}_{pn} \approx  \sqrt{\frac{{V}_{OH} + {V}_{OL}}{m{A}_{v}\left( 0\right) {V}_{\text{in }}}} = \sqrt{\frac{{V}_{\text{in }}\left( \min \right) }{m{V}_{\text{in }}}} = \frac{1}{\sqrt{mk}} \tag{8.2-17}
$$
where $k$ was defined in Eq. (8.1-8). This result approximates the response of Fig. 8.2-2 as a parabola. For values of ${t}_{n}$ that are less than 1, this is a reasonable approximation. If one considers the influence of overdriving the input, then Eq. (8.2-17) is even a better approximation. The influence of overdriving is to only use the initial part of the response (i.e., it is like ${V}_{OH}$ is being lowered and brought closer to zero). The following example explores the application of Eq. (8.2-17) to predict the propagation time delay for a two-pole comparator.
---
Example 8.2-3
---
## Propagation Delay Time of a Two-Pole Comparator That Is Not Slewing
Find the propagation delay time of the comparator of Example 8.2-1 if ${V}_{\text{in }} = {10}\mathrm{{mV}},{100}\mathrm{{mV}}$ , and $1\mathrm{\;V}$ .
## SOLUTION
From Example 8.2-1 we know that ${V}_{\text{in }}\left( \min \right)  = {0.642}\mathrm{{mV}}$ and $m = {0.253}$ . For ${V}_{\text{in }} = {10}\mathrm{{mV}}$ , $k = {15.576}$ , which gives ${t}_{pn} = {0.504}$ . This corresponds well with Fig. 8.2-2, where the normalized propagation time delay is the time at which the amplitude is $1/\left( {2k}\right)$ or 0.032 . Dividing by $\left| {p}_{1}\right|$ gives the propagation time delay as ${72.7}\mathrm{{ns}}$ . Similarly, for ${V}_{\mathrm{{in}}} = {100}\mathrm{{mV}}$ and $1\mathrm{\;V}$ we get propagation delays time of ${23.6}\mathrm{\;{ns}}$ and ${7.5}\mathrm{\;{ns}}$ , respectively.
## Initial Operating States for the Two-Stage, Open-Loop Comparator
In order to analyze the propagation time delay of a slewing, two-stage, open-loop comparator, it is necessary to first be able to find the initial operating states of the output voltages of the first and second stages. Consider the two-stage, open-loop comparator of Fig. 8.2-3. The capacitances at the outputs of the first and second stages are ${C}_{I}$ and ${C}_{II}$ , respectively.
Our approach will be to choose one of the input gates equal to a dc voltage and find the output voltage of the first and second stages when the other input gate is above and below the dc voltage on the first gate. Actually, we need to consider two cases for each of the previous possibilities. These cases are when the currents in M1 and M2 are different but neither is zero and when one of the input transistors has a current of ${I}_{SS}$ and the other current is zero.
We begin by first assuming that ${v}_{G2}$ is equal to a dc voltage, ${V}_{G2}$ , and that ${v}_{G1} > {V}_{G2}$ with ${i}_{1} < {I}_{SS}$ and ${i}_{2} > 0$ . In this case, as long as M4 remains in saturation, ${i}_{4} = {i}_{3} = {i}_{1}$ , which is greater than ${i}_{2}$ . Consequently, ${v}_{o1}$ increases because of the difference current flowing into ${C}_{I}$ .

Figure 8.2-3 Two-stage, open-loop comparator used to find initial states.
As ${v}_{o1}$ continues to increase, M4 will become active and ${i}_{4} < {i}_{3}$ . When the voltage across the source-drain of M4 decreases to the point where ${i}_{4} = {i}_{2}$ , the output voltage of the first stage, ${v}_{o1}$ , stabilizes. This value of voltage is
$$
{V}_{DD} - {V}_{SD4}\left( \text{sat}\right)  < {v}_{o1} < {V}_{DD},\;{v}_{G1} > {V}_{G2},\;{i}_{1} < {I}_{SS}\;\text{and}\;{i}_{2} > 0 \tag{8.2-18}
$$
Under the conditions of Eq. (8.2-18), the value of ${v}_{SG6} < \left| {V}_{TP}\right|$ and M6 will be off and the output voltage will be
$$
{v}_{\text{out }} = {V}_{SS},\;{v}_{G1} > {V}_{G2},\;{i}_{1} < {I}_{SS}\;\text{ and }\;{i}_{2} > 0 \tag{8.2-19}
$$
If ${v}_{G1} \gg  {V}_{G2}$ , then ${i}_{1} = {I}_{SS}$ and ${i}_{2} = 0$ and ${v}_{o1}$ will be at ${V}_{DD}$ and ${v}_{\text{out }}$ is still at ${V}_{SS}$ .
Next, assume that ${v}_{G2}$ is still equal to ${V}_{G2}$ , but now ${v}_{G1} < {V}_{G2}$ with ${i}_{1} > 0$ and ${i}_{2} < {I}_{SS}$ . In this case, ${i}_{4} = {i}_{3} = {i}_{1}$ is less than ${i}_{2}$ and ${v}_{o1}$ decreases. When ${v}_{o1} \leq  {V}_{G2} - {V}_{TN}$ , then $\mathrm{M}2$ becomes active. As ${v}_{o1}$ continues to decrease, ${v}_{DS2} < {V}_{DS2}$ (sat), the current through M2 decreases until ${i}_{1} = {i}_{2} = {I}_{SS}/2$ at which point ${v}_{o1}$ stabilizes. At this point,
$$
{V}_{G2} - {V}_{GS2} < {v}_{o1} < {V}_{G2} - {V}_{GS2} + {V}_{DS2}\left( \text{ sat }\right)  \tag{8.2-20}
$$
or
$$
{V}_{S2} < {v}_{o1} < {V}_{S2} + {V}_{DS2}\left( \mathrm{{sat}}\right) ,\;{v}_{G1} < {V}_{G2},\;{i}_{1} > 0\;\text{ and }\;{i}_{2} < {I}_{SS} \tag{8.2-21}
$$
Under the conditions of Eq. (8.2-21), the output voltage, ${v}_{\text{out }}$ , will be near ${V}_{DD}$ and can be found following the approach used in Example 5.1-2. If ${v}_{G1} \ll  {V}_{G2}$ , the previous results are still valid until the source voltage of M1 or M2 causes M5 to leave the saturated region. When that happens, ${I}_{SS}$ decreases and ${v}_{o1}$ can approach ${V}_{SS}$ and ${v}_{\text{out }}$ will be determined as was illustrated in Example 5.1-2.
If the gate of $\mathrm{M}1$ is equal to a dc voltage of ${V}_{G1}$ , we can now examine the initial states of the outputs of the first and second stages by repeating the above process. First assume that ${v}_{G1} = {V}_{G1}$ and ${v}_{G2} > {V}_{G1}$ with ${i}_{2} < {I}_{SS}$ and ${i}_{1} > 0$ . As a result, ${i}_{1} < {i}_{2}$ gives ${i}_{4} < {i}_{2}$ as long as M4 is saturated. Therefore, ${v}_{o1}$ decreases because of the difference current flowing out of ${C}_{I}$ . As ${v}_{o1}$ decreases, M2 will become active and ${i}_{2}$ will decrease to the point where ${i}_{1} = {i}_{2} = {I}_{SS}/2$ . Therefore, ${v}_{o1}$ stabilizes and has a value given as
$$
{V}_{G1} - {V}_{GS2}\left( {{I}_{SS}/2}\right)  < {v}_{o1} < {V}_{G1} - {V}_{GS2}\left( {{I}_{SS}/2}\right)  + {V}_{DS2}\text{(sat)} \tag{8.2-22}
$$
$$
{V}_{S2}\left( {{I}_{SS}/2}\right)  < {v}_{o1} < {V}_{S2}\left( {{I}_{SS}/2}\right)  + {V}_{DS2}\left( \mathrm{{sat}}\right) ,\;{v}_{G2} > {V}_{G1},\;{i}_{1} > 0\;\text{ and }\;{i}_{2} < {I}_{SS} \tag{8.2-23}
$$
Under the conditions of Eq. (8.2-23), the output voltage, ${v}_{\text{out }}$ , will be near ${V}_{DD}$ and can be found following the approach used in Example 5.1-2. If ${v}_{G2} \gg  {V}_{G1}$ , the previous results are still valid until the source voltage of M1 or M2 causes M5 to leave the saturated region. When that happens, ${I}_{SS}$ decreases and ${v}_{o1}$ can approach ${V}_{SS}$ and ${v}_{\text{out }}$ will be determined as was illustrated in Example 5.1-2.
Next, assume that ${v}_{G1}$ is still equal to ${V}_{G1}$ , but now ${v}_{G2} < {V}_{G1}$ with ${i}_{1} < {I}_{SS}$ and ${i}_{2} > 0$ . As a result, ${i}_{1} > {i}_{2}$ , which gives ${i}_{4} > {i}_{2}$ , causing ${v}_{o1}$ to increase. As long as M4 is saturated, ${i}_{4} >$ ${i}_{2}$ . When M4 enters the active region, ${i}_{4}$ will decrease until ${i}_{4} = {i}_{2}$ at which point ${v}_{o1}$ stabilizes and is given as
$$
{V}_{DD} - {V}_{SD4}\left( \text{ sat }\right)  < {v}_{o1} < {V}_{DD},\;{v}_{G2} < {V}_{G1},\;{i}_{1} < {I}_{SS}\;\text{ and }\;{i}_{2} > 0 \tag{8.2-24}
$$
Under the conditions of Eq. (8.2-24), the value of ${v}_{SG6} < \left| {V}_{TP}\right|$ and M6 will be off and the output voltage will be
$$
{v}_{\text{out }} = {V}_{SS},\;{v}_{G2} < {V}_{G1},\;{i}_{1} < {I}_{SS}\text{ and }{i}_{2} > 0 \tag{8.2-25}
$$
If ${v}_{G2} \ll  {V}_{G1}$ , then ${i}_{1} = {I}_{SS}$ and ${i}_{2} = 0$ and ${v}_{o1}$ will be at ${V}_{DD}$ and ${v}_{\text{out }}$ is still at ${V}_{SS}$ . The above results are summarized in Table 8.2-1.
## Propagation Delay Time of a Slewing, Two-Stage,
## Open-Loop Comparator
In most applications, the two-stage, open-loop comparator is overdriven to the point where the propagation delay time is determined by the slewing performance of the comparator. In this case, the propagation delay time is found by evaluating the equation
$$
{i}_{i} = {C}_{i}\frac{d{v}_{i}}{d{t}_{i}} = {C}_{i}\frac{\Delta {v}_{i}}{\Delta {t}_{i}} \tag{8.2-26}
$$
where ${C}_{i}$ is the capacitance to ground at the output of the $i$ th stage. The propagation delay time of the $i$ th stage is found by solving for $\Delta {t}_{i}$ from Eq. (8.2-26) to get
$$
{t}_{i} = \Delta {t}_{i} = {C}_{i}\frac{\Delta {V}_{i}}{{I}_{i}} \tag{8.2-27}
$$
Table 8.2-1 Initial Operating States of the Two-Stage, Open-Loop Comparator of Fig. 8.2-3
<table><tr><td>Conditions</td><td>Initial State of ${\mathbf{v}}_{\mathrm{o}1}$</td><td>Initial State of ${v}_{\text{out }}$</td></tr><tr><td>${v}_{G1} > {V}_{G2},{i}_{1} < {I}_{SS}$ and ${i}_{2} > 0$</td><td>${V}_{DD} - {V}_{SD4}\left( \text{sat}\right)  < {v}_{o1} < {V}_{DD}$</td><td>${V}_{SS}$</td></tr><tr><td>${v}_{G1} >  > {V}_{G2},{i}_{1} = {I}_{SS}$ and ${i}_{2} = 0$</td><td>${V}_{DD}$</td><td>${V}_{SS}$</td></tr><tr><td>${v}_{G1} < {V}_{G2},{i}_{1} > 0$ and ${i}_{2} < {I}_{SS}$</td><td>${V}_{S2} < {v}_{o1} < {V}_{S2} + {V}_{DS2}$ (sat)</td><td>Eq. (5.1-19) for PMOS</td></tr><tr><td>${v}_{G1} <  < {V}_{G2},{i}_{1} = 0$ and ${i}_{2} = {I}_{SS}$</td><td>${V}_{DD}$</td><td>Eq. (5.1-19) for PMOS</td></tr><tr><td>${v}_{G2} > {V}_{G1},{i}_{1} > 0$ and ${i}_{2} < {I}_{SS}$</td><td>${V}_{S2}\left( {{I}_{SS}/2}\right)  < {v}_{o1} < {V}_{S2}\left( {{I}_{SS}/2}\right)  + {V}_{DS2}$ (sat)</td><td>Eq. (5.1-19) for PMOS</td></tr><tr><td>${v}_{G2} >  > {V}_{G1},{i}_{1} = 0$ and ${i}_{2} = {I}_{SS}$</td><td>${V}_{SS}$</td><td>Eq. (5.1-19) for PMOS</td></tr><tr><td>${v}_{G2} < {V}_{G1},{i}_{1} < {I}_{SS}$ and ${i}_{2} > 0$</td><td>${V}_{DD} - {V}_{SD4}\left( \text{sat}\right)  < {v}_{o1} < {V}_{DD}$</td><td>${V}_{SS}$</td></tr><tr><td>${v}_{G2} <  < {V}_{G1},{i}_{1} = {I}_{SS}$ and ${i}_{2} = 0$</td><td>${V}_{DD}$</td><td>${V}_{SS}$</td></tr></table>

Figure 8.2-4 Second stage of the two-stage, open-loop comparator.
The propagation delay time is found by summing the delays of each stage.
The term $\Delta {V}_{i}$ in Eq. (8.2-27) is generally equal to half of the output swing of the $i$ th stage. In some cases, the value of $\Delta {V}_{i}$ is determined by the threshold or trip point of the next stage. The trip point of an amplifier is the value of input that causes the output to be midway between its limits. In the two-stage, open-loop comparator, the second stage is generally a Class A inverting amplifier similar to that shown in Fig. 8.2-4. The trip point can be calculated by assuming both transistors are in saturation and equating the currents. The only unknown is the input voltage. Solving for this input voltage gives
$$
{v}_{\text{in }} = {V}_{TRP} = {V}_{DD} - \left| {V}_{TP}\right|  - \sqrt{\frac{{K}_{N}\left( {{W}_{7}/{L}_{7}}\right) }{{K}_{P}\left( {{W}_{6}/{L}_{6}}\right) }}\left( {{V}_{\text{BIAS }} - {V}_{SS} - {V}_{TN}}\right)  \tag{8.2-28}
$$
If we refer back to Fig. 5.1-5, we see that the trip point is really a range and not a specific value. However, if the slope of the inverting amplifier in the region where both transistors are saturated is steep enough, then the trip point can be considered to be a point.
---
Example 8.2-4
---
## Calculation of the Trip Point of an Inverting Amplifier
Use the model parameters of Table 3.1-2 and calculate the trip point of the inverter in Fig. 5.1-5. SOLUTION
It is probably easier to redevelop Eq. (8.2-28) for the inverter of Fig. 5.1-5 than to use Eq. (8.2-28). Equating the currents of M1 and M2 of Fig. 5.1-5 gives
$$
{V}_{TRP} = {V}_{TN} + \sqrt{\frac{{\beta }_{2}}{{\beta }_{1}}}\left( {{V}_{DD} - {V}_{\text{BIAS }} - \left| {V}_{TP}\right| }\right)  = {0.7} + \sqrt{\frac{{50}\left( 2\right) }{{110}\left( 2\right) }}\left( {{2.5} - {0.7}}\right)  = {1.913}\mathrm{\;V}
$$
We note that this value corresponds very closely with the value of input voltage at which the output of Fig. 5.1-5 is midway between power supplies.
The propagation delay time of a two-stage, open-loop comparator that is slewing can be calculated using the above ideas. The delay of the first stage is added to the delay of the second stage to get the total propagation delay time. Let us illustrate the procedure with an example.
---
Example 8.2-5
---
## Calculation of the Propagation Delay Time of a Two-Stage, Open-Loop Comparator
For the two-stage comparator shown in Fig. 8.2-5, assume that ${C}_{I} = {0.2}\mathrm{{pF}}$ and ${C}_{II} = 5\mathrm{{pF}}$ . Also, assume that ${v}_{G1} = 0\mathrm{\;V}$ and that ${v}_{G2}$ has the waveform shown in Fig. 8.2-6. If the input voltage is large enough to cause slew to dominate, find the propagation delay time of the rising and falling output of the comparator and give the propagation delay time of the comparator.

SOLUTION
The total delay will be given as the sum of the first- and second-stage delays, ${t}_{1}$ and ${t}_{2}$ , respectively. First, consider the change of ${v}_{G2}$ from -2.5 to ${2.5}\mathrm{\;V}$ at ${0.2\mu }\mathrm{s}$ . From Table 8.2- 1, the last row, the initial states of ${v}_{o1}$ and ${v}_{\text{out }}$ are +2.5 and $- {2.5}\mathrm{\;V}$ , respectively. To find the falling delay of the first stage, ${t}_{f1}$ , requires ${C}_{I},\Delta {V}_{o1}$ , and ${I}_{5} \cdot  {C}_{I} = {0.2}\mathrm{{pF}},{I}_{5} = {30\mu }\mathrm{A}$ , and $\Delta {V}_{1}$ can be calculated by finding the trip point of the output stage. Although we could use Eq. (8.2- 8), it is easier to set the current of M6 when saturated equal to ${234\mu }\mathrm{A}$ to get the trip point. Doing this we get
$$
\frac{{\beta }_{6}}{2}{\left( {V}_{SG6} - \left| {V}_{TP}\right| \right) }^{2} = {234\mu }\mathrm{A} \rightarrow  {V}_{SG6} = {0.7} + \sqrt{\frac{{234} \cdot  2}{{50} \cdot  {38}}} = {0.496}\mathrm{\;V}
$$
Subtracting this voltage from ${2.5}\mathrm{\;V}$ gives the trip point of the second stage as
$$
{V}_{TRP2} = {2.5} - {1.196} = {1.304}\mathrm{\;V}
$$
Therefore, $\Delta {V}_{1} = {2.5}\mathrm{\;V} - {1.304}\mathrm{\;V} = {V}_{SG6} = {1.196}\mathrm{\;V}$ . Thus, the falling propagation time delay of the first stage is
$$
{t}_{fo1} = \left( {{0.2}\mathrm{{pF}}}\right) \left( \frac{{1.196}\mathrm{\;V}}{{30\mu }\mathrm{A}}\right)  = 8\mathrm{{ns}}
$$
The rising propagation time delay of the second stage requires knowledge of ${C}_{II},\Delta {V}_{\text{out }}$ , and ${I}_{6}.{C}_{H}$ is given as $5\mathrm{{pF}},\Delta {V}_{\text{out }} = {2.5}\mathrm{\;V}$ (assuming the trip point of the circuit connected to the output of the comparator is $0\mathrm{\;V}$ ), and ${I}_{6}$ can be found as follows. When the gate of $\mathrm{M}6$ is at ${1.304}\mathrm{\;V}$ , the current is ${234\mu }\mathrm{A}$ . However, the output of the first stage will continue to fall, so what value should be used for the gate in order to calculate ${I}_{6}$ ? The lowest value of ${V}_{G6}$ is given as
$$
{V}_{G6} = {V}_{G1} - {V}_{GS2}\left( {{I}_{SS}/2}\right)  + {V}_{DS2} \approx   - {V}_{GS2}\left( {{I}_{SS}/2}\right)  =  - {0.7} - \sqrt{\frac{2 \cdot  {15}}{{110} \cdot  3}} =  - {1.00}\mathrm{\;V}
$$
Let us take the approximate value of ${V}_{G6}$ as midway between 1.304 and $- {1.00}\mathrm{\;V}$ , which is ${0.152}\mathrm{\;V}$ . Therefore, ${V}_{SG6} = {2.348}\mathrm{\;V}$ and the value of ${I}_{6}$ is
$$
{I}_{6} = \frac{{\beta }_{6}}{2}{\left( {V}_{SG6} - \left| {V}_{TP}\right| \right) }^{2} = \frac{{38} \cdot  {50}}{2}{\left( {2.348} - {0.7}\right) }^{2} = {2580\mu }\mathrm{A}
$$
which is a reminder that the active transistor can generally sink or source more current than the fixed transistor in the Class A inverting stage. The rising propagation time delay for the output can expressed as
$$
{t}_{r,\text{ out }} = \left( {5\mathrm{{pF}}}\right) \left( \frac{{2.5}\mathrm{\;V}}{{2580\mu }\mathrm{A} - {234\mu }\mathrm{A}}\right)  = {5.3}\mathrm{{ns}}
$$
Thus, the total propagation time delay of the rising output of the comparator is approximately 13.3 ns and most of this delay is attributable to the first stage.
Next, consider the change of ${v}_{G2}$ from 2.5 to $- {2.5}\mathrm{\;V}$ , which occurs at ${0.4\mu }\mathrm{s}$ . We shall assume that ${v}_{G2}$ has been at ${2.5}\mathrm{\;V}$ long enough for the conditions of Table 8.2-1 to be valid. Therefore, ${v}_{o1} \approx  {V}_{SS} =  - {2.5}\mathrm{\;V}$ and ${v}_{\text{out }} \approx  {V}_{DD}$ . Rather than use Eq. (5.1-19), we have assumed that ${v}_{\text{out }}$ is approximately ${V}_{DD}$ . The propagation delay times for the first and second stages are calculated as
$$
{t}_{ro1} = \left( {{0.2}\mathrm{{pF}}}\right) \left( \frac{{1.304}\mathrm{\;V} - \left( {-{1.000}}\right) }{{30\mu }\mathrm{A}}\right)  = {15.4}\mathrm{\;{ns}}
$$
and
$$
{t}_{f,\text{ out }} = \left( {5\mathrm{{pF}}}\right) \left( \frac{{2.5}\mathrm{\;V}}{{234\mu }\mathrm{A}}\right)  = {53.42}\mathrm{{ns}}
$$
The total propagation delay time of the falling output is ${68.82}\mathrm{\;{ns}}$ . Taking the average of the rising and falling propagation delays time gives a propagation delay time for this two-stage, open-loop comparator of about ${41}\mathrm{\;{ns}}$ . These values compare favorably with the simulation of the comparator shown in Fig. 8.2-7.

Figure 8.2-7 Response of Fig. 8.2-3 to the input shown in Fig. 8.2-6.
The previous example can be reworked for the case where ${v}_{G2}$ is held constant and ${v}_{G1}$ varies (see Problem 8.2-7). If the comparator is not slewing, then the propagation time delay will be determined by the linear step response of the comparator. The propagation time delay analysis becomes more complex if the comparator slews only for part of the step response. This is a case where simulation would provide the desired details.
## Design of a Two-Stage, Open-Loop Comparator
The design of a two-stage, open-loop comparator is similar in many respects to the two-stage op amp. The primary difference is that the comparator is not compensated. The typical input specifications include the propagation time delay, the output voltage swing, the resolution, and input common-mode range. There are two approaches to the design of the comparator depending on whether it is slewing or not. If the comparator is not slewing, then the pole locations are extremely important. On the other hand, if the comparator slews, then the ability to charge and discharge capacitors becomes more important.
For the nonslewing comparator, the propagation time is reduced by a large overdrive and the pole placement. The larger the magnitude of the poles, the shorter the propagation delay time. Since the poles are due to the capacitance and resistance to ground at the output of each stage, it is important to keep the value of capacitance and resistance small. The design procedure illustrated in Table 8.2-2 can be used to accomplish a minimum propagation delay time for the two-stage, open-loop comparator. This procedure attempts to design the pole locations to correspond to a desired propagation delay time. The procedure is simplified by assuming that $m = 1$ or the poles are equal.
Table 8.2-2 Design of the Two-Stage, Open-Loop Comparator of Fig. 8.2-3 for a Linear Response
---
<table><tr><td colspan="3">Specifications: ${t}_{p},{C}_{ll},{V}_{in}\left( \min \right) ,{V}_{OH},{V}_{OL},{V}_{icm}^{ + },{V}_{icm}^{ - }$ , and overdrive Constraints: Technology, ${V}_{DD}$ , and ${V}_{SS}$</td></tr><tr><td>Step</td><td>Design Relationships</td><td>Comments</td></tr><tr><td>1</td><td>$\left| {p}_{I}\right|  = \left| {p}_{II}\right|  = \frac{1}{{t}_{p}\sqrt{mk}}$ , and ${I}_{7} = {I}_{6} = \frac{\left| {p}_{II}\right| {C}_{II}}{{\lambda }_{N} + {\lambda }_{P}}$</td><td>Choose $m = 1$</td></tr><tr><td>2</td><td>$\frac{{W}_{6}}{{L}_{6}} = \frac{2 \cdot  {I}_{6}}{{K}_{P}^{\prime }{\left( {V}_{SD6}\left( \mathrm{{sat}}\right) \right) }^{2}}$ and $\frac{{W}_{7}}{{L}_{7}} = \frac{2 \cdot  {I}_{7}}{{K}_{N}^{\prime }{\left( {V}_{DS7}\left( \mathrm{{sat}}\right) \right) }^{2}}$</td><td>${V}_{SD6}\left( \text{sat}\right)  = {V}_{DD} - {V}_{OH}$ ${V}_{DS7}\left( \text{sat}\right)  = {V}_{OL} - {V}_{SS}$</td></tr><tr><td>3</td><td>Guess ${C}_{I}$ as ${0.1} - {0.5}\mathrm{{pF}}\therefore {I}_{5} = {I}_{7}\frac{2{C}_{I}}{{C}_{II}}$</td><td>A result of choosing $m = 1$ ; will check ${C}_{I}$ later</td></tr><tr><td>4</td><td>$\frac{{W}_{3}}{{L}_{3}} = \frac{{W}_{4}}{{L}_{4}} = \frac{{I}_{5}}{{K}_{P}^{\prime }{\left( {V}_{SG3} - \left| {V}_{TP}\right| \right) }^{2}}$</td><td>${V}_{SG3} = {V}_{DD} - {V}_{icm}^{ + } + {V}_{TN}$</td></tr><tr><td>5</td><td>${g}_{m1} = \frac{{A}_{v}\left( 0\right) \left( {{g}_{ds2} + {g}_{ds4}}\right) \left( {{g}_{ds6} + {g}_{ds7}}\right) }{{g}_{m6}}$</td><td>${g}_{m6} = \sqrt{\frac{2{K}_{P}^{\prime }{W}_{6}{I}_{6}}{{L}_{6}}}$</td></tr><tr><td/><td>$\frac{{W}_{1}}{{L}_{1}} = \frac{{W}_{2}}{{L}_{2}} = \frac{{g}_{m1}^{2}}{{K}_{N}{I}_{5}}$</td><td>${A}_{v}\left( 0\right)  = \frac{{V}_{OH} - {V}_{OL}}{{V}_{\text{in }}\left( \min \right) }$</td></tr><tr><td>6</td><td>Find ${C}_{I}$ and check assumption</td><td>${\mathrm{{AD}}}_{2} = {W}_{2}\left( {\mathrm{L}1 + \mathrm{L}2 + \mathrm{L}3}\right)$</td></tr><tr><td/><td>${C}_{I} = {C}_{gd2} + {C}_{gd4} + {C}_{gs6} + {C}_{bd2} + {C}_{bd4}$</td><td>${\mathrm{{PD}}}_{2} = 2\left( {{W}_{2} + \mathrm{L}1 + \mathrm{L}2 + \mathrm{L}3}\right)$</td></tr><tr><td/><td>If ${C}_{I}$ is greater than the guess in step 3, then increase the value</td><td>${\mathrm{{AD}}}_{4} = {W}_{4}\left( {\mathrm{L}1 + \mathrm{L}2 + \mathrm{L}3}\right)$</td></tr><tr><td/><td>of ${C}_{I}$ and repeat steps 4 through 6</td><td>${\mathrm{{PD}}}_{4} = 2\left( {{W}_{4} + \mathrm{L}1 + \mathrm{L}2 + \mathrm{L}3}\right)$</td></tr><tr><td>7</td><td>${V}_{DS5}\left( \text{sat}\right)  = {V}_{icm}^{ - } - {V}_{GS1} - {V}_{SS}$</td><td>If ${V}_{DS5}$ (sat) is less than ${100}\mathrm{\;{mV}}$ , increase ${W}_{1}/{L}_{1}$</td></tr><tr><td/><td>$\frac{{W}_{5}}{{L}_{5}} = \frac{2 \cdot  {I}_{5}}{{K}_{N}^{\prime }{\left( {V}_{DS5}\left( \mathrm{{sat}}\right) \right) }^{2}}$</td><td/></tr></table>
---
---
Example 8.2-6
---
## Design of the Two-Stage, Open-Loop Comparator of Fig. 8.2-3 for a Linear Response
Assume the specifications of Fig. 8.2-3 are given below:
$$
{\mathrm{V}}_{DD} = {2.5}\mathrm{\;V}\;{V}_{SS} =  - {2.5}\mathrm{\;V}\;{C}_{II} = 5\mathrm{{pF}}
$$
$$
{V}_{\text{in }}\left( \min \right)  = 1\mathrm{{mV}}\;{V}_{icm}^{ + } = 2\mathrm{\;V}\;{V}_{icm}^{ - } =  - {1.25}\mathrm{\;V}
$$
Also assume that the overdrive will be a factor of 10 . Design a two-stage, open-loop comparator using Fig. 8.2-3 to achieve the above specifications and assume that all channel lengths are to be ${1\mu }\mathrm{m}$ .
SOLUTION
Following the procedure outlined in Table 8.2-2, we choose $m = 1$ to get
$$
\left| {p}_{I}\right|  = \left| {p}_{II}\right|  = \frac{{10}^{9}}{{50}\sqrt{10}} = {6.32} \times  {10}^{6}\mathrm{{rad}}/\mathrm{s}
$$
This gives
$$
{I}_{6} = {I}_{7} = \frac{{6.32} \times  {10}^{6} \cdot  5 \times  {10}^{-{12}}}{{0.04} + {0.05}} = {351\mu }\mathrm{A} \rightarrow  {I}_{6} = {I}_{7} = {400\mu }\mathrm{A}
$$
Therefore,
$$
\frac{{W}_{6}}{{L}_{6}} = \frac{2 \cdot  {400}}{{\left( {0.5}\right) }^{2} \cdot  {50}} = {64}\;\text{ and }\;\frac{{W}_{7}}{{L}_{7}} = \frac{2 \cdot  {400}}{{\left( {0.5}\right) }^{2} \cdot  {110}} = {29}
$$
Next, we guess ${C}_{I} = {0.2}\mathrm{{pF}}$ . This gives ${I}_{5} = {32\mu }\mathrm{A}$ and we will increase it to ${40\mu }\mathrm{A}$ for a margin of safety. Step 4 gives ${V}_{SG3}$ as ${1.2}\mathrm{\;V}$ , which results in
$$
\frac{{W}_{3}}{{L}_{3}} = \frac{{W}_{4}}{{L}_{4}} = \frac{40}{{50}{\left( {1.2} - {0.7}\right) }^{2}} = {3.2} \rightarrow  \frac{{W}_{3}}{{L}_{3}} = \frac{{W}_{4}}{{L}_{4}} = 4
$$
The desired gain is found to be 4000 , which gives an input transconductance of
$$
{g}_{m1} = \frac{{4000} \cdot  {0.09} \cdot  {20}}{44.44} = {162\mu }\mathrm{S}
$$
This gives the $W/L$ ratios of M1 and M2 as
$$
\frac{{W}_{1}}{{L}_{1}} = \frac{{W}_{2}}{{L}_{2}} = \frac{{\left( {162}\right) }^{2}}{{110} \cdot  {40}} = {5.96} \rightarrow  \frac{{W}_{1}}{{L}_{1}} = \frac{{W}_{2}}{{L}_{2}} = 6
$$
To check the guess for ${C}_{I}$ we need to calculate it, which is done as
$$
{C}_{I} = {C}_{gd2} + {C}_{gd4} + {C}_{gs6} + {C}_{bd2} + {C}_{bd4} = {0.9}\mathrm{{fF}} + {1.3}\mathrm{{fF}} + {119.5}\mathrm{{fF}} + {20.4}\mathrm{{fF}} + {36.8}\mathrm{{fF}}
$$
$$
= {178.9}\mathrm{{fF}}
$$
which is less than what was guessed so we will make no changes.
Finally, the $W/L$ value of M5 is found by finding ${V}_{GS1}$ as ${0.946}\mathrm{\;V}$ , which gives ${V}_{DS5}$ (sat) $= {0.304}\mathrm{\;V}$ . This gives
$$
\frac{{W}_{5}}{{L}_{5}} = \frac{2 \cdot  {40}}{{\left( {0.304}\right) }^{2} \cdot  {110}} = {7.87} \approx  8
$$
Obviously, M5 and M7 cannot be connected gate-gate and source-source. The values of ${I}_{5}$ and ${I}_{7}$ must be derived separately as illustrated in Fig. 8.2-8. The $W$ values are summarized below, assuming that all channel lengths are ${1\mu }\mathrm{m}$ .
$$
{W}_{1} = {W}_{2} = {6\mu }\mathrm{m}\;{W}_{3} = {W}_{4} = {4\mu }\mathrm{m}\;{W}_{5} = {8\mu }\mathrm{m}
$$

Figure 8.2-8 Biasing scheme for the comparator of Example 8.2-6.
The design of the slewing, two-stage, open-loop comparator has a different focus than the design suggested in Table 8.2-2 for the linear response. In this case we assume that the large-signal conditions dominate the design. A typical design procedure for the slewing case is shown in Table 8.2-3.
Table 8.2-3 Design of the Two-Stage, Open-Loop Comparator of Fig. 8.2-3 for a Slewing Response
<table><tr><td colspan="3">Specifications: ${t}_{p},{C}_{lI},{V}_{in}\left( \min \right) ,{V}_{OH},{V}_{OL},{V}_{icm}^{ + },{V}_{icm}^{ - }$ Constraints: Technology, ${V}_{DD}$ , and ${V}_{SS}$</td></tr><tr><td>Step</td><td>Design Relationships</td><td>Comments</td></tr><tr><td>1</td><td>${I}_{7} = {I}_{6} = {C}_{II}\frac{d{v}_{\text{out }}}{dt} = \frac{{C}_{II}\left( {{V}_{O{H}^{ - }}{V}_{OL}}\right) }{{t}_{p}}$</td><td>Assume the trip point of the output is $\left( {{V}_{OH} - {V}_{OL}}\right) /2$</td></tr><tr><td>2</td><td>$\frac{{W}_{6}}{{L}_{6}} = \frac{2 \cdot  {I}_{6}}{{K}_{P}^{\prime }{\left( {V}_{SD6}\left( \mathrm{{sat}}\right) \right) }^{2}}$ and $\frac{{W}_{7}}{{L}_{7}} = \frac{2 \cdot  {I}_{7}}{{K}_{N}^{\prime }{\left( {V}_{DS7}\left( \mathrm{{sat}}\right) \right) }^{2}}$</td><td>${V}_{SD6}\left( \text{sat}\right)  = {V}_{DD} - {V}_{OH}$ ${V}_{DS7}\left( \text{sat}\right)  = {V}_{OL} - {V}_{SS}$</td></tr><tr><td>3</td><td>Guess a value of ${C}_{I}$ and check later</td><td>Typically ${0.1}\mathrm{{pF}} < {C}_{I} < {0.5}\mathrm{{pF}}$</td></tr><tr><td>4</td><td>${I}_{5} = {C}_{I}\frac{d{v}_{o1}}{dt} \approx  \frac{{C}_{I}\left( {{V}_{OH} - {V}_{OL}}\right) }{{t}_{p}}$</td><td>Assume that ${v}_{o1}$ swings between ${V}_{OH}$ and ${V}_{OL}$</td></tr><tr><td>5</td><td>$\frac{{W}_{3}}{{L}_{3}} = \frac{{W}_{4}}{{L}_{4}} = \frac{{I}_{5}}{{K}_{P}^{\prime }{\left( {V}_{SG3} - \left| {V}_{TP}\right| \right) }^{2}}$</td><td>${V}_{SG3} = {V}_{DD} - {V}_{icm}^{ + } + {V}_{TN}$</td></tr><tr><td>6</td><td>${g}_{m1} = \frac{{A}_{v}\left( 0\right) \left( {{g}_{ds2} + {g}_{ds4}}\right) \left( {{g}_{ds6} + {g}_{ds7}}\right) }{{g}_{m6}}$</td><td>${g}_{m6} = \sqrt{\frac{2{K}_{P}^{\prime }{W}_{6}{I}_{6}}{{L}_{6}}}$</td></tr><tr><td/><td>$\frac{{W}_{1}}{{L}_{1}} = \frac{{W}_{2}}{{L}_{2}} = \frac{{g}_{m1}^{2}}{{K}_{N}{I}_{5}}$</td><td>${A}_{v}\left( 0\right)  = \frac{{V}_{OH} - {V}_{OL}}{{V}_{\text{in }}\left( \min \right) }$</td></tr><tr><td>7</td><td>Find ${C}_{I}$ and check assumption</td><td>${\mathrm{{AD}}}_{2} = {W}_{2}\left( {\mathrm{L}1 + \mathrm{L}2 + \mathrm{L}3}\right)$</td></tr><tr><td/><td>${C}_{I} = {C}_{gd2} + {C}_{gd4} + {C}_{gs6} + {C}_{bd2} + {C}_{bd4}$</td><td>${\mathrm{{PD}}}_{2} = 2\left( {{W}_{2} + \mathrm{L}1 + \mathrm{L}2 + \mathrm{L}3}\right)$</td></tr><tr><td/><td>If ${C}_{I}$ is greater than the guess in step 3, increase the</td><td>${\mathrm{{AD}}}_{4} = {W}_{4}\left( {\mathrm{L}1 + \mathrm{L}2 + \mathrm{L}3}\right)$</td></tr><tr><td/><td>value of ${C}_{I}$ and repeat steps 4 through 6</td><td>${\mathrm{{PD}}}_{4} = 2\left( {{W}_{4} + \mathrm{L}1 + \mathrm{L}2 + \mathrm{L}3}\right)$</td></tr><tr><td>8</td><td>${V}_{DS5}\left( \text{sat}\right)  = {V}_{icm}^{ - } - {V}_{GS1} - {V}_{SS},\frac{{W}_{5}}{{L}_{5}} = \frac{2 \cdot  {I}_{5}}{{K}_{N}^{\prime }{\left( {V}_{DS5}\left( \text{sat}\right) \right) }^{2}}$</td><td>If ${V}_{DS5}$ (sat) is less than ${100}\mathrm{{mV}}$ , increase ${W}_{1}/{L}_{1}$</td></tr></table>
## Design of the Two-Stage, Open-Loop Comparator of Fig. 8.2-3 for a Slewing Response
Assume the specifications of Fig. 8.2-3 are given below.
$$
{t}_{p} = {50}\mathrm{\;{ns}}\;{V}_{OH} = 2\mathrm{\;V}\;{V}_{OL} =  - 2\mathrm{\;V}
$$
$$
{\mathrm{V}}_{DD} = {2.5}\mathrm{\;V}\;{V}_{SS} =  - {2.5}\mathrm{\;V}\;{C}_{II} = 5\mathrm{{pF}}
$$
$$
{V}_{\text{in }}\left( \min \right)  = 1\mathrm{{mV}}\;{V}_{icm}^{ + } = 2\mathrm{\;V}\;{V}_{icm}^{ - } =  - {1.25}\mathrm{\;V}
$$
Design a two-stage, open-loop comparator using the circuit of Fig. 8.2-3 to the above specifications and assume all channel lengths are to be ${1\mu }\mathrm{m}$ .
## SOLUTION
Following the procedure outlined in Table 8.2-3, we calculate ${I}_{6}$ and ${I}_{7}$ as
$$
{I}_{6} = {I}_{7} = \frac{5 \times  {10}^{-{12}} \cdot  4}{{50} \times  {10}^{-9}} = {400\mu }\mathrm{A}
$$
Therefore,
$$
\frac{{W}_{6}}{{L}_{6}} = \frac{2 \cdot  {400}}{{\left( {0.5}\right) }^{2} \cdot  {50}} = {64}\;\text{ and }\;\frac{{W}_{7}}{{L}_{7}} = \frac{2 \cdot  {400}}{{\left( {0.5}\right) }^{2} \cdot  {110}} = {29}
$$
Next, we guess ${C}_{I} = {0.2}\mathrm{{pF}}$ . This gives
$$
{I}_{5} = \frac{\left( {{0.2}\mathrm{{pF}}}\right) \left( {4\mathrm{\;V}}\right) }{{50}\mathrm{{ns}}} = {16\mu }\mathrm{A} \rightarrow  {I}_{5} = {20\mu }\mathrm{A}
$$
Step 5 gives ${V}_{SG3}$ as ${1.2}\mathrm{\;V}$ , which results in
$$
\frac{{W}_{3}}{{L}_{3}} = \frac{{W}_{4}}{{L}_{4}} = \frac{20}{{50}{\left( {1.2} - {0.7}\right) }^{2}} = {1.6} \rightarrow  \frac{{W}_{3}}{{L}_{3}} = \frac{{W}_{4}}{{L}_{4}} = 2
$$
The desired gain is found to be 4000 , which gives an input transconductance of
$$
{g}_{m1} = \frac{{4000} \cdot  {0.09} \cdot  {10}}{44.44} = {81\mu }\mathrm{S}
$$
This gives the $W/L$ ratios of M1 and M2 as
$$
\frac{{W}_{3}}{{L}_{3}} = \frac{{W}_{4}}{{L}_{4}} = \frac{{\left( {81}\right) }^{2}}{{110} \cdot  {40}} = {1.49} \rightarrow  \frac{{W}_{1}}{{L}_{1}} = \frac{{W}_{2}}{{L}_{2}} = 2
$$
To check the guess for ${C}_{I}$ we need to calculate it, which is done as
$$
{C}_{I} = {C}_{gd2} + {C}_{gd4} + {C}_{gs6} + {C}_{bd2} + {C}_{bd4} = {0.9}\mathrm{{fF}} + {0.4}\mathrm{{fF}} + {119.5}\mathrm{{fF}} + {20.4}\mathrm{{fF}} + {15.3}\mathrm{{fF}}
$$
= 156.5 fF
---
Example 8.2-7
---
which is less than what was guessed.
Finally, the $W/L$ value of M5 is found by finding ${V}_{GS1}$ as ${1.00}\mathrm{\;V}$ , which gives ${V}_{DS5}\left( \text{sat}\right)  =$ 0.25 V. This gives
$$
\frac{{W}_{5}}{{L}_{5}} = \frac{2 \cdot  {20}}{{\left( {0.25}\right) }^{2} \cdot  {110}} = {5.8} \approx  6
$$
As in the previous example, M5 and M7 cannot be connected gate-gate and source-source and a scheme like Fig. 8.2-8 must be used. The $W$ values are summarized below assuming that all channel lengths are ${1\mu }\mathrm{m}$ .
$$
{W}_{1} = {W}_{2} = {2\mu }\mathrm{m}\;{W}_{3} = {W}_{4} = {4\mu }\mathrm{m}\;{W}_{5} = {6\mu }\mathrm{m}
$$
$$
{W}_{6} = {64\mu }\mathrm{m}\;{W}_{7} = {29\mu }\mathrm{m}
$$
The above examples should help to illustrate the design of a two-stage, open-loop comparator. It is interesting to note there may be little difference in a comparator designed for linear response or for slewing response. This comes about from the fact that what causes the poles to be large is also what causes the slew rate to be fast. For example, large poles require low resistance and small capacitance from a node to ac ground. Low resistances come from larger bias currents. Hence, large bias currents and smaller capacitors lead to improved slew rate. Generally, a fast comparator will also be one that dissipates more power. In the next section, we will examine other forms of the open-loop comparator that offer more trade-offs between speed and power.

### 8.3 Other Open-Loop Comparators
There are many other types of comparators besides the two-stage comparator of the previous section. In fact, most of the op amps of the previous two chapters could be used as comparators. In this section we will examine comparators with push-pull outputs, the folded-cascode comparator, and comparators capable of driving very large capacitive loads.
## Push-Pull Output Comparators
We noted in the two-stage comparator of the previous section that the propagation delay time was due to both the transition of the first-stage output and the second-stage output. If we replace the current-mirror load in the first stage with MOS diodes (gate-drain-connected MOSFETs), then the signal at the output of the first stage will be reduced in magnitude. This type of comparator is called a clamped comparator and is shown in Fig. 8.3-1.

Figure 8.3-1 Clamped push-pull output comparator.
There are several interesting features of Fig. 8.3-1. First, the gain has been reduced because the current-mirror load of the first stage has been replaced by MOS diodes. Second, we note that the output is push-pull. The maximum sinking and sourcing current at the output would be ${I}_{5}$ times any current gain in M3-M8 (M4-M6). The gain equivalent to a two-stage comparator can be achieved by cascoding the output as shown in Fig. 8.3-2. We note that this circuit is simply the op amp of Fig. 6.5-6 using cascode circuits that are not self-biased. The large output resistance leads to a single-pole response. This pole is at lower frequencies than the poles of the two-stage, open-loop comparator and therefore the linear response will be slower with the same amount of overdrive. However, because the comparator is push-pull, it will be able to sink and source large currents into the output capacitance, ${C}_{H}$ . The design procedure used in Example 6.5-2 can be applied to this circuit as well.
The dynamics of Fig. 8.3-2 depend on the output resistance, ${R}_{H}$ . From Example 6.5-2, the output resistance is about ${11}\mathrm{M}\Omega$ . If ${C}_{II}$ is $5\mathrm{{pF}}$ , the dominant pole is $- {18.12}\mathrm{{krad}}/\mathrm{s}$ . For an overdrive factor of 10, Eq. (8.1-7) gives a propagation delay time of ${2.83\mu }\mathrm{s}$ . Compared to the two-stage, open-loop comparator of Example 8.2-6 this is much slower. However, if the comparator is slewing, then the clamped comparator with a cascoded output stage can compete with the two-stage, open-loop comparator.

Figure 8.3-2 Clamped comparator of Fig. 8.3-1 using a cascode output stage.
The folded-cascode op amp of Chapter 6 also makes a satisfactory comparator. Its performance is similar to the comparator of Fig. 8.3-2. The primary difference would be a better input common-mode voltage range because the MOS diodes are not used to load the first stage. From a linear speed viewpoint, the comparators with cascoded output stage are slow. In general, these types of comparators should not be used if the response is to be linear. They do have satisfactory performance as a comparator if the response is slewing.
## Comparators That Can Drive Large Capacitive Loads
If a comparator has a large capacitive load, the chances are that it is slew rate limited. Under these conditions, we will show several methods capable of driving large values of ${C}_{H}$ . The first method is simply to add several push-pull inverters in cascade with the output of a two-stage, open-loop comparator as shown in Fig. 8.3-3.
The inverters, $\mathrm{M}8 - \mathrm{M}9$ and $\mathrm{M}{10} - \mathrm{M}{11}$ , allow ${C}_{II}$ to be large without sacrificing the speed. The principle is well understood in high-speed digital buffers. If a large capacitance was connected to the drains of M6 and M7, the slew rate would be poor because the current sinking and sourcing is not large. The M8-M9 inverter allows the current driving capability to be increased without sacrificing the slew rate. The $W/L$ value of M8 and M9 must be large enough to increase the current sinking and sourcing capability without loading M6 and M7. Similarly, the inverter M10-M11 allows the current sinking and sourcing to be further increased without loading M8-M9. It can be shown that, if the $W/L$ increases by a factor of 2.72, the minimum propagation delay time is achieved. However, this is a very broad optimum so that larger factors like 10 are used to reduce the required number of stages.
The overdrive techniques introduced for low-power op amps in Section 7.4 can be used for comparators to increase the output current sinking and sourcing capability of the comparator. These methods included boosting the tail current (Fig. 7.4-4) and using current mirrors whose output transistor switches from the active to the saturation region when output current is required (Fig. 7.4-6). Another circuit that has the ability to sink and source large amounts of current is called the self-biased differential amplifier [2] and is shown in Fig. 8.3-4. This amplifier consists of two differential amplifiers each serving as the load for the other as illustrated in Fig. 8.3-4(a). The tail currents of the differential amplifiers become adaptive by connecting the gates of M5 and M6 to the drains of M1 and M3 as shown in

Figure 8.3-3 Increasing the capacitive drive of a two-stage, open-loop comparator.

Figure 8.3-4 (a) Two differential amplifiers loading each other. (b) Evolution of (a) into the self-biased differential amplifier.
Fig. 8.3-4(b). When the positive input voltage, ${v}_{\text{in }}^{ + }$ , is increased, the drains of M1 and M3 fall and turn on M6 to a large current, which is sourced to the output capacitance connected to the drains of M2 and M4 through M4. During this condition, the current in M5 is zero. When ${v}_{\text{in }}^{ + }$ is decreased, M5 turns on and a large current is sunk through the output capacitance via M2. Thus, this circuit has the ability to source and sink large currents without a large quiescent current. A disadvantage of the circuit is that the delay time from ${v}_{\text{in }}^{ + }$ to the output is slower than from ${v}_{\text{in }}^{ - }$ to the output.

### 8.4 Improving the Performance of Open-Loop Comparators
There are two areas in which the performance of an open-loop, high-gain comparator can be improved with little extra effort. These areas are the input-offset voltage and a single transition of the comparator in a noisy environment. The first problem can be solved by autozero-ing and the second can be solved by the introduction of hysteresis using a bistable circuit. These two techniques will be examined in the following.
## Autozeroing Techniques
Input-offset voltage can be a particularly difficult problem in comparator design. In precision applications, such as high-resolution A/D converters, large input-offset voltages cannot be tolerated. While systematic offset can nearly be eliminated with proper design (though still affected by process variations), random offsets still remain and are unpredictable. Fortunately, there are techniques in MOS technology to remove a large portion of the input offset using offset-cancellation techniques. These techniques are available in MOS because of the nearly infinite input resistance of MOS transistors. This characteristic allows long-term storage of voltages on the transistor's gate. As a result, offset voltages can be measured, stored on capacitors, and summed with the input so as to cancel the offset.

Figure 8.4-1 (a) Simple model of a comparator including offset. (b) Comparator in unity-gain configuration storing the offset on autozero capacitor ${C}_{AZ}$ during the first half of the autozero cycle. (c) Comparator in open-loop configuration with offset cancellation achieved at the noninverting input during the second half of the autozero cycle.
Figure 8.4-1 shows symbolically an offset-cancellation algorithm. A model of a comparator with an input-offset voltage is shown in Fig. 8.4-1(a). A known polarity is given to the offset voltage for convenience. Neither the value nor the polarity can be predicted in reality. Figure 8.4-1(b) shows the comparator connected in the unity-gain configuration so that the input offset is available at the output. In order for this circuit to work properly, it is necessary that the comparator be stable in the unity-gain configuration. This implies that only self-compensated high-gain amplifiers would be suitable for autozeroing. One could use the two-stage, open-loop comparator but a compensation circuit should be switched into the circuit during autozeroing. In the final operation of the autozero algorithm ${C}_{AZ}$ is placed at the input of the comparator in series with ${V}_{OS}$ . The voltage across ${C}_{AZ}$ adds to ${V}_{OS}$ , resulting in zero volts at the noninverting input of the comparator. Since there is no dc path to discharge the autozero capacitor, the voltage across it remains indefinitely (in the ideal case). In reality, there are leakage paths in shunt with ${C}_{AZ}$ that can discharge it over a period of time. The solution to this problem is to repeat the autozero cycle periodically.
A practical implementation of a differential-input, autozeroed comparator is shown in Fig. 8.4-2(a). The comparator is modeled with an offset-voltage source as before. Figure 8.4-2(b) shows the state of the circuit during the first phase of the cycle when ${\phi }_{1}$ is high. The offset is stored across ${C}_{AZ}$ . Figure 8.4-2(c) shows the circuit in the second phase of the autozero cycle when ${\phi }_{2}$ is high. The offset is canceled by the addition of ${V}_{OS}$ on ${C}_{AZ}$ . It is during this portion of the cycle that the circuit functions as a comparator.

Figure 8.4-2 (a) Differential circuit implementation of an autozeroed comparator. (b) Comparator during ${\phi }_{1}$ phase. (c) Comparator during ${\phi }_{2}$ phase.

Figure 8.4-3 Noninverting autozeroed comparator.
There are other ways to implement an autozeroed comparator other than the one just described. A slight variation of Fig. 8.4-2(a) is shown in Fig. 8.4-3. This is a noninverting version of the previous autozeroed comparator. Yet another version is shown in Fig. 8.4-4. This one is simpler in operation since the noninverting input is always connected to ground.
The switch implementations of the autozeroed comparator can be single-channel MOSFETs or complementary MOSFETs. It is important to use nonoverlapping clocks to drive the switches so that any given switch turns off before another turns on. Autozeroing techniques can be very effective in removing a large amount of a comparator's input offset, but the offset cancellation is not perfect. Charge injection resulting from clock feedthrough (Section 4.1) can by itself introduce an offset. This too can be canceled, but it is usually the cause of the lower limit of the offset voltage being greater than zero.
## Comparator Using Hysteresis
Often a comparator is placed in a very noisy environment in which it must detect signal transitions at the threshold point. If the comparator is fast enough (depending on the frequency of the most prevalent noise) and the amplitude of the noise is great enough, the output will also be noisy. In this situation, a modification on the transfer characteristic of the comparator is desired. Specifically, hysteresis is needed in the comparator.
Hysteresis is the quality of the comparator in which the input threshold changes as a function of the input (or output) level. In particular, when the input passes the threshold, the output changes and the input threshold is subsequently reduced so that the input must return beyond the previous threshold before the comparator's output changes state again. This can be illustrated much more clearly with the diagram shown in Fig. 8.4-5. Note that as the input starts negative and goes positive, the output does not change until it reaches the positive trip point, ${V}_{TRP}^{ + }$ . Once the output goes high, the effective trip point is changed. When the input returns in the negative direction, the output does not switch until it reaches the negative trip point, ${V}_{TRP}^{ - }$ .
The advantage of hysteresis in a noisy environment can clearly be seen from the illustration given in Fig. 8.4-6. In this figure, a noisy signal is shown as the input to a comparator without hysteresis. The intent is to have the comparator output follow the low-frequency signal. Because of noise variations near the threshold points, the comparator output is too noisy. The response of the comparator can be improved by adding hysteresis equal to or greater than the amount of the largest expected noise amplitude. The response of such a comparator is shown in Fig. 8.4-6(b).

Figure 8.4-4 Inverting autozeroed comparator.

Figure 8.4-5 Comparator transfer curve with hysteresis.
The voltage-transfer function shown in Fig. 8.4-5 is called a bistable characteristic. A bistable circuit can be clockwise or counterclockwise. Figure 8.4-5 is an example of a counterclockwise bistable characteristic. Sometimes, the counterclockwise bistable circuit is called noninverting and the clockwise bistable is called inverting. The bistable characteristic is defined by its width and height and whether it is clockwise or counterclockwise. The width is given by the difference between ${V}_{TRP}^{ + }$ and ${V}_{TRP}^{ - }$ . The height is generally the difference between ${V}_{OH}$ and ${V}_{OL}$ . In addition, the bistable characteristic can be shifted horizontally to the left or right by addition of a dc offset voltage.
There are many ways to introduce hysteresis in a comparator. All of them use some form of positive feedback. The methods can be categorized into external methods and internal methods. External hysteresis uses external positive feedback to implement hysteresis and can be accomplished after the comparator is built. Internal hysteresis is implemented into the comparator and does not require external feedback. We shall examine these two methods in the following.
Figure 8.4-7 shows a noninverting bistable circuit using external positive feedback to accomplish the hysteresis. This bistable characteristic is counterclockwise. We assume that the maximum and minimum output voltages of the comparator are ${V}_{OH}$ and ${V}_{OL}$ , respectively. The trip points are found as follows. Assume that ${v}_{\mathrm{{IN}}}$ is much less than the voltage at the positive input to the comparator. In this case, the output voltage will be at ${V}_{OL}$ . As ${v}_{\mathrm{{IN}}}$ is increased, the upper trip point, ${V}_{TRP}^{ + }$ , is found by setting the voltage due to ${v}_{\mathrm{{IN}}}$ and ${V}_{OL}$ at the positive input to the comparator equal to zero. This results in
$$
0 = \left( \frac{{R}_{1}}{{R}_{1} + {R}_{2}}\right) {V}_{OL} + \left( \frac{{R}_{2}}{{R}_{1} + {R}_{2}}\right) {V}_{TRP}^{ + } \tag{8.4-1}
$$

Figure 8.4-6 (a) Comparator response to a noisy input. (b) Comparator response to a noisy input when hysteresis is added.

Figure 8.4-7 Noninverting bistable circuit using external positive feedback.
Solving for the upper trip point gives
$$
{V}_{TRP}^{ + } =  - \frac{{R}_{1}{V}_{OL}}{{R}_{2}} \tag{8.4-2}
$$
Generally, ${V}_{OL}$ is negative so that the upper trip point is a positive voltage.
The lower trip point, ${V}_{TRP}^{ - }$ , can be found by assuming that ${v}_{\mathrm{{IN}}}$ is much greater than the voltage at the positive input to the comparator so that the output state, which is ${V}_{OH}$ , is known. As ${v}_{\mathrm{{IN}}}$ is decreased, ${V}_{TRP}^{ - }$ occurs when the voltage at the positive input to the comparator is equal to zero. Therefore,
$$
0 = \left( \frac{{R}_{1}}{{R}_{1} + {R}_{2}}\right) {V}_{OH} + \left( \frac{{R}_{2}}{{R}_{1} + {R}_{2}}\right) {V}_{TRP}^{ - } \tag{8.4-3}
$$
which gives
$$
{V}_{TRP}^{ - } =  - \frac{{R}_{1}{V}_{OH}}{{R}_{2}} \tag{8.4-4}
$$
The width of the bistable characteristic is given as
$$
\Delta {V}_{\text{in }} = {V}_{TPR}^{ + } - {V}_{TRP}^{ - } = \left( \frac{{R}_{1}}{{R}_{2}}\right) \left( {{V}_{OH} - {V}_{OL}}\right)  \tag{8.4-5}
$$
The counterclockwise bistable circuit resulting from this analysis is shown in Fig. 8.4-7.
Figure 8.4-8 shows the clockwise bistable circuit using external positive feedback. Assuming that the input is much less than the voltage at the positive input of the comparator allows us to define the output state at ${V}_{OH}$ . The upper trip point can be found by setting the input equal to the voltage at the positive input of the comparator. The result is
$$
{v}_{\mathrm{{IN}}} = {V}_{TRP}^{ + } = \left( \frac{{R}_{1}}{{R}_{1} + {R}_{2}}\right) {V}_{OH} \tag{8.4-6}
$$

Figure 8.4-8 Inverting bistable circuit using external positive feedback.
Next, assuming that the input is much greater than the voltage at the positive input of the comparator defines the output voltage as ${V}_{OL}$ . The lower trip point can be found by setting the input equal to the voltage at the positive input of the comparator. Therefore,
$$
{v}_{\mathrm{{IN}}} = {V}_{TRP}^{ - } = \left( \frac{{R}_{1}}{{R}_{1} + {R}_{2}}\right) {V}_{OL} \tag{8.4-7}
$$
The width of the bistable characteristic is given as
$$
\Delta {V}_{\text{in }} = {V}_{TPR}^{ + } - {V}_{TRP}^{ - } = \left( \frac{{R}_{1}}{{R}_{1} + {R}_{2}}\right) \left( {{V}_{OH} - {V}_{OL}}\right)  \tag{8.4-8}
$$
The clockwise bistable circuit resulting from this analysis is shown in Fig. 8.4-8.
The center point of the bistable characteristics of Figs. 8.4-7 and 8.4-8 can be shifted horizontally by inserting a battery, ${V}_{REF}$ , as shown in Fig. 8.4-9 for the counterclockwise bistable circuit. If we solve for the trip points of the counterclockwise bistable circuit in Fig. 8.4-9 we get
$$
{V}_{\mathrm{{REF}}} = \left( \frac{{R}_{1}}{{R}_{1} + {R}_{2}}\right) {V}_{OL} + \left( \frac{{R}_{2}}{{R}_{1} + {R}_{2}}\right) {V}_{TRP}^{ + } \tag{8.4-9}
$$
$$
{V}_{TRP}^{ + } = \left( \frac{{R}_{1} + {R}_{2}}{{R}_{2}}\right) {V}_{\mathrm{{REF}}} - \frac{{R}_{1}}{{R}_{2}}{V}_{OL} \tag{8.4-10}
$$

Figure 8.4-9 Horizontally shifted noninverting bistable circuit using external positive feedback.
and
$$
{V}_{\mathrm{{REF}}} = \left( \frac{{R}_{1}}{{R}_{1} + {R}_{2}}\right) {V}_{OH} + \left( \frac{{R}_{2}}{{R}_{1} + {R}_{2}}\right) {V}_{TRP}^{ - } \tag{8.4-11}
$$
or
$$
{V}_{TRP}^{ - } = \left( \frac{{R}_{1} + {R}_{2}}{{R}_{2}}\right) {V}_{\mathrm{{REF}}} - \frac{{R}_{1}}{{R}_{2}}{V}_{OH} \tag{8.4-12}
$$
The width of the bistable characteristic has not changed but is now centered at $\left( {{R}_{1} + {R}_{2}}\right) /{R}_{2}$ times ${V}_{\text{REF }}$ .
Figure 8.4-10 shows how the bistable characteristic for the inverting or clockwise bistable circuit can be shifted horizontally by inserting a voltage, ${V}_{\mathrm{{REF}}}$ , in series with ${R}_{1}$ . Setting the input voltage equal to the voltage at the positive input terminal to the comparator gives the upper trip point as
$$
{v}_{\mathrm{{IN}}} = {V}_{TRP}^{ + } = \left( \frac{{R}_{1}}{{R}_{1} + {R}_{2}}\right) {V}_{OH} + \left( \frac{{R}_{2}}{{R}_{1} + {R}_{2}}\right) {V}_{\mathrm{{REF}}} \tag{8.4-13}
$$
The lower trip point can be found by setting the input equal to the voltage at the positive input of the comparator. Therefore,
$$
{v}_{\mathrm{{IN}}} = {V}_{TRP}^{ - } = \left( \frac{{R}_{1}}{{R}_{1} + {R}_{2}}\right) {V}_{OL} + \left( \frac{{R}_{2}}{{R}_{1} + {R}_{2}}\right) {V}_{\mathrm{{REF}}} \tag{8.4-14}
$$
The width of the bistable characteristic has not changed but is now centered at ${R}_{2}/\left( {{R}_{1} + {R}_{2}}\right)$ times ${V}_{\text{REF }}$ .

Figure 8.4-10 Horizontally shifted inverting bistable circuit using external positive feedback.
## Example 8.4-1 Design of an Inverting Comparator with Hysteresis
Use the circuit of Fig. 8.4-10 to design a high-gain, open-loop comparator having an upper trip point of $1\mathrm{\;V}$ and a lower trip point of $0\mathrm{\;V}$ if ${V}_{OH} = 2\mathrm{\;V}$ and ${V}_{OL} =  - 2\mathrm{\;V}$ .
## SOLUTION
Putting the values of this example into Eqs. (8.4-13) and (8.4-14) gives
$$
1 = \left( \frac{{R}_{1}}{{R}_{1} + {R}_{2}}\right) 2 + \left( \frac{{R}_{2}}{{R}_{1} + {R}_{2}}\right) {V}_{\mathrm{{REF}}}
$$
and
$$
0 = \left( \frac{{R}_{1}}{{R}_{1} + {R}_{2}}\right) \left( {-2}\right)  + \left( \frac{{R}_{2}}{{R}_{1} + {R}_{2}}\right) {V}_{\mathrm{{REF}}}
$$
Solving these two equations gives $3{R}_{1} = {R}_{2}$ and ${\mathrm{V}}_{\mathrm{{REF}}} = {0.667}\mathrm{\;V}$ .
The previous circuits are examples of using external positive feedback to implement hysteresis in a high-gain, open-loop comparator. The hysteresis can also be accomplished by using internal positive feedback. Figure 8.4-11 shows the differential-input stage of a comparator such as Fig. 8.3-1 or 8.3-2 [1]. In this circuit there are two paths of feedback. The first is current-series [3,4] feedback through the common-source node of transistors M1 and M2. This feedback path is negative. The second path is the voltage-shunt feedback through the gate-drain connections of transistors M6 and M7. This path of feedback is positive. If the positive-feedback factor is less than the negative-feedback factor, then the overall feedback will be negative and no hysteresis will result. If the positive-feedback factor becomes greater, the overall feedback will be positive, which will give rise to hysteresis in the voltage-transfer curve. As long as the ratio ${\beta }_{6}/{\beta }_{3}$ is less than one, there is no hysteresis in the transfer function. When this ratio is greater than one, hysteresis will result. The following analysis will develop the equations for the trip points when there is hysteresis.

Figure 8.4-11 Implementation of hysteresis using internal positive feedback in the input stage of a high-gain, open-loop comparator.
---
Example 8.4-1
---
Assume that plus and minus supplies are used and that the gate of M1 is tied to ground. With the input of M2 much less than zero, M1 is on and M2 off, thus turning on M3 and M6 and turning off M4 and M7. All of ${i}_{5}$ flows through M1 and M3, so ${v}_{o2}$ is high. The resulting circuit is shown in Fig. 8.4-12(a). Note that M2 is shown even though it is off. At this point, M6 is attempting to source the following amount of current:
$$
{i}_{6} = \frac{{\left( W/L\right) }_{6}}{{\left( W/L\right) }_{3}}{i}_{5} \tag{8.4-15}
$$
As ${v}_{\text{in }}$ increases toward the threshold point (which is not yet known), some of the tail current ${i}_{5}$ begins to flow through M2. This continues until the point where the current through M2 equals the current in M6. Just beyond this point the comparator switches state. To approximately calculate one of the trip points, the circuit must be analyzed right at the point where ${i}_{2}$ equals ${i}_{6}$ . Mathematically this is
$$
{i}_{6} = \frac{{\left( W/L\right) }_{6}}{{\left( W/L\right) }_{3}}{i}_{3} \tag{8.4-16}
$$
$$
{i}_{2} = {i}_{6} \tag{8.4-17}
$$
$$
{i}_{5} = {i}_{2} + {i}_{1}\;\left( {{i}_{1} = {i}_{3}}\right)  \tag{8.4-18}
$$
Therefore,
$$
{i}_{3} = \frac{{i}_{5}}{1 + \left\lbrack  {{\left( W/L\right) }_{6}/{\left( W/L\right) }_{3}}\right\rbrack  } = {i}_{1} \tag{8.4-19}
$$
$$
{i}_{2} = {i}_{5} - {i}_{1} \tag{8.4-20}
$$

Figure 8.4-12 (a) Comparator of Fig. 8.4-11 where ${v}_{\text{in }}$ is very negative and increasing toward ${V}_{TRP}^{ + }$ (b) Comparator of Fig. 8.4-11 where ${v}_{\text{in }}$ is very positive and decreasing toward ${V}_{TRP}^{ - }$ .
Knowing the currents in both M1 and M2, it is easy to calculate their respective ${v}_{GS}$ voltages. Since the gate of $\mathrm{M}1$ is at ground, the difference in their gate-source voltages will yield the positive trip point as given below:
$$
{v}_{GS1} = {\left( \frac{2{i}_{1}}{{\beta }_{1}}\right) }^{1/2} + {V}_{T1} \tag{8.4-21}
$$
$$
{v}_{GS2} = {\left( \frac{2{i}_{2}}{{\beta }_{2}}\right) }^{1/2} + {V}_{T2} \tag{8.4-22}
$$
$$
{V}_{TRP}^{ + } = {v}_{GS2} - {v}_{GS1} \tag{8.4-23}
$$
Once the threshold is reached, the comparator changes state so that the majority of the tail current now flows through M2 and M4. As a result, M7 is also turned on, thus turning off M3, M6, and M1. As in the previous case, as the input decreases the circuit reaches a point at which the current in M1 increases until it equals the current in M7. The input voltage at this point is the negative trip point ${V}_{TRP}^{ - }$ . The equivalent circuit in this state is shown in Fig. 8.4-12(b). To calculate the trip point, the following equations apply:
$$
{i}_{7} = \frac{{\left( W/L\right) }_{7}}{{\left( W/L\right) }_{4}}{i}_{4} \tag{8.4-24}
$$
$$
{i}_{1} = {i}_{7} \tag{8.4-25}
$$
$$
{i}_{5} = {i}_{2} + {i}_{1} \tag{8.4-26}
$$
Therefore,
$$
{i}_{4} = \frac{{i}_{5}}{1 + \left\lbrack  {{\left( W/L\right) }_{7}/{\left( W/L\right) }_{4}}\right\rbrack  } = {i}_{2} \tag{8.4-27}
$$
$$
{i}_{1} = {i}_{5} - {i}_{2} \tag{8.4-28}
$$
Using Eqs. (8.4-21) and (8.4-22) to calculate ${v}_{GS}$ , the trip point is
$$
{V}_{TRP}^{ - } = {v}_{GS2} - {v}_{GS1} \tag{8.4-29}
$$
These equations do not take into account the effect of channel length modulation. Their use is illustrated in the following example. Example
## Calculation of Trip Voltages for a Comparator with Hysteresis
8.4-2 Consider the circuit shown in Fig. 8.4-11. Using the transistor device parameters given in Table 3.1-2 calculate the positive and negative threshold points if the device lengths are all ${1\mu }\mathrm{m}$ and the widths are given as ${W}_{1} = {W}_{2} = {W}_{10} = {W}_{11} = {10\mu }\mathrm{m}$ and ${W}_{3} = {W}_{4} = {2\mu }\mathrm{m}$ .
The gate of M1 is tied to ground and the input is applied to the gate of M2. The current ${i}_{5} =$ ${20\mu }\mathrm{A}$ . Simulate the results using simulation.
## SOLUTION
To calculate the positive trip point, assume that the input has been negative and is heading positive.
$$
{i}_{6} = \frac{{\left( W/L\right) }_{6}}{{\left( W/L\right) }_{3}}{i}_{3} = \left( {5/1}\right) \left( {i}_{3}\right)
$$
$$
{i}_{3} = \frac{{i}_{5}}{1 + \left\lbrack  {{\left( W/L\right) }_{6}/{\left( W/L\right) }_{3}}\right\rbrack  } = {i}_{1} = \frac{{20\mu }\mathrm{A}}{1 + 5} = {3.33\mu }\mathrm{A}
$$
$$
{i}_{2} = {i}_{5} - {i}_{1} = {20} - {3.33} = {16.67\mu }\mathrm{A}
$$
$$
{v}_{GS1} = {\left( \frac{2{i}_{1}}{{\beta }_{1}}\right) }^{1/2} + {V}_{T1} = {\left( \frac{2 \cdot  {3.33}}{\left( 5\right) {110}}\right) }^{1/2} + {0.7} = {0.81}\mathrm{\;V}
$$
$$
{v}_{GS2} = {\left( \frac{2{i}_{2}}{{\beta }_{2}}\right) }^{1/2} + {V}_{T2} = {\left( \frac{2 \cdot  {16.67}}{\left( 5\right) {110}}\right) }^{1/2} + {0.7} = {0.946}\mathrm{\;V}
$$
$$
{V}_{TRP}^{ + } \cong  {v}_{GS2} - {v}_{GS1} = {0.946} - {0.810} = {0.136}\mathrm{\;V}
$$
Determining the negative trip point, similar analysis yields
$$
{i}_{4} = {3.33\mu }\mathrm{A}
$$
$$
{i}_{1} = {16.67\mu }\mathrm{A}
$$
$$
{v}_{GS2} = {0.81}\mathrm{\;V}
$$
$$
{v}_{GS1} = {0.946}\mathrm{\;V}
$$
$$
{V}_{TRP}^{ - } \cong  {v}_{GS2} - {v}_{GS1} = {0.81} - {0.946} =  - {0.136}\mathrm{\;V}
$$
PSPICE simulation results of this circuit are shown in Fig. 8.4-13.

Figure 8.4-13 Simulation of the comparator of Example 8.4-2.

Figure 8.4-14 Complete comparator with internal hysteresis including an output stage.
The differential stage described thus far is generally not useful alone and thus requires an output stage to achieve reasonable voltage swings and output resistance. There are a number of ways to implement an output stage for this type of input stage. One of these is given in Fig. 8.4-14. Differential-to-single-ended conversion is accomplished at the output and thus provides a Class AB type of driving capability.

### 8.5 Discrete-Time Comparators
In many applications the comparator only functions over a portion of a time period. Such circuits are driven by a clock and will have a portion of time or phase when the comparator is functioning as a comparator and a phase when the comparator is not being used. In this circumstance, other forms of comparators can be used that are efficient and have a small propagation delay time. We will examine two such comparators in this section. They are the switched capacitor comparator and the regenerative comparator.
## Switched Capacitor Comparators
The switched capacitor comparator uses a combination of switched capacitors and open-loop comparators. The advantages of the switched capacitor comparator are that differential signals can be compared using single-ended circuits and the switched capacitor comparator naturally lends itself to autozeroing the dc offset voltage of the open-loop comparator. Figure 8.5-1(a) shows a typical switched capacitor comparator. The voltages applied to the circuit are normally sampled and held so that capital variables are used.
When the ${\phi }_{1}$ switches are closed in Fig. 8.5-1, the capacitor $C$ autozeros the offset voltage of the comparator, ${V}_{OS}$ . The capacitor ${C}_{p}$ represents the parasitic capacitance from the input of the comparator to ground. We recall that the comparator must be stable in unity-gain operation for this circuit to work properly. It can be shown that the voltage across ${C}_{1}$ and ${C}_{p}$ at the end of the ${\phi }_{1}$ phase period is
$$
{V}_{C}\left( {\phi }_{1}\right)  = {V}_{1} - {V}_{OS} \tag{8.5-1}
$$

Figure 8.5-1 (a) A switched capacitor comparator. (b) Equivalent circuit of (a) when the ${\phi }_{2}$ switches are closed.
and
$$
{V}_{{C}_{p}}\left( {\phi }_{1}\right)  = {V}_{OS} \tag{8.5-2}
$$
Now when the ${\phi }_{2}$ switch is closed, the equivalent circuit at the beginning of the ${\phi }_{2}$ phase period is shown in Fig. 8.5-1(b). In this circuit, the voltage across each capacitor has been removed and represented by a step voltage source. This allows us to use the principle of superposition to easily solve for the output as illustrated below.
$$
{V}_{\text{out }}\left( {\phi }_{2}\right)  =  - A\left\lbrack  {\frac{{V}_{2}C}{C + {C}_{p}} - \frac{\left( {{V}_{1} - {V}_{OS}}\right) C}{C + {C}_{p}} + \frac{{V}_{OS}{C}_{p}}{C + {C}_{p}}}\right\rbrack   + A{V}_{OS} \tag{8.5-3}
$$
$$
=  - A\left\lbrack  {\left( {{V}_{2} - {V}_{1}}\right) \frac{C}{C + {C}_{p}} - {V}_{OS}\left( {\frac{C}{C + {C}_{p}} + \frac{{C}_{p}}{C + {C}_{p}}}\right) }\right\rbrack   + A{V}_{OS} =  - A\left( {{V}_{2} - {V}_{1}}\right) \frac{C}{C + {C}_{p}}
$$
If ${C}_{p}$ is smaller than $C$ , then Eq. (8.5-3) can be simplifed to
$$
{V}_{\text{out }}\left( {\phi }_{2}\right)  \approx  A\left( {{V}_{1} - {V}_{2}}\right)  \tag{8.5-4}
$$
Therefore, the difference between the voltages ${V}_{1}$ and ${V}_{2}$ is amplified by the gain of the comparator.
The gain of the comparator used for the switched capacitor comparator must be large enough to satisfy the resolution requirements. In many cases, the resolution is large (i.e., ${100}\mathrm{{mV}}$ ), so that a very simple single-stage amplifier is sufficient for the comparator. The speed of the comparator depends on how long it takes the circuit to settle to its steady stage after the switches have been closed for a given period. During the ${\phi }_{1}$ phase, the response of the circuit in Fig. 8.5-1(a) is very fast. The time constants of the circuit are associated with the product of the switch on-resistances and the capacitor $C$ and the dynamics of the comparator in unity-gain configuration. Both of these time constants can be small. During ${\phi }_{2}$ , the open-loop response of the comparator will determine the speed. This subject has been covered in detail in Section 8.1 for a single-pole approximation and in Section 8.2 for a multiple-pole approximation of the comparator.

Figure 8.5-2 A differential-in, differential-out, switched capacitor comparator.
A differential switched capacitor comparator is shown in Fig. 8.5-2. The input is sampled on the two identical capacitors, $C$ , during the ${\phi }_{1}$ phase period. The dc offsets of the differential-in, differential-out comparator are also autozeroed during this period. During the ${\phi }_{2}$ phase period, the voltages sampled across the capacitors are applied to the comparator input. As the ${\phi }_{1}$ switches open at the end of the ${\phi }_{1}$ phase period, the charge injection will be reduced because the signal is a differential voltage and the charge injection is a common-mode voltage.
## Regenerative Comparators
Regenerative comparators use positive feedback to accomplish the comparison of two signals. The regenerative comparator is also called a latch or a bistable [5]. The simplest form of a latch is shown in Fig. 8.5-3 and consists of two cross-coupled MOSFETs. Figure 8.5-3(a) uses NMOS transistors while Fig. 8.5-3(b) is a PMOS latch. The current sources/sinks are used to identify the dc currents in the transistors. Normally, the latch has two modes of operation. The first mode disables the positive feedback and applies the input signal to the terminals designated as ${v}_{o1}$ and ${v}_{o2}$ . The initial voltages applied during this mode will be designated as ${v}_{o1}^{\prime }$ and ${v}_{o2}^{\prime }$ . The second mode enables the latch and depending on the relative values of ${v}_{o1}^{\prime }$ and ${v}_{o2}^{\prime }$ , one of the outputs will go high and the other will go low. A two-phase clock is used to determine the modes of operation.
It is important to characterize the time it takes for the latch to go from its initial state to the final state during the enabled mode of operation. Figure 8.5-4(a) is a redrawing of the latch in Fig. 8.5-3(a). Let us assume that the initial values of ${v}_{o1}$ and ${v}_{o2}$ have been established and find the time it takes for the latch to operate. We will use the model of Fig. 8.5-4(b) to analyze the latch of Fig. 8.5-4(a). The voltage sources in series with the capacitances represent the initial values of ${v}_{o1}$ and ${v}_{o2}$ and are step functions.

Figure 8.5-3 (a) NMOS latch. (b) PMOS latch.

Figure 8.5-4 (a) Redrawing of Fig. 8.5-3(a). (b) Equivalent model of (a).
We may write the nodal equations of Fig. 8.5-4(b) as
$$
{g}_{m1}{V}_{o2} + {G}_{1}{V}_{o1} + s{C}_{1}\left( {{V}_{o1} - \frac{{V}_{o1}^{\prime }}{s}}\right)  = {g}_{m1}{V}_{o2} + {G}_{1}{V}_{o1} + s{C}_{1}{V}_{o1} - {C}_{1}{V}_{o1}^{\prime } = 0 \tag{8.5-5}
$$
and
$$
{g}_{m2}{V}_{o1} + {G}_{2}{V}_{o2} + s{C}_{2}\left( {{V}_{o2} - \frac{{V}_{o2}^{\prime }}{s}}\right)  = {g}_{m2}{V}_{o1} + {G}_{2}{V}_{o2} + s{C}_{2}{V}_{o2} - {C}_{2}{V}_{o2}^{\prime } = 0 \tag{8.5-6}
$$
where ${G}_{1}$ and ${G}_{2}$ are the conductances seen from the drains of M1 and M2 to ground and ${C}_{1}$ and ${C}_{2}$ are the capacitances seen from the drains of M1 and M2 to ground. Solving Eqs. (8.5- 5) and (8.5-6) for ${V}_{o1}$ and ${V}_{o2}$ gives
$$
{V}_{o1} = \frac{{R}_{1}{C}_{1}}{s{R}_{1}{C}_{1} + 1}{V}_{o1}^{\prime } - \frac{{g}_{m1}{R}_{1}}{s{R}_{1}{C}_{1} + 1}{V}_{o2} = \frac{{\tau }_{1}}{s{\tau }_{1} + 1}{V}_{o1}^{\prime } - \frac{{g}_{m1}{R}_{1}}{s{\tau }_{1} + 1}{V}_{o2} \tag{8.5-7}
$$
and
$$
{V}_{o2} = \frac{{R}_{2}{C}_{2}}{s{R}_{2}{C}_{2} + 1}{V}_{o2}^{\prime } - \frac{{g}_{m2}{R}_{2}}{s{R}_{2}{C}_{2} + 1}{V}_{o1} = \frac{{\tau }_{2}}{s{\tau }_{2} + 1}{V}_{o2}^{\prime } - \frac{{g}_{m2}{R}_{2}}{s{\tau }_{2} + 1}{V}_{o1} \tag{8.5-8}
$$
where ${\tau }_{i}$ is the time constant ${R}_{i}{C}_{i}$ . Assume that both transistors are identical so that ${g}_{m1} =$ ${g}_{m2} = {g}_{m},{R}_{1} = {R}_{2} = R$ , and $C = {C}_{1} = {C}_{2}$ , which gives ${\tau }_{1} = {\tau }_{2} = \tau$ . Let us define the difference between ${V}_{o2}$ and ${V}_{o1}$ as $\Delta {V}_{o}$ and the difference between ${V}_{o2}^{\prime }$ and ${V}_{o1}^{\prime }$ as $\Delta {V}_{i}$ . Therefore,
$$
\Delta {V}_{o} = {V}_{o2} - {V}_{o1} = \frac{\tau }{{s\tau } + 1}\Delta {V}_{i} + \frac{{g}_{m}R}{{s\tau } + 1}\Delta {V}_{o} \tag{8.5-9}
$$
Solving for $\Delta {V}_{o}$ gives
$$
\Delta {V}_{o} = \frac{{\tau \Delta }{V}_{i}}{{s\tau } + \left( {1 - {g}_{m}R}\right) } = \frac{\frac{{\tau \Delta }{V}_{i}}{1 - {g}_{m}R}}{\frac{s\tau }{1 - {g}_{m}R} + 1} = \frac{{\tau }^{\prime }\Delta {V}_{i}}{s{\tau }^{\prime } + 1} \tag{8.5-10}
$$
where
$$
{\tau }^{\prime } = \frac{\tau }{1 - {g}_{m}R} \tag{8.5-11}
$$
Taking the inverse Laplace transform of Eq. (8.5-10) gives
$$
\Delta {v}_{o}\left( t\right)  = \Delta {V}_{i}^{\prime }{e}^{-t/{\tau }^{\prime }} = \Delta {V}_{i}{e}^{-t\left( {1 - {g}_{m}R}\right) /\tau } \approx  {e}^{{g}_{m}{Rt}/\tau }\Delta {V}_{i} \tag{8.5-12}
$$
if ${g}_{m}R$ is greater than one. The time constant of the latch as expressed in Eq. (8.5-12) is given as
$$
{\tau }_{L} \approx  \frac{\tau }{{g}_{m}R} = \frac{C}{{g}_{m}} \tag{8.5-13}
$$
If $C$ is mostly the gate-source capacitance, then the latch time constant can be expressed as
$$
{\tau }_{L} = \frac{{0.67WL}{C}_{\mathrm{{ox}}}}{\sqrt{2{K}^{\prime }\left( {W/L}\right) I}} = {0.67}{C}_{\mathrm{{ox}}}\sqrt{\frac{W{L}^{3}}{2{K}^{\prime }I}} \tag{8.5-14}
$$
Equation (8.5-14) shows the strong dependence of the latch time constant on the channel length. Therefore, the latch time response can be expressed as
$$
\Delta {V}_{\text{out }}\left( t\right)  = {e}^{t/{\tau }_{L}}\Delta {V}_{i} \tag{8.5-15}
$$
Equation (8.5-15) gives the difference between the latch output voltages, $\Delta {V}_{\text{out }}$ , at a time $t$ after enabling the latch. The voltage $\Delta {V}_{i}$ is the difference between the latch output voltages, ${V}_{o2}$ and ${V}_{o1}$ , before the latch is enabled.
Figure 8.5-5 shows the time-domain response of the latch for various values of $\Delta {V}_{i}$ . This figure has been normalized by dividing Eq. (8.5-15) by ${V}_{OH} - {V}_{OL}$ to get
$$
\frac{\Delta {V}_{\text{out }}\left( t\right) }{{V}_{OH} - {V}_{OL}} = {e}^{t/{\tau }_{L}}\frac{\Delta {V}_{i}}{{V}_{OH} - {V}_{OL}} \tag{8.5-16}
$$
It is important to remember that $\Delta {V}_{i}$ will always be less than ${V}_{OH} - {V}_{OL}$ . The propagation time delay of a latch can be found by setting Eq. (8.5-16) equal to 0.5 . The result is
$$
{t}_{p} = {\tau }_{L}\ln \left( \frac{{V}_{OH} - {V}_{OL}}{{2\Delta }{V}_{i}}\right)  \tag{8.5-17}
$$
Since $\Delta {V}_{i}$ is always less than ${0.5}\left( {{V}_{OH} - {V}_{OL}}\right)$ , the argument of the logarithm is always greater than unity.

Figure 8.5-5 Normalized time-domain response of a latch.
Figure 8.5-5 illustrates the time-domain response characteristics of a latch. There are several important observations to be made. The first is that the time required for $\Delta {V}_{\text{out }}$ to reach ${V}_{OH} - {V}_{OL}$ is decreased by applying a larger input to the latch, $\Delta {V}_{i}$ , before enabling the latch. The second and more obvious is that the smaller the latch time constant, the faster the response. If the input to the latch before enabling the latch, $\Delta {V}_{i}$ , is small, the latch takes a long time for the output voltage, $\Delta {V}_{\text{out }}$ , to reach ${V}_{OH} - {V}_{OL}$ . Therefore, it is desirable to apply a reasonably large value of $\Delta {V}_{i}$ in order to take advantage of the rapidly increasing slope of the positive exponential characteristics of the latch.
---
Example 8.5-1
---
## Time-Domain Characteristics of a Latch
Find the time it takes from the time the latch is enabled until the output voltage, $\Delta {V}_{\text{out }}$ , equals ${V}_{OH} - {V}_{OL}$ if the $W/L$ of the latch NMOS transistors is ${10\mu }\mathrm{m}/{1\mu }\mathrm{m}$ and the latch dc current is ${10\mu }\mathrm{A}$ when $\Delta {V}_{i} = {0.01}\left( {{V}_{OH} - {V}_{OL}}\right)$ and $\Delta {V}_{i} = {0.1}\left( {{V}_{OH} - {V}_{OL}}\right)$ . Find the propagation time delay for the latch for each of these conditions.
## SOLUTION
The transconductance of the latch transistors is
$$
{g}_{m} = \sqrt{2 \cdot  {110} \cdot  {10} \cdot  {10}} = {148\mu }\mathrm{S}
$$
The output conductance gives a latch gain of ${370}\mathrm{\;V}/\mathrm{V}$ . Since ${g}_{m}R$ is greater than one, we can use Eq. (8.5-14). Therefore, the latch time constant is found as
$$
{\tau }_{L} = {0.67}{C}_{\mathrm{{ox}}}\sqrt{\frac{W{L}^{3}}{2{K}^{\prime }}} = {0.67}\left( {{24} \times  {10}^{-4}}\right) \sqrt{\frac{\left( {{10} \cdot  1}\right)  \times  {10}^{-{24}}}{2 \cdot  {110} \times  {10}^{-6} \cdot  {10} \times  {10}^{-6}}} = {0.112}\mathrm{{ns}}
$$
Using Eq. (8.5-17) or Fig. 8.5-5 we find for $\Delta {V}_{i} = {0.01}\left( {{V}_{OH} - {V}_{OL}}\right)$ that $t = {4.6}{\tau }_{L} = {0.515}\mathrm{\;{ns}}$ and for $\Delta {V}_{i} = {0.1}\left( {{V}_{OH} - {V}_{OL}}\right)$ that $t = {2.3}{\tau }_{L} = {0.258}\mathrm{\;{ns}}$ .
The propagation time delay can be found using Eq. (8.5-17) and is 0.438 ns and 0.180 ns for $\Delta {V}_{i} = {0.01}\left( {{V}_{OH} - {V}_{OL}}\right)$ and $\Delta {V}_{i} = {0.1}\left( {{V}_{OH} - {V}_{OL}}\right)$ , respectively.
A practical latch comparator is shown in Fig. 8.5-6 [6]. M7 and M8 are the latch transistors and are PMOS in this case. M9 and M10 are used to reset the latch by setting the source-drain voltages of M7 and M8 to zero. The input to the latch is applied to the gates of M1A and M1B. The transistors M1A, M1B, M2A, and M2B are operating in the triode region. The values of the inputs will cause the resistance seen by the sources of M3 and M4 to ground to vary. When the latch is enabled, the drains of M3 and M4 are connected to the latch outputs. M3 and M4 form a parallel positive-feedback path for the latch. For example, the signal at the gate of M7 can go through M7 or can go through M3 (M5 is a closed switch). The gain of the M3 and M4 feedback paths depends on the value of the resistor, ${R}_{1}$ or ${R}_{2}$ , respectively. If the resistor is small the gain is large and that side of the latch will go high.
When the latch/reset goes high, the latch goes into its regenerative mode. The drain currents of M5 and M6 are steered to obtain a final state determined by the mismatch between the ${R}_{1}$ and ${R}_{2}$ resistances. These resistances are given as
$$
\frac{1}{{R}_{1}} = {K}_{N}^{\prime }\left\lbrack  {\frac{{W}_{1\mathrm{\;A}}}{L}\left( {{v}_{\text{in }}^{ + } - {V}_{T}}\right)  + \frac{{W}_{2\mathrm{\;A}}}{L}\left( {{V}_{REF}^{ - } - {V}_{T}}\right) }\right\rbrack   \tag{8.5-18}
$$
and
$$
\frac{1}{{R}_{2}} = {K}_{N}^{\prime }\left\lbrack  {\frac{{W}_{1\mathrm{\;B}}}{L}\left( {{v}_{\text{in }}^{ - } - {V}_{T}}\right)  + \frac{{W}_{2\mathrm{\;B}}}{L}\left( {{V}_{\mathrm{{REF}}}^{ + } - {V}_{T}}\right) }\right\rbrack   \tag{8.5-19}
$$
The value of the input voltage that causes ${R}_{1}$ and ${R}_{2}$ to be equal is given as
$$
{v}_{\text{in }}\text{(threshold)} = \left( \frac{{W}_{2}}{{W}_{1}}\right) {V}_{\text{REF }} \tag{8.5-20}
$$
which provides a built-in threshold for the comparator where ${W}_{1\mathrm{\;A}} = {W}_{1\mathrm{\;B}} = {W}_{1}$ and ${W}_{2\mathrm{\;A}} =$ ${W}_{2\mathrm{\;B}} = {W}_{2}$ . For a value of ${W}_{2}/{W}_{1} = 1/4$ , the threshold voltage is $\pm  {0.25}{V}_{\mathrm{{REF}}}$ . This comparator has been used to make comparisons at ${20}\mathrm{{Ms}}/\mathrm{s}$ with a dissipation of ${0.2}\mathrm{\;{mW}}$ .

Figure 8.5-6 Comparator using a latch with a built-in threshold.

Figure 8.5-7 Simple low-power latched comparator.
A simpler form of the comparator of Fig. 8.5-6 is shown in Fig. 8.5-7 [7.] In this latched comparator, the input voltages ${v}_{in}^{ + }$ and ${v}_{in}^{ - }$ determine the currents in M3 and M4. The larger the current, the larger the feedback path gain through M3 or M4. This circuit dissipated approximately ${50\mu }\mathrm{W}$ when clocked at $2\mathrm{{MHz}}$ .
The current sinks/sources of Fig. 8.5-3 can be replaced by a latch using opposite-type transistors, resulting in the dynamic latch shown in Fig. 8.5-8 [8]. Here, a reference voltage, ${V}_{\mathrm{{REF}}}$ , is compared with an input voltage, ${V}_{\text{in }}$ , during the time when ${\phi }_{\text{Latch }}$ is high. This form of the latch has the advantage of lower power dissipation because no current is flowing when the latch is in reset mode $\left( {\phi }_{\text{Latch }}\right.$ is low). This comparator has a power dissipation per sampling rate of ${4.3\mu }\mathrm{W}/\mathrm{{Ms}}/\mathrm{s}$ , which makes it feasible for fast sampling with low power dissipation.
The input voltage offset of the latch is important because it will limit the resolution of the comparator. The input resolution range is the output swing divided by the gain of the latch in transition. Typically, the gain is around ${50} - {100}$ and the output swing $\left( {{V}_{OH} - {V}_{OL}}\right)$ is about $1\mathrm{\;V}$ . Therefore, the input resolution is typically around ${10} - {20}\mathrm{\;{mV}}$ . The input-offset voltage distribution for the latch of Fig. 8.5-8 is shown in Fig. 8.5-9 [8]. It is seen that the

Figure 8.5-8 Dynamic latch.

Figure 8.5-9 Input-offset voltage distribution histogram of the dynamic latch of Fig. 8.5-8.
input-offset voltage is distributed over a range of $\pm  {10}\mathrm{{mV}}$ . This comparator can only discriminate the difference between two signals to a 5 bit accuracy if the reference voltage was 1 V. This range can be reduced by preceding the latch by a preamplifier, which will be discussed in the next section.
### 8.6 High-Speed Comparators
A high-speed comparator should have a propagation delay time as small as possible. In order to achieve this goal, one must understand the requirements for a fast comparator. This is best understood by separating the comparator into a number of cascaded stages. Figure 8.6-1 illustrates how this can be accomplished. A number of stages with a gain of ${A}_{0}$ and a single pole at $1/\tau$ are shown. If the input change is slightly larger than ${V}_{\text{in }}\left( \min \right)$ , then the function of the stages is to amplify the input with as little delay per stage as possible. We note that the signal swings in the initial stages will be small. As the signal swing begins to approach the desired range, the amplifiers will be limited by their slew rate. Thus, for initial stages, the important parameter is to have a high bandwidth so that there is little delay in amplifying the signal and passing it on to the next stage. However, at the end of the cascade of amplifiers, it is more important to have a high slew rate capability so that the voltage across the interstage capacitors and the load capacitor rises or falls quick enough. Therefore, the stages at the beginning should be designed differently than the stages at the end of the amplifier chain.
The basic principle behind the high-speed comparator is to use a preamplifier to build up the input change to a sufficiently large value and then apply it to the latch. This combines the best aspects of circuits with a negative exponential response (the preamplifier) with circuits with a positive exponential response (the latch). This is illustrated in Fig. 8.6-2 where the time-domain response for a preamplifier and a latch are illustrated. In this figure, the gain of the preamplifier times the input voltage is not sufficient to reach the desired output level. Rather, during time ${t}_{1}$ the preamplifier amplifies the input voltage to a value of ${V}_{X}$ . The voltage ${V}_{X}$ is applied to the latch input, which then goes to the desired output voltage in time ${t}_{2}$ . Thus, the total response time is ${t}_{1} + {t}_{2}$ . If the comparator consisted only of the preamplifier, the gain would have to be larger and the delay to make the transition from ${V}_{OL}$ to ${V}_{OH}$ would be longer than ${t}_{1} + {t}_{2}$ . On the other hand, the latch would require more time than ${t}_{1} + {t}_{2}$ if the input was small. We saw from Fig. 8.5-5 that the larger the input to the latch the shorter the time for the output to reach its maximum value.

Figure 8.6-1 Conceptual illustration of a cascaded comparator.

Figure 8.6-2 Preamplifier and latch step response.
The design of the preamplifier must be done in such a manner that the desired latch input voltage, ${V}_{X}$ , is achieved in minimum time. Since the preamplifier is working in the linear region, this means that the bandwidth must be as large as possible. We know that the gain bandwidth of an amplifier is normally constant. Therefore, a single amplifier has a limited capability. If a number of low-gain, wide-bandwidth amplifiers are cascaded, the delay time, ${t}_{1}$ , can be minimized. In fact, it has been shown that the optimum number of identical low-gain amplifiers is six each with a gain of 2.72. However, this optimum is very broad and three amplifiers each with a gain of 6 gives equally good results with less area [9].
A high-speed comparator using three cascaded low-gain amplifiers as the preamplifier and a latch at the output is shown in Fig. 8.6-3. When the FB and Reset switches are closed, the capacitors designated as ${C}_{v}$ are autozeroed for each amplifier. Unfortunately, each amplifier must be autozeroed by itself. More switches would be required to autozero all three amplifiers at the same time. The input is applied through the capacitors ${C}_{1}$ and ${C}_{2}$ . For high-speed applications, the clocks to the comparator of Fig. 8.6-3 can be as high as 100 MHz, resulting in a comparator that can run at ${100}\mathrm{{Msps}}$ . As the sample time is increased, the power consumption of the comparator also increases.
The low-gain preamplifiers must compromise between a high bandwidth and sufficient gain. A simple preamplifier is shown in Fig. 8.6-4. The connection with the latch (for the last preamplifier) is shown. The gain of this preamplifier is
$$
{A}_{v} = {g}_{m1}/{g}_{m3} = {g}_{m2}/{g}_{m4} \tag{8.6-1}
$$
The dominant pole is given by
$$
\left| {p}_{\text{dominant }}\right|  = \frac{{g}_{m3}}{C} = \frac{{g}_{m4}}{C} \tag{8.6-2}
$$

Figure 8.6-3 Fully differential, three-stage comparator and latch.

Figure 8.6-4 Example of a preamplifier and latch.
where $C$ is the capacitance seen from the output nodes to ground. If the bias current in the transistors is ${25\mu }\mathrm{A}$ and the $W/L$ values of M1 and M2 are 100 and M3 and M4 are 1, then the gain is ${3.85}\mathrm{\;V}/\mathrm{V}$ and if $C = {0.5}\mathrm{{pF}}$ , the pole is ${10}^{8}\mathrm{{rad}}/\mathrm{s}$ or ${15.9}\mathrm{{MHz}}$ . We see that it is important to keep the pole as large as possible. Sometimes it is necessary to buffer the output of the amplifier from the capacitive load of the next stage. Unfortunately, the buffer will have a gain loss $2 - 3\mathrm{\;{dB}}$ , which is undesirable.
There are several problems with the preamplifier of Fig. 8.6-4. One is that the gain is very small even for large differences of $W/L$ values. Another is that there is no isolation between the latch outputs and the inputs to the preamplifier. Rapid changes in the output of the latch can propagate through the drain-gate capacitances of M1 and M2 and appear at the input of the latch. Figure 8.6-5 shows a preamplifier that solves these two problems. Transistors M5 and M6 are used to increase the current in M1 and M2 so that the gain is enhanced by the square root of the difference of currents in M1 and M2 to the currents in M3 and M4. This can be illustrated as follows. The gain of the preamplifier was given in Eq. (8.6-1) and can be expressed further as
$$
{A}_{v} =  - \frac{{g}_{m1}}{{g}_{m3}} =  - \sqrt{\frac{{K}_{N}^{\prime }\left( {{W}_{1}/{L}_{1}}\right) {I}_{1}}{{K}_{P}^{\prime }\left( {{W}_{3}/{L}_{3}}\right) {I}_{3}}} =  - \sqrt{\frac{{K}_{N}^{\prime }\left( {{W}_{1}/{L}_{1}}\right) }{{K}_{P}^{\prime }\left( {{W}_{3}/{L}_{3}}\right) }}\sqrt{1 + \frac{{I}_{5}}{{I}_{3}}} \tag{8.6-3}
$$
If ${I}_{5}$ is greater than ${I}_{3}$ , the gain can be enhanced by the square root of 1 plus the ratio of ${I}_{5}$ to ${I}_{3}$ . If ${I}_{5} = {24}{I}_{3}$ , the gain is boosted by a factor of 5 . Transistors M7 and M8 isolate the input from rapid changes in the latch output.

Figure 8.6-5 An improved preamplifier.
The use of a preamplifier before the latch also has the advantage of reducing the input-offset voltage of the latch by the gain of the preamplifier. The input-offset voltage of the comparator will now become that of the preamplifier, which can be autozeroed, resulting in small values of input-offset voltage.
The preamplifier can be replaced by a charge-transfer circuit resulting in simplification of the preamplifier [8]. A simple charge-transfer circuit is shown in Fig. 8.6-6(a), where the capacitor ${C}_{T}$ is larger than ${C}_{O}$ . This charge-transfer amplifier has three phases of operation. The first phase of operation is a reset phase, where switch $\mathrm{S}1$ is closed discharging ${C}_{T}$ . The second phase is the precharge phase shown in Fig. 8.6-6(b), where switch S2 is closed. In this phase, the capacitor ${C}_{T}$ is charged to ${v}_{\text{in }} - {V}_{T}$ and the output capacitor, ${C}_{O}$ , is charged to the preset voltage, ${V}_{PR}$ . The third phase is the amplification phase and is shown in Fig. 8.6-6(c), where both switches are open. In this phase, the input has been assumed to change by an amount ${\Delta V}$ . This causes a current to flow in ${C}_{T}$ , which also flows in ${C}_{O}$ . Since the charge change must be equal for both ${C}_{T}$ and ${C}_{O}$ , the change across ${C}_{O}$ is $- \left( {{C}_{T}/{C}_{O}}\right) {\Delta V}$ . If ${C}_{T}$ is greater than ${C}_{O}$ , the input change, ${\Delta V}$ , is amplified at the output by the factor of ${C}_{T}/{C}_{O}$ .
The charge-transfer amplifier has several problems that must be solved. The first is that only positive values of voltage will be amplified and the second is that large offset voltages result as a function of the subthreshold current. A circuit that solves these problems is shown in Fig. 8.6-7 and uses both NMOS and PMOS transistors. Switches S3 are used to prevent a current path during the reset phase. This circuit was used in cascade with a dynamic latch to function as a comparator up to ${20}\mathrm{{Ms}}/\mathrm{s}$ with 8 bit linearity and a power dissipation of less than ${5\mu }\mathrm{W}$ . One of the limitations of the charge-transfer comparator is charge feedthrough. Dummy switches have been used to cancel some of the effects of charge feedthrough that occur when the various switches are opened.

Figure 8.6-6 (a) Charge-transfer amplifier. (b) Precharge phase. (c) Amplification phase.

Figure 8.6-7 A CMOS charge-transfer preamplifier.
When a comparator must drive a significant amount of output capacitance in very short times, the latch is generally not sufficient. In this case it is advisable to follow the latch by circuits that can quickly generate large amounts of current. A high-speed comparator following these principles is shown in Fig. 8.6-8 [10]. The first stage is a low-gain, high-bandwidth preamplifier that drives a latch. The latch outputs are used to drive a self-biased differential amplifier. The output of the self-biased differential amplifer drives a push-pull output driver.
The comparator of Fig. 8.6-8 was designed to have a propagation time delay of ${10}\mathrm{{ns}}$ with a $5\mathrm{{pF}}$ load capacitor and a ${10}\mathrm{{mV}}$ overdrive. It is interesting to note that the comparator is synchronous (clocks are not used). The gain of the comparator in midswing is greater than ${2000}\mathrm{\;V}/\mathrm{V}$ and the quiescent current is ${100\mu }\mathrm{A}$ . More design details can be found in Baker et al. [10].

Figure 8.6-8 A high-speed comparator using a cascade of a preamplifier, latch, self-biased differential amplifier, and output driver.

### 8.7 Summary
This chapter has introduced the comparator function along with the CMOS implementation of that function. The development of the CMOS comparator relied on previous work covering basic CMOS circuits in Chapters 4 and 5. The op amp of Chapter 6 makes an excellent open-loop, high-gain comparator realization. The characterization of the two-stage, open-loop comparator illustrated the performance capabilities. It was seen that two modes of response can exist in a linear comparator. One is small signal and the other is large signal. The difference is whether or not slewing occurs. When a comparator does not slew (small signal) the bandwidth is key to reducing the propagation delay time. However, when the comparator slews, then current sinking and sourcing capability is crucial to fast operation.
The performance of the open-loop comparator can be improved by the use of hysteresis to remove the influence of a noisy input signal. Autozeroing can be used in comparators to reduce the input-offset voltage. It is necessary that the comparator be stable in the unity-gain mode during autozeroing, which can be difficult to accomplish in some types of comparators. It was seen that self-biased comparators were always stable in the autozeroing operation. Although we did not examine the noise of the comparator, it would be analyzed in the same manner as was done for op amps. We assume that the noise, which is a linear phenomenon, is important during the switching of the comparator, which is in the linear region.
In many comparator applications, the signal is discrete time rather than continuous. In this case it is possible to use regenerative circuits as comparators. Unfortunately, the transient response of regenerative circuits is characterized by a positive exponential argument. This means that if the input signal is small a long time will be required for the signal to reach the region of the exponential response where the slope is steep. A solution for this problem is to cascade the latch with a preamplifier. The function of the preamplifier is to quickly build up the input to the latch so that the slow rate of rise of the exponential response can be avoided. This has resulted in a comparator capable of operating up to ${20}\mathrm{{Ms}}/\mathrm{s}$ and greater.
The comparator will play an important role in the remainder of the text, particularly in the area of analog-digital converters. It will be one of the major factors determining how accurately and how quickly analog signal processing can be accomplished.
## Problems
8.1-1. Give the equivalent figures for Figs. 8.1-2, 8.1-4, 8.1-6, and 8.1-9 for an inverting comparator.
8.1-2. Draw the first-order time response of an inverting comparator with a ${20\mu }\mathrm{s}$ propagation delay time. The input is described by the following equations:
$$
{v}_{\text{in }} = 0\;\text{ for }t < {5\mu }\mathrm{s}
$$
$$
{v}_{\text{in }} = 5\left( {t - {5\mu }\mathrm{s}}\right) \;\text{ for }{5\mu }\mathrm{s} < t < {7\mu }\mathrm{s}
$$
$$
{v}_{\text{in }} = {10}\text{for}t > {7\mu }\mathrm{s}
$$
8.1-3. Repeat Example 8.1-1 if the pole of the comparator is $- {10}^{5}\mathrm{{rad}}/\mathrm{s}$ rather than $- {10}^{3}$ rad/s.
8.1-4. What value of ${V}_{\text{in }}$ in Example 8.1-1 will give a slewing response?
8.2-1. Repeat Example 8.2-1 for the two-stage comparator of Fig. 8.2-5.
8.2-2. If the poles of a two-stage comparator are both equal to $- {10}^{7}\mathrm{{rad}}/\mathrm{s}$ , find the maximum slope and the time it occurs if the magnitude of the input step is ${10}{V}_{\text{in }}\left( \min \right)$ . What must be the ${SR}$ of this comparator to avoid slewing?
8.2-3. Repeat Example 8.2-3 if ${p}_{1} =  - 5 \times  {10}^{6}$ rad/s and ${p}_{2} =  - {10} \times  {10}^{6}\mathrm{{rad}}/\mathrm{s}$ .
8.2-4. For Fig. 8.2-5, find all of the possible initial states listed in Table 8.2-1 of the first-stage output voltage and the comparator output voltage.
8.2-5. Calculate the trip voltage for the comparator shown in Fig. 8.2-4. Use the parameters given in Table 3.1-2. Also, ${\left( W/L\right) }_{2} = {100}$ and ${\left( W/L\right) }_{1} = {10}.{V}_{\text{BIAS }} = 1\mathrm{\;V},{V}_{SS} = 0\mathrm{\;V}$ , and ${V}_{DD} = 4\mathrm{\;V}$ . Compute the worst-case variations of the trip voltage assuming a $\pm  {10}\%$ variation on ${V}_{T},{K}^{\prime },{V}_{DD}$ , and ${V}_{\text{BIAS }}$ .
8.2-6. Sketch the output response of the circuit in Problem 8.2-5, given a step input that goes from 4 to $1\mathrm{\;V}$ . Assume a ${10}\mathrm{{pF}}$ capacitive load. Also assume the input has been at $4\mathrm{\;V}$ for a very long time. What is the delay time from the step input to when the output changes logical (CMOS) states?
8.2-7. Repeat Example 8.2-5 with ${v}_{G2}$ constant and the waveform of Fig. 8.2-6 applied to ${v}_{G1}$ .
8.2-8. Repeat Example 8.2-5 using the two-stage op amp designed in Example 6.3-1 if the compensation capacitor is removed.
8.2-9. Repeat Example 8.2-6 if the propagation time is ${t}_{p} = {25}\mathrm{{ns}}$ .
8.2-10. An open-loop comparator has a gain of ${10}^{4}$ , a dominant pole of ${10}^{5}\mathrm{{rads}}/\mathrm{s}$ , a slew rate of $5\mathrm{\;V}/\mathrm{{\mu s}}$ , and an output swing of $1\mathrm{\;V}$ . (a) If ${V}_{in} = 1\mathrm{{mV}}$ , find the propagation delay time of this comparator (the time for the output to go halfway from one state to the other). (b) Repeat part (a) if ${V}_{in} = {10}$ mV. (c) Repeat part (a) if ${V}_{in} = {100}\mathrm{{mV}}$ .
8.2-11. The comparator shown in Fig. P8.2-11 has an input applied as shown. Assuming the pulse width is wide enough, calculate the propagation delay time for this comparator. Assume that the trip point of the output is at $0\mathrm{\;V}$ .
8.2-12. Design a comparator given the following requirements: ${P}_{\text{diss }} < 2\mathrm{\;{mW}},{V}_{DD} = 3\mathrm{\;V}$ , ${V}_{SS} = 0\mathrm{\;V},{C}_{\text{load }} = 3\mathrm{{pF}},{t}_{\text{prop }} < {1\mu }\mathrm{s}$ , ICMR $= {1.5} - {2.5}\mathrm{\;V},{A}_{v0} > {2200}$ , and output voltage swing within ${1.5}\mathrm{\;V}$ of either rail. Use Tables 3.1-2 and 3.3-1. Use 1 $\mu \mathrm{m}$ channel lengths for all transistors.

Figure P8.2-11
8.3-1. Assume that the dc current in M5 of Fig. ${8.3} - 1$ is ${100\mu }\mathrm{A}$ . If ${W}_{6}/{L}_{6} = 5\left( {{W}_{4}/{L}_{4}}\right)$ and ${W}_{8}/{L}_{8} = 5\left( {{W}_{3}/{L}_{3}}\right)$ , what is the slew rate limited propagation delay time of this comparator if ${C}_{L} = {10}\mathrm{{pF}}$ and ${V}_{DD} =  - {V}_{SS} = 2\mathrm{\;V}$ ?
8.3-2. If the folded-cascode op amp of Example 6.5-3 is used as a comparator, find the dominant pole if ${C}_{L} = 5\mathrm{{pF}}$ . If the input step is ${10}\mathrm{{mV}}$ , determine whether the response is linear or slewing and find the propagation delay time.
8.3-3. Find the open-loop gain of Fig. 8.3-3 if the two-stage op amp is the same as Example 6.3-1 without the compensation and ${W}_{10}/{L}_{10} = {10}\left( {{W}_{8}/{L}_{8}}\right)  = {100}\left( {{W}_{6}/{L}_{6}}\right)$ , ${\mathrm{W}}_{9}/{L}_{9} = \left( {{K}_{P}^{\prime }/{K}_{N}^{\prime }}\right) \left( {{W}_{8}/{L}_{8}}\right) ,\;{W}_{11}/{L}_{11} =$ $\left( {{K}_{P}^{\prime }/{K}_{N}^{\prime }}\right) \left( {{W}_{10}/{L}_{10}}\right)$ and the quiescent current in M8 and M9 is ${100\mu }\mathrm{A}$ and in M10 and M11 is ${500\mu }\mathrm{A}$ . What is the propagation time delay if ${C}_{II} = {100}\mathrm{{pF}}$ and the step input is large enough to cause slewing?
8.3-4. Figure P8.3-4 shows a circuit called a clamped comparator. Use the parameters of Table 3.1-2 and calculate the gain of this comparator. What is the positive and negative slew rate of this comparator if the load capacitance is $5\mathrm{{pF}}$ ?
8.4-1. If the comparator used in Fig. 8.4-1 has a dominant pole at ${10}^{4}\mathrm{{rad}}/\mathrm{s}$ and a gain of ${10}^{3}$ , how long does it take ${C}_{AZ}$ to charge to ${99}\%$ of its final value, ${\mathrm{V}}_{OS}$ ? What is the final value that the capacitor, ${C}_{AZ}$ , will charge to if left in the configuration of Fig. 8.4-1(b) for a long time?

Figure P8.3-4
8.4-2. Use the circuit of Fig. 8.4-9 and design a hysteresis characteristic that has ${V}_{TRP}^{ - } = 0$ $\mathrm{V}$ and ${V}_{TRP}^{ + } = 1\mathrm{\;V}$ if ${\mathrm{V}}_{OH} = 2\mathrm{\;V}$ and ${V}_{OL} =$ 0V. Let ${R}_{1} = {100}\mathrm{k}\Omega$ .
8.4-3. Repeat Problem 8.4-2 for Fig. 8.4-10.
8.4-4. Assume that all transistors in Fig. 8.4-11 are operating in the saturation mode. What is the gain of the positive-feedback loop, $\mathrm{M}6 - \mathrm{M}7$ , using the $W/L$ values and currents of Example 8.4-2?
8.4-5. Repeat Example 8.4-1 to design ${V}_{TRP}^{ + } =$ $- {V}_{TRP}^{ - } = {0.5}\mathrm{\;V}$ .
8.4-6. Repeat Example 8.4-2 if ${i}_{5} = {50\mu }\mathrm{A}$ . Confirm using a simulator.
8.4-7. Review the development of the switching points for the comparator of Fig. 8.4-11. Discuss why the simulation data in Fig. 8.4-13 does not match closely with the calculations of Example 8.4-2.
8.5-1. List the advantages and disadvantages of the switched capacitor comparator of Fig. 8.5-1 over an open-loop comparator having the same gain and frequency response.
8.5-2. If the current and $W/L$ values of the two latches in Fig. 8.5-3 are identical, which latch will be faster? Why?
8.5-3. Repeat Example 8.5-1 if $\Delta {V}_{\text{out }} =$ $\left( {{V}_{OH} - {V}_{OL}}\right)$ .
8.5-4. Repeat Example 8.5-1 if the dc latch current is ${50\mu }\mathrm{A}$ .
8.5-5. Redevelop the expression for $\Delta {V}_{\text{out }}/\Delta {V}_{i}$ for the circuit of Fig. P8.5-5, where $\Delta {v}_{\text{out }} =$ ${v}_{o2} - {v}_{o1}$ and $\Delta {V}_{i} = {v}_{i1} - {v}_{i2}$ .

Figure P8.5-5
8.5-6. Compare the dynamic latch of Fig. 8.5-8 with the NMOS and PMOS latches of Fig. 8.5-3. What are the advantages and disadvantages of the two latches?
8.5-7. Use the worst-case values of the transistor parameters in Table 3.1-2 and calculate the worst-case voltage offset for the NMOS latch of Fig. 8.5-3(a).
8.5-8. Consider the latch shown in Fig. P8.5-8. Assume the capacitors connected to the drains of M1 and M2 $\left( {C}_{1}\right.$ and $\left. {C}_{2}\right)$ are initially discharged. Express $\Delta {V}_{\text{out }} = {v}_{o2} - {v}_{o1}$ as a function of the applied input, $\Delta {V}_{in} = {v}_{i1} -$ ${v}_{i2}$ , in the time domain assuming $\Delta {V}_{in}$ is a step input. If ${g}_{m1} = {g}_{m2} = 1\mathrm{\;{mS}},{g}_{m3} = {g}_{m4}$ $= {100\mu }\mathrm{S}$ , and ${C}_{1} = {C}_{2} = 1\mathrm{{pF}}$ , what is the propagation delay time $\left( {\Delta {V}_{\text{out }} = \left| {\;{0.5}\left( {{V}_{OH} - }\right. }\right. }\right.$ $\left. \left. {V}_{OL}\right) \right)$ for a step input of $\Delta {V}_{in} = {0.01}\left( {{V}_{OH} - }\right.$ ${V}_{OL})$ ?

Figure P8.6-1
8.6-1. Assume an op amp has a low-frequency gain of ${1000}\mathrm{\;V}/\mathrm{V}$ and a dominant pole at $- {10}^{4}\mathrm{{rad}}/\mathrm{s}$ . Compare the $- 3\mathrm{\;{dB}}$ bandwidths of the configurations in Fig. P8.6-1 using this op amp.
8.6-2. What is the gain and $- 3\mathrm{{dB}}$ bandwidth (in Hz) of Fig. P8.6-2 if ${C}_{L} = 1\mathrm{{pF}}$ ? Ignore reverse-bias voltage effects on the pn junctions and assume the bulk-source and bulk-drain areas are given by $W \times  {5\mu }\mathrm{m}$ .

Figure P8.6-2
8.6-3. Repeat Problem 8.6-2 for Fig. P8.6-3. The $W/L$ ratios for M1 and M2 are ${10\mu }\mathrm{m}/{1\mu }\mathrm{m}$ and for the remaining PMOS transistors the $W/L$ ratios are all ${2\mu }\mathrm{m}/{1\mu }\mathrm{m}$ .

Figure P8.6-3
8.6-4. Assume that a comparator consists of an amplifier cascaded with a latch. Assume the amplifier has a gain of $5\mathrm{\;V}/\mathrm{V}$ and a $- 3\mathrm{\;{dB}}$ bandwidth of $1/{\tau }_{L}$ , where ${\tau }_{L}$ is the latch time constant. Find the normalized propagation delay time for the overall configuration if the applied input voltage is ${0.05}\left( {{V}_{OH} - }\right.$ ${V}_{OL}$ ) and the voltage applied to the latch is (a) $\Delta {V}_{i} = {0.05}\left( {{V}_{OH} - {V}_{OL}}\right)$ ,(b) $\Delta {V}_{i} = {0.1}$ $\left( {{V}_{OH} - {V}_{OL}}\right)$ ,(c) $\Delta {V}_{i} = {0.15}\left( {{V}_{OH} - {V}_{OL}}\right)$ , and (d) $\Delta {V}_{i} = {0.2}\left( {{V}_{OH} - {V}_{OL}}\right)$ . From your results, what value of $\Delta {V}_{i}$ would give minimum propagation delay time?
8.6-5. Assume that a comparator consists of two identical amplifiers cascaded with a latch. Assume the amplifier has the characteristics given in Problem 8.6-4. What would be the normalized propagation delay time if the applied input voltage is ${0.05}\left( {{V}_{OH} - }\right.$ ${V}_{OL}$ ) and the voltage applied to the latch is $\Delta {V}_{i} = {0.1}\left( {{V}_{OH} - {V}_{OL}}\right) ?$
8.6-6. Repeat Problem 8.6-5 if there are three identical amplifiers cascaded with a latch. What would be the normalized propagation delay time if the applied input voltage is ${0.05}\left( {V}_{OH}\right.$ $\left. {-{V}_{OL}}\right)$ and the voltage applied to the latch is $\Delta {V}_{i} = {0.2}\left( {{V}_{OH} - {V}_{OL}}\right)$ ?
8.6-7. A comparator consists of an amplifier cascaded with a latch as shown in Fig. P8.6-7. The amplifier has voltage gain of ${10}\mathrm{\;V}/\mathrm{V}$ and ${f}_{-{3d}\mathrm{\;B}} = {100}\mathrm{{MHz}}$ and the latch has a time constant of ${10}\mathrm{{ns}}$ . The maximum and minimum voltage swings of the amplifier and latch are ${V}_{OH}$ and ${V}_{OL}$ . When should the latch be enabled after the application of a step input to the amplifier of ${0.05}\left( {{V}_{OH} - {V}_{OL}}\right)$ to get minimum overall propagation time delay? What is the value of the minimum propagation time delay? It may be useful to recall that the propagating time delay of the latch is given as ${t}_{p} = {\tau }_{L}\ln \left( \frac{{V}_{OH} - {V}_{OL}}{2{v}_{il}}\right)$ , where ${v}_{il}$ is the latch input $\left( {\Delta {V}_{i}}\right.$ of the text).

Figure P8.6-7
1. D. J. Allstot, "A Precision Variable-Supply CMOS Comparator," IEEE J. Solid-State Circuits, Vol. SC-17, No. 6, pp. 1080-1087, Dec. 1982.
2. M. Bazes, "Two Novel Full Complementary Self-Biased CMOS Differential Amplifiers," IEEE J. Solid-State Circuits, Vol. 26, No. 2, pp. 165-168, Feb. 1991.
3. J. Millman and C. C. Halkias, Integrated Electronics: Analog and Digital Circuits and Systems. New York: McGraw-Hill, 1972.
4. A. S. Sedra and K. C. Smith, Microelectronic Circuits, 4th ed. New York: Oxford University Press, 1998.
5. J. Millman and H. Taub, Pulse, Digital, and Switching Waveforms. New York: McGraw-Hill, 1965.
6. T. B. Cho and P. R. Gray, "A 10b, 20 Msamples/s, 35 mW Pipeline A/D Converter," IEEE J. Solid-State Circuits, Vol. 30, No. 3, pp. 166-172, Mar. 1995.
7. A. L. Coban and P. E. Allen, "A 1.5 V, 1 mW Audio ${\Delta \sum }$ Modulator with 98 dB Dynamic Range," Proc. Int. Solid-State Circuit Conf., pp. 50-51, Feb. 1999.
8. K. Kotani, T. Shibata, and T. Ohmi, "CMOS Charge-Transfer Preamplifier for Offset-Fluctuation Cancellation in Low-Power A/D Converters," IEEE J. Solid-State Circuits, Vol. 33, No. 5, pp. 762-769, May 1998.
9. J. Doernberg, P. R. Gray, and D. A. Hodges, "A 10-bit 5-Msample/s CMOS Two-Step Flash ADC," IEEE J. Solid-State Circuits, Vol. 24, No. 2, pp. 241-249, Apr. 1989.
10. R. J. Baker, H. W. Li, and D. E. Boyce, CMOS Circuit Design, Layout, and Simulation. Piscataway, NJ: IEEE Press, 1998, Chap, 26.
Copyrighted Materials CHAPTER 9

## Digital-Analog and Analog-Digital Converters
Og ne of the most important functions in signal processing is the conversion between ana- log and digital signals. In Section 1.1, the definition and distinction between analog and digital signals were presented. Figure 1.3-1 illustrated the typical block diagram of a signal-processing system. It was noted that there are areas where signal processing is done on analog signals and areas where the signal processing is done on digital signals. Consequently, it is necessary to be able to convert back and forth between the two types of signals. Therefore, analog-to-digital and digital-to-analog converters are an important part of any signal-processing system.
From the viewpoint of Table 1.1-2, analog-digital converters (ADCs) and digital-analog converters (DACs) are at the systems level. They typically contain one or more comparators, digital circuitry, switches, integrators, a sample-and-hold, and/or passive components. Another important component of the ADCs or DACs is a precise voltage reference. In this chapter, the voltage reference will not be discussed. However, methods of designing stable voltage references have been presented in Chapter 4. We will find that the op amp plays a major role in the DAC while the comparator is the important active component in the ADC. The DACs and ADCs presented here do not represent all possible approaches but have been selected to be compatible with CMOS technology.
The DAC is presented first because it is generally part of an ADC. Our presentation will introduce the DAC including its characterization and testing. Next, the various types of DACs, will be examined according to the means by which they scale the reference to provide the analog output. The next section will explore methods to improve the performance of these DACs, thereby resulting in practical implementations of the DAC. Serial DACs are discussed next. These DACs require a long conversion time but are very accurate.
Analog-digital converters are introduced next. We begin with the characterization and testing of the ADC. By nature, all ADCs must sample the analog input and this characteristic and its restrictions are examined. This includes sample-and-hold circuits and aliasing. The ADCs are classified by the time it takes to perform a conversion. We will separate our considerations into low-speed ADCs, medium-speed ADCs, and high-speed ADCs. These ADCs are called Nyquist converters because they work up to the Nyquist frequency. Another important category of converters is oversampled converters. We will examine these converters and see how they can be used to implement an ADC and a DAC.
### 9.1 Introduction and Characterization of Digital-Analog Converters

This section examines the digital-to-analog conversion aspect of this important interface. Figure 9.1-1 illustrates how DACs are used in data systems [1]. The input to a DAC is a digital word consisting of parallel binary signals that are generated from a digital signal-processing system. These parallel binary signals are converted to an equivalent analog signal by scaling a reference. The analog output signal may be filtered and/or amplified before being applied to an analog signal-processing system. While the output may be voltage or current, most DACs have a voltage output.
A DAC with a voltage output can be characterized by the block diagram in Fig. 9.1-2(a). We see that it consists of a digital word of $N$ -bits $\left( {{b}_{0},{b}_{1},{b}_{2},\ldots {b}_{N - 2},{b}_{N - 1}}\right)$ and a reference voltage ${V}_{\mathrm{{REF}}} \cdot  {b}_{0}$ is called the most significant bit, MSB, and ${b}_{N - 1}$ is called the least significant bit, LSB. The voltage output ${v}_{\text{OUT }}$ can be expressed as
$$
{v}_{\mathrm{{OUT}}} = K{V}_{\mathrm{{REF}}}D \tag{9.1-1}
$$
where $K$ is a scaling factor and the digital word $D$ is given as
$$
D = \frac{{b}_{0}}{{2}^{1}} + \frac{{b}_{1}}{{2}^{2}} + \frac{{b}_{2}}{{2}^{3}} + \cdots  + \frac{{b}_{N - 1}}{{2}^{N}} \tag{9.1-2}
$$
$N$ is the total number of bits of the digital word and ${b}_{i - 1}$ is the $i$ th-bit coefficient and is either 0 or 1 . Therefore, the output of a DAC can be expressed by combining Eqs. (9.1-1) and (9.1-2) to get
$$
{v}_{\mathrm{{OUT}}} = K{V}_{\mathrm{{REF}}}\left( {\frac{{b}_{1}}{{2}^{1}} + \frac{{b}_{2}}{{2}^{2}} + \frac{{b}_{3}}{{2}^{3}} + \cdots  + \frac{{b}_{N}}{{2}^{N}}}\right)  \tag{9.1-3}
$$
$$
{v}_{\mathrm{{OUT}}} = K{V}_{\mathrm{{REF}}}\left\lbrack  {{b}_{0}{2}^{-1} + {b}_{1}{2}^{-2} + {b}_{2}{2}^{-3} + \cdots  + {b}_{N - 1}{2}^{-N}}\right\rbrack   \tag{9.1-4}
$$

Figure 9.1-1 Digital-analog converter in signal-processing applications.

Figure 9.1-2 (a) Digital-analog converter in signal-processing applications. (b) Clocked digital-analog converter for synchronous operation. (The asterisk represents a signal that has been sampled and held.)
In many cases the digital word is synchronously clocked. In this case latches must be used to hold the word for conversion and a sample-and-hold circuit is needed at the output, as shown in Fig. 9.1-2(b). We will examine sample-and-hold circuits in more detail later in this chapter.
The basic form of a DAC providing an analog output voltage is shown in more detail in Fig. 9.1-3. It includes binary switches, a scaling network, and an output amplifier. The scaling network and binary switches operate on the reference voltage to create a voltage that has been scaled by the digital word. The scaling mechanism may be voltage, current, or charge scaling. The output amplifier amplifies the scaled voltage signal to a desired level and provides the ability to source or sink current into a load.
## Static Characteristics of DACs
The characterization of DACs is very important in understanding its design. The characteristics of the digital-analog converter can be divided into static and dynamic properties. The resolution of the DAC is equal to the number of bits in the applied digital input word. The resolution of a DAC is expressed as $N$ -bits, where $N$ is the number of bits. Figure 9.1-4 shows the input and output characteristics of an ideal 3-bit DAC $\left( {N = 3}\right)$ . We see that each of the eight possible digital words has its own unique analog output voltage. These levels are separated by an ${LSB}$ . The value of the LSB can be defined as
$$
{LSB} = \frac{{V}_{\mathrm{{REF}}}}{{2}^{N}} \tag{9.1-5}
$$
As the digital word increases by 1-bit, the output of the ideal DAC should jump up by 1LSB. We note that the output is ${0.0625}\mathrm{\;V}$ for the digital input of 000 . However, there is no reason why the characteristic cannot be shifted downward by a half ${LSB}$ as shown by the dashed characteristic, which corresponds to $0\mathrm{\;V}$ for the digital input of 000 .

Figure 9.1-3 Block diagram of a digital-analog converter.

Figure 9.1-4 Ideal input-output characteristics of a 3-bit DAC.
Because the resolution of the DAC is finite ( 3 in the case of Fig. 9.1-4), the maximum analog output voltage does not equal ${V}_{\mathrm{{REF}}}$ . This result is characterized by the full scale (FS) value of the DAC. The full scale value is defined as the difference between the analog output for the largest digital word (1111 . . .) and the analog output for the smallest digital word $\left( {{0000}\ldots }\right)$ . In general, the full scale of a DAC can be expressed as
$$
\text{ Full scale }\left( {FS}\right)  = {V}_{\mathrm{{REF}}} - {LSB} = {V}_{\mathrm{{REF}}}\left( {1 - \frac{1}{{2}^{N}}}\right)  \tag{9.1-6}
$$
This definition of ${FS}$ holds regardless of whether the characteristic has been shifted vertically by $\pm  {0.5}\mathrm{{LSB}}$ . In the case of Fig. ${9.1} - 4,{FS}$ is equal to ${0.875}{V}_{\mathrm{{REF}}}$ . The full scale range (FSR) is defined as
$$
{FSR} = \mathop{\lim }\limits_{{N \rightarrow  \infty }}{FS} = {V}_{\text{REF }} \tag{9.1-7}
$$
Based on the above discussion, let us define several important quantities that are important for DACs. The first is called quantization noise. Quantization noise is the inherent uncertainty in digitizing an analog value with a finite resolution converter. To understand this definition, the characteristic for an infinite resolution DAC is plotted on Fig. 9.1-4. This line represents the limit of the finite DAC characteristic as the number of bits, $N$ , approaches infinity. The quantization noise (or error) is equal to the analog output of the infinite-bit DAC minus the analog output of the finite-bit DAC. If we plot the quantization noise of either of the 3-bit characteristics in Fig. 9.1-4, we obtain the result shown in Fig. 9.1-5. The solid and dashed lines correspond to the solid and dashed staircases, respectively, in Fig. 9.1-4.

Figure 9.1-5 Quantization noise for the 3-bit DAC of Fig. 9.1-4.
We see from Fig. 9.1-5 that the quantization noise is a sawtooth waveform having a peak-to-peak value of $1\mathrm{{LSB}}$ . It is useful to note that ${0.5}\mathrm{{LSB}}$ is equivalent to $\mathrm{{FSR}}/{2}^{N + 1}$ . This noise is a fundamental property of DACs and represents the limit of accuracy of the converter. For example, it is sufficient to reduce the inaccuracies of the DAC to within $\pm  {0.5}\mathrm{{LSB}}$ . Any further decrease is masked by the quantization noise that can only be reduced by increasing the resolution.
The dynamic range(DR)of a DAC is the ratio of the ${FSR}$ to the smallest difference that can be resolved (i.e., an ${LSB}$ ). We can express the dynamic range of the DAC as
$$
{DR} = \frac{FSR}{LSB} = \frac{FSR}{\left( FSR/{2}^{N}\right) } = {2}^{N} \tag{9.1-8}
$$
In terms of decibels, Eq. (9.1-8) can be expressed as
$$
{DR}\left( \mathrm{\;{dB}}\right)  = {6.02N}\mathrm{\;{dB}} \tag{9.1-9}
$$
The signal-to-noise ratio (SNR) for the DAC is defined as the ratio of the full scale value to the rms value of the quantization noise. The rms value of the quantization noise can be found by taking the root mean square of the quantization noise. For the quantization noise designated by the solid line, this results in
$$
\text{rms(quantization noise)} = \sqrt{\frac{1}{T}{\int }_{0}^{T}{LS}{B}^{2}{\left( \frac{t}{T} - {0.5}\right) }^{2}{dt}} = \frac{LSB}{\sqrt{12}} = \frac{FSR}{{2}^{N}\sqrt{12}} \tag{9.1-10}
$$
Therefore, the signal-to-noise ratio of the DAC can be expressed as
$$
{SNR} = \frac{{v}_{\mathrm{{OUT}}}\mathrm{{rms}}}{\left( FSR/{2}^{N}\sqrt{12}\right) } \tag{9.1-11}
$$
The largest possible rms value of ${v}_{\mathrm{{OUT}}}$ is $\left( {{FSR}/2}\right) /\sqrt{2}$ or ${V}_{\mathrm{{REF}}}/\left( {2\sqrt{2}}\right)$ assuming a sinusoidal waveform. Therefore, the maximum SNR required for a DAC is
$$
{SN}{R}_{\max } = \frac{{FSR}/\left( {2\sqrt{2}}\right) }{{FSR}/\left( {{2}^{N}\sqrt{12}}\right) } = \frac{{2}^{N}\sqrt{6}}{2} \tag{9.1-12}
$$
In terms of decibels we can rewrite Eq. (9.1-12) as
$$
{SN}{R}_{\max }\left( \mathrm{{dB}}\right)  = {20}{\log }_{10}\left( \frac{{2}^{N}\sqrt{6}}{2}\right)  = {20}{\log }_{10}\left( {2}^{N}\right)  + {10}{\log }_{10}\left( 6\right)  - {20}{\log }_{10}\left( 2\right)  \tag{9.1-13}
$$
$$
= {6.02N}\mathrm{\;{dB}} + {7.78}\mathrm{\;{dB}} - {6.02}\mathrm{\;{dB}} = {6.02N}\mathrm{\;{dB}} + {1.76}\mathrm{\;{dB}}
$$
The effective number of bits (ENOB) can be defined from the above as
$$
{ENOB} = \frac{{SN}{R}_{\text{actual }} - {1.76}}{6.02} \tag{9.1-14}
$$
where ${SN}{R}_{\text{actual }}$ is the actual ${SNR}$ of the converter.
It is important to summarize the above results because they are very useful in understanding the performance of DACs. The dynamic range necessary for an $N$ -bit DAC is ${6N}\mathrm{\;{dB}}$ . The dynamic range can be thought of as the amplitude range necessary to resolve $N$ -bits, regardless of the amplitude of the output voltage. However, when referenced to a given output analog signal amplitude, the dynamic range required must include ${1.76}\mathrm{\;{dB}}$ more to account for the presence of quantization noise. Thus, for a 10-bit DAC, the ${DR}$ is ${60.2}\mathrm{\;{dB}}$ . For a full scale rms output voltage, the signal must be approximately ${62}\mathrm{\;{dB}}$ above whatever rms voltage level is present in the output of the DAC. This rms voltage could be due to the noise of the op amps and switches or due to the nonlinearity of the op amp.
For each digital word, there should be a unique analog output signal. Any deviations from Fig. 9.1-4 fall into the category of static-conversion errors. Static-conversion errors include offset errors, gain errors, integral nonlinearity, differential nonlinearity, and monotonicity. An offset error is a constant difference between the actual finite resolution characteristic and the ideal finite resolution characteristic measured at any vertical jump. This error is illustrated in Fig. 9.1-6(a). This error could be eliminated by shifting the resulting characteristic vertically. Gain error is the difference between the actual finite resolution and an infinite resolution characteristic measured at the rightmost vertical jump. Gain error is proportional to the magnitude of the DAC output voltage. This error is illustrated on the 3-bit DAC characteristic shown in Fig. 9.1-6(b).

Figure 9.1-6 (a) Illustration of offset error in a 3-bit DAC. (b) Illustration of gain error in a 3-bit DAC.
Integral nonlinearity (INL) is the maximum difference between the actual finite resolution characteristic and the ideal finite resolution characteristic measured vertically. Integral nonlinearity can be expressed as a percentage of the full scale range or in terms of the least significant bit. Integral nonlinearity has several subcategories, which include absolute, best-straight-line, and end-point linearity [2]. The INL of a 3-bit DAC characteristic is illustrated in Fig. 9.1-7. The INL of an $N$ -bit DAC can be expressed as a positive ${INL}$ and a negative ${INL}$ . The positive ${INL}$ is the maximum positive ${INL}$ . The negative ${INL}$ is the maximum negative ${INL}$ . In Fig. 9.1-7, the maximum $+ {INL}$ is ${1.5LSBs}$ and the maximum $- {INL}$ is $- {1.0LSB}$ .
Differential nonlinearity(DNL)is a measure of the separation between adjacent levels measured at each vertical jump. Differential nonlinearity measures bit-to-bit deviations from ideal output steps, rather than along the entire output range. If ${V}_{cx}$ is the actual voltage change on a bit-to-bit basis and ${V}_{s}$ is the ideal change, then the differential nonlinearity can be expressed as
Differential nonlinearity $\left( {DNL}\right)  = \left( {{V}_{cx} - {V}_{s}}\right)  = \left( \frac{{V}_{cx} - {V}_{s}}{{V}_{s}}\right) {V}_{s} = \left( {\frac{{V}_{cx}}{{V}_{s}} - 1}\right) {LSBs}$(9.1-15)
For an $N$ -bit DAC and a full scale voltage range of ${V}_{FSR}$ ,
$$
{V}_{s} = \frac{{V}_{FSR}}{{2}^{N}} \tag{9.1-16}
$$
Figure 9.1-7 also illustrates differential nonlinearity. Note that ${DNL}$ is a measure of the step size and is totally independent of how far the actual step change may be away from the infinite resolution characteristic at the jump. The change from 101 to 110 results in a maximum $+ {DNL}$ of ${1.5LSBs}\left( {{V}_{cx}/{V}_{s} = {2.5LSBs}}\right)$ . The maximum negative ${DNL}$ is found when the digital input code changes from 011 to 100. The change is $- {0.5}\mathrm{{LSB}}\left( {{V}_{cx}/{V}_{s} =  - {0.5}\mathrm{{LSB}}}\right)$ , which gives a ${DNL}$ of $- {1.5LSBs}$ . It is of interest to note that as the digital input code changes from 100 to 101, no change occurs (point $A$ ). Because we know that a change should have occurred, we can say that the ${DNL}$ at point $A$ is $- {1LSB}$ .

Figure 9.1-7 Illustration of INL, ${DNL}$ , and nonmonotonicity in a 3-bit DAC.
Monotonicity in a DAC means that as the digital input to the converter increases over its full scale range, the analog output never exhibits a decrease between one conversion step and the next. In other words, the slope of the transfer characteristic is never negative in a monotonic converter. Figure 9.1-7 exhibited nonmonotonic behavior as the digital input code changed from 011 to 100. Obviously, a nonmonotonic DAC has very poor ${DNL}$ . As a matter of fact, a DAC that has a $- {DNL}$ that is $- {1LSB}$ or more negative will always be nonmonotonic.
A very important consideration of both a digital-analog and an analog-digital converter is the accuracy requirements of the $i$ th-bit. The output value of the $i$ th-bit in ${LSBs}$ is given as
$$
\text{Output of the}i\text{th-bit} = \frac{{V}_{REF}}{{2}^{i + 1}}\left( \frac{{2}^{N}}{{2}^{N}}\right)  = {2}^{N - i - 1}{LSBs} \tag{9.1-17}
$$
where ${V}_{REF}/{2}^{N}$ is an ${LSB}$ . The uncertainty allowed for each bit assuming all other bits are ideal is $\pm  {0.5LSB}$ . The uncertainty allowable would only be $\pm  {0.25LSB}$ if each bit had a worst-case error. The accuracy of the $i$ th-bit can be found by dividing the uncertainty by the output, giving
$$
\text{Accuracy of the}i\text{th-bit} = \frac{\pm {0.5LSB}}{{2}^{N - i - 1}{LSB}} = \frac{1}{{2}^{N - i}} = \frac{100}{{2}^{N - i}}\%  \tag{9.1-18}
$$
We see an important result and that is that the ${MSB}\left( {i = 0}\right)$ has the highest accuracy requirement and the ${LSB}\left( {i = N - 1}\right)$ the least accuracy requirement. In a 10-bit converter, the ${MSB}$ bit must have the accuracy of ${100}/{1024} \approx  {0.1}\%$ and the ${LSB}$ bit only needs $\pm  {50}\%$ accuracy.
Table 9.1-1 gives the accuracy requirements for each bit of a 16-bit converter assuming all other bits are ideal. Under worst-case conditions, the accuracy should be divided by 2 . This table shows that as the number of bits increases, the difficulty in realizing the ${MSB}$ bits also increases. Under normal design practices, converters with more than 8 bits become challenging to maintain $\pm  {0.5}\mathrm{{LSB}}$ accuracy in the $\mathrm{{MSB}}$ bits.
Table 9.1-1 Accuracy Requirements for a 16-bit Converter
<table><tr><td>Bit Number (i)</td><td>Accuracy if Other Bits Are Ideal</td><td>Accuracy if Other Bits Are Worst Case</td></tr><tr><td>0</td><td>0.0015%</td><td>0.0008%</td></tr><tr><td>1</td><td>0.0031%</td><td>0.0015%</td></tr><tr><td>2</td><td>0.0061%</td><td>0.0031%</td></tr><tr><td>3</td><td>0.0122%</td><td>0.0061%</td></tr><tr><td>4</td><td>0.0244%</td><td>0.0122%</td></tr><tr><td>5</td><td>0.0488%</td><td>0.0244%</td></tr><tr><td>6</td><td>0.0977%</td><td>0.0488%</td></tr><tr><td>7</td><td>0.1953%</td><td>0.0977%</td></tr><tr><td>8</td><td>0.3906%</td><td>0.1953%</td></tr><tr><td>9</td><td>0.7813%</td><td>0.3906%</td></tr><tr><td>10</td><td>1.5625%</td><td>0.7813%</td></tr><tr><td>11</td><td>3.125%</td><td>1.5625%</td></tr><tr><td>12</td><td>6.25%</td><td>3.125%</td></tr><tr><td>13</td><td>12.5%</td><td>6.25%</td></tr><tr><td>14</td><td>25%</td><td>12.5%</td></tr><tr><td>15</td><td>50%</td><td>25%</td></tr></table>
---
Example 9.1-1
---
## INL and DNL of a Nonideal 4-bit DAC
The transfer characteristics of an ideal and actual 4-bit DAC are shown in Fig. 9.1-8. Find the $\pm  {INL}$ and $\pm  {DNL}$ in terms of ${LSBs}$ . Is the converter monotonic or not?

Figure 9.1-8 The 4-bit DAC characteristics for Example 9.1-1.
## SOLUTION
The worst-case ${INL}$ and ${DNL}$ errors are shown on Fig. 9.1-8. For this example, $+ {INL} =$ ${1.5}{LSBs}, - {INL} =  - {{1.5}{LSBs}}, + {DNL} = {{1.5}{LSBs}}$ , and $- {DNL} =  - {2{LSBs}}$ . This DAC is not monotonic.
## Dynamic Characteristics of DACs
The above considerations of the DAC have been time-independent or static. The time-dependent or dynamic characteristics are also an important part of the characterization of the DAC. The primary dynamic characteristic of the DAC is the conversion speed. The conversion speed is the time it takes for the DAC to provide an analog output when the digital input word is changed. The conversion speed may vary from milliseconds to nanoseconds depending on the type of DAC.
The factors that determine the speed of the DAC are the parasitic capacitors and the gain bandwidth and slew rate of op amps, if they are used. Parasitic capacitors exist at every node in a circuit (particularly an integrated circuit). If the node is a high-resistance node, then a pole results that is equal to the negative reciprocal of the product of the resistance to ground and the capacitance to ground. Fortunately, most nodes are not high-resistance nodes. Such nodes include the input node (driven by a voltage source), the negative input node of an op amp in the inverting configuration, and the output node of the op amp with feedback.
The op amp can impact the DAC performance from both static and dynamic viewpoints. The gain error of an op amp is the difference between the desired and actual output voltage of the op amp and is due to a finite value of ${A}_{vd}\left( 0\right)$ . In Appendix E we showed that, for the inverting amplifier using resistors or capacitors, the closed-loop gain for a finite value of ${A}_{vd}\left( 0\right)$ was expressed as
$$
\frac{{V}_{\text{out }}}{{V}_{\text{in }}} =  - \left( \frac{{R}_{2}}{{R}_{1}}\right) \frac{\left| LG\right| }{1 + \left| {LG}\right| } =  - \left( \frac{{C}_{1}}{{C}_{2}}\right) \frac{\left| LG\right| }{1 + \left| {LG}\right| } \tag{9.1-19}
$$
If the loop gain, ${LG}$ , is not infinite, then an error exists between the desired output, ${V}_{\text{out }}$ , and the actual output, ${V}_{\text{out }}^{\prime }$ . We can define a gain error for the op amp in the inverting configuration for identical inputs as
$$
\text{ Gain error } = \frac{{V}_{\text{out }} - {V}_{\text{out }}^{\prime }}{{V}_{\text{out }}} = 1 - \frac{\left| LG\right| }{1 + \left| {LG}\right| } = \frac{1}{1 + \left| {LG}\right| } \tag{9.1-20}
$$
Let us consider an example to illustrate the influence of the gain error on the DAC.
---
Example 9.1-2
---
## Influence of Op Amp Gain Error on DAC Performance
Assume that a DAC uses an op amp in the inverting configuration with ${C}_{1} = {C}_{2}$ and ${A}_{vd}\left( 0\right)  =$ 1000. Find the largest resolution of the DAC if ${V}_{\mathrm{{REF}}}$ is $1\mathrm{\;V}$ and assuming worst-case conditions.
## SOLUTION
The loop gain of the inverting configuration is $\left| {LG}\right|  = {0.5} \cdot  {1000} = {500}$ . The gain error is therefore $1/{501} \approx  {0.002}$ . The gain error should be less than $\pm  {0.5}\mathrm{{LSB}}$ , which is expressed as
$$
\text{ Gain error } = \frac{1}{501} \approx  {0.002} \leq  \frac{{V}_{\mathrm{{REF}}}}{{2}^{N + 1}}
$$
The largest value of $N$ that satisfies this equation is $N = 7$ .
The dynamic impact of the op amp on the DAC performance can come from the unity-gain bandwidth(GB), the settling time, and the slew rate. In Chapter 6 we learned that the settling time is closely related to the unity-gain bandwidth depending on the roots of the closed-loop response (see Appendix D). If the system is overdamped, then ${GB}$ determines the speed of the op amp and the response for an op amp with a single dominant pole to a step input voltage could be expressed as
$$
{v}_{\text{out }}\left( t\right)  = {A}_{CL}\left\lbrack  {1 - {e}^{-{\omega }_{H}t}}\right\rbrack  {v}_{\text{in }}\left( t\right)  \tag{9.1-21}
$$
where ${A}_{CL}$ is the closed-loop gain of the op amp amplifier and ${\omega }_{H}$ is the upper $- 3\mathrm{\;{dB}}$ frequency defined in Appendix E. In order to avoid errors, the overdamped output voltage given by Eq. (9.1-21) must be within 0.5LSB of the final value by the end of the conversion time.
On the other hand, if the system is underdamped, the step response has an oscillatory behavior after the initial step rise. The oscillatory behavior of the output voltage must decrease to within $\pm  {0.5}\mathrm{{LSB}}$ at the end of the conversion time or an error will result. The discussion and plots in Appendix D allow the influence of the settling time of the op amp to be evaluated.
Finally, if the rate of voltage change at the output of the op amp exceeds the slew rate, then the output will be slew limited. For example, if the slew rate of an op amp is $1\mathrm{\;V}/\mu \mathrm{s}$ and the output change is $1\mathrm{\;V}$ , the conversion time could be no less than ${1\mu }\mathrm{s}$ .
---
Example 9.1-3
---
## Influence of Op Amp GB and Settling Time on DAC Performance
Assume that a DAC uses a switched capacitor noninverting amplifier with ${C}_{1} = {C}_{2}$ and ${GB} = 1\mathrm{{MHz}}$ . Find the conversion time of an8-bit DAC if ${V}_{\mathrm{{REF}}}$ is $1\mathrm{\;V}$ .
## SOLUTION
From the analysis in Appendix E, we know that ${\omega }_{H}$ is $\left( {2\pi }\right) \left( {0.5}\right) \left( {10}^{6}\right)  = {3.141} \times  {10}^{6}$ and ${A}_{CL} = 1$ . Assume that the ideal output is equal to ${V}_{\mathrm{{REF}}}$ . Therefore, the value of the output voltage, which is ${0.5}\mathrm{{LSB}}$ of ${V}_{\mathrm{{REF}}}$ , is
$$
1 - \frac{1}{{2}^{N + 1}} = 1 - {e}^{-{\omega }_{H}T}
$$
or
$$
{2}^{N + 1} = {e}^{{\omega }_{H}T}
$$
Solving for $T$ gives
$$
T = \left( \frac{N + 1}{{\omega }_{H}}\right) \ln \left( 2\right)  = {0.693}\left( \frac{N + 1}{{\omega }_{H}}\right)  = \left( \frac{9 \times  {10}^{-6}}{3.141}\right) {0.693} = {1.986\mu }\mathrm{s}
$$
## Testing of DACs
The objective in testing the DAC is to verify the static and dynamic characteristics. A good method of examining the static performance of the DAC is called the input-output test. This test requires the availability of an accurate analog-digital converter (ADC). The test configuration is shown in Fig. 9.1-9. The digital input word of $N + 2$ -bits is stepped from 000 . . . 0 to 111 . . . 1 and applied to the DAC under test and the digital subtractor. The DAC converts $N$ -bits of the digital input word to an analog voltage, ${V}_{\text{out }}$ , that is applied to the ADC. The output of the ADC is applied to the digital subtractor. It is crucial that the ADC have at least one more bit of resolution than the DAC so that its errors will not influence the test. It is a good practice for the ADC to be 2-bits more accurate than the DAC. Ideally, the digital error output should be 000 . . . 0 to the resolution of the DAC under test. INL will show up in the digital output as the presence of 1 ’s in any bit. If there is a 1 in the $N$ th-bit, the INL is greater than $\pm  {0.5}\mathrm{{LSB}}.\mathrm{{DNL}}$ will show up as a change between each successive digital error output. The extra bits of the ADC can be used to resolve the errors less than $\pm  {0.5LSB}$ .
Another test for the DAC uses the spectral output of the DAC [3]. This test does not require the use of a more accurate ADC. Figure 9.1-10 shows a digital pattern generator applied to the DAC under test. The output of the DAC under test is applied to the spectrum analyzer. A digital input pattern that is designed to have a dominant fundamental frequency is applied to the input of the DAC. It is important that the magnitude of the fundamental frequency of this pattern be at least ${6N}\mathrm{\;{dB}}$ above any of the harmonics, where $N$ is the resolution of the DAC under test. Such a pattern could be a sinusoid implemented by a repeating sequence of $N$ -bit digital words. The length of the sequence determines the purity of the fundamental frequency. The output of the DAC under test is applied to equipment that can measure the harmonics of the analog output such as a distortion analyzer. If the total harmonic distortion (THD) is less than ${6N}\mathrm{\;{dB}}$ below the fundamental, then the INL and DNL of the DAC under test is within $\pm  {0.5}\mathrm{{LSB}}$ .
A very important consideration in the design of the DAC is illustrated by the spectral test of Fig. 9.1-10. If the noise of the reference voltage, ${V}_{\mathrm{{REF}}}$ , is not small enough, this noise, which is present on the output of the DAC under test, may limit the dynamic range of the DAC. The spectral test of Fig. 9.1-10 can also be used for dynamic testing of the DAC. If the period of the digital pattern is decreased, then the effective signal frequency, ${f}_{sig}$ , is increased. Eventually, the noise floor of the spectral output will increase due to the frequency dependence of the DAC. The SNR determined from this measurement will give the effective number of bits (ENOB).

Figure 9.1-9 Input-output test for a DAC.

Figure 9.1-10 Spectral output test for a DAC.

### 9.2 Parallel Digital-Analog Converters
Digital-analog converters can be categorized by how long it takes to perform the conversion or by how the binary scaling of the reference is accomplished. Figure 9.2-1 shows a classification for DACs that will be used to organize the presentation of this and the next two sections. DACs can be serial or parallel. Serial DACs convert the analog output one bit at a time and therefore require a conversion time of ${NT}$ , where $N$ is the number of bits and $T$ is time for conversion of 1-bit. Parallel DACs convert all bits at the same time so that the total conversion time becomes $T$ . A further classification is by the scaling methods. Three methods are called current scaling, voltage scaling, and charge scaling. Next, we examine these scaling methods for the parallel DACs.
## Current Scaling DACs
Current scaling DACs typically convert the reference voltage, ${V}_{\mathrm{{REF}}}$ , to a set of binary-weighted currents. The currents are generally applied to an op amp in the inverting configuration to create the analog output voltage, ${v}_{\mathrm{{OUT}}}$ , shown in Fig. 9.2-2. The output voltage can be expressed as
$$
{v}_{\mathrm{{OUT}}} =  - {R}_{F}\left( {{I}_{0} + {I}_{1} + {I}_{2} + \cdots  + {I}_{N - 1}}\right)  \tag{9.2-1}
$$
where the currents ${I}_{0},{I}_{1},{I}_{2},\ldots$ are binary-weighted currents.

Figure 9.2-1 Classification of digital-analog converters.

Figure 9.2-2 General current scaling DAC.
The first implementation of a current scaled DAC is shown in Fig. 9.2-3. The scaling network consists of $N$ binary weighted resistors connected between the minus input terminal of the op amp and to ${V}_{\mathrm{{REF}}}$ or ground depending on whether the digital bit is 1 or 0, respectively. The op amp feedback resistor, ${R}_{F}$ , can be used to scale the gain of the DAC and is chosen as ${KR}/2$ , where $K$ is the gain of the DAC. The analog output voltage can be found as
$$
{v}_{\mathrm{{OUT}}} =  - {R}_{F}{i}_{\mathrm{{OUT}}} = \frac{-{KR}}{2}\left( {\frac{{b}_{0}}{R} + \frac{{b}_{1}}{2R} + \frac{{b}_{2}}{4R} + \cdots  + \frac{{b}_{N - 1}}{{2}^{N - 1}R}}\right) {V}_{\mathrm{{REF}}} \tag{9.2-2}
$$
where ${b}_{i}$ is 1 if switch ${S}_{i}$ is connected to ${V}_{\mathrm{{REF}}}$ or 0 if switch ${S}_{i}$ is connected to ground. $K$ can be used to scale the gain of the DAC. Equation (9.2-2) can be expressed as
$$
{v}_{\mathrm{{OUT}}} =  - K\left( {\frac{{b}_{0}}{2} + \frac{{b}_{1}}{4} + \frac{{b}_{2}}{8} + \cdots  + \frac{{b}_{N - 1}}{{2}^{N}}}\right) {V}_{\mathrm{{REF}}} \tag{9.2-3}
$$
The binary-weighted resistor DAC of Fig. 9.2-3 is a straightforward application of an inverting summing amplifier. One of the advantages of this DAC is that it is insensitive to parasitic capacitors and is therefore fast. A disadvantage of this DAC is the requirement for resistors with a large value spread. If the resistor for the ${MSB}$ is designated as ${R}_{MSB}$ and the resistor for the ${LSB}$ is designated as ${R}_{LSB}$ , then the component value spread can be expressed as
$$
\frac{{R}_{MSB}}{{R}_{LSB}} = \frac{R}{{2}^{N - 1}R} = \frac{1}{{2}^{N - 1}} \tag{9.2-4}
$$
For example, if $N = 8$ , the component value spread would be $1/{128}$ . A large component spread leads to poorer matching between the various resistors. If $N$ is large, precision resistors or trimming would be required for the ${MSB}$ resistors. In addition to the large component value spread, the binary-weighted resistor DAC may be nonmonotonic. If the ${MSB}$ resistors do not have an accuracy of $\pm  {0.5}\mathrm{{LSB}}$ , then when these bits are switched in or out of the DAC, a ${DNL}$ exceeding -1 ${LSB}$ can occur, which leads to nonmonotonicity.

Figure 9.2-3 Binary-weighted resistor DAC implementation.
The requirement for a large component spread in the DAC of Fig. 9.2-3 can be entirely eliminated by the use of an $R - {2R}$ ladder. The $R - {2R}$ ladder only uses resistors of value $R$ and value ${2R}$ . Typically, three equal resistors are used to implement the $R - {2R}$ ladder. If the value is $R$ , then the ${2R}$ resistor consists of the series combination of two $R$ resistors. If the value is ${2R}$ , then the $R$ resistor consists of the parallel combination of two ${2R}$ resistors. The $R - {2R}$ resistor implementation of Fig. 9.2-3 is shown in Fig. 9.2-4. The key to understanding how the $R - {2R}$ ladder works is the fact that "the resistance seen to the right of any of the vertical ${2R}$ resistors is ${2R}$ ." This fact causes the currents to be reduced by a factor of 2 as the current flows from the leftmost vertical ${2R}$ to the rightmost vertical ${2R}$ . Thus, the currents in these resistors can be written as
$$
{I}_{0} = \frac{{V}_{\mathrm{{REF}}}}{2R},{I}_{1} = \frac{{V}_{\mathrm{{REF}}}}{4R},{I}_{2} = \frac{{V}_{\mathrm{{REF}}}}{8R},\ldots ,{I}_{N - 1} = \frac{{V}_{\mathrm{{REF}}}}{{2}^{N}R} \tag{9.2-5}
$$
If the bits are 1, these currents flow into the op amp summing node and create an output voltage given by Eq. (9.2-3). While the $R - {2R}$ ladder has eliminated the large component spread problem, floating nodes now exist in the $R - {2R}$ ladder. However, the current flowing through the resistors does not change as the switches are moved, keeping these nodes at a constant voltage. Therefore, this DAC is as fast as the binary-weighted resistor DAC of Fig. 9.2-3.
A third current scaling DAC uses binary-weighted current sinks and is shown in Fig. 9.2-5. The currents are weighted by the $W/L$ values of the MOSFETs. The matching accuracy of MOSFETs depends on size and the ratio of $W/L$ values. Typically, the accuracy is as good as resistors if not better. A good way to implement the current sinks would be to make ${2}^{N}$ identical transistors with the sources and gates connected together. ${2}^{N - 1}$ transistors would be paralleled to form the ${MSB}$ current sink, ${2}^{N - 2}$ transistors would form the next ${MSB}$ , and so forth down to the ${LSB}$ , which would consist of a single MOSFET. This approach could be prohibitive at values of $N$ over 8 because the area required would be large unless the transistors were small. An increase in matching should be achieved if the transistors that form the current sinks are distributed (i.e., geometrically centered about the LSB transistor) over the array containing ${2}^{N}$ transistors. Additional accuracy could be obtained by using an array of $M{2}^{N}$ transistors, where $M$ transistors make up a single transistor of the ${2}^{N}$ transistor array.

Figure 9.2-4 $R - {2R}$ ladder implementation of the binary-weighted resistor DAC.

Figure 9.2-5 Current scaling using matched MOSFETs.
Looking more closely at Fig. 9.2-5, we see that the reference voltage is converted to a reference current, ${I}_{\mathrm{{REF}}}$ , by the $\mathrm{A}2$ op amp, ${R}_{1}$ , and the reference voltage, ${V}_{\mathrm{{REF}}}$ . This current can be expressed as
$$
{I}_{\mathrm{{REF}}} = \frac{{V}_{\mathrm{{REF}}}}{{R}_{1}} \tag{9.2-6}
$$
assuming that the A2 op amp has no dc offset. The A2 op amp provides the gate-source voltage, ${V}_{A}$ , for all of the FETs in the transistor array. Note that the positive input terminal of the A1 op amp is connected to ground, which keeps the drains of all transistors at the same voltage for better matching. ${I}_{\mathrm{{REF}}}$ is replicated in each of the FETs of the transistor array and should be identical to the current $I$ . The transistors are grouped to form the binary-weighted currents attached to the bottom terminal of the switches ${S}_{0},{S}_{1},{S}_{2},\ldots ,{S}_{N - 1}$ . Assuming that $I$ is equal to ${I}_{\mathrm{{REF}}}$ , the output voltage can be written as
$$
{v}_{\mathrm{{OUT}}} = {R}_{2}\left( {{b}_{N - 1} \cdot  I + {b}_{N - 2} \cdot  {2I} + {b}_{N - 3} \cdot  {4I} + \cdots  + {b}_{0} \cdot  {2}^{N - 1}I}\right)  \tag{9.2-7}
$$
If $I = {I}_{\mathrm{{REF}}} = {V}_{\mathrm{{REF}}}/{2}^{N}{R}_{2}$ , then
$$
{v}_{\mathrm{{OUT}}} = \left( {\frac{{b}_{0}}{2} + \frac{{b}_{1}}{4} + \frac{{b}_{2}}{8} + \cdots  + \frac{{b}_{N - 3}}{{2}^{N - 2}} + \frac{{b}_{N - 2}}{{2}^{N - 1}} + \frac{{b}_{N - 1}}{{2}^{N}}}\right) {V}_{\mathrm{{REF}}} \tag{9.2-8}
$$
The binary-weighted current sink of Fig. 9.2-5 should be fast because there are no floating nodes. The ratio of ${R}_{2}/{R}_{1}$ should be equal to ${2}^{N}$ . The FETs may be replaced by BJTs and equal resistances can be placed in series with the sources (emitters) to the output of A2 for improved matching. Other combinations of the $R - {2R}$ ladder networks and current sinks can be used to implement current scaling DACs [4,5].
## Voltage Scaling DACs
Voltage scaling DACs convert the reference voltage, ${V}_{\mathrm{{REF}}}$ , to a set of ${2}^{N}$ voltages that are decoded to a single analog output by the input digital word. A general block diagram for a voltage scaling DAC is shown in Fig. 9.2-6. The decoder network simply connects one of the ${V}_{1},{V}_{2},\ldots ,{V}_{{2}^{N}}$ voltages to ${v}_{\text{OUT }}$ .
Voltage scaling normally uses series resistors connected between ${V}_{\mathrm{{REF}}}$ and ground to selectively obtain voltages between these limits. For an $N$ -bit converter, the resistor string would have at least ${2}^{N}$ segments. These segments can all be equal or the end segments may be partial values, depending on the requirements. Figure 9.2-7(a) shows a 3-bit voltage scaling DAC. An op amp can be used to buffer the resistor string to prevent loading. Each tap is connected to a switching tree whose switches are controlled by the bits of the digital word. If the $i$ th-bit is 1, then the switches controlled by ${b}_{i}$ are closed. If the $i$ th-bit is 0, then the switches controlled by ${b}_{i}$ are open.

Figure 9.2-6 General voltage scaling DAC.
The voltage scaling DAC of Fig. 9.2-7(a) works as follows. Suppose that the digital word to be converted is ${b}_{0} = 1,{b}_{1} = 0$ , and ${b}_{2} = 1\left( {b}_{0}\right.$ is the ${MSB}$ and ${b}_{2}$ is the $\left. {LSB}\right)$ . Following the sequence of switches, we see that ${v}_{\mathrm{{OUT}}}$ is equal to ${11}/{16}$ of ${V}_{\mathrm{{REF}}}$ . In general, the voltage at any tap $n$ of Fig. 9.2-7(a) can be expressed as
$$
{v}_{\mathrm{{OUT}} = }\frac{{V}_{\mathrm{{REF}}}}{8}\left( {n - {0.5}}\right)  = \frac{{V}_{\mathrm{{REF}}}}{16}\left( {{2n} - 1}\right)  \tag{9.2-9}
$$
Figure 9.2-7(b) shows the input-output characteristics of the DAC of Fig. 9.2-7(a).

Figure 9.2-7 (a) Implementation of a 3-bit voltage scaling DAC. (b) Input-output characteristics of (a).
If the number of bits is large, then one can use the configuration shown in Fig. 9.2-8. Here a single switch is connected between each node of the resistor string and the output. Which switch is closed depends on the logic circuit, which will consist of an $N$ -to- ${2}^{N}$ decoder or similar circuitry. This configuration reduces the series resistance of the switches and the effect of the parasitic capacitances at each switch node to ground. An area-performance tradeoff may be made, resulting in some bits being determined directly by the switch decoder and the rest indirectly by the logic decoder.
It is seen that the voltage scaling DAC structure is very regular and thus well suited for MOS technology. An advantage of this architecture is that it guarantees monotonicity, for the voltage at each tap cannot be less than the tap below. The area required for the voltage scaling DAC is large if the number of bits is eight or more. Also, the conversion speed of the converter will be sensitive to parasitic capacitances at each of its internal nodes.
The integral and differential nonlinearity of the voltage scaling DAC can be derived by assuming a worst-case approach. First, consider the integral nonlinearity, INL. For an $N$ -bit voltage scaling DAC, there are ${2}^{N}$ resistors between ${V}_{\mathrm{{REF}}}$ and ground. Assume that the ${2}^{N}$ resistors are numbered from 1 to ${2}^{N}$ beginning with the resistor connected to ${V}_{\text{REF }}$ and ending with the resistor connected to ground. The voltage at the $i$ th resistor from the top can be written as
$$
{v}_{i} = \frac{\left( {{2}^{N} - i}\right) R}{\left( {{2}^{N} - i}\right) R + {iR}}{V}_{\text{REF }} \tag{9.2-10}
$$
where the ${iR}$ resistors are above the voltage ${v}_{i}$ , and the ${2}^{N} - i$ resistors are below ${v}_{i}$ . Assume that the worst-case ${INL}$ for the voltage scaling DAC is found at the midpoint, where $i = {2}^{N - 1}$ , and the resistors below the midpoint are all maximum positive and the resistors above the midpoint are all maximum negative (or vice versa).

Figure 9.2-8 Alternate realization of Fig. 9.2-7(a).
Let us assume that the ${2}^{N}$ resistors have a tolerance of $\pm  {\Delta R}/R$ . We can define the maximum value of $R$ as
$$
{R}_{\max } = R + {\Delta R} \tag{9.2-11}
$$
and the minimum value of $R$ as
$$
{R}_{\min } = R - {\Delta R} \tag{9.2-12}
$$
The worst-case ${INL}$ can be found as the difference between the actual and the ideal voltage at the midpoint, where the resistors below are all maximum positive and the resistors above the midpoint are all maximum negative. Thus,
$$
{INL} = {v}_{{2}^{N - 1}}\left( \text{actual}\right)  - {v}_{{2}^{N - 1}}\left( \text{ideal}\right)
$$
$$
= \frac{{2}^{N - 1}\left( {R + {\Delta R}}\right) {V}_{\mathrm{{REF}}}}{{2}^{N - 1}\left( {R + {\Delta R}}\right)  + {2}^{N - 1}\left( {R - {\Delta R}}\right) } - \frac{{V}_{\mathrm{{REF}}}}{2} = \frac{\Delta R}{2R}{V}_{\mathrm{{REF}}} \tag{9.2-13}
$$
or
$$
{INL} = \frac{{2}^{N}}{{2}^{N}}\left( \frac{\Delta R}{2R}\right) {V}_{\mathrm{{REF}}} = {2}^{N - 1}\left( \frac{\Delta R}{R}\right) \left( \frac{{V}_{\mathrm{{REF}}}}{{2}^{N}}\right)  = {2}^{N - 1}\left( \frac{\Delta R}{R}\right) {LSBs} \tag{9.2-14}
$$
The worst-case ${DNL}$ can be found as the maximum step size minus the ideal step size normalized to the ideal step size. This can be expressed as
$$
{DNL} = {v}_{\text{step }}\left( \text{actual}\right)  - {v}_{\text{step }}\left( \text{ideal}\right)  = \left( \frac{{v}_{\text{step }}\left( \text{actual}\right)  - {v}_{\text{step }}\left( \text{ideal}\right) }{{v}_{\text{step }}\left( \text{ideal}\right) }\right) {v}_{\text{step }}\left( \text{ideal}\right)
$$
$$
= \frac{{v}_{\text{step }}}{{v}_{\text{step }}}\left( \text{ ideal }\right)  - {1LSBs} = \frac{\frac{\left( {R \pm  {\Delta R}}\right) {V}_{\text{REF }}}{{2}^{N}R}}{\frac{R{V}_{\text{REF }}}{{2}^{N}R}} - 1 = \frac{R \pm  {\Delta R}}{R} - 1
$$
$$
= \frac{\pm {\Delta R}}{R}{LSBs} \tag{9.2-15}
$$
The following example will illustrate the application of the above concepts.
Example
## Accuracy Requirements of a Voltage Scaling DAC
9.2-1
If the resistor string of the voltage scaling DAC of Fig. 9.2-7(a) is a ${5\mu }\mathrm{m}$ wide polysilicon strip having a relative accuracy of $\pm  1\%$ , what is the largest number of bits that can be resolved and keep the worst-case ${INL}$ within $\pm  {0.5LSB}$ ? For this number of bits, what is the worst-case ${DNL}$ ? SOLUTION
From Eq. (9.2-14), we can write that
$$
{2}^{N - 1}\left( \frac{\Delta R}{R}\right)  = {2}^{N - 1}\left( \frac{1}{100}\right)  \leq  \frac{1}{2}
$$
This inequality can be simplified as
$$
{2}^{N} \leq  {100}
$$
which has a solution of $N = 6$ . The value of the ${DNL}$ for $N = 6$ is found from Eq. (9.2-15) as
$$
{DNL} = \frac{\pm 1}{100}{LSBs} =  \pm  {0.01LSB}
$$
## Charge Scaling DACs
Charge scaling DACs operate by binarily dividing the total charge applied to a capacitor array. This process is implemented by using capacitors to attenuate the reference voltage as suggested by Fig. 9.2-9. The configuration is extremely simple and is in effect a digitally controlled voltage attenuator. Another advantage of the charge scaling DAC is that it is compatible with switched capacitor circuits.
Figure 9.2-10 shows the general implementation of a charge scaling DAC. A two-phase, nonoverlapping clock is used for this converter. During ${\phi }_{1}$ the top and bottom plates of all capacitors in the array are grounded. Next, during ${\phi }_{2}$ , the capacitors associated with bits that are 1 are connected to ${V}_{\mathrm{{REF}}}$ and those with bits that are 0 are connected to ground. The output of the DAC is valid during ${\phi }_{2}$ .
The resulting situation can be described by equating the charge in the capacitors connected to ${V}_{\mathrm{{REF}}}\left( {C}_{\mathrm{{eq}}}\right)$ to the charge in the total capacitors $\left( {C}_{\mathrm{{tot}}}\right)$ . This is expressed as
$$
{V}_{\mathrm{{REF}}}{C}_{\mathrm{{eq}}} = {V}_{\mathrm{{REF}}}\left( {{b}_{0}C + \frac{{b}_{1}C}{2} + \frac{{b}_{2}C}{{2}^{2}} + \cdots  + \frac{{b}_{N - 1}C}{{2}^{N - 1}}}\right)  = {C}_{\mathrm{{tot}}}{v}_{\mathrm{{OUT}}} = {2C}{v}_{\mathrm{{OUT}}} \tag{9.2-16}
$$
From Eq. (9.2-16) we may solve for ${v}_{\text{OUT }}$ as
$$
{v}_{\mathrm{{OUT}}} = \left\lbrack  {{b}_{0}{2}^{-1} + {b}_{1}{2}^{-2} + {b}_{2}{2}^{-3} + \cdots  + {b}_{N - 1}{2}^{-N}}\right\rbrack  {V}_{\mathrm{{REF}}} \tag{9.2-17}
$$

Figure 9.2-9 General charge scaling DAC.

Figure 9.2-10 Charge scaling DAC. All switches are connected to ground during ${\phi }_{1}$ . Switch ${S}_{i}$ closes to ${V}_{\text{REF }}$ if ${b}_{i} = 1$ or to ground if ${b}_{i} = 0$ during ${\phi }_{2}$ .
Another approach to understanding Fig. 9.2-10 is to consider the capacitor array as a capacitive attenuator as illustrated in Fig. 9.2-11. As before ${C}_{\mathrm{{eq}}}$ consists of the sum of all capacitances connected to ${V}_{\mathrm{{REF}}}$ and ${2C} - {C}_{\mathrm{{eq}}}$ is the sum of all the capacitors in the array connected to ground.
The DAC of Fig. 9.2-10 can have bipolar operation if the bottom plates of all array capacitors are connected to ${V}_{\mathrm{{REF}}}$ during ${\phi }_{1}$ . During ${\phi }_{2}$ , the bottom plate of a capacitor is connected to ground for ${b}_{i} = 1$ or connected to ${V}_{\mathrm{{REF}}}$ for ${b}_{i} = 0$ . The resulting output voltage is
$$
{v}_{\mathrm{{OUT}}} = \left\lbrack  {{b}_{0}{2}^{-1} + {b}_{1}{2}^{-2} + {b}_{2}{2}^{-3} + \cdots  + {b}_{N - 1}{2}^{-N}}\right\rbrack  \left( {-{V}_{\mathrm{{REF}}}}\right)  \tag{9.2-18}
$$
The decision to connect all capacitors to ground or to ${V}_{\mathrm{{REF}}}$ will require an additional bit called a sign bit. By including a sign bit, bipolar behavior for the digital word $D$ will be obtained. If ${V}_{\mathrm{{REF}}}$ is also bipolar then a four-quadrant DAC converter results.
The integral and differential nonlinearity of the charge scaling DAC can be derived by again assuming a worst-case approach. First, consider the integral nonlinearity, INL. For an $N$ -bit charge scaling DAC, there are $N$ binary-weighted capacitors ranging from $C$ to $C/{2}^{N - 1}$ . The ideal output when the $i$ th capacitor only is connected to ${V}_{\mathrm{{REF}}}$ is
$$
{v}_{\mathrm{{OUT}}}\left( \text{ ideal }\right)  = \frac{C/{2}^{i - 1}}{2C}{V}_{\mathrm{{REF}}} = \frac{{V}_{\mathrm{{REF}}}}{{2}^{i}}\left( \frac{{2}^{N}}{{2}^{N}}\right)  = \frac{{2}^{N}}{{2}^{i}}{LSBs} \tag{9.2-19}
$$
As before, let us assume that the capacitors have a tolerance of $\pm  {\Delta C}/C$ . Therefore, the maximum value of $C$ can be expressed as
$$
{C}_{\max } = C + {\Delta C} \tag{9.2-20}
$$

Figure 9.2-11 Equivalent circuit of Fig. 9.2-10.
and the minimum value of $C$ is
$$
{C}_{\min } = C - {\Delta C} \tag{9.2-21}
$$
The actual worst-case output for the $i$ th capacitor is given as
$$
{v}_{\mathrm{{OUT}}}\left( \text{actual}\right)  = \frac{\left( {C \pm  {\Delta C}}\right) /{2}^{i - 1}}{2C}{V}_{\mathrm{{REF}}} = \frac{{V}_{\mathrm{{REF}}}}{{2}^{i}} \pm  \frac{{\Delta C} \cdot  {V}_{\mathrm{{REF}}}}{{2}^{i}C} = \frac{{2}^{N}}{{2}^{i}} \pm  \frac{{2}^{N}{\Delta C}}{{2}^{i}C}{LSBs} \tag{9.2-22}
$$
The INL for the $i$ th-bit is given as
$$
{INL}\left( i\right)  = {v}_{\mathrm{{OUT}}}\left( \text{actual}\right)  - {v}_{\mathrm{{OUT}}}\left( \text{ideal}\right)  = \frac{\pm {2}^{N}{\Delta C}}{{2}^{i}C} = \frac{\pm {2}^{N - i}{\Delta C}}{C}{LSBs} \tag{9.2-23}
$$
Typically, the worst-case value of $i$ occurs for $i = 1$ . Therefore, the worst-case ${INL}$ is
$$
{INL} =  \pm  {2}^{N - 1}\frac{\Delta C}{C}{LSBs} \tag{9.2-24}
$$
The worst-case ${DNL}$ for the binary-weighted capacitor array is found when the ${MSB}$ changes. Using Fig. 9.2-11, we can express the output voltage of the binary-weighted capacitor as
$$
{v}_{\mathrm{{OUT}}} = \frac{{C}_{\mathrm{{eq}}}}{\left( {{2C} - {C}_{\mathrm{{eq}}}}\right)  + {C}_{\mathrm{{eq}}}}{V}_{\mathrm{{REF}}} \tag{9.2-25}
$$
where ${C}_{\mathrm{{eq}}}$ represents the capacitors whose bits are 1 and $\left( {{2C} - {C}_{\mathrm{{eq}}}}\right)$ represents the capacitors whose bits are 0 . The worst-case ${DNL}$ can be expressed as
$$
{DNL} = \frac{{v}_{\text{step }}\text{ (worst case) }}{{v}_{\text{step }}\text{ (ideal) }} - 1 = \frac{{v}_{\text{OUT }}\left( {{1000}\ldots .}\right)  - {v}_{\text{OUT }}\left( {{0111}\ldots .}\right) }{LSB} - 1
$$
$$
= \frac{\left( \frac{C + {\Delta C}}{\left( {C + {\Delta C}}\right)  + \left( {C - {\Delta C}}\right) }\right) {V}_{\mathrm{{REF}}} - \left( \frac{\left( {C - {\Delta C}}\right) \left( {1 - \frac{2}{{2}^{N}}}\right) }{\left( {C + {\Delta C}}\right)  + \left( {C - {\Delta C}}\right) }\right) {V}_{\mathrm{{REF}}}}{\frac{{V}_{\mathrm{{REF}}}}{{2}^{N}}} - 1 \tag{9.2-26}
$$
$$
= {2}^{N}\left( \frac{C + {\Delta C}}{2C}\right)  - {2}^{N}\left( \frac{C - {\Delta C}}{2C}\right) \left( {1 - \frac{2}{{2}^{N}}}\right)  - 1 = \left( {{2}^{N} - 1}\right) \frac{\Delta C}{C}{LSBs}
$$
Equations (9.2-24) and (9.2-26) can be used to predict the worst-case ${INL}$ and ${DNL}$ for the binary-weighted capacitor array.
---
Example 9.2-2
---
## ${DNL}$ and ${INL}$ of a Binary-Weighted Capacitor Array DAC
If the tolerance of the capacitors in an 8-bit, binary-weighted, charge scaling DAC is $\pm  {0.5}\%$ , find the worst-case ${INL}$ and ${DNL}$ .
## SOLUTION
For the worst-case INL, Eq. (9.2-24) gives
$$
{INL} = \left( {2}^{7}\right) \left( {\pm {0.005}}\right)  =  \pm  {0.64LSB}
$$
For the worst-case ${DNL}$ , Eq. (9.2-26) gives
$$
{DNL} = \left( {{2}^{8} - 1}\right) \left( {\pm {0.005}}\right)  =  \pm  {1.275}\mathrm{{LSBs}}
$$
The accuracy of the capacitor and the area required are both factors that limit the number of bits used. The accuracy is seen to depend on the capacitor ratios. The ratio error for capacitors in MOS technology can be as low as ${0.1}\%$ . If the capacitor ratios were able to have this accuracy, then the DAC of Fig. 9.2-10 should be capable of a 10-bit resolution. However, this implies that the ratio between the ${MSB}$ and ${LSB}$ capacitors will be 512:1 in the extreme case, which is undesirable from an area viewpoint. Also, the 0.1% capacitor ratio accuracy is applicable only for ratios in the neighborhood of unity. As the ratio increases, the capacitor ratio accuracy decreases. These effects are considered in the following example.
---
Example 9.2-3
---
## Influence of Capacitor Ratio Accuracy on Number of Bits
Assume that the relative accuracy of capacitor ratios can be expressed as ${\Delta C}/C \cong  {0.001} +$ ${0.0001N}$ for a unit capacitor of ${50\mu }\mathrm{m}$ by ${50\mu }\mathrm{m}$ . Estimate the number of bits possible for a charge scaling DAC assuming a worst-case approach for ${INL}$ and that the worst conditions occur at the midscale (1MSB).
## SOLUTION
Assuming an INL of $\pm  {0.5}\mathrm{{LSB}}$ , we can write from Eq. (9.2-24) that
$$
{INL} =  \pm  {2}^{N - 1}\frac{\Delta C}{C} \leq   \pm  \frac{1}{2} \rightarrow  \left\lbrack  \frac{\Delta C}{C}\right\rbrack   \leq  \frac{1}{{2}^{N}}
$$
Solving for $N$ in the above equation gives approximately 10 -bits. However, the $\pm  {0.1}\%$ corresponds to small ratios of capacitors. In order to get a more accurate solution, we estimate the relative accuracy of capacitor ratios using the expression given.
Using this approximate relationship, a 9-bit DAC should be realizable.

Figure 9.2-12 Binary-weighted, charge amplifier DAC implementation.
We note that the charge scaling DAC of Fig. 9.2-10 requires a buffer amplifier to prevent the loading of the output of the DAC by the external circuit. An alternative charge scaling DAC using a single op amp is shown in Fig. 9.2-12. This DAC is essentially a binary-weighted charge amplifier. During the ${\phi }_{1}$ clock phase, all capacitors are discharged to zero volts (note that the binary-weighted array capacitors are autozeroed if the op amp has an offset voltage). During the ${\phi }_{2}$ clock phase, the switch labeled ${b}_{i}$ or ${\bar{b}}_{i}$ is closed, resulting in an output voltage expressed as
$$
{v}_{\mathrm{{OUT}}} = \frac{-K}{2C}\left( {{b}_{0}C + \frac{{b}_{1}C}{2} + \frac{{b}_{2}C}{4} + \cdots  + \frac{{b}_{N - 1}C}{{2}^{N - 1}}}\right) {V}_{\mathrm{{REF}}}
$$
$$
=  - K\left( {\frac{{b}_{0}}{2} + \frac{{b}_{1}}{4} + \frac{{b}_{2}}{8} + \cdots  + \frac{{b}_{N - 1}}{{2}^{N}}}\right) {V}_{\mathrm{{REF}}} \tag{9.2-27}
$$
The polarity of Fig. 9.2-12 can be changed by reversing the polarity of ${V}_{\mathrm{{REF}}}$ . Figure 9.2- 12 has the advantage over Fig. 9.2-10 of no floating nodes and therefore it should be faster. Another advantage would be that the binary-weighted capacitor DAC does not require a terminating capacitor to make the sum of the capacitors equal ${2C}$ . A disadvantage is the speed may be limited by the op amp.
This section has presented three different methods of implementing DACs. These methods were the current scaling, voltage scaling, and charge scaling DACs. Each of these approaches can be classified as a parallel DAC. A summary of their respective advantages and disadvantages is given in Table 9.2-1.
Table 9.2-1 Summary of the Performance of Parallel DACs
<table><tr><td>DAC Type</td><td>Advantage</td><td>Disadvantage</td></tr><tr><td>Current scaling</td><td>Fast, insensitive to switch parasitics</td><td>Large element spread, nonmonotonic</td></tr><tr><td>Voltage scaling</td><td>Monotonic, equal resistors</td><td>Large area, sensitive to parasitic capacitance</td></tr><tr><td>Charge scaling</td><td>Fast, good accuracy</td><td>Large element spread, nonmonotonic</td></tr></table>
### 9.3 Extending the Resolution of Parallel Digital-Analog Converters
A common problem in the parallel DAC implementation is the area required as the resolution of the DAC becomes large. In addition to the area required, the ratio of the value of the MSB component to the value of the LSB component becomes large. We know that the matching accuracy of components becomes less as the ratio of the largest to smallest components increases. Thus, in this section we will examine several techniques that allow a trade-off between the ratio of the largest to smallest component and the resolution. Therefore, as the DAC resolution increases the matching accuracy should not appreciably decrease. In addition, the area required for the DAC is also reduced.
Two approaches will be presented to achieve the above trade-off. The first approach combines DACs using similar scaling methods. The individual DACs or subDACs can be combined by appropriately dividing the analog outputs of each DAC and summing these analog outputs together to form the overall analog output. Alternately, one can appropriately divide the reference voltage of each subDAC and sum all of the individual analog outputs together. The second approach combines the various scaling approaches in an attempt to get the best characteristics of each scaling approach.
## Combination of Similar Scaled DACs
Figure 9.3-1 shows the use of an $M$ -bit subDAC and a $K$ -bit subDAC to implement an $M +$ $K$ -bit DAC. At this point, we will consider that the two subDACs use the same scaling method. One subDAC converts the $M - {MSB}$ -bits and the other DAC converts the $K - {LSB}$ -bits. The analog output of the ${LSB}$ DAC is divided by ${2}^{M}$ to scale it properly. The analog output of the combined subDACs can be written as
$$
{v}_{\mathrm{{OUT}}} = \left( {\frac{{b}_{0}}{2} + \frac{{b}_{1}}{4} + \cdots  + \frac{{b}_{M - 1}}{{2}^{M}}}\right) {V}_{\mathrm{{REF}}} + \left( \frac{1}{{2}^{M}}\right) \left( {\frac{{b}_{M}}{2} + \frac{{b}_{M + 1}}{4} + \cdots  + \frac{{b}_{M + K - 1}}{{2}^{K}}}\right) {V}_{\mathrm{{REF}}} \tag{9.3-1a}
$$
or
$$
{v}_{\mathrm{{OUT}}} = \left( {\frac{{b}_{0}}{2} + \frac{{b}_{1}}{4} + \cdots  + \frac{{b}_{M - 1}}{{2}^{M}} + \frac{{b}_{M}}{{2}^{M + 1}} + \frac{{b}_{M - 1}}{{2}^{M + 2}} + \cdots  + \frac{{b}_{M + K - 1}}{{2}^{M + K}}}\right) {V}_{\mathrm{{REF}}} \tag{9.3-1b}
$$

Figure 9.3-1 Combining an $M$ -bit and $K$ -bit subDAC to form an $M + K$ -bit DAC by dividing the output of the $K - {LSB}$ DAC.
We see from Eq. (9.3-1b) that the DAC of Fig. 9.3-1 has a resolution of $M + K$ -bits. The ratio of the largest to smallest component value will be no more than ${2}^{M - 1}$ or ${2}^{K - 1}$ , depending on whether $M$ or $K$ is larger. In terms of accuracy requirements, all bits must have a tolerance of $\pm  {0.5}\mathrm{{LSB}}$ . However, the component accuracy (the tolerance normalized to the weighting factor) decreases by $\frac{1}{2}$ for each-bit going from the ${MSB}$ -bit to the ${LSB}$ -bit. These characteristics for an $N$ -bit converter can be expressed as follows:
$$
\text{Weighting factor of the}i\text{th-bit} = \frac{{V}_{\mathrm{{REF}}}}{{2}^{i + 1}}\left( \frac{{2}^{N}}{{2}^{N}}\right)  = {2}^{N - i - 1}{LSBs} \tag{9.3-2}
$$
and
$$
\text{Accuracy of the}i\text{th-bit} = \frac{\pm {0.5LSB}}{{2}^{N - i - 1}{LSB}} = \frac{1}{{2}^{N - i}} = \frac{100}{{2}^{N - i}}\%  \tag{9.3-3}
$$
For example, the ${MSB}$ -bit of Fig. ${9.3} - 1\left( {i = 0}\right)$ must have the accuracy of $\pm  1/{2}^{M + K}$ . At the $M$ -bit, the accuracy must be $\pm  1/{2}^{K}$ . If the $K$ -bits are perfectly accurate, then the scaling factor of $1/{2}^{M}$ would have to have the accuracy of $\pm  1/{2}^{K}$ . However, these considerations only hold for a single-bit. If multiple-bits are considered, a worst-case approach must be taken. Let us illustrate this in the following example.
---
Example 9.3-1
---
## Illustration of the Influence of the Scaling Factor
Assume that $M = 2$ and $K = 2$ in Fig. 9.3-1 and find the transfer characteristic of this DAC if the scaling factor for the ${LSB}$ DAC is $3/8$ instead of $1/4$ . Assume that ${V}_{\mathrm{{REF}}} = 1\mathrm{\;V}$ . What is the $\pm  {INL}$ and $\pm  {DNL}$ for this DAC? Is this DAC monotonic or not?
## SOLUTION
The ideal DAC output is given as
$$
{v}_{\mathrm{{OUT}}} = \frac{{b}_{0}}{2} + \frac{{b}_{1}}{4} + \frac{1}{4}\left( {\frac{{b}_{2}}{2} + \frac{{b}_{3}}{4}}\right)  = \frac{{b}_{0}}{2} + \frac{{b}_{1}}{4} + \frac{{b}_{2}}{8} + \frac{{b}_{3}}{16}
$$
The actual DAC output can be written as
$$
{v}_{\mathrm{{OUT}}}\left( \text{actual}\right)  = \frac{{b}_{0}}{2} + \frac{{b}_{1}}{4} + \frac{3{b}_{2}}{16} + \frac{3{b}_{3}}{32} = \frac{{16}{b}_{0}}{32} + \frac{8{b}_{1}}{32} + \frac{6{b}_{2}}{32} + \frac{3{b}_{3}}{32}
$$
The results are tabulated in Table 9.3-1 for this example.
Table 9.3-1 contains all the information we are seeking. An LSB for this example is $1/{16}$ or $2/{32}$ . The fourth column gives the $+ {INL}$ as ${1.5LSBs}$ and the $- {INL}$ as ${0LSB}$ . The fifth column gives the $+ {DNL}$ as ${0.5LSB}$ and the $- {DNL}$ as $- {1.5LSBs}$ . Because the $- {DNL}$ is greater than $- {1LSB}$ , this DAC is not monotonic.
Table 9.3-1 Ideal and Actual Analog Output for the DAC in Example 9.3-1
<table><tr><td>Input Digital Word</td><td>${v}_{\text{out }}$ (actual)</td><td>${V}_{\text{OUT }}$</td><td>${v}_{\text{OUT }}$ (actual) - Vout</td><td>Change in ${v}_{\mathrm{{OUT}}}$ (actual) $- 2/{32}$</td></tr><tr><td>0000</td><td>0/32</td><td>0/32</td><td>0/32</td><td>-</td></tr><tr><td>0001</td><td>3/32</td><td>2/32</td><td>$1/{32}$</td><td>1/32</td></tr><tr><td>0010</td><td>6/32</td><td>4/32</td><td>2/32</td><td>1/32</td></tr><tr><td>0011</td><td>9/32</td><td>6/32</td><td>3/32</td><td>1/32</td></tr><tr><td>0100</td><td>8/32</td><td>8/32</td><td>0/32</td><td>$- 3/{32}$</td></tr><tr><td>0101</td><td>11/32</td><td>10/32</td><td>1/32</td><td>1/32</td></tr><tr><td>0110</td><td>14/32</td><td>12/32</td><td>2/32</td><td>1/32</td></tr><tr><td>0111</td><td>17/32</td><td>14/32</td><td>3/32</td><td>1/32</td></tr><tr><td>1000</td><td>16/32</td><td>16/32</td><td>0/32</td><td>$- 3/{32}$</td></tr><tr><td>1001</td><td>19/32</td><td>18/32</td><td>1/32</td><td>1/32</td></tr><tr><td>1010</td><td>22/32</td><td>20/32</td><td>2/32</td><td>1/32</td></tr><tr><td>1011</td><td>25/32</td><td>22132</td><td>3/32</td><td>1/32</td></tr><tr><td>1100</td><td>24/32</td><td>24/32</td><td>0/32</td><td>$- 3/{32}$</td></tr><tr><td>1101</td><td>27/32</td><td>26/32</td><td>1/32</td><td>1/32</td></tr><tr><td>1110</td><td>30/32</td><td>28/32</td><td>2/32</td><td>1/32</td></tr><tr><td>1111</td><td>33/32</td><td>30/32</td><td>3/32</td><td>1/32</td></tr></table>
Example 9.3-1 illustrates the influence of the scaling factor of Fig. 9.3-1. The following example shows how to find the tolerance of the scaling factor that will prevent an error from occurring in the DAC using the architecture of Fig. 9.3-1.
---
Example 9.3-2
---
## Finding the Tolerance of the Scaling Factor to Prevent Conversion Errors
Find the worst-case tolerance of the scaling factor $\left( {x = 1/{2}^{M} = 1/4}\right)$ in the above example that will not cause a conversion error in the DAC.
## SOLUTION
Because the scaling factor only affects the LSB DAC, we need only consider the two LSB-bits. The worst-case requirement for the ideal scaling factor of $1/4$ is given as
$$
\frac{{b}_{2}}{2}\left( {x \pm  {\Delta x}}\right)  + \frac{{b}_{3}}{4}\left( {x \pm  {\Delta x}}\right)  \leq  \frac{x{b}_{2}}{2} + \frac{x{b}_{3}}{4} \pm  \frac{1}{32}
$$
or
$$
{\Delta x}\left( \frac{{b}_{2}}{2}\right)  + {\Delta x}\left( \frac{{b}_{3}}{4}\right)  = {\Delta x}\left( {\frac{{b}_{2}}{2} + \frac{{b}_{3}}{4}}\right)  \leq  \frac{1}{32}
$$
The worst-case value of ${\Delta x}$ occurs when both ${b}_{2}$ and ${b}_{3}$ are 1 . Therefore, we get
$$
{\Delta x}\left( \frac{3}{4}\right)  \leq  \frac{1}{32} \rightarrow  {\Delta x} \leq  \frac{1}{24}
$$
The scaling factor, $x$ , can be expressed as
$$
x \pm  {\Delta x} = \frac{1}{4} \pm  \frac{1}{24} = \frac{6}{24} \pm  \frac{1}{24}
$$
Therefore, the tolerance required for the scaling factor $x$ is $5/{24}$ to $7/{24}$ . This corresponds to an accuracy of $\pm  {16.7}\%$ , which is less than the $\pm  {25}\% \left( {\pm {100}\% /{2}^{K}}\right)$ because of the influence of the ${LSB}$ -bits. It can be shown that the ${INL}$ and ${DNL}$ will be equal to $\pm  {0.5LSB}$ or less (see Problem 9.3-6).
Another method of combining two or more DACs is to increase the resolution as shown in Fig. 9.3-2. Instead of scaling the output of the subDACs, the reference voltage to each subDAC is scaled. This method of combining subDACs is called subranging. The analog output of the subranging DAC of Fig. 9.3-2 can be expressed as
$$
{v}_{\mathrm{{OUT}}} = \left( {\frac{{b}_{0}}{2} + \frac{{b}_{1}}{4} + \cdots  + \frac{{b}_{M - 1}}{{2}^{M}}}\right) {V}_{\mathrm{{REF}}} + \left( {\frac{{b}_{M}}{2} + \frac{{b}_{M + 1}}{4} + \cdots  + \frac{{b}_{M + K - 1}}{{2}^{K}}}\right) \left( \frac{{V}_{\mathrm{{REF}}}}{{2}^{M}}\right)  \tag{9.3-4a}
$$
or
$$
{v}_{\mathrm{{OUT}}} = \left( {\frac{{b}_{0}}{2} + \frac{{b}_{1}}{4} + \cdots  + \frac{{b}_{M - 1}}{{2}^{M}} + \frac{{b}_{M}}{{2}^{M + 1}} + \frac{{b}_{M + 1}}{{2}^{M + 2}} + \cdots  + \frac{{b}_{M + K - 1}}{{2}^{M + K}}}\right) {V}_{\mathrm{{REF}}} \tag{9.3-4b}
$$
We note that Eq. (9.3-4b) is identical to Eq. (9.3-1b) for the method that divides the analog output of the subDACs.
The accuracy considerations of this method are similar to the method discussed above for Fig. 9.3-1. It can be shown that the requirement for the tolerance on the scaling factor for the reference voltage is identical to that of the scaling constant for the output voltage of the ${LSB}$ DAC.
Figure 9.3-3 shows a current scaling DAC using the combination of two, 4-bit current scaling subDACs. The scaling of the LSB subDAC is accomplished through the current

Figure 9.3-2 Combining an $M$ -bit and $K$ -bit subDAC to form an $M + K$ -bit DAC by dividing the ${V}_{\text{REF }}$ to the $K - {LSB}$ DAC (subranging).

Figure 9.3-3 Combination of current scaling subDACs using a current divider.
divider consisting of $R$ and ${15R}$ . We see that the current being sunk by the ${LSB}$ DAC, ${i}_{1}$ , is ${16}{i}_{2}$ . The sum of ${i}_{2}$ plus the currents sunk by the ${MSB}$ DAC flows through the feedback resistor, ${R}_{F}$ , to create the output voltage, ${v}_{\mathrm{{OUT}}}$ . The output voltage can be expressed as
$$
{v}_{\mathrm{{OUT}}} = {R}_{F}I\left\lbrack  {\left( {\frac{{b}_{0}}{2} + \frac{{b}_{1}}{4} + \frac{{b}_{2}}{8} + \frac{{b}_{3}}{16}}\right)  + \frac{1}{16}\left( {\frac{{b}_{4}}{2} + \frac{{b}_{5}}{4} + \frac{{b}_{6}}{8} + \frac{{b}_{7}}{16}}\right) }\right\rbrack   \tag{9.3-5}
$$
The individual DACs or subDACs can be realized using any of the methods considered in the previous section for current scaling DACs.
The voltage scaling DAC does not adapt well to the method of increasing the resolution shown in Fig. 9.3-1 or 9.3-2 because of the high output resistance. The high output resistance makes it difficult to sum the outputs of subDACs that use voltage scaling. To solve this problem, buffer amplifiers should be added to each subDAC output.
Figure 9.3-4 shows a charge scaling DAC using the combination of two, 4-bit charge scaling subDACs. The scaling of the ${LSB}$ subDAC is accomplished through the capacitor ${C}_{s}$ . The value of the scaling capacitor, ${C}_{s}$ , can be found as follows. The series combination of ${C}_{s}$ and the ${LSB}$ array must terminate the ${MSB}$ array or equal $C/8$ . Therefore, we can write
$$
\frac{C}{8} = \frac{1}{\frac{1}{{C}_{s}} + \frac{1}{2C}} \tag{9.3-6}
$$
or
$$
\frac{1}{{C}_{s}} = \frac{8}{C} - \frac{1}{2C} = \frac{16}{2C} - \frac{1}{2C} = \frac{15}{2C} \tag{9.3-7}
$$

Figure 9.3-4 Combination of two, 4-bit charge scaling subDACs to form an 8-bit charge scaling DAC.
Thus, the value of the scaling capacitor, ${C}_{s}$ , should be ${2C}/{15}$ .
Let us now show that the output voltage of Figure 9.3-4 is equivalent to that of an 8-bit charge scaling DAC. First, we must find the Thevenin equivalent voltage of the MSB array, ${V}_{1}$ , and the ${LSB}$ array plus the terminating capacitor, ${V}_{2}$ . These voltages can be written as
$$
{V}_{1} = \left( \frac{1}{{15}/8}\right) {b}_{0}{V}_{\mathrm{{REF}}} + \left( \frac{1/2}{{15}/8}\right) {b}_{1}{V}_{\mathrm{{REF}}} + \left( \frac{1/4}{{15}/8}\right) {b}_{2}{V}_{\mathrm{{REF}}} + \left( \frac{1/8}{{15}/8}\right) {b}_{3}{V}_{\mathrm{{REF}}} \tag{9.3-8}
$$
$$
= \frac{16}{15}\left( {\frac{{b}_{0}}{2} + \frac{{b}_{1}}{4} + \frac{{b}_{2}}{8} + \frac{{b}_{3}}{16}}\right) {V}_{\text{REF }}
$$
and
$$
{V}_{2} = \left( \frac{1/1}{2}\right) {b}_{4}{V}_{\mathrm{{REF}}} + \left( \frac{1/2}{2}\right) {b}_{5}{V}_{\mathrm{{REF}}} + \left( \frac{1/4}{2}\right) {b}_{6}{V}_{\mathrm{{REF}}} + \left( \frac{1/8}{2}\right) {b}_{7}{V}_{\mathrm{{REF}}} \tag{9.3-9}
$$
$$
= \left( {\frac{{b}_{4}}{2} + \frac{{b}_{5}}{4} + \frac{{b}_{6}}{8} + \frac{{b}_{7}}{16}}\right) {V}_{\text{REF }}
$$
Using the two equivalent voltages given in Eqs. (9.3-8) and (9.3-9), Fig. 9.3-4 can be simplified to the circuit shown in Fig. 9.3-5. From this figure, we can write the output voltage as
$$
{v}_{\mathrm{{OUT}}} = \left( \frac{\frac{1}{\frac{2}{2C} + \frac{15}{2C}}}{\frac{1}{2C} + \frac{15}{2C} + \frac{8}{15C}}\right) {V}_{1} + \left( \frac{\frac{8}{15C}}{\frac{1}{2C} + \frac{15}{2C} + \frac{8}{15C}}\right) {V}_{2}
$$
$$
= \left( \frac{{15} + {15} \cdot  {15}}{{15} + {15} \cdot  {15} + {16}}\right) {V}_{1} + \left( \frac{16}{{15} + {15} \cdot  {15} + {16}}\right) {V}_{2} \tag{9.3-10}
$$
$$
= \left( \frac{{16} \cdot  {15}}{{16} \cdot  {15} + {16}}\right) {V}_{1} + \left( \frac{16}{{16} \cdot  {15} + {16}}\right) {V}_{2} = \frac{15}{16}{V}_{1} + \frac{1}{16}{V}_{2}
$$
Substituting Eqs. (9.3-8) and (9.3-9) into Eq. (9.3-10) gives the analog output voltage of Fig. 9.3-4.
$$
{v}_{\mathrm{{OUT}}} = \left( {\frac{{b}_{0}}{2} + \frac{{b}_{1}}{4} + \frac{{b}_{2}}{8} + \frac{{b}_{3}}{16} + \frac{{b}_{4}}{32} + \frac{{b}_{5}}{64} + \frac{{b}_{6}}{128} + \frac{{b}_{7}}{256}}\right) {V}_{\mathrm{{REF}}} = \mathop{\sum }\limits_{{i = 0}}^{7}\frac{{b}_{i}{V}_{\mathrm{{REF}}}}{{2}^{i}} \tag{9.3-11}
$$

Figure 9.3-5 Simplified equivalent circuit of Fig. 9.3-4.

Figure 9.3-6 Combination of two, 4-bit, binary-weighted, charge amplifier subDACs to form an 8-bit, binary-weighted, charge amplifier DAC.
In the case of Fig. 9.3-5, the accuracy of the scaling capacitor, ${C}_{s}$ , influences the ${MSB}$ array as well as the ${LSB}$ array because it forms part of the terminating capacitor for the ${MSB}$ array. Figure 9.3-6 shows a combination of two charge scaling DACs that use the charge amplifier approach. This ${MSB}$ subDAC is not dependent on the accuracy of the scaling factor for the ${LSB}$ subDAC.
The above ideas are representative of methods used to increase the resolution of a DAC by combining two or more subDACs using the same type of scaling. Many different combinations of these ideas will be found in the literature concerning integrated circuit digital-analog converters.
## Combination of Differently Scaled DACs
The second approach to extending the resolution of parallel DACs uses subDACs having different scaling methods. One of the advantages of this approach is that the designer can choose a scaling method that optimizes the MSBs and a different scaling method to optimize the ${LSBs}$ . The most popular example of this approach is the combination of the voltage scaling and charge scaling methods [6].
Figure 9.3-7 illustrates a DAC that uses voltage scaling for the ${MSB}$ subDAC and charge scaling for the ${LSB}$ subDAC. The ${MSB}$ subDAC is $M$ -bits and the ${LSB}$ subDAC is $K$ -bits, giving a DAC with the resolution of $M + K$ -bits. The $M$ -bit voltage subDAC of Fig. 9.3-7 scales the reference voltage to ${V}_{\mathrm{{REF}}}/{2}^{M}$ , which is used as the reference voltage for the charge scaling subDAC. This subDAC consists of a resistor string of ${2}^{M}$ equal resistors connected between ${V}_{\mathrm{{REF}}}$ and ground. There are two $M$ -to- ${2}^{M}$ decoders connected to the resistor taps as shown. These decoders can be implemented by Fig. 9.2-7(a) or 9.2-8. The $M$ -bits cause output of decoder $A$ to be connected to the top (higher potential) and the output of decoder $B$ to the bottom (lower potential) of one of the ${2}^{M}$ resistors. The output of decoder $A$ is bus $A$ and the output of decoder $B$ is bus $B$ .

Figure 9.3-7 $M + K$ -bit DAC using an $M$ -bit voltage scaling subDAC for the ${MSBs}$ and a $K$ -bit charge scaling subDAC for the LSBs.
The voltage scaling, charge scaling DAC of Fig. 9.3-7 works as follows. First, the two switches ${S}_{F}$ and switches ${S}_{1B}$ through ${S}_{K, B}$ are closed, discharging all capacitors. If the output of the DAC is applied to a comparator that can also function as a unity-gain buffer, autozero-ing could be accomplished during this step. Next, the MMSBs are applied to the voltage scaling subDAC in the manner described above to connect bus $A$ at the top of the proper resistor and bus $B$ to the bottom of this resistor. In reality, the desired analog output voltage will be between the voltages at the top and bottom of this resistor, which is determined by the $M$ ${MSBs}$ . The equivalent circuit of the DAC of Fig. 9.3-7 at this point is given by Fig. 9.3-8(a).

Figure 9.3-8 (a) Equivalent circuit of Fig. 9.3-7 for the voltage scaling subDAC. (b) Equivalent circuit of the entire DAC of Fig. 9.3-7.
The lower voltage source of Fig. 9.3-8(a), ${V}_{\mathrm{{REF}}}^{\prime }$ , represents the voltage from ground to the bottom terminal of the selected resistor, where bus B is connected. It can be written as
$$
{V}_{\mathrm{{REF}}}^{\prime } = {V}_{\mathrm{{REF}}}\left( {\frac{{b}_{0}}{{2}^{1}} + \frac{{b}_{1}}{{2}^{2}} + \cdots  + \frac{{b}_{M - 2}}{{2}^{M - 1}} + \frac{{b}_{M - 1}}{{2}^{M}}}\right)  \tag{9.3-12}
$$
where the bits ${b}_{0}$ through ${b}_{M - 1}$ determine the value of ${V}_{\mathrm{{REF}}}^{\prime }$ . The upper voltage source of Fig. 9.3-8(a) represents the voltage drop across the resistor connected between buses A and B. It is equal to the LSB of the voltage subDAC of Fig. 9.3-7.
The final step in the conversion is to connect the capacitors in the charge scaling DAC to bus A if their bit is 1 and to bus B if their bit is 0 . If we let the capacitors that are connected to bus A be designated as ${C}_{eq}$ , then Fig. 9.3-8(b) becomes a model of the entire DAC operation. The output voltage of the charge scaling subDAC, ${v}_{\mathrm{{OUT}}}^{\prime }$ , can be expressed as
$$
{v}_{\mathrm{{OUT}}}^{\prime } = \frac{{V}_{\mathrm{{REF}}}}{{2}^{M}}\left( {\frac{{b}_{M}}{2} + \frac{{b}_{M + 1}}{{2}^{2}} + \cdots  + \frac{{b}_{M + K - 2}}{{2}^{K - 1}} + \frac{{b}_{M + K - 1}}{{2}^{K}}}\right)  \tag{9.3-13}
$$
$$
= {V}_{\mathrm{{REF}}}\left( {\frac{{b}_{M}}{{2}^{M + 1}} + \frac{{b}_{M + 1}}{{2}^{M + 2}} + \cdots  + \frac{{b}_{M + K - 2}}{{2}^{M + K - 1}} + \frac{{b}_{M + K - 1}}{{2}^{M + K}}}\right)
$$
Adding ${V}_{\mathrm{{REF}}}^{\prime }$ of Eq. (9.3-12) to ${v}_{\mathrm{{OUT}}}^{\prime }$ of Eq. (9.3-13) gives the DAC output voltage as
$$
{v}_{\mathrm{{OUT}}} = {V}_{\mathrm{{REF}}}^{\prime } + {V}_{\mathrm{{OUT}}}^{\prime }
$$
$$
= {V}_{\mathrm{{REF}}}\left( {\frac{{b}_{0}}{{2}^{1}} + \frac{{b}_{1}}{{2}^{2}} + \cdots  + \frac{{b}_{M - 1}}{{2}^{M}} + \frac{{b}_{M}}{{2}^{M + 1}} + \frac{{b}_{M + 1}}{{2}^{M + 2}} + \cdots \frac{{b}_{M + K - 2}}{{2}^{M + K - 1}} + \frac{{b}_{M + K - 1}}{{2}^{M + K}}}\right)  \tag{9.3-14}
$$
which is equivalent to an $M + K$ -bit DAC.
The advantages of the DAC of Fig. 9.3-7 is that the MSBs are guaranteed to be monotonic. The accuracy of the ${LSBs}$ should be greater than the ${MSBs}$ because they are determined by capacitors. The component spread is determined by the binary-weighted capacitors and is ${2}^{K - 1}$ . Unfortunately, while the MSBs are monotonic, the accuracy of the resistors is not as good as the capacitors and nonmonotonicity is likely to occur when the MSBs and LSBs are combined.
Figure 9.3-9 shows a DAC that uses a charge scaling subDAC for the MSBs and a voltage scaling subDAC for the LSBs. This DAC will have the advantage of better accuracy in the ${MSBs}$ and monotonic ${LSBs}$ . Because the required tolerance is smaller for the ${LSBs}$ this configuration is probably the better of the two for overall performance.
The output voltage due to the MSB array is given as
$$
{v}_{\mathrm{{OUT}}} = \left( {\frac{{b}_{0}}{{2}^{1}} + \frac{{b}_{1}}{{2}^{2}} + \cdots  + \frac{{b}_{M - 2}}{{2}^{M - 1}} + \frac{{b}_{M - 1}}{{2}^{M}}}\right) {V}_{\mathrm{{REF}}} + \frac{{v}_{K}}{{2}^{M}} \tag{9.3-15}
$$
where ${v}_{K}$ is the output voltage of the $K$ -bit subDAC. The voltage ${v}_{K}$ can be expressed as
$$
{v}_{K} = \left( {\frac{{b}_{M}}{{2}^{1}} + \frac{{b}_{M + 1}}{{2}^{2}} + \cdots  + \frac{{b}_{M + K - 2}}{{2}^{K - 1}} + \frac{{b}_{M + K - 1}}{{2}^{K}}}\right) {V}_{\mathrm{{REF}}} \tag{9.3-16}
$$
Combining Eqs. (9.3-15) and (9.3-16) gives the output voltage for the DAC of Fig. 9.3-9 that uses a charge scaling subDAC for the MSBs and a voltage scaling subDAC for the LSBs. This output voltage is
$$
{v}_{\mathrm{{OUT}}} = \left( {\frac{{b}_{0}}{{2}^{1}} + \frac{{b}_{1}}{{2}^{2}} + \cdots  + \frac{{b}_{M - 2}}{{2}^{M - 1}} + \frac{{b}_{M - 1}}{{2}^{M}} + \frac{{b}_{M}}{{2}^{M + 1}} + \frac{{b}_{M + 1}}{{2}^{M + 2}} + \cdots  + \frac{{b}_{M + K - 2}}{{2}^{M + K - 1}} + \frac{{b}_{M + K - 1}}{{2}^{M + K}}}\right) {V}_{\mathrm{{REF}}} \tag{9.3-17}
$$

Figure 9.3-9 $M + K$ -bit DAC using an $M$ -bit charge scaling subDAC for the ${MSBs}$ and a $K$ -bit voltage scaling subDAC for the ${LSBs}$ .
The advantage of the DAC of Fig. 9.3-9 is that the LSBs are guaranteed to be monotonic. The accuracy of the MSBs should be greater than the LSBs because they are determined by capacitors. The DNL, which is proportional to the tolerance, should be less for the DAC because of the increased accuracy of the MSBs. The component spread is determined by the binary-weighted capacitors and is ${2}^{M - 1}$ . It may be necessary to trim the resistors to reduce the ${DNL}$ if $K$ is large.
The use of two different types of scaling subDACs to implement a DAC allows the designer to make trade-offs in regard to ${INL}$ and ${DNL}$ performance of the DAC. Using the worst-case ${INL}$ and ${DNL}$ relationships developed in the last section, we can characterize these trade-offs. For example, consider a DAC similar to Fig. 9.3-7 that uses two different subDACs. The ${MSB}$ subDAC is to be an $M$ -bit voltage scaling subDAC and the ${LSB}$ subDAC is to be a $K$ -bit charge scaling subDAC. From Eq. (9.2-14), the worst-case ${INL}$ of the voltage scaling subDAC can be written as
$$
\operatorname{INL}\left( R\right)  = {2}^{M - 1}\left( \frac{{2}^{N}}{{2}^{M}}\right) \frac{\Delta R}{R} = {2}^{N - 1}\frac{\Delta R}{R}\operatorname{LSBs} \tag{9.3-18}
$$
where the ${LSBs}$ correspond to the entire DAC so that we multiply Eq. (9.2-14) by ${2}^{N}/{2}^{M} =$ ${2}^{K}$ . The worst-case ${DNL}$ of the voltage scaling subDAC was given in Eq. (9.2-15). Again, in this case the units of ${LSBs}$ corresponds to the entire DAC so that we multiply Eq. (9.2-15) by ${2}^{N}/{2}^{M} = {2}^{K}$ to get
$$
\operatorname{DNL}\left( R\right)  = \frac{\pm {\Delta R}}{R}\left( \frac{{2}^{N}}{{2}^{M}}\right)  = {2}^{K}\frac{\pm {\Delta R}}{R}{LSBs} \tag{9.3-19}
$$
For the INL of the charge scaling subDAC we can rewrite Eq. (9.2-24) as
$$
\operatorname{INL}\left( C\right)  = {2}^{K - 1}\frac{\Delta C}{C}{LSBs} \tag{9.3-20}
$$
Finally, from Eq. (9.2-26), we can express the ${DNL}$ of the charge scaling subDAC as
$$
{DNL}\left( C\right)  = \left( {{2}^{K} - 1}\right) \frac{\Delta C}{C}{LSBs} \tag{9.3-21}
$$
Assuming the ${INL}$ and ${DNL}$ for the individual subDACs add, we can write the ${INL}$ and ${DNL}$ of the DAC using an ${MSB}$ voltage scaling subDAC and an ${LSB}$ charge scaling subDAC as
$$
{INL} = {INL}\left( R\right)  + {INL}\left( C\right)  = \left( {{2}^{N - 1}\frac{\Delta R}{R} + {2}^{K - 1}\frac{\Delta C}{C}}\right) {LSBs} \tag{9.3-22}
$$
and
$$
{DNL} = {DNL}\left( R\right)  + {DNL}\left( C\right)  = \left( {{2}^{K}\frac{\Delta R}{R} + \left( {{2}^{K} - 1}\right) \frac{\Delta C}{C}}\right) {LSBs} \tag{9.3-23}
$$
These relationships could be used to find the maximum number of bits possible for each subDAC before a given ${INL}$ or ${DNL}$ was exceeded.
Similar relationships can be developed for the case of Fig. 9.3-9 where the MSB sub-DAC is charge scaling and the ${LSB}$ subDAC is voltage scaling. The overall ${INL}$ and ${DNL}$ are given as
$$
{INL} = {INL}\left( R\right)  + {INL}\left( C\right)  = \left( {{2}^{K - 1}\frac{\Delta R}{R} + {2}^{N - 1}\frac{\Delta C}{C}}\right) {LSBs} \tag{9.3-24}
$$
and
$$
{DNL} = {DNL}\left( R\right)  + {DNL}\left( C\right)  = \left( {\frac{\Delta R}{R} + \left( {{2}^{N} - 1}\right) \frac{\Delta C}{C}}\right) {LSBs} \tag{9.3-25}
$$
The above formulas are very useful in design that combines different subDACs. For example, in the case of the voltage scaling ${MSBs}$ and charge scaling ${LSBs}$ , Eqs. (9.3-22) and (9.3-23) suggest that ${INL}$ is more sensitive to the resistor tolerance by a factor of ${2}^{M}$ while the ${DNL}$ is equally sensitive to the resistors and capacitor tolerances. In the case of the charge scaling ${MSBs}$ and the voltage scaling ${LSBs}$ , Eqs. (9.3-24) and (9.3-25) suggest that the ${INL}$ is more sensitive to the capacitor tolerances by a factor of ${2}^{K}$ and the ${DNL}$ is also more sensitive to the capacitor tolerances by a factor of almost ${2}^{N}$ . These formulas will provide a guide for the design of cascading subDACs to reduce both passive component area and the ratio of the largest to smallest passive component element values. The following example will explore how these trade-offs in the choice of subDACs and the number of their bits might be made.
---
Example 9.3-3
---
## Design of a DAC Using Voltage Scaling for MSBs and Charge Scaling for LSBs
Consider a 12-bit DAC that uses voltage scaling for the MSBs and charge scaling for the LSBs. To emphasize the accuracy of the capacitors, choose $M = 7$ and $K = 5$ . Find the tolerances necessary for the resistors and capacitors to give an ${INL}$ and a ${DNL}$ equal to or less than $2\mathrm{{LSBs}}$ and $1\mathrm{{LSB}}$ , respectively.
SOLUTION
Equations (9.3-22) and (9.3-23) can be rewritten as
$$
2 = {2}^{11}\frac{\Delta R}{R} + {2}^{6}\frac{\Delta C}{C}
$$
and
$$
1 = {2}^{7}\frac{\Delta R}{R} + \left( {{2}^{7} - 1}\right) \frac{\Delta C}{C}
$$
Solving these two equations simultaneously gives
$$
\frac{\Delta C}{C} = \frac{{2}^{5} - 2}{{2}^{11} - {2}^{6} - {2}^{5}} = {0.0154} \rightarrow  \frac{\Delta C}{C} = {1.54}\%
$$
and
$$
\frac{\Delta R}{R} = \frac{2 - {2}^{6}\left( {0.0154}\right) }{{2}^{11}} = {0.0005}\; \rightarrow  \;\frac{\Delta R}{R} = {0.05}\%
$$
We see that the capacitor tolerance will be easy to meet but that the resistor tolerance will require resistor trimming to meet the ${0.05}\%$ requirement. Because of the ${2}^{N - 1}$ multiplying ${\Delta R}/R$ in Eq. (9.3-22), it will not do any good to try different values of $M$ and $K$ . This realization will consist of 32 equal-value resistors and 7 binary-weighted capacitors with an element spread of 64. It will help to reduce $M$ and increase $K$ because a smaller $M$ results in higher resistor accuracy.
The following example investigates the specifications of Example 9.3-3 applied to a DAC that uses charge scaling for the MSBs and voltage scaling for the LSBs.
Example
## Design of a DAC Using Charge Scaling for MSBs and Voltage Scaling for LSBs
9.3-4 Consider a 12-bit DAC that uses charge scaling for the MSBs and voltage scaling for the LSBs. To minimize the capacitor element spread and the number of resistors, choose $M = 5$ and $K = 7$ . Find the tolerances necessary for the resistors and capacitors to give an ${INL}$ and a ${DNL}$ equal to or less than $2\mathrm{{LSBs}}$ and $1\mathrm{{LSB}}$ , respectively.
## SOLUTION
Equations (9.3-24) and (9.3-25) can be rewritten as
$$
2 = {2}^{4}\frac{\Delta R}{R} + {2}^{11}\frac{\Delta C}{C}
$$
and
$$
1 = \frac{\Delta R}{R} + \left( {{2}^{12} - {2}^{7}}\right) \frac{\Delta C}{C}
$$
Solving these two equations simultaneously gives
$$
\frac{\Delta C}{C} = \frac{{2}^{4} - 2}{{2}^{16} - {2}^{11} - {2}^{11}} = {0.000228} \rightarrow  \frac{\Delta C}{C} = {0.0228}\%
$$
and
$$
\frac{\Delta R}{R} \approx  \frac{3}{{2}^{5} - 1} = {0.0968} \rightarrow  \frac{\Delta R}{R} = {9.68}\%
$$
For this example, the resistor tolerance is easy to meet but the capacitor tolerance will be difficult. Because we need accurate capacitor tolerance, we will use large capacitors and try to keep the largest to smallest capacitor ratio small. This suggests that we should decrease the value of $M$ and increase the value of $K$ to achieve a smaller capacitor value spread and thereby enhance the tolerance of the capacitors. If we choose $M = 5$ and $K = 7$ , the capacitor tolerance remains about the same but the resistor tolerance becomes ${2.36}\%$ , which is still reasonable. The largest to smallest capacitor ratio is 16 rather than 64 , which will help to meet the capacitor tolerance requirements. We probably should decrease $M$ to 2 or 3 and increase $K$ to 9 or 10 to help meet the capacitor tolerance requirement.
This section has shown how the resolution of parallel digital-analog converters can be achieved without significantly increasing the area or the largest to smallest element value ratio. Two approaches were presented. The first used similarly scaled subDACs and the second combined subDACs that used different scaling methods. The basic strategies were to divide either the analog output of the LSB subDAC or the reference voltage to the LSB subDAC by the appropriate factor and add this analog voltage to the analog output voltage of the MSB DAC. It should be remembered that the techniques of this section do not reduce the tolerance requirements for a digital-analog converter as the number of bits increases. Rather, these techniques allow the designer to make trade-offs in area and largest to smallest component ratios, which will indirectly influence the accuracy of the digital-analog converter.
### 9.4 Serial Digital-Analog Converters
The category of DACs considered in this section is the serial DAC. A serial DAC is one in which the conversion is done sequentially. Typically, one clock pulse is required to convert 1-bit. Thus, $N$ clock pulses would be required for the typical serial $N$ -bit DAC. The two types of converters that will be examined here are the serial charge-redistribution and the serial algorithmic DACs.

Figure 9.4-1 Simplified schematic of a serial charge-redistribution DAC.
Figure 9.4-1 shows the simplified schematic of a serial charge-redistribution DAC. It is seen that this converter consists of four switches, two equal-valued capacitors, and a reference voltage. The function of the switches is as follows: ${S}_{1}$ is called the redistribution switch and places ${C}_{1}$ in parallel with ${C}_{2}$ , causing their voltages to become identical through charge redistribution; switch ${S}_{2}$ is used to precharge ${C}_{1}$ to ${V}_{\mathrm{{REF}}}$ , if the $i$ th-bit, ${b}_{i}$ , is a 1 ; switch ${S}_{3}$ is used to precharge ${C}_{1}$ to zero volts if the $i$ th-bit is 0 ; and switch ${S}_{4}$ is used at the beginning of the conversion process to initially discharge ${C}_{2}$ . The conversion of the bits always begins with the LSB and goes to the MSB. The following example will illustrate the operation of this converter.
---
Example 9.4-1
---
## Operation of the Serial Charge-Redistribution DAC
Assume that ${C}_{1} = {C}_{2}$ and that the digital word to be converted is given as ${b}_{0} = 1,{b}_{1} = 1$ , ${b}_{2} = 0$ , and ${b}_{3} = 1$ . Follow through the sequence of events that result in the conversion of this digital input word.

Figure 9.4-2 Waveforms of Fig. 9.4-1 for the conversion of the digital word 1101. (a) Voltage across ${C}_{1}$ . (b) Voltage across ${C}_{2}$ .
## SOLUTION
The conversion starts with the closure of switch ${S}_{4}$ , so that ${v}_{C2} = 0$ . Since ${b}_{3} = 1$ , then switch ${S}_{2}$ is closed causing ${v}_{C1} = {V}_{\mathrm{{REF}}}$ . Next, switch ${S}_{1}$ is closed causing ${v}_{C1} = {v}_{C2} = {0.5}{V}_{\mathrm{{REF}}}$ . This completes the conversion of the ${LSB}$ . Figure 9.4-2 illustrates the waveforms across ${C}_{1}$ and ${C}_{2}$ during this example. Going to the next most ${LSB},{b}_{2}$ , switch ${S}_{3}$ is closed, discharging ${C}_{1}$ to ground. When switch ${S}_{1}$ closes, the voltage across both ${C}_{1}$ and ${C}_{2}$ is ${0.25}{V}_{\text{REF }}$ . Because the remaining 2-bits are both $1,{C}_{1}$ will be connected to ${V}_{\mathrm{{REF}}}$ and then connected to ${C}_{2}$ two times in succession. The final voltage across ${C}_{1}$ and ${C}_{2}$ will be $\frac{13}{16}{V}_{\mathrm{{REF}}}$ . This sequence of events will require nine sequential switch closures to complete the conversion.
From the above example it can be seen that the serial DAC requires considerable supporting external circuitry to make the decision on which switch to close during the conversion process. Although the circuit for the conversion is extremely simple, several sources of error will limit the performance of this type of DAC. These sources of error include the capacitor parasitic capacitances, the switch parasitic capacitances, and the clock feedthrough errors. The capacitors ${C}_{1}$ and ${C}_{2}$ must be matched to within the ${LSB}$ accuracy. This converter has the advantage of monotonicity and requires very little area for the portion shown in Fig. 9.4-1. An 8-bit converter using this technique has been fabricated and has demonstrated a conversion time of ${13.5\mu }\mathrm{s}$ [7].
A second approach to serial digital-analog conversion is called algorithmic [8]. Figure 9.4-3 illustrates the pipeline approach to implementing a serial algorithmic DAC. Figure 9.4-3 consists of unit delays and weighted summers. It can be shown that the output of this circuit is
$$
{V}_{\text{out }}\left( \mathrm{z}\right)  = \left\lbrack  {{b}_{0}{z}^{-1} + {2}^{-1}{b}_{1}{z}^{-2} + \cdots  + {2}^{-\left( {N - 2}\right) }{b}_{N - 2}{z}^{-\left( {N - 1}\right) } + {2}^{-\left( {N - 1}\right) }{b}_{N - 1}{z}^{-N}}\right\rbrack  {V}_{\text{REF }} \tag{9.4-1}
$$
where ${b}_{i}$ is either $\pm  1$ . Figure 9.4-3 shows that it takes $N + 1$ clock pulses for the digital word to be converted to an analog signal, even though a new digital word can be converted on every clock pulse.
The complexity of Fig. 9.4-3 can be reduced using techniques of replication and iteration. Here we shall consider only the iteration approach. Equation (9.4-1) can be rewritten as
$$
{V}_{\text{out }}\left( z\right)  = \frac{{b}_{i}{z}^{-1}{V}_{\text{REF }}}{1 - {0.5}{z}^{-1}} \tag{9.4-2}
$$
where all ${b}_{i}$ have been assumed to be identical. The fact that each ${b}_{i}$ is either $\pm  1$ will be determined in the following realization. Figure 9.4-4 shows a block diagram realization of Eq. (9.4-2). It consists of two switches, $A$ and $B$ . Switch $A$ is closed when the $i$ th-bit is 1 and switch $B$ is closed when the $i$ th-bit is 0 . Then ${b}_{i}{V}_{\text{REF }}$ is summed with one-half of the previous

Figure 9.4-3 Pipeline approach to implementing an algorithmic DAC.

Figure 9.4-4 Equivalent realization of Fig. 9.4-3 using iterative techniques.
output and applied to the sample-and-hold circuit that outputs the result for the $i$ th-bit conversion. The following example illustrates the conversion process.
---
Example 9.4-2
---
## Digital-Analog Conversion Using the Algorithmic Method
Assume that the digital word to be converted is 11001 in the order of ${MSB}$ to ${LSB}$ . Find the converted output voltage and sketch a plot of ${v}_{\mathrm{{OUT}}}/{V}_{\mathrm{{REF}}}$ as a function of $t/T$ , where $T$ is the period for one conversion.
## SOLUTION
The conversion starts by zeroing the output (not shown on Fig. 9.4-4). Figure 9.4-5 is a plot of the output of this example. The process starts with the ${LSB}$ , which in this case is 1 . Switch $A$ is closed and ${V}_{\mathrm{{REF}}}$ is summed with zero to give an output of $+ {V}_{\mathrm{{REF}}}$ . On the second conversion, the bit is zero so that switch $B$ is closed. Thus, $- {V}_{\mathrm{{REF}}}$ is summed with $\frac{1}{2}{V}_{\mathrm{{REF}}}$ , giving $- \frac{1}{2}{V}_{\mathrm{{REF}}}$ as the output. On the third conversion, the bit is also zero so that $- {V}_{\mathrm{{REF}}}$ is summed with $- \frac{1}{4}{V}_{\text{REF }}$ to give an output of $- \frac{5}{4}{V}_{\text{REF }}$ . On the fourth conversion, the bit is 1, which causes ${V}_{\mathrm{{REF}}}$ to be summed with $- \frac{5}{8}{V}_{\mathrm{{REF}}}$ , giving $+ \frac{3}{8}{V}_{\mathrm{{REF}}}$ at the output. Finally, the ${MSB}$ is one, which causes ${V}_{\mathrm{{REF}}}$ to be summed with $\frac{3}{16}{V}_{\mathrm{{REF}}}$ , giving the final analog output of $+ \frac{19}{16}{V}_{\mathrm{{REF}}}$ . Because the actual ${V}_{\mathrm{{REF}}}$ of this example is $\pm  {V}_{\mathrm{{REF}}}$ or $2{V}_{\mathrm{{REF}}}$ , the analog value of the digital word 11001 with a reference voltage of $2{V}_{\mathrm{{REF}}}$ is $\frac{19}{16}{V}_{\mathrm{{REF}}}$ .

Figure 9.4-5 Output waveform for Fig. 9.4-4 for the conditions of Example 9.4-2.
The algorithmic converter has the primary advantage of being independent of capacitor ratios. It is often called a ratio-independent algorithmic DAC. It is necessary for the gain of the 0.5 amplifier of Fig. 9.4-4 to be equal to ${0.5} \pm  {0.5LSB}$ in order to be able to have the resolution of the LSB. Because the gain of the 0.5 amplifier is usually determined by capacitor ratios, the algorithmic converter is not truly independent of capacitor ratios. The algorithmic converter will be presented again under the subject of serial analog-digital converters.
Table 9.4-1 Summary of the Performance of Serial DACs
<table><tr><td>Serial DAC</td><td>Figure</td><td>Advantage</td><td>Disadvantage</td></tr><tr><td>Serial charge redistribution</td><td>9.4-1</td><td>Simple, minimum area</td><td>Slow, requires complex external circuitry, precise capacitor ratios</td></tr><tr><td>Serial algorithmic</td><td>9.4-4</td><td>Simple, minimum area</td><td>Slow, requires complex external circuitry, precise capacitor ratios</td></tr></table>
Two serial DACs have been presented. The serial DAC is seen to be very simple but to require a longer time for conversion. In some applications, these characteristics are advantageous. See Table 9.4-1.
## Summary
This section and the previous two have presented DAC architectures compatible with CMOS technology. Table 9.4-2 gives a summary of these DACs and lists their primary advantages and disadvantages. We will describe another DAC that uses a delta-sigma modulator later in this chapter. In the following sections, we shall examine the complementary subject of analog-digital converters. Many of the converters that will be discussed use the digital-analog converters developed in this section.
Table 9.4-2 Summary of the Performance of DACs
<table><tr><td>DAC</td><td>Figure</td><td>Advantage</td><td>Disadvantage</td></tr><tr><td>Current scaling, binary- weighted resistors</td><td>9.2-3</td><td>Fast, insensitive to parasitic capacitance</td><td>Large element spread, nonmonotonic</td></tr><tr><td>Current scaling $R - {2R}$ ladder</td><td>9.2-4</td><td>Small element spread, increased accuracy</td><td>Slower, sensitive to parasitic capacitance, nonmonotonic</td></tr><tr><td>Current scaling active devices</td><td>9.2-5</td><td>Fast, insensitive to switch parasitics, increased accuracy</td><td>Large element spread, large area</td></tr><tr><td>Voltage scaling</td><td>9.2-7</td><td>Monotonic, equal resistors</td><td>Large area, sensitive to parasitic capacitance</td></tr><tr><td>Charge scaling, binary- weighted capacitors</td><td>9.2-10</td><td>Best accuracy, no op amps</td><td>Large area, sensitive to parasitic capacitance</td></tr><tr><td>Binary-weighted charge amplifier</td><td>9.2-12</td><td>Best accuracy, fast</td><td>Large element spread, large area, limited by op amp</td></tr><tr><td>Current scaling subDACs using current division</td><td>9.3-3</td><td>Minimizes area, reduces element spread, which enhances accuracy</td><td>Sensitive to parasitic capacitance, divider must have $\pm  {0.5}$ LSB accuracy</td></tr><tr><td>Charge scaling subDACs using charge division</td><td>9.3-4</td><td>Minimizes area, reduces element spread, which enhances accuracy</td><td>Sensitive to parasitic capacitance, slower, divider must have $\pm  {0.5}$ LSB accuracy</td></tr><tr><td>Binary-weighted charge amplifier subDACs</td><td>9.3-6</td><td>Fast, minimizes area, reduces element spread, which enhances accuracy</td><td>Requires more op amps, divider must have $\pm  {0.5LSB}$ accuracy</td></tr><tr><td>Voltage scaling (MSBs), charge scaling (LSBs)</td><td>9.3-7</td><td>Monotonic in MSBs, minimum area, reduced element spread</td><td>Must trim or calibrate resistors for absolute accuracy</td></tr><tr><td>Charge scaling (MSBs), voltage scaling (LSBs)</td><td>9.3-9</td><td>Monotonic in LSBs, minimum area, reduced element spread</td><td>Must trim or calibrate resistors for absolute accuracy</td></tr><tr><td>Serial charge redistribution</td><td>9.4-1</td><td>Simple, minimum area</td><td>Slow, requires complex external circuits</td></tr><tr><td>Pipeline algorithmic</td><td>9.4-3</td><td>Repeated blocks, output at each clock after $N$ clocks</td><td>Large area for large number of bits</td></tr><tr><td>Serial algorithmic</td><td>9.4-4</td><td>Simple, one precise set of components</td><td>Slow, requires additional logic circuitry</td></tr></table>
### 9.5 Introduction and Characterization of Analog-Digital Converters

The second part of this chapter focuses on the analog-digital converter (ADC). The ADC is the inverse of the DAC. However, because of the nature of the input and output signals, there are some distinct differences. The major distinction is that the ADC by nature must be sampled. It is not possible to continuously convert the incoming analog signal to a digital output code. As a consequence, the ADC is a sampled-data circuit.
## Introduction to ADCs
Figure 9.5-1 shows a block diagram of a general ADC. A prefilter called an antialiasing filter is necessary to avoid the aliasing of higher frequency signals back into the baseband of the ADC. Often, the antialiasing filter is implemented by the bandlimiting characteristics of the ADC itself. The antialiasing filter is followed by a sample-and-hold circuit that maintains the input analog signal to the ADC constant during the time this signal is converted to an equivalent output digital code. This period of time is called the conversion time of the ADC. The conversion is accomplished by a quantization step. The nature of a quantizer is to segment the reference into subranges. Typically, there are ${2}^{N}$ subranges, where $N$ is the number of bits of the digital output code. The quantization step finds the subrange that corresponds to the sampled analog input. Knowing this subrange allows the digital processor to encode the corresponding digital bits. Thus, within the conversion time, a sampled analog input signal is converted to an equivalent digital output code.
The frequency response of the ADC of Fig. 9.5-1 is important to understand. Let us assume that the analog input signal has the frequency response shown in Fig. 9.5-2(a). Furthermore, assume that the frequency, ${f}_{B}$ , is the highest frequency of interest of the analog input signal. When the analog input signal is sampled at a frequency of ${f}_{S}$ , the frequency response shown in Fig. 9.5-2(b) results. The spectrum of the input signal is aliased at the sampling frequency and each of its harmonics. If the bandwidth of the signal, ${f}_{B}$ , is increased above ${0.5}{f}_{S}$ , the spectra begin to overlap as shown in Fig. 9.5-2(c). At this point it is impossible to recover the original signal. This concept is formalized in the Nyquist frequency or rate, which states that the sampling frequency must be at least twice the bandwidth of the signal in order for the signal to be recovered from the samples. Consequently, it is necessary to apply the prefilter of Fig. 9.5-1 to eliminate signals in the incoming analog input that are above ${0.5}{f}_{S}$ . This is shown in Fig. 9.5-2(d). The overlapping of the folded spectra also will occur if the bandwidth of the analog input signal remains fixed but the sampling frequency decreases below $2{f}_{B}$ . Even if ${f}_{B}$ is less than ${0.5}{f}_{S}$ as in Fig. 9.5-2(b), as we have seen in the previous chapter the antialiasing filter is necessary to eliminate the aliasing of signals in the upper passbands into the baseband, which is from 0 to ${f}_{B}$ .

Figure 9.5-1 General block diagram for an ADC.

Figure 9.5-2 (a) Continuous time frequency response of the analog input signal. (b) Sampled-data equivalent frequency response. (c) Case where ${f}_{B}$ is larger than ${0.5}{f}_{S}$ , causing aliasing. (d) Use of an antialiasing filter to avoid aliasing.
In order to maximize the input bandwidth of the ADC, one desires to make ${f}_{B}$ as close to ${0.5}{f}_{S}$ as possible. Unfortunately, this requires a very sharp cutoff for the prefilter or antialias-ing filter, which makes this filter difficult and complex to implement. The types of ADCs that operate in this manner are called Nyquist analog-to-digital converters. Later we will examine ADCs that have ${f}_{B}$ much less than ${0.5}{f}_{S}$ . These ADCs are called oversampling analog-to-digital converters. Table 9.5-1 gives the classification of various types of ADCs that will be discussed in this chapter.
Table 9.5-1 Classification of ADC Architectures
<table><tr><td>Conversion Rate</td><td>Nyquist ADCs</td><td>Oversampled ADCs</td></tr><tr><td>Slow</td><td>Integrating (serial)</td><td>Very high resolution $> {14}$ bits</td></tr><tr><td>Medium</td><td>Successive approximation 1-bit Pipeline Algorithmic</td><td>Moderate resolution $> {10}$ bits</td></tr><tr><td>Fast</td><td>Flash Multiple-bit pipeline Folding and interpolating</td><td>Low resolution $> 6$ bits</td></tr></table>
## Static Characterization of ADCs
The input of an ADC is an analog signal, typically an analog voltage, and the output is a digital code. The analog input can have any value between 0 and ${V}_{\mathrm{{REF}}}$ while the digital code is restricted to fixed or discrete amplitudes. Popular digital codes used for ADCs are shown in Table 9.5-2 and include binary, thermometer, Gray, and two's complement. The most widely used digital code is the binary code. Some codes have advantages over others that make them attractive. For example, the Gray and thermometer codes only change 1-bit from one code to the next.
The static characterization of ADCs is based on the input-output characteristic shown in Fig. 9.5-3 for a 3-bit ADC. In this particular characteristic, the input has been shifted so that the ideal step changes occur at analog input values of ${0.5LSB}\left( {{2i} - 1}\right)$ , where $i$ varies from 1 to $N$ for an $N$ -bit ADC.
Beneath the input-output characteristic of Fig. 9.5-3 is a plot of the quantization noise as a function of the input. The quantization noise is a plot of the difference between the infinite resolution characteristic and the ideal 3-bit characteristic as a function of the input voltage. The ideal ADC characteristic will have a quantization noise that lies between $\pm  {0.5}\mathrm{{LSB}}$ .
The definitions for dynamic range, the signal-to-noise ratio (SNR), and the effective number of bits (ENOB) of the ADC are the same as those given in Section 9.1 for the DAC. These quantities were referenced to the analog variable and in the case of the ADC are referenced to the digital output word.
The resolution of the ADC is the smallest analog change that can be distinguished by an ADC. Resolution may be expressed in percent of full scale (FS) but is typically given in the number of bits, $N$ , where the converter has ${2}^{N}$ possible output states.
The primary characteristics that define the static performance of converters are offset error, gain error, integral nonlinearity (INL), and differential nonlinearity (DNL). For an ADC with offset, let us shift the infinite resolution characteristic line horizontally until the quantization noise is symmetrical when referenced to this line (here we are assuming that other errors such as gain and nonlinearity are not dominant or have been removed from the characteristic). The horizontal difference between this line and the infinite resolution characteristic that passes through the origin is offset error. Offset error is illustrated in Fig. 9.5-4(a).
Gain error is a difference between the actual characteristic and the infinite resolution characteristic, which is proportional to the magnitude of the input voltage. The gain error can be thought of as a change in the slope of the infinite resolution line above or below a value of 1 .
Table 9.5-2 Digital Output Codes Used for ADCs
<table><tr><td>Decimal</td><td>Binary</td><td>Thermometer</td><td>Gray</td><td>Two's Complement</td></tr><tr><td>0</td><td>000</td><td>0000000</td><td>000</td><td>000</td></tr><tr><td>1</td><td>001</td><td>0000001</td><td>001</td><td>111</td></tr><tr><td>2</td><td>010</td><td>0000011</td><td>011</td><td>110</td></tr><tr><td>3</td><td>011</td><td>0000111</td><td>010</td><td>101</td></tr><tr><td>4</td><td>100</td><td>0001111</td><td>110</td><td>100</td></tr><tr><td>5</td><td>101</td><td>0011111</td><td>111</td><td>011</td></tr><tr><td>6</td><td>110</td><td>0111111</td><td>101</td><td>010</td></tr><tr><td>7</td><td>111</td><td>1111111</td><td>100</td><td>001</td></tr></table>

Figure 9.5-3 Ideal input-output characteristics of a 3-bit ADC.
Gain error is illustrated in Fig. 9.5-4(b). Similar to the DAC, gain error can be measured as the horizontal difference in ${LSBs}$ between actual and ideal finite resolution characteristics at highest digital code, i.e., between 110 and 111 on Fig. 9.5-4(b). In this example, it is assumed that all other errors such as offset and nonlinearity are not present.
The definition for integral nonlinearity(INL)of the ADC is the maximum difference between the actual finite resolution characteristic and the ideal finite resolution characteristic measured vertically in percent or LSBs. With this definition, we find that only integer values are permitted because the digital output codes correspond to discrete amplitudes. This is not a problem as the resolution increases and the ${LSB}$ becomes small. In addition, when measuring the ${INL}$ if the measurement equipment is sufficiently accurate, it is able to resolve the ${INL}$ to less than an ${LSB}$ .

Figure 9.5-4 (a) Example of offset error for a 3-bit ADC. (b) Example of gain error for a 3-bit ADC.

Figure 9.5-5 Example of ${INL}$ and ${DNL}$ for a 3-bit ADC.
Differential nonlinearity(DNL)of the ADC is defined as a measure of the separation between adjacent codes measured at each vertical step in percent or LSBs. The differential nonlinearity of an ADC can be written as
$$
{DNL} = \left( {{D}_{cx} - 1}\right) {LSBs} \tag{9.5-1}
$$
where ${D}_{cx}$ is the size of the actual vertical step in LSBs. Figure 9.5-5 shows the integral and differential nonlinearity for a 3-bit ADC referenced to the digital output code. We see that the largest and smallest values of ${INL}$ are $+ {1LSB}$ and $- {1LSB}$ , respectively. The largest and smallest values of ${DNL}$ are $+ {1LSB}$ and ${0LSB}$ , respectively. As compared to the DAC, a ${DNL}$ of -1LSB, which resulted from the case where a step should have occurred, does not happen for the ADC. For example, at an input voltage of $\frac{3}{16}$ on Fig. 9.5-5, the fact that a vertical jump does not occur cannot be considered as a DNL of $- 1\mathrm{{LSB}}$ .
Nonmonotonicity in an ADC occurs when a vertical jump is negative. Nonmonotonicity can only be detected by ${DNL}$ . Because output is limited to digital codes, all jumps are integers. Normally, the vertical jump is $1\mathrm{{LSB}}$ . If the jump is $2\mathrm{{LSBs}}$ or greater, missing output codes may occur. If the vertical jump is less than ${0LSB}$ , then the ADC is not monotonic. Figure 9.5-6 shows a 3-bit ADC characteristic that is not monotonic. Nonmonotonicity generally occurs when the MSB does not have sufficient accuracy. The change from 01111. . . . to 10000. . . . is the most difficult because the MSB must have the accuracy of $\pm  {0.5}\mathrm{{LSB}}$ or excessive ${DNL}$ will occur.

Figure 9.5-6 Example of nonmonotonic 3-bit ADC.
---
Example 9.5-1
---
## INL and DNL of a 3-bit ADC
Find the ${INL}$ and ${DNL}$ for the 3-bit ADC in Fig. 9.5-6.
## SOLUTION
The largest value of ${INL}$ for this 3-bit ADC occurs between $\frac{3}{16}$ and $\frac{5}{16}$ or $\frac{7}{16}$ and is ${1LSB}$ . The smallest value of ${INL}$ occurs between $\frac{11}{16}$ and $\frac{12}{16}$ and is $- {2LSBs}$ . The largest value of ${DNL}$ for this example occurs at $\frac{3}{16}$ or $\frac{6}{8}$ and is $+ {1LSB}$ . The smallest value of ${DNL}$ occurs at $\frac{9}{16}$ and is $- {2LSBs}$ , which is where the converter becomes nonmonotonic.
## Dynamic Characteristics of ADCs
The dynamic characteristics of ADCs have the same dependence as found in DACs, namely, parasitic capacitances and the op amps. In addition, in all ADCs at least one comparator is used. The comparator is used to determine whether the analog input is above or below a particular voltage. The static and dynamic performances of the comparator were studied in detail in Section 8.1. This information will be used to determine the dynamic behavior of ADCs and should be reviewed at the appropriate point in this chapter.
In some cases, the ADC may use an op amp that will influence both the static and dynamic performances. The material necessary to understand the influence of the op amp has been presented in Section 9.1 in regard to the static and dynamic performances of DACs.
## Sample-and-Hold Circuits
Because the sample-and-hold $\left( {\mathrm{S}/\mathrm{H}}\right)$ circuit is a key aspect of the ADC, it is worthwhile to determine its influence on the ADC. Figure 9.5-7 shows the waveforms of a practical sample-and-hold circuit. The acquisition time, indicated by ${t}_{a}$ , is the time during which the sample-and-hold circuit must remain in the sample mode to ensure that the subsequent hold-mode output will be within a specified error band of the input level that existed at the instant of the sample-and-hold conversion. The acquisition time assumes that the gain and offset effects have been removed. The settling time, indicated by ${t}_{s}$ , is the time interval between the sample-and-hold transition command and the time when the output transient and subsequent ringing have settled to within a specified error band. Thus, the minimum sample-and-hold time would be
$$
{T}_{\text{sample }} = {t}_{s} + {t}_{a} \tag{9.5-2}
$$

Figure 9.5-7 Waveforms for a sample-and-hold circuit.
The minimum conversion time for an ADC would be equal to ${T}_{\text{sample }}$ and the maximum sample rate is
$$
{f}_{\text{sample }} = \frac{1}{{T}_{\text{sample }}} \tag{9.5-3}
$$
In addition to the above characteristics of an $\mathrm{S}/\mathrm{H}$ circuit, there is an aperture time, which is the time required for the sampling switch to open after the $\mathrm{S}/\mathrm{H}$ command has switched from sample to hold. Another consideration of the aperture time is aperture jitter; which is a variation in the aperture time due to clock variations and noise. During the hold period of the $\mathrm{S}/\mathrm{H}$ a ${kT}/C$ noise exists because of the switch and hold capacitor.
Sample-and-hold circuits can be divided into two categories. These categories are $\mathrm{S}/\mathrm{H}$ circuits with no feedback and $\mathrm{S}/\mathrm{H}$ with feedback. In general, the use of feedback enhances the accuracy of the $\mathrm{S}/\mathrm{H}$ at the sacrifice of speed. The minimum requirement for an $\mathrm{S}/\mathrm{H}$ circuit is a switch and a storage element. Typically, the capacitor is used as the storage element. A simple open-loop buffered $\mathrm{S}/\mathrm{H}$ circuit is shown in Fig. 9.5-8(a). The unity-gain op amp is used to buffer the voltage across the hold capacitor. The ideal performance of this $\mathrm{S}/\mathrm{H}$ circuit is shown in Fig. 9.5-8(b). The sample mode occurs when the switch is closed and the analog signal is sampled on a capacitor ${C}_{H}$ . During the switch-open cycle or the hold mode, the voltage is available at the output.
The $\mathrm{S}/\mathrm{H}$ circuit of Fig. 9.5-8(a) is simple and fast. The capacitor, ${C}_{H}$ , is charged with the ${RC}$ time constant of the switch on resistance plus the source resistance of ${v}_{\text{in }}\left( t\right)$ . One disadvantage is that the source, ${v}_{\text{in }}\left( t\right)$ , must supply the current necessary to charge ${C}_{H}$ . The unity-gain op amp prevents the voltage from leaking off the capacitor and provides a low-resistance replica of the held voltage. The dc offset of the op amp and charge feedthrough of the switch will cause this replica to be slightly different.
An important dynamic limitation of the $\mathrm{S}/\mathrm{H}$ circuit is the settling time of the op amp such as the one used in Fig. 9.5-8(a). When an op amp with a dominant pole at ${\omega }_{a}$ and a second pole at approximately ${GB}$ is put in the unity-gain configuration the transfer function of the unity-gain configuration can be approximated as (see Appendix D)
$$
A\left( s\right)  \approx  \frac{G{B}^{2}}{{s}^{2} + {GB} \cdot  s + G{B}^{2}} \tag{9.5-4}
$$
Anytime a change is made on the input of the unity-gain buffer, Eq. (9.5-4) will determine the response. For example, if a step change of unity magnitude is made, the output voltage response is
$$
{v}_{\text{out }}\left( t\right)  = 1 - \left( {\sqrt{\frac{4}{3}}{e}^{-{0.5GB} \cdot  t}}\right) \sin \left( {\sqrt{\frac{3}{4}}{GB} \cdot  t + \theta }\right)  \tag{9.5-5}
$$

Figure 9.5-8 (a) Open-loop buffered S/H circuit. (b) Waveforms illustrating the operation of the sample-and-hold circuit of (a).
We know from Chapter 6 that the settling time is determined by how fast the term multiplying the sinusoid dies out. In fact, we can define the error as a function of time between the desired and actual output voltage as
$$
\text{ Error }\left( t\right)  = \varepsilon  = 1 - {v}_{\text{out }}\left( t\right)  = \sqrt{\frac{4}{3}}{e}^{-{0.5GB} \cdot  t} \tag{9.5-6}
$$
In most ADCs, the error is equal to $\pm  {0.5}\mathrm{{LSB}}$ . In this case, the voltage is normalized so that we can write
$$
\frac{1}{{2}^{N + 1}} = \sqrt{\frac{4}{3}}{e}^{-{0.5GB} \cdot  {t}_{s}} \rightarrow  {e}^{{0.5GB} \cdot  {t}_{s}} = \frac{4}{\sqrt{3}}{2}^{N} \tag{9.5-7}
$$
Solving for the time, ${t}_{s}$ , required to settle with $\pm  {0.5}\mathrm{{LSB}}$ from Eq. (9.5-7) gives
$$
{t}_{s} = \frac{2}{GB}\ln \left( {\frac{4}{\sqrt{3}}{2}^{N}}\right)  = \frac{1}{GB}\left\lbrack  {{1.3863N} + {1.6740}}\right\rbrack   \tag{9.5-8}
$$
We can easily see from Eq. (9.5-8) that as the resolution of the ADC increases, the settling time for any unity-gain buffer amplifier will increase. For example, if we are using the S/H circuit of Fig. 9.5-8(a) in a 10-bit ADC, the amount of time required for the unity-gain buffer with a ${GB}$ of $1\mathrm{{MHz}}$ to settle to within 10 -bit accuracy is ${2.473\mu }\mathrm{s}$ .
Many of the switched capacitor circuits of Appendix E can be applied to $\mathrm{S}/\mathrm{H}$ circuits. Figure 9.5-9(a) shows an $\mathrm{S}/\mathrm{H}$ circuit that charges $C$ to the input voltage during the ${\phi }_{1}$ phase period and inverts and applies this to a buffer amplifier. In order to remove charge injection and clock feedthrough dependent on the input, a delayed ${\phi }_{1}$ clock, ${\phi }_{1d}$ , is used. Figure 9.5- 9(b) shows a differential version of this $\mathrm{S}/\mathrm{H}$ circuit. The differential $\mathrm{S}/\mathrm{H}$ has the advantage of lower PSRR, cancellation of even harmonics, and reduction of the charge injection and clock feedthrough.

Figure 9.5-9 (a) Switched capacitor S/H circuit. (b) Differential version of (a).

Figure 9.5-10 (a) Diode bridge S/H circuit. (b) Practical implementation of (a).
$\mathrm{A}$ popular $\mathrm{S}/\mathrm{H}$ circuit that has been used for many years uses a diode bridge. The basic circuit is shown in Fig. 9.5-10(a). When the upper current source and lower current sink are turned on, they forward bias the diodes and connect the input to the output through a small-signal resistance of ${r}_{d} = 2{V}_{t}/{I}_{B}$ . When the current source and sink are off, the diodes are reverse biased and the hold capacitor is isolated from the input. The diodes can either be a gate-drain connected MOSFET or a ${pn}$ junction diode (diffusion into a well). The MOSFET has the advantage over the ${pn}$ junction of having little charge storage delay effect. A practical implementation of the concept of Fig. 9.5-10(a) is shown in Fig. 9.5-10(b). The advantages of this diode bridge $\mathrm{S}/\mathrm{H}$ circuit are that the clock feedthrough is signal independent, the sample uncertainty caused by the finite slope of the clocks is minimized, and during the hold phase the feedthrough from the input to the hold node is minimized because diodes D5 and D6 are essentially low-impedance paths to ${v}_{\text{out }}\left( t\right)$ .
In many ADCs, the comparator serves as the sample-and-hold function. Comparators that are clocked will sample the analog input and provide the binary output. The primary difficulty of clocked comparators is clock skew and clock jitter. All comparators must perform the binary decision at the same time to work correctly.
The second major category of sample-and-hold circuits are those that use feedback or are in a closed-loop configuration. The closed-loop configuration offers increased accuracy at the expense of speed. Figure 9.5-11 shows two $\mathrm{S}/\mathrm{H}$ circuits that operate in closed loop. The advantage of the input op amp is to permit quick charging and discharging of the hold capacitor. Figure 9.5-11(b) has an advantage over Fig. 9.5-11(a) in that charge injection and clock feedthrough will be independent of the input because one of the switch terminals is at ground.

Figure 9.5-11 (a) Closed-loop $\mathrm{S}/\mathrm{H}$ circuit. ${\phi }_{1}$ is the sample phase and ${\phi }_{2}$ is the hold phase. (b) An improved version of the $\mathrm{S}/\mathrm{H}$ hold circuit in (a).

Figure 9.5-12 (a) Switched capacitor S/H circuit that autozeroes the op amp input-offset voltage. (b) A differential S/H that avoids large changes at the op amp output.
In addition to the $\mathrm{S}/\mathrm{H}$ circuits in Fig. 9.5-11, many of the switched capacitor amplifiers presented in Appendix E can be used as $\mathrm{S}/\mathrm{H}$ circuits. Figure 9.5-12(a) shows a simple switched capacitor circuit that cancels the offset of the op amp. Figure 9.5-12(b) is a differential version of Fig. 9.5-12(a) that keeps the output of the op amp constant during the ${\phi }_{1}$ phase, thus avoiding slew-induced delays.
A current mode $\mathrm{S}/\mathrm{H}$ circuit is shown in Fig. 9.5-13. During the sample mode, the ${\phi }_{1}$ switches are closed and the current, ${i}_{\text{in }} + {I}_{B}$ , flows through the MOS diode charging the hold capacitor to the appropriate voltage. The hold mode occurs when the ${\phi }_{2}$ switch is closed. The hold capacitor causes ${i}_{\text{out }}$ to be equal to ${i}_{\text{in }}$ . If a dummy switch is used along with the ${\phi }_{1}$ switch connected to ${C}_{H}$ , this $\mathrm{S}/\mathrm{H}$ circuit is accurate to within 8 -bits. More information on current mode $\mathrm{S}/\mathrm{H}$ circuits can be found in the references [9,10].
Because the ADC is a sampled-data system, clock precision is important. Aperture jitter is a measure of this precision. Figure 9.5-14 shows how aperture jitter occurs. At some point in time, ${t}_{o}$ , the sampling of the analog signal or signals is to take place. However, due to jitter in the clock (or noise in the comparator), a time range of ${\Delta t}$ exists as shown in Fig. 9.5- 14. The aperture jitter, ${\Delta t}$ , causes an amplitude uncertainty indicated by ${\Delta V}.{\Delta V}$ is the same as noise on the signal and causes a lower end of the dynamic range if device noise and nonlinearity are ignored.

Figure 9.5-13 A simple current mode S/H circuit.

Figure 9.5-14 Illustration of aperture jitter in an ADC.
If we assume that the input is a sinusoid given as ${v}_{\text{in }}\left( t\right)  = {V}_{p}\sin {\omega t}$ , the maximum slope is equal to ${\omega }_{\text{in }}{V}_{p}$ . Therefore, the value of ${\Delta V}$ is given as
$$
{\Delta V} = \left| \frac{d{v}_{\text{in }}}{dt}\right| {\Delta t} = \omega {V}_{p}{\Delta t} \tag{9.5-9}
$$
The rms value of this noise is given as
$$
{\Delta V}\left( \mathrm{{rms}}\right)  = \left| \frac{d{v}_{\text{in }}}{dt}\right| {\Delta t} = \frac{\omega {V}_{p}\Delta \mathrm{t}}{2\sqrt{2}} \tag{9.5-10}
$$
The aperture jitter can lead to a limitation in the desired dynamic range of an ADC. For example, if the aperture jitter of the clock is ${100}\mathrm{{ps}}$ , and the input signal is a full scale peak-to-peak sinusoid at $1\mathrm{{MHz}}$ , the rms value of noise due to this aperture jitter is ${111\mu }\mathrm{V}\left( \mathrm{{rms}}\right)$ if the value of ${V}_{\mathrm{{REF}}} = 1\mathrm{\;V}$ . Note that the accuracy of the clock in this example must be 0.01% or greater.
## Testing of ADCs
The testing of the ADC has the same objectives as the DAC, namely, to verify the static and dynamic characteristics. The first test that can be applied to the ADC is the input-output test. The input-output test configuration is shown in Fig. 9.5-15. The input is swept from zero to ${V}_{\mathrm{{REF}}}$ and the digital output code is applied to a DAC with more accuracy than the ADC. It is sufficient if the DAC has an accuracy of 2-bits or greater than the ADC. The difference between the analog input and the output of the DAC is plotted as a function of the input.
The plot of the input-output test should be equal to the quantization plot for that ADC. If the ADC was ideal, the value of ${Q}_{n}$ would be constrained within $\pm  {0.5LSB}$ . The input-output test can be used to measure offset, gain error, INL, and DNL. Figure 9.5-16 shows a possible plot for a 4-bit ADC. The errors shown for ${INL}$ and ${DNL}$ are indicated on the plot. The nonlinearity errors referenced to the analog axis are found by the heights of the unit slope lines. Gain error would appear as a constant increase or decrease of the sawtooth plot as ${V}_{\text{in }}$ increased. Offset would be a constant shift above or below the 0LSB line.

Figure 9.5-15 Input-output test for a ADC.
Figure 9.5-16 should ideally be equal to the quantization noise of an ADC. When the number of bits increases, the individual detail shown on Fig. 9.5-16 is impossible to see unless the horizontal scale is greatly magnified. Generally, one will draw horizontal lines at $\pm  {0.5}\mathrm{{LSB}}$ and observe the trends outside these lines. One has to be able to compare a positive peak with the next negative peak to determine the ${DNL}$ . Note that at an analog input of 21/32 the ADC is nonmonotonic. It will be easier to see INL, offset, and gain errors as the number of bits becomes large.
If a pure sinusoidal generator is available, the reconstructed output of the input-output test, ${V}_{\text{in }}^{\prime }$ , can be applied to a distortion analyzer or spectrum analyzer to determine the dynamic range of the ADC. In order not to have any nonlinear errors, the dynamic range must be at least ${6N}\mathrm{\;{dB}}$ , where $N$ is the number of bits of the ADC. This measurement uses the setup of Fig. 9.1-10, where the digital pattern generator is replaced by the ADC driven with a harmonic-free sinusoid. If the input sinusoid is not pure, then its harmonics may mask the nonlinearity of the ADC. The analog sinusoided generator can be replaced by the first two blocks of Fig. 9.1-10 in order to generate a harmonic-free sinusoid. Again, the DAC used in this measurement must have more accuracy than the ADC.
An alternate approach to the above test is to store the digital output code of the ADC under test in a RAM buffer. After measurement, the buffer content is postprocessed using a fast Fourier transform to analyze the quantization noise and distortion components. Figure 9.5-17 shows the setup for this test called the FFT test. This test emphasizes the nonlinearity of the converter and can be static or dynamic, depending on the clock frequency. The harmonics of the input caused by the nonlinearity of the ADC will be aliased into the baseband spectrum of the ADC. One should ensure that the sinusoidal input signal does not coincide with these harmonics.

Figure 9.5-16 Illustration of the input-output test results for a 4-bit ADC.

When using the FFT test, one must be careful when applying the FFT. When small signals such as quantization noise are present at frequencies other than the signal frequency, their spectrum is masked by the leakage from the main signal and it is impossible to retrieve the ${SNR}$ accurately. Hence, an FFT obtained from the finite time sample is not a good estimate for the power spectrum of the original signal. This problem can be solved by using a window [11]. The "raised cosine" and "four-term Blackman-Harris" windows are often used in this application of the FFT.
The histogram or code test is used to alleviate the need for a pure sinusoid. A periodic waveform that covers the analog range is applied to the ADC. The number of times that each of the digital codes is outputted is stored. The number of occurrences is plotted as a function of the digital output code. Figure 9.5-18 shows what the results of the test might look like when sinusoid and triangle waveforms are applied to the ADC. Note that the histogram for a triangle waveform should ideally be flat.
The histogram or code test emphasizes the time spent at a given level and can show ${DNL}$ and missing codes. The number of counts in the $i$ th bin, $H\left( i\right)$ , divided by the total number of samples, ${N}_{t}$ , is the width of the bin as a fraction of full scale. The ratio of the bin width to the ideal bin width, $P\left( i\right)$ , is the differential linearity and should be unity. Subtracting one ${LSB}$ gives the differential nonlinearity in ${LSBs}$ as
$$
{DNL}\left( i\right)  = \frac{H\left( i\right) /{N}_{t}\left( i\right) }{P\left( i\right) } - 1 \tag{9.5-11}
$$
The integral nonlinearity is the deviation of the transfer function from the ideal and can be illustrated with the histogram test by compiling a cumulative histogram. The cumulative bin widths are the transition levels that allow the ${INL}$ to be characterized [12].
Other tests that can be used to characterize the ADC include the sinewave curve fitting and the beat frequency tests [13]. The sinewave curve fit is good for determining the effective number of bits (ENOB) while the beat frequency test serves as a qualitative test for dynamic performance. A comparison of these tests for an ADC is given in Table 9.5-3. Further information on ADC testing can be found in the references [5].

Figure 9.5-18 Histogram test results for sinusoidal and triangular inputs.
Table 9.5-3 Comparison of Tests for ADCs
<table><tr><td>Error</td><td>Histogram or Code Test</td><td>FFT Test</td><td>Sinewave Curve Fit Test</td><td>Beat Frequency Test</td></tr><tr><td>${DNL}$</td><td>Yes (spikes)</td><td>Yes (elevated noise floor)</td><td>Yes</td><td>Yes</td></tr><tr><td>Missing codes</td><td>Yes (bin counts with zero counts)</td><td>Yes (elevated noise floor)</td><td>Yes</td><td>Yes</td></tr><tr><td>INL</td><td>Yes (triangle input gives INL directly)</td><td>Yes (harmonics in the baseband)</td><td>Yes</td><td>Yes</td></tr><tr><td>Aperture uncertainty</td><td>No</td><td>Yes (elevated noise floor)</td><td>Yes</td><td>No</td></tr><tr><td>Noise</td><td>No</td><td>Yes (elevated noise floor)</td><td>Yes</td><td>No</td></tr><tr><td>Bandwidth errors</td><td>No</td><td>No</td><td>No</td><td>Yes (measures analog bandwidth)</td></tr><tr><td>Gain errors</td><td>Yes (peaks in distribution)</td><td>No</td><td>No</td><td>No</td></tr><tr><td>Offset errors</td><td>Yes (offset of distribution average)</td><td>No</td><td>No</td><td>No</td></tr></table>
In addition to testing of the ADC, the simulation is important. In most ADCs, simulation is accomplished by using macromodels to represent the blocks like comparators or op amps along with passive elements. Quite often, it is attractive to combine an iterative simulator such as SPICE with an analysis program to perform postprocessing of the simulator output. Another approach to ADC simulation is to combine the analysis program with $\mathrm{C}$ code to achieve the desired simulation. The objective of most simulation is to predict the performance and the impact of nonidealities before the fabrication of the ADC (or DAC). Such programs are particularly important in the area of oversampled ADCs and DACs.
## Design of a Sample-and-Hold Circuit
This is a good place to consider using the previous concepts and information to design a simple but challenging CMOS circuit. The circuit to be designed is the open-loop, buffered sample-and-hold circuit shown in Fig. 9.5-8(a). The specifications for the design are given in Table 9.5-4. The technology to be used is ${0.25\mu }\mathrm{m}$ CMOS and the parameters for this technology are given in Table 9.5-5.
Table 9.5-4 Design Specifications for Sample-and-Hold Circuit
<table><tr><td>Quantity</td><td>Condition</td><td>Value</td></tr><tr><td>Accuracy</td><td>System</td><td>10-bits</td></tr><tr><td>Clock frequency</td><td/><td>10 MHz</td></tr><tr><td>Power dissipation</td><td/><td>$\leq  1\mathrm{{mW}}$</td></tr><tr><td>Input and output signal level</td><td/><td>0-1 V</td></tr><tr><td>Slew rate</td><td>${C}_{L} = 1\mathrm{{pF}}$</td><td>100 V/us</td></tr></table>
Table 9.5-5 ${0.25\mu }\mathrm{T}$ echnology Parameters $\left( {{C}_{ox} = {60.6} \times  {10}^{-4}\mathrm{\;F}/{\mathrm{m}}^{2}}\right)$
<table><tr><td rowspan="2">Parameter Symbol</td><td rowspan="2">Parameter Description</td><td colspan="2">Typical Parameter Value</td><td rowspan="2">Units</td></tr><tr><td>n-Channel</td><td>p-Channel</td></tr><tr><td>${V}_{T0}$</td><td>Threshold voltage $\left( {{\mathrm{V}}_{\mathrm{{BS}}} = 0}\right)$</td><td>${0.5} \pm  {0.15}$</td><td>$- {0.5} \pm  {0.15}$</td><td>V</td></tr><tr><td>${K}^{\prime }$</td><td>Transconductance para- meter (in saturation)</td><td>120.0 ± 10%</td><td>${25.0} \pm  {10}\%$</td><td>$\mu \mathrm{A}/{\mathrm{V}}^{2}$</td></tr><tr><td>$\gamma$</td><td>Bulk threshold parameter</td><td>0.4</td><td>0.6</td><td>(V) ${}^{1/2}$</td></tr><tr><td>$\lambda$</td><td>Channel length</td><td>${0.32}\left( {L = {L}_{min}}\right)$</td><td>${0.56}\left( {L = {L}_{min}}\right)$</td><td>(V) ${}^{-1}$</td></tr><tr><td/><td>modulation parameter</td><td>${0.06}\left( {L \geq  2{L}_{min}}\right)$</td><td>${0.08}\left( {L \geq  2{L}_{min}}\right)$</td><td/></tr><tr><td>$2\left| {\phi \mathrm{{FI}}}\right|$</td><td>Surface potential at strong inversion</td><td>0.7</td><td>0.8</td><td>V</td></tr></table>
We begin the design by considering how much voltage gain is required for the op amp to maintain the accuracy requirement. From Eq. (9.1-20) we see that
$$
\text{ Gain error } = \frac{1}{1 + \text{ Loop Gain }} \leq  {0.5}\mathrm{{LSB}} = \frac{1}{{2}^{11}} \tag{9.5-12}
$$
Therefore, the op amp gain must be greater than ${2}^{11}$ or ${2048}\mathrm{\;V}/\mathrm{V}$ . To provide some margin we will choose the op amp voltage gain as $\geq  {5000}\mathrm{\;V}/\mathrm{V}$ .
Next, we consider the gain-bandwidth requirements. If we assume the op amp has a dominant pole, then for unity-gain feedback we can use the relationship found in Example 9.1-3, which gives the relationship between the gain-bandwidth(GB), the accuracy(N), and the speed $\left( {t}_{s}\right)$ . This relationship is
$$
T = {t}_{s} = \left( \frac{N + 1}{{\omega }_{H}}\right) \ln \left( 2\right)  = {0.693}\left( \frac{N + 1}{GB}\right)  \tag{9.5-13}
$$
Since there is a half-clock period ( ${50}\mathrm{\;{ns}}$ ) to accomplish the sample-and-hold operations we will set ${t}_{s} = {10}\mathrm{{ns}}$ , which allows five time constants for the dynamic response to settle out. Letting $N = {10}$ gives the gain-bandwidth as ${120}\mathrm{{MHz}}$ . Therefore, the dominant pole is 120 $\mathrm{{MHz}}/{5000}$ or ${24}\mathrm{{kHz}}$ . With an output capacitance of $1\mathrm{{pF}}$ , this means the output resistance of the op amp must be ${6.6}\mathrm{M}\Omega$ .
With the above information, let us select the folded-cascode op amp architecture. The gain and the output resistance should be easy to achieve without having to use the enhanced gain architecture. However, in order to have the $0 - 1\mathrm{\;V}$ signal range, a p-channel, differential input is selected. Choosing a power supply of ${2.5}\mathrm{\;V}$ (normal ${0.25\mu }\mathrm{m}$ technology will not allow more than a ${2.5}\mathrm{\;V}$ power supply) will ensure that the signal range of $0 - 1\mathrm{\;V}$ is achieved at the input. With regard to the output, the lower output swing will be minimized as much as possible and the unity-gain feedback around the op amp will allow the output voltage to effectively go to $0\mathrm{\;V}$ . The resulting op amp is shown in Fig. 9.5-19.
Next we design the op amp currents and sizes. First consider the currents. To achieve the ${100}\mathrm{\;V}/\mathrm{{\mu s}}$ slew rate in the $1\mathrm{{pF}}$ load capacitor requires ${100}\mathrm{{\mu A}}$ as the current for ${I}_{3}$ . Setting ${I}_{4} = {I}_{5} = {125\mu }\mathrm{A}$ gives a power dissipation of ${0.875}\mathrm{\;{mW}}$ with ${V}_{DD} = {2.5}\mathrm{\;V}$ . The transistor sizes are designed using the procedure of Table 6.5-4. Transistors M4-M7 will be designed to give a saturation voltage of ${0.1}\mathrm{\;V}$ with a ${125\mu }\mathrm{A}$ current. The $W/L$ values are
$$
\frac{{W}_{4}}{{L}_{4}} = \frac{{W}_{5}}{{L}_{5}} = \frac{{W}_{6}}{{L}_{6}} = \frac{{W}_{7}}{{L}_{7}} = \frac{2{I}_{D}}{{K}_{n}^{\prime } \cdot  {V}_{DS}{\left( \mathrm{{sat}}\right) }^{2}} = \frac{2 \cdot  {125}}{{120} \cdot  {0.01}} \approx  {200} \tag{9.5-14}
$$

Figure 9.5-19 The folded-cascode op amp used for the sample-and-hold design.
Since the upper output swing is not as important, choose a saturation voltage of ${0.25}\mathrm{\;V}$ for M8 through M11. The design of these $W/L$ values is
$$
\frac{{W}_{8}}{{L}_{8}} = \frac{{W}_{9}}{{L}_{9}} = \frac{{W}_{10}}{{L}_{10}} = \frac{{W}_{11}}{{L}_{11}} = \frac{2{I}_{D}}{{K}_{p}^{\prime } \cdot  {V}_{DS}{\left( \mathrm{{sat}}\right) }^{2}} = \frac{2 \cdot  {125}}{{25} \cdot  {0.0625}} = {160} \tag{9.5-15}
$$
To get the ${GB}$ of ${120}\mathrm{{MHz}}$ , this implies that the transconductance of M1 and M2 is
$$
{g}_{m} = {GB} \cdot  {C}_{L} = \left( {{120} \times  {10}^{6} \cdot  {2\pi }}\right) \left( {10}^{-{12}}\right)  = {762\mu }\mathrm{S} \tag{9.5-16}
$$
Therefore, the $W/L$ values of $\mathrm{M}1$ and $\mathrm{M}2$ become
$$
\frac{{W}_{1}}{{L}_{1}} = \frac{{W}_{2}}{{L}_{2}} = \frac{{g}_{m}^{2}}{2{I}_{D}{K}_{p}^{\prime }} = \frac{{762} \cdot  {762}}{2 \cdot  {25} \cdot  {50}} = {232} \tag{9.5-17}
$$
Let the upper input common-mode voltage be 1.5 , which gives the saturation voltage of M3 as
$$
{V}_{SD3} = 1\mathrm{\;V} - {V}_{SG1} = 1\mathrm{\;V} - {0.631}\mathrm{\;V} = {0.369}\mathrm{\;V} \tag{9.5-18}
$$
The $W/L$ of M3 is
$$
\frac{{W}_{3}}{{L}_{3}} = \frac{2{I}_{3}}{{K}_{p}^{\prime }{V}_{SD3}{\left( \mathrm{{sat}}\right) }^{2}} = \frac{2 \cdot  {100}}{{25} \cdot  {0.369}^{2}} = {58.75} \approx  {60} \tag{9.5-19}
$$

Figure 9.5-20 Magnitude response of the sample-and-hold on amp.
We now need to check the output resistance and the gain to make sure the specifications are satisfied. Let us choose twice the minimum channel length to keep the capacitive parasitics minimized and not have the output resistance too small. Therefore, at quiescent conditions we find that ${r}_{ds5} = {133}\mathrm{k}\Omega ,{r}_{ds7} = {222}\mathrm{k}\Omega ,{g}_{m7} = {1.935}\mathrm{\;{mS}}$ , and ${r}_{ds2} = {250}\mathrm{k}\Omega$ . Therefore, the output resistance looking down is
$$
{R}_{\text{outdown }} \approx  \left( {{r}_{ds5}\parallel {r}_{ds2}}\right) {g}_{m7}{r}_{ds7} = {37.29}\mathrm{M}\Omega  \tag{9.5-20}
$$
The small-signal parameters of the upper transistor are ${r}_{ds9} = {r}_{ds11} = {167}\mathrm{k}\Omega$ and ${g}_{m11} = {1.697}\mathrm{\;{mS}}$ . This gives the output resistance looking up as
$$
{R}_{\text{outup }} \approx  {r}_{ds11}{g}_{m9}{r}_{ds9} = {47.33}\mathrm{M}\Omega  \tag{9.5-21}
$$
Therefore, the output resistance of the op amp as designed is
$$
{R}_{\text{out }} = {R}_{\text{outdown }}\parallel {R}_{\text{outup }} = {20.86}\mathrm{M}\Omega  \tag{9.5-22}
$$
The low-frequency voltage gain is
$$
{A}_{v} \approx  {g}_{m1}{R}_{\text{out }} = {762\mu }\mathrm{S} \cdot  {20.86}\mathrm{M}\Omega  = {15},{886}\mathrm{\;V}/\mathrm{V} \tag{9.5-23}
$$
which is more than sufficient. The magnitude of the op amp frequency response is shown in Figure 9.5-20. We see that the basic specifications have been achieved.
We also need to design the bias voltages ${V}_{NB1},{V}_{NB2},{V}_{PB1}$ , and ${V}_{PB2}$ . This can be done using the circuit shown in Fig. 9.5-21 using the concepts of Fig. 4.5-7. The W/L ratios of M3, M4, and M7 are designed so that a current of ${10\mu }\mathrm{A}$ gives ${100\mu }\mathrm{A}$ in M3 of the op amp. Therefore, the $W/L$ of M3, M4, and M7 is 6. Similarly, the $W/L$ of M1 and M5 will be 16 so that a current of ${10\mu }\mathrm{A}$ in these transistors creates a current of ${125\mu }\mathrm{A}$ in $\mathrm{M}4$ and $\mathrm{M}5$ of the op amp. If $\mathrm{M}2$ is four times larger than $\mathrm{M}1\left( {W/L = {64}}\right)$ , then $R$ can be designed to give the ${10\mu }\mathrm{A}$ of current using the relationship of Eq. (4.5-21). Therefore,
$$
R = \frac{1}{\sqrt{2 \cdot  {K}_{n}^{\prime } \cdot  \left( {{W}_{2}/{L}_{2}}\right) {I}_{2}}} = \frac{{10}^{6}}{\sqrt{2 \cdot  {120} \cdot  {16} \cdot  {10}}} = {5.1}\mathrm{k}\Omega . \tag{9.5-24}
$$

Figure 9.5-21 Bias circuit for the op amp of Fig. 9.5-19.
The extra ${40\mu }\mathrm{A}$ brings the power dissipation to ${0.975}\mathrm{\;{mW}}$ , which is still within specification.
The $W/L$ of M8 is designed using the relationship that ${V}_{GS8} = {V}_{T} + 2{V}_{ON}$ . Thus,
$$
{V}_{GS8} - {V}_{T} = {0.2}\mathrm{\;V} = \sqrt{\frac{2 \cdot  {10}}{{120} \cdot  \left( {{W}_{8}/{L}_{8}}\right) }} \Rightarrow  \frac{{W}_{8}}{{L}_{8}} = {4.167} \tag{9.5-25}
$$
Similarly, the $W/L$ of M6 is 3.2.
The next aspect of the design is to look at the switch. Since the signal amplitude is from 0 to $1\mathrm{\;V}$ , a single NMOS switch should be satisfactory. The resistance of a minimum-size NMOS switch is
$$
{R}_{ON}\text{(worst case)} \approx  \frac{1}{{K}_{n}^{\prime }\left( {W/L}\right) \left( {{V}_{GS} - {V}_{T}}\right) } = \frac{{10}^{6}}{{120}\left( 1\right) \left( {{1.5} - {0.5}}\right) } = {8.33}\mathrm{k}\Omega  \tag{9.5-26}
$$
For a ${C}_{H} = 1\mathrm{{pf}}$ , the time constant is $8\mathrm{\;{ns}}$ . This is too close to the ${50}\mathrm{\;{ns}}$ so let us increase the switch size to ${0.5\mu }\mathrm{m}/{0.25\mu }\mathrm{m}$ , which gives a time constant of $4\mathrm{\;{ns}}$ . Therefore, the $W/L$ ratio of the NMOS switch is ${0.5\mu }\mathrm{m}/{0.25\mu }\mathrm{m}$ and the hold capacitor is 1 pf. Next, we need to check the error due to channel injection and clock feedthrough. If we assume the clock that rises and falls in $1\mathrm{\;{ns}}$ , then a ${0.5\mu }\mathrm{m}/{0.25\mu }\mathrm{m}$ switch works in the fast transition region. The channel/ clock charge error can be calculated from Eq. (4.1-10) as
$$
{V}_{\text{error }} =  - \left( \frac{{100} \times  {10}^{-{18}} + {0.5}\left( {{7.57} \times  {10}^{-{18}}}\right) }{1 \times  {10}^{-{12}}}\right) \left( {{0.8131} - \frac{{0.105} \times  {10}^{-3}}{{15} \times  {10}^{-3}}}\right)
$$
$$
- \frac{{100} \times  {10}^{-{18}}}{1 \times  {10}^{-{12}}}\left( {1 + 1 - 0}\right)  =  - {0.586}\mathrm{{mV}} \tag{9.5-27}
$$
For a 1 volt signal with 10 -bit accuracy, the error must be less than 1LSB, which is ${0.967}\mathrm{\;{mV}}$ . The channel/clock error is close to this value and one may have to consider using a CMOS switch or a dummy switch to reduce the error.
At this point the first step of the sample-and-hold design is complete. The designer should understand the strengths and weaknesses of the design. The next steps will not be done but are listed below:
1. Simulation to confirm and explore the hand-calculated performance
2. Layout of the op amp, hold capacitor, and switch
3. Verification of the layout
4. Extraction of the parasitics from the layout
5. Resimulation of the design
6. Checking for sensitivity to ESD and latch-up
7. Selection of package and include package parasitics in simulation

### 9.6 Serial Analog-Digital Converters
The serial ADC is similar to the serial DAC in that it performs serial operations until the conversion is complete. We shall examine two architectures called the single slope and the dual slope. Figure 9.6-1 gives the block diagram of a single-slope serial ADC. This type of converter consists of a ramp generator, an interval counter, a comparator, an AND gate, and a counter that generates the output digital word. At the beginning of a conversion cycle, the analog input is sampled and held and applied to the positive terminal of the comparator. The counters are reset and a clock is applied to both the interval counter and the AND gate. On the first clock pulse, the ramp generator begins to integrate the reference voltage ${V}_{\mathrm{{REF}}}$ . If ${v}_{\text{in }}^{ * }$ is greater than the initial output of the ramp generator, then the output of the ramp generator, which is applied to the negative terminal of the comparator, begins to rise. Because ${v}_{\text{in }}^{ * }$ is greater than the output of the ramp generator, the output of the comparator is high and each clock pulse applied to the AND gate causes the counter at the output to count. Finally, when the output of the ramp generator is equal to ${v}_{\text{in }}^{ * }$ , the output of the comparator goes low and the output counter is now inhibited. The binary number representing the state of the output counter can now be converted to the desired digital word format.
The single-slope ADC can have many different implementations. For example, the interval counter can be replaced by logic to detect the state of the comparator output and reset the ramp generator when its output has exceeded ${v}_{\text{in }}^{ * }$ . The serial ADC has the advantage of simplicity of operation. A disadvantage of the single-slope ADC is that it is subject to error in the ramp generator and is unipolar. Another disadvantage of the single-slope ADC is that a long conversion time is required if the input voltage is near the value of ${V}_{\mathrm{{REF}}}$ . The worst-case conversion time is ${2}^{N}T$ , where $T$ is the clock period.
The second type of serial ADC is called the dual-slope converter. A block diagram of a dual-slope ADC is shown in Fig. 9.6-2. The basic advantage of this architecture is that it elim-

Figure 9.6-1 Block diagram of a single-slope serial ADC.

Figure 9.6-2 Block diagram of a dual-slope ADC.
inates the dependence of the conversion process on the linearity and accuracy of the slope. Initially, ${v}_{\text{int }}$ is zero and the input is sampled and held. (In this scheme, it is necessary for ${v}_{\text{in }}^{ * }$ to be positive.) The conversion process begins by resetting the positive integrator by integrating a positive voltage (not shown) until the output of the integrator is equal to the threshold ${V}_{\text{th }}$ of the comparator. Next, switch 1 is closed and ${v}_{\text{in }}^{ * }$ is integrated for ${N}_{\text{REF }}$ number of clock cycles. Figure 9.6-3 illustrates the conversion process. It is seen that the slope of the voltage at ${V}_{\text{int }}$ is proportional to the amplitude of ${v}_{\text{in }}^{ * }$ . The voltage ${v}_{\text{int }}\left( {t}_{1}\right)$ at $t = {t}_{1}$ is given as
$$
{v}_{\text{int }}\left( {t}_{1}\right)  = K{\int }_{0}^{{N}_{REF}T}{v}_{\text{in }}^{ * }{dt} + {v}_{\text{int }}\left( 0\right)  = K{N}_{\text{REF }}T{v}_{\text{in }}^{ * } + {V}_{\text{th }} \tag{9.6-1}
$$
where $T$ is the clock period. At the end of ${N}_{\mathrm{{REF}}}$ counts, the carry output of the counter is applied to switch 2 and causes $- {V}_{\mathrm{{REF}}}$ to be applied to the integrator. Now the integrator integrates negatively with a constant slope, because ${V}_{\mathrm{{REF}}}$ is constant. When ${v}_{\text{int }}\left( t\right)$ becomes less than the value of ${V}_{\mathrm{{th}}}$ , the counter is stopped and the binary count can be converted into the digital word. This is demonstrated by considering the time at which ${v}_{\text{int }}\left( t\right)$ equals ${V}_{\text{th }}$ . The integrator voltage at ${t}_{1} + {t}_{2}$ is given as
$$
{v}_{\text{int }}\left( {{t}_{1} + {t}_{2}}\right)  = {v}_{\text{int }}\left( {t}_{1}\right)  + K{\int }_{{t}_{1}}^{{N}_{\text{out }}T + {t}_{1}}\left( {-{V}_{\mathrm{{REF}}}}\right) {dt} = {V}_{\text{th }} \tag{9.6-2}
$$
Substituting Eq. (9.6-1) into Eq. (9.6-2) gives
$$
\left\lbrack  {K{N}_{\mathrm{{REF}}}T{v}_{\text{in }}^{ * } + {V}_{\text{th }}}\right\rbrack   - K{V}_{\mathrm{{REF}}}{N}_{\text{out }}T = {V}_{\text{th }} \tag{9.6-3}
$$

Figure 9.6-3 Waveforms of the dual-slope ADC of Fig. 9.6-2. ${v}_{\text{in }}^{\prime \prime \prime } > {v}_{\text{in }}^{\prime \prime } > {v}_{\text{in }}^{\prime }$ .
Equation (9.6-3) can be solved for ${N}_{\text{out }}$ giving
$$
{N}_{\text{out }} = {N}_{\text{REF }}\frac{{v}_{\text{in }}^{ * }}{{V}_{\text{REF }}} \tag{9.6-4}
$$
It is seen that ${N}_{\text{out }}$ will be some fraction of ${N}_{\mathrm{{REF}}}$ , where that fraction corresponds to the ratio of ${v}_{\text{in }}^{ * }$ to ${V}_{\text{REF }}$ .
The output of the serial dual-slope DAC $\left( {N}_{\text{out }}\right)$ is not a function of the threshold of the comparator, the slope of the integrator, or the clock rate. Therefore, it is a very accurate method of conversion. The only disadvantage is that it takes a worst-case time of $2\left( {2}^{N}\right) T$ for a conversion, where $N$ is the number of bits of the ADC. The positive integrator of this scheme can be replaced by the switched capacitor integrators of Appendix E.
The above two examples of serial ADCs are representative of the architecture and resulting performance. Other forms of serial conversion exist in the literature $\left\lbrack  {{14},{15}}\right\rbrack$ . The serial ADC is expected to be slow but to provide a high resolution. Typical values for serial ADCs are conversion frequencies of less than ${100}\mathrm{\;{Hz}}$ and resolution greater than 12-bits.
### 9.7 Medium-Speed Analog-Digital Converters
The second category of ADCs in Table 9.5-1 has a medium-speed conversion rate. This class of ADCs converts an analog input into an $N$ -bit digital word in approximately $N$ clock cycles. Consequently, the conversion time is less than that of the serial converters, without a significant increase in the circuit complexity. The medium-speed ADCs examined here will include the successive-approximation converters (which use a combination of voltage scaling and charge scaling DACs), serial DACs, and algorithmic DACs.
## Successive-Approximation ADCs
Figure 9.7-1 illustrates the architecture of a successive-approximation ADC. This converter consists of a comparator, a DAC, and digital control logic. The function of the digital control logic is to determine the value of each bit in a sequential manner based on the output of the comparator. To illustrate the conversion process, assume that the converter is unipolar (only analog signals of one polarity can be applied). The conversion cycle begins by sampling the analog input signal to be converted. Next, the digital control circuit assumes that the ${MSB}$ is 1 and all other bits are zero. This digital word is applied to the DAC, which generates an analog signal of ${0.5}{V}_{\mathrm{{REF}}}$ . This is then compared to the sampled analog input, ${V}_{\text{in }}^{ * }$ . If the comparator output is high, then the digital control logic makes the MSB 1. If the comparator output is low, the digital control logic makes the MSB 0 . This completes the first step in the approximation sequence. At this point the value of the ${MSB}$ is known. The approximation process continues by once more applying a digital word to the DAC, with the ${MSB}$ having its proven value, the next lower bit a "guess" of 1 , and all the other remaining bits having a value of 0 . Again, the sampled input is compared to the output of the DAC with this digital word applied. If the comparator is high, the second bit is proven to be 1 . If the comparator is low, the second bit is 0 . The process continues in this manner until all bits of the digital word have been decided by successive approximation.

Figure 9.7-1 Example of a successive-approximation ADC architecture. (From E. R. Hnatek, A User's Handbook of D/A and A/D Converters. New York: Wiley, 1976.)

Figure 9.7-2 The successive-approximation process.
Figure 9.7-2 shows how the successive-approximation sequence works in converging to the analog output of the DAC closest to the sampled analog input. It is seen that the number of cycles for conversion to an $N$ -bit word is $N$ . It is also observed that as $N$ becomes large, the ability of the comparator to distinguish between almost identical signals must increase. Bipolar analog-digital conversion can be achieved by using a sign bit to choose either $+ {V}_{\mathrm{{REF}}}$ or $- {V}_{\mathrm{{REF}}}$ .
The digital control logic is often called a successive-approximation register (SAR). An example of a 5-bit SAR is shown in Fig. 9.7-3. This SAR has the advantage of compatibility with a bit-slice approach, which makes it attractive for integrated-circuit implementation. The bit-slice consists of a shift register (SR), an AND gate (G), registers or flip-flops (FF), and an analog switch (AS). The shift register at the bottom of this figure enables the various bit-slices starting from the left and moving to the right.
Figure 9.7-4 shows an example of a successive-approximation ADC that uses the voltage scaling and charge scaling DAC of Fig. 9.3-7. The extra components in addition to the DAC include a comparator and an SAR. From the concepts of Chapter 8, we know that the comparator should have a gain greater than $\left( {{V}_{L}{2}^{M + K}/{V}_{\mathrm{{REF}}}}\right)$ , where ${V}_{L}$ is the minimum output swing of the comparator required by the logic circuit it drives. For example, if $M + K = {12}$ and ${V}_{L} = {V}_{\mathrm{{REF}}}$ , then the comparator must have a voltage gain of at least 4096, where $M$ equals the number of bits scaled by voltage and $K$ equals the number of bits scaled by charge.
The conversion operation is described as follows. With the two ${S}_{F}$ switches closed, the bottom plates of the capacitors are connected by switches ${S}_{K, B}$ through ${S}_{1B}$ to ${V}_{\text{in }}^{ * }$ . The voltage stored on the capacitor array at the end of the sampling period is actually ${V}_{\text{in }}^{ * }$ minus the threshold voltage of the comparator, which removes the threshold as a source of offset error.

Figure 9.7-3 A 5-bit successive-approximation ADC with shift register control. (From E. R. Hnatek, A User's Handbook of D/A and A/D Converters. New York: Wiley, 1976.)
Note that the comparator must also work as an op amp in the unity-gain configuration and remain stable. Figure 9.7-5 shows a model that illustrates how the autozeroing takes place. The voltage across the parallel combination of all capacitors, ${2}^{K}C$ , is seen to be equal to
$$
{v}_{C} = {V}_{\text{in }}^{ * } - {V}_{OS} \tag{9.7-1}
$$
The offset voltage stored on the capacitors will cancel the comparator offset every time a comparison of the input to the comparator is made.

Figure 9.7-4 An $M$ -bit voltage-scaling, $K$ -bit charge-scaling, successive-approximation ADC.
Figure 9.7-5 A model for Fig. 9.7-4 when sampling the
After the ${S}_{F}$ switches are opened, a successive-approximation search among the resistor string taps for bus $B$ is performed to find the segment in which the stored sample lies. Figure 9.7-6(a) illustrates how Fig. 9.7-4 accomplishes this step. Note that the voltage at the comparator input is given as
$$
{v}_{\text{comp }} = {V}_{Ri} - \left( {{V}_{\text{in }}^{ * } - {V}_{OS}}\right)  - {V}_{OS} = {V}_{Ri} - {V}_{\text{in }}^{ * } \tag{9.7-2}
$$
where ${V}_{Ri}$ is the voltage of the resistor ladder at whatever point bus $B$ is connected. If ${v}_{\text{comp }} >$ 0, then ${V}_{Ri} > {V}_{\text{in }}^{ * }$ . The goal of the M-MSB-bits is to find the largest voltage of the ladder string where ${V}_{Ri} < {V}_{\text{in }}^{ * }$ . Once this is found, then bus $B$ is connected to this point and bus $A$ is connected to the next highest voltage, ${V}_{{Ri} + 1}.{V}_{\text{in }}^{ * }$ will lie somewhere between or equal to the voltages ${V}_{{Ri} + 1}$ and ${V}_{Ri}$ .
Next, the capacitor bottom plates are switched in a successive-approximation sequence until the comparator input voltage converges back to the threshold voltage. A simplified model of this operation is shown in Fig. 9.7-6(b) and draws from the model used in Fig. 9.3-8. The input to the comparator is given as
$$
{v}_{\text{comp }} = \left( {{V}_{{Ri} + 1} - {V}_{\text{in }}^{ * }}\right) \frac{{C}_{\mathrm{{eq}}}}{{2}^{K}C} + \left( {{V}_{Ri} - {V}_{\text{in }}^{ * }}\right) \frac{{2}^{K}C - {C}_{\mathrm{{eq}}}}{{2}^{K}C} \tag{9.7-3}
$$
However,
$$
{V}_{{Ri} + 1} = {V}_{Ri} + {2}^{-M}{V}_{\text{REF }} \tag{9.7-4}
$$
Substituting Eq. (9.7-4) into Eq. (9.7-3) yields
$$
{v}_{\text{comp }} = \left( {{V}_{Ri} + {2}^{-M}{V}_{\mathrm{{REF}}} - {V}_{\mathrm{{in}}}^{ * }}\right) \frac{{C}_{\mathrm{{eq}}}}{{2}^{K}C} + \left( {{V}_{Ri} - {V}_{\mathrm{{in}}}^{ * }}\right) \frac{{2}^{K}C - {C}_{\mathrm{{eq}}}}{{2}^{K}C} \tag{9.7-5}
$$
$$
= {V}_{Ri} - {V}_{\text{in }}^{ * } + {2}^{-M}{V}_{\mathrm{{REF}}}\frac{{C}_{\mathrm{{eq}}}}{{2}^{K}C}
$$

Figure 9.7-6 (a) Equivalent circuit for the successive-approximation search of the (a) ${MSB}$ subDAC and (b) ${LSB}$ subDAC.

Figure 9.7-7 A successive-approximation ADC using the serial DAC of Fig. 9.4-1.
As the ${LSB}$ successive-approximation proceeds, the value of ${C}_{\mathrm{{eq}}}/{2}^{K}C$ is selected to achieve a value of ${v}_{\text{comp }}$ as close to zero volts as possible.
The sequence of comparator outputs is a digital code corresponding to the unknown analog input signal. By driving the capacitor array directly through the MOS switches, there are no offset errors if enough time is allowed for the switching transients to settle. Also, the parasitic capacitors of all switches except ${S}_{F}$ do not cause errors because every node is driven to a final voltage that is independent of the capacitor parasitics after the switch transients have settled. The ADC in Fig. 9.7-4 is capable of 12-bit monotonic conversion with a differential nonlinearity of less than $\pm  {0.5}\mathrm{{LSB}}$ and a conversion time of ${50\mu }\mathrm{s}$ [6].
A successive-approximation ADC using the DAC of Fig. 9.4-1 is shown in Fig. 9.7-7. This converter works by converting the ${MSB}{a}_{N - 1}$ first. (The $i$ th-bit is denoted as ${d}_{i}$ for digital-analog conversion and ${a}_{i}$ for analog-digital conversion.) The control logic takes a very simple form because the digital-analog input string at any given point in the conversion is just the previously encoded word taken ${LSB}$ first. For example, consider the point during the ana- $\log$ -digital conversion where the first ${KMSBs}$ have been decided. To decide the $\left( {K + 1}\right) {MSB}$ , a $\left( {K + 1}\right)$ -bit word is formed in the digital-analog control register by adding a 1 as the ${LSB}$ to the $K$ -bit word already encoded in the data storage register. A $\left( {K + 1}\right)$ -bit digital-analog conversion then establishes the value of ${a}_{N - K - 1}$ by comparison with the unknown voltage ${V}_{\text{in }}^{ * }$ . The bit is then stored in the data storage register and the next serial digital-analog conversion is initiated. The conversion sequence is shown in detail in Table 9.7-1. Figure 9.7-8 illustrates a 4-bit analog-digital conversion for ${V}_{\text{in }}^{ * } = \frac{3}{16}{V}_{\text{REF }}$ . Altogether, $N\left( {N + 1}\right)$ clock cycles are required for an $N$ -bit ADC using the configuration of Fig. 9.7-7.
## Pipeline Algorithmic ADC
An algorithmic ADC patterned after the algorithmic DAC of Section 9.4 is shown in Fig. 9.7-9. This $N$ -bit ADC consists of $N$ stages and $N$ comparators for determining the signs of the $N$ outputs. Each stage takes its input, multiplies it by 2 , and adds or subtracts the reference voltage depending on the sign of the previous output. The comparator outputs form an $N$ -bit digital representation of the bipolar analog input to the first stage.
Table 9.7-1 Conversion Sequence for the Serial DAC of Fig. 9.7-7
<table><tr><td rowspan="2">Digital-Analog Conversion Number</td><td colspan="6">Digital-Analog Input Word</td><td rowspan="2">Comparator Output</td><td rowspan="2">Number of Charging Steps</td></tr><tr><td>${d}_{0}$</td><td>${d}_{1}$</td><td>${d}_{2}$</td><td>...</td><td>${d}_{N - 2}$</td><td>${d}_{N - 1}$</td></tr><tr><td>1</td><td>1</td><td>-</td><td>-</td><td/><td>-</td><td>-</td><td>${a}_{N - 1}$</td><td>2</td></tr><tr><td>2</td><td>1</td><td>${a}_{N - 1}$</td><td>-</td><td/><td>-</td><td>-</td><td>${a}_{N - 2}$</td><td>4</td></tr><tr><td>3</td><td>1</td><td>${a}_{N - 2}$</td><td>${a}_{N - 1}$</td><td>${d}_{0}$</td><td>-</td><td>-</td><td>${a}_{N - 3}$</td><td>6</td></tr><tr><td>-</td><td>-</td><td>-</td><td>-</td><td/><td>-</td><td>-</td><td>-</td><td>-</td></tr><tr><td>-</td><td>-</td><td>-</td><td>-</td><td/><td>-</td><td>-</td><td>-</td><td>-</td></tr><tr><td>-</td><td>-</td><td>-</td><td>-</td><td/><td>-</td><td>-</td><td>-</td><td>-</td></tr><tr><td>$N$</td><td>1</td><td>${a}_{1}$</td><td>${a}_{2}$</td><td>...</td><td>${a}_{N - 2}$</td><td>${a}_{N - 1}$</td><td>${a}_{0}$</td><td>${2N}$</td></tr><tr><td colspan="9">Total number of charging steps $= N\left( {N + 1}\right)$</td></tr></table>
Each of the stages of the pipeline algorithmic ADC are identical. The $i$ th stage takes the output of the previous stage, ${V}_{i - 1}$ , and during the next clock cycle it compares this voltage with ground and outputs the $i$ th-bit. In addition, the voltage ${V}_{i - 1}$ is multiplied by 2 and the reference voltage, ${V}_{\mathrm{{REF}}}$ , is added or subtracted depending on whether the comparator output is low or high, respectively. This is mathematically described as
$$
{V}_{i} = 2{V}_{i - 1} - {b}_{i - 1}{V}_{\text{REF }} \tag{9.7-6}
$$
where ${b}_{i - 1}$ is given as
$$
{b}_{i - 1} = \left\{  \begin{array}{ll}  + 1 & \text{ if }{V}_{i - 1} > 0 \\   - 1 & \text{ if }{V}_{i - 1} < 0 \end{array}\right.  \tag{9.7-7}
$$
The operation of the $i$ th stage is graphically portrayed in Fig. 9.7-10, where the output and input of the $i$ th stage normalized to ${V}_{\mathrm{{REF}}}$ are plotted.

Figure 9.7-8 Illustration of the operation of the successive-approximation ADC of Fig. 9.7-7 for the conversion of the sampled analog input voltage of $\frac{3}{16}{V}_{\mathrm{{REF}}}$ . The digital word out is ${b}_{0} = 1$ , ${b}_{1} = 1,{b}_{2} = 0$ , and ${b}_{3} = 1$ .

Figure 9.7-10 Output-input characteristics of the $i$ th stage.
---
Example 9.7-1
---
## Illustration of the Operation of the Pipeline Algorithmic ADC
Assume that the sampled analog input to a 4-bit pipeline algorithmic ADC is ${2.00}\mathrm{\;V}$ . If ${V}_{\mathrm{{REF}}}$ is equal to $5\mathrm{\;V}$ , find the digital output word and the analog equivalent voltage.
## SOLUTION
Since ${V}_{\text{in }}^{ * }\left( { = {2.00}\mathrm{\;V}}\right)$ is positive, the output of the comparator of stage 1 is high, corresponding to a digital 1 . Stage 1 then multiplies this value by 2 to get $4\mathrm{\;V}$ and subtracts ${V}_{\mathrm{{REF}}}$ to obtain an output of $- {1.00}\mathrm{\;V}$ . Stage 2 input sees a negative value, which causes the comparator of this stage to be low, which is equivalent to a digital 0 . Stage 2 then multiplies $- {1.00}\mathrm{\;V}$ by 2 and adds the ${5.0}\mathrm{\;V}$ reference to output a value of ${3.00}\mathrm{\;V}$ . Because the output of stage 2 is positive, the comparator of stage 3 is high, which causes the ${3.00}\mathrm{\;V}$ to be multiplied by 2 and subtracted by $5\mathrm{\;V}$ , giving a stage 3 output of $+ {1.00}\mathrm{\;V}$ . The conversion ends when the comparator of the fourth stage goes high because of the positive input voltage from stage 3 .
The digital output word is 1011 for this example. To determine whether this is correct, we use the following formula:
$$
{V}_{\text{analog }} = {V}_{\mathrm{{REF}}}\left\lbrack  {{b}_{0}{2}^{-1} + {b}_{1}{2}^{-2} + {b}_{2}{2}^{-3} + \cdots  + {b}_{N - 1}{2}^{-N}}\right\rbrack
$$
where ${b}_{i}$ is +1 if the $i$ th-bit is 1 and -1 if the $i$ th-bit is 0 . In this example, we see that
$$
{V}_{\text{analog }} = 5\left( {\frac{1}{2} - \frac{1}{4} + \frac{1}{8} + \frac{1}{16}}\right)  = 5\left( {0.4375}\right)  = {2.1875}
$$
It is seen that the value of ${V}_{\text{analog }}$ would eventually converge on the value of 2.00 .
It is illustrative to plot the results of this example on characteristics, similar to Fig. 9.7- 10, where each stage output is plotted as a function of the sampled input voltage ${V}_{\mathrm{{in}}}^{ * }$ . This is done in Fig. 9.-7-11. Note that at the normalized input voltage equal to 0.4 , a vertical line upward gives the normalized output voltage of each stage.

Figure 9.7-11 Output voltage for each stage as a function of ${V}_{\text{in }}^{ * }$ for Example 9.7-2.
The pipeline algorithmic ADC of Fig. 9.7-9 has the disadvantage that the time needed to convert a sample is $N$ clock cycles, although one complete conversion can be obtained at each clock cycle after a delay of ${NT}$ . The output voltage at any stage can be expressed as a function of the input and reference voltages. Combining the output-input voltage expressions of Eq. (9.7-6) for each of the four stages gives
$$
{V}_{4} = {2}^{4} \cdot  {V}_{\text{in }} - \left( {{2}^{3} \cdot  {b}_{0} + {2}^{2} \cdot  {b}_{1} + {2}^{1} \cdot  {b}_{2} + {2}^{0} \cdot  {b}_{3}}\right) {V}_{\text{REF }} \tag{9.7-8}
$$
In general, we can write the output voltage for the $N$ th stage as
$$
{V}_{N} = \mathop{\prod }\limits_{N}^{{i = 1}}{A}_{i}{V}_{\text{in }} - \left\lbrack  {\mathop{\sum }\limits_{{i = 1}}^{{N - 1}}\left( {\mathop{\prod }\limits_{{j = i + 1}}^{N}{A}_{j}}\right) {b}_{i - 1} + {b}_{N - 1}}\right\rbrack  {V}_{\text{REF }} \tag{9.7-9}
$$
where ${A}_{i}\left( {A}_{j}\right)$ is the actual gain of 2 for the $i$ th ( $j$ th) stage.
The accuracy of the pipeline algorithmic ADC depends on how well the voltage-transfer characteristic of Fig. 9.7-10 can be achieved. The possible errors for the pipeline algorithmic ADC include gain and offset errors. Gain errors can come from any multiplicative operation such as constants associated with the summing junctions of Fig. 9.7-9. Offset errors can come from the comparator or the summing junctions, where a constant amplitude shift is experienced, independent of the input. Equations (9.7-6) and (9.7-7) can be rewritten to include these errors as
$$
{V}_{i} = {A}_{i}{V}_{i - 1} + {V}_{OSi} - {b}_{i}{A}_{si}{V}_{\text{REF }} \tag{9.7-10}
$$
and
$$
{b}_{i} = \left\{  \begin{array}{ll}  =  + 1 & \text{ if }{V}_{i - 1} > {V}_{OCi} \\   =  - 1 & \text{ if }{V}_{i - 1} < {V}_{OCi} \end{array}\right.  \tag{9.7-11}
$$
where ${A}_{i}$ is the gain of " 2 " for the $i$ th stage, ${V}_{OSi}$ is the system offset errors of the $i$ th stage, ${A}_{si}$ is the gain of " 1 " for the summer, and ${V}_{OCi}$ is the comparator offset voltage. However, the summer gain error can be incorporated into the system offset errors because ${V}_{\mathrm{{REF}}}$ is a constant. These errors are illustrated in Fig. 9.7-12. Figure 9.7-12(a) illustrates the error in the $i$ th stage due to the gain of $2\left( {A}_{i}\right)$ . It is seen that the error becomes worse as the input increases. Figure 9.7-12(b) shows the effect of the system offset error, which amounts to a vertical shift in the characteristic of Fig. 9.7-9. Finally, Fig. 9.7-12(c) shows the influence of the comparator offset. The influence of these errors on the pipeline algorithmic ADC is complicated by the fact that they depend on the value of ${V}_{\text{in }}$ as one can see from Fig. 9.7-11.
Let us demonstrate how the error analysis could be made using the 4-bit example given in Eq. (9.7-8). We will examine the accuracy requirements of the times 2 multiplier designated as ${A}_{i}$ . Assume that the gain of 2 for the first stage is ${A}_{1} = 2 + \Delta {A}_{1}$ and all other stages are ideal. The difference between the actual, ${V}_{4}^{\prime }$ , and the ideal, ${V}_{4}$ , can be written as
$$
\left| {{V}_{4}^{\prime } - {V}_{4}}\right|  = {2}^{3} \cdot  \Delta {A}_{1}{V}_{\text{in }} \tag{9.7-12}
$$
An error will occur in the output of stage 4 if $\left| {{V}_{4}^{\prime } - {V}_{4}}\right|$ is greater than ${V}_{\mathrm{{REF}}}$ . Under this condition, the fourth-bit will be in error. We can write that
$$
\Delta {A}_{1} \leq  \frac{{V}_{\mathrm{{REF}}}}{{2}^{3}{V}_{\text{in }}} \tag{9.7-13}
$$
The smallest value of $\Delta {A}_{1}$ occurs when ${V}_{\text{in }} = {V}_{\text{REF }}$ , which gives
$$
\frac{\Delta {A}_{1}}{{A}_{1}} \leq  \frac{1}{{2}^{4}} \tag{9.7-14}
$$
It can be shown that the tolerance of ${A}_{2}$ will be twice the tolerance of ${A}_{1}$ , and so forth. The tolerance of the last stage gain is $\frac{1}{2}$ . Thus, we see that the first tolerance is the smallest and the last stage the largest. This trend holds true for the systematic offset errors and comparator errors. In general, we will find that the first stage of the pipeline algorithmic ADC must satisfy the following constraints. The value of ${V}_{\text{in }}$ will greatly influence these relationships.
$$
\frac{\Delta {A}_{1}}{{A}_{1}} \leq  \frac{1}{{2}^{N}},\;{V}_{OS1} \leq  \frac{{V}_{\mathrm{{REF}}}}{{2}^{N}}\text{, and}\;{V}_{OC1} \leq  \frac{{V}_{\mathrm{{REF}}}}{{2}^{N}} \tag{9.7-15}
$$

Figure 9.7-12 (a) Gain error, ${A}_{i}$ . (b) System offset error, ${V}_{OSi}$ . (c) Comparator offset error, ${V}_{OCi}$ .
---
Example 9.7-2
---
## Accuracy Requirements for a 5-bit Pipeline Algorithmic ADC
Show that if ${V}_{\text{in }} = {V}_{\text{REF }}$ , the pipeline algorithmic ADC will have an error in the fifth-bit if the gain of the first stage is 1.875, which corresponds to Eq. (9.7-14). Show the influence of ${V}_{\text{in }}$ on this result by repeating this example for values of ${V}_{\text{in }}$ of ${0.65}{V}_{\mathrm{{REF}}}$ and ${0.22}{V}_{\mathrm{{REF}}}$ .
## SOLUTION
For ${V}_{\text{in }} = {V}_{\mathrm{{REF}}}$ , we get the following results shown in Table 9.7-2. The input to the fifth stage is $0\mathrm{\;V}$ , which means that the bit is uncertain. If ${A}_{1}$ was slightly less than 1.875, the fifth-bit would be 0 , which would be in error. This result of course assumes that all stages but the first are ideal.
Table 9.7-2 The 4-bit Pipeline Algorithmic Performance ADC with ${V}_{\text{in }} = {V}_{\text{REF }}$
<table><tr><td>i</td><td>${V}_{i}\left( {{\mathrm{\;A}}_{1} = {2.0}}\right)$</td><td>Bit $i\left( {{\mathrm{\;A}}_{1} = {2.0}}\right)$</td><td>${V}_{i}\left( {{A}_{1} = {1.875}}\right)$</td><td>Bit $i\left( {{A}_{1} = {1.875}}\right)$</td></tr><tr><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td></tr><tr><td>2</td><td>1</td><td>1</td><td>0.875</td><td>1</td></tr><tr><td>3</td><td>1</td><td>1</td><td>0.750</td><td>1</td></tr><tr><td>4</td><td>1</td><td>1</td><td>0.500</td><td>1</td></tr><tr><td>5</td><td>1</td><td>1</td><td>0.000</td><td>?</td></tr></table>
Now let us repeat the above procedure for ${V}_{\text{in }} = {0.65}{V}_{\mathrm{{REF}}}$ . The results are shown in Table 9.7-3. We see that now an error occurs in the fourth-bit.
Table 9.7-3 The 5-bit Pipeline Algorithmic ADC Performance with ${V}_{\text{in }} = {0.65}{V}_{\text{REF }}$
<table><tr><td>$i$</td><td>${V}_{i}\left( {{A}_{1} = {2.0}}\right)$</td><td>Bit $i\left( {{A}_{1} = {2.0}}\right)$</td><td>${V}_{i}\left( {{A}_{1} = {1.875}}\right)$</td><td>Bit $i\left( {{A}_{1} = {1.875}}\right)$</td></tr><tr><td>1</td><td>+>65</td><td>1</td><td>0.65</td><td>1</td></tr><tr><td>2</td><td>+>30</td><td>1</td><td>0.21875</td><td>1</td></tr><tr><td>3</td><td>-0.40</td><td>0</td><td>-0.5625</td><td>0</td></tr><tr><td>4</td><td>+>20</td><td>1</td><td>-0.1250</td><td>0</td></tr><tr><td>5</td><td>-0.60</td><td>0</td><td>0.7500</td><td>1</td></tr></table>
Next, we repeat for ${V}_{\text{in }} = {0.22}{V}_{\mathrm{{REF}}}$ . The results are shown in Table 9.7-4. We see now that no errors occur.
Table 9.7-4 The 5-bit Pipeline Algorithmic ADC Performance with ${V}_{\text{in }}{50.22}{V}_{\text{REF }}$
<table><tr><td>$i$</td><td>${V}_{i}\left( {{A}_{1} = {2.0}}\right)$</td><td>Bit $i\left( {{A}_{1} = {2.0}}\right)$</td><td>${V}_{i}\left( {{A}_{1} = {1.875}}\right)$</td><td>Bit $i\left( {{A}_{1} = {1.875}}\right)$</td></tr><tr><td>1</td><td>+>22</td><td>1</td><td>0.20</td><td>1</td></tr><tr><td>2</td><td>-0.56</td><td>0</td><td>-0.5875</td><td>0</td></tr><tr><td>3</td><td>-0.12</td><td>0</td><td>-0.1750</td><td>0</td></tr><tr><td>4</td><td>+>76</td><td>1</td><td>0.6500</td><td>1</td></tr><tr><td>5</td><td>+>52</td><td>1</td><td>0.3000</td><td>1</td></tr></table>
We note that an error occurs in the 5-bit pipeline algorithmic ADC with ${A}_{1} = {1.875}$ for ${V}_{\text{in }} = {0.65}{V}_{\text{REF }}$ but not for ${V}_{\text{in }} = {0.22}{V}_{\text{REF }}$ , demonstrating the influence of the input on the accuracy of the pipeline algorithmic ADC. The reasons for the difference can clearly be seen from Fig. 9.7-11. For ${0.65}{V}_{\mathrm{{REF}}}$ , the fourth stage (the steepest slope) is near $0\mathrm{\;V}$ . Any error will most likely cause problems. For ${0.22}{V}_{\mathrm{{REF}}}$ , the fourth stage is at a normalized voltage of ${0.65}\mathrm{\;V}$ and will be less sensitive to errors. Based on this, the most robust values of ${V}_{\text{in }}/{V}_{\mathrm{{REF}}}$ will be near-1,0, and 1 .
## Iterative Algorithmic ADC
The iterative reduction of Fig. 9.7-9 can be applied to the ADC in a manner similar to that done for the pipeline algorithmic DAC. The analog output of the $i$ th stage can be expressed as
$$
{V}_{oi} = \left\lbrack  {2{V}_{o, i - 1} - {b}_{i}{V}_{\mathrm{{REF}}}}\right\rbrack  {z}^{-1} \tag{9.7-16}
$$
where ${b}_{i}$ is +1 if the $i$ th bit is 1 and -1 if the $i$ th bit is 0 . This equation can be implemented with the circuit in Fig. 9.7-13(a). The next step is to incorporate the ability to sample the analog input voltage at the start of the conversion. This step is shown in Fig. 9.7-13(b) [16]. In this implementation, $- {V}_{\mathrm{{REF}}}$ has been replaced with ground for simplicity. The iterative version of the algorithmic ADC consists of a sample-and-hold circuit, a gain-of-2 amplifier, a comparator, and a reference-subtraction circuit.

Figure 9.7-13 (a) Realization of Eq. (9.7-16). (b) Implementation of the iterative algorithmic ADC.
The operation of the converter consists of first sampling the input signal by connecting switch ${S1}$ to ${V}_{\text{in }}^{ * }.{V}_{\text{in }}^{ * }$ is then applied to the gain-of-2 amplifier. To extract the digital information from the input signal, the resultant signal, denoted as ${V}_{a}$ , is compared to the reference voltage. If ${V}_{a}$ is larger than ${V}_{\mathrm{{REF}}}$ , the corresponding bit is set to 1 and the reference voltage is then subtracted from ${V}_{a}$ . If ${V}_{a}$ is less than ${V}_{\mathrm{{REF}}}$ , the corresponding bit is set to 0 and ${V}_{a}$ is unchanged. The resultant signal, denoted by ${V}_{b}$ , is then transferred by means of switch ${S1}$ back into the analog loop for another iteration. This process continues until the desired number of bits have been obtained, whereupon a new sampled value of the input signal will be processed. The digital word is processed in a serial manner with the MSB first. An example illustrates the process.
## Conversion Process of an Iterative Algorithmic ADC
The iterative algorithmic ADC of Fig. 9.7-13(b) is to be used to convert an analog signal of ${0.8}{V}_{\mathrm{{REF}}}$ . Figure 9.7-14 shows the waveforms for ${V}_{a}$ and ${V}_{b}$ during the process. $T$ is the time for one iteration cycle.

Figure 9.7-14 Waveforms for Example 9.7-3 at (a) ${V}_{a}$ and (b) ${V}_{b}$ of Fig. 9.7-13(b).
SOLUTION
In the first iteration, the analog input of ${0.8}{V}_{\mathrm{{REF}}}$ is applied by switch ${S1}$ and results in a value of ${V}_{a}$ of ${1.6}{V}_{\mathrm{{REF}}}$ , which corresponds to a value of ${V}_{b}$ of ${0.6}{V}_{\mathrm{{REF}}}$ and the ${MSB}$ as 1 . During the next iteration, ${V}_{b}$ is multiplied by 2 to give ${V}_{a}$ of ${1.2}{V}_{\mathrm{{REF}}}$ . Thus, the next bit is also 1 and ${V}_{b}$ is ${0.2}{V}_{\mathrm{{REF}}} \cdot  {V}_{a}$ during the third iteration is ${0.4}{V}_{\mathrm{{REF}}}$ , making the next bit 0 and a value of ${0.4}{V}_{\mathrm{{REF}}}$ for ${V}_{b}$ . The fourth iteration gives ${V}_{a}$ as ${0.8}{V}_{\mathrm{{REF}}}$ , which gives ${V}_{b} = {0.8}{V}_{\mathrm{{REF}}}$ and the fourth-bit as 0 . The fifth iteration gives ${V}_{a} = {1.6}{V}_{\mathrm{{REF}}},{V}_{b} = {0.6}{V}_{\mathrm{{REF}}}$ , and the fifth-bit as 1 . This procedure continues as long as desired. The digital word after the fifth iteration is 11001 and is equivalent to an analog voltage of ${0.78125}{V}_{\mathrm{{REF}}}$ .
The iterative algorithmic ADC requires less precision hardware than the pipeline version. Its implementation in a monolithic technology can therefore be area efficient. A distinct advantage over the pipeline configuration is that the amplifiers having a gain of 2 are identical because only one amplifier is used in an iterative manner. Thus, only one accurate gain-of-2 amplifier is required. Sources of error of this ADC include low operational amplifier gain, finite input-offset voltage in the operational amplifier and comparator, charge injection from the MOS switches, and capacitance voltage dependence.
A 12-bit ADC using the approach of Fig. 9.7-13(b) had a differential nonlinearity and integral nonlinearity of ${0.019}\% \left( {0.8LSB}\right)$ and ${0.034}\% \left( {1.5LSBs}\right)$ , respectively, for a sample rate of $4\mathrm{{kHz}}$ . These values increased to ${0.022}\% \left( {0.9LSB}\right)$ and ${0.081}\% \left( {3.2LSBs}\right)$ for a sample rate of $8\mathrm{{kHz}}$ [16].
---
Example 9.7-3
---
## Self-Calibrating ADCs
The resolution of ADCs can be extended by allowing a self-calibration procedure. This procedure is popular with successive-approximation ADCs and is explained as follows. Self-calibration is accomplished during a calibration cycle of the ADC and may occur at startup or at various times during operation. The objective of self-calibration is to determine the errors caused by each-bit and to store those errors in a digital format that allows the correction to be automatically incorporated during normal operation when that particular bit is used in the conversion process.
Figure 9.7-15 shows a high-level schematic of a successive-approximation ADC using an $M$ -bit charge scaling DAC for the ${MSBs}$ and a $K$ -bit voltage scaling DAC for the ${LSBs}$ . In addition, a $M + 2$ -bit voltage scaling calibration DAC is used to apply the correction through the capacitor, $C$ .
The calibration procedure begins with the ${MSB}$ and connects the ${MSB}$ capacitor, ${C}_{1}$ , to ${V}_{\text{REF }}$ and the remaining capacitors, designated as $\overline{{C}_{1}}$ to ground. $\overline{{C}_{1}}$ can be written as
$$
\overline{{C}_{1}} = {C}_{2} + {C}_{3} + \cdots  + {C}_{M} + C \tag{9.7-17}
$$
This first step in the calibration of ${C}_{1}$ is illustrated in Fig. 9.7-16(a), where ${S1}$ of Fig. 9.7-15 is closed. In this case, the voltage of the autozeroing process puts the voltage ${V}_{\mathrm{{REF}}} - {V}_{OS}$ across ${C}_{1}$ . However, for simplicity we will assume that ${V}_{OS}$ is zero. Next, ${S1}$ is opened, ${C}_{1}$ is grounded, and ${\bar{C}}_{1}$ is connected to ${V}_{\mathrm{{REF}}}$ . The equivalent circuit for this step is given in Fig. 9.7-16(b). The voltage ${V}_{x1}$ can be expressed as
$$
{V}_{x1} = \left( \frac{\overline{{C}_{1}} - {C}_{1}}{{C}_{1} + \overline{{C}_{1}}}\right) {V}_{\text{REF }} \tag{9.7-18}
$$
If ${C}_{1}$ is equal to $\overline{{C}_{1}}$ , then ${V}_{x1}$ will be zero. However, if ${V}_{x1}$ is not zero, then the comparator will output either a high or low. Depending on the comparator output, the calibration circuitry makes a correction through the calibration DAC until the comparator output changes. At this point, the ${MSB}$ is calibrated and the ${MSB}$ correction voltage, ${V}_{\epsilon 1}$ , is stored digitally in the data register.

Figure 9.7-15 Self-calibration architecture for an $M$ -bit charge scaling, $K$ -bit voltage scaling successive-approximation ADC.

Figure 9.7-16 (a) Connection of ${C}_{1}$ to ${V}_{\text{REF }}$ . (b) Connection of $\overline{{C}_{1}}$ to ${V}_{\text{REF }}$ .
The remaining $M$ -bits are calibrated one at a time in the same manner with ${C}_{1}$ not part of the array. For example, ${C}_{2}$ is connected to ${V}_{\mathrm{{REF}}}$ and $\overline{{C}_{2}}$ is connected to ground similar to Fig. 9.7-16(a) where $\overline{{C}_{2}}$ is defined as
$$
\overline{{C}_{2}} = {C}_{3} + {C}_{4} + \cdots  + {C}_{M} + C \tag{9.7-19}
$$
Then $\overline{{C}_{2}}$ is connected to ${V}_{\mathrm{{REF}}}$ and ${C}_{2}$ to ground similar to Fig. 9.7-16(b). ${V}_{x2}$ would be given by Eq. (9.7-18) where the subscript 1 is replaced by 2 . As before, the correction voltage for this bit is stored digitally in the data register as ${V}_{\epsilon 2}$ . After ${C}_{2}$ has been calibrated, both ${C}_{1}$ and ${C}_{2}$ are removed from the array and ${C}_{3}$ is calibrated. The procedure continues until all the $M$ - bits have been calibrated.
During subsequent normal conversion cycles, the calibration logic is disengaged. The converter works the same way as an ordinary successive-approximation converter except that error-correction voltages are added or subtracted by proper adjustment of the calibration DAC digital input code. When the $n$ th-bit is used, the corresponding digital correction term is added to the correction terms accumulated from the first-bit through the(M - 1)th-bit. If the bit decision is 1, then the added result is stored in the accumulator. Otherwise, the digital correction term is dropped, leaving the accumulator with the previous result. The content of the accumulator is converted to an analog voltage by the calibration DAC. This voltage is then applied to the main DAC output voltage through the capacitor $C$ . The overall operation precisely cancels the nonlinearity due to capacitor mismatches by subtracting the error voltage, ${V}_{xi}$ , from the main DAC. The only extra operation involved in a normal conversion cycle is one two’s-complement addition. Note that the LSB subDAC has not been calibrated in this example.
The successive-approximation and algorithmic ADCs have been presented as examples of medium-speed ADCs. The successive-approximation ADC is a very general realization for the medium-speed ADC. It can make use of any of the previous DACs, as we have illustrated. If serial DACs are used, the conversion time of the successive-approximation converter is increased and the area required is decreased. In general, medium-speed ADCs can have conversion rates that fall within the ${10}^{4} - {10}^{5}$ conversions/second range. They are also capable of 8-12-bits of untrimmed accuracy. The number of bits can be increased if trimming or self-calibration is used.
### 9.8 High-Speed Analog-Digital Converters
In many applications, it is necessary to have a smaller conversion time than is possible with the previous ADC architectures. This has led to the development of high-speed ADCs that use parallel techniques to achieve short conversion times. The ultimate conversion speed is one clock cycle, which would typically consist of a setup and convert phase. Some of the high-speed architectures compromise speed with area and require more than one clock cycle but less than the $N$ clock cycles required for the medium-speed A/D architectures. Another method of improving the speed of the converter is to increase the speed of the individual components. Typically, the sample time is the limiting factor for the speed. The sample time may be due to the sample-and-hold circuit and/or comparators. In this presentation, we shall consider the parallel pipeline with multiple-bits/stage, digital error correction, and folding and interpolation approaches to implementing high-speed ADCs.
## Parallel or Flash ADCs
The highest speed ADC is the parallel or flash ADC. An example of this converter is illustrated in Fig. 9.8-1. Figure 9.8-1 is a 3-bit parallel ADC. ${V}_{\text{REF }}$ is divided into eight values as indicated on the figure. Each of these values is applied to the positive terminal of a comparator. The outputs of the comparators are taken to a digital encoding network that determines the digital output word from the comparator outputs. For example, if ${V}_{\text{in }}^{ * }$ is ${0.7}{V}_{\mathrm{{REF}}}$ , then the top two comparators' outputs are 1 , and the bottom five are 0 . The digital encoding network would identify 101 as the corresponding digital word. Many versions of this basic parallel ADC exist. For example, one may wish the voltage at the taps to be in multiples of ${V}_{\mathrm{{REF}}}/{16}$ with ${V}_{\mathrm{{REF}}}/8$ voltage differences between the taps. Also, the resistor string can be connected between $+ {V}_{\mathrm{{REF}}}$ and $- {V}_{\mathrm{{REF}}}$ to achieve bipolar conversion.
The parallel or flash ADC of Fig. 9.8-1 converts the analog signal to a digital word in one clock cycle that has two phase periods. During the first phase period, the analog input voltage is sampled and applied to the comparator inputs. During the second phase period, the digital encoding network determines the correct output digital word and stores it in a register/buffer. Thus, the conversion time is limited by how fast this sequence of events can occur. Typical sampling frequencies can be as high as ${400}\mathrm{{MHz}}$ for 6 -bits in submicron CMOS technology $\left\lbrack  {{17},{18}}\right\rbrack$ .

The performance of the parallel ADC depends on the ability to sample the input without jitter. There are two approaches that have been used on parallel or flash ADCs. The first is to use a sample-and-hold at the input. The disadvantage of this approach is that the sample time of the sample-and-hold circuit may not be small enough. The second approach is to use clocked comparators. These comparators were discussed in Chapter 8 under the topic of high-speed comparators. It is extremely important that all comparators are clocked simultaneously to avoid jitter, which reduces the resolution at high speeds.
The offset voltage of the comparator is important if the number of bits is 6 or more. The following example illustrates this influence of the comparator on the flash ADC.
---
Example 9.8-1
---
## Influence of the Comparator Offset on the ADC Performance
Two comparators are shown of an $N$ -bit flash ADC in Fig. 9.8-2. Comparators 1 and 2 have an offset voltage indicated as ${V}_{OS1}$ and ${V}_{OS2}$ , respectively. A portion of the ideal transfer function of the converter is also shown. (a) When do the comparator offsets cause a missing code? Express this condition in terms of ${V}_{OS1},{V}_{OS2}, N$ , and ${V}_{\text{REF }}$ . (b) Assume all offsets are identical and express the magnitude of ${INL}$ in terms of ${V}_{OS1}\left( { = {V}_{OS2}}\right) , N$ , and ${V}_{\text{REF }}$ . (c) Express the ${DNL}$ in terms of ${V}_{OS1},{V}_{OS2}, N$ , and ${V}_{\text{REF }}$ .

Figure 9.8-2 Flash ADC for Example 9.8-1.
## SOLUTION
(a) We note that comparator 1 changes from a 0 to 1 when ${V}_{\text{in }}\left( 2\right)  > {V}_{R2} - {V}_{OS2}$ and comparator 2 changes from a 0 to 1 when ${V}_{\text{in }}\left( 1\right)  > {V}_{R1} - {V}_{OS1}$ . A missing code will occur if ${V}_{\text{in }}\left( 2\right)$ $< {V}_{\text{in }}\left( 1\right)$ . Therefore,
$$
{V}_{R2} - {V}_{OS2} < {V}_{R1} - {V}_{OS1} \rightarrow  {V}_{R2} - {V}_{R1} < {V}_{OS2} - {V}_{OS1}
$$
But
$$
{V}_{R2} - {V}_{R1} = \frac{{V}_{\mathrm{{REF}}}}{{2}^{N}} \rightarrow  \left| {{V}_{OS2} - {V}_{OS1}}\right|  < \frac{{V}_{\mathrm{{REF}}}}{{2}^{N}}
$$
(b) If all offsets are alike and equal to ${V}_{OS}$ , we can write that the ${INL}$ is given as the worst-case deviation about each ${V}_{Ri}$ :
$$
{INL} = \frac{\left| {V}_{OS}\right| }{{V}_{LSB}} = \frac{\left| {V}_{OS}\right| }{{V}_{\mathrm{{REF}}}/{2}^{N}} = \frac{{2}^{N}\left| {V}_{OS}\right| }{{V}_{\mathrm{{REF}}}}
$$
(c) The DNL can be expressed as the difference between the offset deviations as
$$
{DNL} = \frac{\left( {{V}_{R2} - {V}_{OS2}}\right)  - \left( {{V}_{R1} - {V}_{OS1}}\right)  - {V}_{LSB}}{{V}_{LSB}} = \frac{{V}_{LSB} - {V}_{OS2} + {V}_{OS1} - {V}_{LSB}}{{V}_{LSB}}
$$
$$
= \frac{\left| {V}_{OS1} - {V}_{OS2}\right| }{{V}_{LSB}} = \frac{{2}^{N}\left| {{V}_{OS1} - {V}_{OS2}}\right| }{{V}_{\text{REF }}}
$$
The parallel ADC has several important limitations that must be considered. The first is that the number of comparators required for an $N$ -bit flash ADC is ${2}^{N} - 1$ . For a 6-bit flash ADC, this is 63 comparators. Both area and power become issues in the parallel ADC as the resolution increases. Another problem is the input bandwidth. With ${2}^{N} - 1$ comparators connected to the input, the input capacitance will be large, causing the analog input bandwidth to be small, given as the inverse product of the source resistance and the input capacitance. The bandwidth restrictions can be eliminated by the use of a sample-and-hold circuit. If multiple sample-and-hold circuits or clocked comparators are used, care must be taken to avoid jitter. Because of the high speeds, it is necessary to consider the physical aspects of routing from the source of the clock to the destination of the clock. For example, assume a ${250}\mathrm{{MHz}}$ sinusoid with a peak-to-peak range of ${V}_{\mathrm{{REF}}}$ is applied to the ADC. For a reference voltage of $2\mathrm{\;V}$ and an 8-bit ADC, this means the clock must be accurate to within
$$
{\Delta t} \leq  \frac{\Delta V}{\omega {V}_{p}} = \frac{{V}_{\mathrm{{REF}}}/{2}^{N + 1}}{{2\pi f}\left( {{0.5}{V}_{\mathrm{{REF}}}}\right) } = \frac{1}{{2}^{9} \cdot  {\pi f}} = {2.5}\mathrm{{ps}} \tag{9.8-1}
$$
Considering the fact that electrical signals travel at approximately ${50\mu }\mathrm{m}/\mathrm{{ps}}$ in metal connections, techniques like tree routing (similar in concept to the successive-approximation structure of Fig. 9.7-2) must be used to ensure identical path lengths in high-speed ADCs.
Example
## Comparator Bandwidth Limitations on the Flash ADC
9.8-2 The comparators of a 6-bit flash ADC have a dominant pole at ${10}^{3}\mathrm{{rad}}/\mathrm{s}$ , a dc gain of ${10}^{4}$ , a slew rate of $3\mathrm{\;V}/\mu \mathrm{s}$ , and a binary output voltage of $1\mathrm{\;V}$ and $0\mathrm{\;V}$ . Assume that the conversion time is the time required for the comparator to go from its initial state to halfway to its final state. What is the maximum conversion rate of this ADC if ${V}_{\mathrm{{REF}}} = 5\mathrm{\;V}$ ? Assume the resistor ladder is ideal.
## SOLUTION
The output of the $i$ th comparator can be found by taking the inverse Laplace transform of
$$
{V}_{\text{out }}\left( s\right)  = \left( \frac{{A}_{o}}{\left( {s/{10}^{3}}\right)  + 1}\right) \left( \frac{{V}_{\text{in }}^{ * } - {V}_{Ri}}{s}\right)
$$
to get
$$
{v}_{\text{out }}\left( t\right)  = {A}_{o}\left( {1 - {e}^{-{10}^{3}t}}\right) \left( {{V}_{\text{in }}^{ * } - {V}_{Ri}}\right)
$$
The worst case occurs when
$$
{V}_{\text{in }}^{ * } - {V}_{Ri} = {0.5}{V}_{LSB} = \frac{{V}_{\mathrm{{REF}}}}{{2}^{7}} = \frac{5}{128}
$$
$$
\therefore {0.5}\mathrm{\;V} = {10}^{4}\left( {1 - {e}^{-{10}^{3}T}}\right) \left( {5/{128}}\right)  \rightarrow  \frac{64}{5 \cdot  {10}^{4}} = 1 - {e}^{-{10}^{3}T}
$$
or
$$
{e}^{-{10}^{3}T} = 1 - \frac{64}{{50},{000}} = {0.99872} \rightarrow  T = {10}^{-3}\ln \left( {1.00128}\right)  = {1.281\mu }\mathrm{s}
$$
$$
\therefore \text{Maximum conversion rate} = \frac{1}{{1.281\mu }\mathrm{s}} = {0.781} \times  {10}^{6}\text{samples/second}
$$
Check the influence of the slew rate on this answer.
$$
{SR} = 3\mathrm{\;V}/\mu \mathrm{s} \rightarrow  \frac{\Delta V}{\Delta T} = 3\mathrm{\;V}/\mu \mathrm{s} \rightarrow  {\Delta V} = 3\mathrm{\;V}/\mu \mathrm{s}\left( {{1.281\mu }\mathrm{s}}\right)  = {3.84}\mathrm{\;V} > 1\mathrm{\;V}
$$
Therefore, slew rate does not influence the maximum conversion rate.
Other sources of error are the resistor string. If any current is drawn from the taps, this will create a bowing in the ADC characteristic. This can be removed by applying the correct voltage to various points of the resistor string or by increasing the current flow in the resistor string at the cost of power dissipation. A design challenge for the flash architecture is to keep the input common-mode range effects from influencing the comparators. The challenge is to keep the delay of the comparator at the top of the resistor string identical to the comparator at the bottom. This is difficult unless one uses power supplies that exceed ${V}_{\mathrm{{REF}}}$ by a factor of 2 or more. This solution, however, reduces the dynamic range of the analog input signal.
Most high-speed comparators exhibit a problem called kickback or flashback. Kickback is the influence of rapid transitions in the comparator appearing at the input of the comparator. The kickback can be isolated from other comparator inputs by using a preamplifier or buffer in front of the comparator. Another problem has to do with the uncertainty of the comparator output. This uncertainty is called metastability and is due to noise, crosstalk, bandwidth limitations, and so on. The result is that the transition point of the thermometer code output is not distinct. Instead of being all 0 's up to some point then all 1 's, the transition region may oscillate between 0 's and 1 's. Generally, this uncertainty only exists over the comparators near the transition point. There are methods for removing this uncertainty, which use simple logic circuits that have adjacent comparator outputs as their input [19,20].
## Interpolating ADCs
As a first improvement to the parallel ADC, consider the use of interpolation to reduce the number of comparators or amplifiers connected to the input. Figure 9.8-3 shows a 3-bit interpolating ADC using a factor of 4 interpolation. Here the amplifiers are linear in their midrange and saturate at the extremes (similar to a differential amplifier). Note that the power supply to the amplifiers is ${V}_{DD}$ , which is assumed to be larger than ${V}_{\mathrm{{REF}}}$ . The output of the two amplifiers is shown in Fig. 9.8-4 and is idealized for simplicity. Note that the comparators are all biased to the same threshold voltage, ${V}_{\mathrm{{th}}}$ . Because of the amplification of the amplifiers and the single threshold, the comparators can be very simple and are often replaced with a latch.
The only requirement is that the threshold of each comparator (latch) is equally spaced between the values of $0,{V}_{1}$ , and ${V}_{2}$ . These points are represented by the dots in Fig. 9.8-4 numbered 1 through 8 to correspond with the comparators of Fig. 9.8-3. If these points are not equally spaced, then ${INL}$ and ${DNL}$ will result. Interpolation has provided less capacitance on the input, which enhances the analog input signal bandwidth and has allowed a much simpler comparator to be used. As a consequence, interpolating ADCs should be as fast or faster than noninterpolating ADCs.
The interpolating can be done by current as well as voltage. Figure 9.8-5 shows how current mirrors can be used to interpolate between the currents ${I}_{1}$ and ${I}_{2}$ [21]. This type of interpolation is sometimes called active interpolation.
One of the problems in voltage (passive) interpolation of Fig. 9.8-3 is that the delay from the amplifier output to each comparator can be different due to different resistance. Because this delay is primarily due to the series resistance between the amplifier output and the comparator input and the input capacitance to the comparator, it can be approximately equalized by adding resistance in series with some of the comparator input as shown in Fig. 9.8-6.

Figure 9.8-3 A 3-bit interpolating ADC with an interpolation factor of 4 .

Figure 9.8-4 Illustration of the interpolation achieved in Fig. 9.8-3.
A problem occurs when the input to an interpolating ADC is sinusoidal. The two signals, ${V}_{1}$ and ${V}_{2}$ , are used to interpolate the signals ${V}_{2a},{V}_{2b}$ , and ${V}_{2c}$ . It can be shown that while the middle interpolated signal, ${V}_{2b}$ , has no error, the signals ${V}_{2a}$ and ${V}_{2c}$ have a phase error of ${0.45}^{ \circ  }$ , which results in a relative phase error of about $1\%$ . This phase error can contribute to ${INL}$ . Better results can be achieved by using a two-stage interpolating network to minimize the phase difference between the amplifier outputs [22]. The resolution of the interpolating ADC is limited by the accuracy of the interpolation. The maximum sampling rate becomes dependent on the equalization of the pertinent path delays. As the sampling rate approaches the maximum rate, the resolution will decrease. Present CMOS interpolating ADCs are capable of 8-bits at lower sample rates and a maximum sampling rate of ${100}\mathrm{{MHz}}$ with about6- bit resolution [19].
## Folding ADCs
The folding ADC allows the number of comparators to be reduced below the value of ${2}^{N} - 1$ for the typical parallel flash ADC. The architecture for a folded ADC is shown in Fig. 9.8-7. The input is split into two parallel paths. The first path is a coarse quantizer that quantizes the input signal into ${2}^{N1}$ values. The second path takes the input and preprocesses it through a folding circuit that maps all of the ${2}^{N1}$ subranges onto a single subrange and applies this analog signal to a fine quantizer of ${2}^{N2}$ subranges. The total number of comparators is ${2}^{N1} - 1$ plus ${2}^{N2} - 1$ compared with ${2}^{{N1} + {N2}} - 1$ for an equivalent resolution parallel ADC. In other words, if ${N1} = 2$ and ${N2} = 4$ , the folding ADC requires 18 comparators compared with 63 comparators required for a 6-bit parallel ADC.

Figure 9.8-5 Current (active) interpolation using current mirrors.

Figure 9.8-6 A 3-bit interpolating ADC with approximately equalized comparator delays.
The folding process is illustrated in Fig. 9.8-8. Folding takes the full scale range and divides it into $F$ subranges, where $F = {2}^{N1}$ and ${N1}$ is an integer. Each of the $F$ subranges is mapped onto one subrange. A fine quantizer of ${N2}$ -bits acts on this range to determine the appropriate fine bits. All of this is done simultaneously or in parallel so that only one clock cycle is needed for conversion. Later, we will see this technique used where the fine quantization is accomplished on the next clock cycle, leading to a two-step ADC that requires two clock cycles for conversion.
A folding preprocessor for $F = 4\left( {{N1} = 2}\right)$ and ${N2} = 3$ is shown in Fig. 9.8-9. This input-output characteristic gives the analog output of the preprocessor as a function of the analog input for folding and no folding. We see that in the folding case, the entire input range is mapped onto a subrange from 0 to ${0.25}{V}_{\mathrm{{REF}}}$ . The advantage of the folding ADC is that the power consumption and area are smaller than for a parallel or flash ADC. Assuming the fine and coarse quantizers are flash ADCs, it has the same conversion speed as the flash ADC. A disadvantage of the folding ADC is that with no sample-and-hold, the bandwidth of the folding output is equal to $F$ times the bandwidth of the analog input.

Figure 9.8-7 Architecture of a folding ADC.

Figure 9.8-8 Illustration of the folding concept.
The folding characteristic shown in Fig. 9.8-9 has two serious problems. The first is the sharp discontinuity in the characteristic at ${V}_{\text{in }} = {0.25}{V}_{\mathrm{{REF}}},{0.5}{V}_{\mathrm{{REF}}}$ , and ${0.75}{V}_{\mathrm{{REF}}}$ . The second is the requirement of the fine quantizer to work at voltages ranging from 0 to ${0.25}{V}_{\mathrm{{REF}}}$ . The first problem can be alleviated by using the folding characteristic shown in Fig. 9.8-10(a). The second problem can be removed by using multiple folders shifted in amplitude by the appropriate amount. This is illustrated in Fig. 9.8-10(b). Note that in this case, there is a single quantizer (i.e., a comparator) and its threshold can be midrange.
A folder that uses a 1-bit quantizer is shown in Fig. 9.8-11 for ${N1} = 2$ and ${N2} = 3$ . For this 5-bit ADC we see that 11 comparators are required compared to 31 for a flash ADC. It is important that all crossings of the quantizer threshold [zero in Fig. 9.8-10(b)] are equally spaced as was the case for the interpolating ADC. The folders can be followed by interpolation to further reduce the number of comparators or to simplify their design. This type of ADC is called a folding and interpolating ${ADC}\left\lbrack  {{21},{23},{24}}\right\rbrack$ .

Figure 9.8-9 Folding characteristic for ${N1} = 2$ and ${N2} = 3$ .

Figure 9.8-10 (a) Folder that removes discontinuity problem. (b) Multiple folders that allow a single-value quantizer (comparator).
The folding circuit can easily be implemented using parallel connected differential amplifiers. Figure 9.8-12 shows a typical folder and its folding characteristic. Note that the idealized triangle waveforms are not realized but this is unimportant if a single amplitude value is used as the threshold point, as done in Fig. 9.8-10(b). The number of differential amplifiers and how the outputs are connected will determine the starting and ending characteristics of the folder. In Fig. 9.8-12, a current sink of $I/2$ has been used to start and end the characteristic at the negative minimum output of $- {0.5I}{R}_{L}$ assuming an even number of differential amplifiers. The horizontal shifting of the folding characteristic in Fig. 9.8-12 can be achieved by segmenting the resistors of the resistor string between ${V}_{\mathrm{{REF}}}$ and ground as shown by the shaded folding characteristics and the dotted taps.
The folding and interpolation ADC architectures offer the most resolution at high speeds of any existing ADC architectures. The combination of folding and interpolation is useful for implementation of CMOS ADCs with a resolution of around 8-bits and a maximum sample rate of ${100} - {400}\mathrm{{MHz}}$ . These ADCs are not without problems such as timing misalignment between the coarse and fine quantizer outputs and the need to use high-speed sample-and-hold circuits to alleviate the maximum folding frequency bandwidth requirements. Without a sample-and-hold, the folding circuit acts like an amplitude-dependent frequency multiplier. With a sample-and-hold, all inputs to the folding circuit arrive at the same time and the bandwidth of the ADC is now limited by the bandwidth of the sample-and-hold circuit and the settling time of the folding and interpolating preprocessing circuitry. It is also possible to use many distributed sample-and-hold circuits and thereby reduce the dynamic range requirement for each sample-and-hold.

Figure 9.8-11 A 5-bit folding ADC using 1-bit quantizers (comparators).

Figure 9.8-12 Implementation of times 4 folder.
## Multiple-Bit Pipeline ADCs
The thrust of the interpolating and folding ADCs is to accomplish the conversion in one clock cycle. However, if one is willing to allow several clock cycles for the conversion, then a method such as the pipeline ADC using multiple-bits per stage is useful. Figure 9.8-13 shows the $i$ th stage of a $K$ -bit per stage pipeline ADC. Note that the input to the stage, ${V}_{i - 1}$ , is sampled and held followed by a $K$ -bit ADC-DAC operation. The output of the $K$ -bit ADC is the converted bits for the stage. The output of the $K$ -bit DAC is subtracted from the input, forming what is called the residue voltage. This residue voltage is amplified by ${2}^{K}$ and is available for the next stage.

Figure 9.8-13 The $i$ th stage of a $K$ -bit per stage pipeline ADC with residue amplification.

Figure 9.8-14 Illustration of the operation of a 3-bit, three-stage pipeline ADC.
The operation of a multiple-bit pipeline ADC using the stage of Fig. 9.8-13 is shown in Fig. 9.8-14. This is an example of a three-stage ADC with 3-bits per stage. It has been assumed that the converted digital output word for this example is 011111001. Note that for this 9-bit ADC, only 21 comparators are required and the conversions are accomplished in 3 clock cycles. Also, two gain-of-8 amplifiers are required.
One of the disadvantages of the multiple-bit pipeline ADC that uses residue amplification is the bandwidth limitation of the amplifier. Assuming op amps with unity-gain bandwidths of ${50}\mathrm{{MHz}}$ gives a $- 3\mathrm{\;{dB}}$ frequency of approximately $6\mathrm{{MHz}}$ for the ADC of Fig. 9.8-14. This disadvantage can be avoided by using the concept of subranging introduced in Section 9.3. Instead of amplifying the residue, the reference voltage to the DAC is divided by ${2}^{K}$ , assuming the stage has $K$ -bits. The concept is illustrated in Fig. 9.8-15 for a two-stage, 2-bit pipeline ADC for an analog input of ${0.4}{V}_{\mathrm{{REF}}}$ . Note that the resolution for the comparators of the second stage decreases by a factor of ${2}^{K}$ . Fortunately, this requirement is offset by the fact that the tolerances of the later stages of the pipeline architecture decrease by a factor of ${2}^{K}$ for every additional stage.

Figure 9.8-15 Illustration of the subranging process for a two-stage, 2-bit/stage pipeline ADC where the digital output code is 0110 .

Figure 9.8-16 Implementation of the DAC in the pipeline stage.
The implementation of the ADC and DAC of Fig. 9.8-13 is easier than at first it might seem. If a flash or parallel ADC is used, the addition of a simple logic circuit at the output of the comparators easily implements the DAC. Figure 9.8-16 shows a straightforward scheme of doing this. The two-input exclusive-OR gate is between consecutive comparator outputs. When there is a difference between the two comparator outputs, the exclusive-OR gate outputs a logic 1 . This logic 1 is used to connect a switch or transmission gate to the resistor string tap that is between the two comparators. This gives the reconstructed analog output using the same scaling circuit that is used for the ADC. If there are errors in the thermometer code transition point, this method will experience problems. One could use circuits that detect and remove these errors; however, if the number of bits per stage is small, it is unlikely that errors will occur.
The multiple-bit pipeline ADCs are a good compromise between area and speed. Typical ADCs resulting from this approach are 10-bits and 40 Msamples/s [25] and 14-bits and 10 Msamples/s [26]. While most of the ADCs used in multiple-bit pipeline architecture are flash or parallel, they can be any type if speed is not crucial.
---
Example 9.8-3
---
## Examination of Error in Subranging for a Two-Stage, 2-bits/stage Pipeline ADC
The stages of the two-stage, 2-bits/stage pipeline ADC shown in Fig. 9.8-17 are ideal. However, the second stage divides ${V}_{\mathrm{{REF}}}$ by 2 rather than 4 . Find the $\pm  {INL}$ and $\pm  {DNL}$ for this ADC. SOLUTION

Figure 9.8-17 Pipeline ADC for Example 9.8-3.
Examination of the first stage shows that its output, ${V}_{\text{out }}\left( 1\right)$ , changes at
$$
\frac{{V}_{\text{in }}\left( 1\right) }{{V}_{\text{REF }}} = \frac{1}{4},\frac{2}{4},\frac{3}{4}\text{, and }\frac{4}{4}
$$
The output of the first stage will be
$$
\frac{{V}_{\text{out }}\left( 1\right) }{{V}_{\text{REF }}} = \frac{{b}_{0}}{2} + \frac{{b}_{1}}{4}
$$
The second stage changes at
$$
\frac{{V}_{\text{in }}\left( 2\right) }{{V}_{\text{REF }}} = \frac{1}{8},\frac{2}{8},\frac{3}{8}\text{, and }\frac{4}{8}
$$
where
$$
{V}_{\text{in }}\left( 2\right)  = {V}_{\text{in }}\left( 1\right)  - {V}_{\text{out }}\left( 1\right)
$$
The above relationships permit the information given in Table 9.8-1.
Table 9.8-1 Output Digital Word for Example 9.8-3
<table><tr><td>${V}_{\text{in }}\left( 1\right)$</td><td rowspan="2">${b}_{0}$</td><td rowspan="2">${b}_{1}$</td><td>${V}_{\text{out }}\left( 1\right)$</td><td>${V}_{\text{in }}\left( 2\right)$</td><td rowspan="2">${b}_{2}$</td><td rowspan="2">${b}_{3}$</td><td colspan="4">Ideal Output</td></tr><tr><td>${V}_{\text{REF }}$</td><td>${V}_{\text{REF }}$</td><td>${V}_{\text{REF }}$</td><td>${b}_{0}$</td><td>${b}_{1}$</td><td>${b}_{2}$</td><td>${b}_{3}$</td></tr><tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td>1/16</td><td>0</td><td>0</td><td>0</td><td>1/16</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td></tr><tr><td>2/16</td><td>0</td><td>0</td><td>0</td><td>2/16</td><td>0</td><td>1</td><td>0</td><td>0</td><td>1</td><td>0</td></tr><tr><td>3/16</td><td>0</td><td>0</td><td>0</td><td>3/16</td><td>0</td><td>1</td><td>0</td><td>0</td><td>1</td><td>1</td></tr><tr><td>4/16</td><td>0</td><td>1</td><td>4/16</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><td>5/16</td><td>0</td><td>1</td><td>4/16</td><td>1/16</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>1</td></tr><tr><td>6/16</td><td>0</td><td>1</td><td>4/16</td><td>2/16</td><td>0</td><td>1</td><td>0</td><td>1</td><td>1</td><td>0</td></tr><tr><td>7/16</td><td>0</td><td>1</td><td>4/16</td><td>3/16</td><td>0</td><td>1</td><td>0</td><td>1</td><td>1</td><td>1</td></tr><tr><td>8/16</td><td>1</td><td>0</td><td>8/16</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td></tr><tr><td>9/16</td><td>1</td><td>0</td><td>8/16</td><td>1/16</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>1</td></tr><tr><td>10/16</td><td>1</td><td>0</td><td>8/16</td><td>2/16</td><td>0</td><td>1</td><td>1</td><td>0</td><td>1</td><td>0</td></tr><tr><td>11/16</td><td>1</td><td>0</td><td>8/16</td><td>3/16</td><td>0</td><td>1</td><td>1</td><td>0</td><td>1</td><td>1</td></tr><tr><td>12/16</td><td>1</td><td>1</td><td>12/16</td><td>0</td><td>0</td><td>0</td><td>1</td><td>1</td><td>0</td><td>0</td></tr><tr><td>13/16</td><td>1</td><td>1</td><td>12/16</td><td>1/16</td><td>0</td><td>0</td><td>1</td><td>1</td><td>0</td><td>1</td></tr><tr><td>14/16</td><td>1</td><td>1</td><td>12/16</td><td>2/16</td><td>0</td><td>1</td><td>1</td><td>1</td><td>1</td><td>0</td></tr><tr><td>15/16</td><td>1</td><td>1</td><td>12/16</td><td>3/16</td><td>0</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td></tr></table>
Comparing the actual digital output word with the ideal output word gives the following results: $+ {INL} = {2LSBs}, - {INL} = {0LSB}, + {DNL} = \left( {{1000} - {0101}}\right)  - {1LSB} =  + {2LSBs}$ , and $- {DNL} = \left( {{0101} - {0100}}\right)  - {1LSB} = {0LSB}.$
## Accuracy Requirements for the Amplifier of a Two-Stage, 2-bits/stage Pipeline ADC
A 4-bit ADC consisting of two, 2-bit stages (pipes) is shown in Fig. 9.8-18. Assume that the 2- bit ADCs and the 2-bit DAC function ideally. Also assume that ${V}_{\mathrm{{REF}}} = 1\mathrm{\;V}$ . The ideal value of the scaling factor, $k$ , is 4 . Find the maximum and minimum values of $k$ that will not cause an error in the 4-bit ADC. Express the tolerance of $k$ in terms of a plus and minus percentage.

Figure 9.8-18 Two-stage, 2-bit/stage ADC of Example 9.8-4.
## SOLUTION
The input to the second ADC is
$$
{v}_{\mathrm{{in}}}\left( 2\right)  = k\left\lbrack  {{v}_{\mathrm{{in}}}\left( 1\right)  - \left( {\frac{{b}_{0}}{2} + \frac{{b}_{1}}{4}}\right) }\right\rbrack
$$
If we designate this voltage as ${v}_{\text{in }}^{\prime }\left( 2\right)$ when $k = 4$ , then the difference between ${v}_{\text{in }}\left( 2\right)$ and ${v}_{\text{in }}^{\prime }\left( 2\right)$ must be less than $\pm  1/8$ or the LSBs will be in error.
Therefore,
$$
\left| {{v}_{\text{in }}\left( 2\right)  - {v}_{\text{in }}^{\prime }\left( 2\right) }\right|  = \left| {k{v}_{\text{in }}\left( 1\right)  - k\left( {\frac{{b}_{0}}{2} + \frac{{b}_{1}}{4}}\right)  - 4{v}_{\text{in }}\left( 1\right)  + 4\left( {\frac{{b}_{0}}{2} + \frac{{b}_{1}}{4}}\right) }\right|  \leq  \frac{1}{8}
$$
If $k = 4 + {\Delta k}$ , then
$$
\left| {4{v}_{\text{in }}\left( 1\right)  + {\Delta k}{v}_{\text{in }}\left( 1\right)  - 4\left( {\frac{{b}_{0}}{2} + \frac{{b}_{1}}{4}}\right)  - {\Delta k}\left( {\frac{{b}_{0}}{2} + \frac{{b}_{1}}{4}}\right)  - 4{v}_{\text{in }}\left( 1\right)  + 4\left( {\frac{{b}_{0}}{2} + \frac{{b}_{1}}{4}}\right) }\right|  \leq  \frac{1}{8}
$$
or
$$
{\Delta k}\left| {{v}_{\text{in }}\left( 1\right)  - \left( {\frac{{b}_{0}}{2} + \frac{{b}_{1}}{4}}\right) }\right|  \leq  \frac{1}{8}
$$
---
Example 9.8-4
---
The largest value of $\left| {{v}_{\text{in }}\left( 1\right)  - \left( {{b}_{0}/2 + {b}_{1}/4}\right) }\right|$ is $\frac{1}{4}$ for any value of ${v}_{\text{in }}\left( 1\right)$ from 0 to ${V}_{\text{REF }}$ . Therefore,
$$
\frac{\Delta k}{4} \leq  \frac{1}{8}\; \Rightarrow  \;{\Delta k} \leq  \frac{1}{2}
$$
The tolerance of $k$ is
$$
\frac{\Delta k}{k} = \frac{\pm 1}{2 \cdot  4} = \frac{\pm 1}{8} \Rightarrow   \pm  {12.5}\%
$$
## Digital Error Correction
The multiple-bit pipeline ADC architecture permits a very useful correction technique called digital error correction. In digital error correction, inaccuracies in the comparator are removed by increasing the number of bits of each stage following the first stage and using that bit to determine if the stage conversion was accurate. Let us consider what might happen to create an error in the conversion of the two-stage, 2-bits/stage pipeline ADC of Fig. 9.8-15. Let us assume that the analog input to this ADC is ${0.4}{V}_{\mathrm{{REF}}}$ . The correct digital word for the two-stage, 2-bits/stage ADC should be 0110. The comparators of the first stage should select the subrange from ${0.25}{V}_{\mathrm{{REF}}}$ to ${0.50}{V}_{\mathrm{{REF}}}$ , giving the first two-bits as 01 . However, suppose the offset of the comparators was too large and it selected the subrange above or below. Figure 9.8-19(a) shows what would happen if the range above was selected. The second stage would convert the last two-bits as 00 , giving the output as 1000 rather than 019 .
Figure 9.8-19(b) shows how the addition of an extra-bit to stage 2 of Fig. 9.8-15 can correct the error illustrated in Fig. 9.8-19(a). Even though stage 2 now has 3-bits, we still divide ${V}_{\text{REF }}$ by 4 . This gives the results shown in Fig. 9.8-19(b). Note that even though the first-stage comparators select 10 , the second stage can recover. It is customary to shift the bits downward so that00,01,10, and 11 correspond to the selected subrange. If stage 2 selects one of these values, no error correction is necessary. However, if the value is negative or 100 or 101, the choice for the first two-bits must be corrected. This correction can be done after all stages of the pipeline ADC have converted or after the conversion of each individual stage. The result of digital error correction is to greatly reduce the offset requirements on the comparators of the multiple-bit pipeline ADC. Various ways of implementing the digital error correction can be found in the literature $\left\lbrack  {{27},{28}}\right\rbrack$ .

Figure 9.8-19 (a) Error caused by first stage comparator error in Fig. 9.8-15. (b) Illustration of digital error correction of Fig. 9.8-15 using an extra bit.
## Time-Interleaved ADCs
One method of achieving small system-conversion times is to use the slower ADCs in parallel. This is called time-interleaving (shown in Fig. 9.8-20). Here, $M$ successive-approximation ADCs are used in parallel to complete the $N$ -bit conversion of one analog signal per clock cycle. The sample-and-hold circuits consecutively sample and apply the input analog signal to their respective ADCs. $N$ clock cycles later, the ADC provides a digital word out. If $M =$ $N$ , then a digital word is converted at every cycle. If one examines the chip area used for the parallel ADC architecture compared with the time-interleaved method for $M = N$ , the minimum area is likely to be somewhere between these extremes. For the time-interleaved method to work, the offsets, gains and delays of each channel must be matched within the precision required for the MSB.
This section has examined high-speed ADCs compatible with CMOS technology. The fastest possible conversion time is one clock cycle. This minimum conversion time or maximum sample frequency is in the 200-600 Msamples/second range for submicron CMOS technology. Unfortunately, the resolution of these ADCs is low, being in the range of 6-8-bits. This resolution is at sample rates less than the maximum sample rate. Typically, the resolution decreases by 1-2-bits at the maximum sampling rate.

Figure 9.8-20 A time-interleaved ADC.
### 9.9 Oversampling Converters ${}^{ \dagger  }$
In the first part of this section, after a brief introduction of the oversampling ADCs, a special form of oversampling ADCs, namely, delta-sigma ADCs, will be covered in detail. The second part of this section is devoted to oversampling DACs. At the end of this section, a comparison of the recently reported oversampling data converters will be given.
## Delta-Sigma ADCs
The ADCs covered so far in this chapter are based on the principle of direct quantization of signal amplitudes. They are often classified as Nyquist rate ADCs because of their conversion rates being equal to the Nyquist rate. Although Nyquist rate ADCs can be very fast, their resolution is limited to a 10-12-bit range in today's digital driven process technologies due to component matching and circuit nonidealities.
In this section, we will discuss a different class of ADCs that do not require stringent component matching requirements and hence are more suitable for high-resolution (up to 16-bits and more) implementations in mainstream processes. Oversampling and noise shaping are the two key techniques employed in these ADCs. As in the case of Nyquist rate counterparts, several variations have been developed over the years. In a wider definition, they are generally called oversampling or noise shaping ADCs. Oversampling ADCs are based on trading off accuracy in amplitude for accuracy in time [29]. In other words, unlike Nyquist rate converters, where each digital word is obtained from an accurately quantized single sample of the input, in oversampled converters, each output is obtained from a sequence of coarsely quantized input samples. Therefore, in oversampling ADCs the sampling operation is done at a much higher rate than the Nyquist rate. The ratio of the sampling rate and the Nyquist rate is called the oversampling ratio, $M$ . Oversampling converters take advantage of today's VLSI technology tailored toward providing high-speed/high-density digital circuits rather than accurate analog circuits by performing most of the conversion process in the digital domain [30]. The analog part of these converters is relatively simple and occupies a small area, unlike their Nyquist rate counterparts. Most implementations use switched capacitor techniques. In state-of-the-art oversampling ADCs, the oversampling ratio typically is between 8 and 256 [29-79].
Figure 9.9-1 compares the frequency spectrum of a conventional Nyquist ADC and an oversampling ADC. The bandwidth of the signal applied to the ADC is shown by the rectangle with diagonal lines. The upper limit of the frequencies applied to the ADC is indicated by ${f}_{B}$ . In Fig. 9.9-1(a), the sampling rate is equal to the Nyquist rate. To achieve maximum signal bandwidth, ${f}_{B}$ is made as close to ${0.5}{f}_{N}$ as possible. In Fig. 9.9-1(b), the Nyquist rate is much less than the sampling rate. Antialiasing filter requirements of oversampling ADCs are much more relaxed than those of Nyquist rate converters. The reason for this is that the sampling frequency is much higher than the Nyquist rate in oversampling converters; also, the transition band that extends from the edge of the signal band to the edge of the smallest frequency band at which signals alias into the signal band is quite wide and the transition is smooth. Usually simple first- or second-order analog filters are sufficient to meet the relaxed antialiasing requirements without causing any phase distortion in the signal band [31]. Sampling is also not a major problem for oversampling ADCs. Normally, dedicated S/H circuits are not required, because sampling is performed inherently by the circuits that perform quantization.
---
${}^{ \dagger  }$ This section was contributed by Dr. Abdulkerim L. Coban of Mindspeed, Inc.
---

Figure 9.9-1 (a) Conventional ADC with ${f}_{B} \approx  {0.5}{f}_{N} = {0.5}{f}_{S}$ . (b) Over-sampled ADC with ${f}_{B} \approx  {0.5}{f}_{N} \ll  {f}_{S}$ .
Oversampling ADCs can be classified into three main groups as straight-oversampling, predictive, and noise-shaping ADCs. Straight-oversampling ADCs exploit the fact that the quantization noise is assumed to be equally distributed over the entire frequency range, dc to one-half the sampling rate. This implies that the higher the sampling frequency, the lower the quantization noise power per frequency. If the sampling frequency is higher than the Nyquist rate, the out-of-band noise can be removed by a digital filter, and hence the overall resolution may be improved. In fact, if the quantization noise is assumed to be uniformly distributed white noise, then each doubling of oversampling ratio allows us to improve the resolution by 0.5-bit. For example, we can obtain a 16-bit resolution for a ${20}\mathrm{{kHz}}$ signal, by using a12-bit 10 Msamples/s ADC along with a digital decimator. As evident from this example, a major disadvantage of straight oversampling is that the accuracy speed trade-off is not efficient. In order to improve the resolution by 4-bits, the oversampling ratio must be increased by 256 times.
Both predictive and noise-shaping ADCs achieve a more efficient accuracy-speed tradeoff by utilizing the noise-shaping concept in addition to oversampling. Noise shaping is performed by placing the quantizer in a feedback loop in conjunction with a loop filter as shown in Fig. 9.9-2(a). In predictive ADCs the loop filter is placed in the feedback path as indicated in Fig. 9.9-2(b). Both the signal and the quantization noise spectra are shaped. A typical example for predictive ADCs is the delta-modulator based ADC [32]. In noise-shaping ADCs, the loop filter is placed in the feedforward path. Only the quantization noise spectrum is shaped; the signal spectrum is preserved. A special name is given to the noise-shaping ADC employing a coarse quantizer. It is called a delta-sigma ADC and is the topic of this section.
## Delta-Sigma ( ${\Delta \sum }$ ) Modulators
First introduced in 1962 [33], the delta-sigma ADC is the most widely used oversampling ADC. This is because, among the three different oversampling ADCs briefly mentioned previously, it is the most robust ADC against circuit imperfections. Delta-sigma ADCs fulfill an important role in today's mostly digital mixed-mode systems as interface circuits between the analog world and the powerful digital processing environment. They are best suited for slow- and medium-speed conversions such as instrumentation, digital voice, and audio applications, though recently with faster processes the conversion rate has entered into the megahertz range for as high as 15-bits of resolution [34,35]. In addition, delta-sigma ADCs have started to penetrate into the wireless communications area in the form of bandpass delta-sigma ADCs in which a narrow-band signal around a carrier frequency is directly digitized [36-38].

Figure 9.9-2 (a) Noise-shaping ADC. (b) Predictive ADC.
A delta-sigma ADC consists of two main building blocks, which are an analog delta-sigma modulator part and the digital decimator part that normally occupies most of the ADC chip area and consumes more power than the modulator part. The operation of delta-sigma modulators can be explained by examining the simplest of these modulators, the first-order delta-sigma modulator depicted in Fig. 9.9-3. It consists of an integrator and a coarse quantizer (typically a two-level quantizer) placed in a feedback loop. The name first-order stems from the fact that there is only one integrator in the circuit, placed in the feedforward path. For the case of a two-level quantizer, the ADC and DAC of Fig. 9.9-3 reduce to a simple comparator and a direct connection between modulator output and subtractor node, respectively.
When the integrator output is positive, the quantizer feeds back a positive reference signal that is subtracted from the input signal, in order to move the integrator output in the negative direction. Similarly, when the integrator output is negative, the quantizer feeds back a negative reference signal that is added to the incoming signal. The integrator therefore accumulates the difference between the input and quantized output signals and tries to maintain the integrator output around zero. A zero integrator output implies that the difference between the input signal and the quantized output is zero. In fact, the feedback around the integrator and quantizer forces the local average of quantizer output to track the local average value of the input signal. Figure 9.9-4 demonstrates the modulator operation for a sinewave input signal. The amplitude of the sinewave is 0.9 and the quantizer levels are at $\pm  1$ . When the input approaches 0.9 , the modulator output is dominated by positive pulses. On the other hand, when the input is around -0.9 , the output has few positive pulses. It primarily consists of negative pulses. For inputs around zero, the output oscillates between two levels. The local average of the output can efficiently be computed by a decimator. Note that input range must be kept in between the two quantizer levels. Beyond this range, the modulator output saturates and cannot accurately represent the average value of the input. Figure 9.9-4 also reveals that, if more samples are included in the calculation of the average, a better approximation of the input can be obtained.

Figure 9.9-3 Block diagram of a first-order delta-sigma modulator.

Figure 9.9-4 First-order modulator output for a sinusoidal input.
The linearized sampled-data equivalent circuit of the first-order modulator is depicted in Fig. 9.9-5. In the figure, the quantization is represented by an additive error $q$ , defined as the difference between the modulator output, $y$ , and the quantizer input, $v$ . It is assumed that quantization error has statistical properties independent from that of the input signal and it is treated as a white noise. The noise generated by a scalar quantizer with levels equally spaced by $\Delta$ is uncorrelated and has equal probability of lying anywhere in between $\pm  \Delta /2$ . In this case, the power is given by $\left\lbrack  {{30},{39}}\right\rbrack$
$$
{S}_{Q} = \frac{1}{\Delta }{\int }_{\Delta /2}^{-\Delta /2}{q}^{2}{dq} = \frac{1}{12}{\Delta }^{2} \tag{9.9-1}
$$
The uniformly distributed white noise model of the quantization error is not a good approximation for ${\Delta \sum }$ modulators because of the very coarse nature of the quantizer and the correlation present between the modulator input and the quantization error. The discrepancy between the actual behavior of the modulator and that predicted by the linearized model manifests itself especially in the first-order modulator. Nevertheless, the model is quite valid for higher-order modulators and has proved to be very useful for designing ${\Delta \sum }$ modulators with order greater than one. The input-output relation of the modulator given in Fig. 9.9-5 can be written in terms of a difference equation as
$$
y\left\lbrack  {n{T}_{s}}\right\rbrack   = x\left\lbrack  {\left( {n - 1}\right) {T}_{s}}\right\rbrack   + q\left\lbrack  {n{T}_{s}}\right\rbrack   - q\left\lbrack  {\left( {n - 1}\right) {T}_{s}}\right\rbrack   \tag{9.9-2}
$$

Figure 9.9-5 Sampled-data model of a first-order ${\Delta \sum }$ modulator.
The output contains the delayed version of the modulator input and the first-order difference of the quantization error. The $z$ -domain equivalent of Eq. (9.9-2) is given by
$$
Y\left( z\right)  = {z}^{-1}X\left( z\right)  + \left( {1 - {z}^{-1}}\right) Q\left( z\right)  \tag{9.9-3}
$$
where $X\left( z\right) , Y\left( z\right)$ , and $Q\left( z\right)$ are the $z$ -transforms of the modulator input and output and the quantization error, respectively. The multiplication factor of $X\left( z\right)$ is called the signal transfer function (STF), whereas that of $Q\left( z\right)$ is called the noise transfer function (NTF). Note that in the above equation ${z}^{-1}$ represents a unit delay. On the other hand, $\left( {1 - {z}^{-1}}\right)$ has high-pass characteristics, allowing noise suppression at low frequencies.
The first-order ${\Delta \sum }$ modulator can be extended to a second-order modulator by inserting an additional integrator into the feedforward path of the modulator as shown in Fig. 9.9-6. Its output can be expressed as
$$
Y\left( z\right)  = {z}^{-1}X\left( z\right)  + {\left( 1 - {z}^{-1}\right) }^{2}Q\left( z\right)  \tag{9.9-4}
$$
The noise transfer function ${\left( 1 - {z}^{-1}\right) }^{2}$ has two zeros at dc, resulting in second-order noise shaping. In general, $L$ th-order noise shaping can be obtained by placing $L$ integrators in the forward path of a ${\Delta \sum }$ modulator. For $L$ th-order noise differencing, the noise transfer function is given by
$$
{NT}{F}_{Q}\left( z\right)  = {\left( 1 - {z}^{-1}\right) }^{L} \tag{9.9-5}
$$
In the frequency domain, the magnitude of the noise transfer function can be written as
$$
\left| {{NT}{F}_{Q}\left( f\right) }\right|  = {\left| 1 - {e}^{-{j2\pi f}{T}_{s}}\right| }^{L} = {\left( 2\sin \pi f{T}_{s}\right) }^{L} \tag{9.9-6}
$$
In Fig. 9.9-7, Eq. (9.9-6) is plotted as a function of frequency for different modulator orders along with the ideal magnitude response of the digital decimator that follows the modulator (the brickwall low-pass filter with cutoff frequency ${f}_{b}$ ). The decimator defines the signal band and attenuates the quantization noise that resides beyond the frequency of interest. Note that, in the signal band, the quantization noise is considerably suppressed by the noise-shaping nature of the modulator. Also, as the modulator order and/or oversampling ratio increases, the portion of the quantization noise that falls into the signal band decreases. In practice, the single-loop modulators having noise-shaping characteristics in the form of ${\left( 1 - {z}^{-1}\right) }^{L}$ are unstable for $L > 2$ , unless an $L$ -bit quantizer is used [35,40].
Noise power of ${\Delta \sum }$ modulators can be quantified in terms of the modulator order and over-sampling ratio by integrating the quantization noise spectral density that falls into the signal band. The power spectral density (pdf) of a ${\Delta \sum }$ modulator, ${S}_{E}\left( f\right)$ is the multiplication of the squared magnitude of the noise transfer function and the spectral density of the quantizer:
$$
{S}_{E}\left( f\right)  = {\left| NT{F}_{Q}\left( f\right) \right| }^{2}\frac{\left| {S}_{Q}\left( f\right) \right| }{{f}_{s}} \tag{9.9-7}
$$

Figure 9.9-6 Sampled-data model of a second-order ${\Delta \sum }$ modulator.

Figure 9.9-7 Magnitude of the noise-shaping function, ${\left( 1 - {z}^{-1}\right) }^{L}$ .
Substituting Eqs. (9.9-1) and (9.9-6) into the above equation and integrating in the interval $\left\lbrack  {-{f}_{b},{f}_{b}}\right\rbrack$ , the total noise power in the signal band can be found as
$$
{S}_{B} = \frac{1}{{f}_{s}}{\int }_{{f}_{b}}^{{f}_{b}}{\left( 2\sin \pi f{T}_{s}\right) }^{2L}\frac{{\Delta }^{2}}{12}{df} \approx  \left( \frac{{\pi }^{2L}}{{2L} + 1}\right) \left( \frac{1}{{M}^{{2L} + 1}}\right) \left( \frac{{\Delta }^{2}}{12}\right)  \tag{9.9-8}
$$
The above equation is obtained assuming sin ${\pi f}{T}_{s}$ can be approximated as ${\pi f}{T}_{s}$ for $M \gg  1$ . From Eq. (9.9-8), it is clear that the quantization noise power is attenuated by $M$ to the power of ${2L} + 1$ .
Because of the entirely different quantization process of ${\Delta \sum }$ ADCs, performance metrics of these ADCs cannot be described in terms of integral and differential nonlinearity as in the case of Nyquist rate ADCs. Instead, performance measures such as signal-to-noise ratio (SNR) and dynamic range(DR)can be used to evaluate the effective number of bits. SNR is defined as the ratio of the signal power to the baseband noise power. ${DR}$ , on the other hand, is the ratio of the power of a full scale sinusoidal input to the power of a sinusoidal input for which ${SNR}$ is one. ${DR}$ is also called the useful signal range [41]. For a single-bit quantizer with level spacing $\Delta$ , it can easily be shown that the dynamic range is given by the following equation:
$$
D{R}^{2} = \frac{\text{ Maximum signal power }}{{S}_{B}} = \frac{{\left( \frac{\Delta }{2\sqrt{2}}\right) }^{2}}{\left( \frac{{\pi }^{2L}}{{2L} + 1}\right) \left( \frac{1}{{M}^{{2L} + 1}}\right) \left( \frac{{\Delta }^{2}}{12}\right) } = \frac{3}{2}\frac{{2L} + 1}{{\pi }^{2L}}{M}^{{2L} + 1} \tag{9.9-9}
$$
On the other hand, the dynamic range of a $B$ -bit Nyquist rate ADC is
$$
D{R}^{2} = 3 \times  {2}^{{2B} - 1} \tag{9.9-10}
$$
If the dynamic range is expressed in decibels, rearranging the above equation, one can obtain an expression for the resolution of an ADC in the number of effective bits. The resulting equation as a function of ${DR}$ in $\mathrm{{dB}}\left( {D{R}_{\mathrm{{dB}}}}\right)$ is
$$
B = \frac{D{R}_{\mathrm{{dB}}} - {1.76}}{6.02} \tag{9.9-11}
$$
Using Eqs. (9.9-9) through (9.9-11), one can easily calculate the required modulator order and oversampling ratio for a given resolution. For example, for a 16-bit resolution ${\Delta \sum }$ ADC, from Eq. (9.9-10), the required dynamic range of the ADC is about ${98}\mathrm{\;{dB}}$ . For a second-order modulator, this implies that the oversampling ratio must be at least 153 . In general, the over-sampling ratio is chosen to be a power of 2 number. Since 256 is the smallest power of 2 number larger than 153 , it must be taken as the oversampling ratio of the second-order modulator. If it is further assumed that the signal to be quantized has a bandwidth of ${20}\mathrm{{kHz}}$ , the clock signal must be 9.24 MHz.
From Eq. (9.9-9) it is evident that the trade-off between the dynamic range and sampling rate, hence the oversampling ratio, becomes more favorable as the modulator order increases. For a first-order ${\Delta \sum }$ ADC, every doubling of $M$ increases ${DR}$ by $9\mathrm{\;{dB}}$ , and the resolution by 1.5-bits. On the other hand, for the second- and the third-order ${\Delta \sum }$ ADC, the corresponding ${DR}$ improvements are ${15}\mathrm{\;{dB}}$ (2.5 bits) and ${21}\mathrm{\;{dB}}$ (3.5 bits), respectively. Another observation about Eq. (9.9-9) is that ${DR}$ improvement resulting from the increase of the modulator order from $L$ to $L + 1$ is more pronounced for larger oversampling ratios. For example, while for $M = {16}$ a ${DR}$ improvement of only ${16}\mathrm{\;{dB}}$ is obtained by increasing $L$ from 2 to 3, for the same change in modulator order a ${40}\mathrm{\;{dB}}$ improvement is achieved at $M = {256}$ . However, in many applications where the signal bandwidth is large, low $M$ values are desirable in order not to increase the sampling frequency beyond the limits of technology available. But if the required resolution is high, low $M$ would imply large values of $L$ . An alternative way of implementing high-speed, high-resolution ${\Delta \sum }$ ADCs is to employ a multibit quantizer, instead of a single-bit quantizer, in the modulator loop. It can be shown that each additional-bit of the internal quantizer improves the dynamic range by an additional $6\mathrm{\;{dB}}$ . For the multibit modulator case, Eq. (9.9-9) takes the more general form of [42]
$$
D{R}^{2} = \frac{3}{2}\frac{{2L} + 1}{{\pi }^{2L}}{M}^{{2L} + 1}{\left( {2}^{B} - 1\right) }^{2} \tag{9.9-12}
$$
where $B$ is the number of bits of the internal quantizer of the modulator.
Example
## Trade-off Between Signal Bandwidth and Accuracy of ${\Delta \sum }$ ADCs
9.9-1 Find the minimum oversampling ratio, $M$ , for a 16-bit oversampled ADC that uses (a) a 1-bit quantizer and third-order loop, (b) a 2-bit quantizer and third-order loop, and (c) a 3-bit quantizer and second-order loop.
## SOLUTION
From Eq. (9.9-11) we see that the 16-bit ADC corresponds to a dynamic range of approximately ${98}\mathrm{\;{dB}}$ . (a) Solving for $M$ from Eq. (9.9-12) gives
$$
M = {\left( \frac{2}{3}\frac{D{R}^{2}}{{2L} + 1}\frac{{\pi }^{2L}}{{2}^{B} - 1}\right) }^{1/\left( {{2L} + 1}\right) }
$$
Converting the dynamic range to 79,433 and substituting into the above equation gives a minimum oversampling ratio of $M = {48.03}$ , which would correspond to an oversampling rate of 64.
For parts (b) and (c) we obtain a minimum oversampling rate of $M = {32.53}$ and 96.48, respectively. These values would correspond to oversampling rates of 32 and 128, respectively.
## Alternative Modulator Architectures
The simple linearized model presented above predicts that, for an $L$ th-order single-bit ${\Delta \sum }$ modulator, the inband noise power is given by Eq. (9.9-8), which implies that the noise power can be lowered below a desired level by simply inserting more integrators into the feedforward path of the modulator given in Fig. 9.9-6 and/or increasing the oversampling ratio. In reality, a ${\Delta \sum }$ modulator is a highly nonlinear circuit. When more than two inte-grators are cascaded in the loop filter, the modulator shown in Fig. 9.9-8(a) becomes prone to instability. When third- or higher-order modulators are excited by a large input signal, the two-level quantizer overloads, implying increased quantization noise. In the feedfor-ward path of the modulator, this large quantization noise is then amplified, resulting in large, uncontrollable, low-frequency oscillations [42]. Even if the modulator is not driven by an input signal, instability may occur depending on the initial conditions of the integrators [43].
Nevertheless, higher-order $\left( {L > 2}\right)$ single-loop, single-bit ${\Delta \sum }$ modulators can be made stable by adopting a more general loop filter, rather than using unity-gain cascaded integrators and internal feedback paths. Appropriate zeros can be introduced in the loop filter at the expense of some additional circuit complexity to stabilize the modulator for a certain input range. Higher-order, single-loop modulators are most attractive when high resolution and circuit complexity are important [44]. Lower attainable dynamic range than anticipated by Eq. (9.9-9) and potential stability problems are the two major shortcomings. A methodology has been established for stabilizing higher-order single-loop modulators [43-48,59]. Several versions of loop filters and therefore modulators have been designed. The most commonly used higher-order modulators are the distributed feedback (DFB) [44,49-52] and distributed feed-forward (DFF) [53-58] type modulators depicted in Fig. 9.9-8(b), though different modulator topologies have also been reported such as the interpolative modulator presented in Chao et al. [48]. Successful realizations of a single-loop seventh-order ${\Delta \sum }$ modulator with ${118}\mathrm{\;{dB}}$ ${DR}$ for audio applications [56] and a single-loop fifth-order 20-bit resolution modulator for instrumentation applications [54] have been reported in the literature.

Figure 9.9-8 (a) A fourth-order distributed feedback modulator. (b) A fourth-order distributed feedforward modulator.
An alternative way of implementing higher-order ${\Delta \sum }$ modulators is to cascade multiple lower-order stages in such a way that each stage processes the quantization noise of the previous stage. In cascade modulators (sometimes called MASH or multistage) outputs of each individual stage go to a digital error cancellation logic, where the quantization noise of all stages, except that of the last one, is removed and the quantization noise of the remaining stage is high-pass filtered by the noise transfer function ${\left( 1 - {z}^{-1}\right) }^{L}$ , where $L$ is the modulator order of the overall ${\Delta \sum }$ modulator [30]. A widely used cascade ${\Delta \sum }$ modulator was realized by cascading three first-order stages [59]. A second-order stage followed by a first-order stage, shown in Fig. 9.9-9, is also widely used because it is less sensitive to circuit imperfections than most other cascade structures [60-64]. Fourth-order cascade modulators are either implemented with two second-order stages [65-67] or with a second-order stage followed by two first-order stages [34,68,69]. Recently, a sixth-order modulator with three second-order stages has been reported [70]. For cascade structures, stability is guaranteed, the maximum input range is almost equal to the reference voltage level, and high ${SNR}$ for a given oversam-pling ratio can be achieved. The disadvantages are that the performance is sensitive to the nonidealities of the first stage and the output of the modulator is multibit, implying a more complex digital decimator [30].
${\Delta \sum }$ modulators employing multibit internal ADC and DAC are another class of ${\Delta \sum }$ modulators. The use of a multibit quantizer has the advantage of reducing the quantization noise by $6\mathrm{\;{dB}}$ for every additional-bit used. Moreover, multibit ${\Delta \sum }$ modulators are more stable than their single-bit counterparts. If a sufficiently large number of quantization levels are used, it is possible to realize stable single-loop modulators with a noise-shaping function of ${\left( 1 - {z}^{-1}\right) }^{L}$ [40]. Furthermore, loop filters having larger noise suppression than their single-bit versions can be used in single-loop multibit ${\Delta \sum }$ modulators, thereby further reducing the inband quantization noise [71]. Lower internal signal swings and higher input range are the other advantages of multibit ${\Delta \sum }$ modulators. ADCs based on multibit ${\Delta \sum }$ modulators are best suited for high-speed and high-resolution applications, where low oversampling ratio is required, and low-voltage and low-power applications, where high input dynamic range and low integrator output swings are necessary. The advantages of multibit ${\Delta \sum }$ modulators are balanced by one important drawback and, therefore, they are not widely used. The DAC present in the feedback loop must have a linearity within one-half ${LSB}$ of the desired output resolution. This is because any nonideality of the feedback DAC is an additive signal to the input of the modulator and does not undergo any noise shaping. Since it is impossible to implement highly linear DACs in today's technology without trimming or training, various alternative solutions to overcome the DAC linearity problems have been suggested in the literature. Some of these are digital error correction [72,73], analog error correction [71], dynamic element matching techniques based on randomization [74,75], clocked averaging [76], individual level averaging [77], data-weighted averaging [35,78], and the use of a dual quantizer [79].

Figure 9.9-9 Cascade of a second-order modulator with a first-order modulator.
## Decimation Filtering
So far, only the ${\Delta \sum }$ modulator representing the analog front end of a ${\Delta \sum }$ ADC has been covered. The digital part, namely, the decimation filter, is the topic of this section. While the analog part of the ADC generally determines the overall resolution, the decimation filter occupies most of the die area and consumes most of the power [80], though the area and power dissipation of the digital part scale down faster than the analog part as the technology gets finer and the supply voltage becomes lower.
The decimation filter consists of a low-pass filter and a downsampler. Attenuation of the quantization noise above the baseband, bandlimiting the input signal, and suppression of the out-of-band spurious signals and circuit noise are the functions of the filter. Upon filtering, the output is resampled at the Nyquist rate. The filtering and rate reduction operations are typically performed in several stages $\left\lbrack  {{30},{31},{80}}\right\rbrack$ in order to reduce both hardware complexity and power dissipation. Most of the ${\Delta \sum }$ ADC applications demand decimation filters with linear phase characteristics. Therefore, symmetric finite-impulse-response (FIR) filters [81] are widely used in decimation filter implementations. In an FIR filter, for a specified ripple and attenuation, the number of filter coefficients is proportional to the ratio of the filter's input rate, ${f}_{s}$ , and the transition bandwidth, ${f}_{t}\left\lbrack  {{31},{42}}\right\rbrack$ . Therefore, for narrow-band filters, such as the decimation filter of a ${\Delta \sum }$ ADC, the number of filter coefficients can be quite large. By implementing decimation filters in several stages, ${f}_{s}/{f}_{t}$ can be reduced for individual stages resulting in a smaller number of total filter coefficients-hence the reduced hardware complexity and power consumption.
Figure 9.9-10 illustrates a typical multistage decimation filter used in today's state-of-the-art ${\Delta \sum }$ ADCs. For ${\Delta \sum }$ modulators with noise-shaping functions in the form of ${\left( 1 - {z}^{-1}\right) }^{L}$ , the first stage of the decimation filter can be implemented very efficiently using a cascade of comb filters [30]. Comb filters are suitable for reducing the sampling rate to four times the Nyquist rate. The remaining filtering is performed either in a single stage or in two stages with FIR or infinite-impulse-response (IIR) filters according to the decimation filtering requirements. Depending on the ADC specifications, a droop correction filter may be required. The comb filter is designed to suppress the quantization noise that would otherwise alias into the signal band upon sampling at an intermediate rate, ${f}_{s1}$ . Out-of-band components of the signal are attenuated by the subsequent filter stages before the signal is resampled at the Nyquist rate. When the quantization noise is sampled at ${f}_{s1}$ , its components around the harmonics of ${f}_{s1}$ fold back into the signal band. Therefore, it is desirable to place the zeros of the comb filter at these frequencies to suppress the quantization noise. There is no need for an abrupt cutoff at signal passband edge ${f}_{b}$ , because noise components in the range ${f}_{b}$ to ${f}_{s1} - {f}_{b}$ fold on themselves without contaminating the signal band.

Figure 9.9-10 A multistage decimation filter.
A comb filter computes a running average of the last $D$ input samples and can be expressed as
$$
y\left\lbrack  n\right\rbrack   = \frac{1}{D}\mathop{\sum }\limits_{{i = 0}}^{{D - 1}}x\left\lbrack  {n - i}\right\rbrack   \tag{9.9-13}
$$
where $D$ is the decimation factor (i.e., ${f}_{s}\left( {f}_{s1}\right)$ . The corresponding $z$ -domain expression is
$$
{H}_{D}\left( z\right)  = \mathop{\sum }\limits_{{i = 1}}^{D}{z}^{-i} = \frac{1}{D}\frac{1 - {z}^{-D}}{1 - {z}^{-1}} \tag{9.9-14}
$$
The frequency response is obtained by evaluating ${H}_{D}\left( z\right)$ for $z = {e}^{j2\pi fTs}$ :
$$
{H}_{D}\left( f\right)  = \frac{1}{D}\frac{\sin {\pi fD}{T}_{s}}{\sin {\pi f}{T}_{s}}{e}^{-{j2\pi f}{T}_{s}/D} \tag{9.9-15}
$$
where ${T}_{s}$ is the input sampling period $\left( { = 1/{f}_{s}}\right)$ . Note that the phase response of ${H}_{D}\left( f\right)$ is linear. A single comb filter section does not provide sufficient noise suppression to prevent a significant increase in the baseband noise floor. A cascade of several comb filter stages must be used for the required attenuation. It has been shown that for an $L$ th-order modulator with noise-shaping function ${\left( 1 - {z}^{-1}\right) }^{L}$ , the required number of comb filter stages is $L + 1$ [30]. The magnitude response of such a filter is given by
$$
\left| {{H}_{D}\left( f\right) }\right|  = {\left( \frac{1}{D}\frac{\sin {\pi fD}{T}_{s}}{\sin {\pi f}{T}_{s}}\right) }^{K} \tag{9.9-16}
$$
where $K$ is the number of stages. Figure 9.9-11 illustrates the above equation for $K = 1,2$ , and 3. Comb filters can be implemented very efficiently without multipliers or storage units for coefficients $\left\lbrack  {{42},{80}}\right\rbrack$ . Figure 9.9-12 shows a realization of cascaded comb filters based on Eq. (9.9-14). The filter is separated into two parts. Integrators operating at the input rate ${f}_{s}$ implement the numerator part. They are followed by a sampler operating at the output rate, ${f}_{s1}\left( { = {f}_{s}/D}\right)$ . Finally, the denominator part is realized by $L + 1$ differentiators. Note that, in Fig. 9.9-12, the integrator delays are placed in the feedforward path, instead of the feedback path. This modification introduces pipelining to reduce the critical path from $L + 1$ adder delays to a single adder delay.

Figure 9.9-11 Magnitude response of a cascaded comb filter for $K = 1,2$ , and 3.
The specifications for the remaining sections of the decimation filter depend on the application of the ${\Delta \sum }$ ADC. Hardware efficient IIR filters are preferred for applications in which phase nonlinearity can be tolerated. Otherwise, linear phase FIR filters are needed. Passband ripple, transition bandwidth, and stopband attenuation are some of the other criteria for selection of appropriate filter implementations. Linear phase FIR filters can be implemented efficiently using polyphase structures [30]. In some applications, the second-stage decimation filtering is performed in two stages using two hardware efficient half-band filters.
## Implementation of Delta-Sigma Modulators
An overwhelming majority of today's delta-sigma modulators are realized by adopting a fully differential switched capacitor implementation. The fully differential architecture doubles the signal swing and increases the dynamic range by $6\mathrm{\;{dB}}$ . Moreover, the common-mode signals that may couple to the signal through the supply lines and the substrate are rejected and charges injected by switches are canceled to the first order. Switched capacitor implementation of the loop filter is typically preferred over an active- ${RC}$ or ${g}_{m} - C$ based design because of more accurate control of integrator gains. Block diagrams of a widely used second-order delta-sigma modulator and its switched capacitor implementation are shown in Figs. 9.9-13(a) and 9.9- 13(b), respectively. Both integrators have a gain of 0.5. As is evident from the clock phases, the modulator is fully pipelined by realizing both integrators with one sample delay. This prevents the double-settling problem in which two series connected op amps have to settle in one clock period. Such a case demands faster op amps, resulting in high power consumption.

Figure 9.9-12 Implementation of a cascaded comb filter.

Figure 9.9-13 (a) Block diagram of a second-order delta-sigma modulator. (b) Fully differential switched capacitor implementation of (a). The $Y$ and ${YB}$ switches operate during ${\phi }_{2}$ .
In a delta-sigma modulator implementation, the most important block is the first integrator. Linearity, noise, and settling behavior of the first integrator op amp are among the most critical circuit parameters. The rest of the components in the modulator loop and their non-idealities have less influence in the band of interest. Fully differential folded-cascode or cas-code (telescopic) amplifiers discussed in Chapter 7 are often used to realize the op amps. There is no stringent design requirement on the comparator to be used in a ${\Delta \sum }$ modulator. The nonidealities of the comparator undergo a noise shaping by the loop filter. Therefore, a simple comparator structure that does not include a preamplifier or an offset cancellation can fulfill the required task. The latch-type comparators of Section 8.5 are uniquely suited for this application. Once the integrator gains are determined the capacitor sizes are chosen based on thermal noise and matching requirements. Typically, for high-resolution applications, the first integrator capacitor values are dictated by thermal noise specifications, whereas the capacitor values of the remaining integrators are chosen based on matching requirements.
## Delta-Sigma DACs
So far the discussion has only focused on delta-sigma ADCs. The principles of oversampling and noise shaping are also widely used in the implementation of delta-sigma DACs. Similar to the case in ADCs, delta-sigma DACs are preferred over Nyquist rate DACs in high-resolution applications, since they are more tolerant to component mismatch and circuit nonideali-ties. Delta-sigma DACs are mostly composed of digital components and therefore suitable for today's digitally driven process technologies. Although the analog part of delta-sigma DACs is relatively small, it is not any easier to design than the analog noise-shaping loop used in delta-sigma ADCs. Keeping the circuit noise at desirable levels and meeting the linearity requirements are quite challenging in high-resolution delta-sigma DACs.

Figure 9.9-14 Simplified block diagram of a delta-sigma DAC.
A simplified block diagram of a delta-sigma DAC is shown in Fig. 9.9-14 [31]. A digital signal with $N$ -bit words with a data rate of ${f}_{N}$ is sampled at a higher rate of $M$ times ${f}_{N}$ by means of an interpolator. Interpolation is achieved by inserting 0 's between each input word with a rate of $M{f}_{N}$ , and then filtering by a digital low-pass filter.
An illustration of Fig. 9.9-14 in more detail is shown in Fig. 9.9-15. The 1-bit pulse density modulation of the digital delta-sigma modulator is converted to an analog signal by switching between two reference voltages. This is followed by an analog low-pass filter to remove the high-frequency quantization noise, yielding the required analog output signal. The sources of error in the delta-sigma DAC are the device mismatch, which causes harmonic distortion rather than DNL or INL, component noise, device nonlinearities, clock jitter sensitivity, and inband quantization error from the ${\Delta \sum }$ modulator.
The DAC in Fig. 9.9-15 can be implemented by voltage or current. The crucial requirement is that the positive and negative reference voltages or currents must be matched. If $y\left( k\right)$ represents the ${MSB}$ output of the digital filter, then Figs. 9.9-16(a) and 9.9-16(b) illustrate a possible voltage and current implementation of the DAC of Fig. 9.9-15. ${\phi }_{1}$ and ${\phi }_{2}$ are two nonoverlapping phases of a clock at the frequency of ${f}_{S}$ .
The signal spectra of the input signal and the interpolated signal are shown in the top two graphs of Fig. 9.9-17. The signal at the output of the interpolation filter is passed through a delta-sigma modulator in which the digital-bit stream is truncated into words with less number of bits (usually 1-bit) while keeping the resulting quantization (or truncation) noise out of the signal band. Finally, the data are converted into analog by a DAC-low-pass filter combination. Typically, the DAC and the first stage of the low-pass filter filter are implemented using a switched capacitor filter structure similar to the one shown in Fig. 9.9-18. This circuit samples the value of $y\left( k\right)$ on ${C}_{1}$ during ${\phi }_{1}$ and applies it to the low-pass filter consisting of $R$ and ${C}_{2}$ during ${\phi }_{2}$ . The switched capacitor, low-pass filter is followed by a continuous time low-pass filter to provide the necessary attenuation of the quantization noise. The signal spectra at the input and output of the analog section are shown on the bottom two graphs of Fig. 9.9-17. Both digital and analog delta-sigma modulators have the same properties. Loops with identical topologies have the same stability conditions and the same amount of quantization noise for a given oversampling ratio. Therefore, we will not discuss digital delta-sigma modulators. Similar to the delta-sigma ADCs, single-loop and multiloop topologies as well as single-bit and multibit quantizers are used in delta-sigma DACs [39,82,83].

Figure 9.9-15 Detailed block diagram of a delta-sigma DAC.

Figure 9.9-16 (a) A voltage-driven DAC with a passive low-pass filter stage. (b) A current-driven DAC with a passive low-pass filter stage.

Figure 9.9-17 Frequency spectra at different points of the delta-sigma DAC.

Figure 9.9-18 A switched capacitor DAC implementation.
## Comparison of Delta-Sigma Data Converters
Delta-sigma data converters are a category of data converters that have a tremendous potential for trading off various aspects of converter performance. There are many reported examples to substantiate this claim. Delta-sigma ADCs realized with switched capacitor techniques have at one extreme achieved 15-bit resolution with a ${2.5}\mathrm{{MHz}}$ conversion rate [35] and 20-bit resolution in audio bandwidth [56], and on the low-voltage/low-power extreme one realization reported a 1.5 V,1.0 mW audio delta-sigma modulator with ${98}\mathrm{\;{dB}}$ dynamic range [84]. Proper operation down to ${0.9}\mathrm{\;V}$ with only ${40\mu }\mathrm{A}$ current consumption has also been demonstrated in an implementation with ${77}\mathrm{\;{dB}}{DR}$ in ${16}\mathrm{{kHz}}$ bandwidth [85]. Loop topologies vary from a simple second-order loop [86] to more complex 2-2-2 cascade [70] to seventh-order single loop [56]. Most of the reported high-performance delta-sigma DACs are designed for audio applications. Greater than ${110}\mathrm{\;{dB}}{DR}$ has been achieved in several multibit delta-sigma DACs [82,83].
### 9.10 Summary
The characterization, analysis, and design of CMOS digital-to-analog and analog-to-digital converters have been presented in this chapter. The DACs and ADCs are rapidly moving from stand-alone components on a single chip to becoming a part of a larger system on a chip. In this respect, the ability to optimize the converter for a given set of specifications is very important. The primary trade-offs for both DACs and ADCs is conversion speed, resolution, and power. As a part of a larger system, minimum power dissipation is becoming very important.
Nyquist DACs were divided into the categories of serial and parallel. Serial converters were slow but dissipated less power and could have reasonably high accuracy. The resolution of the DAC can be extended by using pipelining using subDACs. This technique uses two approaches to scale the reference. One is to scale the analog output of the subDACs (divider approach) and the other is to scale the reference of the subDACs (subranging approach). The pipelining approach allows increased component accuracy because the largest-to-smallest component spreads are reduced. It was also shown that the subDACs could use different scaling techniques (voltage, current, or charge). Relationships were developed to help choose which type of scaling was appropriate for the subDAC and how many bits should be used. The DAC generally has higher conversion speed and more resolution than ADCs. The general limit of the DAC performance is related to the scaling accuracy of the passive components for static performance and the bandwidth and slew rate of the op amps for the dynamic performance. Typical Nyquist DAC performance is 12-14-bits at 20-400 megasamples/second. Delta-sigma DACs have increased resolution but lower conversion rates.
A principle that is true for all converters is that the accuracy of the ${MSB}$ stages must be the greatest and the accuracy of the LSB stages the smallest. This often leads to a cyclic implementation, where one stage is implemented with very high precision and used repeatedly. Unfortunately, the repeated use of one accurate stage leads to a slower converter. If all stages are implemented from the MSB stage to the LSB stage, a high conversion speed is obtained at the price of latency.
Nyquist ADCs were divided into three categories-serial, successive approximation, and fast. The fast category included flash, multiple-bit pipeline, and folding and interpolation. By nature the ADC is a sampling operation and will require an antialiasing filter for proper operation. Often, the bandwidth limit of the ADC serves as the antialiasing filter. The sampling can be accomplished by a sample-and-hold circuit or by comparators that are clocked. In the ADC, the static performance strongly depends on the accuracy of the scaling of the passive components and the performance of the comparators or sample-and-hold for the dynamic performance. The pipeline A/D implementation offers the ability to accomplish digital error correction, which reduces the influence of the comparator performance on the converter. The highest speed ADCs are the flash and the folding/interpolating architectures. Unfortunately, the higher the speed, the higher the power dissipation. As the speed of conversion for fast comparators approaches hundreds or megasamples/second, the power is approaching $1\mathrm{\;W}$ , which in many cases is far too much power dissipation.
The delta-sigma ADC has offered an interesting trade-off between speed and resolution. A typical delta-sigma ADC has a resolution in the range of 12-16-bits with signal bandwidths from ${20}\mathrm{{kHz}}$ to $5\mathrm{{MHz}}$ . An interesting version of the delta-sigma ADC is the bandpass delta-sigma ADC. These ADCs find application as the IF-to-baseband conversion stage in radio receivers. The oversampling ratio is between the bandwidth of the A/D and the sampling frequency, whereas the center frequency can be quite close to the sampling frequency. As a result, the center frequency of bandpass delta-sigma ADCs can be in the tens of megahertz.
The state of the art in CMOS ADCs is rapidly advancing over time. An excellent summary of the state of the art in ADCs from 1997 to 2010 is found in [87]. This reference is an Excel spreadsheet that contains all ADCs published at the IEEE International Solid-State Circuits Conference and the IEEE VLSI Conference from 1997 through 2010. This spreadsheet can be downloaded from http://www.stanford.edu/~murmann/adcsurvey.html.The raw data in this spreadsheet contain the information about the year, the authors, the technology, and the ADC architecture including Nyquist and oversampling converters. The raw data available include power, the Nyquist sampling rate $\left( {{f}_{s}/\mathrm{{OSR}}}\right)$ , THD, peak SNDR, peak SNR, and SFDR.
In addition to the raw data, an energy plot and an aperture plot are given. These plots are shown as Figs. 9.10-1 and 9.10-2. The idea as described by Murmann was to have one plot where low energy designs can shine (the energy plot) and one where designs with good speed-resolution product will stand out (the aperture plot). It is rare that an ADC design would look good in both plots. For Fig. 9.10-1, the energy plot, the x-axis = SNDR plot and the y-axis = power/Nyquist frequency. For Fig. 9.10-2, the aperture plot, the x-axis = SNDR plot and the y-axis = BW plot. In the aperture plot, the lines for Jitter = 0.1 ps(rms)/1 ps(rms) and are performance lines that a fictitious sampler with only the specified jitter numbers (no other nonidealities, such as quantization noise, etc.) would achieve. In the energy plot, the lines labeled FOM $= {10}/{100}\mathrm{{fJ}}/$ conv-step correspond to the Walden FOM [88] at the respective energy/conversion-step value.
The trends in ADCs are easy to see from these plots. As the resolution increases (increasing SNDR), Fig. 9.10-1 shows that the energy required goes up. It is seen that very few designs have less than ${10}\mathrm{{fJ}}/$ conversion-step. On the other hand, as the resolution increases, Fig. 9.10-2 shows that the bandwidth or speed decreases. The advantage of having these data in spreadsheet format is that the reader can use the raw data to make comparisons or conduct focused studies. No doubt, the author of the spreadsheet will continue to update it as the years continue. Other publications of interest include [89,90].
In the second edition of this text [91], a summary was given of the state of the art from 1997 through 1999. It was seen in that summary that the highest resolution converters are delta-sigma type and the fastest are the flash or folding and interpolating ADCs. The

Figure 9.10-1 ADC energy plot of analog-digital converters published from 1997 to 2010 [87].
bandpass delta-sigma ADCs can operate at frequencies as high as ${80}\mathrm{{MHz}}$ with a resolution a little over 11 bits. In addition, the summary showed that the highest power dissipation belongs to those converters with a large conversion rate and a large resolution. The pipeline and folding and interpolating ADCs dissipate the most power followed by the flash ADCs. The lowest power dissipation ADCs are the delta-sigma ADCs. It is interesting to note that the delta-sigma ADCs offers the widest trade-off of any of the ADCs when it comes to power dissipation. In general, power dissipation in the delta-sigma tends to be proportional to the number of stages and the bandwidth of the signal.

Figure 9.10-2 ADC aperture plot of analog-digital converters published from 1997 to 2010 [87].
The trends in DACs and ADCs will be to continue to push the trade-off between conversion rate, resolution, and power dissipation. One obvious trend is to optimize this trade-off from the viewpoint of a given application. As the DACs and ADCs become part of a larger system, their performance can be enhanced from the standpoint of that system's demands. DACs and ADCs will continue to offer significant challenges to the design skills of analog IC designers for many years to come.
## Problems
9.1-1. Plot the analog output versus the digital word input for a 3-bit DAC that has $\pm  {1LSB}$ differential linearity and $\pm  {1LSB}$ integral linearity. Assume an arbitrary analog full scale value.
9.1-2. Repeat Problem 9.1-1 for $\pm  {1.5}\mathrm{{LSB}}$ differential linearity and $\pm  {0.5LSB}$ integral linearity.
9.1-3. Repeat Problem 9.1-1 for $\pm  {0.5LSB}$ differential linearity and $\pm  {1.5LSB}$ integral linearity.
9.1-4. The transfer characteristics of an ideal and actual 4-bit DAC are shown in Fig. P9.1-4. Find the $\pm  {INL}$ and $\pm  {DNL}$ in terms of ${LSBs}$ . Is the converter monotonic or not?

Figure P9.1-4
9.1-5. A 1 V peak-to-peak sinusoidal signal is applied to an ideal 10-bit DAC, which has a ${V}_{\text{REF }}$ of $5\mathrm{\;V}$ . Find the maximum ${SNR}$ of the digitized analog output signal.
9.1-6. How much noise voltage in rms volts can a $1\mathrm{\;V}$ reference voltage have and not cause errors in a 14-bit DAC? What must be the fractional temperature coefficient (ppm/°C) for the reference voltage of this DAC over the temperature range of $0 - {100}{}^{ \circ  }\mathrm{C}$ ?
9.1-7. If the quantization level of an ADC is $\Delta$ , prove that the rms quantization noise is given as $\Delta /\sqrt{12}$ .
9.2-1. Find ${I}_{OUT}$ in terms of ${I}_{0},{I}_{1},{I}_{2}$ , and ${I}_{3}$ for the circuit shown in Fig. P9.2-1.

Figure P9.2-1
9.2-2. A DAC uses the binary-weighted current sinks shown in Fig. P9.2-2. ${b}_{0}$ is the ${MSB}$

Figure P9.2-2
and ${b}_{N - 1}$ is the ${LSB}$ . (a) For each individual current sink, find the tolerance in $\pm$ percent necessary to keep ${INL}$ less than $\pm  {0.5}\mathrm{{LSB}}$ for $N$ -bits, assuming all other bits are ideal. (b) Considering the influence of all current sinks, what is the worst-case tolerance in $\pm$ percent for each sink?
9.2-3. A 4-bit binary-weighted, voltage scaling DAC is shown in Fig. P9.2-3. (a) If ${R}_{0} = {7R}/8,{R}_{1}$ $= {2R},{R}_{2} = {4R},{R}_{3} = {8R},{R}_{4} = {16R}$ , and ${V}_{OS}$ $= 0\mathrm{\;V}$ , sketch the digital-analog transfer curve. (b) If ${R}_{0} = R,{R}_{1} = {2R},{R}_{2} = {4R},{R}_{3} =$ ${8R},{R}_{4} = {16R}$ , and ${V}_{OS} = {0.0645}{V}_{\mathrm{{REF}}}$ , sketch the digital-analog transfer curve. (c) If ${R}_{0} =$ $R,{R}_{1} = {2R},{R}_{2} = {16R}/3,{R}_{3} = {32R}/5,{R}_{4} =$ ${16R}$ , and ${V}_{OS} = 0\mathrm{\;V}$ , sketch the digital-analog transfer curve on the previous transfer curve. For this case, what is the value of ${DNL}$ and INL? Is this DAC monotonic or not?

9.2-4. A 4-bit DAC characteristic using the DAC of Fig. P9.2-3 is shown in Fig. P9.2-4. (a) Find the ${DNL}$ and the ${INL}$ of this converter. (b) What are the values of ${R}_{1}$ through ${R}_{4}$ that correspond to this input-output characteristic? Find these values in terms of ${R}_{0}$ .

9.2-5. For the DAC of Fig. P9.2-3, design the values of ${R}_{1}$ through ${R}_{4}$ in terms of ${R}_{0}$ to achieve an ideal 4-bit DAC. (a) What value of input-offset voltage, ${V}_{OS}$ , normalized to ${V}_{\text{REF }}$ will cause an error? (b) Assume that the gain bandwidth, ${GB}$ , of the op amp is infinite and find the minimum differential voltage gain, ${A}_{vd}\left( 0\right)$ , required for the DAC to have an INL of $\pm  {0.5}$ LSB. (c) If the differential voltage gain is very large, find the conversion time of this DAC if ${GB} = 1$ MHz.
9.2-6. An 8-bit current DAC is shown in Fig. P9.2-6. Assume that the full scale range is $1\mathrm{\;V}$ . (a) Find the value of $I$ if $R = 1\mathrm{k}\Omega$ . (b) Assume that all aspects of the DAC are ideal except for the op amp. If the differential voltage gain of the op amp has a single-pole frequency-response with a dc gain of ${10}^{5}$ , find the unity-gain bandwidth, ${GB}$ , in hertz that gives a worst-case conversion time of ${2\mu }\mathrm{s}$ . (c) Again assume that all aspects of the DAC are ideal except for the op amp. The op amp is ideal except for a finite slew rate. Find the minimum slew rate, ${SR}$ , in $\mathrm{V}/\mu$ s that gives a worst-case conversion time of ${2\mu }\mathrm{s}$ .

9.2-7. Assume that the current sinks and the $R - {2R}$ ladder are ideal for the DAC shown in Fig. P9.2-7. If bit $i$ is 1, then switch ${S}_{i}$ is connected to the $R - {2R}$ ladder; otherwise, ${S}_{i}$ is connected to ground. (a) What is the full scale value of this converter? (b) Design the value of $I$ if ${V}_{REF} = 5\mathrm{\;V}$ . (c) Assume the worst-case conditions and find the maximum number of bits that this converter can convert at low frequencies if the differential voltage gain of the op amp is given as
$$
{A}_{vd}\left( s\right)  = \frac{{10}^{6}}{s + {100}}
$$

(d) If $N = {10}$ , find the worst-case conversion frequency in conversions/second.
9.2-8. If the binary controlled switch ${b}_{0}$ of Fig. P9.2-3 is closed at $t = 0$ , find the time it takes the output to achieve its final state $\left( {-{V}_{\mathrm{{REF}}}/2}\right)$ by assuming that this time is four times the time constant of this circuit. The differential voltage gain of the op amp is given as
$$
{A}_{vd}\left( s\right)  = \frac{{10}^{6}}{s + {10}}
$$
9.2-9. What is the necessary relative accuracy of capacitor ratios in order for a charge scaling DAC to have 11-bit resolution?
9.2-10. For the charge scaling DAC of Fig. 9.2-10, investigate the influence of a load capacitor, ${C}_{L}$ , connected in parallel with the terminating capacitor. (a) Find an expression for ${v}_{\mathrm{{OUT}}}$ as a function of $C,{C}_{L}$ , the digital bits ${b}_{i}$ , and ${V}_{\text{REF }}$ . (b) What kind of static error does ${C}_{L}$ introduce? (c) What is the largest value of ${C}_{L}/C$ possible before an error is introduced in this DAC?
9.2-11. Express the output of the DAC shown in Fig. P9.2-11 during the ${\phi }_{2}$ period as a function of the digital bits ${b}_{i}$ , the capacitors, and the reference voltage ${V}_{\mathrm{{REF}}}$ . If the op amp has an offset of ${V}_{OS}$ , how is this expression for the output changed? What kind of error will the op amp offset cause?
9.2-12. Develop the equivalent circuit of Fig. 9.2- 11 from Fig. 9.2-10.
9.2-13. If the tolerance of the capacitors in the 8- bit, binary-weighted array shown in Fig. P9.2-13 is $\pm  {0.5}\%$ , what would be the worst-case ${DNL}$ in units of ${LSBs}$ and at what transition does it occur?
9.2-14. A binary-weighted DAC using a charge amplifier is shown in Fig. P9.2-14. At the beginning of the digital-to-analog conversion, all capacitors are discharged. If a bit is 1, the capacitor is connected to ${V}_{\mathrm{{REF}}}$ and if the bit is 0 , the capacitor is connected to ground. (a) Design ${\mathrm{C}}_{X}$ to get
$$
{V}_{\mathrm{{OUT}}} = \left( {\frac{{b}_{0}}{2} + \frac{{b}_{1}}{4} + \cdots  + \frac{{b}_{N - 1}}{{2}^{N}}}\right) {V}_{\mathrm{{REF}}}
$$
(b) Identify the switches by ${b}_{i}$ , where $i = 0$ is the ${MSB}$ and $i = N - 1$ is the ${LSB}$ . (c) What is the maximum component spread for the capacitors? (d) Is this DAC fast or slow? Why? (e) Can this DAC be nonmonotonic? (f) If the capacitor matching is ${0.2}\%$ (regardless of capacitor sizes) what is the maximum value of $N$ for ideal operation?

Figure P9.2-11

Figure P9.2-14
9.2-15. The circuit shown in Fig. P9.2-15 is an equivalent for the operation of a DAC. The op amp differential voltage gain, ${A}_{vd}\left( s\right)$ , is modeled as
$$
{A}_{vd}\left( s\right)  = \frac{{A}_{vd}\left( 0\right) {\omega }_{a}}{s + {\omega }_{a}} = \frac{GB}{s + {\omega }_{a}}
$$
(a) If ${\omega }_{a}$ goes to infinity so that ${A}_{vd}\left( s\right)  \approx$ ${A}_{vd}\left( 0\right)$ , what is the minimum value of ${A}_{vd}\left( 0\right)$ that will cause a $\pm  {0.5}\mathrm{{LSB}}$ error for an 8-bit DAC? (b) If ${A}_{vd}\left( 0\right)$ is much larger than the value found in (a), what is the minimum conversion time for an 8-bit DAC that gives a $\pm  {0.5LSB}$ error if ${GB} = 1\mathrm{{MHz}}$ ?
9.2-16. A charge scaling DAC is shown in Fig. P9.2-16 that uses a $C - {2C}$ ladder. All capacitors are discharged during the ${\phi }_{1}$ phase. (a) What value of ${C}_{F}$ is required to make this DAC work correctly? (b) Write an expression for ${v}_{\mathrm{{OUT}}}$ during ${\phi }_{2}$ in terms of the bits, ${b}_{i}$ , and the reference voltage, ${\mathrm{V}}_{\text{REF }}$ . (c) Discuss at least two advantages and two disadvantages of this DAC compared to other types of DACs. $= 2$ . If the divisor has an incorrect value of 2, express the $\pm  {INL}$ and the $\pm  {DNL}$ in terms of ${LSBs}$ and determine whether or not the DAC is monotonic. Repeat if the

9.3-3. Repeat Problem 9.3-1 if the divisor is correct (4) and the ${V}_{\mathrm{{REF}}}$ for the ${MSB}$ subDAC is ${0.75}{V}_{\mathrm{{REF}}}$ and the ${V}_{\mathrm{{REF}}}$ for the ${LSB}$ subDAC is ${1.25}{V}_{\mathrm{{REF}}}$ .
9.3-4. Find the worst-case tolerance $\left( {\pm \% }\right)$ of the divisor, $x$ , for the DAC of Fig. 9.3-1 that has $M = 3$ and $K = 3$ . Assume that the subDACs are ideal in all respects except for the divisor.
9.3-5. The DAC of Fig. 9.3-2 has $M = 3$ and $K = 3$ . (a) Find the ideal value of the divisor of ${V}_{\text{REF }}$ designated as $x$ . (b) Find the largest value of $x$ that causes a $1\mathrm{{LSB}}\mathrm{{DNL}}$ . (c) Find the smallest value of $x$ that causes a 2LSB DNL.
9.3-6. Show for the results of Example 9.3-2 that the resulting ${INL}$ and ${DNL}$ will be equal to $\pm  {0.5LSB}$ or less.
9.3-7. A 4-bit DAC is shown in Fig. P9.3-7. When a bit is 1 , the switch pertaining to that bit is connected to the op amp negative input terminal; otherwise, it is connected to ground. Identify the switches by the notation ${b}_{0},{b}_{1},{b}_{2}$ , or ${b}_{3}$ , where ${b}_{i}$ corresponds to the $i$ th-bit and ${b}_{0}$ is the ${MSB}$ and ${b}_{3}$ is the LSB. Solve for the value of ${R}_{x}$ that will give proper DAC performance.
9.3-8. Assume ${R}_{1} = {R}_{5} = {2R},{R}_{2} = {R}_{6} = {4R},{R}_{3}$ $= {R}_{7} = {8R},{R}_{4} = {R}_{8} = {16R}$ , and that the op amp is ideal in Fig. P9.3-8. (a) Find the values of ${R}_{9}$ and ${R}_{10}$ in terms of $R$ that give an ideal 8-bit DAC. (b) Find the range of values of ${R}_{9}$ in terms of $R$ that keep the ${INL} \leq   \pm  {0.5LSB}$ . Assume that ${R}_{10}$ has its ideal value. (c) Find the range of ${R}_{10}$ in terms of $R$ that keeps the converter monotonic. Assume that ${R}_{9}$ has its ideal value.
9.3-9. Design a 10-bit two-stage charge scaling DAC similar to Fig. 9.3-4 using two 5-bit sections with a capacitive attenuator between the stages. Give all capacitances in terms of $C$ , which is the smallest capacitor of the design.
9.3-10. A two-stage charge scaling DAC is shown in Fig. P9.3-10. (a) Design ${C}_{x}$ in terms of $C$ , the unit capacitor, to achieve a 6-bit two-stage charge scaling DAC. (b) If ${C}_{x}$ is in error by $\Delta {C}_{x}$ , find an expression for ${v}_{\text{OUT }}$ in terms of ${C}_{x},\Delta {C}_{x},{b}_{i - 1}$ , and ${V}_{\text{REF }}$ . (c) If the expression for ${v}_{\mathrm{{OUT}}}$ in part (b) is given as
$$
{v}_{\mathrm{{OUT}}} = \frac{{V}_{\mathrm{{REF}}}}{8}\left( {1 - \frac{{17\Delta }{C}_{x}}{{100}{C}_{x}}}\right) \left\lbrack  {\mathop{\sum }\limits_{{i = 1}}^{3}{b}_{i - 1} \cdot  {2}^{3 - i}}\right.
$$
$$
\left. {+\left( {1 + \frac{{8\Delta }{C}_{x}}{{10}{C}_{x}}}\right) \mathop{\sum }\limits_{{i = 4}}^{6}\frac{{b}_{i - 1} \cdot  {2}^{6 - i}}{8}}\right\rbrack
$$

Figure P9.3-11
what is the accuracy of ${C}_{x}$ necessary to avoid an error using worst-case considerations?
9.3-11. If the op amps in the circuit of Fig. P9.3-11 have a dc gain of ${10}^{4}$ and a dominant pole at ${100}\mathrm{\;{Hz}}$ , at what clock frequency will the effective number of bits (ENOB) equal 7-bits, assuming that the capacitors and switches are ideal? Use a worst-case approach to this problem and assume that time responses of the ${LSB}$ and ${MSB}$ stages add to give the overall conversion time.
9.3-12. The DAC in Fig. P9.3-12 uses two identical 2-bit DACs to achieve a 4-bit DAC. Give an expression for ${v}_{\mathrm{{OUT}}}$ as a function of ${V}_{\mathrm{{REF}}}$ and the bits ${b}_{0},{b}_{1},{b}_{2}$ , and ${b}_{3}$ during the ${\phi }_{2}$ phase period. The switches controlled by the bits are closed if the bit is high and open if the bit is low during the ${\phi }_{2}$ phase period. If $k = 2$ , express the INL (in terms of a $\pm  {LSB}$ value) and ${DNL}$ (in terms of a $\pm  {LSB}$ value) and determine whether the converter is monotonic or not.

Figure P9.3-12
9.3-13. An $N$ -bit DAC consists of a voltage scaling DAC of $M$ -bits and a charge scaling DAC of $K$ -bits $\left( {N = M + K}\right)$ . The accuracy of the resistors in the $M$ -bit voltage scaling DAC is $\pm  {\Delta R}/R$ . The accuracy of the binary-weighted capacitors in the charge scaling DAC is ${\Delta C}/C$ . Assume for this problem that ${INL}$ and ${DNL}$ can be expressed generally as
$$
{INL} = \left( \begin{matrix} \text{ Accuracy of } \\  \text{ component } \end{matrix}\right)  \times  \left( \begin{matrix} \text{ Maximum } \\  \text{ weighting factor } \end{matrix}\right)
$$
$$
{DNL} = \left( \begin{matrix} \text{ Accuracy of the } \\  \text{ largest component } \end{matrix}\right)  \times  \left( \begin{matrix} \text{ Corresponding } \\  \text{ weighting factor } \end{matrix}\right)
$$
where the weighting factor for the $i$ th-bit is ${2}^{N - i - 1}$ . (a) If the ${MSB}$ -bits use the $M$ -bit voltage scaling DAC and the LSB-bits use the $K$ -bit charge scaling DAC, express the ${INL}$ and ${DNL}$ of the $N$ -bit DAC in terms of $M, K, N,{\Delta R}/R$ , and ${\Delta C}/C$ . (b) If the ${MSB}$ - bits use the $K$ -bit charge scaling DAC and the ${LSB}$ -bits use the $M$ -bit voltage scaling DAC, express the ${INL}$ and ${DNL}$ of the $N$ - bit DAC in terms of $M, K, N,{\Delta R}/R$ , and ${\Delta C}/C$ .
9.3-14. Below are the formulas for ${INL}$ and ${DNL}$ for the case where the ${MSB}$ and ${LSB}$ arrays of a DAC are either voltage or charge scaling. $N = M + K$ , where $M$ is the number of bits of the ${MSB}$ array, $K$ is the number of bits of the ${LSB}$ array, and $N$ is the total number of bits. Find the values of $N, M$ , and $K$ and tell what type of DAC (voltage ${MSB}$ and charge ${LSB}$ or charge ${MSB}$ and voltage ${LSB}$ ) will satisfy the requirements if ${\Delta R}/R$ $= 1\%$ and ${\Delta C}/C = {0.1}\%$ and both the ${INL}$ and ${DNL}$ of the DAC combination should each be ${1LSB}$ or less.
<table><tr><td>DAC Combination</td><td>INL (LSBs)</td><td>DNL (LSBs)</td></tr><tr><td>MSB voltage (M-bits) ${LSB}$ charge (K-bits)</td><td>${2}^{N - 1}\frac{\Delta R}{R} + {2}^{K - 1}\frac{\Delta C}{C}$</td><td>${2}^{K}\frac{\Delta R}{R} + \left( {{2}^{K} - 1}\right) \frac{\Delta C}{C}$</td></tr><tr><td>MSB charge (M-bits) ${LSB}$ voltage (K-bits)</td><td>${2}^{M - 1}\frac{\Delta R}{R} + {2}^{N - 1}\frac{\Delta C}{C}$</td><td>$\frac{\Delta R}{R} + \left( {{2}^{N} - 1}\right) \frac{\Delta C}{C}$ _____</td></tr></table>
9.3-15. The circuit shown in Fig. P9.3-15 is a double-decoder DAC. Find an expression for ${v}_{X}$ in terms of ${V}_{1},{V}_{2}$ , and ${V}_{\text{REF }}$ when the ${\phi }_{2}$ switches are closed. If $A = 1, B = 0, C =$ 1, and $D = 1$ , will the comparator output be high or low if ${V}_{\text{analog }} = {0.8}{V}_{\text{REF }}$ ?
9.3-16. A 4-bit ADC in Fig. P9.3-16 is shown. Clearly explain the operation of this converter for a complete conversion in a clock-period by clock-period manner, where ${\phi }_{1}$ and ${\phi }_{2}$ are nonoverlapping clocks generated from the square wave with a period of $T$ (i.e., ${\phi }_{1}$ occurs in 0 to $T/2$ and ${\phi }_{2}$ in $T/2$ to $T$ , etc.). What will cause errors in the operation of this converter?
9.4-1. What is ${v}_{C1}$ in Fig. 9.4-1 after the following sequence of switch closures: ${S}_{4},{S}_{3},{S}_{1},{S}_{2}$ , ${S}_{1},{S}_{3},{S}_{1},{S}_{2}$ , and ${S}_{1}$ ?
9.4-2. Repeat Problem 9.4-1 if ${C}_{1} = {1.05}{C}_{2}$ .
9.4-3. For the serial DAC in Fig. 9.4-1, every time the switch ${S}_{2}$ opens, it causes the voltage on ${C}_{1}$ to be decreased by ${10}\%$ . How many bits can this DAC convert before an error occurs assuming worst-case conditions and ${V}_{\mathrm{{REF}}} = 1\mathrm{\;V}$ ? The ana- $\log$ output is taken across ${C}_{2}$ .
9.4-4. For the serial pipeline DAC of Fig. 9.4-3, find the ideal analog output voltage if ${V}_{\text{REF }}$ $= 1\mathrm{\;V}$ and the input is 10100110 from the ${MSB}$ to the ${LSB}$ . If the attenuation factors of 0.5 become 0.55 , what is the analog output for this case?
9.4-5. Give an implementation of the pipeline DAC of Fig. 9.4-3 using two-phase, switched capacitor circuits. Give a complete schematic with the capacitor ratios and switch phasing identified.

Figure P9.3-15
9.4-6. A pipeline DAC is shown in Fig. P9.4-6. If ${k}_{0} = \frac{7}{16},{k}_{1} = \frac{5}{7}$ , and ${k}_{2} = \frac{3}{5}$ write an expression for ${v}_{\mathrm{{OUT}}}$ in terms of ${b}_{i}\left( {i = 0,1,2}\right)$ and ${V}_{\text{REF }}$ . Plot the input-output characteristic on the curve shown and find the largest $\pm  {INL}$ and largest $\pm  {DNL}$ . Is the DAC monotonic or not?
9.4-7. A pipeline ADC in Fig. P9.4-7 is shown. When ${b}_{i}$ is 1, the switch is connected to ${V}_{\mathrm{{REF}}}$ ; otherwise, it is connected to ground.

Figure P9.3-16

Figure P9.4-6
Two of the 0.5 gains on the summing junctions are in error. Carefully sketch the resulting digital-analog transfer characteristic on the plot and identify the INL with respect to the infinite resolution characteristic shown and ${DNL}$ . The ${INL}$ and ${DNL}$ should be measured on the analog axis.
9.4-8. Show how Eq. (9.4-2) can be derived from Eq. (9.4-1). Also show in the block diagram of Fig. 9.4-4 how the initial zeroing of the output can be accomplished.
9.4-9. Assume that the amplifier with a gain of 0.5 in Fig. 9.4-4 has a gain error of ${\Delta A}$ . What is the maximum value ${\Delta A}$ can be in Example 9.4-2 without causing the conversion to be in error?
9.4-10. Repeat Example 9.4-2 for the digital word 10101.
9.4-11. Assume that the iterative algorithmic DAC of Fig. 9.4-4 is to convert the digital word 11001. If the gain of the 0.5 amplifier is 0.7 , at which bit conversion does an error occur?
9.4-12. An iterative algorithmic DAC is shown in Fig. P9.4-12. Assume that the digital word to be converted is 10011 . If ${V}_{\text{REF1 }} =$ ${0.9}{V}_{\mathrm{{REF}}}$ and ${V}_{\mathrm{{REF}}2} =  - {0.8}{V}_{\mathrm{{REF}}}$ , at which bit does an error occur in the conversion of the digital word to an analog output?

Figure P9.4-12
9.5-1. Plot the transfer characteristic of a 3-bit ADC that has the largest possible differential nonlinearity when the integral nonlinearity is limited to $\pm  1\mathrm{{LSB}}$ . What is the maximum value of the differential nonlinearity for this case?
9.5-2. A 3-bit ADC characteristic is shown in Fig. P9.5-2. (a) Find the $\pm  {INL}$ and $\pm  {DNL}$ for the 3-bit ADC shown. (b) Is this ADC monotonic or not?

Figure P9.5-2

Figure P9.4-7
9.5-3. (a) Find the $\pm  {INL}$ and $\pm  {DNL}$ for the 3-bit ADC shown in Fig. P9.5-3 where the INL and ${DNL}$ are referenced to the digital output code. (b) What is the worst-case, symmetrical value of ${INL}\left( {\pm {LSB}}\right)$ of this 3-bit ADC if ${DNL} =  \pm  {0.5LSB}$ ? Give a sketch of your solution.

Figure P9.5-3
9.5-4. Assume that the step response of a sample-and-hold circuit is
$$
{v}_{\mathrm{{OUT}}}\left( t\right)  = {V}_{I}\left( {1 - {e}^{-{tBW}}}\right)
$$
where ${V}_{I}$ is the magnitude of the input step to the sample-and-hold and ${BW}$ is the bandwidth of the sample-and-hold circuit in rad/s and is equal to ${2\pi }$ Mrad/s. Assume a worst-case analysis and find the maximum number of bits this sample-and-hold circuit can resolve if the sampling frequency is $1\mathrm{{MHz}}$ .
9.5-5. If the aperture jitter of the clock in an ADC is ${200}\mathrm{{ps}}$ and the input signal is a $1\mathrm{{MHz}}$ sinusoid with a peak-to-peak value of ${V}_{\mathrm{{REF}}}$ , what is the number of bits that this ADC can resolve?
## 9.5-6. (Design problem-this problem is self- grading).
In this design problem you are required to design a precharge buffer that has rail-to-rail input and output capability. The main duty of the precharge buffer is to charge the sampling capacitor ${C}_{S}$ at the input of an ADC close to the input voltage in a short amount of time. After this precharging phase, the input is directly connected to the sampling capacitor and fine settling is achieved over a switch, as shown in Fig. P9.5-6.
As a result of this phasing, the charge/current required from the input source is reduced. Therefore, the input impedance of the ADC is effectively increased. The reduction in the current and increase in impedance are dependent on the settling performance of the precharge buffer, which is directly related to slew rate, gain bandwidth product, and gain.
In this design you are required to design an amplifier, $A\left( s\right)$ , which should have a settling accuracy of $2\%$ , settling time of ${100}\mathrm{\;{ns}}$ , capacitive load of ${10}\mathrm{{pf}}$ , and total power dissipation of $2\mathrm{\;{mW}}$ . Note that you may need excessive currents to have sufficient slew rate; thus, you may need to dynamically change the tail current or you may use input structures whose slew rates are not defined by the tail current. From the settling accuracy you can come up with the minimum gain you should have. Other design specs are tabulated in Table P9.5-6.
For the settling accuracy and settling time, use the unity-gain configuration of the op amp with a load capacitor of ${10}\mathrm{{pF}}$ . Apply a step input and see the settling time and accuracy.

Figure P9.5-6
Table P9.5-6 Design Specifications for Problem 9.5-6
<table><tr><td>Quantity</td><td>Condition</td><td>Value</td></tr><tr><td>GBW</td><td>${C}_{s} = {10}\mathrm{{pF}}$</td><td>>10 MHz</td></tr><tr><td>Settling time</td><td><2% accuracy</td><td><100 ns</td></tr><tr><td>Input CMR</td><td/><td>Rail to rail</td></tr><tr><td>Output swing</td><td>With capacitive load</td><td>Rail to rail</td></tr><tr><td>Supply</td><td>Single</td><td>5 V</td></tr><tr><td>Power dissipation</td><td>Nominal</td><td>$2\mathrm{{mW}}$</td></tr></table>
You are required to use AMI ${0.5\mu }\mathrm{m}$ process. The transistor models for this process can be downloaded from the MOSIS website:
## http://www.mosis.org/Technical/Testdata/ ami-c5-prm.html
Go to this website and download the SPICE models for any of the runs, preferably T51A. If you click on any one of the runs, you will see the SPICE models for NMOS and PMOS transistors for that run. At the end of the model page you will see a link, "Download Text File." You can use this link to download the model files as a text file. You may need to do some syntax correction depending on the simulator you are using.
Further information about precharge buffers can be found at:
http://www.cirrus.com/en/pubs/appNote/ an30.pdf
Grading will be as follows:
$$
\text{ SCORE } = {20} \times  \min \left\lbrack  {1,{\left( \frac{2}{\text{ Settling accuracy in }\% }\right) }^{2}}\right\rbrack
$$
$$
+ {20} \times  \min \left\lbrack  {1,{\left( \frac{2\mathrm{{mW}}}{\text{ Power dissipation }}\right) }^{2}}\right\rbrack
$$
$$
+ {10} \times  \min \left\lbrack  {1,\left( \frac{\mathrm{{GBW}}}{{10}\mathrm{{MHz}}}\right) }\right\rbrack
$$
$$
+ {20} \times  \min \left\lbrack  {1,\left( \frac{5\mathrm{\;V}}{\mathrm{{ICMR}}\left( \mathrm{V}\right) }\right) }\right\rbrack
$$
$$
+ {10} \times  \min \left\lbrack  {1,\left( \frac{5\mathrm{\;V}}{\text{ Output swing }\left( \mathrm{V}\right) }\right) }\right\rbrack
$$
The values entered in the above SCORE formula must come from computer simulation. You are responsible for providing the supporting information necessary to verify how you determined the value of your SCORE along with a labeled schematic of your circuit.
9.6-1. What is the conversion time in clock periods if the input to Fig. 9.6-2 is ${0.25}{V}_{\mathrm{{REF}}}$ ? Repeat if ${v}_{\text{in }}^{ * } = {0.7}{V}_{\text{REF }}$ .
9.6-2. Using Fig. 9.6-2, give a switched capacitor implementation of the positive integrator and the connection of the input and reference voltage to the integrator via switches 1 and 2 using a two-phase clock.
9.7-1. If the sampled analog input applied to an 8- bit successive-approximation converter is ${0.7}{V}_{\mathrm{{REF}}}$ , find the output digital word.
9.7-2. A 4-bit successive-approximation ADC is shown in Fig. P9.7-2. Assume that ${V}_{\mathrm{{REF}}} =$ $5\mathrm{\;V}$ . Fill in the table below when ${v}_{\text{in }} = 3\mathrm{\;V}$ .
<table><tr><td>Clock Period</td><td>${\mathrm{B}}_{0}{\mathrm{\;B}}_{1}{\mathrm{\;B}}_{2}{\mathrm{\;B}}_{3}$</td><td>Guessed ${\mathrm{D}}_{0}{\mathrm{D}}_{1}{\mathrm{D}}_{2}{\mathrm{D}}_{3}$</td><td>${V}_{\text{out }}$</td><td>Comparator Output</td><td>Actual ${\mathrm{D}}_{0}{\mathrm{D}}_{1}{\mathrm{D}}_{2}{\mathrm{D}}_{3}$</td></tr><tr><td/><td/><td/><td/><td/><td/></tr></table>

Figure P9.7-2
9.7-3. For the successive-approximation ADC shown in Fig. 9.7-7, sketch the voltage across capacitor ${C}_{1}\left( {v}_{C1}\right)$ and ${C}_{2}\left( {v}_{C2}\right)$ of Fig. 9.4-1 if the sampled analog input voltage is ${0.6}{V}_{\mathrm{{REF}}}$ . Assume that ${\mathrm{S}}_{2}$ and ${\mathrm{S}}_{3}$ close in one clock period and ${\mathrm{S}}_{1}$ closes in the following clock period. Also assume that one clock period exists between each successive iteration. What is the digital word out?
9.7-4. Assume that the input of Example 9.7-1 is ${0.8}{V}_{\mathrm{{REF}}}$ . Find the digital output word to 6-bits.
9.7-5. Assume that the input of Example 9.7-1 is ${0.3215}{V}_{\mathrm{{REF}}}$ and find the digital output word to 8-bits.
9.7-6. Repeat Example 9.7-1 for 8-bits if the gain-of-two amplifiers actually have a gain of 2.1 .
9.7-7. Assume that ${V}_{\text{in }}^{ * } = {0.7}{V}_{\text{REF }}$ is applied to the pipeline algorithmic ADC of Fig. 9.7-9. All elements of the converter are ideal except for the multiplier of 2 of the first stage, given as $2\left( {1 + \varepsilon }\right)$ . (a) What is the smallest magnitude of $\varepsilon$ that causes an error, assuming that the comparator offsets, ${V}_{OS}$ , are all zero? (b) Next, assume that the comparator offsets are all equal and nonzero. What is the smallest magnitude of the comparator offsets, ${V}_{OS}$ , that causes an error, assuming that $\varepsilon$ is zero?
9.7-8. The input to a pipeline algorithmic ADC is 1.5 V. If the ADC is ideal and ${V}_{\mathrm{{REF}}} = 5\mathrm{\;V}$ , find the digital output word up to 8 -bits in order of ${MSB}$ to ${LSB}$ . If ${V}_{\mathrm{{REF}}} = {5.2}$ and the input is still ${1.5}\mathrm{\;V}$ , at what bit does an error occur?
9.7-9. If ${V}_{\text{in }}^{ * } = {0.1}{V}_{\text{REF }}$ , find the digital output of an ideal four-stage, algorithmic pipeline ADC. Repeat if the comparators of each stage have a dc voltage offset of ${0.1}\mathrm{\;V}$ . Assume ${V}_{\text{REF }} = 5\mathrm{\;V}$ .
9.7-10. (a) If ${V}_{\text{in }}^{ * } = {0.1}{V}_{REF}$ , find the digital output of an ideal, 8-stage, algorithmic pipeline ADC. (b) Repeat if the comparators of each stage have a dc voltage offset of $+ {0.3}{V}_{REF}$ .
9.7-11. The analog input voltage of ${0.6}{V}_{REF}$ is applied to the pipeline analog-digital converter shown in Fig. P9.7-11. All elements of the converter are ideal except for the multiplier of 2 of the first stage and the comparator offsets of each stage. Assume that ${b}_{i} =  \pm  1$ for a logic high and a logic low.
(a) What is the smallest magnitude of $\varepsilon$ that causes an error, assuming that ${V}_{OS}$ is zero?
(b) What is the smallest magnitude of ${V}_{OS}$ that causes an error, assuming $\varepsilon$ is zero?
9.7-12. Repeat Example 9.7-3 if the gain-of-2 amplifier actually has a gain of 2.1 .
9.7-13. An algorithmic ADC is shown in Fig. P9.7- 13, where ${\phi }_{1}$ and ${\phi }_{2}$ are nonoverlapping clocks. Note that the conversion begins by connecting ${v}_{\text{in }}^{ * }$ to the input of the sample-and-hold during a ${\phi }_{2}$ phase. The actual conversion begins with the next phase period, ${\phi }_{1}$ . The output-bit is taken at each successive ${\phi }_{2}$ phase. (a) What is the 8-bit digital output word if ${v}_{\text{in }}^{ * } = {0.3}{V}_{\text{REF }}$ ? (b) What is the equivalent analog of the digital output word? (c) What is the largest value of comparator offset, ${V}_{OS}$ , before an error is caused in part (a) if ${V}_{\mathrm{{REF}}} = 1\mathrm{\;V}$ ?

Figure P9.7-11

Figure P9.7-13
9.8-1. Why are only ${2}^{N} - 1$ comparators required for an $N$ -bit flash ADC? Give a logic diagram for the digital decoding network of Fig. 9.8-1 that will provide the correct digital output word.
9.8-2. What are the comparator outputs in order of the upper to lower if ${V}_{\text{in }}^{ * }$ is ${0.6}{V}_{\text{REF }}$ for the ADC of Fig. 9.8-1?
9.8-3. Figure P9.8-3 shows a proposed implementation of the conventional 2-bit flash ADC (digital encoding circuitry not shown) shown on the left with the circuit on the right. Find the values of ${C}_{1},{C}_{2}$ , and ${C}_{3}$ in terms of $C$ that will accomplish the function of the conventional 2-bit flash analog-to-digital. Compare the performance of the two approaches from the viewpoints of comparator offset, speed of conversion, and accuracy of conversion assuming a CMOS integrated circuit implementation.
9.8-4. Two versions of a 2-bit flash ADC are shown in Fig. P9.8-4. Design ${R}_{1},{R}_{2}$ , and ${R}_{3}$ to make the right-hand version equivalent to the left-hand version of the 2-bit flash ADC. Compare the performance advantages and disadvantages between the two ADCs.

Figure P9.8-3

Figure P9.8-4
9.8-5. Part of a 6-bit flash ADC is shown in Fig. P9.8-5. The comparators have a dominant pole at ${10}^{3}\mathrm{{rad}}/\mathrm{s}$ , a dc gain of ${10}^{4}$ , a slew rate of $3\mathrm{\;V}/\mu \mathrm{s}$ , and a binary output voltage of $1\mathrm{\;V}$ and $0\mathrm{\;V}$ . Assume that the conversion time is the time required for the comparator to go from its initial state to halfway to its final state. What is the maximum conversion rate of this ADC if ${V}_{\text{REF }} = 5\mathrm{\;V}$ ? Assume the resistor ladder is ideal.

## Figure P9.8-5
9.8-6. A flash ADC uses op amps as comparators. The power supply to the op amps is $+ 5\mathrm{\;V}$ and ground. Assume that the output swing of the op amp is from ground to $+ 5\mathrm{\;V}$ . The range of the analog input signal is from 1 to $4\mathrm{\;V}\left( {{V}_{\mathrm{{REF}}} = 3\mathrm{\;V}}\right)$ . The op amps are ideal except that the output voltage is given as
$$
{v}_{\mathrm{o}} = {1000}\left( {{v}_{id} + {V}_{OS}}\right)  + {A}_{cm}{v}_{cm}
$$
where ${v}_{id}$ is the differential-input voltage to the op amp, ${A}_{cm}$ is the common-mode gain of the op amp, ${v}_{cm}$ is the common-mode input voltage to the op amp, and ${V}_{OS}$ is the dc input-offset voltage of the op amp. (a) If ${A}_{cm} = 1\mathrm{\;V}/\mathrm{V}$ and ${V}_{OS} = 0\mathrm{\;V}$ , what is the maximum number of bits that can be converted by the flash ADC assuming everything else is ideal? Use a worst-case approach. (b) If ${A}_{cm} = 0$ and ${V}_{OS} = {40}\mathrm{{mV}}$ , what is the maximum number of bits that can be converted by the flash ADC assuming everything else is ideal? Use a worst-case approach.
9.8-7. For the interpolating ADC of Fig. 9.8-3, find the accuracy required for the resistors connected between ${V}_{\mathrm{{REF}}}$ and ground using a worst-case approach. Repeat this analysis for the eight series interpolating resistors using a worst-case approach.
9.8-8. Assume that the input capacitances to the eight comparators of Fig. 9.8-6 are equal. Calculate the relative delays from the output of amplifiers ${A}_{1}$ and ${A}_{2}$ to each of the eight comparator inputs.
9.8-9. What number of comparators is needed for a folding and interpolating ADC that has the number of coarse bits as ${N1} = 3$ and the number of fine bits as ${N2} = 4$ and uses an interpolation of 4 on the fine bits? How many comparators would be needed for an equivalent 7-bit flash ADC?
9.8-10. Give a schematic for a folder having a single-ended output that varies between 1 and $3\mathrm{\;V}$ , starts at $1\mathrm{\;V}$ , ends at $1\mathrm{\;V}$ , and passes through 2 V six times.
9.8-11. A pipeline ADC is shown in Fig. P9.8-11. Plot the output-input characteristic of this ADC if ${V}_{\mathrm{{REF}}1} = {0.75}{V}_{\mathrm{{REF}}},{V}_{\mathrm{{REF}}2} = {V}_{\mathrm{{REF}}}$ , ${V}_{\mathrm{{REF}}3} = {0.75}{V}_{\mathrm{{REF}}},{V}_{\mathrm{{REF}}4} = {1.25}{V}_{\mathrm{{REF}}}$ , and $A$ $= 4$ . Express the ${INL}$ and the ${DNL}$ in terms of a + ${LSB}$ and a - ${LSB}$ value and determine whether the converter is monotonic or not.
9.8-12. Repeat Problem 9.8-11 if ${V}_{\mathrm{{REF}}1} = {V}_{\mathrm{{REF}}2} =$ ${0.75}{V}_{\mathrm{{REF}}}$ and all else has ideal values.
9.8-13. Repeat Problem 9.8-11 if (a) $A = 2$ and (b) $A$ $= 6$ and all other values of the ADC are ideal.
9.8-14. For the pipeline ADC of Fig. 9.8-17, the reference voltage to the DAC of the first stage is ${V}_{\mathrm{{REF}}} \pm  \Delta {V}_{\mathrm{{REF}}}$ . If all else is ideal, what is the smallest value of $\Delta {V}_{\mathrm{{REF}}}$ that will keep the ${INL}$ to within (a) $\pm  {0.5LSB}$ and (b) $\pm  {1LSB}$ ?
9.8-15. For the pipeline ADC of Fig. P9.8-11, assume that the 2-bit ADC and the 2-bit DAC function ideally. Also assume that ${V}_{\mathrm{{REF}}} = 1\mathrm{\;V}$ . The ideal value of the amplifier, $A$ , is 4 . Find the maximum and minimum values of $A$ that will not cause an error in the 4-bit ADC. Express the tolerance of $A$ in terms of a plus and minus percentage.
9.8-16. The pipeline ADC shown in Fig. P9.8-16 uses two identical, ideal, 2-bit stages to achieve a 4-bit ADC. Assume that the bits, ${b}_{2}$ and ${b}_{3}$ , have been mistakenly interchanged inside the second-stage ADC. Plot the output-input characteristics of the converter, express the ${INL}$ and ${DNL}$ in terms of a $+ {LSB}$ and a $- {LSB}$ , and determine whether the converter is monotonic or not.
9.9-1. A first-order delta-sigma modulator is shown in Fig. P9.9-1. Find the magnitude of the output spectral noise with ${V}_{\text{in }}\left( z\right)  = 0$ and determine the bandwidth of a 10-bit ADC if the sampling frequency, ${f}_{s}$ , is 10 $\mathrm{{MHz}}$ and $k = 1$ . Repeat for $k = {0.5}$ .

Figure P9.9-1
9.9-2. The specification for an oversampled ADC is 16-bits with a bandwidth of 100 $\mathrm{{kHz}}$ and a sampling frequency of ${10}\mathrm{{MHz}}$ . (a) What is the minimum number of loops in a modulator like Fig. 9.9-6 using a 1-bit quantizer $\left( {\Delta  = {V}_{\mathrm{{REF}}}/2}\right)$ that will meet this specification? (b) If the modulator has two loops, what is the minimum number of bits for the quantizer to meet the specification?

Figure P9.8-16
9.9-3. Draw a single-ended switched capacitor realization of everything within the dashed box of the delta-sigma modulator in Fig. P9.9-3. Assume that the output of the 1-bit DAC is $\pm  {0.5}{V}_{\text{REF }}$ . Be sure to show the phases of the switches $\left( {\phi }_{1}\right.$ and $\left. {\phi }_{2}\right)$ .

Figure P9.9-3
9.9-4. Assume the modulation noise spectral density of a second-order 1-bit ${\Delta \sum }$ modulator is given as
$$
\left| {N\left( f\right) }\right|  = \frac{4\Delta }{\sqrt{12}}\sqrt{\frac{2}{{f}_{s}}}{\sin }^{2}\left( \frac{\omega \tau }{4}\right)
$$
where $\Delta$ is the signal level out of the 1 -bit quantizer and ${f}_{s} = \left( {1/\tau }\right)  =$ the sampling frequency and is ${10}\mathrm{{MHz}}$ . Find the signal bandwidth, ${f}_{B}$ , in hertz if the modulator is to be used in an 18-bit oversampled ADC. Be sure to state any assumption you use in working this problem.
9.9-5. The noise power in the signal band of zero to ${f}_{B}$ of a $L$ th-order oversampling ADC is given as
$$
{n}_{o} = \frac{\Delta }{\sqrt{12}}\frac{{\pi }^{L}}{\sqrt{{2L} + 1}}{\left( \frac{2{f}_{B}}{{f}_{s}}\right) }^{L + {0.5}}
$$
where ${f}_{s}$ is the sampling frequency,
$$
\Delta  = \frac{{V}_{\mathrm{{REF}}}}{{2}^{B} - 1}
$$
and $B$ is the number of bits of the quantizer. Find the minimum oversampling ratio, OSR $\left( { = {f}_{s}/2{f}_{B}}\right)$ , for the following cases:
(a) A 1-bit quantizer, third-order loop, 16-bit oversampled ADC
(b) A 2-bit quantizer, third-order loop, 16-bit oversampled ADC
(c) A 3-bit quantizer, second-order loop, 16-bit oversampled ADC
9.9-6. A second-order oversampled modulator is shown in Fig. P9.9-6. (a) Find the noise transfer function, $Y\left( z\right) /Q\left( z\right)$ . (b) Assume that the quantizer noise spectral density of a 1-bit ${\Delta \sum }$ modulator is
$$
\left| {N\left( f\right) }\right|  = \frac{2{V}_{\mathrm{{REF}}}}{\sqrt{12}}\sqrt{\frac{2}{{f}_{s}}}{\sin }^{2}\left( \frac{\omega }{2{f}_{s}}\right)
$$
where ${f}_{s} = {10}\mathrm{{MHz}}$ and is the sampling frequency. Find the maximum signal bandwidth, ${f}_{B}$ , in hertz if the ${\Delta \sum }$ modulator is used in a 16-bit oversampled ADC.
9.9-7. Find an expression for the output, ${Y}_{o}\left( z\right)$ , in terms of the input, $X\left( z\right)$ , and the quantization noise sources, ${Q}_{1}\left( z\right)$ and ${Q}_{2}\left( z\right)$ , for the multistage ${\Delta \sum }$ modulator shown in Fig. P9.9-7. What is the order of this modulator?

Figure P9.9-7

Figure P9.9-6
9.9-8. A ${\Delta \sum }$ modulator is shown in Fig. P9.9-8. (a) Solve for the output, $Y\left( z\right)$ , as a function of the input, $X\left( z\right)$ , and the quantization noise sources, ${Q}_{1}\left( z\right) ,{Q}_{2}\left( z\right)$ , and ${Q}_{3}\left( z\right)$ . Find the value of the noise transfer function, ${NT}{F}_{Q}\left( z\right)$ . (b) If ${NT}{F}_{Q}\left( z\right)  = {\left( 1 - {z}^{-1}\right) }^{-2}$ and the sampling frequency $\left( {f}_{s}\right)$ is ${10}\mathrm{{MHz}}$ , find the maximum signal bandwidth, ${f}_{B}$ , in Hertz if the ${\Delta \sum }$ modulator is used in a 16-bit oversampled analog-to-digital converter application.

Figure P9.9-8
9.9-9. Two ${\Delta \sum }$ first-order modulators are multiplexed as shown in Fig. P9.9-9. $\Delta {\sum }_{1}$ provides its 1-bit quantizer output during clock phase ${\phi }_{1}$ and $\Delta {\sum }_{2}$ provides its 1-bit quantizer output during clock phase ${\phi }_{2}$ , where ${\phi }_{1}$ and ${\phi }_{2}$ are nonoverlapping clocks. The noise, ${n}_{o}$ , of a general $L$ -loop ${\Delta \sum }$ modulator is expressed as
$$
{n}_{o} = \frac{\Delta }{\sqrt{12}}\frac{{\pi }^{L}}{\sqrt{{2L} + 1}}{\left( \frac{2{f}_{B}}{{f}_{S}}\right) }^{L + {0.5}}
$$
(a) Assume that the quantization level for each quantizer is $\Delta  = {0.5}{V}_{\mathrm{{REF}}}$ and find the dynamic range in decibels that would result if the clock frequency is ${100}\mathrm{{MHz}}$ and the bandwidth of the resulting ADC is $1\mathrm{{MHz}}$ . (b) What would the dynamic range be in decibels if the quantizers are 2 -bit?

Figure P9.9-9
9.9-10. A first-order,1-bit, bandpass ${\Delta \sum }$ modulator is shown in Fig. P9.9-10. Find the modulation noise spectral density, $N\left( f\right)$ , and integrate the square of the magnitude of $N\left( f\right)$ over the bandwidth of interest $\left( {f}_{1}\right.$ to ${f}_{2}$ ) and find an expression for the noise power, ${n}_{o}\left( f\right)$ , in the bandwidth of interest in terms of $\Delta$ and the oversampling factor $M$ , where $M = {f}_{s}/\left( {2{f}_{B}}\right)$ . What is the value of ${f}_{B}$ for a 14-bit ADC using this modulator if the sampling frequency, ${f}_{s}$ , is ${10}\mathrm{{MHz}}$ ?

Figure P9.9-10
9.9-11. A first-order,1-bit, bandpass, ${\Delta \sum }$ modulator is shown in Fig. P9.9-11. Find the modulation noise spectral density, $N\left( f\right)$ , and integrate the square of the magnitude of $N\left( f\right)$ over the bandwidth of interest $\left( {{f}_{1}\text{to}{f}_{2}}\right)$ and find an expression for the noise power, ${n}_{o}\left( f\right)$ , in the bandwidth of interest in terms of $\Delta$ and the oversampling factor $M$ , where $M = {f}_{s}/\left( {2{f}_{B}}\right)$ . What is the value of ${f}_{B}$ for a 12- bit ADC using this modulator if the sampling frequency, ${f}_{s}$ , is ${100}\mathrm{{MHz}}$ ? Assume that ${f}_{s} = 4{f}_{o}$ and ${f}_{B} \ll  {f}_{o}$ .

Figure P9.9-11
## References
1. B. M. Gordon, "Linear Electronic Analog/Digital Conversion Architecture, Their Origins, Parameters, Limitations, and
Applications," IEEE Trans. Circuits Syst., Vol. CAS-25, No. 7, pp. 391-418, July 1978.
2. D. Gilbert, "Understanding D/A Accuracy Specs.," Electronic Products, Vol. 24, No. 3, pp. 61-63, July 1981.
3. F. O. Eynde and W. M. C. Sansen, Analog Interfaces for Digital Signal Processing Systems. Norwell, MA: Kluwer Academic Publishers, 1993.
4. A. B. Grebene, Bipolar and MOS Analog Integrated Circuit Design. New York: Wiley, 1984.
5. D. H. Sheingold, Analog-Digital Conversion Handbook. Norwood, MA: Analog Devices, 1972.
6. B. Fotouhi and D. A. Hodges, "High-Resolution A/D Conversion in MOS/LSI," IEEE J. Solid-State Circuits, Vol. SC-14, pp. 920-926, Dec. 1979.
7. R. E. Suarez, P. R. Gray, and D. A. Hodges, "All-MOS Charge Redistribution Analog-to-Digital Conversion Techniques-Part II," IEEE Solid-State Circuits, Vol. SC-10, No. 6, pp. 379-385, Dec. 1975.
8. R. H. Charles and D. A. Hodges, "Charge Circuits for Analog LSI," IEEE Trans. Circuits Syst., Vol. CAS-25, No. 7, pp. 490-497, July 1978.
9. X. Hu and K. W. Martin, "A Switched-Current Sample-and-Hold Circuit," IEEE J. Solid-State Circuits, Vol. 32, No. 6, pp. 898-904, Jan. 1997.
10. I. Mehr and T. L Sculley, "A 16-bit Current Sample/Hold Circuit Using a Digital CMOS Process," Proceedings of the IEEE International Symposium on Circuits and Systems, pp. 5.417-5.420, 1994.
11. S. A. Trotter, Introduction to Discrete-Time Signal Processing, New York: Wiley, 1976.
12. J. Doernberg, H. S. Lee, and D. A. Hodges, "Full-Speed Testing of A/D Converters," IEEE J. Solid-State Circuits, Vol. SC-19, No. 6, pp. 820-827, Dec. 1984.
13. "Dynamic Performance Testing of A to D Converters," Hewlett Packard Product Note 5180A-2.
14. G. F. Landsburg, "A Charge-Balancing Monolithic A/D Converter," IEEE Solid-State Circuits, Vol. SC-12, No. 6, pp. 662-673, Dec. 1977.
15. E. R. Hnatek, A User's Handbook of D/A and A/D Converters, New York: Wiley, 1976.
16. P. W. Li, M. J. Chin, P. R. Gray, and R. Castello, "A Ratio-Independent Algorithmic Analog-to-Digital Conversion Technique," IEEE Solid-State Circuits, Vol. SC-19, No. 6, pp. 828-836, Dec. 1984.
17. M. Flynn, "A 400 Msample/s, 6-b CMOS Folding and Interpolating ADC," IEEE J. Solid-State Circuits, Vol. 33, No. 12, pp. 1932-1938, Dec. 1998.
18. S. Tsukamoto, "A CMOS 6-b, 400-Msample/s ADC with Error Correction," IEEE J. Solid-State Circuits, Vol. 33, No. 12, pp. 1939-1947, Dec. 1998.
19. M. Steyaert, R. Roovers, and J. Craninckx, "A 100 MHz 8-bit CMOS Interpolating A/D Converter," IEEE Custom Integrated Circuits Conference, San Diego, May 1993, pp. 28.1.1-28.1.4.
20. J. van Valburg and R. J. van de Plassche, "An 8-b, 650-MHz Folding ADC," IEEE J. Solid-State Circuits, Vol. 27, pp. 1662-1666, Dec. 1992.
21. M. Flynn and D. Allstot, "CMOS Folding A/D Converters with Current-Mode Interpolation," IEEE J. Solid-State
Circuits, Vol. 31, No. 9, pp. 1248-1257, Sept. 1996.
22. P. Vorenkamp and R. Roovers, "A 12-b, 60-MSample/s Cascaded Folding and Interpolating ADC," IEEE J. Solid-State Circuits, Vol. 32, No. 12, pp. 1876-1886, Dec. 1997.
23. B. Nauta and A. Venes, "A 70 Ms/s 110 mW 8-b CMOS Folding and Interpolating A/D Converter," IEEE J. Solid-State Circuits, Vol. 30, no. 12, pp. 1302-1308, Dec. 1995.
24. A. Venes and R. van de Plassche, "An 80 MHz, 80 mW, 8-b CMOS Folding A/D Converter with Distributed Track-and-Hold Preprocessing," IEEE J. Solid-State Circuits, Vol. 31, No. 12, pp. 1846-1853, Dec. 1996.
25. K. Nakamura, M. Hotta, L. R. Carley, and D. J. Allstot, "An 85 mW, 10b, 40 Msample/s CMOS Parallel-Pipelined ADC," IEEE J. Solid-State Circuits, Vol. 30, No. 3, pp. 173-183, Mar. 1995.
26. L. A. Singer and T. L. Brooks, "A 14-bit 10-MHz Calibration-Free CMOS Pipelined A/D Converter," Symposium VLSI Circuits Digest of Technical Papers, Honolulu, HI, June 1997, pp. 94-95.
27. S. H. Lewis and P. R. Gray, "A Pipelined 5-Msample/s 9-bit Analog-to-Digital Converter," IEEE J. Solid-State Circuits, Vol. SC-22, No. 6, pp. 954-961, Dec. 1987.
28. R. Petschacher, B. Zojer, B. Astegner, H. Jessner, and A. Lechner, "A 10-b 75-MSPS Subranging A/D Converter with Integrated Sample and Hold," IEEE J. Solid-State Circuits, Vol. 25, pp. 1339-1346, Dec. 1990.
29. B. E. Boser and B. A. Wooley, "The Design of Sigma-Delta Modulation Analog-to-Digital Converters," IEEE J. Solid-State Circuits, Vol. SC-23, pp. 1298-1308, Dec. 1988.
30. J. Candy and G. Temes, Oversampling Delta-Sigma Data Converters. New York: IEEE Press, 1997.
31. S. R. Norsworthy, R. Schreier, and G. Temes, Delta-Sigma Data Converters. New York: IEEE Press, 1992, pp. 1-29.
32. J. W. Scott, W. Lee, C. Giansario, and C. G. Sodini, "A CMOS Slope Adaptive Delta Modulator," ISSCC Dig. Tech. Papers, pp. 130-131, Feb. 1986.
33. H. Inose, Y. Yasada, and J. Murakami, "A Telemetering System Code Modulation— $\Delta$ - $\sum$ Modulation," IRE Trans. Space Electron. and Telemetry, Vol. SET-8, pp. 204-209, Sept. 1962.
34. Y. Geerts, A. M. Marques, V. Peluso, M. S. J. Steyaert, and W. Sansen, "A 3.3-V, 15-bit Delta-Sigma ADC with a Bandwidth of 1.1 MHz for ADSL Applications," IEEE J. Solid-State Circuits, Vol. 34, No. 7, pp. 927-936, July 1999.
35. T. Brooks, D. Robertson, D. Kelly, A. Del Muro, and S. Hanston, "A Cascaded Sigma-Delta Pipeline A/D Converter with 1.25 MHz Signal Bandwidth and 89 dB SNR," IEEE J. Solid-State Circuits, Vol. 32, No. 12, pp. 1896-1906, Dec. 1997.
36. A. K. Org and B. A. Wooley,"A Two-path Bandpass ${\Delta \sum }$ Modulator for Digital IF Extraction at 20 MHz," IEEE J. Solid-State Circuits, Vol. 32, No. 12, pp. 1920-1934, Dec. 1997.
37. S. A. Jantzi, K. W. Martin, and A. S. Sedra,"Quadrature Bandpass ${\Delta \sum }$ Modulation for Digital Radio," IEEE J. Solid-State Circuits, Vol. 32, No. 12, pp. 1935-1950, Dec. 1997.
38. A. Hairapetian, "An 81 MHz IF Receiver in CMOS," ISSCC Dig. Tech. Papers, pp. 56-57, Feb. 1996.
39. A. V. Oppenheim and R. W. Schafer, Discrete-Time Signal Processing. New York: Prentice-Hall, 1989.
40. J. Candy, "A Use of Double Integration in Sigma Delta Modulation," IEEE Trans. Commun., Vol. COM-33, pp. 249-258, Mar. 1985.
41. B. Razavi, Principles of Data Conversion System Design. New York: IEEE Press, 1995.
42. B. P. Brandt, Oversampled Analog-to-Digital Conversion, Ph.D. Thesis, Stanford University, 1991.
43. F. Op't Eynde and W. Sansen, Analog Interfaces for Digital Signal Processing Systems. Boston, MA: Kluwer Academic Publishers, 1993.
44. R. W. Adams, P. R. Ferguson, Jr., A. Ganesan, S. Vincelette, A. Volpe, and R. Libert, "Theory and Practical Implementation of a Fifth-Order Sigma-Delta A/D converter," J. Audio Eng. Soc., Vol. 39, No. 7/8, pp. 515-528, July 1991.
45. T. Ritoniemi, T. Karema, and H. Tenhunen, "Design of Stable High Order 1-bit Sigma-Delta Modulators," Proc. ISCAS, pp. 3267-3270, May 1990.
46. P. R. Ferguson, Jr., A. Ganesan, and R. W. Adams, "One-Bit Higher Order Sigma-Delta A/D Converters," Proc. ISCAS, pp. 890-893, May 1990.
47. R. T. Baird and T. S. Fiez, "Stability Analysis of High-Order Delta-Sigma Modulators for ADCs," IEEE Trans. Circuits Syst. II, Vol. 41, No. 1, pp. 59-62, Jan. 1994.
48. K. C-H. Chao, S. Nadeem, W. L. Lee, and C. G. Sodini, "A Higher Order Topology for Interpolative Modulators for Oversampling A/D Converters," IEEE Trans. Circuits Syst., Vol. CAS-37, pp. 309-318, Mar. 1990.
49. S. Nadeem, C. G. Sodini, and H. S. Lee, "16-Channel Oversampled Analog-to-Digital Converter," IEEE J. Solid-State Circuits, Vol. 29, No. 9, pp. 1077-1085, Sept. 1994.
50. F. Op't Eynde, G. M. Yin, and W. Sansen, "A CMOS Fourth-Order 14b, 500 ksample/s Sigma-Delta ADC Converter,"
ISSCC Dig. Tech. Papers, pp. 62-63, Feb. 1991.
51. S. Au and H. Leung, "A 1.95-V, 0.3 mW, 12-b Sigma-Delta Modulator Stabilized by Local Feedback Loops," IEEE J. Solid-State Circuits, Vol. 32, No. 3, pp. 321-328, Mar. 1997.
52. P. van Gog, B. M. J. Kup, and R. van Osch, "A Two-Channel 16/18b Audio AD/DA Including Filter Function with 60/40 mW Power Consumption at 2.7 V," ISSCC Dig. Tech. Papers, pp. 208-209, Feb. 1995.
53. D. R. Welland, B. P. Del Signore, E. J. Swanson, T. Tanaka, K. Hamashita, S. Hara, and K. Takasuka, "A Stereo 16-bit Delta-sigma A/D Converter for Digital Audio," J. Audio Eng. Soc., Vol. 37, pp. 476-486, June 1989.
54. C. H. Thomsen and S. R. Bemades, "A Digitally-Corrected 20b Delta-Sigma Modulator," ISSCC Dig. Tech. Papers, pp. 194-195, Feb. 1994.
55. D. A. Kerth, D. B. Kasha, T. G. Mellissinos, D. S. Plasecki, and E. J. Swanson, "A 120 dB Linear Switched-Capacitor Delta-Sigma Modulator," ISSCC Dig. Tech. Papers, pp. 196-197, Feb. 1994.
56. K. Y. Leung, E. J. Swanson, K. Leung, and S. S. Zhu, "A 5 V, 118 dB ${\Delta \sum }$ Analog-to-Digital Converter for Wideband Digital Audio," ISSCC Dig. Tech. Papers pp. 218-219, Feb. 1997.
57. K. Yamamura, A. Nogi, and A. Barlow, "A Low Power 20-bit Instrumentation Delta-Sigma ADC," Proc. CICC'94, pp. 23.7.1-23.7.4, May 1994.
58. E. J. van der Zwan,"A 2.3 mW CMOS ${\Delta \sum }$ Modulator for Audio Applications," ISSCC Dig. Tech. Papers, pp. 220-221, Feb. 1997.
59. Y. Matsuya, K. Uchimura, A. Iwata, T. Kobayashi, M. Ishikawa, and T. Yoshitome, "A 16-bit Oversampling A-to-D Conversion Technology Using Triple-Integration Noise Shaping," IEEE J. Solid-State Circuits, Vol. SC-22, pp. 921-929, Dec. 1987.
60. L. Longo and M. Copeland, "A 13-bit ISDN-Band Oversampled ADC Using Two-Stage Third Order Noise Shaping," Proc. IEEE CICC'88, pp. 21.2.1-21.2.4, Jan. 1988.
61. L. A. Williams III and B. A. Wooley, "A Third-Order Sigma-Delta Modulator with Extended Dynamic Range," IEEE J. Solid-State Circuits, Vol. 29, No. 3, pp. 193-202, Mar. 1994.
62. G. Yin, F. Stubbe, and W. Sansen, "A 16-bit 320-kHz CMOS A/D Converter Using Two-Stage Third Order ${\Delta \sum }$ Noise Shaping," IEEE J. Solid-State Circuits, Vol. 28, No. 6, pp. 640-647, June 1993.
63. S. Rabii and B. A. Wooley,"A 1.8-V Digital-Audio Sigma-Delta Modulator in 0.8 μm CMOS," IEEE J. Solid-State Circuits, Vol. 32, No. 6, pp. 783-796, June 1997.
64. B. P. Brandt and B. A. Wooley, "A 50-MHz Multibit Sigma-Delta Modulator for 12-b 2-MHz A/D Conversion," IEEE J. Solid-State Circuits, Vol. 26, No. 6, pp. 1746-1756, Dec. 1991.
65. T. Karema, T. Ritoniemi, and H. Tenhunen, "An Oversampled Sigma-delta A/D Converter Circuit Using Two-Stage Fourth Order Modulator," Proc. ISCAS, pp. 3279-3282, May 1990.
66. T. Ritoniemi, E. Pajarre, S. Ingalsuo, T. Husu, V. Eerola, and T. Saramaki, "A Stereo Audio Sigma-Delta A/D-Converter," IEEE J. Solid-State Circuits, Vol. 29, No. 12, pp. 1514-1523, Dec. 1994.
67. I. Fujimori, K. Koyama, D. Trager, F. Tam, and L. Longo, "A 5-V Single-Chip Delta-Sigma Audio A/D Converter with 111 dB Dynamic Range," IEEE J. Solid-State Circuits, Vol. 32, No. 3, pp. 329-336, Mar. 1997.
68. G. Yin and W. Sansen,"A High-Frequency and High-Resolution Fourth-Order ${\Delta \sum }$ A/D Converter in BiCMOS Technology," IEEE J. Solid-State Circuits, Vol. 29, No. 8, pp. 857-865, Aug. 1994.
69. F. Medeiro, B. Perez-Verdu, and A. Rodriguez-Vazquez, "A 74 dB Dynamic Range, 1.1-MHz Signal Band 4th-Order 2-1-1 Cascade Multi-bit CMOS ${\Delta \sum }$ Modulator for ADSL," Proc. ESSCIRC’97, pp. 72-75, Sept. 1997.
70. I. Dedic, "A Sixth Order Triple-Loop Sigma-Delta CMOS ADC with ${90}\mathrm{\;{dB}}$ SNR and ${100}\mathrm{{kHz}}$ Bandwidth," ISSCC Dig. Tech. Papers, pp. 188-189, Feb. 1994.
71. R. T. Baird and T. S. Fiez,"A Low Oversampling Ratio 14-b 500-kHz ${\Delta \sum }$ ADC with a Self-Calibrated Multibit DAC," IEEE J. Solid-State Circuits, Vol. 31, No. 3, pp. 312-320, Mar. 1996.
72. T. Cataltepe, E. R. Kramer, G. C. Temes, and R. H. Walden,“Digitally-Corrected Multi-bit ${\Delta \sum }$ Data Converters," Proc. ISCAS, pp. 647-650, May 1989.
73. M. Sarhang-Nejad and G. C. Temes,"A High-Resolution Multibit ${\Delta \sum }$ ADC with Digital Correction and Relaxed Amplifier Requirements," IEEE J. Solid-State Circuits, Vol. 28, No. 6, pp. 648-660, June 1993.
74. L. R. Carley, "A Noise Shaping Coder Topology for 15+-bit Converters," IEEE J. Solid-State Circuits, Vol. SC-24, pp. 267-275, Apr. 1989.
75. J. W. Fattaruso, S. Kiriaki, M. de Wit, and G. Warwar, "Self-Calibration Techniques for a Second-Order Multibit Sigma-
Delta Modulator," IEEE J. Solid-State Circuits, Vol. 28, No. 12, pp. 1216-1223, Dec. 1993.
76. Y. Sakina, Multibit ${\Delta \sum }$ Analog-to-Digital Converters with Nonlinearity Correction Using Dynamic Barrel Shifting, M.A.Sc. Thesis, University of California, Berkeley, 1990.
77. F. Chen and B. H. Leung, "A High Resolution Multibit Sigma-Delta Modulator with Individual Level Averaging," IEEE J. Solid-State Circuits, Vol. 30, No. 4, pp. 453-460, Apr. 1995.
78. O. Nys and R. K. Henderson, "A 19-bit Low-Power Multibit Sigma-Delta ADC Based on Data Weighted Averaging, IEEE J. Solid-State Circuits, Vol. 32, No. 7, pp. 933-942, July 1997.
79. A. Hairapetian and G. Temes, "A Dual-Quantization Multi-Bit Sigma-Delta Analog/Digital Converter," Proc. ISCAS, pp. 5.437-5.440, May 1994.
80. B. P. Brandt and B. A. Wooley, "A Low-Power, Area-Efficient Digital Filter for Decimation and Interpolation," IEEE J. Solid-State Circuits, Vol. 29, No. 6, pp. 679-687, June 1994.
81. A. V. Oppenheim and R. W. Schafer, Discrete-Time Signal Processing. New York: Prentice-Hall, 1989.
82. R. Adams, K. Q. Nguyen, and K. Sweetland, "A 113-dB SNR Oversampling DAC with Segmented Noise-Shaped Scrambling," IEEE J. Solid-State Circuits, Vol. 33, No. 12, pp. 1871-1878, Dec. 1998.
83. I. Fujimuri, A. Nogi, and Sugimoto,“A Multi-bit ${\Delta \sum }$ Audio DAC with 120 dB Dynamic Range," ISSCC Dig. Tech. Papers, pp. 152-153, Feb. 1999.
84. A. L. Coban and P. E. Allen, "A 1.5 V 1 mW Audio ${\Delta \sum }$ Modulator with 98 dB Dynamic Range," ISSCC Dig. Tech. Papers, pp. 50-51, Feb. 1999.
85. V. Peluso, P. Vancorenland, A. M. Marques, M. S. J. Steyaert, and W. Sansen, "A 900-mV Low-Power ${\Delta \sum }$ A/D Converter with 77-dB Dynamic Range," IEEE J. Solid-State Circuits, Vol. 33, No. 12, pp. 1887-1897, Dec. 1998.
86. B. E. Boser and B. A. Wooley, "The Design of Sigma-Delta Modulation Analog-to-Digital Converters," IEEE J. Solid-State Circuits, Vol. SC-23, pp. 1298-1308, Dec. 1988.
87. B. Murmann, "ADC Performance Survey 1997-2010" [Online]. Available: http://www.stanford.edu/~murmann/adcsurvey.html.
88. R. H. Walden, "Analog-to-digital Converter Survey and Analysis," IEEE J. Select. Areas Communication, Vol. 17, pp. 539-550, Apr. 1999.
89. B. Murmann, "Limits on ADC Power Dissipation." In: Analog Circuit Design, M. Steyaert, A. H. M. Roermund, J. H. van Huijsing, eds. New York: Springer, 2006.
90. B. Murmann, "A/D Converter Trends: Power Dissipation, Scaling and Digitally Assisted Architectures," Proc. IEEE Custom Integrated Circuits Conference (CICC), pp. 105-112, Sept. 2008.
91.P. E. Allen and D. R. Holberg, CMOS Analog Circuit Design, 2nd ed. New York: Oxford University Press, 2002, pp. 714-715.
## HOMEWORK PROBLEM ANSWERS
1.1-1. Base-10 value $= {13}/{16}$
1.1-4. $\frac{{v}_{\text{out }}}{{v}_{\text{in }}} = \frac{{G}_{1}\left( {{G}_{2} - {g}_{m1}}\right) }{{G}_{1}{G}_{2} + {G}_{1}{G}_{4} + {G}_{2}{G}_{4} + {G}_{3}{G}_{2} + {G}_{3}{G}_{4} + {G}_{2}{g}_{m1}}$
1.1-5. $\frac{{v}_{\text{out }}}{{v}_{\text{in }}} = \frac{{R}_{3}{R}_{4}\left( {1 - {g}_{m}{R}_{2}}\right) }{{R}_{1}{R}_{2} + {R}_{1}{R}_{4} + {R}_{1}{R}_{3} + {R}_{2}{R}_{3} + {R}_{3}{R}_{4} + {g}_{m}{R}_{1}{R}_{3}{R}_{4}}$
1.1-6. $\frac{{i}_{\text{out }}}{{i}_{\text{in }}} = \frac{-{r}_{m}{R}_{1}/{R}_{3}}{R + {R}_{1} - {r}_{m}}$
1.1-7. $\frac{{v}_{2}}{{v}_{1}} = \frac{{g}_{m}{R}_{L}}{1 + {g}_{m}{R}_{L}}\;\frac{{v}_{1}}{{i}_{1}} = {R}_{L} + \frac{1}{{g}_{m}}$
1.1-8. $\frac{{v}_{\text{out }}}{{v}_{\text{in }}} = \frac{-{R}_{2}}{{R}_{1}}$
1.1-9. $\frac{{v}_{\text{out }}}{{v}_{\text{in }}} = \frac{-{r}_{m}{R}_{3}}{{R}_{1}{R}_{2} + {R}_{1}{R}_{3} + {R}_{1}{r}_{m} + {R}_{2}{R}_{3}}$
1.1-10. $\frac{{v}_{\text{out }}}{{v}_{\text{in }}} = \frac{-{g}_{m}{R}_{1}{R}_{2}{R}_{3}}{{R}_{1} + {R}_{2} + {R}_{3} + {g}_{m}{R}_{1}{R}_{3}}$
1.1-11. ${Z}_{0} = \frac{{R}_{1}{R}_{2}{R}_{4} + {R}_{2}{R}_{3}{R}_{4} + {R}_{1}{R}_{3}{R}_{4}}{{R}_{1}{R}_{2} + {R}_{2}{R}_{3} + {R}_{3}{R}_{4} + {R}_{1}{R}_{4} + {R}_{1}{R}_{3} + {g}_{m}{R}_{1}{R}_{3}{R}_{4}}$
1.1-12. ${R}_{in} = 5\mathrm{M}\Omega$
## Chapter 2
2.2-1. ${N}_{A} = 5 \times  {10}^{15}/{\mathrm{{cm}}}^{3},{N}_{D} = {10}^{20}/{\mathrm{{cm}}}^{3}$
${\phi }_{o} = {0.9168}$
${x}_{n} = {43.5} \times  {10}^{-{12}}\mathrm{\;m}$
${x}_{p} =  - {0.869\mu }\mathrm{m}$
${x}_{d} = {0.869\mu }\mathrm{m}$
${C}_{j0} = {21.3}\mathrm{{fF}}$
${C}_{j} = {11.94}\mathrm{{fF}}$
2.2-3. ${x}_{p} =  - {x}_{n} = {\left( \frac{3\varepsilon }{2qa}\right) }^{1/3}{\left( {\phi }_{0} - {V}_{D}\right) }^{1/3}$
2.2-5. ${BV} \approx  {58.27}$ volts
2.2-6. $\Delta {v}_{D} = {v}_{D1} - {v}_{D2} = {59.6}\mathrm{{mV}}$
2.3-2. ${V}_{T} = {0.736}$ volts
2.3-3. ${i}_{D} = \frac{W{\mu }_{n}{C}_{ox}}{L}\left\lbrack  {\left( {{v}_{GS} - {V}_{T0}}\right) {v}_{DS} - \left( {1 + a}\right) \frac{{v}_{DS}^{2}}{2}}\right\rbrack$
2.3-5. For ${t}_{ox} = {210Å} : {V}_{T0} = {0.331}\mathrm{\;V}$
For ${t}_{ox} = {200}$ Å: ${V}_{T0} = {0.306}\mathrm{\;V}$ (Example. 2.3-1 result)
The difference is ${25}\mathrm{{mV}}$ .
2.3-6. ${V}_{T0} = {0.6496}\mathrm{\;V};\gamma  = {0.882}{\mathrm{\;V}}^{1/2}$
2.4-2. (a) ${A}_{R} = {252} \times  {25\mu }{\mathrm{m}}^{2} = {6308\mu }{\mathrm{m}}^{2}$ and ${A}_{C} = {6308\mu }{\mathrm{m}}^{2}$
Also ${R}_{\text{poly }} = R = {252} \times  {50\Omega } = {12.6}\mathrm{k}\Omega$ and ${C}_{MOS} = {6308\mu }{\mathrm{m}}^{2} \times  2\mathrm{{fF}}/\mu {\mathrm{m}}^{2} = {12.6}\mathrm{{pF}}$
(b) Maximum $- 3\mathrm{{dB}}$ frequency $= \frac{1}{{2\pi }\left( {0.7}\right) \left( {{12.6}\mathrm{k}\Omega }\right) \left( {0.9}\right) \left( {{12.6}\mathrm{{pF}}}\right) } = {1.6}\mathrm{{MHz}}$
Minimum $- 3\mathrm{\;{dB}}$ frequency $= \frac{1}{{2\pi }\left( {1.3}\right) \left( {{12.6}\mathrm{k}\Omega }\right) \left( {1.1}\right) \left( {{12.6}\mathrm{{pF}}}\right) } = {0.7}\mathrm{{MHz}}$
2.4-5. ${V}_{OUT} = {1.22713}\mathrm{\;V}$
2.4-6. ${V}_{OUT} = {1.2398}\mathrm{\;V}$
2.4-8. $R = {150\Omega }$
2.5-1. $\frac{1}{{v}_{D}}\frac{d{v}_{D}}{dT} = {2.775} \times  {10}^{-3}$
A-2. $C = {C}_{AREA}{\left( d \pm  {0.05}\right) }^{2}$
where $d$ is one (both) sides of the square capacitor
$d = {200.1}$
## Chapter 3
3.1-5. ${i}_{D} = {K}^{\prime }\frac{W}{2L}{\left( {v}_{GS} - {V}_{T}\right) }^{2}\left\lbrack  {1 + \lambda \left( {{v}_{DS} - {v}_{DS}\left( \mathrm{{sat}}\right) }\right) }\right\rbrack  ,\;0 < \left( {{v}_{GS} - {V}_{T}}\right)  \leq  {v}_{DS}$
3.2-1. Off: ${C}_{GB} = {11.3}\mathrm{{fF}},{C}_{GS} = {1.1}\mathrm{{fF}}$ , and ${C}_{GD} = {1.1}\mathrm{{fF}}$
Saturation: ${C}_{GB} = {0.575}\mathrm{{fF}},{C}_{GS} = {7.868}\mathrm{{fF}}$ , and ${C}_{GD} = {1.1}\mathrm{{fF}}$
Nonsaturation: ${C}_{GB} = {0.574}\mathrm{{fF}},{C}_{GS} = {6.18}\mathrm{{fF}}$ , and ${C}_{GD} = {6.18}\mathrm{{fF}}$
3.2-2. NMOS: ${C}_{BX}\left( 0\right)  = {5.2}\mathrm{{fF}}$ and ${C}_{BX}\left( {-{0.75}\mathrm{\;V}}\right)  = {4.07}\mathrm{{fF}}$
PMOS: ${C}_{BX}\left( 0\right)  = {4.31}\mathrm{{fF}}$ and ${C}_{BX}\left( {+{0.75}\mathrm{\;V}}\right)  = {3.425}\mathrm{{fF}}$
3.2-3. The device is in saturation; therefore, ${C}_{GB} = {0.575}\mathrm{{fF}},{C}_{GS} = {7.868}\mathrm{{fF}}$ , and ${C}_{GD} = {1.1}\mathrm{{fF}}$ .
3.2-4. (a) ${RD} = {RS} = {7.95\Omega } + {0.2\Omega } = {8.15\Omega }$ ,(b) ${C}_{BD} = {C}_{BS} = {176}\mathrm{{fF}}$ ,(c) $W = {22\mu }\mathrm{m}$ and $L$ $= {2\mu }\mathrm{m}$ , and (d) ${C}_{GD} = {4.8}\mathrm{{fF}}$
3.2-5. $\left| {p}_{1}\right|  = {835.7}\mathrm{{kHz}}$
3.3-1. $\frac{{v}_{\text{out }}\left( s\right) }{{v}_{\text{in }}\left( s\right) } = \frac{1}{\frac{s}{{13.77} \times  {10}^{9}} + 1}$
3.3-2. ${W}_{\mathrm{M}2} = {592\mu }\mathrm{m}$
3.3-3. Example 3.3-1, NMOS: ${g}_{m} = {332\mu }\mathrm{S},{g}_{mbs} = {40.4\mu }\mathrm{S}$ , and ${g}_{ds} = {0.5\mu }\mathrm{S}$
Example 3.3-1, PMOS: ${g}_{m} = {224\mu }\mathrm{S},{g}_{mbs} = {38.2\mu }\mathrm{S}$ , and ${g}_{ds} = {0.5\mu }\mathrm{S}$
Example 3.3-2, NMOS: ${g}_{m} = {1.1}\mathrm{{mS}},{g}_{mbs} = {134\mu }\mathrm{S}$ , and ${g}_{ds} = {3.28}\mathrm{{mS}}$
Example 3.3-2, PMOS: ${g}_{m} = {500\mu }\mathrm{S},{g}_{mbs} = {85.2\mu }\mathrm{S}$ , and ${g}_{ds} = {1.428}\mathrm{{mS}}$
3.3-4. ${g}_{m} = {1.12}\mathrm{{mS}},{g}_{mbs} = {136\mu }\mathrm{S},{g}_{ds} = {0.0228\mu }\mathrm{S},{C}_{GB} = {0.575}\mathrm{{fF}},{C}_{GS} = {15.8}\mathrm{{fF}}$ , and ${C}_{GD} =$ 2.2 fF
3.3-5. ${I}_{D\left( \text{ TOTAL }\right) } = \frac{1}{L}{\left( {v}_{GS} - {v}_{T}\right) }^{2}\left( {1 + \lambda {v}_{DS}}\right) \left\lbrack  {\sum {W}_{i}}\right\rbrack$
3.3-6. ${L}_{\text{EQUIVALENT }} = \mathop{\sum }\limits_{0}^{i}{L}_{i}$
3.5-1. ${v}_{on} = {82.67}\mathrm{{mV}}$
3.5-2. ${g}_{m} = \frac{\partial {I}_{D}}{\partial {V}_{GS}} = \frac{W}{L}\left( \frac{1}{n\left( {{kT}/q}\right) }\right) {I}_{DO}\exp \left( \frac{{v}_{GS}}{n\left( {{kT}/q}\right) }\right)  = \frac{{I}_{D}}{n\left( {{kT}/q}\right) }$
3.5-3. ${I}_{D} = 2{K}^{\prime }\frac{W}{L}{\left\lbrack  n\left( kT/q\right) \right\rbrack  }^{2}$
3.6-1. Part (a)
Problem 3.6-1 (a)
$\mathrm{M}1\;2\;1\;0\;0$ nch $\;\mathrm{W} = 1\mathrm{u}\;\mathrm{L} = 1\mathrm{u}$
M2 2 3 4 4 pch w=1u L=1u
M3 3 3 4 4 pch w=1u L=1u
R1 3 0 50k
Vin 1 0 dc 1
vdd 4 0 dc 5
.MODEL nch NMOS VTO=0.7 KP=110U GAMMA=0.4 LAMBDA=0.04 PHI=0.7
.MODEL pch PMOS VTO=-0.7 KP=50U GAMMA=0.57 LAMBDA=0.05 PHI=0.8
. op
.end
Part (b)
---
Problem 3.6-1 (b)
$\mathrm{M}1\;2\;1\;0\;0$ nch $\;\mathrm{W} = 1\mathrm{u}\;\mathrm{L} = 1\mathrm{u}$
M2 2 3 4 4 pch w=1u L=1u M=2
M3 3 3 4 4 pch w=1u L=1u
R1 3 0 50k
Vin 1 0 dc 1
vdd 4 0 dc 5
.MODEL nch NMOS VTO=0.7 KP=110U GAMMA=0.4 LAMBDA=0.04 PHI=0.7
.MODEL pch PMOS VTO=-0.7 KP=50U GAMMA=0.57 LAMBDA=0.05 PHI=0.8
. op
.end
---
## Chapter 4
4.1-2. ${V}_{S}$ (volts) $\;R$ (ohms)
1.0
3.0 5253
5.0 infinity
4.1-3. ${V}_{s}$ (volts) $\;R$ (ohms)
1.0 infinity
3.0 2694
5.0 1163
4.1-4. ${V}_{s}$ (volts) $\;R$ (ohms), parallel
1.0 1460
3.0 1781
5.0 1163
4.1-5. $W/L = {2.64}$
4.1-6. $f\left( {-{3dB}}\right)  = {8.44} \times  {10}^{6}\mathrm{\;{Hz}}$
4.1-7. ${V}_{\text{out }}\left( {t}_{1}\right)  = {1.777}\mathrm{\;V}$
4.1-8. $t = {124.3}\mathrm{{ps}}$
4.1-9. ${\phi }_{1}$ must increase.
4.1-10. Reducing the magnitude does not affect the result of feedthrough in the slow regime. Decreasing the magnitude does affect the accuracy.
4.1-11. Case 1: ${V}_{\text{out }}\left( {t}_{1}\right)  = {1.967}\mathrm{\;V}$ and Case 2: ${V}_{\text{out }}\left( {t}_{1}\right)  = {1.984}\mathrm{\;V}$
4.1-12. ${W}_{2} = {W}_{1}{\left( 2 + \frac{{L}_{2}{C}_{OX}\left( {5 - {V}_{S} - {V}_{T}}\right) }{\operatorname{CGDO}\left( {{V}_{S} + {V}_{T}}\right) }\right) }^{-1}$
Design ${L}_{2}$ to be the minimum allowed device length and calculate ${W}_{2}$ .
4.1-13. Error due to charge injection is ${116\mu }\mathrm{V}$ .
4.1-14. ${R}_{ON} = {1606}$ ohms. Loss $=  - {8.32}\mathrm{\;{dB}}$ . The bridge switch dissipates more power, has higher ON resistance, and couples more signal during the OFF phase than the single switch.
4.2-1. ${R}_{AB} = \frac{1}{{2\beta }\left( {{V}_{C} - {V}_{T}}\right) }$ In general, for the same-size transistors, Fig. P4.2-1 will be more linear than Fig. 4.2-3.
4.3-1. ${r}_{\text{out }} = {21.7} \times  {10}^{6}$ ohms
4.3-2. ${W}_{1}/{L}_{1} = 1/{22}$
4.3-3. ${V}_{\text{out }}\left( \min \right)  = {3.02}\mathrm{\;V}$ . For the circuit in Problem 4.3-2, the minimum output voltage is lower than the circuit in Problem 4.3-1 and is thus generally a better choice.
4.3-4. ${V}_{\text{out }}\left( \min \right)  = {1.082}\mathrm{\;V}$ and ${r}_{\text{out }} = {764} \times  {10}^{6}$ ohms. From the SPICE results, ${I}_{\text{out }} = {10.157\mu }\mathrm{A}$ .
4.3-5. ${V}_{\text{out }}\left( \min \right)  = {0.3868}\mathrm{\;V}$ and ${r}_{\text{out }} = {717} \times  {10}^{6}$ ohms. From the SPICE results, ${I}_{\text{out }} = {8.185\mu }\mathrm{A}$ .
4.3-6. ${W}_{4}/{L}_{4} = 1/2$ and ${W}_{3}/{L}_{3} = 2/1$
4.3-7. SPICE results give ${I}_{\text{out }} = {10.233\mu }\mathrm{A}$ . Notice that the output current is more accurate than that simulated in Problem 4.3-5. This is because M3 and M1 have more closely matched terminal conditions.
4.3-8. ${R}_{\text{out }} = 2{r}_{\mathrm{{ds}}1}$ assuming ${g}_{m} > {g}_{ds} > \left( {1/R}\right)$
4.3-9. ${V}_{\text{Bias }}\left( \min \right)  = {1.553}\mathrm{\;V},{V}_{\text{min }} = {0.306}\mathrm{\;V}$ , and ${R}_{\text{out }} \approx  {29.31}\mathrm{M}\Omega$
4.4-1. ${i}_{O}\left( \min \right)  = {27.82\mu }\mathrm{A}$ and ${i}_{O}\left( \max \right)  = {56.93\mu }\mathrm{A}$
4.4-2. ${v}_{OUT} = {691\mu }\mathrm{V}$
4.5-2. ${V}_{\mathrm{{REF}}} = {V}_{T1}$
4.5-3. ${I}_{REF}\left( \min \right)  = {3.81} \times  {10}^{-6}$ and ${I}_{REF}\left( \max \right)  = {21.3} \times  {10}^{-6}$
4.5-4. ${I}_{\text{out }} = I = \frac{1}{R}\sqrt{\frac{2{i}_{D}}{{K}^{\prime }}}\left( {\sqrt{\frac{1}{{\left( W/L\right) }_{1}}} - \sqrt{\frac{1}{{\left( W/L\right) }_{2}}}}\right)$
4.5-5. (a) ${r}_{\text{out }} \approx  1/{g}_{m}$ . (b) ${r}_{\text{out }} \approx  1/{g}_{m}$ .
4.5-6. ${V}_{DD} = {0.0965}$
4.6-1. ${R}_{1} = {59.64}\mathrm{k}\Omega$ and ${R}_{2} = {732}\mathrm{k}\Omega$ . Stacking bipolar transistors reduces sensitivity to amplifier offset.
4.6-2. The other end of the capacitor should be connected to ${V}_{DD}$ .
4.6-3. ${V}_{REF} = {1.169}\mathrm{\;V}$
4.6-4. ${R}_{2} = {47.95}\mathrm{k}\Omega$ and ${V}_{REF} = {1.262}\mathrm{\;V}$
4.6-5. Assuming the technology is p-substrate with a deep n-well, Fig. 4.6-8(a) will have much less current injected into the substrate than Fig. 4.6-8(b).
4.6-6. ${R}_{1} = 1\mathrm{k}\Omega ,{R}_{2} = {11.04}\mathrm{k}\Omega$ , and ${R}_{3} = {8.748}\mathrm{k}\Omega$
4.6-7. $\frac{{W}_{23}}{{W}_{18}} = {0.4770},\frac{{W}_{24}}{{W}_{3}} = {1.8276}$ , and $\frac{{W}_{25}}{{W}_{8}} = {0.6933}$ . The value of the resistors is arbitrary.
4.6-8. ${R}_{1} = {29.93}\mathrm{k}\Omega ,{R}_{2} = {299.3}\mathrm{k}\Omega$ , and ${R}_{4} = {3825\Omega }$
## Chapter 5
5.1-1. ${v}_{\text{out }}\left( \max \right)  = 5\mathrm{\;V}$ and ${v}_{\text{out }}\left( \min \right)  = {0.5}\mathrm{\;V}$
5.1-2. ${V}_{\text{out }}\left( \min \right)  = {0.183}\mathrm{\;V}$
5.1-3. ${\beta }_{2}/{\beta }_{1} = {0.306}$ and ${A}_{v} =  - {1.8}\mathrm{\;V}/\mathrm{V}$
5.1-4. ${V}_{in} = {1.303}\mathrm{\;V},{A}_{v} =  - {2.345}\mathrm{\;V}/\mathrm{V}$ , and ${R}_{out} = {7.07}\mathrm{\;k}\Omega$
5.1-5. ${v}_{OUT}\left( \max \right)  = {4.3}\mathrm{\;V},{A}_{v} =  - {1.972}\mathrm{\;V}/\mathrm{V},{R}_{out} = {13.296}\mathrm{k}\Omega ,{z}_{1} = {47.2}\mathrm{{GHz}}$ , and ${p}_{1} = {11.71}\mathrm{{MHz}}$
5.1-6. ${V}_{in} = {1.7}\mathrm{\;V},{A}_{v} =  - {6.95}\mathrm{\;V}/\mathrm{V}$ , and ${R}_{\text{out }} = {31.6}\mathrm{k}\Omega$
5.1-7. Active load inverter: ${R}_{\text{out }} = {14.14}\mathrm{k}\Omega ,{A}_{v} =  - {2.097}\mathrm{\;V}/\mathrm{V}$ , and ${f}_{-3\mathrm{{dB}}} = {10.9}\mathrm{{MHz}}$ Current source inverter: ${R}_{\text{out }} = {222.22}\mathrm{k}\Omega ,{A}_{v} =  - {32.93}\mathrm{\;V}/\mathrm{V}$ , and ${f}_{-3\mathrm{\;{dB}}} = {0.697}\mathrm{{MHz}}$ Push-pull inverter: ${R}_{\text{out }} = {222.22}\mathrm{k}\Omega ,{A}_{v} =  - {48.63}\mathrm{\;V}/\mathrm{V}$ , and ${f}_{-3\mathrm{{dB}}} = {0.697}\mathrm{{MHz}}$
5.1-8. ${A}_{v} =  - {170.9}\mathrm{\;V}/\mathrm{V}\left( {{I}_{D} = {0.1\mu }\mathrm{A}}\right) ,{A}_{v} =  - {70.27}\mathrm{\;V}/\mathrm{V}\left( {{I}_{D} = {5\mu }\mathrm{A}}\right)$ , and ${A}_{v} =  - {15.71}\mathrm{\;V}/\mathrm{V}\left( {{I}_{D} = {100\mu }\mathrm{A}}\right)$
5.1-9. ${V}_{GG} = {2.05}\mathrm{\;V},{V}_{in} = {3.406}\mathrm{\;V},{A}_{v} =  - {24.85}\mathrm{\;V}/\mathrm{V}$ , and ${f}_{-3\mathrm{{dB}}} = {2.51}\mathrm{{MHz}}$
5.1-10. ${f}_{-3\mathrm{\;{dB}}} = {1.102}\mathrm{{MHz}},\overline{{e}_{ni}} = {6.277}\mathrm{{nV}}/\sqrt{\mathrm{{Hz}}}$
5.1-11. (a) Circuit 5 has the highest gain. (b) Circuit 4 has the lowest gain (assuming normal values of ${g}_{m}/{g}_{mb}$ ). (c) Circuits 5 and 6 have the highest output resistance. (d) Circuit 1 has the lowest output resistance.
5.1-12. ${A}_{v} =  - {43.63}\mathrm{\;V}/\mathrm{V}$ , and ${f}_{-3\mathrm{{dB}}} = {283.36}\mathrm{{kHz}}$
5.1-13. Active area of active load inverter $= {4546\mu }{\mathrm{m}}^{2}$ , active area of current source load inverter $=$ ${4.64\mu }{\mathrm{m}}^{2}$ , and active area of push-pull load inverter $= {2.55\mu }{\mathrm{m}}^{2}$ .
5.1-14. ${A}_{v} =  - {43.63}\mathrm{\;V}/\mathrm{V},{R}_{\text{out }} = {55.55}\mathrm{k}\Omega$ , and ${f}_{-3\mathrm{{dB}}} = {286.5}\mathrm{{kHz}}$
5.2-1. (a) ${g}_{m} = {104.8\mu }\mathrm{S}$ and ${A}_{v} = {23.31}\mathrm{\;V}/\mathrm{V}$ . (b) ${g}_{m} = {331.4\mu }\mathrm{S}$ and ${A}_{v} = {36.82}\mathrm{\;V}/\mathrm{V}$ .
5.2-2. (a) ${g}_{m} = {70.71\mu }\mathrm{S}$ and ${A}_{v} = {15.7}\mathrm{\;V}/\mathrm{V}$ . (b) ${g}_{m} = {223.6\mu }\mathrm{S}$ and ${A}_{v} = {24.84}\mathrm{\;V}/\mathrm{V}$ .
5.2-3. ${V}_{IC}\left( \max \right)  = {V}_{DD} - \left| {V}_{T1}\right|  - \sqrt{\frac{{I}_{DD}}{{K}_{P}^{\prime }\left( {{W}_{1}/{L}_{1}}\right) }} - \sqrt{\frac{{I}_{DD}}{{K}_{P}^{\prime }\left( {{W}_{5}/{L}_{5}}\right) }}$
${V}_{IC}\left( \min \right)  = {V}_{SS} - \left| {V}_{T1}\right|  + {V}_{T3} + \sqrt{\frac{{I}_{DD}}{{K}_{P}^{\prime }\left( {{W}_{1}/{L}_{1}}\right) }}$
5.2-4. ${V}_{IC}\left( \max \right)  = {4.86}\mathrm{\;V},{V}_{IC}\left( \min \right)  = {0.93}\mathrm{\;V}$ , and ICMR $= {3.93}\mathrm{\;V}$
5.2-5. $\;{A}_{v} = {233.1}\mathrm{\;V}/\mathrm{V}$ , and ${f}_{-3\mathrm{\;{dB}}} = {7.16}\mathrm{{kHz}}$
5.2-6. ${R}_{\text{out }} = {2.22}\mathrm{k}\Omega ,{A}_{v} = {104.1}\mathrm{\;V}/\mathrm{V},{V}_{IC}\left( \max \right)  = {2.184}\mathrm{\;V}$ , and ${V}_{IC}\left( \min \right)  = {1.2147}\mathrm{\;V}$
5.2-7. ${I}_{SS} = {10\mu }\mathrm{A} : {g}_{md} = {23.36\mu }\mathrm{S}$ and ${A}_{v} =  - {49.69}\mathrm{\;V}/\mathrm{V}.{I}_{SS} = {1\mu }\mathrm{A} : {g}_{md} = {7.07\mu }\mathrm{S}$ and ${A}_{v} =$ -157.11 V/V.
5.2-8. ${S}_{R} = {0.1}\mathrm{\;V}/\mu \mathrm{s}\left( {{I}_{SS} = {10\mu }\mathrm{A}}\right)$ and ${S}_{R} = {0.01}\mathrm{\;V}/\mu \mathrm{s}\left( {{I}_{SS} = {1\mu }\mathrm{A}}\right)$
5.2-9. ${A}_{vcm} \approx  {0.02}\mathrm{\;V}/\mathrm{V}$
5.2-10. ${A}_{v} = {0.74}\mathrm{\;V}/\mathrm{V}$
5.2-11. $\frac{{v}_{o}}{{v}_{ic}} =  - \frac{1}{\left( {g}_{m3}2{r}_{ds5}\right) }$ if ${g}_{m}{r}_{ds} >  > 1$
5.2-12. ${V}_{G1}\left( \max \right)  = {V}_{DD} + {V}_{T1} - {V}_{T3} + \sqrt{\frac{{I}_{SS}}{{K}_{P}^{\prime }{\left( W/L\right) }_{3}}}$
$$
{V}_{G1}\left( \min \right)  = {V}_{T1} + \sqrt{\frac{{I}_{SS}}{{K}_{N}^{\prime }{\left( W/L\right) }_{1}}} + \sqrt{\frac{2{I}_{SS}}{{K}_{N}^{\prime }{\left( W/L\right) }_{5}}}
$$
5.2-13. ${V}_{OS}\left( \max \right)  = {0.18}\mathrm{\;V}$
2-14. ${V}_{IC}\left( \min \right)  = {2.305}\mathrm{\;V},{V}_{IC}\left( \max \right)  = {3.282}\mathrm{\;V}$ , and ICMR (worst case) $= {0.978}\mathrm{\;V}$
<table><tr><td>Circuit</td><td>${R}_{out}$</td><td>${V}_{\text{out }}/{V}_{\text{in }}$</td></tr><tr><td>1</td><td>$\frac{1}{{g}_{ds2} + {g}_{m8} + {g}_{ds8}}$</td><td>$\frac{{g}_{m1}{g}_{m2}}{\left( {{g}_{m1} + {g}_{m2}}\right) \left( {{g}_{ds8} + {g}_{m8} + {g}_{ds8}}\right) } = \frac{{0.5}{g}_{m2}}{{g}_{ds2} + {g}_{m8} + {g}_{ds8}}$</td></tr><tr><td>2</td><td>$\frac{1}{{g}_{ds2} + {g}_{ds8}}$</td><td>$\frac{{g}_{m1}{g}_{m2}}{\left( {{g}_{m1} + {g}_{m2}}\right) \left( {{g}_{ds2} + {g}_{ds8}}\right) } = \frac{{0.5}{g}_{m2}}{{g}_{ds2} + {g}_{ds8}}$</td></tr><tr><td>3</td><td>$\frac{1}{{g}_{ds2} + {g}_{ds8}}$</td><td>$\frac{{g}_{m1} + {g}_{m2}}{2\left( {{g}_{ds2} + {g}_{ds8}}\right) }$</td></tr><tr><td>4</td><td>$\frac{1}{{g}_{ds2} + \frac{{g}_{ds6}{g}_{ds8}}{{g}_{m6}}} = \frac{{g}_{m6}}{{g}_{ds6}{g}_{ds8} + {g}_{m6}{g}_{ds2}}$</td><td>$\frac{\left( {{g}_{m1} + {g}_{m2}}\right) {g}_{m6}}{2\left( {{g}_{m6}{g}_{ds2} + {g}_{ds6}{g}_{ds8}}\right) }$</td></tr><tr><td>5</td><td>${g}_{m4}{g}_{m6}$ ${g}_{ds2}{g}_{m6}{g}_{ds4} + {g}_{m6}{g}_{ds4}{g}_{ds8}$</td><td/></tr></table>
5.2-16. ${e}_{eq} = {1.567}\mathrm{{nV}}/\sqrt{\mathrm{{Hz}}}$ and ${i}_{to} = {164}\mathrm{{fA}}/\sqrt{\mathrm{{Hz}}}$
5.2-17. ${v}_{s1} = \frac{{g}_{m1}\left( {{0.25} - \frac{{g}_{ds1}}{{g}_{m3}}}\right) }{\left( {0.75}{g}_{m1} + {g}_{ds1}\left( 2 - \frac{{g}_{m1}}{{g}_{m3}}\right)  - {g}_{ds5}\right) }{v}_{id}$
The value of ${v}_{s1}$ is nonzero because the loads (M3 and M4) seen by the input transistors (M1 and M2) at their drains are different.
5.2-18. (a) ${v}_{1}\left( \max \right)  = 2\mathrm{\;V}$ and ${v}_{1}\left( \min \right)  = {0.9302}\mathrm{\;V}$ . (b) ICMR $= {1.07}\mathrm{\;V}$ . (c) ${A}_{v} = {149.8}\mathrm{\;V}/\mathrm{V}$ . (d) ${f}_{-3\mathrm{{dB}}}$ $= {111.4}\mathrm{{kHz}}$ .
5.2-19. ${\bar{e}}_{eq}^{2} = 4{\bar{e}}_{\mathrm{{nl}}}^{2} + 2{\left( \frac{{g}_{m1}}{{g}_{m6}}\right) }^{2}{\bar{e}}_{\mathrm{n}6}^{2}$
5.2-20. $\frac{{v}_{3}}{{v}_{in}} = \left( \frac{-{0.5}{g}_{m1}}{s{C}_{1} + {G}_{\text{out }}}\right) \left( \frac{s{C}_{2} + {g}_{m5} + {g}_{m6}}{s{C}_{2} + {g}_{m6}}\right)  \rightarrow  \frac{-{g}_{m1}}{{g}_{ds1} + {g}_{ds5}}$ as $s \rightarrow  0$
$\frac{{v}_{3}}{{v}_{in}} =  - {73.69}\mathrm{\;V}/\mathrm{V},{p}_{1} =  - {4.5} \times  {10}^{6}\mathrm{{rad}}/\mathrm{s},{p}_{2} =  - {223.6} \times  {10}^{6}\mathrm{{rad}}/\mathrm{s}$ , and ${z}_{1} =  - {447.2} \times  {10}^{6}$
rad/s
5.2-21. $\frac{{v}_{\text{out }}}{{v}_{\text{in }}} =  - \sqrt{\frac{2{K}_{N}^{\prime }{\left( W/L\right) }_{1}}{{I}_{BIAS}{\left( {\lambda }_{1} + {\lambda }_{3}\right) }^{2}}}\;$ and $\;{R}_{\text{out }} = \frac{2}{\left( {g}_{ds1} + {g}_{ds3}\right) } = \frac{2}{{I}_{BIAS}\left( {{\lambda }_{1} + {\lambda }_{3}}\right) }$
5.2-22. ${V}_{IC}\left( \min \right)  = {V}_{T1} + {V}_{dsat1} + {V}_{dsat5},{V}_{IC}\left( \max \right)  = {V}_{DD}$ , and ${V}_{DD} = 2{V}_{dsat} + {V}_{T1}$
5.2-23. ${S}_{R} = {I}_{SS}/\left( {2{C}_{L}}\right)$ for capacitive load. ${S}_{R} = {I}_{SS}/{C}_{L}$ for resistive load.
5.2-24. $\left| {V}_{os}\right|  = \left| {{0.3} + \sqrt{\frac{{I}_{SS}}{0.9\beta }} - \sqrt{\frac{{I}_{SS}}{1.1\beta }}}\right|  = {0.48}\mathrm{\;V}$ if ${I}_{SS} = {100\mu }\mathrm{A}$
5.3-1. ${A}_{v} =  - {20}\mathrm{\;V}/\mathrm{V}$ . From the transfer characteristics, the small-signal gain is approximately $- {10}\mathrm{\;V}/\mathrm{V}$ .
5.3-2. Hint: Assume that ${V}_{GG2} - {V}_{T2}$ is greater than ${v}_{DS1}$ and express Eq. (5.3-4) as ${i}_{D2} \approx  {\beta }_{2}\left( {V}_{GG2}\right.$ $\left. {-{V}_{T2}}\right) {v}_{DS2}$ . Solve for ${v}_{OUT}$ as ${v}_{DS1} + {v}_{DS2}$ and simplify accordingly.
5.3-3. ${V}_{\text{out }}\left( \min \right)  = \frac{{\beta }_{3}}{2{\beta }_{1}}{\left( {V}_{DD} - {V}_{GG3} - \left| {V}_{T3}\right| \right) }^{2}\left\lbrack  {\frac{1}{{V}_{DD} - {V}_{T1}} - \frac{1}{{V}_{GG2} - {V}_{T2}}}\right\rbrack  \left( {1 + {\lambda }_{3}{V}_{DD}}\right)$
5.3-4. ${R}_{S2} = \frac{{g}_{m3}{r}_{ds3}{r}_{ds4}}{{g}_{m2}{r}_{ds2}} = {r}_{ds}$
5.3-5. $\frac{{A}_{v}}{{A}_{vo}} = \sqrt{1 + \frac{{I}_{D4}}{{I}_{D2}}},{I}_{D4} = {990\mu }\mathrm{A}$ , and ${R}_{out} \cong  \left\lbrack  {{g}_{m2}{r}_{ds2}{r}_{ds1}\parallel {r}_{ds3}}\right\rbrack$
5.3-6. $\;{A}_{v} =  - {306.78}\mathrm{\;V}/\mathrm{V}$ and ${R}_{\text{out }} = {3.686}\mathrm{M}\Omega$
5.3-7. (a) Circuit 3 has the highest gain. (b) Circuit 1 has the lowest gain. (c) Circuits 3 and 4 have the highest output resistance. (d) Circuits 1 and 5 have the lowest output resistance. (e) Circuits 1-4 have the lowest power dissipation. (f) Circuits 1 and 5 have the highest ${V}_{\text{out }}\left( \max \right)$ . (g) Circuit 4 has the worst (lowest) ${V}_{\text{out }}\left( \max \right)$ . (h) Circuits 2 and 6 have the best (lowest) ${V}_{\text{out }}\left( \min \right)$ . (i) Circuit 3 has the worst (highest) ${V}_{\text{out }}\left( \min \right)$ . (j) Circuits 1 and 5 have the highest $- 3\mathrm{\;{dB}}$ frequency because of lowest ${R}_{\text{out }}$ .
5.3-8. $\;{A}_{v} =  - {41.42}\mathrm{\;V}/\mathrm{V}$ and ${R}_{\text{out }} = {8.838}\mathrm{M}\Omega$
5.3-9. ${p}_{1} = \frac{-1}{{R}_{1}\left( {{A}_{v}{C}_{2} + {C}_{1}}\right) } \cong  \frac{-1}{{R}_{1}\left( {{A}_{v}{C}_{2}}\right) } = \frac{-1}{{g}_{m1}{R}_{1}{R}_{3}{C}_{2}}$
5.3-10. ${V}_{\text{out }}\left( \min \right)  =  - {4.85}\mathrm{\;V}$ for current source load inverter. ${V}_{\text{out }}\left( \min \right)  =  - {3.6}\mathrm{\;V}$ for simple cascode amplifier.
5.3-11. ${A}_{v} = \frac{-{g}_{m1}}{\left( \frac{{g}_{ds1}{g}_{ds2}}{{g}_{m2}} + \frac{{g}_{ds3}{g}_{ds4}}{{g}_{m4}}\right) }$ or ${A}_{v} = \frac{-\sqrt{2{K}^{\prime }{\left( W/L\right) }_{1}}}{{I}_{D}\left( {\frac{{\lambda }_{1}{\lambda }_{2}}{\sqrt{2{K}_{2}^{\prime }{\left( W/L\right) }_{2}}} + \frac{{\lambda }_{3}{\lambda }_{4}}{\sqrt{2{K}^{\prime }{}_{3}{\left( W/L\right) }_{3}}}}\right) }$
5.3-12. ${A}_{v} =  - {418}\mathrm{\;V}/\mathrm{V}$
5.3-13. (a) ${A}_{v} = \frac{{0.5}{g}_{m1}}{\frac{{g}_{ds2}{g}_{ds4}}{{g}_{m4}} + \frac{{g}_{ds6}{g}_{ds8}}{{g}_{m6}}}$ . (b) The magnitude of ${V}_{BIAS}$ should be at least ${V}_{GS} + {V}_{\text{dsat }}$ . One way to implement ${V}_{BIAS}$ is shown in Fig. 6.5-1(b) of the text. (c) If the currents were not equal, the voltages at the drains of M3-M5 and M4-M6 will be near ${V}_{DD}$ or near the sources of M1 and M2. Either way, M5-M8 or M1-M4 will not be saturated. The best way to solve this problem is through the use of common-mode feedback. This is illustrated in Fig. 5.2-15 of the text.
5.3-14. Choose ${I}_{D3} = {I}_{D2} = {I}_{D1} = {25\mu }\mathrm{A}$ . The maximum output swing gives ${W}_{3}/{L}_{3} = {W}_{4}/{L}_{4} = 1$ . From the gain we get ${W}_{1}/{L}_{1} = 3$ . The minimum output swing gives ${W}_{2}/{L}_{2} = 1$ . Therefore, ${V}_{GG2} = {1.76}\mathrm{\;V}$ and the power dissipation is ${0.125}\mathrm{\;{mW}}$ .
5.4-1. $\frac{{v}_{o}}{{v}_{s}} = \frac{{R}_{2}/{R}_{1}}{1 + \left( {1/{A}_{i}}\right) }$
5.4-2. ${W}_{2} = {10\mu }\mathrm{m}$ and ${L}_{2} = {1\mu }\mathrm{m},{R}_{\text{in }} = {6.74}\mathrm{k}\Omega$ and ${R}_{\text{out }} = {25}\mathrm{k}\Omega$
5.4-3. ${A}_{i}\left( 0\right)  = {0.988},{R}_{in} = {2796\Omega },{R}_{\text{out }} = {250}\mathrm{k}\Omega$ and ${f}_{-3\mathrm{{dB}}} = {973}\mathrm{{MHz}}$
5.4-4. ${R}_{in} = \frac{{v}_{x}}{{i}_{x}} \approx  \frac{{g}_{ds3} + {g}_{ds4}}{{g}_{m1}{g}_{m3}}$
5.4-5. ${R}_{in} = \frac{3.25}{{g}_{mN}^{2}{r}_{dsN}}$ and ${R}_{out} \approx  {r}_{dsP}$
5.4-7. ${R}_{in} = \frac{{v}_{x}}{{i}_{x}} \approx  {g}_{m1}{r}_{ds1}{g}_{m3}{r}_{ds3}{r}_{ds2}$
5.4-8. ${R}_{in} = \frac{{v}_{x}}{{i}_{x}} \approx  \frac{1}{{g}_{m3}{g}_{m4}{r}_{ds3}}$ . Plot ${i}_{out} =  - {i}_{in}$ .
5.4-9. ${R}_{in} = \frac{{r}_{ds1} + {r}_{ds2}}{1 + {g}_{m2}{r}_{ds}\left( {{g}_{m3} + {g}_{m4}}\right) {r}_{ds3}\parallel {r}_{ds4}}$
5.4-10. ${A}_{i} =  - {10}\mathrm{\;A}/\mathrm{A},{R}_{in} = {1.8}\mathrm{k}\Omega$ , and ${R}_{\text{out }} = {22.2}\mathrm{k}\Omega$
5.4-11. $\frac{{v}_{out}}{{v}_{in}} = \frac{{r}_{ds3} + {g}_{m2}{r}_{ds2}{r}_{ds3}}{{r}_{ds2} + {r}_{ds3}},\frac{{i}_{out}}{{i}_{in}} =  - \frac{{r}_{ds1}\left( {1 + {g}_{m2}{r}_{ds2}}\right) }{{r}_{ds1}\left( {1 + {g}_{m2}{r}_{ds2}}\right)  + {r}_{ds2} + {r}_{ds3}}$ ,
${R}_{in} = \frac{{r}_{ds1}\left( {{r}_{ds2} + {r}_{ds3}}\right) }{{r}_{ds1} + {r}_{ds2} + {r}_{ds3} + {g}_{m2}{r}_{ds2}{r}_{ds1}}$ and ${R}_{out} = {r}_{ds2}\parallel {r}_{ds3}\parallel  = \frac{{r}_{ds2}{r}_{ds3}}{{r}_{ds2} + {r}_{ds3}}$
5.5-1. ${W}_{2}/{L}_{2} = {38\mu }\mathrm{m}/{1\mu }\mathrm{m}$ and ${W}_{1}/{L}_{1} = {3\mu }\mathrm{m}/{1\mu }\mathrm{m}$
5.5-2. ${W}_{1}/{L}_{1} = {8.6\mu }\mathrm{m}/{1\mu }\mathrm{m}$
5.5-3. $\;{A}_{v} = {0.943}\mathrm{\;V}/\mathrm{V}$ and ${R}_{\text{out }} = {6.37}\mathrm{\;k}\Omega$
5.5-4. (a) ${v}_{OUT}\left( \max \right)  =  + 2\mathrm{\;V}$ . (b) ${v}_{OUT}\left( \min \right)  =  - {1.6514}\mathrm{\;V}$ . (c) $S{R}^{ + } =  + 4\mathrm{\;V}/\mathrm{{\mu s}}$ . (d) $S{R}^{ - } =  - {482}$ V/μs. (e) ${R}_{\text{out }} \approx  {408\Omega }$ .
5.5-5. (a) ${v}_{OUT}\left( \max \right)  =  + 2\mathrm{\;V}$ . (b) ${v}_{OUT}\left( \min \right)  =  - {1.5815}\mathrm{\;V}$ . (c) $S{R}^{ + } =  + 4\mathrm{\;V}/\mu \mathrm{s}$ . (d) $S{R}^{ - } =  - {1069}$ V/μs. (e) ${R}_{\text{out }} \approx  {4275.24\Omega }$ .
5.5-6. ${A}_{v} = {0.9026}\mathrm{\;V}/\mathrm{V}$ and ${R}_{\text{out }} = {1361\Omega }$
5.5-7. ${\eta }_{\max } = \frac{{\left( {V}_{DD} - {V}_{SS}\right) }^{2}}{\left( {{V}_{DD} - {V}_{T1}}\right) \left( {{V}_{DD} - {V}_{SS} - {V}_{T1}}\right) } \approx  {20}\%$
5.5-8. Fig. 5.5-3(a): $z =  - {14.9}\mathrm{{GHz}}$ and $p =  - {140.8}\mathrm{{MHz}}$ . Fig. 5.5-3(b): $z =  - {14.9}\mathrm{{GHz}}$ and $p =$ -71.1 MHz.
5.5-9. (a) Circuit 5 has the highest voltage gain. (b) Circuit 4 has the lowest voltage gain. (c) Circuit 6 has the highest output resistance. (d) Circuit 1 has the lowest output resistance. (e) Circuits 2,4, and 6 have the highest output swing. (f) Circuits 1, 3, and 5 have the lowest output swing.
5.5-10. $\eta  = \frac{\frac{{V}_{DD}^{2}}{2{R}_{L}}}{\left( {{V}_{DD} - {V}_{SS}}\right) \left( \frac{{V}_{DD}^{2}}{\pi {R}_{L}}\right) }$ which is $\pi /4$ when ${V}_{DD} - {V}_{SS} = {V}_{DD}/2$
5.5-11. ${V}_{\text{Bias }} = \frac{{V}_{T1} - \sqrt{\frac{{K}_{\;P}^{\prime }}{{K}_{\;N}^{\prime }}\left( \frac{{W}_{2}}{{L}_{2}}\right) \left( \frac{{L}_{1}}{{W}_{1}}\right) }\left| {V}_{T2}\right| }{1 - \sqrt{\frac{{K}_{\;P}^{\prime }}{{K}_{\;N}^{\prime }}\left( \frac{{W}_{2}}{{L}_{2}}\right) \left( \frac{{L}_{1}}{{W}_{1}}\right) }}$
5.5-12. ${V}_{\text{out }}\left( \max \right)  = \left( {{V}_{DD} + {V}_{BIAS} - {V}_{T1}}\right)  + Y$
where $Y = \frac{1}{{R}_{L}{K}_{N}^{\prime }{\left( W/L\right) }_{1}} - \sqrt{\frac{1}{{\left( {R}_{L}{K}_{N}^{\prime }{\left( W/L\right) }_{1}\right) }^{2}} + \frac{2\left( {{V}_{DD} - {V}_{BIAS} - {V}_{T1}}\right) }{\left( {R}_{L}{K}_{N}^{\prime }{\left( W/L\right) }_{1}\right) }}$
${V}_{\text{out }}\left( \min \right)  = \left( {{V}_{SS} - {V}_{BIAS} + \left| {V}_{T2}\right| }\right)  - Z$
where $Z = \frac{1}{{R}_{L}{K}_{P}^{\prime }{\left( W/L\right) }_{2}} - \sqrt{\frac{1}{{\left( {R}_{L}{K}_{P}^{\prime }{\left( W/L\right) }_{2}\right) }^{2}} + \frac{2\left( {{V}_{SS} - {V}_{BIAS} + \left| {V}_{T2}\right| }\right) }{\left( {R}_{L}{K}_{P}^{\prime }{\left( W/L\right) }_{2}\right) }}$
5.5-13. ${V}_{\text{out }}\left( \max \right)  = \frac{{V}_{DD}}{1 + \frac{1}{{K}_{P}^{\prime }\frac{{W}_{2}}{{L}_{2}}{R}_{l}\left( {{V}_{SS} - {V}_{DD} + {V}_{TR2} + \left| {V}_{T2}\right| }\right) }}$
$$
{V}_{\text{out }}\left( \min \right)  = \frac{{V}_{SS}}{1 + \frac{1}{{K}_{N}^{\prime }\frac{{W}_{1}}{{L}_{1}}{R}_{L}\left( {-{V}_{SS} + {V}_{DD} + {V}_{TR2} - \left| {V}_{T2}\right| }\right) }}
$$
5.5-14. Set up a means for monitoring the output sinking and sourcing current and then connect this current through the drain of a transistor to the drain of an opposite-type transistor whose current is fixed at the short-circuit limit. Use the voltage between these drains to ground to drive a circuit that will protect the sinking (M2) and sourcing (M3) transistors.
5.5-15. ${R}_{\text{out }} = \frac{2}{{g}_{m1} + {g}_{m2}}$ and ${R}_{\text{out }} = \left\lbrack  \frac{2}{{g}_{m1} + {g}_{m2}}\right\rbrack  \parallel {R}_{L}$ 5.5-16.
<table><tr><td>Fig. 5.2-1</td><td>Fig. 5.3-1</td><td>Fig. 5.3-6</td><td>Fig. 5.5-1</td><td>Fig. 5.5-3b</td></tr><tr><td>${A}_{v}\frac{2}{{\lambda }_{N} + {\lambda }_{P}}\sqrt{\frac{{K}_{N}{}^{\prime }{W}_{1}}{2{I}_{D}{L}_{1}}}$</td><td>$- \sqrt{\frac{2{K}_{N}{}^{\prime }{W}_{1}}{{L}_{1}{I}_{D}{\lambda }_{p}^{2}}}$</td><td>See Eq. (5.3-37) Gain $\propto  {I}_{D}^{-1}$</td><td>$\frac{-2}{{\lambda }_{N} + {\lambda }_{P}}\sqrt{\frac{{K}_{N}^{\prime }{W}_{1}}{2{I}_{D}{L}_{1}}}$</td><td>$\frac{\sqrt{2{K}_{N}{}^{\prime }\left( {{W}_{1}/{L}_{1}}\right) {I}_{D}}}{1 + \sqrt{2{K}_{N}{}^{\prime }\left( {{W}_{1}/{L}_{1}}\right) {I}_{D}}}$</td></tr><tr><td>${R}_{out}$$\propto  \frac{1}{{I}_{D}}$</td><td>$\propto  \frac{1}{{I}_{D}}$</td><td>$\propto  \frac{1}{{I}_{D}^{-{1.5}}}$</td><td>$\propto  \frac{1}{{I}_{D}}$</td><td>$\propto  \frac{1}{\sqrt{{I}_{D}}}$</td></tr><tr><td>$\left| {p}_{1}\right|$$\propto  {I}_{D}$</td><td>$\propto  {I}_{D}$</td><td>$\propto  {I}_{D}^{1.5}$</td><td>$\propto  {I}_{D}$</td><td>$\propto  {I}_{D}^{0.5}$</td></tr></table>
## Chapter 6
6.1-1. $\frac{{v}_{\text{out }}}{{v}_{\text{in }}} = 1 + \frac{{R}_{2}}{{R}_{2}}$
6.1-2. ${v}_{in} = \frac{{v}_{S}}{1 + f{A}_{v}}$ where ${v}_{in} =$ input to op amp, ${v}_{S} =$ external input signal, $f =$ feedback factor, and
${A}_{v} =$ differential voltage gain of the op amp. As ${A}_{v} \rightarrow  \infty$ , then ${v}_{in} \rightarrow  0$ .
6.1-3. Use the definitions to show that ${v}_{\text{out }} = {A}_{cm}{v}_{cm}$ .
6.1-6. The gain in the circuit is already at the level of a two-stage op amp. The gain could easily be increased by making the $W/L$ ratio of M7 to M4 and M6 to M5 greater than one.
6.2-2. The actual phase margin is ${51.83}^{ \circ  }$ compared to ${45}^{ \circ  }$ estimated from the Bode plot.
6.2-7. The RHP zero occurs because there are two paths from the gate of M6 to the drain and at some value of the complex variable, $s$ , these paths will cancel, giving a zero. The RPH zero has a stronger influence on MOSFETs because ${g}_{m\mathrm{{MOS}}} < {g}_{m\mathrm{{BJT}}}$ .
6.2-8. (a) ${p}_{2} =  - {14.2} \times  {10}^{6}\mathrm{{rad}}/\mathrm{s}$ . (b) ${PM} = {71.7}^{ \circ  }$ (c) ${PM} = {34.4}^{ \circ  }$ .
6.2-10. ${W}_{1}/{L}_{1} = {10}$ and ${W}_{6}/{L}_{6} = {12.33}$
6.2-11. (a) ${R}_{z} = 2\mathrm{k}\Omega ,{p}_{1} =  - 4,{444}\mathrm{{rads}}/\mathrm{s},{p}_{2} =  - {100} \times  {10}^{6}\mathrm{{rad}}/\mathrm{s}$ , and ${p}_{4} =  - {500} \times  {10}^{6}\mathrm{{rad}}/\mathrm{s}$ . (b) ${R}_{z} = {2.33}\mathrm{k}\Omega ,{p}_{1} =  - 4,{444}\mathrm{{rad}}/\mathrm{s}$ , and ${p}_{4} =  - {429} \times  {10}^{6}\mathrm{{rad}}/\mathrm{s}$ .
6.3-1. ${I}_{5} = {20\mu }\mathrm{A},{I}_{6} = {125.66\mu }\mathrm{A},{W}_{1} = {W}_{2} = {7.17\mu }\mathrm{m},{W}_{3} = {W}_{4} = {10\mu }\mathrm{m},{W}_{5} = {20\mu }\mathrm{m},{W}_{6} =$ ${125.66\mu }\mathrm{m}$ , and ${W}_{7} = {125.66\mu }\mathrm{m}$
<table><tr><td>Characteristic</td><td>Circuit 1 (n-channel input)</td><td>Circuit 2 (p-channel input)</td></tr><tr><td>Noise</td><td>Worse but not by much because the first-stage gain is higher</td><td>Better but degraded by the lower first-stage gain</td></tr><tr><td>Phase margin</td><td>Poorer $\left( {g}_{mI}\right.$ larger but ${g}_{mII}$ smaller)</td><td>Better</td></tr><tr><td>Gain bandwidth</td><td>Larger $\left( {{GB} = {g}_{ml}/{C}_{c}}\right)$</td><td>Smaller</td></tr><tr><td>${V}_{icm}\left( \max \right)$</td><td>Larger</td><td>Smaller</td></tr><tr><td>${V}_{icm}\left( \min \right)$</td><td>Smaller</td><td>Larger</td></tr><tr><td>Sourcing output current</td><td>Large</td><td>Constrained</td></tr><tr><td>Sinking output current</td><td>Constrained</td><td>Large</td></tr></table>
6.3-5. The new value of ICMR is ${2.62}\mathrm{\;V}$ as compared to $3\mathrm{\;V}$ .
6.3-6. ${W}_{1} = {W}_{2} = {6\mu }\mathrm{m},{W}_{3} = {W}_{4} = {7\mu }\mathrm{m},{W}_{5} = {29\mu }\mathrm{m},{W}_{6} = {43}\mathrm{\;m}$ , and ${W}_{7} = {90\mu }\mathrm{m}$
6.3-7. ${I}_{5} = {I}_{8} = {36\mu }\mathrm{A},{I}_{7} = {60\mu }\mathrm{A},{A}_{v} = {2489}\mathrm{\;V}/\mathrm{V},{R}_{\text{out }} = {185}\mathrm{k}\Omega ,{P}_{\text{diss }} = {660\mu }\mathrm{W},{V}_{\text{in },\left( \text{ max }\right) } = {0.51}$ V, ${V}_{\text{in },\left( \text{min }\right) } =  - {2.21}\mathrm{\;V},{V}_{\text{out },\left( \text{max }\right) } = {1.8}\mathrm{\;V},{SR} = 6\mathrm{\;V}/\mu \mathrm{s},{p}_{1} =  - {1.16}\mathrm{{kHz}}$ , and ${p}_{2} =  - {2.8}\mathrm{{kHz}}$
6.3-8. For ${A}_{v} = {9090}\mathrm{\;V}/\mathrm{V} : {W}_{1}/{L}_{1} = {W}_{2}/{L}_{2} = {2\mu }\mathrm{m}/{2\mu }\mathrm{m},{W}_{3}/{L}_{3} = {W}_{4}/{L}_{4} = {3\mu }\mathrm{m}/{2\mu }\mathrm{m},{W}_{5}/{L}_{5}$ $= {20\mu }\mathrm{m}/{2\mu }\mathrm{m},{W}_{6}/{L}_{6} = {12\mu }\mathrm{m}/{2\mu }\mathrm{m},{W}_{7}/{L}_{7} = {40\mu }\mathrm{m}/{2\mu }\mathrm{m}$ , and ${W}_{8}/{L}_{8} = {20\mu }\mathrm{m}/{2\mu }\mathrm{m}$ . ${R}_{z} \approx  4\mathrm{k}\Omega ,{C}_{C} = {74.2}\mathrm{{pF}},{C}_{L}\left( \max \right)  = {141.5}\mathrm{{pF}}$ , and ${SR} = {0.674}\mathrm{\;V}/\mu \mathrm{s}$
6.3-9. For ${A}_{v} = {5000}\mathrm{\;V}/\mathrm{V} : {W}_{1}/{L}_{1} = {W}_{2}/{L}_{2} = {2\mu }\mathrm{m}/{2\mu }\mathrm{m},{W}_{3}/{L}_{3} = {W}_{4}/{L}_{4} = {3.6\mu }\mathrm{m}/{2\mu }\mathrm{m},{W}_{5}/{L}_{5} =$ ${40\mu }\mathrm{m}/{2\mu }\mathrm{m},{W}_{6}/{L}_{6} = {7.2\mu }\mathrm{m}/{2\mu }\mathrm{m},{W}_{7}/{L}_{7} = {40\mu }\mathrm{m}/{2\mu }\mathrm{m}$ , and ${W}_{8}/{L}_{8} = {20\mu }\mathrm{m}/{2\mu }\mathrm{m}.{R}_{z} \approx$ ${5.24}\mathrm{k}\Omega ,{C}_{C} = {105}\mathrm{{pF}},{C}_{L}\left( \max \right)  = {110}\mathrm{{pF}}$ , and ${SR} \approx  1\mathrm{\;V}/\mu \mathrm{s}$
6.3-10. ${I}_{8} = {10.75\mu }\mathrm{A},{I}_{5} = 2{I}_{8} = {21.5\mu }\mathrm{A},{I}_{7} = {10}{I}_{8} = {107.5\mu }\mathrm{A},{Av}\left( 0\right)  = {5395}\mathrm{\;V}/\mathrm{V},{GB} = {4.90}$ $\mathrm{{MHz}},\left| {SR}\right|  = {4.3}\mathrm{\;V}/\mu \mathrm{s},{P}_{\text{diss }} = {0.699}\mathrm{\;{mW}}$ , and ${PM} = {63.6}^{ \circ  }$
6.3-11. ${A}_{v} = {3079}\mathrm{\;V}/\mathrm{V},{R}_{\text{out }} = {333}\mathrm{k}\Omega ,{p}_{1} =  - {1391}\mathrm{\;{Hz}},{GB} = {0.697}\mathrm{{MHz}},{SR} = 2\mathrm{\;V}/\mathrm{{\mu s}}$ , and ${P}_{\text{diss }}$ $= {1.4}\mathrm{{mW}}$
6.3-13. $\left( \frac{{W}_{6A}}{{L}_{6A}}\right)  = \left( \frac{{W}_{6B}}{{L}_{6B}}\right) \frac{{I}_{8}}{{I}_{7}}{\left( \frac{{C}_{C} + {C}_{L}}{{C}_{C}}\right) }^{2},{W}_{6A}/{L}_{6A} = {W}_{6}/{L}_{6} = {94},{I}_{8} = {I}_{9} = {I}_{10} = {I}_{11} = {15\mu }\mathrm{A}$ , ${W}_{6\mathrm{\;B}}/{L}_{6\mathrm{\;B}} \approx  {32},{R}_{z} = {4.59}\mathrm{k}\Omega$ , and ${z}_{1} = {p}_{2} =  - {15}\mathrm{{MHz}}$
6.3-14. ${A}_{v} = \frac{{g}_{m1}{g}_{m6}}{\left( {{g}_{ds2} + {g}_{ds4}}\right) \left( {{g}_{ds6} + {g}_{ds7}}\right) }$
<table><tr><td rowspan="2">3-15.</td><td>${\mathrm{C}}_{\mathrm{c}}$</td><td>1</td><td>$\mathrm{W}1 = \mathrm{W}2$</td><td>W3 = W4</td><td>$\mathrm{W}5 = \mathrm{W}8$</td><td>W6</td><td>W7</td><td>W9 = W10</td><td>$\mathrm{{W11}} = \mathrm{{W12}}$</td><td>${P}_{\text{diss }}$</td></tr><tr><td>2 pF</td><td>${20\mu }\mathrm{A}$</td><td>${33\mu }\mathrm{m}$</td><td>${7\mu }\mathrm{m}$</td><td>${202\mu }\mathrm{m}$</td><td>${165\mu }\mathrm{m}$</td><td>${800\mu }\mathrm{m}$</td><td>${80\mu }\mathrm{m}$</td><td>${120\mu }\mathrm{m}$</td><td>${450\mu }\mathrm{W}$</td></tr></table>
6.3-16. The compensation capacitor, ${C}_{C}$ , is removed from the op amp when the output voltage is high because M10 is off. This is due to the fact that the drain-source voltage of M10 is the same as the output and the gate is connected to ${V}_{DD}$ . M10 needs to be moved to the right of ${C}_{C}$ or paralleled with a PMOS connected to ${V}_{SS}$ or both.
6.4-2. ${PSR}{R}^{ + } = {1737}\mathrm{\;V}/\mathrm{V},{PSR}{R}^{ - } = {2171}\mathrm{\;V}/\mathrm{V},{p}_{1} = {172.4}\mathrm{{kHz}},{z}_{1} = {11.6}\mathrm{{MHz}}$ , and ${z}_{2} = {p}_{2}$ $= {6.2}\mathrm{{MHz}}$ .
6.4-3. Fig. P6.4-3 has a ${PSR}{R}^{ + }$ that is approximately ${C}_{gd}/{C}_{c}$ less than Fig. 6.4-2(a).
6.4-4. $\frac{{v}_{\text{out }}}{{v}_{\text{ground }}} = {\left\lbrack  \frac{2{g}_{ml}{g}_{mII}}{{G}_{I}\left( {{g}_{ds6} - {g}_{ds7} - {g}_{m7}}\right) }\right\rbrack  }^{-1}\;$ and $\;{z}_{1} \approx  \frac{{G}_{I}\left( {{g}_{ds6} - {g}_{ds7} - {g}_{m7}}\right) }{{C}_{c}\left( {{G}_{I} + {g}_{m6} - {g}_{m7} + {g}_{ds6} - {g}_{ds7}}\right) }$ .
The two poles are the same as given by the zeros of Eq. (6.4-14) in the text.
6.5-1. ${V}_{BIAS} = {1.3}\mathrm{\;V}, R = {12.65}\mathrm{k}\Omega$ , and ${A}_{v} =  - {6248}\mathrm{\;V}/\mathrm{V}$ .
6.5-2. ${W}_{B1}/{L}_{B1} = {W}_{B2}/{L}_{B2} = {W}_{B3}/{L}_{B3} = {W}_{B4}/{L}_{B4} = 1$ and ${W}_{B5}/{L}_{B5} = {0.25}.{I}_{5} = {110\mu }\mathrm{A}$
6.5-3. (a) ${R}_{C1} \approx  {g}_{mC1}$ and ${R}_{C2} \approx  {r}_{ds}$ . (b) ${R}_{C1} \approx  {g}_{mC1}$ and ${R}_{C2} \approx  {g}_{mC2}$ .
6.5-4. ${W}_{1}/{L}_{1} = {W}_{2}/{L}_{2} = {14.5\mu }\mathrm{m}/{1\mu }\mathrm{m}$
6.5-5. ${A}_{v = } - {2620}\mathrm{\;V}/\mathrm{V}$
$$
\text{6.5-6.}{I}_{5 = }{250\mu }\mathrm{A}\text{and}{W6} = {W7} = {W3} = {W4} = {W8} = {40}
$$
6.5-7. ${R}_{\text{out }} = {11.11}{r}_{dsN}$ and ${A}_{v} = {18},{518}\mathrm{\;V}/\mathrm{V}$
6.5-8. ${R}_{\text{out }} = {20}{r}_{dsN}$ and ${A}_{v} = {100},{000}\mathrm{\;V}/\mathrm{V}$
6.5-9. $\;{ICMR} = {V}_{in}\left( \max \right)  - {V}_{in}\left( \min \right)$ , where
$$
{V}_{in}\left( \max \right)  = {V}_{DD} + {V}_{T1}\left( \min \right)  - \sqrt{\frac{{I}_{7}}{{K}_{{}^{\prime }N}\left( {{W}_{3}/{L}_{3}}\right) }} + \sqrt{\frac{2{I}_{7}}{{K}_{{}^{\prime }N}\left( {{W}_{5}/{L}_{5}}\right) }}
$$
$$
{V}_{in}\left( \min \right)  = {V}_{SS} + {V}_{T1}\left( \max \right)  - \sqrt{\frac{{I}_{7}}{{K}_{VN}^{\prime }\left( {{W}_{1}/{L}_{1}}\right) }} + \sqrt{\frac{2{I}_{7}}{{K}_{VN}^{\prime }\left( {{W}_{7}/{L}_{7}}\right) }}
$$
${W}_{1}/{L}_{1} = {W}_{2}/{L}_{2} = {64\mu }\mathrm{m}/{10\mu }\mathrm{m}$ , and ${W}_{3}/{L}_{3} = {W}_{4}/{L}_{2} = {135\mu }\mathrm{m}/{10\mu }\mathrm{m}$
6.5-10. ${A}_{v} = \sqrt{\frac{8{K}^{\prime }{}_{N}{K}^{\prime }{}_{P}\left( {{W}_{1}/{L}_{1}}\right) \left( {{W}_{8}/{L}_{8}}\right) }{{I}_{7}{I}_{9}{\left( {\lambda }_{P} + {\lambda }_{P}\right) }^{2}{\lambda }_{P}^{2}}}\;$ and $\;{R}_{out} = \frac{1}{{g}_{ds8} + {g}_{ds9}}$
6.5-11. ${R}_{\text{out }} = {0.2}{g}_{mN}{r}_{dsN}{}^{2}$ and ${A}_{v} = {2000}\mathrm{\;V}/\mathrm{V}$ if $k = 1$
6.5-12. ${p}_{\text{out }} =  - {5000}\mathrm{{rad}}/\mathrm{s},{p}_{A} \approx  {p}_{B} \approx   - {416.7}\mathrm{{Mrad}}/\mathrm{s},{p}_{6} \approx   - {909}\mathrm{{Mrad}}/\mathrm{s},{p}_{8} \approx   - {181.2}\mathrm{{Grad}}/\mathrm{s}$ , and ${p}_{9} \approx   - {909}\mathrm{{Mrad}}/\mathrm{s}$
<table><tr><td>$\mathrm{W}1 = \mathrm{W}2$</td><td>W3 = W4 = W6 $= \mathrm{W}7 = \mathrm{W}8$</td><td>W9 = W10 $= \mathrm{W}{11}$</td><td>W5</td><td>${I}_{5}\left( {\mu A}\right)$</td><td>${A}_{vd}$</td><td>${V}_{BP}$</td><td>${V}_{BN}$</td><td>${P}_{\text{diss }}$</td></tr><tr><td>90</td><td>40</td><td>18</td><td>11</td><td>${250\mu }\mathrm{A}$</td><td>17,324 V/V</td><td>${3.3}\mathrm{\;V}$</td><td>1.7 V</td><td>2.5 mW</td></tr></table>
6.5-14. ${S}_{1} = {S}_{2} = {79},{S}_{3} = {21.6},{S}_{4} = {S}_{5} = {S}_{14} = {36.4},{S}_{6} = {S}_{7} = {S}_{13} = {7.3},{S}_{8} = {S}_{9} = {S}_{10} = {S}_{11}$ $= {80},{S}_{12} = {27}$ , and ${A}_{v} = {4364}\mathrm{\;V}/\mathrm{V}$
6.5-15. ${W}_{1} = {W}_{2} = {36\mu }\mathrm{m},{W}_{3} = {W}_{4} = {W}_{6} = {W}_{7} = {24\mu }\mathrm{m},{W}_{8} = {W}_{9} = {W}_{10} = {W}_{11} = {121\mu }\mathrm{m},{W}_{15}$ $= {4\mu }\mathrm{m},{W}_{12} = {W}_{13} = {W5} = {1.4\mu }\mathrm{m},{W}_{14} = {16\mu }\mathrm{m},{R}_{\text{out }} \approx  {9.3682}\mathrm{M}\Omega$ , and ${A}_{v} = {3217}\mathrm{\;V}/\mathrm{V}$
6.5-16. ${p}_{A} =  - {g}_{m6}/C$ and ${p}_{B} =  - 1/{r}_{ds}C$ . Both of these poles will appear as output poles in the overall voltage transfer function.
6.5-17. ${R}_{\text{out }} \approx  {0.556}\mathrm{G}\Omega ,{A}_{v} = {10},{417}\mathrm{\;V}/\mathrm{V}$ , and ${p}_{\text{dominant }} \approx  {180}\mathrm{{rad}}/\mathrm{s}$
6.6-1. ${V}_{OS} < 1\mathrm{{mV}}$
6.6-2. $\frac{{v}_{OUT}}{{v}_{IN}} = \frac{-{2\pi } \times  {10}^{6}\left( {s + {0.01}}\right) }{\left( {s + {41.07}}\right) \left( {s + {1529.72}}\right) }$
6.6-10. The positive and negative slopes require extra current to allow the relationship $i = C\left( {{dv}/{dt}}\right)$ to be satisfied. This means that the current through M6 is different for the positive and negative rise and fall times. This changes ${g}_{m6}$ , which changes the dominant pole and influences the phase margin.
7.1-1. ${W}_{18}/{L}_{18} = {13.5},{W}_{19}/{L}_{19} = {4.9},{W}_{21}/{L}_{21} = {10.5}$ , and ${W}_{22}/{L}_{22} = {55}$ .
7.1-2. ${V}_{A} = {0.9}\mathrm{\;V},{V}_{B} = {1.0}\mathrm{\;V}$ , and ${V}_{C} = {0.1}\mathrm{\;V}$
7.1-5. $\frac{{v}_{\text{out }}}{{v}_{\text{in }}} = \frac{-{g}_{m1}{g}_{m4}}{{g}_{m2}{g}_{m4} - \left( {{g}_{m3} + {g}_{ds4}}\right) \left( {{g}_{ds1} + {g}_{ds2}}\right) }$
7.1-6. ${R}_{\text{out }} = {67.3\Omega }$ and ${f}_{-3\mathrm{{dB}}} = {236}\mathrm{{MHz}}$
7.1-7. ${R}_{\text{out }} = {294.5\Omega },{f}_{-3\mathrm{{dB}}} = {10.81}\mathrm{{MHz}},\max /\min$ output $=  \pm  1\mathrm{\;V}$ , and ${P}_{\text{diss }} = {3.9}\mathrm{\;{mW}}$
7.1-8. In a bulk CMOS p-well (n-well) technology, npn (pnp) BJTs (both substrate and lateral) are available. The advantage of using a BJT in a Class A output is a reduced output resistance. The disadvantages include unsymmetrical drive and limited output current.
7.1-9. ${R}_{\text{out }} \cong  \frac{1}{{g}_{m10}} + \frac{1}{\left( {1 + {\beta }_{F}}\right) {g}_{m9}}$ and ${R}_{\text{out }} = {1152\Omega }$
7.1-10. ${p}_{1} =  - {84.3}\mathrm{{Mrad}}/\mathrm{s},{p}_{2} =  - {23.32}\mathrm{{Mrad}}/\mathrm{s}$ , and ${z}_{1} =  - {614}\mathrm{{Mrad}}/\mathrm{s}$ . Neither ${p}_{1}$ nor ${p}_{2}$ is greater than ${10GB}$ if ${GB} = 5\mathrm{{MHz}}$ , so they will deteriorate the phase margin of the amplifier of Example 7.1-2.
7.1-11. ${I}_{1} = {I}_{2} = {I}_{3} = {I}_{2} = {60\mu }\mathrm{A},{I}_{5} = {120\mu }\mathrm{A},{I}_{6} = {I}_{7} = {40\mu }\mathrm{A},{I}_{Q1} = {2\mu }\mathrm{A}$ and ${I}_{Q2} + {I}_{9} = {200}$ $\mu \mathrm{A}.{A}_{v} = {532.2}\mathrm{\;V}/\mathrm{V}$ and ${R}_{\text{out }} = {287.4\Omega }$ .
7.2-1. ${GB} = {26.79}\mathrm{{MHz}}$ and ${C}_{c} = {18.66}\mathrm{{pF}}$
7.2-2. ${GB} \approx  {0.23}{p}_{6}$
7.2-3. ${PM} = {16}^{ \circ  }$
7.2-4. ${GB} \approx  {65}\mathrm{{MHz}}$ and ${C}_{L} \geq  {1.54}\mathrm{{pF}}$
7.2-5. $\frac{{W}_{1}}{{L}_{1}} = {50},\frac{{W}_{2}}{{L}_{2}} = {5.6},\frac{{W}_{5}}{{L}_{5}} = {50.5}$ , and $\frac{{W}_{6}}{{L}_{2}} = {5.6}$
7.2-6. ${p}_{\text{in }} =  - {466}\mathrm{{MHz}}$ and ${p}_{\text{out }} \approx   - {50}\mathrm{{MHz}}$
7.2-7. ${R}_{in} = {1076\Omega },{R}_{out} = {636\Omega }$ , and ${f}_{-3\mathrm{{dB}}} = {13.87}\mathrm{{MHz}}$ .
7.2-8. ${R}_{1} = 1/{g}_{m13}$ 7.3-1.
<table><tr><td/><td>Fig. 7.3-3</td><td>Fig. 7.3-5</td><td>Fig. 7.3-6</td><td>Fig. 7.3-8</td><td>Fig. 7.3-11</td></tr><tr><td>Noise</td><td>Good</td><td>Good</td><td>Poor</td><td>Poor</td><td>Poor</td></tr><tr><td>PSRR</td><td>Poor</td><td>Poor</td><td>Good</td><td>Good</td><td>Good</td></tr><tr><td>ICMR</td><td/><td/><td/><td/><td/></tr><tr><td>${V}_{ic}\left( \max \right)$</td><td>${V}_{DD} - {V}_{ON}$</td><td>${V}_{DD} - {V}_{ON}$</td><td>${V}_{DD} - {V}_{ON} + {V}_{T}$</td><td>${V}_{DD} - {V}_{ON} + {V}_{T}$</td><td>${V}_{DD} - {V}_{ON}$</td></tr><tr><td>${V}_{ic}\left( \min \right)$</td><td>${V}_{SS} + 2{V}_{ON} + {V}_{T}$</td><td>${V}_{SS} + 2{V}_{ON} + {V}_{T}$</td><td>${V}_{SS} + 2{V}_{ON} + {V}_{T}$</td><td>${V}_{SS} + 2{V}_{ON} + {V}_{T}$</td><td>${V}_{SS} + 3{V}_{ON} + 2{V}_{T}$</td></tr><tr><td colspan="6">OCMR</td></tr><tr><td>${V}_{o}\left( \max \right)$</td><td>${V}_{DD} - {V}_{ON}$</td><td>${V}_{DD} - {V}_{ON}$</td><td>${V}_{DD} - 2{V}_{ON}$</td><td>${V}_{DD} - 2{V}_{ON}$</td><td>${V}_{DD} - 2{V}_{ON}$</td></tr><tr><td>${V}_{o}\left( \min \right)$</td><td>${V}_{SS} + {V}_{ON}$</td><td>${V}_{SS} + {V}_{ON}$</td><td>${V}_{SS} + 2{V}_{ON}$</td><td>${V}_{SS} + 2{V}_{ON}$</td><td>${V}_{SS} + 2{V}_{ON}$</td></tr><tr><td>SR</td><td>${I}_{SS}/{C}_{c}$</td><td>${I}_{SS}/{C}_{c}$</td><td>${I}_{SS}/{C}_{L}$</td><td>${I}_{SS}/{C}_{L}$</td><td>${I}_{SS}/{C}_{L}$</td></tr></table>
7.3-2. ${0.5}{R}_{L}$
7.3-3. For Fig. P7.3-3(a) ${A}_{v} = {3673}\mathrm{\;V}/\mathrm{V}$ , and for Fig. P7.3-3(b) ${A}_{v} = {9117}\mathrm{\;V}/\mathrm{V}$
7.3-4. $\;{A}_{vd} \approx  \left( {{g}_{m}{}^{2}{r}_{ds}{}^{2}}\right) /4$ and ${r}_{out} \approx  {r}_{ds}/2$
7.3-5. $\;{A}_{vd} \approx  \left( {{g}_{m}{}^{2}{r}_{ds}{}^{2}}\right) /2$ and ${r}_{out} \approx  {r}_{ds}/2$
7.3-6. $\;{A}_{vd} \approx  \left( {{g}_{m}{}^{2}{r}_{ds}{}^{2}}\right) /6$ and ${r}_{out} \approx  2\left( {{g}_{m}{r}_{ds}{}^{2}}\right) /3$
7.3-7. ${A}_{vd} \approx  \left( {{g}_{m}{r}_{ds}}\right) /2$ and ${r}_{out} \approx  {r}_{ds}$
7.3-8. $\;{A}_{vd} \approx  \left( {{g}_{m}{}^{2}{r}_{ds}{}^{2}}\right) /2$ and ${r}_{out} \approx  2\left( {{g}_{m}{r}_{ds}{}^{2}}\right) /3$
7.3-9. ${A}_{vd} \approx  \left( {{g}_{m}{}^{2}{r}_{ds}{}^{2}}\right) /2$ and ${r}_{out} \approx  \left( {{g}_{m}{r}_{ds}{}^{2}}\right)$
7.3-11. (a) CMFB ${LG} =  - {111.8}\mathrm{\;V}/\mathrm{V}$ . (b) CMFB ${LG} =  - {3290}\mathrm{\;V}/\mathrm{V}$
7.3-12. $\left| {LG}\right|  = \frac{{g}_{mC2}{g}_{m4}}{2{g}_{mC5}\left( {\frac{{g}_{ds4}{g}_{ds6}}{{g}_{m4}} + \frac{{g}_{ds8}{g}_{ds10}}{{g}_{m10}}}\right) }$
The compensation of the common-mode feedback loop can be done using the output load capacitor (single-ended load capacitors to ac ground).
7.3-13. ${A}_{vd} \approx  \left( {{g}_{m}{}^{3}{r}_{ds}{}^{3}}\right) /6$ and ${r}_{out} \approx  2\left( {{g}_{m}{r}_{ds}{}^{3}}\right) /3$
7.3-14. ${A}_{vd} \approx  \left( {{g}_{m}{}^{2}{r}_{ds}{}^{2}}\right) /3$ and ${r}_{out} \approx  2\left( {{g}_{m}{r}_{ds}{}^{2}}\right) /3$
7.4-1. ${A}_{v}\left( 0\right)  = {19},{508}\mathrm{\;V}/\mathrm{V},{GB} = {61.43}\mathrm{{kHz}},{SR} = {0.05}\mathrm{\;V}/\mathrm{{\mu s}}$ , and ${P}_{\text{diss }} = {1.35\mu }\mathrm{W}$
7.4-2. ${A}_{v}\left( 0\right)  = {73},{846}\mathrm{\;V}/\mathrm{V},{GB} = {122.5}\mathrm{{kHz}},{SR} = {0.1}\mathrm{\;V}/\mathrm{{\mu s}}$ , and ${P}_{\text{diss }} = {0.9\mu }\mathrm{W}.{W}_{15}/{L}_{15} = {2.02}$ and ${W}_{13}/{L}_{13} = {0.7}$ .
7.4-3. ${v}_{in}/n{V}_{t} = {0.908}$
7.4-4. ${W}_{2}/{L}_{2} = {100}$ and ${V}_{ds2} = 7\mathrm{{mV}}$
7.5-1. ${V}_{eq} \approx  {10}\mathrm{{nV}}/\sqrt{\mathrm{{Hz}}}$
7.5-2. ${f}_{c} = {150.4}\mathrm{{kHz}}$ and ${V}_{eq}\left( \mathrm{{rms}}\right)  = {4.45\mu }\mathrm{V}$ for a ${100}\mathrm{{kHz}}$ bandwidth
7.5-3. ${e}_{eq}^{2}\left( {1/f}\right)  = \frac{{14.72} \times  {10}^{-{12}}}{f}{\mathrm{\;V}}^{2}/\mathrm{{Hz}},{e}_{eq}^{2}\left( \text{Thermal}\right)  = {2.42} \times  {10}^{-{17}}{\mathrm{\;V}}^{2}/\mathrm{{Hz}}$ ,
${f}_{c} = {608}\mathrm{{kHz}}$ and ${V}_{eq}\left( \mathrm{{rms}}\right)  = {13.1}\mathrm{{nV}}/\sqrt{\mathrm{{Hz}}}$
7.5-4. ${V}_{eq}\left( \mathrm{{rms}}\right)  = {75.5\mu }\mathrm{V}$
7.5-5. ${V}_{eq}\left( {rms}\right)  = {55.73\mu }\mathrm{V}$
7.6-1. ${V}_{DD} = {0.671}\mathrm{\;V}$
7.6-2. ${V}_{DD} = {0.411}\mathrm{\;V}$
7.6-3. ${V}_{DD} = {0.711}\mathrm{\;V}$
7.6-4. ${V}_{onn} = {1.578}\mathrm{\;V}$ and ${V}_{onp} = {0.57}\mathrm{\;V}$
7.6-7. Interchange ${I}_{VBE}$ and ${I}_{PTAT}$ in Fig. 7.6-16(a). Add the two correction terms, ${I}_{NL}$ and ${K}_{3}{I}_{NL1}$ , to the uncorrected ${I}_{VBE} + {K}_{1}{I}_{PTAT}$ to achieve the desired temperature compensation.
7.6-8. ${p}_{2} =  - {20}\mathrm{{MHz}},{p}_{6} =  - {1.2}\mathrm{{GHz}}$ , and ${p}_{3} =  - {101}\mathrm{{MHz}} - {GB} = {58}\mathrm{{MHz}}$ and ${C}_{c} = 2\mathrm{{pF}}$ .
7.6-9. ICMR $= {0.9}\mathrm{\;V}$
7.6-10. ICMR $= {0.8}\mathrm{\;V}$
## Chapter 8
8.1-3. ${t}_{p} = {500}\mathrm{\;{ns}}$
8.1-4. ${V}_{in} > {100.05}\mathrm{{mV}}$
8.2-1. ${V}_{OH} = {2.43}\mathrm{\;V};{V}_{OL} =  - {V}_{SS} =  - {2.5}\mathrm{\;V}$
${V}_{in}\left( \min \right)  = {1.5}\mathrm{{mV}};{p}_{1} = {1.074}\mathrm{{MHz}};{p}_{1} = {0.67}\mathrm{{MHz}}$
8.2-2. Slew rate should be greater than ${36.79}\mathrm{\;V}/\mu \mathrm{s}$
8.2-3. When ${V}_{in} = {10}\mathrm{{mV}}, k = {15.576}$ and ${t}_{p} = {35.8}\mathrm{\;{ns}}$
When ${V}_{in} = {100}\mathrm{{mV}}$ (assuming no slewing), $k = {155.76}$ and ${t}_{p} = {11.3}\mathrm{{ns}}$
When ${V}_{in} = 1\mathrm{\;V}$ (assuming no slewing), $k = {1557.6}$ and ${t}_{p} = {3.58}\mathrm{\;{ns}}$
8.2-5. ${V}_{TRP} = {1.89}\mathrm{\;V};{V}_{TRP}\left( \max \right)  = {3.22}\mathrm{\;V};{V}_{TRP}\left( \min \right)  = {0.39}\mathrm{\;V}$
8.2-6. The total propagation delay is ${133.2}\mathrm{{ns}}$ .
8.2-7. The total output fall time is ${79.8}\mathrm{\;{ns}}$ , and the total output rise time is ${9.5}\mathrm{\;{ns}}$ ; thus, the total propagation time delay of the comparator is ${44.7}\mathrm{{ns}}$ .
8.2-8. ${t}_{fo1} = 6\mathrm{{ns}};{t}_{r,\text{ out }} = {2.36}\mathrm{{ns}};{t}_{p1} = {8.36}\mathrm{{ns}};{t}_{ro1} = {27.3}\mathrm{{ns}}$
${t}_{f,\text{ out }} = {131.6}\mathrm{\;{ns}};{t}_{p2} = {158.9}\mathrm{\;{ns}}$
The average propagation delay is ${83.63}\mathrm{\;{ns}}$ .
8.2-9. ${\left( W/L\right) }_{6} = {120};{\left( W/L\right) }_{7} = {55};{\left( W/L\right) }_{1} = {\left( W/L\right) }_{2} = {12};{\left( W/L\right) }_{5} = {16};{\left( W/L\right) }_{3} = {16} = {\left( W/L\right) }_{4}$
8.2-10. (a) ${t}_{p} = {0.513\mu }\mathrm{s}$ ,(b) ${t}_{p} = {0.100\mu }\mathrm{s}$ , and (c) ${t}_{p} = {0.100\mu }\mathrm{s}$
8.2-11. ${t}_{p} = {125}\mathrm{\;{ns}}$
8.2-12. ${\left( W/L\right) }_{1} = {\left( W/L\right) }_{2} = {4.5};{I}_{5} = {30\mu }\mathrm{A}$
${\mathrm{V}}_{\text{dsat5 }} = {0.2}\mathrm{\;V}$ , thus ${\left( W/L\right) }_{3} = {\left( W/L\right) }_{4} = {15}$
${\left( W/L\right) }_{7} = {31.5},{\left( W/L\right) }_{6} = {210}$ , and ${I}_{7} = {210\mu }\mathrm{A}$
${V}_{TRP2} = {23.1}\mathrm{\;V}$
${t}_{fo1} = {15}\mathrm{\;{ns}};{t}_{r,\text{ out }} = {2.4}\mathrm{\;{ns}};{t}_{p1} = {17.4}\mathrm{\;{ns}};{t}_{ro1} = {35}\mathrm{\;{ns}}$
${t}_{f,\text{ out }} = {21.4}\mathrm{\;{ns}};{t}_{p2} = {56.4}\mathrm{\;{ns}}$
The average propagation delay is ${36.9}\mathrm{\;{ns}}$ , which is well below ${1000}\mathrm{\;{ns}}$ .
8.3-1. ${t}_{p} = {20}\mathrm{\;{ns}}$
8.3-2. $\left| {p}_{1}\right|  = {10318}\mathrm{{rps}}$ . The maximum slope is ${0.77}\mathrm{\;V}/\mathrm{{\mu s}}$ and since the ${SR} = {20}\mathrm{\;V}/\mathrm{{\mu s}}$ , the comparator does not slew. The propagation delay time is ${t}_{p} = {3.3\mu }\mathrm{s}$ .
8.3-3. The total gain is ${5.052} \times  {10}^{9}\mathrm{\;V}/\mathrm{V}$ and ${t}_{p} = {57.5}\mathrm{{ps}}$ .
8.3-4. $S{R}^{ - } =  - {16}\mathrm{\;V}/\mu$ s and $S{R}^{ + } = {48.4}\mathrm{\;V}/\mu$ s
8.4-1. $T = {0.47\mu }\mathrm{s}$ ; as $t \rightarrow  \infty {v}_{\text{out }}\left( t\right)  = {0.999}{V}_{OS}$
8.4-2. ${R}_{2} = 2{R}_{1} = {200}\mathrm{k}\Omega ;{V}_{REF} = 2/3\mathrm{\;V}$
8.4-3. ${R}_{2} = {R}_{1} = {100}\mathrm{k}\Omega$
8.4-4. $\left| {LG}\right|  = {22.6}$
8.4-5. ${R}_{2} = 3{R}_{1} = {200}\mathrm{k}\Omega ;{V}_{REF} = 0\mathrm{\;V}$
8.4-6. ${V}_{TRP}^{ + } = {0.215}\mathrm{\;V};{V}_{TRP}^{ - } =  - {0.215}\mathrm{\;V}$
8.4-7. There are two possibilities that could account for the differences. The first is due to the simple Sah model, which does not model the saturation voltage very well. This voltage is the point at which transistors make the transition from active to saturation and is an important part of the development of the trip points. The second is the neglect of the bulk effects on transistors M1 and M2.
8.5-1.
<table><tr><td/><td>Advantages</td><td>Disadvantages</td></tr><tr><td rowspan="3">Fig. 8.5-1</td><td>Can remove input-offset voltage</td><td>Requires switches</td></tr><tr><td>Positive terminal on ground</td><td>Charge feedthrough</td></tr><tr><td>eliminates need for good ICMR</td><td>Must be stable in autozero mode</td></tr><tr><td>Open-loop</td><td>Stability not of concern</td><td>Requires good ICMR</td></tr><tr><td>comparator</td><td>Continuous time operation</td><td>Can't remove input-offset voltage</td></tr></table>
8.5-2. The NMOS latch would be faster because it has a larger small-signal loop gain.
8.5-3. For $\Delta {V}_{in} = {0.01}\left( {{V}_{OH} - {V}_{OL}}\right) ,{t}_{p} = {422}\mathrm{\;{ns}}$
For $\Delta {V}_{in} = {0.1}\left( {{V}_{OH} - {V}_{OL}}\right) ,{t}_{p} = {174}\mathrm{\;{ns}}$
8.5-4. For $\Delta {V}_{in} = {0.01}\left( {{V}_{OH} - {V}_{OL}}\right) ,{t}_{p} = {188}\mathrm{\;{ns}}$
For $\Delta {V}_{in} = {0.1}\left( {{V}_{OH} - {V}_{OL}}\right) ,{t}_{p} = {76.8}\mathrm{\;{ns}}$ 8.5-6.
<table><tr><td/><td>Advantages</td><td>Disadvantages</td></tr><tr><td>Fig. 8.5-3</td><td>Work with smaller power supply</td><td>Class A output—can't source an sink with the same current-slow</td></tr><tr><td>Fig. 8.5-8</td><td>Push-pull is good for sinking and sourcing a lot of current-fast</td><td>Needs larger power supply</td></tr></table>
8.5-7. $\left| {V}_{OS}\right|  = {0.314}\mathrm{\;V}$
8.6-1. (a) The closed-loop gain is -25 . Thus, the $- 3\mathrm{\;{dB}}$ bandwidth becomes for $\omega  - 3\mathrm{\;{dB}} = {400}$ krad/s.
(b) The closed-loop gain is -5 . Thus, the $- 3\mathrm{\;{dB}}$ bandwidth becomes for $\omega  - 3\mathrm{\;{dB}} = {2000}$ krad/s.
8.6-2. ${A}_{v} = {6.6}\mathrm{\;V}/\mathrm{V};{p1} = {5.15}\mathrm{{MHz}}$
8.6-3. ${A}_{v} = {6.873}\mathrm{\;V}/\mathrm{V};f - 3\mathrm{\;{dB}} = {2.62}\mathrm{{MHz}}$
8.6-4. The minimum delay is ${20.08}\mathrm{\;{ns}}$ and if it is achieved then $x = 1/8$ .
8.6-5. ${t}_{p} = {t}_{1} + {t}_{2} = {3.13}\mathrm{{ns}} + {16.095}\mathrm{{ns}} = {19.226}\mathrm{{ns}}$
8.6-6. ${t}_{p} = {t}_{1} + {t}_{2} = {1.131}\mathrm{{ns}} + {0.916}\mathrm{{ns}} = {2.047}\mathrm{{ns}}$
8.6-7. ${t}_{p} = {t}_{1} + {t}_{2} = {3.16}\mathrm{{ns}} + {1.477}\mathrm{{ns}} = {4.637}\mathrm{{ns}}$
## Chapter 9
9.1-4. INL: $+ 1\mathrm{{LSB}}, - {2.5}\mathrm{{LSB}},\mathrm{{DNL}} :  + {1.5}\mathrm{{LSB}}, - 2\mathrm{{LSB}}$ . The converter is not monotonic.
9.1-5. SNR $= {54}\mathrm{\;{dB}}$
9.1-6. Rms noise $= {21.6\mu }\mathrm{V}$ ; fractional temperature coefficient $= {0.3052}\mathrm{{ppm}}/(\mathrm{C}$
9.2-1. ${I}_{OUT} = {I}_{O},\frac{{I}_{1}}{2},\frac{{I}_{2}}{4},\frac{{I}_{4}}{8}$
9.2-2. (a) Tolerence of $i$ th current sink is $\frac{{2}^{i - N}}{2} \times  {100}\%$
(b) Tolerence of $i$ th current sink is $\frac{{2}^{i - N}}{2N} \times  {100}\%$
9.2-3. (a) ${v}_{\text{out }} = \frac{7}{8} \times$ ideal characteristic
(b) Gain error of $1/{16}$ and offset of $\frac{{V}_{REF}}{15}$
(c) ${INL} =  + {0.5LSB}$ and $- {1.0LSB},{DNL} =  + {0.5LSB}$ and $- {1.5LSB}$ . This converter is not monotonic.
9.2-4. (a) ${INL} =  + {0.5LSB}$ and $- {2.0LSB},{DNL} =  + {0.5LSB}$ and $- {1.5LSB}$
(b) For ${0010},{R}_{3} = \frac{32}{5}{R}_{0}$ ; for ${1000},{R}_{3} = 2{R}_{0}$
9.2-5. (a) ${V}_{OS} = {0.01613}{V}_{REF}$ . (b) $A \geq  {56.2}\mathrm{\;V}/\mathrm{V}$ . (c) $T = {1.0488\mu }\mathrm{s}$ .
9.2-6. (a) $I = {500\mu }\mathrm{A}$ . (b) ${GB} = {0.496}\mathrm{{MHz}},{SR} = {0.5}\mathrm{\;V}/\mu \mathrm{s}$ .
9.2-7. (a) ${FS} = {RI}\left( {1 - \frac{1}{{2}^{N}}}\right)$ . (b) $I = \frac{{V}_{REF}}{R\left( {1 - \frac{1}{{2}^{N}}}\right) }$
(c) $N = {12}$ . (d) $f = {87.4} \times  {10}^{3}$ conversions/s.
9.2-8. Time for conversion $= {6\mu }\mathrm{s}$
9.2-9. ${\Delta C}/C \leq  {0.0488}\%$
9.2-10. (a) ${v}_{\text{out }} = \left( \frac{1}{1 + \frac{{C}_{L}}{2C}}\right) \left( {\frac{{b}_{0}}{2} + \frac{{b}_{1}}{4} + \ldots  + \frac{{b}_{N - 2}}{{2}^{N - 1}} + \frac{{b}_{N - 1}}{{2}^{N}}}\right) {V}_{\text{REF }}$
(b) If ${C}_{L} <  < {2C}$ , the error is a gain error. (c) ${C}_{L} \leq  \frac{C}{{2}^{N}}$ .
9.2-11. ${v}_{OUT} =  - {V}_{REF}\mathop{\sum }\limits_{n}^{{i = 1}}\frac{{b}_{i}}{{2}^{i}}\left( {{b}_{0} = 1}\right)$ and ${v}_{OUT} =  - {V}_{REF}\mathop{\sum }\limits_{n}^{{i = 1}}\frac{{b}_{i}}{{2}^{i}}\left( {{b}_{0} = 0}\right)$
With amplifier offset not equal to zero
${v}_{OUT} =  - \left( {{V}_{REF} - {V}_{OS}}\right) \mathop{\sum }\limits_{n}^{{i = 1}}\frac{{b}_{i}}{{2}^{i}}\left( {{b}_{0} = 1}\right)$
${v}_{OUT} = \left( {{V}_{REF} - {V}_{OS}}\right) \mathop{\sum }\limits_{n}^{\substack{i = 1 \\  {b}_{i} }}\left( {{b}_{0} = 0}\right)$
${V}_{OS}$ causes a gain error.
9.2-13. The worst case occurs when the ${MSB}$ and all other bits switch oppositely. $+ {DNL} = {1.275LSB}$ and $- {DNL} =  - {1.275LSB}$ .
9.2-14. (a) ${C}_{X} = {2}^{NC}$ . (c) Max component spread $= {2}^{N}$ . (d) This DAC should be fast. (e) Yes. (f) $N = 7$ .
9.2-15. (a) $A = {1022}$ . (b) $T = {1.9857\mu }\mathrm{s}$ .
9.2-16. (a) ${C}_{F} = {2C}$ . (b) ${v}_{\text{out }} = \left( {\frac{{b}_{0}}{2} + \frac{{b}_{1}}{4} + \frac{{b}_{2}}{8} + \frac{{b}_{3}}{16}}\right) {V}_{REF}$ .
(c) Advantages: Smaller area, better accuracy and auto-zeros the offset of the op amp. Disadvantages: Has floating nodes, parasitics will deteriorate the accuracy, not monotonic, and requires a two-phase nonoverlapping clock.
9.3-1. $k = 2 : {INL} =  + {3LSB}$ and ${0LSB},{DNL} =  + {1LSB}$ and $- {3LSB}$
$k = 6 : {INL} =  + {0LSB}$ and $- {1LSB},{DNL} =  + {1LSB}$ and $- {0.3333LSB}$
9.3-2. $k = 3 : {INL} =  + {1LSB}$ and ${0LSB},{DNL} =  + {0.33LSB}$ and $- {1LSB}$
$k = 5 : {INL} =  + {0LSB}$ and $- {0.6LSB},{DNL} =  + {0.6LSB}$ and $- {0.2LSB}$
9.3-3. $k = 5 : {INL} =  + {0.75LSB}$ and $- {3LSB},{DNL} =  + {0.25LSB}$ and $- {1.75LSB}$
9.3-4. WC tolerance $=  \pm  {7.143}\%$
9.3-5. (a) $k = 4$ . (b) $k = 6$ . (c) $k = {2.4}$ .
9.3-7. ${R}_{x} = {3R}$
9.3-8. (a) ${R}_{8} = {16R}$ and ${R}_{9} = R$ . (b) ${15.48368R} \leq  {R}_{8} \leq  {16.5517R}$ . (c) ${R}_{9} < \frac{15}{16}R$ .
9.3-10. (a) ${C}_{X} = \frac{8C}{7}$ . (b) ${v}_{OUT} = \frac{{V}_{REF}}{8}\left( {1 - \frac{7\varepsilon }{64}}\right) \left\lbrack  {\mathop{\sum }\limits_{{i = 0}}^{2}{b}_{i}{2}^{2 - i} + \left( {1 + \frac{7\varepsilon }{8}}\right) \mathop{\sum }\limits_{{i = 3}}^{5}\frac{{b}_{i}{2}^{5 - i}}{8}}\right\rbrack$ .
(c) $\frac{\Delta {C}_{x}}{{C}_{x}} \leq  {1.685}\%$ .
9.3-11. ${f}_{\text{clock }} = \frac{1}{{T}_{\text{clock }}} = {283}\mathrm{{kHz}}$
9.3-12. $\frac{{v}_{OUT}\left( {\Phi }_{2}\right) }{{V}_{REF}} = \frac{{b}_{1}}{2} + \mathrm{f}\left( {{b}_{2},4}\right)  + \mathrm{f}\left( {{b}_{3},2}\right)  + \mathrm{f}\left( {{b}_{4},4}\right)$ . INL $=  + 3$ LSB and 0LSB, DNL $=  + 1$ LSB
and -3LSB. The converter is not monotonic.
9.3-13. (a) ${INL}\left( R\right)  = {2}^{M - 1}\left( \frac{\Delta R}{R}\right) {LSB}\mathrm{\;s}$ and ${DNL}\left( R\right)  =  \pm  {2}^{K}\left( \frac{\Delta R}{R}\right) {LSB}\mathrm{\;s}$
$$
\operatorname{INL}\left( C\right)  =  \pm  {2}^{K - 1}\left( \frac{\Delta C}{C}\right) {LSB}\mathrm{\;s}\text{ and }\operatorname{DNL}\left( C\right)  = \left( \frac{{2}^{K}{\Delta C}}{C}\right) {LSB}\mathrm{\;s}
$$
$$
{INL} = {INL}\left( R\right)  + {INL}\left( C\right)  = {2}^{M - 1}\left( \frac{\Delta R}{R}\right)  + {2}^{N - 1}\left( \frac{\Delta C}{C}\right)
$$
$$
{DNL} = {DNL}\left( R\right)  + {DNL}\left( C\right)  = {2}^{K}\left( {\frac{\Delta R}{R} + \frac{\Delta C}{C}}\right)
$$
$$
\text{(b)}{INL}\left( R\right)  = {2}^{N - 1}\left( \frac{\Delta R}{R}\right) {LSB}\text{s and}{DNL}\left( R\right)  = \left( \frac{\pm {\Delta R}}{R}\right) {LSB}\text{s}
$$
$$
\operatorname{INL}\left( C\right)  =  \pm  {2}^{N - 1}\left( \frac{\Delta C}{C}\right) {LSB}\mathrm{\;s}\text{and}\operatorname{DNL}\left( C\right)  = {2}^{N}\left( \frac{\Delta C}{C}\right) {LSB}\mathrm{\;s}
$$
$$
{INL} = {INL}\left( R\right)  + {INL}\left( C\right)  = {2}^{N - 1}\left( {\frac{\Delta R}{R} + \frac{\Delta C}{C}}\right) {LSB}\mathrm{\;s}
$$
$$
{DNL} = {DNL}\left( R\right)  + {DNL}\left( C\right)  = \left( {{2}^{N - 1}\frac{\Delta C}{C} + \frac{\Delta R}{R}}\right) {LSB}\mathrm{\;s}
$$
9.3-14. The DAC combination where the MSBs are charge scaling and the LSBs are voltage scaling
gives the most bits when both ${INL}$ and ${DNL}$ are ${1LSB}$ . The number of bits is $n = 9$ with $m =$ 7 bits of charge scaling for the ${MSB}$ DAC and $k = 2$ bits of voltage scaling for the ${LSB}$ DAC.
9.3-15. ${v}_{x} = \frac{2}{5}{v}_{\text{Analog }} - \frac{2}{5}{V}_{1} + \frac{{V}_{2}}{10} - \frac{{V}_{\text{REF }}}{16}$ . For ABCD = 1011 and ${v}_{\text{analog }} = {0.8}{V}_{\text{REF }}$ , the comparator output will be low.
9.3-16. Errors are (1) Op amp/comparator - gain, ${GB},{SR}$ , settling time (offset not a problem). (2) Resistor and capacitor matching. (3) Switch resistance and feedthrough. (4) Parasitic capacitances. (5) Reference accuracy and stability.
9.4-1. ${v}_{C1} = {v}_{C2} = {0.6340}{V}_{REF}$ .
9.4-2. The output voltage is ${0.6340}{V}_{REF}$ .
9.4-3. Error occurs at the third bit.
9.4-4. ${V}_{\text{out }} = {0.60156}{V}_{REF}$ . For $k = {0.55},{V}_{\text{out }} = {0.3066}{V}_{REF}$ .
9.4-6. INL $=  + 1\mathrm{{LSB}}$ and $- {0.5}\mathrm{{LSB}},\mathrm{{DNL}} =  + {0.5}\mathrm{{LSB}}$ and $- {1.5}\mathrm{{LSB}}$ . DAC is nonmonotonic.
9.4-7. INL $=  + 0$ LSB and-1.1875LSB, DNL $=  + {1.1875}$ LSB and-0.8125LSB
9.4-9. ${0.205} \leq  {\Delta A} \leq  {0.590}$
9.4-10. ${0.41} \leq  {\Delta A} \leq  {0.77}$
9.4-11. At 4th bit conversion
9.4-12. At 4th bit conversion
9.5-1. Max ${DNL} =  \pm  2\;{LSB}$
9.5-2. (a) ${INLA} =  + {1LSB}, - {INLA} =  - {1.5LSB};{DNLA} =  + {0.5LSB}, - {DNLA} =  - {1.5LSB}$
(b) ${INLD} =  + {2LSB}, - {INLD} =  - {1LSB};{DNLD} =  + {1LSB}, - {DNLD} =  - {2LSB}$
9.5-3. (a) ${INL} =  + {3LSB}$ and $- {3LSB},{DNL} =  + {2LSB}$ and $- {3LSB}$ . (b) ${WCINL} =  \pm  {0.5LSB}$ .
9.5-4. $N = 8$
9.5-5. $N = 9$
9.6-1. For ${v}_{in}^{ * } = {0.25}{V}_{REF} \rightarrow$ Clock periods $= {1.25}{N}_{REF}$
For ${v}_{\text{in }}^{ * } = {0.7}{V}_{REF} \rightarrow$ Clock periods $= {1.7}{N}_{REF}$
9.7-1. 10110011
9.7-2.
<table><tr><td>Clock Period</td><td>${B}_{1}{B}_{2}{B}_{3}{B}_{4}$</td><td>Guessed ${D}_{1}{D}_{2}{D}_{3}{D}_{4}$</td><td>${V}_{out}$</td><td>Comparator Output</td><td>Actual ${D}_{1}{D}_{2}{D}_{3}{D}_{4}$</td></tr><tr><td>1</td><td>1000</td><td>1000</td><td>2.5 V</td><td>1</td><td>1000</td></tr><tr><td>2</td><td>0100</td><td>1100</td><td>3.75 V</td><td>0</td><td>1000</td></tr><tr><td>3</td><td>0010</td><td>1010</td><td>${3.125}\mathrm{\;V}$</td><td>0</td><td>1000</td></tr><tr><td>4</td><td>0001</td><td>1001</td><td>${2.8125}\mathrm{\;V}$</td><td>1</td><td>$\begin{array}{llll} 1 & 0 & 0 & 1 \end{array}$</td></tr></table>
9.7-3. 1001
9.7-4. 111001
9.7-5. 10101001
9.7-6. 10100111
9.7-7. (a) Minimum $\epsilon  = {0.0178}$ . (b) minimum ${V}_{OS} =  \pm  {0.2}\mathrm{\;V}$ .
9.7-8. Error at 7th bit
9.7-9. Error occurs at 4th bit when ${v}_{\text{in }}^{ * } = {0.1}{V}_{REF}$ and offset voltage $= {0.1}\mathrm{\;V}$
9.7-10. (a) 10001101. (b) 10001011 and the 7th bit is in error.
9.7-11. (a) $\epsilon  \leq  {0.0417}$ . (b) ${V}_{OS} \leq  {0.2}\mathrm{\;V}$ .
9.7-12. Error occurs in the 4th bit.
9.7-13. (a) 01001100. (b) ${V}_{\text{analog }} = {0.296875}{V}_{REF}$ . (c) Never go smaller than $\pm  {0.2}{V}_{REF}$ .
9.8-2. 1110000
9.8-3. ${C}_{1} = C/3,{C}_{2} = C,{C}_{3} = {3C}$
<table><tr><td>ADC</td><td>Comp. Offset</td><td>Conv. Speed</td><td>Accuracy</td><td>Other Aspects</td></tr><tr><td>Conv. Flash ADC</td><td>$\leq   \pm  {0.5LSB}$</td><td>Fast</td><td>Poor</td><td>Equal $R$ s</td></tr><tr><td>Proposed ADC</td><td>Autozeroed</td><td>Faster, comp. is simpler</td><td>Better</td><td>Unequal $C\mathrm{\;s}$ , No CMRR problems</td></tr></table>
9.8-4. ${R}_{1} = 4/{3R},{R}_{2} = {2R},{R}_{3} = {4R}$
<table><tr><td>Faster— ${V}_{in}^{ * }$ directly connected</td><td>Conventional Flash ADC</td><td>Proposed Flash ADC</td></tr><tr><td rowspan="3">Advantages</td><td>Less resistor area</td><td>Insensitive to CM effects</td></tr><tr><td>Guaranteed monotonic</td><td>Positive input grounded</td></tr><tr><td>All resistors are equal ${V}_{in}^{ * }$ does not supply current</td><td>No high impedance nodes, fast</td></tr><tr><td>Disadvantages</td><td>Sensitive to CM effects High impedance nodes-only a disadvantage if ${V}_{REF}$ changes</td><td>More resistor area Can be nonmonotonic Resistor spread of ${2}^{N}$ ${V}_{in} *$ must supply current More noise because more resistors</td></tr></table>
9.8-5. Max conversion rate $= {0.356} \times  {10}^{6}$ samples per second
9.8-6. (a) $N = 7$ ,(b) $N = 5$ .
9.8-7. $\frac{\Delta R}{R} < \frac{1}{8} = {12.5}\%$
9.8-8. All delays are equal and are ${RC}$ .
9.8-9. 21 comparators needed for a 7-bit flash
9.8-11. ${INL} =  + {3LSB}$ and $- {1LSB};{DNL} =  + {2LSB}$ and ${0LSB}$ ; missing codes are 0111,1010, and 1011. This ADC is monotonic.
9.8-12. $+ {INL} = {3LSB}, - {INL} = {0LSB}; + {DNL} = {1LSB}, - {DNL} = {0LSB}$ . This ADC is monotonic.
9.8-13. INL $=  + 1\mathrm{{LSB}}$ and $- 0\mathrm{{LSB}};\mathrm{{DNL}} =  \pm  0\mathrm{{LSB}}$
9.8-14. (a) $\Delta {V}_{REF} = \frac{\pm {V}_{REF}}{24}$ . (b) $\Delta {V}_{REF} = \frac{\pm {V}_{REF}}{12}$ .
9.8-15. $\frac{\Delta k}{k} =  \pm  {12.5}\%$
9.8-16. ${INL} =  \pm  {1LSB};{DNL} =  + {1LSB} =  - {2LSB}$ . The ADC is not monotonic.
9.9-1. For $k = 1{\omega }_{-3\mathrm{{dB}}} = {1.476}\mathrm{{MHz}}$ ; for $k = {0.5}{\omega }_{-3\mathrm{{dB}}} = {0.654}\mathrm{{MHz}}$
9.9-2. (a) $L \geq  3$ . (b) $b = 3$
9.9-4. ${f}_{\mathrm{B}} = {53.74}\mathrm{{kHz}}$
9.9-5. (a) ${OSR} \geq  {55.26}$ . (b) ${OSR} \geq  {45.33}$ . (c) ${OSR} \geq  {81}$ .
9.9-6. (a) $\frac{Y\left( z\right) }{Q\left( z\right) } = {\left( 1 - {z}^{-1}\right) }^{2}$ . (b) ${f}_{B} = {70.909}\mathrm{{kHz}}$
9.9-7. ${Y}_{o}\left( z\right)  = {z}^{-1}X\left( z\right)  + {\left( 1 - {z}^{-1}\right) }^{2}{Q}_{2}\left( z\right)$
9.9-8. (a) ${NT}{F}_{Q}\left( z\right)  = {\left( 1 - {z}^{-1}\right) }^{3}$ . (b) ${f}_{B} \leq  {46.78}\mathrm{{kHz}}$ or ${f}_{B} = {19.5}\mathrm{{kHz}}$ depending on the assumptions.
9.9-9. (a) ${DR} = {71.64}\mathrm{\;{dB}}$ . (b) ${DR} = {77.64}\mathrm{\;{dB}}$ .
9.9-10. ${f}_{B} = {15.47}\mathrm{{kHz}}$
9.9-11. ${f}_{B} \leq  {189}\mathrm{{kHz}}$ APPENDIX A
## Circuit Analysis for Analog Circuit Design
Tthe objective of this appendix is to provide a systematic approach for analyzing analog circuits. Since much design is done by analysis, this approach will be very useful in the study of analog integrated-circuit design. We will begin with a brief introduction to modeling devices from a general viewpoint, followed by several network-analysis techniques useful in analyzing analog circuits. These techniques include mesh and nodal analysis, superposition, substitution of sources, network reduction, and Miller simplification. Although there are other techniques, these are the ones used most often in analog circuit analysis.
Modeling is an important part of both analog circuit analysis and design. Modeling is defined as the process by which an electronic component/device is characterized in a manner that will allow analysis by either mathematical or graphical methods. Most electronic devices have at least three terminals and the voltage-current relationships among terminals are nonlinear. As a consequence, models are generally categorized as large-signal and small-signal models.
Large-signal models represent the nonlinear behavior of the electronic device. Small-signal models are characterized by having linear relationships between the terminal voltages and currents. Typically, a small-signal model is only valid for limited values of amplitude. In fact, the signal amplitude is decreased until the nonlinear relationships can adequately be approximated by linear relationships. However, the advantage of the small-signal model is that analysis is greatly simplified by the inherent linearity between the terminal voltages and currents. In either case, models are only representative of the actual device and may fail to accurately predict the device performance in a given range of terminal voltages and currents.
The most important principle in analyzing analog circuits is to keep the approach as simple as possible. This is particularly important when the analysis is used to assist the design. Complicated expressions do not offer any insight into the relationships between performance and the parameters that determine the performance, so the simplest possible model should always be used. The analysis problem should be broken into parts if the resulting parts are simpler to analyze than the whole. The designer can always turn to computer simulation for a more detailed analysis when necessary, but in using the computer, the designer needs to know whether or not the results make sense, yet another reason for learning to make simple hand calculations.

Figure A.1-1 Chain-type analysis.
### A.1 Analytic Techniques
In the following analytic techniques, only linear circuits will be considered. This means that the techniques apply only to small-signal models and circuits. This does not represent a serious limitation since much of the performance of analog circuits can be characterized by small-signal analysis.
The first analysis technique to be discussed is the systematic method of writing a set of linear equations that describe the circuit. In many cases, the analog small-signal circuit can quickly be analyzed by a simple chain-type calculation. This is always the case when there is only one signal path from the input to the output. As an example consider Fig. A.1-1. If we want to find ${v}_{\text{out }}/{v}_{\text{in }}$ it is a simple matter to express this transfer function in a chain form as
$$
\frac{{v}_{\text{out }}}{{v}_{\text{in }}} = \left( \frac{{v}_{\text{out }}}{{v}_{1}}\right) \left( \frac{{v}_{1}}{{v}_{\text{in }}}\right)  = \left( {-{g}_{m}{R}_{3}}\right) \left( \frac{{R}_{2}}{{R}_{1} + {R}_{2}}\right)  = \frac{-{g}_{m}{R}_{2}{R}_{3}}{{R}_{1} + {R}_{2}} \tag{A.1-1}
$$
In more complex circuits, there is generally more than one signal path from the input to the output. In that case, a more systematic method of writing a set of linear equations that describe the circuit is required. Two well-known methods use nodal and mesh equations. They are based on Kirchhoff's laws, which state the sum of the currents flowing into a node must be equal to zero and the sum of the voltage drops around a mesh must be equal to zero. Two examples will follow that illustrate the application of these two familiar approaches.
---
Example A. 1-1
---
## Nodal Analysis of an Analog Circuit
Consider the circuit of Fig. A.1-2. The objective is to find ${v}_{\text{out }}/{i}_{\text{in }}$ .

Figure A.1-2 Nodal analysis.
## SOLUTION
Using the techniques of nodal analysis, we may write two equations that represent the sum of the currents at nodes A and B. These equations are
$$
{i}_{\text{in }} = \left( {{G}_{1} + {G}_{2}}\right) {v}_{1} - {G}_{2}{v}_{\text{out }} \tag{A.1-2}
$$
and
$$
0 = \left( {{g}_{m} - {G}_{2}}\right) {v}_{1} + \left( {{G}_{2} + {G}_{3}}\right) {v}_{\text{out }} \tag{A.1-3}
$$
Note that ${G}_{i} = 1/{R}_{i}$ in order to simplify the equations. We may find ${v}_{\text{out }}$ by using Cramer’s approach to solving matrix equations, giving
$$
{v}_{\text{out }} = \frac{\left| \begin{array}{ll} {G}_{1} + {G}_{2} & {i}_{\text{in }} \\  {g}_{m} - {G}_{2} & 0 \end{array}\right| }{\left| \begin{array}{ll} {G}_{1} + {G}_{2} &  - {G}_{2} \\  {g}_{m} - {G}_{2} & {G}_{2} + {G}_{3} \end{array}\right| } = \frac{\left( {{G}_{2} - {g}_{m}}\right) {i}_{\text{in }}}{{G}_{1}{G}_{2} + {G}_{1}{G}_{3} + {G}_{2}{G}_{3} + {g}_{m}{G}_{2}} \tag{A.1-4}
$$
The desired transfer function is given as
$$
\frac{{v}_{\text{out }}}{{v}_{\text{in }}} = \frac{{G}_{2} - {g}_{m}}{{G}_{1}{G}_{2} + {G}_{1}{G}_{3} + {G}_{2}{G}_{3} + {g}_{m}{G}_{2}} \tag{A.1-5}
$$
---
Example A. 1-2
---
## Mesh Analysis of an Analog Circuit
Consider the circuit of Fig. A.1-3. We wish to solve for the transfer function, ${v}_{\text{out }}/{v}_{\text{in }}$ .

Figure A.1-3 Mesh analysis.
## SOLUTION
Two mesh currents, ${i}_{a}$ and ${i}_{b}$ , have been identified on the circuit. Note that the choice of meshes can be selected to avoid solving for both ${i}_{a}$ and ${i}_{b}$ . Summing the voltage drops around these two meshes gives the following two mesh equations:
$$
{v}_{\text{in }} = \left( {{R}_{1} + {R}_{2}}\right) {i}_{a} + {R}_{1}{i}_{b} \tag{A.1-6}
$$
$$
{v}_{\text{in }} = \left( {{R}_{1} - {r}_{m}}\right) {i}_{a} + \left( {{R}_{1} + {R}_{3}}\right) {i}_{b} \tag{A.1-7}
$$
Using Cramer’s approach to solve for ${i}_{a}$ gives
$$
{i}_{a} = \frac{\left| \begin{matrix} {v}_{\text{in }} & {R}_{1} \\  {v}_{\text{in }} & {R}_{1} + {R}_{3} \end{matrix}\right| }{\left| \begin{matrix} {R}_{1} + {R}_{2} & {R}_{1} \\  {R}_{1} - {r}_{m} & {R}_{1} + {R}_{3} \end{matrix}\right| } = \frac{{R}_{3}{v}_{\text{in }}}{{R}_{1}{R}_{2} + {R}_{1}{R}_{3} + {R}_{2}{R}_{3} + {r}_{m}{R}_{1}} \tag{A.1-8}
$$
Since ${v}_{\text{out }} =  - {r}_{m}{i}_{a}$ , we can solve for ${v}_{\text{out }}/{v}_{\text{in }}$ as
$$
\frac{{v}_{\text{out }}}{{v}_{\text{in }}} = \frac{-{r}_{m}{R}_{3}}{{R}_{1}{R}_{2} + {R}_{1}{R}_{3} + {R}_{2}{R}_{3} + {r}_{m}{R}_{1}} \tag{A.1-9}
$$
These two examples illustrate the use of the nodal and mesh equations to analyze circuits. In some cases, a combination of these two approaches may be used to analyze a circuit. This is illustrated in the following example.
---
Example A. 1-3
---
## Combined Approach to Analyzing an Analog Circuit
The circuit shown in Fig. A.1-4 is used to model a current source. The objective of this example is to find the small-signal output resistance ${r}_{\text{out }}$ defined as ${v}_{o}/{i}_{o}$ .

Figure A.1-4 A combined method of analysis.
## SOLUTION
Three equations have been written to describe this circuit and to solve for ${r}_{\text{out }}$ . These equations are
$$
{i}_{o} = {A}_{i}i + \frac{{v}_{o} - {v}_{1}}{{R}_{4}} \tag{A.1-10}
$$
$$
i = \frac{-{R}_{3}{i}_{o}}{{R}_{1} + {R}_{2} + {R}_{3}} \tag{A.1-11}
$$
and
$$
{v}_{1} = {i}_{o}\left( \frac{{R}_{3}{R}_{1} + {R}_{3}{R}_{2}}{{R}_{1} + {R}_{2} + {R}_{3}}\right)  \tag{A.1-12}
$$
The motivation for these equations has been to find an expression for ${i}_{o}$ in terms of only ${i}_{o}$ or ${v}_{o}$ . Thus, Eqs. (A.1-11) and (A.1-12) replace $i$ and ${v}_{1}$ , respectively, in Eq. (A.1-10) in terms of ${i}_{o}$ . Making these replacements results in
$$
{r}_{\text{out }} = \frac{{v}_{o}}{{i}_{o}} = \frac{{R}_{4}\left( {{R}_{1} + {R}_{2} + {R}_{3}}\right)  + {R}_{3}{R}_{4}{A}_{i} + {R}_{3}\left( {{R}_{1} + {R}_{2}}\right) }{{R}_{1} + {R}_{2} + {R}_{3}} \tag{A.1-13}
$$
The next circuit technique of interest is called superposition. Superposition can be used in linear circuits where there are one or more excitations contributing to a response. The superposition concept states that the value of a response may be found as the sum of the values of that response produced by each of the excitation sources acting separately. Although superposition is a simple concept, it is often misused, particularly in op amp circuits. The following example will illustrate the use of superposition in an op amp circuit. Example
## Analysis of a Differential Amplifier
A. 1-4 A differential amplifier implemented by an op amp is shown in Fig. A.1-5(a). The op amp has a finite voltage gain of ${A}_{v}$ , an infinite input resistance, and a zero output resistance. Find ${v}_{o}$ as a function of ${v}_{1}$ and ${v}_{2}$ .

Figure A.1-5 (a) Differential amplifier using an operational amplifier. (b) Small-signal model of (a).
## SOLUTION
Figure A.1-5(b) shows a small-signal model of Fig. A.1-5(a). The output voltage, ${v}_{o}$ , can be written as
$$
{v}_{o} = {A}_{v}\left( {{v}_{b} - {v}_{a}}\right)  \tag{A.1-14}
$$
${v}_{b}$ can be expressed as
$$
{v}_{b} = \frac{{R}_{4}}{{R}_{3} + {R}_{4}}{v}_{2} \tag{A.1-15}
$$
Superposition is used to find ${v}_{o}$ , which is a function of both ${v}_{1}$ and ${v}_{o}$ . The result is
$$
{v}_{a} = \left( \frac{{R}_{2}}{{R}_{1} + {R}_{2}}\right) {v}_{1} + \left( \frac{{R}_{1}}{{R}_{1} + {R}_{2}}\right) {v}_{o} \tag{A.1-16}
$$
Substituting Eqs. (A.1-15) and (A.1-16) into Eq. (A.1-14) and simplifying gives
$$
{v}_{o} = \frac{{A}_{v}}{1 + \left( \frac{{A}_{v}{R}_{1}}{{R}_{1} + {R}_{2}}\right) }\left\lbrack  {\left( \frac{{R}_{4}}{{R}_{3} + {R}_{4}}\right) {v}_{2} - \left( \frac{{R}_{2}}{{R}_{1} + {R}_{2}}\right) {v}_{1}}\right\rbrack   \tag{A.1-17}
$$
If ${R}_{3}/{R}_{4}$ is equal to ${R}_{1}/{R}_{2}$ , then the amplifier is differential and the influence of the finite op amp voltage gain ${A}_{v}$ is given by Eq. (A.1-17).
An important principle in the analysis of linear active circuits is to make any manipulation in the model that will simplify the calculations before starting the analysis. Two techniques that are useful in implementing this principle are called source rearrangement and source substitution. The concepts are easier demonstrated than defined. Consider the circuit of Fig. A.1-6(a). A current source controlled by a voltage ${v}_{1}$ is connected beween two networks, ${N}_{1}$ and ${N}_{2}$ , which are unimportant to the application of the concept. The circuit can be simplified by noting that the dependent current source has the effect of taking a current of ${g}_{m}{v}_{1}$ from node 1 and applying it to node 2 . Source rearrangement allows the current source ${g}_{m}{v}_{1}$ to consist of two sources as shown in Fig. A.1-6(b). In this circuit, a current ${g}_{m}{v}_{1}$ is taken from node 1 and applied to node 3 . The same current is then taken from node 3 and applied to node 2. It is seen that the two circuits are identical in performance.

Figure A.1-6 Current-source rearrangement and substitution. (a) Original circuit. (b) Rearrangement of current source. (c) Substitution of current source by a resistor $1/{g}_{m}$ .

Figure A.1-7 Voltage-source rearrangement and substitution. (a) Original circuit. (b) Rearrangement of voltage source. (c) Substitution of voltage source by a resistor ${r}_{m}$ .
Next, we note that the left-hand current source is controlled by the voltage across it. This allows the application of the source-substitution concept, where the left-hand source is replaced by a resistance of value $1/{g}_{m}$ ohms. The final result is shown in Fig. A.1-6(c). It can be proved that Figs. A.1-6(a) and A.1-6(c) are identical. The analysis of Fig. A.1-6(c) will generally be much easier than that for Fig. A.1-6(a).
Figures A.1-7(a) through A.1-7(c) show the equivalent steps for simplifying a circuit that has a voltage source connected in parallel with two networks, which is controlled by the current of one of the networks. In this case the source-rearrangement concept is accomplished by sliding the voltage source through a node in series with the other branches connected to the node. An example will demonstrate some of the concepts used in source rearrangement and source substitution.
---
Example A. 1-5
---
## Example of Source Rearrangement and Substitution
Apply the source-rearrangement and source-substitution concepts to the linear active circuit of Fig. A.1-8 to simplify the circuit for simple, chain-type calculations.
## SOLUTION
The dependent current source ${g}_{m}{v}_{1}$ is rearranged as illustrated in Fig. A.1-8(b). Next, the left-hand dependent current source ${g}_{m}{v}_{1}$ is substituted by a resistor of value $1/{g}_{m}$ . The circuit has now been simplified to the point where chain-type calculations can be made.

Figure A.1-8 Current-source rearrangement and substitution. (a) Original circuit. (b) Rearrangement. (c) Substitution.
Another circuit simplification that is possible is called source reduction. It is applicable to dependent sources connected in the manner shown in Fig. A.1-9. We note that these controlled sources are of the VCVS or CCCS type, whereas in the substitution simplification they were VCCS or CCVS types. The circuit-reduction technique for Fig. A.1-9(a) states that all currents in ${N}_{1}$ and ${N}_{2}$ remain unchanged if the controlled source, ${A}_{v}{v}_{1,}$ is replaced by a short and if:
1. Each resistance, inductance, reciprocal capacitance, and voltage source in ${N}_{1}$ is multiplied by the factor $1 + {A}_{v}$ , or

Figure A.1-9 (a) Circuit reduction for a VCVS. (b) Circuit reduction for a CCCS.
2. Each resistance, inductance, reciprocal capacitance, and voltage source in ${N}_{2}$ is divided by the factor $1 + {A}_{v}$ .
The circuit reduction technique for Fig. A.1-9(b) states that all voltages in ${N}_{1}$ and ${N}_{2}$ remain unchanged if the controlled source ${A}_{i}{i}_{1}$ is replaced by a open circuit and if:
1. Each conductance, reciprocal inductance, capacitance, and current source in ${N}_{1}$ is multiplied by the factor $1 + {A}_{i}$ , or
2. Each conductance, reciprocal inductance, capacitance, and current source in ${N}_{2}$ is divided by the factor $1 + {A}_{i}$ .
---
Example A. 1-6
---
## Application of the Source-Reduction Technique
The circuit of Fig. A.1-10(a) is to be simplified using the source-reduction technique.

Figure A.1-10 Current reduction. (a) Original circuit. (b) Identification of ${N}_{1}$ and ${N}_{2}$ . (c) Modification of ${N}_{2}$ . (d) Modification of ${N}_{1}$ .
## SOLUTION
In order to apply the technique, the circuit has been redrawn as shown in Fig. A.1-10(b). Note that the presence of a resistor $\left( {R}_{3}\right)$ in series with the current source does not affect the technique. Figure A.1-10(c) shows the modification of ${N}_{1}$ and Fig. A.1-10(d) shows the modification of ${N}_{2}$ by the source-reduction technique. The resulting simplified circuits are suitable for chain-type calculations.

Figure A.1-11 Miller simplification. (a) Original circuit. (b) Equivalent circuit of (a).
The last simplification technique presented here is called the Miller simplification. This technique is good for removing bridging elements in a circuit and accounting for their effect on the forward gain of a circuit. Figure A.1-11(a) shows the circumstance in which the Miller simplification can be used. We assume that an impedance $Z$ is connected between two networks. We use an impedance since the Miller simplification technique is often employed when the bridging element is reactive. We shall also switch to complex-signal notation. The key aspect of the Miller simplification is that ${V}_{2}$ can be expressed in terms of ${V}_{1}$ . This expression should be real for best results. If ${V}_{2} = K{V}_{1}$ , then it can be shown that the impedance seen from ${N}_{1},{Z}_{1}$ , can be written as
$$
{Z}_{1} = \frac{{V}_{1}}{{I}_{1}} = \frac{{V}_{1}}{\left( {{V}_{1} - {V}_{2}}\right) /Z} = \frac{Z{V}_{1}}{{V}_{1} - K{V}_{1}} = \frac{Z}{1 - K} \tag{A.1-18}
$$
and the impedance seen from ${N}_{2},{Z}_{2}$ is
$$
{Z}_{2} = \frac{{V}_{2}}{{I}_{2}} = \frac{{V}_{2}}{\left( {{V}_{2} - {V}_{1}}\right) /Z} = \frac{{ZK}{V}_{1}}{K{V}_{1} - {V}_{1}} = \frac{ZK}{K - 1} \tag{A.1-19}
$$
Typically, $K$ is negative and greater than unity. An example will illustrate the application of the Miller simplification technique.
---
Example A. 1-7
---
## Application of the Miller Simplification Technique
Consider the circuit of Fig. A.1-2. Assuming that ${R}_{2}$ is much greater than ${R}_{3}$ , use the Miller simplification technique to remove ${R}_{2}$ .
## SOLUTION
If ${R}_{2}$ is much greater than ${R}_{3}$ , then we may assume that most of the current ${g}_{m}{v}_{1}$ flows through ${R}_{3}$ . Therefore, the voltage ${v}_{\text{out }}$ may be expressed as
$$
{v}_{\text{out }} =  - {g}_{m}{R}_{3}{v}_{1} = K{v}_{1} \tag{A.1-20}
$$
Therefore, Fig. A.1-2 can be redrawn as Fig. A.1-12, where the resistor ${R}_{2}^{\prime }$ is given as
$$
{R}_{2}^{\prime } = \frac{{R}_{2}}{1 - K} = \frac{{R}_{2}}{1 + {g}_{m}{R}_{3}} \tag{A.1-21}
$$

Figure A.1-12 The result of applying the Miller simplification concept.
We have not placed a resistor of value ${R}_{2}K/\left( {K - 1}\right)$ in parallel with ${R}_{3}$ for the following reason. If ${g}_{m}{R}_{3}$ is greater than unity, then ${R}_{2}K/\left( {K - 1}\right)$ is approximately ${R}_{2}$ . However, we used the assumption earlier in the problem that ${R}_{2}$ is greater than ${R}_{3}$ . Consequently, it would not be consistent to place the resistor ${R}_{2}$ in parallel with ${R}_{3}$ .
If the controlled source in Fig. A.1-2 had been a voltage source rather than a current source, then it would not have been necessary to make the assumption used in Example A.1-7. In this case, ${R}_{2}$ would have been reflected into both ${N}_{1}$ and ${N}_{2}$ . Figure A.1-3 shows a case where ${R}_{3}$ could be removed by the Miller simplification and reflected into both ${N}_{1}$ and ${N}_{2}$ according to Eqs. (A.1-18) and (A.1-19).
Although other simplification techniques could have been included, the above are the ones most useful in analyzing linear active circuits. The material of the book presents many further illustrations of the use of the concepts presented in this appendix. Problems that illustrate the principles developed here can be found at the end of the problems in Chapter 1.
## APPENDIX B Integrated Circuit Layout
Aunique aspect of integrated-circuit design is that it requires understanding of the circuit beyond the schematic. A circuit defined and functioning properly at the schematic level can fail if it is not correctly designed physically. Physical design, in the context of integrated circuits, is referred to as layout.
As a designer works through the process of designing a circuit, he or she must consider all implications that the physical layout might have on a circuit's operation. Effects due to matching of components or parasitic devices must be kept in mind. If, for example, two transistors are intended to exhibit identical performance, their layout must be identical. A wide-bandwidth amplifier design will not function properly if parasitic capacitances at critical nodes are not minimized through careful layout. To appreciate these finer issues dealing with physical design, it is important to first develop a basic understanding of integrated-circuit layout and the rules that govern it.
As described in Section 2.1, an integrated circuit is made up of multiple layers, each defined by a photomask using a photolithographic process, on a thin substrate of semiconductor material. Each photomask is built from a computer database that describes it geometrically. This database is derived from the physical layout drawn by a mask designer or by computer (at present, most analog layout is still performed manually). The layout consists of topological descriptions of all electrical components that will ultimately be fabricated on the integrated circuit. The most common components that have been discussed thus far are transistors, resistors, and capacitors.

### B.1 Matching Concepts
Matching performance of two or more components is very important to overall circuit operation. Since matching is dependent on layout topology, it is appropriate to discuss it here.
The rule for making two components electrically equivalent is simply to draw them as identical units. This is the unit-matching principle. To say that two components are identical means that both they and their surroundings must be identical. This concept can be explained in nonelectrical terms.
Consider the two square components, A and B, illustrated in Fig. B-1(a). In this example, these objects could be pieces of metal that are desired after deposition and etching. They have identical shape in area and perimeter as drawn. However, the surroundings seen by A and $\mathrm{B}$ are different due to the presence of object $\mathrm{C}$ . The presence of object $\mathrm{C}$ nearer to object B may cause that object to change in some way different than A. The solution to this is to somehow force the surroundings of both geometries $\mathrm{A}$ and $\mathrm{B}$ to be the same. This can never be achieved perfectly! However, matching performance can normally be improved by at least making the immediate surroundings identical as illustrated in Fig. B-1(b). Oftentimes, dummy devices are placed around the perimeter of a set of geometries being matched. These dummy devices have no electrical function but rather serve to meet the objective of minimizing effects due to asymmetric surroundings. This general principle will be applied repeatedly to components of various types. When it is desired to match components of different sizes, optimal matching is achieved when both geometries are made from integer numbers of units with all units being designed applying the unit-matching principle.
When multiple units are being matched using the unit-matching principle, another issue can arise. Suppose that there is some gradient that causes objects to grow smaller along some path as illustrated in Fig. B-2(a). The gradient might be, for example, oxide thickness (ordinate) versus the $x$ dimension. By design, component A composed of units ${\mathrm{A}}_{1}$ and ${\mathrm{A}}_{2}$ should be twice the size of unit component $\mathrm{B}$ . However, due to the gradient, component $\mathrm{A}$ is less than twice the size of component $\mathrm{B}$ . If the gradient is linear, this situation can be resolved by applying the principle of common-centroid layout. As illustrated in Fig. $\mathrm{B} - 2$ (b), component $\mathrm{B}$ is placed in the center (the centroid) between the units ${\mathrm{A}}_{1}$ and ${\mathrm{A}}_{2}$ . Now, any linear gradient will cause ${\mathrm{A}}_{1}$ to change by an amount equal and opposite to ${\mathrm{A}}_{2}$ such that their average value remains constant with respect to B. This is easily shown analytically in the following way.
If the linear gradient is described as
$$
y = {mx} + b \tag{B-1}
$$
then for Fig. B-2(a) we have
$$
{A}_{1} = m{x}_{1} + b \tag{B-2}
$$
$$
{A}_{2} = m{x}_{2} + b \tag{B-3}
$$
$$
B = m{x}_{3} + b \tag{B-4}
$$
$$
\frac{{A}_{1} + {A}_{2}}{B} = \frac{m\left( {{x}_{1} + {x}_{2}}\right)  + {2b}}{m{x}_{3} + b} \tag{B-5}
$$

This ratio cannot be equal to two because
$$
{x}_{3} \neq  \frac{{x}_{1} + {x}_{2}}{2} \tag{B-6}
$$
However, for the case illustrated in Fig. B-2(b) it easy to show that
$$
{x}_{2} = \frac{{x}_{1} + {x}_{3}}{2} \tag{B-7}
$$
if ${x}_{1} - {x}_{2}$ and ${x}_{2} - {x}_{3}$ are equal. In reality, one cannot expect that a linear gradient will extend over a long distance. Thus, to achieve the benefits of this approach, the distances (e.g., ${x}_{1} -$ ${x}_{2}$ ) must be as small as possible.
The matching principles described thus far should be applied to capacitors when there is a desire to match them. In addition, there are other rules that should be applied when dealing with capacitors. When laying out a capacitor, the capacitor's value should be determined by only one plate to reduce its variability. Consider the dual-plate capacitors shown in Fig. B-3. In this figure, the electric field lines are illustrated to indicate that the capacitance between the plates is due to both an area field and fringe field. In Fig. B-3(a) the total capacitance between the two plates will vary if the edges of the top plate indicated by points $\mathrm{A}$ and ${\mathrm{A}}^{\prime }$ move, or if the edges of the bottom plate indicated by points $\mathrm{B}$ and ${\mathrm{B}}^{\prime }$ move. On the other hand, the value of the capacitor illustrated in Fig. B-3(b) is sensitive only to the edge variations of the top plate. Even if the top plate shifts to the left or to the right by a small amount, the capacitance changes very little. The capacitor in Fig. B-3(a) is sensitive to movement of both plates and thus will have greater variability due to process variations than the capacitor in Fig. B-3(b).

Figure B-3
The field lines illustrated in Fig. B-3 are helpful to appreciate the fact that the total capacitance between two plates is due to an area component (the classic parallel plate capacitor) and a perimeter component (the fringe capacitance). With this in mind, consider a case where it is desired to ratio two capacitors, ${C}_{1}$ and ${C}_{2}$ , by a precise amount (e.g.,2:1 ratio). Let ${C}_{1}$ be defined as
$$
{C}_{1} = {C}_{1\mathrm{\;A}} + {C}_{1\mathrm{P}} \tag{B-8}
$$
and ${C}_{2}$ be defined as
$$
{C}_{2} = {C}_{2\mathrm{\;A}} + {C}_{2\mathrm{P}} \tag{B-9}
$$
where
$$
{C}_{\mathrm{{XA}}} = \text{the area capacitance (parallel plate capacitance)}
$$
$$
{C}_{\mathrm{{XP}}} = \text{the perimeter capacitance (fringe capacitance)}
$$
The ratio of ${C}_{2}$ to ${C}_{1}$ can be expressed as
$$
\frac{{C}_{2}}{{C}_{1}} = \frac{{C}_{2\mathrm{\;A}} + {C}_{2\mathrm{P}}}{{C}_{1\mathrm{\;A}} + {C}_{1\mathrm{P}}} = \frac{{C}_{2\mathrm{\;A}}}{{C}_{1\mathrm{\;A}}}\left\lbrack  \frac{1 + \frac{{C}_{2\mathrm{P}}}{{C}_{2\mathrm{\;A}}}}{1 + \frac{{C}_{1\mathrm{P}}}{{C}_{1\mathrm{\;A}}}}\right\rbrack   \tag{B-10}
$$
If ${C}_{1\mathrm{P}}/{C}_{1\mathrm{\;A}}$ equals ${C}_{2\mathrm{P}}/{C}_{2\mathrm{\;A}}$ , then ${C}_{2}/{C}_{1}$ is determined by the ratios of capacitor areas only. Thus, the equations show that maintaining a constant area-to-perimeter ratio eliminates matching sensitivity due to the perimeter. It should not be a surprise that a constant area-to-perimeter ratio is achieved when the unit-matching principle is applied! At this point it is worthwhile to ask what geometry is best at maintaining a constant area-to-perimeter ratio-a square, rectangle, circle, or something else. Referring again to Eq. (B-10) it is clear that minimizing the perimeter-to-area ratio is a benefit. It is easy to show that a circle achieves the least perimeter for a given area and thus is the best choice for minimizing perimeter effects. Moreover, a circle has a uniform perimeter and as such will have uniform etch at its perimeter, as compared to a rectangle where the etch along a side will differ from that of a corner. For a variety of reasons unrelated to the technology, circles may be undesirable. A reasonable compromise between a square and a circle is a square with chamfered corners (an octagon) as illustrated in Fig. B-4.

Another useful capacitor layout technique uses the Yiannoulos path. ${}^{ * }$ This method uses a serpentine structure that can maintain a constant area-to-perimeter ratio. The beauty of this technique is that you are not limited to integer ratios as is the case when using the unit-matching principle. An example of this layout technique is given in Fig. B-5. It can be easily shown that this structure maintains a constant area-to-perimeter ratio.

B. 2 MOS Transistor Layout
Figure B-6 illustrates the layout of a single MOS transistor and its associated side view. Transistors that are used for analog applications are drawn as linear stripes as opposed to a transistor drawn with a bend or corner in the gate. The dimensions that will be important later on are the width and length of the transistor as well as the area and periphery of the drain and source. It is the $W/L$ ratio that is the dominant dimensional component governing transistor conduction, and the area and periphery of the drain and source that determine drain and source capacitance on a per-device basis.
---
*This idea was developed by Aristedes A. Yiannoulos.
---

Consider the differential pair circuit illustrated in Fig. B-7. In this circuit, M1 and M2 should be matched as well as possible. When it is desired to match transistors, the unit-matching principle and the common-centroid method should be applied. Once applied, the question arises as to whether the drain/source orientation of the transistors should be mirror symmetric or have the same orientation. In Fig. B-8 transistors are drawn using the unit-matching principle. Transistors in Fig. B-8(a) exhibit mirror symmetry while transistors in Fig. B-8(b) exhibit the same orientation, or photolithographic invariance (PLI). ${}^{ * }$ It is not uncommon for the drain/source implant to be applied at an angle. Because of its height (its thickness), poly-silicon can shadow the implant on one side or the other, causing the gate-source capacitance to differ from the gate-drain capacitance. By applying the PLI layout method, the effect of the implant angle is matched so that the two gate-source capacitors $\left( {C}_{GS}\right)$ are matched and the two gate-drain capacitors $\left( {C}_{GD}\right)$ are matched as well. Suppose that the differential-pair transistors are made up of multiple units (four each) to achieve a desired circuit performance. In order to achieve both common-centroid and PLI layouts, matched transistors must be broken into four units each and drawn in accordance with Fig. B-9(a). The layout of Fig. B-9(a) can be made more compact by rearranging and sharing drains/sources as illustrated in Fig. B-9(b). In order to achieve PLI, any desired transistor size must be broken into two units. Achieving a common-centroid layout also requires the same. However, to achieve both PLI and common centroid, a desired transistor size must be broken into four units.

---
*The term "photolithographic invariance" was coined by Eric J. Swanson while he was at Crystal Semiconductor.
---

Figure B-9
When sizing transistors in analog circuit design, the layout must always be kept in mind. Suppose a current mirror with a 2:1 ratio is desired with the best matching possible. Assume that the minimum device width has been chosen to be ${5\mu }\mathrm{m}$ . A simple-minded approach would be to make one transistor ${10}\mathrm{\;{mm}}$ the other ${5\mu }\mathrm{m}$ . However, best matching is achieved using both common-centroid and PLI. Therefore, each transistor must be broken into a minimum of four units. The smaller of the two mirror transistors dictates the layout. Choosing ${5\mu }\mathrm{m}$ as the minimum width, one of the transistors (the smaller) must be four units of ${5\mu }\mathrm{m}$ and the other must be eight units of ${5\mu }\mathrm{m}$ . Figure B-10 illustrates a common-centroid, PLI layout of a 1:2 current mirror.
Many analog circuits involve the use of cascode structures. When the best matching is required, PLI and common-centroid techniques should be applied. Figure B-11 illustrates a portion of a cascode current mirror. In this structure, PLI is achieved by using mirror images of the transistors (vertically in the figure), while common-centroid is achieved by centering the unit device between the two units making up the $2\mathrm{X}$ device. As a practical matter, the $2\mathrm{X}$ device must be drawn as shown in the schematic because that is how it exists in the layout. The cascode node (common node where source and drain connect) of one unit pair is not electrically connected to the other unit pair. There are strategies to avoid drawing the extra transistors but these are specific to the CAD (computer-aided design) software being used and the methodology chosen.

Figure B-10

Often times, the electrical design of a cascoded transistor does not require that its width be the same as the device with which it is cascoded. However, there may be no performance penalty for making it so (not so for very high frequency circuits). In such cases, for the sake of uniformity and a regular layout, the cascode widths should be made the same as the transistor they cascode.
It was stated earlier that a tenet of the principles of matching is to make the surroundings of each matched component identical. Consider, for example, the transistors illustrated in Fig. B-11. The transistors in the middle see a transistor on either side of it. However, the transistors at either side do not see other similar transistors. Thus, one of the fundamental matching principles has been violated. This is easily solved by adding transistors that have no electrical function but serve to achieve the "same periphery" matching principle. Figure B-12 is a modification of Fig. B-11 with the addition of "dummy" transistors.

Figure B-12
The common substrate and wells must be tied to their appropriate potentials for proper circuit operation. In other words, the p-type substrate (or p-well for twin-well processes) must be tied to the lowest potential (typically ground) and the n-well must be tied to the most positive potential (typically ${V}_{DD}$ ). It is important to consider where these connections should be made both in light of matching and interference abatement. Figure B-13 shows an adequate well tie (connection to the n-well) to meet minimum electrical requirements. However, considered in light of matching principles, it does not match the periphery of all matched transistors. The well is unbalanced from an electrical point of view. This situation is easily remedied by encircling the matched devices with a well tie as illustrated in Fig. B-14. In this example, the transistor array is surrounded by a well tie.

Figure B-13

Transistors fabricated in deep submicron technologies can be affected by strain on the channel due to proximity of the source/drain contacts to the channel. To minimize any negative impact, matched transistors must have their contacts matched (as would be obvious from the unit-matching principle). Moreover, spacing of contact to the channel (polysilicon) should not be the minimum allowed by design rules. Characterization of the impact of poly-contact spacing should be made on the process being used so that a rule can be established where matching is critical.
The proximity of the shallow-trench oxide (STI) to the channel can impact the performance of a transistor [1]. Figure B-15(a) shows a situation where a 2:1 ratio is intended ( $2 \times$ $\mathrm{A} : \mathrm{B}$ ). However, stress induced by the STI causes the performance of the outer transistors (A) to be different from the transistor in the center (B). The stress effect decreases with distance, so one solution is to extend the distance between the matching transistors and the STI. Using a dummy transistor (D), as illustrated in Fig. B-15(b), serves the need to extend the distance from the STI as well as matching the perimeter of all transistors that should be identical (as discussed earlier). Without characterization of the particular process being used, the optimal distance between the STI and active transistors cannot be known. It is not uncommon to use two dummy transistors at the periphery since doing so has little area impact and might have a noticeable performance improvement.

A transistor's proximity to the edge of the well in which it lies can impact its threshold voltage [1]. This is due to variation of surface doping concentration near the edge of the well.

Figure B-16(a) illustrates a situation where two transistors are oriented such that one is close to the well edge while the other is farther away. Each will see a different threshold voltage due to their different distances from the edge of the well. In this illustration the other three sides of the well extend a significant distance from the transistors as to have little or no effect on the transistor. One solution is to orient the transistors so that the current flow in both transistors is parallel to the nearest well edge and both transistors are the same distance from the edge as illustrated in Fig. B-16(b). In this way, both transistors will see the same doping gradient. Another solution is illustrated in Fig. B-16(c) where each transistor is equidistant from opposite edges of the well (left and right as oriented) and share common effects in the direction orthogonal to current flow (vertically as oriented). Compensating for the well-proximity effect is much more complicated when a structure such as that shown in Fig. B-12 is used. Orientation to the nearest well edge as well as distance from it are critical in order to achieve good matching.

### B.3 Resistor Layout
The most useful resistor for precision analog design is one made from polysilicon. Figure B- 17 shows the layout of a polysilicon resistor (top view and side view at the cut line). Generally, polysilicon resistors used in analog circuits require a silicide block to achieve a reasonable sheet resistance. Because the silicided polysilicon is somewhat low resistance, the primary resistance is specified by the nonsilicided region. The transition from silicided to nonsilicided poly is not well controlled, so to achieve precision matching one must take this into account. How can this be accomplished? The key is to keep transitions (from silicided poly to nonsilicided poly) out of the current path. Consider the example illustrated in Fig. B- 18. Assuming that little or no current flows from the resistor taps, then none of the current flows across the silicide boundary. The resistance where current is flowing is homogenous. Therefore, very precise resistor ratios can be achieved. Not all circuit topologies lend themselves to the scheme of Fig. B-18. In such cases, a layout similar to that shown in Fig. B-19 can be used, where the unit-matching principle is used along with a common centroid. However, Fig. B-19 is not perfect. There is via resistance in the $2\left( R\right)$ path that does not exist in the $R$ path. This effect can be mitigated by adding vias into the $R$ string or by increasing the value of the resistors so that via resistance is a smaller percentage of the total resistance.

Figure B-18
Another aspect of resistor layout that is implicit in Figs. B-17 and B-18 is that current paths through resistors should be straight with no bends. This is critical for precision matching because corners add variability to a resistor's value. Resistors that are matched should always be oriented the same way. Depending on the process technology, this might not make a difference, but there is seldom a penalty for doing so; thus, it should be standard practice.
Precision resistors should never be drawn at minimum dimensions. Choose a resistor width at least twice the minimum allowed by the design rules if other circuit requirements do not dictate otherwise (e.g., parasitic capacitance). As with transistors, dummy resistors should be used whenever space permits.
A well resistor is illustrated in Fig. B-20. Constructed from lightly doped diffusion, well resistors are not very accurate and do not exhibit good matching, but can be useful where high-valued resistors of approximate value are needed.
Returning to Fig. B-17, the resistance of each resistor shown is determined by the $L/W$ ratio and its respective sheet resistance. One should wonder what the true values of $L$ and $W$ are since, in reality, the current flow is neither uniform nor unidirectional, in particular the

area near the transitions under the contact region. It is convenient to measure $L$ and $W$ as shown and then characterize the total resistance in two components: the body component of the resistor (the portion along the length, $L$ ) and the contact component. One could choose a different approach as long as devices are characterized consistently with the measurement.
### B.4 Capacitor Layout
Capacitors can be constructed in a variety of ways depending upon the process as well as the particular application. Only two detailed capacitor structures will be discussed.
The MiM capacitor layout is illustrated in Fig. B-21(a). Notice that the cap layer boundary falls completely within the boundaries of the Metal 4 layer and the top-plate contact is made at the center of the cap-layer geometry. The cap layer should always reside inside the boundaries of the bottom-plate Metal 4 in order to achieve the most precise capacitance.
Purely digital processes do not generally provide MiM capacitors. Therefore, precision capacitors are generally made using multiple layers of metal-MOM capacitors. An example of a two-metal MOM finger-capacitor is illustrated in Fig. B-21(b). In this layout, the two capacitor plates are interleaved between the two metal layers; thus, there is no clear distinction between top and bottom plates. The concept illustrated is easily extended to more metal layers (see Fig. 2.4-2).
The value of a MiM capacitor is approximately ${}^{ * }$
$$
C = \frac{{\epsilon }_{ox}A}{{t}_{ox}} = {C}_{ox}A \tag{B-14}
$$
where ${\varepsilon }_{\mathrm{{ox}}}$ is the dielectric constant of the silicon dioxide (approximately ${3.45} \times  {10}^{-5}\mathrm{{pF}}/\mu \mathrm{m}$ ), ${t}_{ox}$ is the thickness of the oxide, and $A$ is the area of the capacitor. The value of the capacitor is seen to depend on the area $A$ and the oxide thickness ${t}_{ox}$ . There is, in addition, a fringe capacitance that is a function of the periphery of the capacitor. Therefore, there are errors in the ratio accuracy of two capacitors resulting from errors in either the ratio of the areas or the oxide thickness. If the error is caused by a uniform linear variation in the oxide thickness, then a common-centroid geometry can be used to eliminate its effects [2]. Area-related errors result from the inability to precisely define the dimensions of the capacitor on the integrated circuit. This is due to the error tolerance associated with making the mask, the nonuniform etching of the material defining the capacitor plates, and other limitations [3].
---
${}^{ * }$ This is the infinite parallel plate equation. This expression loses its accuracy as the plate dimensions approach the dimension separating the plates.
---

Figure B-21
Figure B-22 illustrates a binary-weighted capacitor array that might be used in a digital-to-analog converter. Each capacitor is labeled according to its weighting (e.g., the 16 unit capacitors that are connected together are labeled "16"). They are drawn using the unit-matching principle and in a common-centroid fashion. Unused unit locations are filled with a "dummy" capacitor that is not electrically connected to the array. Each unit capacitor top plate is chamfered to minimize corner-rounding effects. The top-plate interconnect is matched for each unit capacitor so that the parasitic from Metal 5 to Metal 4 is matched. Not shown are rows of dummy capacitors above and below the array as well as dummy columns on each side of the array.

MOM capacitors are more difficult to model since they are not parallel plate structures. They can be approximated but more accurate values are provided by the wafer vendor or found by building test structures and characterizing them.

### B.5 Summary of Best Practices
The principles given for laying out transistors, resistors, and capacitors can be summarized by the following best practices.
Matched Transistors
- Use matched units and choose integer ratios.
- Use linear structures (no bends or corners).
- Use twice the minimum space between contact and gate.
- Use the same orientation.
- For PLI, split smaller of matched pair into two in PLI orientation.
- For PLI and common centroid together, split smaller of matched pair into four and use PLI orientation.
- Use dummy transistors (use two if space is available).
- Match surrounding well perimeter.
## Matched Resistors
- Use matched units and choose integer ratios.
- Use linear structures (no bends or corners).
- Use the same orientation.
- Use dummy resistors.
- Minimum width should be at least twice the minimum layout rule.
- Avoid contacts or silicide transition in critical current paths.
- Use largest resistance that the circuit will allow to minimize effect of contacts.
## Matched Capacitors
- Use MiM capacitors for precision matching.
- Use matched units and choose integer ratios.
- Use square top plate with chamfered corners.
- Match all parasitics to the top plate.
- Use common centroid.

### B.6 Layout Rules
As the integrated circuit is being drawn, there are layout rules that must be observed in order to ensure that the integrated circuit is manufacturable. Layout rules governing manufactura-bility arise, in part, from the fact that at each masking step in the process, features of the next photomask must be aligned to features previously defined on the integrated circuit. Even when using precision alignment tools, there is still some error in alignment. In some cases, alignment of two layers is critical to circuit operation. As a result, alignment tolerances impose a limitation of feature size and orientation with respect to other layers on the circuit.
Electrical performance requirements also dictate feature size and orientation with respect to other layers. A good example of this is the allowable distance between diffusions supporting a given voltage difference. Understanding the rules associated with electrical performance is most important to the designer if circuits are to be designed that challenge the limits of the technology. The limits for these rules are constrained by the process (doping concentration, junction depth, etc.) characterized under a specific set of conditions.
The following set of design rules are based on the minimum dimension resolution $\lambda$ (lambda, not to be confused with the channel length modulation parameter $\lambda$ as introduced in Chapter 3). The minimum dimension resolution $\lambda$ is typically one-half the minimum geometry allowed by the process technology.
The basic layout levels needed to define a five-metal, twin-well, shallow-trench oxide, silicon gate CMOS circuit include:
- n-Well
- p-Well
- AA (active area)
- Select layer (to define n-type and p-type diffusions)
- Polysilicon
- Silicide block
- Metals 1-5 (metal layers)
- Vias 2-5
- Capacitor top plate (for MiM capacitors)
- Pad opening
Table B-1 gives detailed design rules for this process that are illustrated graphically in Figs. B-23 and B-24.
Table B-1 gives detailed design rules for this process which are illustrated graphically in Figs. B-23 and B-24 Minimum Dimension Resolution
1 n-Well
1.1 width 12
1.2 spacing (different potential) 18
1.3 spacing (same potential) 6
2 Active Area (AA)
2.1 width 10
2.2 spacing 3
2.3 source/drain to well edge 6
2.4 substrate/well contact active to well edge 3
2.5 spacing between ${\mathrm{p}}^{ + }$ to ${\mathrm{n}}^{ + }$ AA (nonbutting) 4
4 Select Layer
4.1 spacing to transistor channel 3
4.2 overlap of AA 2
4.3 overlap of contact 1
4.4 width and space (cannot overlap, can be coincident) 2
Table B-1 (Continued)
3 Polysilicon Gate
3.1 width 2
3.2 spacing over field 3
3.2a spacing over AA 3
3.3 extension of gate beyond AA (transistor width direction) 2
3.4 spacing of gate to edge of AA (transistor length direction) 3
3.5 spacing of polysilicon to AA (over field) 1
20 Silicide Block
20.1 width 4
20.2 spacing 4
20.3 spacing to contact (contact not allowed in silicide block) 3
20.4 spacing to external AA 3
20.5 spacing to external poly 3
20.6 poly resistor with silicide block defined within silicide block region
20.7 width for poly resistor 5
20.8 spacing for poly resistor 7
20.9 overlap of poly (or AA) 2
5 Contact to Poly
5.1 $2 \times  2$
5.2 poly overlap of contact 1.5
5.3 spacing 3
5.4 spacing to AA (gate region) 2
6 Contacts to AA
6.1
6.2 AA overlap of contact
6.3
6.4
7 Metal-1
7.1 width
7.2 3
7.3 overlap of contact
7.4 spacing for wide metal (greater than 10) 6
8 Via-X-1 (X = 2-5)
$2 \times  2$
spacing
enclosure by Metal-1
Via-1 over contact or Via allowed (stacked vias)
9 Metal-X (X = 2-5)
9.1 width 3
spacing
enclosure of Via-1
spacing for wide metal (greater than 10)
28 Capacitor top plate metal (for MiM capacitors)
spacing (sharing bottom plate)
enclosure of top plate by bottom metal
Table B-1 (Continued) overlap of via 3 spacing to bottom metal via 4 min bottom metal overlap of via 2 rule applicability beyond bottom plate 25 min width of dummy shapes (no vias) 4 min space: bottom plate to other same metal 8 min via space on cap metal 20 min via space (to metal above) 40 maximum cap metal width and length (microns) 30 maximum bottom-plate metal width and length (microns) 35 No vias below top plate No active or passive circuits under top plate

Figure B-24
In most cases design rules are unique to each wafer manufacturer. The design rules for the particular wafer manufacturer should be obtained before the design is begun and consulted during the design. This is especially important in the design of state-of-the-art analog CMOS. However, the principles developed here should remain unaltered while translated to specific processes.
## References
1. P. G. Drennan, M. L. Kniffin, and D. R. Locascio "Implications of Proximity Effects for Analog Design," Proceedings of IEEE 2006 Custom Integrated Circuits Conference (CICC), pp. 169-176, Sept. 2006.
2. J. L. McCreary and P. R. Gray, "All-MOS Charge Redistribution Analog-to-Digital Conversion Techniques-Part I," IEEE J. Solid-State Circuits, Vol. SC-10, pp. 371-379, Dec. 1975.
3. J. B. Shyu, G. C. Temes, and F. Krummenacher, "Random Error Effects in Matched MOS Capacitors and Current Sources," IEEE J. Solid-State Circuits, Vol. SC-19, pp. 948-955, Dec. 1984.
# APPENDIX CMOS Device Characterization
$\mathrm{n}$ Chapter 3, we presented two strong inversion MOS transistor models that describe the behavior of the transistor over a range of terminal conditions(S, G, D, B). These models can be use-
ful for hand calculations and computer simulations using either the simple model or more complex models. However, before the models can be used, proper model parameters that describe the particular characteristics of a given device must be supplied. If device model parameters are not available from the wafer manufacturer, then before a design can begin, devices must be characterized to obtain suitable model parameters. It is prudent practice for the designer to obtain a sampling of the components from the wafer vendor and characterize them in order to obtain the desired model parameters. The characterization process is the subject of this appendix.
Using the simple model, graphical and numerical techniques will be developed to extract the model parameters. Attention will be given to the geometrical aspects of a good test structure. Some of the techniques and results will be extended to the complex model, where further work will be done to capture some of the second-order parameters associated with this model. Other areas that must be characterized are transistor noise and passive-component parameters.

### C.1 Characterization of Simple Transistor Model
The equations that model an MOS transistor in strong inversion saturated and nonsaturated regions were given in Section 3.1 and are repeated here for convenience.
$$
{i}_{D} = {K}^{\prime }\left( \frac{{W}_{\text{eff }}}{2{L}_{\text{eff }}}\right) {\left( {v}_{GS} - {V}_{T}\right) }^{2}\left( {1 + \lambda {v}_{DS}}\right)  \tag{C.1-1}
$$
$$
{i}_{D} = {K}^{\prime }\left( \frac{{W}_{\text{eff }}}{{L}_{\text{eff }}}\right) \left\lbrack  {\left( {{v}_{GS} - {V}_{T}}\right) {v}_{DS} - \frac{{v}_{DS}^{2}}{2}}\right\rbrack   \tag{C.1-2}
$$
where
$$
{V}_{T} = {V}_{T0} + \gamma \left\lbrack  {\sqrt{2\left| {\phi }_{F}\right|  + {v}_{SB}} - \sqrt{2\left| {\phi }_{F}\right| }}\right\rbrack   \tag{C.1-3}
$$
The primary parameters of interest are ${V}_{T0}\left( {{V}_{SB} = 0}\right) ,{K}^{\prime },\gamma$ , and $\lambda$ . In this section, we will concentrate on techniques for determining these parameters. It was noted earlier that the parameter ${K}^{\prime }$ is different for the saturation and nonsaturation regions and thus must be characterized differently for each case. In order to keep the terminology simple, we adopt (in this appendix only) the terms ${K}_{S}^{\prime }$ for the saturation region and ${K}_{L}^{\prime }$ for the nonsaturation region. Using this terminology, Eqs. (C.1-1) and (C.1-2) can be rewritten
$$
{i}_{D} = {K}_{S}^{\prime }\left( \frac{{W}_{\text{eff }}}{2{L}_{\text{eff }}}\right) {\left( {v}_{GS} - {V}_{T}\right) }^{2}\left( {1 + \lambda {v}_{DS}}\right)  \tag{C.1-4}
$$
$$
{i}_{D} = {K}_{L}^{\prime }\left( \frac{{W}_{\text{eff }}}{{L}_{\text{eff }}}\right) \left\lbrack  {\left( {{v}_{GS} - {V}_{T}}\right) {v}_{DS} - \frac{{v}_{DS}^{2}}{2}}\right\rbrack   \tag{C.1-5}
$$
First assume that ${v}_{DS}$ is chosen such that the $\lambda {v}_{DS}$ term in Eq. (C.1-4) is much less than one and ${v}_{SB}$ is zero, so that ${V}_{T} = {V}_{T0}$ . Therefore, Eq. (C.1-4) simplifies to
$$
{i}_{D} = {K}_{S}^{\prime }\left( \frac{{W}_{\text{eff }}}{2{L}_{\text{eff }}}\right) {\left( {v}_{GS} - {V}_{T0}\right) }^{2} \tag{C.1-6}
$$
This equation can be manipulated algebraically to obtain the following:
$$
{i}_{D}^{1/2} = {\left( \frac{{K}_{S}^{\prime }{W}_{\text{eff }}}{2{L}_{\text{eff }}}\right) }^{1/2}{v}_{GS} - {\left( \frac{{K}_{S}^{\prime }{W}_{\text{eff }}}{2{L}_{\text{eff }}}\right) }^{1/2}{v}_{T0} \tag{C.1-7}
$$
which has the form
$$
y = {mx} + b \tag{C.1-8}
$$
This equation is easily recognized as the equation for a straight line with $m$ as the slope and $b$ as the $y$ intercept. Comparing Eq. (C.1-7) to Eq. (C.1-8) gives
$$
y = {i}_{D}^{1/2} \tag{C.1-9}
$$
$$
x = {v}_{GS} \tag{C.1-10}
$$
$$
m = {\left( \frac{{K}_{S}^{\prime }{W}_{\text{eff }}}{2{L}_{\text{eff }}}\right) }^{1/2} \tag{C.1-11}
$$
and
$$
b =  - {\left( \frac{{K}_{S}^{\prime }{W}_{\text{eff }}}{2{L}_{\text{eff }}}\right) }^{1/2}{V}_{T0} \tag{C.1-12}
$$
It can be seen from these equations that if ${i}_{D}^{1/2}$ versus ${v}_{GS}$ is plotted and the slope of the straight-line portion of the curve is measured, then ${K}_{S}^{\prime }$ can easily be extracted assuming that ${W}_{\text{eff }}$ and ${L}_{\text{eff }}$ are known. Moreover, when ${i}_{D}^{1/2} = 0$ the $x$ intercept is ${V}_{T0}$ . Figure C.1-1(a) illustrates these techniques. It is very important, in choosing a device to characterize, that the $W$ and $L$ are chosen large so that ${W}_{\text{eff }}$ and ${L}_{\text{eff }}$ are as close as possible to the drawn values, resulting in good accuracy when extracting ${K}_{S}^{\prime }$ .

Figure C.1-1 (a) ${i}_{D}^{1/2}$ versus ${v}_{GS}$ plot used to determine ${V}_{T0}$ and ${K}_{S}^{\prime }$ . (b) ${i}_{D}$ versus ${v}_{GS}$ plot to determine ${K}_{L}^{\prime }$ .
Numerical techniques such as linear regression may be used to extract the above parameters instead of the graphical techniques illustrated in Fig. C.1-1(a). A word of caution is in order before using numerical techniques. Second-order effects such as weak inversion current near ${v}_{GS} = {V}_{T0}$ and mobility degradation at large values of ${v}_{GS}$ can result in a best-fit line that is somewhat perturbed, thereby giving incorrect values for ${V}_{T0}$ and ${K}_{S}^{\prime }$ . Therefore, data that do not fit the model should not be used in the parameter-extraction procedure.
---
Example C. 1-1
---
## Determination of ${V}_{T0}$ and ${K}_{S}^{\prime }\left( {W/L}\right)$
Given the transistor data shown in Table C.1-1 and linear regression formulas based on the form
$$
y = {mx} + b
$$
$$
m = \frac{\sum {x}_{i}{y}_{i} - \left( {\sum {x}_{i}\sum {y}_{i}}\right) /n}{\sum {x}_{i}^{2} - {\left( \sum {x}_{i}\right) }^{2}/n} \tag{C.1-13}
$$
and
$$
b = \bar{y} = m\bar{x} \tag{C.1-14}
$$
determine ${V}_{T0}$ and ${K}_{S}^{\prime }W/{2L}$ . The data in Table C.1-1 also give ${i}_{D}^{1/2}$ as a function of ${V}_{GS}$ .
Table C.1-1 Data for Example C.1-1
<table><tr><td>${V}_{GS}\left( V\right)$</td><td>${I}_{D}\left( {\mu A}\right)$</td><td>$\sqrt{{I}_{D}}{\left( \mu A\right) }^{1/2}$</td><td>${V}_{SB}\left( V\right)$</td></tr><tr><td>1.000</td><td>0.700</td><td>0.837</td><td>0.000</td></tr><tr><td>1.200</td><td>2.00</td><td>1.414</td><td>0.000</td></tr><tr><td>1.500</td><td>8.00</td><td>2.828</td><td>0.000</td></tr><tr><td>1.700</td><td>13.95</td><td>3.735</td><td>0.000</td></tr><tr><td>1.900</td><td>22.1</td><td>4.701</td><td>0.000</td></tr></table>
## SOLUTION
The data must be checked for linearity before linear regression is applied. Checking slopes between data points is a simple numerical technique for determining linearity. Using the formula that
$$
\text{ Slope } = m = \frac{\Delta y}{\Delta x} = \frac{\sqrt{{I}_{D2}} - \sqrt{{I}_{D1}}}{{V}_{GS2} - {V}_{GS1}}
$$
gives
$$
{m}_{1} = \frac{{1.414} - {0.837}}{0.2} = {2.885}\;{m}_{2} = \frac{{2.828} - {1.414}}{0.3} = {4.713}
$$
$$
{m}_{3} = \frac{{3.735} - {2.828}}{0.2} = {4.535}\;{m}_{4} = \frac{{4.701} - {3.735}}{0.2} = {4.830}
$$
These results indicate that the first (lowest value of ${V}_{GS}$ ) data point is either bad or at a point where the transistor is in weak inversion. This data point will not be included in subsequent analysis. Performing the linear regression yields the following results:
$$
{V}_{T0} = {0.898}\mathrm{\;V}
$$
and
$$
\frac{{K}_{S}^{\prime }{W}_{\text{eff }}}{2{L}_{\text{eff }}} = {21.92\mu }\mathrm{A}/{\mathrm{V}}^{2}
$$
Next, consider the extraction of the parameter ${K}_{L}^{\prime }$ for the nonsaturation region of operation. Equation (C.1-5) can be rewritten as
$$
{i}_{D} = {K}_{L}^{\prime }\left( \frac{{W}_{\text{eff }}}{{L}_{\text{eff }}}\right) {v}_{DS}{v}_{GS} - {K}_{L}^{\prime }\left( \frac{{W}_{\text{eff }}}{{L}_{\text{eff }}}\right) {v}_{DS}\left( {{V}_{T} + \frac{{v}_{DS}}{2}}\right)  \tag{C.1-15}
$$
If ${i}_{D}$ is plotted versus ${v}_{GS}$ as shown in Fig. C.1-1(b), then the slope is seen to be
$$
m = \frac{\Delta {i}_{D}}{\Delta {v}_{GS}} = {K}_{L}^{\prime }\left( \frac{{W}_{\text{eff }}}{{L}_{\text{eff }}}\right) {v}_{DS} \tag{C.1-16}
$$
Knowing the slope, the term ${K}_{L}^{\prime }$ is easily determined to be
$$
{K}_{L}^{\prime } = m\left( \frac{{L}_{\text{eff }}}{{W}_{\text{eff }}}\right) \left( \frac{1}{{v}_{DS}}\right)  \tag{C.1-17}
$$
if ${W}_{\text{eff }},{L}_{\text{eff }}$ (assuming these are large to reduce the effects of dimensional variations and out-diffusion), and ${v}_{DS}$ are known. The approximate value of the zero-field mobility parameter ${\mu }_{o}$ can be extracted from the value of ${K}_{L}^{\prime }$ using Eq. (3.1-13). A more accurate technique for determining ${\mu }_{o}$ will be given in the next section.
At this point, $\gamma$ is unknown. Using the same techniques as before, Eq. (C.1-3) is written in the linear form, where
$$
y = {V}_{T} \tag{C.1-18}
$$
$$
x = \sqrt{2\left| {\phi }_{F}\right|  + {v}_{SB}} - \sqrt{2\left| {\phi }_{F}\right| } \tag{C.1-19}
$$
$$
m = \gamma  \tag{C.1-20}
$$
$$
b = {V}_{T0} \tag{C.1-21}
$$
The term $2\left| {\phi }_{F}\right|$ is unknown but is normally in the range of ${0.6} - {0.7}\mathrm{\;V}$ . Once $\gamma$ is calculated, then ${N}_{SUB}$ can be calculated using Eq. (3.1-4) and $2\left| {\phi }_{F}\right|$ can be calculated using Eq. (3.1-5). This value can then be used in with Eqs. (C.1-18) through (C.1-21) to determine a new value of $\gamma$ . Iterative procedures can be used to achieve the desired accuracy of $\gamma$ and $2 \mid  {\phi }_{F}$ . Generally, an approximate value for $2\left| {\phi }_{F}\right|$ gives adequate results.
By plotting ${V}_{T}$ versus $x$ of Eq. (C.1-19) one can measure the slope of the best-fit line from which the parameter $\gamma$ can be extracted. In order to do this, ${V}_{T}$ must be determined at various values of ${v}_{SB}$ using the technique previously described. Figure C.1-2 illustrates the procedure. Each ${V}_{T}$ determined in Fig. C.1-2 must be plotted against the ${v}_{SB}$ term. The result is shown in Fig. C.1-3. The slope $m$ , measured from the best-fit line, is the parameter $\gamma$ . Determination of $\gamma$

Figure C.1-2 ${i}_{D}^{1/2}$ versus ${v}_{GS}$ plot at different ${v}_{SB}$ values to determine $\gamma$ .

Figure C.1-3 Plot of ${V}_{T}$ versus $f\left( {v}_{SB}\right)$ to determine $\gamma$ .
---
Example C. 1-2
---
Using the results from Example C.1-1 and the following transistor data, determine the value of $\gamma$ using linear regression techniques. Assume that $2\left| {\phi }_{F}\right|$ is ${0.6}\mathrm{\;V}$ .
SOLUTION
Table C.1-2 shows data for ${V}_{SB} = 1\mathrm{\;V}$ and ${V}_{SB} = 2\mathrm{\;V}$ . A quick check of the data in this table reveals that ${I}_{D}^{1/2}$ versus ${V}_{GS}$ appears linear and thus may be used in the linear regression analysis.
Table C.1-2 Data for Example C.1-2
<table><tr><td>${V}_{SB}\left( V\right)$</td><td>${V}_{GS}\left( V\right)$</td><td>${I}_{D}\left( {\mu A}\right)$</td></tr><tr><td>1.000</td><td>1.400</td><td>1.431</td></tr><tr><td>1.000</td><td>1.600</td><td>4.55</td></tr><tr><td>1.000</td><td>1.800</td><td>9.44</td></tr><tr><td>1.000</td><td>2.000</td><td>15.95</td></tr><tr><td>2.000</td><td>1.700</td><td>3.15</td></tr><tr><td>2.000</td><td>1.900</td><td>7.43</td></tr><tr><td>2.000</td><td>2.10</td><td>13.41</td></tr><tr><td>2.000</td><td>2.30</td><td>21.2</td></tr></table>
Using the same procedure as in Example C.1-1, the following thresholds are determined: ${V}_{T0}$ $= {0.898}\mathrm{\;V}$ (from Example C.1-1), ${V}_{T} = {1.143}\mathrm{\;V}\left( {{V}_{SB} = 1\mathrm{\;V}}\right)$ , and ${V}_{T} = {1.322}\mathrm{\;V}\left( {{V}_{SB} = 2\mathrm{\;V}}\right)$ . Table C.1-3 gives the value of ${V}_{T}$ as a function of $\left\lbrack  {{\left( 2\left| {\phi }_{F}\right|  + {v}_{SB}\right) }^{1/2} - {\left( 2\left| {\phi }_{F}\right| \right) }^{1/2}}\right\rbrack$ for the three values of ${V}_{SB}$ . With these data, linear regression must be performed on the data of ${V}_{T}$ versus $\left\lbrack  {{\left( 2\left| {\phi }_{F}\right|  + {v}_{SB}\right) }^{1/2} - {\left( 2\left| {\phi }_{F}\right| \right) }^{1/2}}\right\rbrack$ . The regression parameters of Eq. (C.1-13) are
$$
\sum {x}_{i}{y}_{i} = {1.668}
$$
$$
\sum {x}_{i}\sum {y}_{i} = {4.466}
$$
$$
\sum {x}_{i}^{2} = {0.9423}
$$
$$
{\left( \sum {x}_{i}\right) }^{2} = {1.764}
$$
These values give $m = {0.506} = \gamma$ .
Table C.1-3 Data for Example C.1-2
<table><tr><td>${V}_{SB}\left( V\right)$</td><td>${V}_{T}\left( V\right)$</td><td>$\left\lbrack  {\sqrt{2\left| {\phi }_{F}\right|  + {V}_{SB}} - \sqrt{2\left| {\phi }_{F}\right| }}\right\rbrack$</td></tr><tr><td>0.000</td><td>0.898</td><td>0.000</td></tr><tr><td>1.000</td><td>1.143</td><td>0.490</td></tr><tr><td>2.000</td><td>1.322</td><td>0.838</td></tr></table>
The three major parameters of the simple model have been determined and all that is left to do is extract the three remaining parameters: $\lambda ,{\Delta L}$ , and ${\Delta W}$ . The channel length modulation parameter $\lambda$ should be determined for all device lengths that might be used. For the sake of simplicity, Eq. (C.1-4) is rewritten as
$$
{i}_{D} = {i}_{D}^{\prime }\lambda {v}_{DS} + {i}_{D}^{\prime } \tag{C.1-22}
$$
which is in the familiar linear form where
$$
y = {i}_{D}\text{ [Eq. (C.1-4)] } \tag{C.1-23}
$$
$$
x = {v}_{DS} \tag{C.1-24}
$$
$$
m = \lambda {i}_{D}^{\prime } \tag{C.1-25}
$$
$$
b = {i}_{D}^{\prime }\;\text{ [Eq.(C.1-4) with }\lambda  = 0\rbrack  \tag{C.1-26}
$$
By plotting ${i}_{D}$ versus ${v}_{DS}$ , measuring the slope of the data in the saturation region, and dividing that value by the $y$ intercept, $\lambda$ can be determined. Figure C.1-4 illustrates the procedure demonstrated by the following example.

Figure C.1-4 Plot of ${i}_{D}$ versus ${v}_{DS}$ to determine $\lambda$ .
Determination of $\lambda$
Given the data of ${I}_{D}$ versus ${V}_{DS}$ in Table C.1-4, determine the parameter $\lambda$ . SOLUTION
Table C.1.4 Data for Example C.1.3
<table><tr><td>${I}_{D}\left( {\mu A}\right)$</td><td>${V}_{DS}\left( V\right)$</td></tr><tr><td>39.2</td><td>0.500</td></tr><tr><td>68.2</td><td>1.000</td></tr><tr><td>86.8</td><td>1.500</td></tr><tr><td>94.2</td><td>2.000</td></tr><tr><td>95.7</td><td>2.50</td></tr><tr><td>97.2</td><td>3.00</td></tr><tr><td>98.8</td><td>3.50</td></tr><tr><td>100.3</td><td>4.00</td></tr></table>
We note that the data of Table C.1-4 cover both the saturation and nonsaturation regions of operation. A quick check shows that saturation is reached near ${v}_{DS} = {2.0}\mathrm{\;V}$ . To calculate $\lambda$ , we shall use the data for ${v}_{DS}$ greater than or equal to ${2.5}\mathrm{\;V}$ . The parameters of the linear regression are
$$
\sum {x}_{i}{y}_{i} = {1277.85}
$$
$$
\sum {x}_{i}\sum {y}_{i} = {5096.00}
$$
$$
\sum {x}_{i}^{2} = {43.5}
$$
$$
{\left( \sum {x}_{i}\right) }^{2} = {169.0}
$$
These values result in $m = \lambda {i}_{D}^{\prime } = {3.08}$ and $b = {i}_{D}^{\prime } = {88}$ , giving $\lambda  = {0.035}{\mathrm{\;V}}^{-1}$ .
The slope in the saturation region is typically very small, making it necessary to be careful that two data points taken with low resolution are not subtracted (to obtain the slope), resulting in a number that is of the same order of magnitude as the resolution of the data point measured. If this occurs, then the value obtained will have significant and unacceptable error.
In the equations presented thus far, ${L}_{\text{eff }}$ and ${W}_{\text{eff }}$ have been used to describe the transistor's length and width, respectively. This terminology has been used because these dimensions, as they result in fabricated form, differ from the drawn values (due to outdiffusion, oxide encroachment, mask tolerance, etc.). The following analysis will determine the difference between the effective and drawn values.
Consider two transistors, with the same widths but different lengths, operating in the nonsaturation region with the same ${v}_{DS}$ . The widths of the transistors are assumed to be very large so that $W \approx  {W}_{\text{eff }}$ . The large-signal model is given as
$$
{i}_{D} = \frac{{K}_{L}^{\prime }{W}_{\text{eff }}}{{L}_{\text{eff }}}\left\lbrack  {\left( {{v}_{GS} - {V}_{T0}}\right) {v}_{DS} - \left( \frac{{v}_{DS}^{2}}{2}\right) }\right\rbrack   \tag{C.1-27}
$$
---
Example C. 1-3
---
and
$$
\frac{\partial {i}_{D}}{\partial {v}_{GS}} = {g}_{m} = \left( \frac{{K}_{L}^{\prime }{W}_{\text{eff }}}{{L}_{\text{eff }}}\right) {V}_{DS} \tag{C.1-28}
$$
The aspect ratios $\left( {W/L}\right)$ for the two transistors are
$$
\frac{{W}_{1}}{{L}_{1} + {\Delta L}} \tag{C.1-29}
$$
and
$$
\frac{{W}_{2}}{{L}_{2} + {\Delta L}} \tag{C.1-30}
$$
Implicit in Eqs. (C.1-29) and (C.1-30) is that ${\Delta L}$ is assumed to be the same for both transistors. Combining Eq. (C.1-28) with Eqs. (C.1-29) and (C.1-30) gives
$$
{g}_{m1} = \frac{{K}_{L}^{\prime }W}{{L}_{1} + {\Delta L}}{v}_{DS} \tag{C.1-31}
$$
and
$$
{g}_{m2} = \frac{{K}_{L}^{\prime }W}{{L}_{2} + {\Delta L}}{v}_{DS} \tag{C.1-32}
$$
where ${W}_{1} = {W}_{2} = W$ (and are assumed to equal the effective width). With further algebraic manipulation of Eqs. (C.1-31) and (C.1-32), one can show that
$$
\frac{{g}_{m1}}{{g}_{m1} - {g}_{m2}} = \frac{{L}_{2} + {\Delta L}}{{L}_{2} - {L}_{1}} \tag{C.1-33}
$$
which further yields
$$
{L}_{2} + {\Delta L} = {L}_{\text{eff }} = \frac{\left( {{L}_{2} - {L}_{1}}\right) {g}_{m1}}{{g}_{m1} - {g}_{m2}} \tag{C.1-34}
$$
The values of ${L}_{2}$ and ${L}_{1}$ are known and the small-signal parameters ${g}_{m1}$ and ${g}_{m2}$ can be measured so that ${L}_{\text{eff }}$ (or ${\Delta L}$ ) can be calculated. Similar analysis can be performed to obtain ${W}_{\text{eff }}$ , yielding the following result:
$$
{W}_{2} + {\Delta W} = {W}_{\text{eff }} = \frac{\left( {{W}_{1} - {W}_{2}}\right) {g}_{m2}}{{g}_{m1} - {g}_{m2}} \tag{C.1-35}
$$
Equation (C.1-35) is valid when two transistors have the same length but different widths.
One must be careful in determining ${\Delta L}$ (or ${\Delta W}$ ) to make the lengths (or widths) sufficiently different in order to avoid the numerical error due to subtracting large numbers, and small enough that the transistor model chosen is still valid for both transistors. The following example demonstrates the determination of ${\Delta L}$ .
---
Example C. 1-4
---
## Determination of ${\Delta L}$
Given two transistors with the same widths and different lengths, determine ${L}_{\text{eff }}$ and ${\Delta L}$ based on the following data:
$$
{W}_{1}/{L}_{1} = {20\mu }\mathrm{m}/{10\mu }\mathrm{m}\text{(drawn dimensions)}
$$
$$
{W}_{2}/{L}_{2} = {20\mu }\mathrm{m}/{20\mu }\mathrm{m}\text{(drawn dimensions)}
$$
$$
{g}_{m1} = {6.65\mu }\mathrm{S}\text{ at }{v}_{DS} = {0.1}\mathrm{\;V}\text{ and }{i}_{D} = {6.5\mu }\mathrm{A}
$$
$$
{g}_{m2} = {2.99\mu }\mathrm{S}\text{at}{v}_{DS} = {0.1}\mathrm{\;V}\text{and}{i}_{D} = {2.75\mu }\mathrm{A}
$$
SOLUTION
Using Eq. (C.1-34), ${L}_{\text{eff }}$ can be determined as follows:
$$
{L}_{\text{eff }} = {L}_{2} + {\Delta L} = \left( {{20} - {10}}\right) \left( {6.65}\right) /\left( {{6.65} - {2.99}}\right)  = {18.17\mu }\mathrm{m}
$$
Therefore, ${\Delta L} =  - {1.83\mu }\mathrm{m}$ . From this result, we can estimate the lateral diffusion(LD)as
$$
{LD} = \left| {\Delta L}\right| /2 = {0.915\mu }\mathrm{m}
$$
In this section, we have shown how to characterize the simple model parameters ${V}_{T0},{K}_{S}^{\prime }$ , ${K}_{L}^{\prime },\gamma ,2\left| {\phi }_{F}\right| ,\lambda ,{\Delta L}$ , and ${\Delta W}$ . We have assumed that $2\left| {\phi }_{F}\right|$ could be determined by iteration if ${N}_{SUB}$ were known. (If ${N}_{SUB}$ is not known, then ${N}_{SUB}$ must be measured by other means, for example, bulk resistance.) Also, one must remember that these model parameters, with the exception of $\lambda ,{\Delta L}$ , and ${\Delta W}$ , are dependent on temperature.
### C.2 l/f Noise
In many applications, good noise performance is a very important requirement for an analog design. Consequently, the noise performance of transistors must be characterized. The equation defining the mean-square noise current in an MOS transistor given in Eq. (3.2-12) is repeated here.
$$
{i}_{n}^{2} = \left\lbrack  {\frac{{8kT}{g}_{m}\left( {1 + \eta }\right) }{3} + \frac{\left( {KF}\right) {I}_{D}}{f{C}_{ox}{L}^{2}}}\right\rbrack  {\Delta f}\left( {A}^{2}\right)  \tag{C.2-1}
$$
All notation is consistent with that in Section 3.2. At high frequencies the first term in Eq. (C.2-1) dominates, whereas at low frequencies the second term dominates. Since the second term is the only one with model parameters, it is the only portion of the expression that must be considered for characterization. Equation (C.2-2) describes the mean-square noise current at low frequencies as
$$
{i}_{n}^{2} = \left\lbrack  \frac{\left( {KF}\right) {I}_{D}}{f{C}_{\mathrm{{ox}}}{L}^{2}}\right\rbrack  {\Delta f}\;\left( {\mathrm{\;A}}^{2}\right)  \tag{C.2-2}
$$
This mean-square noise current is represented as a current source across the drain and source nodes in the small-signal model for the transistor. This is illustrated in Fig. C.2-1. Since noise is more generally considered at the input rather than the output, the input-referred noise current is given by multiplying Eq. (C.2-2) by ${g}_{m}{}^{-2}$ to get
$$
{e}_{n}^{2} = \left\lbrack  \frac{\left( {KF}\right) {I}_{D}}{{g}_{m}^{2}f{C}_{\mathrm{{ox}}}{L}^{2}}\right\rbrack  {\Delta f}\;\left( {\mathrm{\;V}}^{2}\right)  \tag{C.2-3}
$$
Substituting the relationship for ${g}_{m}$ in the saturation region
$$
{g}_{m} = \sqrt{2{K}_{S}^{\prime }\left( {W/L}\right) {I}_{D}} \tag{C.2-4}
$$
into Eq. (C.2-3) gives a convenient form for the input-noise voltage
$$
{e}_{n}^{2} = \left\lbrack  \frac{KF}{2{K}_{S}^{\prime }{WLf}{C}_{\mathrm{{ox}}}}\right\rbrack  {\Delta f}\;\left( {\mathrm{\;V}}^{2}\right)  \tag{C.2-5}
$$
For characterization purposes, assume that the noise voltage is measured at a $1\mathrm{\;{Hz}}$ bandwidth so that the ${\Delta f}$ term is unity. Equation (C.2-5) can be rewritten as
$$
\log \left\lbrack  {\mathrm{e}}_{n}^{2}\right\rbrack   = \log \left\lbrack  \frac{KF}{2{K}_{S}^{\prime }{WL}{C}_{\mathrm{{ox}}}}\right\rbrack   - \log \left\lbrack  f\right\rbrack   \tag{C.2-6}
$$
By plotting $\log \left\lbrack  f\right\rbrack$ versus $\log \left\lbrack  {e}_{n}^{2}\right\rbrack$ and measuring the intercept, which is
$$
\log \left\lbrack  \frac{KF}{2{K}_{S}^{\prime }{WL}{C}_{\mathrm{{ox}}}}\right\rbrack
$$
one can extract the parameter ${KF}$ .

Figure C.2-1 Small-signal MOS transistor model including noise current.
### C.3 Characterization of Other Active Components
In the previous sections, characterization of most of the more important parameters of the large-signal MOS model has been covered. This section will be devoted to characterization of other components found in a typical CMOS process.
One of the important active components available to the CMOS designer is a substrate bipolar junction transistor (BJT) (see Section 2.5). The collector of this BJT is always common with the substrate of the CMOS process. For example, if the CMOS process is a p-well process, the $n$ -substrate is the collector, the $p$ -well is the base, and the ${n}^{ + }$ diffusions in the $p$ - well are the emitter. The substrate BJT is used primarily for two applications. The first is as an output driver. Because the ${g}_{m}$ of a BJT is greater than the ${g}_{m}$ of an MOS device, the output impedance, which is typically $1/{g}_{m}$ , is lower for a BJT. The second application is in bandgap voltage-reference circuits. For these two applications, the parameters of interest are the dc beta, ${\beta }_{\mathrm{{dc}}}$ , and the leakage current density, ${J}_{S}$ . We are also interested in the dependence of ${\beta }_{\mathrm{{dc}}}$ on dc emitter current. These parameters affect device operation as defined by the following equations. For ${v}_{BE} >  > {kT}/q$ ,
$$
{v}_{BE} = \frac{kT}{q}\ln \left( \frac{{i}_{c}}{{J}_{S}{A}_{E}}\right)  \tag{C.3-1}
$$
and
$$
{\beta }_{dc} = \frac{{i}_{E}}{{i}_{B}} - 1 \tag{C.3-2}
$$
${A}_{E}$ is the cross-sectional area of the emitter-base junction of the BJT. In order to determine the parameter ${\beta }_{\mathrm{{dc}}}$ , Eq. (C.3-2) can be rearranged to the form given in Eq. (C.3-3), which gives ${i}_{E}$ as a function of ${i}_{B}$ in a linear equation:
$$
{i}_{E} = {i}_{B}\left( {{\beta }_{dc} + 1}\right)  \tag{C.3-3}
$$
The current ${i}_{B}$ can be plotted as a function of ${i}_{E}$ , and the slope measured to determine ${\beta }_{\mathrm{{dc}}}$ . Once ${\beta }_{\mathrm{{dc}}}$ is known, then Eq. (C.3-1) can be rearranged and modified as follows:
$$
{v}_{BE} = \frac{kT}{q}\ln \left( \frac{{i}_{E}{\beta }_{dc}}{1 + {\beta }_{dc}}\right)  - \frac{kT}{q}\ln \left( {{J}_{S}{A}_{E}}\right)  = \frac{kT}{q}\ln \left( {{\alpha }_{\mathrm{{dc}}}{i}_{E}}\right)  - \frac{kT}{q}\ln \left( {{J}_{S}{A}_{E}}\right)  \tag{C.3-4}
$$
Plotting $\ln \left\lbrack  {{i}_{E}{\beta }_{\mathrm{{dc}}}/\left( {1 + {\beta }_{\mathrm{{dc}}}}\right) }\right\rbrack$ versus ${v}_{BE}$ results in a graph where
$$
m = \text{ slope } = \frac{kT}{q} \tag{C.3-5}
$$
and
$$
b = y - \text{ intercept } =  - \left( \frac{kT}{q}\right) \ln \left( {{J}_{S}{A}_{E}}\right)  \tag{C.3-6}
$$
Since the emitter area is known, ${J}_{S}$ can be determined directly.
Determination of ${\beta }_{\mathrm{{DC}}}$ and ${J}_{S}$
Consider a bipolar transistor with a ${1000\mu }{\mathrm{m}}^{2}$ emitter area on which the following data have been taken:
<table><tr><td>${I}_{E}\left( {\mu A}\right)$</td><td>${I}_{B}\left( {\mu A}\right)$</td><td>${V}_{BE}\left( \mathrm{\;V}\right)$</td></tr><tr><td>100</td><td>0.90</td><td>0.540</td></tr><tr><td>136</td><td>1.26</td><td>0.547</td></tr><tr><td>144</td><td>1.29</td><td>0.548</td></tr><tr><td>200</td><td>1.82</td><td>0.558</td></tr><tr><td>233</td><td>2.11</td><td>0.560</td></tr></table>
Using these data, determine ${\beta }_{\mathrm{{dc}}}$ and ${J}_{S}$ .
## SOLUTION
The data for ${I}_{E}$ versus ${I}_{B}$ can be analyzed using linear regression techniques to determine the slope $m$ . The result is
$$
m = {110} = {\beta }_{\mathrm{{dc}}}
$$
With ${\beta }_{\mathrm{{dc}}}$ known, the terms of Eq. (C.3-4) can be tabulated to obtain the slope and intercept, from which ${J}_{S}$ can be calculated. The table below supplies the $x$ and $y$ terms of Eq. (C.3-4) for subsequent calculation.
<table><tr><td>${V}_{\mathrm{{BE}}}\left( V\right)$</td><td>$\ln \left\lbrack  {{I}_{E}{\mathbf{\beta }}_{\mathrm{{dc}}}/\left( {1 + {\mathbf{\beta }}_{\mathrm{{dc}}}}\right) }\right\rbrack$</td></tr><tr><td>0.540</td><td>-9.20</td></tr><tr><td>0.547</td><td>-8.89</td></tr><tr><td>0.548</td><td>-8.84</td></tr><tr><td>0.558</td><td>-8.51</td></tr><tr><td>0.560</td><td>-8.36</td></tr></table>
From these data, the slope and intercept are calculated as
$$
m = {0.025}\mathrm{\;V} = {kT}/q
$$
$$
b = {0.769} =  - \left( {{kT}/q}\right) \left\lbrack  {\ln \left( {{J}_{S}{A}_{E}}\right) }\right\rbrack
$$
from which ${J}_{S}{A}_{E}$ is determined to be 43.8 fA. With an emitter area of ${1000\mu }{\mathrm{m}}^{2},{J}_{S} = {4.38} \times$ ${10}^{-{17}}\mathrm{\;A}/{\mathrm{{\mu m}}}^{2}$ .
---
Example C. 3-1
---
### C.4 Characterization of Resistive Components
Thus far, characterization procedures for the primary active components available to the circuit designer in a typical CMOS process have been developed. This section will deal with passive components and their parasitics. These include resistors, contact resistance, and capacitance.
Consider first the characterization of sheet resistance. While there are a number of ways to do this, the most useful results can be obtained by characterizing resistor geometries exactly as they will be implemented in a design. This is advantageous because (1) sheet resistance is not constant across the width of a resistor, (2) the effects of bends result in inaccuracies, and (3) termination effects are not accurately predictable. Therefore, a resistor should be characterized as a function of width and the effects of bends and terminations should carefully be considered.
Figure C.4-1 illustrates a structure that can be used to determine sheet resistance and geometry width variation (bias) [1]. By forcing a current into node $A$ with node $F$ grounded while measuring the voltage drops across ${BC}\left( {V}_{n}\right)$ and ${DE}\left( {V}_{w}\right)$ , the resistors ${R}_{n}$ and ${R}_{w}$ can be determined as follows:
$$
{R}_{n} = \frac{{V}_{n}}{I} \tag{C.4-1}
$$
$$
{R}_{w} = \frac{{V}_{w}}{I} \tag{C.4-2}
$$
The sheet resistance can be determined from these to be
$$
{R}_{S} = {R}_{n}\left( \frac{{W}_{n} - \text{ Bias }}{{L}_{n}}\right)  \tag{C.4-3}
$$
$$
{R}_{S} = {R}_{w}\left( \frac{{W}_{w} - \text{ Bias }}{{L}_{w}}\right)  \tag{C.4-4}
$$
where
$$
{R}_{n} = \text{resistance of narrow resistor}\left( \Omega \right)
$$
$$
{R}_{w} = \text{resistance of wide resistor}\left( \Omega \right)
$$

Figure C.4-1 Sheet resistance and bias monitor.
${R}_{S} =$ sheet resistance of material [polysilicon, diffusion, etc. $\left( {\Omega /\square }\right)$ ]
${L}_{n} =$ drawn length of narrow resistor
${L}_{w} =$ drawn length of wide resistor
${W}_{n} =$ drawn width of narrow resistor
${W}_{w} =$ drawn width of wide resistor
Bias $=$ difference between drawn width and actual device width
Solving Eq. (C.4-3) and (C.4-4) yields
$$
\text{ Bias } = \frac{{W}_{n} - k{W}_{w}}{1 - k} \tag{C.4-5}
$$
where
$$
k = \frac{{R}_{w}{L}_{n}}{{R}_{n}{L}_{w}} \tag{C.4-6}
$$
and
$$
{R}_{s} = {R}_{n}\left( \frac{{W}_{n} - \text{ Bias }}{{L}_{n}}\right)  = {R}_{w}\left( \frac{{W}_{w} - \text{ Bias }}{{L}_{w}}\right)  \tag{C.4-7}
$$
This technique eliminates any effects due to contact resistance since no appreciable current flows through a contact causing a voltage drop. The example that follows illustrates the use of this technique.
---
Example C. 4-1
---
## Determination of ${R}_{S}$ and Bias
Consider the structure shown in Fig. C.4-1 where the various dimensions are given below:
$$
{W}_{n} = {10\mu }\mathrm{m}\;{L}_{n} = {40\mu }\mathrm{m}
$$
$$
{W}_{w} = {50\mu }\mathrm{m}\;{L}_{w} = {200\mu }\mathrm{m}
$$
A current of $1\mathrm{\;{mA}}$ is forced into node $A$ with node $F$ grounded. The following voltages are measured:
$$
{V}_{n} = {133.3}\mathrm{\;{mV}}
$$
$$
{V}_{w} = {122.5}\mathrm{{mV}}
$$
Therefore, ${R}_{n}$ and ${R}_{w}$ are
$$
{R}_{n} = \frac{0.1333}{0.001} = {133.3\Omega }
$$
$$
{R}_{w} = \frac{0.1225}{0.001} = {122.5\Omega }
$$
Determine the sheet resistance ${R}_{s}$ and Bias.
SOLUTION
Using Eq. (C.4-6), the value $k$ is calculated to be
$$
k = \frac{{R}_{w}{L}_{n}}{{R}_{n}{L}_{w}} = \frac{{122.5}\left( {40}\right) }{{133.3}\left( {200}\right) } = {0.184}
$$
Use Eq. (C.4-5) with the value calculated for $k$ to determine Bias:
$$
\text{ Bias } = \frac{{10} - \left( {0.184}\right) {50}}{1 - {0.184}} = {0.98\mu }\mathrm{m}
$$
Having calculated the Bias, the sheet resistance can be determined using Eq. (C.4-7):
$$
{R}_{s} = {133.3}\left( \frac{{10} - {0.98}}{40}\right)  = {30.06\Omega }/\square
$$
Further work can be done to determine not only the sheet resistivity of the resistor but also the contact resistance. Consider the two resistors shown in Fig. C.4-2. The values of these two resistors are (assuming contact resistance is the same for both)
$$
{R}_{A} = {R}_{1} + 2{R}_{c};\;{R}_{1} = {N}_{1}{R}_{S} \tag{C.4-8}
$$

Figure C.4-2 Two resistors used to determine ${R}_{S}$ and ${R}_{C}$ .
and
$$
{R}_{B} = {R}_{2} + 2{R}_{c};\;{R}_{2} = {N}_{2}{R}_{S} \tag{C.4-9}
$$
where ${N}_{1}$ is the number of squares for ${R}_{1},{R}_{S}$ is the sheet resistivity in $\Omega /\square$ , and ${R}_{c}$ is the contact resistance. These two equations can be solved simultaneously to get
$$
{R}_{S} = \frac{{R}_{B} - {R}_{A}}{{N}_{2} - {N}_{1}} \tag{C.4-10}
$$
and
$$
2{R}_{c} = {R}_{A} - {N}_{1}{R}_{S} = {R}_{B} - {N}_{2}{R}_{S} \tag{C.4-11}
$$
The application of these equations is illustrated in the following example.
---
Example C. 4-2
---
## Calculation of Contact Resistance and Sheet Resistivity
Consider the resistors shown in Fig. C.4-2.
## SOLUTION
Their values can be expressed as
$$
{R}_{A} = 2{R}_{c} + {10}{R}_{S}
$$
and
$$
{R}_{B} = 2{R}_{c} + {20}{R}_{S}
$$
The measured values for ${R}_{A}$ and ${R}_{B}$ are ${220\Omega }$ and ${420\Omega }$ , respectively. Using Eqs. (C.4-8) and (C.4-9), ${R}_{S}$ and ${R}_{c}$ are determined to be
$$
{R}_{S} = \frac{{R}_{B} - {R}_{A}}{{N}_{2} - {N}_{1}} = \frac{{420} - {220}}{{20} - {10}} = {20\Omega }/\square
$$
$$
2{R}_{c} = {R}_{A} - {N}_{1}{R}_{S} = {220} - {10}\left( {20}\right)  = {20\Omega }
$$
$$
{R}_{c} = {10\Omega }
$$
Lightly doped resistors, p- or n-well, and pinched resistors should be characterized considering the backbias effects of the substrate in which the resistor is fabricated (i.e., the effect of the potential difference between a resistor and the substrate into which it is diffused). In order to do this, one should measure the resistance as a function of the voltage between the terminals and the substrate. This is illustrated in Fig. C.4-3. Depending on the application, one may prefer

Figure C.4-3 n-Well resistor illustrating backbias dependence.
to characterize the resistor as a function of the backbias voltage with tabulated values as the result, or model the resistor as a JFET, resulting in model equations similar to those presented for the MOSFET. Figure C.4-4 shows the dependence of p-well resistance on the backbias.
A simpler method for directly determining contact resistance might be more appropriate in some cases. Figure C.4-5 shows a structure [1] that has two different materials (metal and some other material) contacting together through a single contact. The equivalent circuit for this structure is shown in Fig. C.4-6. It is easy to see that if current is forced between pads 1 and 2 while voltage is measured across pads 3 and 4 , the resulting ratio of voltage to current is the contact resistance.
### C.5 Characterization of Capacitance
Various capacitors are encountered in a CMOS process. They can be broken into two types: MOS and depletion capacitance. The MOS capacitors include parasitic capacitors such as ${C}_{GS},{C}_{GD}$ , and ${C}_{GB}$ . The depletion capacitors are ${C}_{DB}$ and ${C}_{SB}$ . There are various interconnect capacitors that must also be characterized. These include ${C}_{\text{poly-field }},{C}_{\text{metal-field }}$ , and ${C}_{\text{metal-poly }}$ . It is desirable to characterize these capacitors for use in simulation models (e.g., the SPICE circuit simulator) and for use as parasitic circuit components to be included in circuit simulations. The capacitors that must be characterized for use in the SPICE transistor model are CGSO, CGDO, and CGBO (at ${V}_{GS} = {V}_{GB} = 0$ ). Normally, SPICE calculates ${C}_{DB}$ and ${C}_{SB}$ using the areas of the drain and source and the junction (depletion) capacitance, CJ (zero-bias value), that it calculates internally from other model parameters. Two of these model parameters,

Figure C.4-4 n-Well resistance as a function of backbias voltage.

MJ and MJSW, are used to calculate the depletion capacitance as a function of voltage across the capacitor. The other parasitic capacitors must be characterized so that interconnect capacitors can be estimated and included in circuit simulations.
Consider the transistor-parasitic capacitors CGSO, CGDO, and CGBO. The first two, CGSO and CGDO, are modeled in SPICE as a function of the device width, while the capacitor CGBO is per length of the device. All three capacitors are in units of $\mathrm{F}/\mathrm{m}$ in the SPICE model. The gate/drain overlap capacitors for typical transistor structures are small so that direct measurement, although possible, is difficult. In order to reduce the requirements on the measurement setup, it is desirable to multiply the parasitic capacitance of interest, that is, measure the ${C}_{GS}$ of a very wide transistor and divide the result by the width in order to get CGSO (per unit width). An example of a test structure useful for measuring ${C}_{GS}$ and ${C}_{DS}$ is given in Fig. C.5-1 [2]. This structure uses multiple, very wide transistors to achieve large, easily measurable capacitors. The metal line connecting to the source and drain that runs parallel to the gate should be sufficiently separated from the gate to minimize the gate to metal capacitance. Figure C.5-2 shows an experimental setup for measuring the gate to drain/source capacitance. The capacitance measured is
$$
{C}_{\text{meas }} = W\left( n\right) \left( {\mathrm{{CGSO}} + \mathrm{{CGDO}}}\right)  \tag{C.5-1}
$$

Figure C.4-6 Electrical equivalent circuit of Fig. C.4-5.

Figure C.5-1 Structure for determining ${C}_{GS}$ and ${C}_{GD}$ .
where
${C}_{\text{meas }} =$ total measured capacitance
$W =$ total width of one of the transistors
$n =$ total number of transistors
Assuming CGSO and CGDO are equal, they can be determined from the measured data using Eq. (C.5-1).

Figure C.5-2 Experimental setup for measuring ${C}_{GS}$ and ${C}_{GD}$ .

Figure C.5-3 Structure for measuring ${C}_{GS}$ and ${C}_{{GD},}$ including fringing effects, for transistors having small $L$ .
For very narrow transistors, the capacitance determined using the previous technique will not be very accurate because of fringe field and other edge effects at the edge of the transistor. In order to characterize CGSO and CGDO for these narrow devices, a structure similar to that given in Fig. C.5-1 can be used, substituting different device sizes. Such a structure is given in Fig. C.5-3. The equations used to calculate the parasitic capacitors are the same as those given in Eq. (C.5-1).
The capacitance CGBO is due to the overhang (see Rule 3.3 of Table B-1) of the transistor gate required at one end as shown in Fig. C.5-4. This capacitance is approximated from the interconnect capacitance ${C}_{\text{poly-field }}$ (note that the overhang capacitor is not a true parallel plate capacitor due to the field-oxide gradient). Therefore, the first step in characterizing CGBO is to obtain a value for ${C}_{\text{poly-field }}$ by measuring the total capacitance of a strip of poly-silicon on field (width should be chosen to be the same as the desired device length) and divide this value by the total area as given in the following relationship:
$$
{C}_{\text{poly-field }} = \frac{{C}_{\text{meas }}}{{L}_{R}{W}_{R}}\;\left( {\mathrm{\;F}/{\mathrm{m}}^{2}}\right)  \tag{C.5-2}
$$
where
$$
{C}_{\text{meas }} = \text{measured value of the polysilicon strip}
$$
$$
{L}_{R} = \text{length of the centerline of the polysilicon strip}
$$

Figure C.5-4 Illustration of gate-to-bulk and poly-field capacitance.
${W}_{R} =$ width of the polysilicon strip (usually chosen as device length)
Having determined ${C}_{\text{poly-field }}$ , CGBO can be approximated as (see Fig. 3.2-6)
$$
\mathrm{{CGBO}} \cong  2\left( {C}_{\text{poly-field }}\right) \left( {d}_{\text{overhang }}\right)  = 2{C}_{5}\;\left( {\mathrm{\;F}/\mathrm{m}}\right)  \tag{C.5-3}
$$
where
$$
{d}_{\text{overhang }} = \text{overhang dimension (see Rule 3.3, Table B-1)}
$$
Next, consider the junction capacitors ${C}_{BD}$ and ${C}_{BS}$ . As described by Eqs. (3.2-5) and (3.2-6), these capacitors are made up of a bottom and a sidewall component. For convenience, the equations are given here using slightly different notation.
$$
\mathrm{{CJ}}\left( {V}_{J}\right)  = A \cdot  \mathrm{{CJ}}\left( 0\right) {\left( 1 + \frac{{V}_{J}}{\mathrm{{PB}}}\right) }^{-\mathrm{{MJ}}} + P \cdot  \mathrm{{CJSW}}\left( 0\right) {\left( 1 + \frac{{V}_{J}}{\mathrm{{PB}}}\right) }^{-\mathrm{{MJSW}}} \tag{C.5-4}
$$
where
${V}_{J} =$ the reverse-bias voltage across the junction
$$
\mathrm{{CJ}}\left( {V}_{J}\right)  = \text{bottom junction capacitance at}{V}_{J}
$$
$$
\operatorname{CJSW}\left( {V}_{J}\right)  = \text{junction capacitance of sidewall at}{V}_{J}
$$
$$
A = \text{area of the (bottom) of the capacitor}
$$
$$
P = \text{perimeter of the capacitor}
$$
$$
\mathrm{{PB}} = \text{bulk junction potential}
$$
The constants CJ and MJ can be determined by measuring a large rectangular capacitor structure where the contribution from the sidewall capacitance is minimal [3]. For such a structure, $\mathrm{{CJ}}\left( {V}_{J}\right)$ can be approximated as
$$
\mathrm{{CJ}}\left( {V}_{J}\right)  = A \cdot  \mathrm{{CJ}}\left( 0\right) {\left( 1 + \frac{{V}_{J}}{\mathrm{{PB}}}\right) }^{-\mathrm{{MJ}}} \tag{C.5-5}
$$
This equation can be rewritten in a way that is convenient for linear regression.
$$
\log \left\lbrack  {\mathrm{{CJ}}\left( {V}_{J}\right) }\right\rbrack   = \left( {-\mathrm{{MJ}}}\right) \log \left( {1 + \frac{{V}_{J}}{\mathrm{{PB}}}}\right)  + \log \left\lbrack  {A \cdot  \mathrm{{CJ}}\left( 0\right) }\right\rbrack   \tag{C.5-6}
$$
By measuring $\mathrm{{CJ}}\left( {V}_{J}\right)$ at different voltages and plotting $\log \left\lbrack  {\mathrm{{CJ}}\left( {V}_{J}\right) }\right\rbrack$ versus $\log \left\lbrack  {1 + {V}_{J}/\mathrm{{PB}}}\right\rbrack$ , one can determine the slope,-MJ, and the $Y$ intercept (where $Y$ is the term on the left), $\log \left\lbrack  {A \cdot  \mathrm{{CJ}}\left( 0\right) }\right\rbrack$ . Knowing the area of the capacitor, the calculation of the bottom junction capacitance is straightforward.
## Determination of CJ and MJ
Consider the following data taken on a large ( ${100\mu }\mathrm{m}$ by ${100\mu }\mathrm{m}$ ) junction capacitor at various reverse-bias voltages. Assume the sidewall capacitance is negligible and calculate the grading coefficient MJ and the bottom junction capacitance, CJ(0). Use PB approximately equal to 0.7.
<table><tr><td>${V}_{J}\left( V\right)$</td><td>${C}_{\text{meas }}\left( {{10}^{-{12}}\mathrm{\;F}}\right)$</td></tr><tr><td>0</td><td>3.10</td></tr><tr><td>1</td><td>1.95</td></tr><tr><td>2</td><td>1.57</td></tr><tr><td>3</td><td>1.35</td></tr><tr><td>4</td><td>1.20</td></tr><tr><td>5</td><td>1.10</td></tr></table>
## SOLUTION
The data should be converted to the form required in Eq. (C.5-6) as given below.
<table><tr><td>$\log \left\lbrack  {1 + {V}_{J}/\mathrm{{PB}}}\right\rbrack$</td><td>$\log \left\lbrack  {\mathrm{{CJ}}/\left( {V}_{j}\right) }\right\rbrack$</td></tr><tr><td>0.000</td><td>-11.51</td></tr><tr><td>0.3853</td><td>-11.71</td></tr><tr><td>0.5863</td><td>-11.80</td></tr><tr><td>0.7231</td><td>-11.87</td></tr><tr><td>0.8270</td><td>-11.92</td></tr><tr><td>0.9108</td><td>-11.96</td></tr></table>
Using linear regression techniques, MJ and CJ(0) are determined to be approximately
$$
\mathrm{{CJ}}\left( 0\right)  = {3.1} \times  {10}^{-4}\left( {\mathrm{\;F}/{\mathrm{m}}^{2}}\right)
$$
$$
\text{MJ = 0.49}
$$
By using a long narrow structure whose junction capacitance is dominated by the perimeter rather than the area of the bottom, similar techniques as just described can be used to determine CJSW and MJSW.
The technique described for obtaining ${C}_{\text{poly-field }}$ can be applied to determine ${C}_{\text{metal-field }}$ and ${\mathrm{C}}_{\text{metal-polv }}$ as well. A test structure that can achieve large enough capacitance for easy measurement is required. Once obtained, these (per ${\mathrm{m}}^{2}$ ) capacitors can be used to determine interconnect capacitance.
Other ideas for characterizing circuit capacitors are presented in the literature [4,5]. These have not been addressed in this text for the sake of brevity. The interested reader should refer to the references for further study [6-8].
---
Example C. 5-1
---
1. C. Alcorn, D. Dworak, N. Haddad, W. Henley, and P. Nixon, "Kerf Test Structure Designs for Process and Device Characterization," Solid State Technol., Vol. 28, No. 5, pp. 229-235, May 1985.
2. P. Vitanov, U. Schwabe, and I. Eisele, "Electrical Characterization of Feature Sizes and Parasitic Capacitances Using a Single Test Structure," IEEE Trans. Electron Devices, Vol. ED-31, No. 1, pp. 96-100, Jan. 1984.
3. A. Vladimirescu and S. Liu, "The Simulation of MOS Integrated Circuits Using SPICE2," Memorandum No. UCB/ERL M80/7, October 1980, Electronics Research Laboratory, College of Engineering, University of California, Berkeley, CA 94720.
4. H. Iwai and S. Kohyama, "On-Chip Capacitance Measurement Circuits in VLSI Structures," IEEE Trans. Electron Devices, Vol. ED-29, No. 10, pp. 1622-1626, Oct. 1982.
5. M. J. Thoma and C. R. Westgate, "A New AC Measurement Technique to Accurately Determine MOSFET Constants," IEEE Trans. Electron Devices, Vol. ED-31, No. 9, pp. 1113-1116, Sept. 1984.
6. Y. R. Ma and K. L. Wang, "A New Method to Electrically Determine Effective MOSFET Channel Width," IEEE Trans. Electron Devices, Vol. ED-29, No. 12, pp. 1825-1827, Dec. 1982.
7. F. H. De La Moneda and H. N. Kotecha, "Measurement of MOSFET Constants," IEEE Electron Device Lett., Vol. EDL-3, No. 1, pp. 10-12, Jan. 1982.
8. D. Takacs, W. Muller, and U. Schwabe,"Electrical Measurement of Feature Sizes in MOS Si ${}^{2}$ -Gate VLSI Technology," IEEE Trans. Electron Devices, Vol. ED-27, No. 8, pp. 1368-1373, Aug. 1980.
APPENDIX I Time and Frequency Domain Relationships for Second-Order Systems
T'here are many reasons for considering the time and frequency domain relationships of a second-order system in the study of operational amplifiers. One is that many opera- tional amplifier configurations can be modeled with reasonable accuracy assuming just a second-order system. Such a procedure represents a reasonable compromise between complexity and accuracy of the model. Another reason is that these relationships allow us to predict frequency domain performance from the simpler to measure time domain performance.
### D.1 General Second-Order System in the Frequency Domain

The general transfer function of a low-pass, second-order system in the frequency domain using voltage variables is
$$
A\left( s\right)  = \frac{{V}_{o}\left( s\right) }{{V}_{\text{in }}\left( s\right) } =  \pm  \frac{{A}_{0}{\omega }_{n}^{2}}{{s}^{2} + {2\zeta }{\omega }_{n}s + {\omega }_{n}^{2}} =  \pm  \frac{{A}_{0}{\omega }_{0}^{2}}{{s}^{2} + \left( {{\omega }_{0}/Q}\right) s + {\omega }_{0}^{2}} \tag{D.1-1}
$$
where
$$
{A}_{0} = \text{the low-frequency gain of}{V}_{o}\left( s\right) /{V}_{\text{in }}\left( s\right)
$$
${\omega }_{0} = {\omega }_{n} =$ the pole frequency in radians per second
$$
\zeta  = \text{the damping factor}Q\left( { = \frac{1}{2Q}}\right)
$$
$$
Q = \text{ the pole }Q\left( { = \frac{1}{2\zeta }}\right)
$$
The roots of Eq. (D.1-1) are illustrated in Fig. D.1-1.

Figure D.1-1 Pole locations of a general second-order system.
The magnitude of the frequency response can be found from Eq. (D.1-1) as
$$
\left| {A\left( {j\omega }\right) }\right|  = \frac{{A}_{0}{\omega }_{n}^{2}}{\sqrt{{\left( {\omega }_{n}^{2} - {\omega }^{2}\right) }^{2} + 4{\zeta }^{2}{\omega }_{n}^{2}{\omega }^{2}}} \tag{D.1-2}
$$
However, Eq. (D.1-2) may be generalized by normalizing the amplitude with respect to ${A}_{0}$ and the radian frequency by ${\omega }_{n}$ to give
$$
\frac{\left| A\left( j\omega /{\omega }_{n}\right) \right| }{{A}_{0}} = \frac{1}{\sqrt{{\left\lbrack  1 - {\left( \omega /{\omega }_{n}\right) }^{2}\right\rbrack  }^{2} + 4{\zeta }^{2}{\left( \omega /{\omega }_{n}\right) }^{2}}} \tag{D.1-3}
$$
A plot of Eq. (D.1-3) in $\mathrm{{dB}}$ versus $\log \omega /{\omega }_{n}$ is shown in Fig. D.1-2, where $\zeta$ or $1/{2Q}$ is used as a parameter. By taking the derivative of Eq. (D.1-3) with respect to $\omega /{\omega }_{n}$ and setting it to zero, the peak of $\left| {A\left( {{j\omega }/{\omega }_{0}}\right) /{A}_{0}}\right|$ can be found as
$$
{M}_{p} = \frac{1}{{2\zeta }\sqrt{1 - {\zeta }^{2}}} \tag{D.1-4}
$$
when $\zeta  < {0.707}$ .
The second-order function of Eq. (D.1-1) is found in the analysis of many practical systems. Consider the single-loop, feedback block diagram of Fig. D.1-3. The closed-loop gain $A\left( s\right)$ can be expressed as
$$
A\left( s\right)  = \frac{{V}_{o}\left( s\right) }{{V}_{i}\left( s\right) } = \frac{\alpha a\beta }{1 + {a\beta }} \tag{D.1-5}
$$
Let us assume that $\alpha$ and $\beta$ are real and that $a$ is the amplifier’s gain and can be approximated as
$$
a\left( s\right)  \cong  \frac{{a}_{0}{\omega }_{1}{\omega }_{2}}{\left( {s + {\omega }_{1}}\right) \left( {s + {\omega }_{2}}\right) } \tag{D.1-6}
$$
where ${a}_{0}$ is the dc gain of the amplifier and ${\omega }_{1}$ and ${\omega }_{2}$ are negative real axis poles. Substitution of Eq. (D.1-6) into Eq. (D.1-5) gives
$$
A\left( s\right)  = \left( {\alpha \beta }\right) \frac{{a}_{0}{\omega }_{1}{\omega }_{2}}{{s}^{2} + \left( {{\omega }_{1} + {\omega }_{2}}\right) s + {\omega }_{1}{\omega }_{2}\left( {1 + {a}_{0}\beta }\right) } \tag{D.1-7}
$$

Figure D.1-2 Gain magnitude response for various values of $\zeta$ for a second-order, low-pass system.
Comparing Eq. (D.1-7) with Eq. (D.1-1) results in the following identifications:
$$
{A}_{0} = \alpha {a}_{0}\beta /\left( {1 + {a}_{0}\beta }\right)  \tag{D.1-8}
$$
$$
{\omega }_{n} = {\omega }_{0} = \sqrt{{\omega }_{1}{\omega }_{2}\left( {1 + {a}_{0}\beta }\right) } \tag{D.1-9}
$$
$$
{2\zeta } = 1/Q = \frac{{\omega }_{1} + {\omega }_{2}}{\sqrt{{\omega }_{1}{\omega }_{2}\left( {1 + {a}_{0}\beta }\right) }} \tag{D.1-10}
$$

Figure D.1-3 Single-loop feedback block diagram.
The same principles can be applied to a second-order bandpass or high-pass system, but the low-pass case is of more practical interest to us and will be the only one considered. It is also possible for $\beta$ (and thus $\alpha$ ) to become frequency dependent, which further complicates the analysis.
### D.2 Low-Pass, Second-Order System in the Time Domain
Unfortunately, it is time consuming to make measurements in the frequency domain. Therefore, we are interested in determining the frequency domain performance from the time domain performance. This information is developed as follows. The general response of Eq. (D.1-1) to a unit step can be written as
$$
{v}_{o}\left( t\right)  = {A}_{0}\left\lbrack  {1 - \frac{1}{\sqrt{1 - {\zeta }^{2}}}{e}^{-\zeta {\omega }_{n}t}\sin \left( {\sqrt{1 - {\zeta }^{2}}{\omega }_{n}t + \phi }\right) }\right\rbrack   \tag{D.2-1}
$$
where
$$
\phi  = {\tan }^{-1}\left( \frac{\sqrt{1 - {\zeta }^{2}}}{\zeta }\right)  \tag{D.2-2}
$$
The step response plotted in normalized amplitude versus radians is shown in Fig. D.2-1. Care must be taken interpreting this figure. Because it is normalized, the geometric mean of ${\omega }_{1}$ and ${\omega }_{2}$ remains constant (i.e., ${\omega }_{n}$ remains constant), and the time constant remains fixed as $\zeta$ varies. When compensating amplifiers, this situation does not exist-the geometric mean of the dominant and nondominant poles is increased until the desired settling response is achieved.
Let us consider first the underdamped case where $\zeta  < 1$ . For the underdamped case there will always be an overshoot as defined by Fig. D.2-2. The overshoot can be expressed as
$$
\text{ Overshoot } = \frac{\text{ Peak value } - \text{ Final value }}{\text{ Final value }} = \exp \left( \frac{-{\pi \zeta }}{\sqrt{1 - {\zeta }^{2}}}\right)  \tag{D.2-3}
$$
The time ${t}_{p}$ at which the overshoot occurs is shown in Fig. D.2-2 and can be found as
$$
{t}_{p} = \frac{\pi }{{\omega }_{n}\sqrt{1 - {\zeta }^{2}}} \tag{D.2-4}
$$
Thus, the measurement of the overshoot permits the calculation of $\zeta$ (or $1/{2Q}$ ). With this information and the measurement of ${t}_{p}$ , one can calculate ${\omega }_{n}$ from Eq. (D.2-4). Therefore, the frequency response of a second-order, low-pass system with $\zeta  < 1$ can be determined by measuring the overshoot and ${t}_{p}$ of the step response.
Next, consider the overdamped case where $\zeta  \leq  1$ . In this case there is no overshoot. The unit step response can be simplified from Eq. (D.2-1) to yield
$$
{v}_{o}\left( t\right)  = {A}_{0}\left\{  {1 - \frac{1}{2\sqrt{{\zeta }^{2} - 1}}\left\lbrack  {\frac{{e}^{-{\omega }_{n}t\left( {\zeta  - \sqrt{{\zeta }^{2} - 1}}\right) }}{\zeta  - \sqrt{{\zeta }^{2} - 1}} - \frac{{e}^{-{\omega }_{n}t\left( {\zeta  + \sqrt{{\zeta }^{2} - 1}}\right) }}{\zeta  + \sqrt{{\zeta }^{2} - 1}}}\right\rbrack  }\right\}   \tag{D.2-5}
$$
It is difficult to measure various aspects of this response and thus determine $\zeta$ and ${\omega }_{n}$ . Fortunately, there are very few occasions where we have $\zeta  > 1$ . If $\zeta  > 1$ , then the best result is probably obtained by matching the step response to one of the curves for $\zeta  > 1$ of Fig. D.2-1. More accuracy could be achieved by evaluating ${v}_{o}\left( t\right)$ (for, say, ${\omega }_{n}t = 4$ ) and selecting values of $\zeta$ until ${v}_{o}\left( {4/{\omega }_{n}}\right)$ matches with the experimental data at this point.

Figure D.2-1 Step response as a function of $\zeta$ for a low-pass, second-order system.

Figure D.2-2 Overshoot and ${t}_{p}$ .
### D.3 Determination of Phase Margin and Crossover Frequency from $\zeta$ and ${\omega }_{n}$

In the previous discussion we have seen how $\zeta$ and ${\omega }_{n}$ of a second-order system can be determined by the time domain step response. It is the objective of this section to show how to find the phase margin ${\phi }_{m}$ and the crossover frequency ${\omega }_{c}$ from $\zeta$ and ${\omega }_{n}$ . Figure D.3-1 shows the meaning of ${\phi }_{m}$ and ${\omega }_{c}$ .
In order to assist in developing the desired relationships, it will be convenient to assume that $\beta$ (thus $\alpha$ ) is real. From Eq. (D.1-5) we may solve for $a$ to get
$$
{a\beta } = \frac{1/\alpha }{\left( {1/A}\right)  - \left( {1/\alpha }\right) } \tag{D.3-1}
$$
Substituting Eq. (D.1-1) into Eq. (D.3-1) gives the loop gain as
$$
{a\beta } = \frac{{A}_{0}{\omega }_{n}^{2}/\alpha }{\left( {{s}^{2} + {2\zeta }{\omega }_{n}s + {\omega }_{n}^{2}}\right)  - \left( {{A}_{0}{\omega }_{n}^{2}/\alpha }\right) } = \frac{{A}_{0}/\alpha }{{\left( \frac{s}{{\omega }_{n}}\right) }^{2} + {2\zeta }\left( \frac{s}{{\omega }_{n}}\right)  + 1 - \left( \frac{{A}_{0}}{\alpha }\right) } \tag{D.3-2}
$$

Figure D.3-1 Crossover frequency and phase margin.
When $\left| {a\beta }\right|  = 1$ , then $\omega  = {\omega }_{c}$ so that Eq. (D.3-2) becomes
$$
\left| {a\beta }\right|  = \frac{{A}_{0}/\alpha }{\sqrt{{\left\lbrack  1 - {A}_{0}/\alpha  - {\left( {\omega }_{c}/{\omega }_{n}\right) }^{2}\right\rbrack  }^{2} + {\left\lbrack  2\zeta \left( {\omega }_{c}/{\omega }_{n}\right) \right\rbrack  }^{2}}} \tag{D.3-3}
$$
Since $\left| {a\beta }\right|  = 1$ , we may solve Eq. (D.3-3) for ${\omega }_{c}$ to get
$$
{\omega }_{c} = {\omega }_{n}{\left\lbrack  \sqrt{{\left\lbrack  2{\zeta }^{2} - \left( 1 - {A}_{0}/\alpha \right) \right\rbrack  }^{2} - \left( {1 - 2{A}_{0}/\alpha }\right) } - 2{\zeta }^{2} + \left( 1 - {A}_{0}/\alpha \right) \right\rbrack  }^{1/2} \tag{D.3-4}
$$
Knowing ${A}_{o},\alpha ,{\omega }_{n}$ , and $\zeta$ , we may calculate the cutoff frequency of a second-order system. In an operational amplifier circuit, $\alpha  = {A}_{o}$ so that Eq. (D.3-4) becomes
$$
{\omega }_{c} = {\omega }_{n}{\left( \sqrt{4{\zeta }^{4} + 1} - 2{\zeta }^{2}\right) }^{1/2} \tag{D.3-5}
$$
Figure D.3-2 gives a plot of this useful function.
The phase of ${a\beta }$ can be found from Eq. (D.3-2). However, we must add $\pm  \pi$ to this value to account for the minus sign of the summing junction of Fig. D.1-3. Thus,
$$
{\phi }_{m} =  - {\tan }^{-1}\left( \frac{{2\zeta }{\omega }_{c}/{\omega }_{n}}{\left( {1 - {A}_{0}/\alpha }\right)  - {\left( {\omega }_{c}/{\omega }_{n}\right) }^{2}}\right)  \tag{D.3-6}
$$
Since ${A}_{0} = \alpha$ , we may write Eq. (D.3-6) as
$$
{\phi }_{m} = {\tan }^{-1}\left( \frac{2\zeta }{{\omega }_{c}/{\omega }_{n}}\right)  \tag{D.3-7}
$$
Substituting Eq. (D.3-5) into Eq. (D.3-7) yields
$$
{\phi }_{m} = {\tan }^{-1}\left( \frac{2\zeta }{{\left( \sqrt{4{\zeta }^{4} + 1} - 2{\zeta }^{2}\right) }^{1/2}}\right)  \tag{D.3-8}
$$

Figure D.3-2 Plot of ${\omega }_{c}/{\omega }_{n}$ versus $\zeta$ for a low-pass,
second-order system.
An equivalent form of Eq. (D.3-8) is
$$
{\phi }_{m} = {\cos }^{-1}\left( {\sqrt{4{\zeta }^{4} + 1} - 2{\zeta }^{2}}\right)  \tag{D.3-9}
$$
Figure D.3-3 gives a plot of ${\phi }_{m}$ of Eq. (D.3-8) or (D.3-9) and of Eq. (D.2-3) as a function of the damping factor $\zeta$ . Therefore, the time domain performance characterized by $\zeta$ permits the designer to estimate a value of phase margin using Eq. (D.3-9) or Fig. D.3-3. For example, if the peak overshoot is ${10}\%$ , then the dashed line on Fig. D.3-3 shows that the corresponding phase margin will be about ${58}^{ \circ  }$ .

Figure D.3-3 Relationship between the phase margin and the overshoot as a function of the damping factor for a second-order system.
## APPENDIX E Switched Capacitor Circuits
### E.1 Analysis Methods for Switched Capacitor Circuits
Switched capacitor circuits are often called analog sampled-data circuits because the signals are continuous in amplitude and discrete in time. An arbitrary continuous time voltage waveform, $v\left( t\right)$ , is shown on Fig. E.1-1 by the dashed line. At the times $t = 0, T/2, T,{3T}/2,\ldots$ this voltage has been sampled and held for a half-period (T/2). The sampled-data waveform, ${v}^{ * }\left( t\right)$ , of Fig. E.1-1(a) is typical of a switched capacitor waveform assuming that the input signal to the switched capacitor circuit has been sampled and held. The darker shaded and lighter unshaded rectangles correspond to the ${\phi }_{1}$ phase and the ${\phi }_{2}$ phase, respectively, of the two-phase nonoverlapping clock of Fig. E.1-2.
It is clear from Fig. E.1-1 that the waveform in Fig. E.1-1(a) is equal to the sum of the waveforms in Figs. E.1-1(b) and E.1-1(c). This relationship can be expressed as
$$
{v}^{ * }\left( t\right)  = {v}^{o}\left( t\right)  + {v}^{e}\left( t\right)  \tag{E.1-1}
$$
where the superscript $o$ denotes the odd phase $\left( {\phi }_{1}\right)$ and the superscript $e$ denotes the even phase $\left( {\phi }_{2}\right)$ . For any given sample point, $t = {nT}/2$ , Eq. (E.1-1) may be expressed as
$$
{\left. {v}^{ * }\left( nT/2\right) \right| }_{n = 1,2,3,4,\ldots } = {\left. {v}^{o}\left( \left( n - 1\right) \frac{T}{2}\right) \right| }_{n = 1,3,\ldots } = {\left. {v}^{e}\left( \left( n - 1\right) \frac{T}{2}\right) \right| }_{n = 2,4} \tag{E.1-2}
$$
To examine switched capacitor circuits in the frequency domain, it is necessary to transform the sequence in the time domain to a $z$ -domain equivalent expression. To illustrate, consider the one-sided $z$ -transform of a sequence, $v\left( {nT}\right)$ , defined as [1]
$$
V\left( z\right)  = \mathop{\sum }\limits_{{n = 0}}^{\infty }v\left( {nT}\right) {z}^{-n} = v\left( 0\right)  + v\left( T\right) {z}^{-1} + v\left( {2T}\right) {z}^{-2} + \cdots  \tag{E.1-3}
$$
for all $z$ for which the series $V\left( z\right)$ converges. Now, Eq. (E.1-1) can be expressed in the $z$ -domain as
$$
{V}^{ * }\left( z\right)  = {V}^{o}\left( z\right)  + {V}^{e}\left( z\right)  \tag{E.1-4}
$$

Figure E.1-1 (a) A sampled-data voltage waveform for a two-phase clock. (b) Waveform for the odd clock $\left( {\phi }_{1}\right)$ . (c) Waveform for the even clock $\left( {\phi }_{2}\right)$ .
The $z$ -domain format for switched capacitor circuits allows one to analyze transfer functions.
A switched capacitor circuit viewed from a $z$ -domain viewpoint is shown in Fig. E.1-3. Both the input voltage, ${V}_{i}\left( z\right)$ , and output voltage, ${V}_{o}\left( z\right)$ , can be decomposed into their odd and even component voltages. Depending on whether the odd or even voltages are selected, there are four possible transfer functions. In general, they are expressed as
$$
{H}^{ij}\left( z\right)  = \frac{{V}_{o}^{j}\left( z\right) }{{V}_{i}^{i}\left( z\right) } \tag{E.1-5}
$$
where $i$ and $j$ can be either $e$ or $o$ . For example, ${H}^{oe}\left( z\right)$ represents ${V}_{o}^{e}\left( z\right) /{V}_{i}^{o}\left( z\right)$ . Also, a transfer function, $H\left( z\right)$ , can be defined as
$$
H\left( z\right)  = \frac{{V}_{o}\left( z\right) }{{V}_{i}\left( z\right) } = \frac{{V}_{o}^{e}\left( z\right)  + {V}_{o}^{o}\left( z\right) }{{V}_{i}^{e}\left( z\right)  + {V}_{i}^{o}\left( z\right) } \tag{E.1-6}
$$

Figure E.1-2 Waveforms of a typical two-phase, nonoverlapping clock scheme.

Figure E.1-3 Input-output voltages of a general switched capacitor circuit in the $z$ -domain.

Figure E.1-4 (a) Switched capacitor, low-pass filter. (b) Clock phasing.
The analysis approach for switched capacitor circuits using a two-phase, nonoverlapping clock consists of analyzing the circuit in the time domain during a selected phase period. Because the circuit consists of only capacitors (charged and uncharged) and voltage sources, the equations are easy to derive using simple algebraic methods. Once the selected phase period has been analyzed, then the following phase period is analyzed carrying over the initial conditions from the previous analysis. At this point, a time-domain equation can be found that relates the output voltage during the second period to the inputs during either of the phase periods. Next, the time-domain equation is converted to the $z$ -domain using Eq. (E.1-3). The desired $z$ -domain transfer function can be found from this expression. The following example will illustrate this approach.
It is convenient to associate a point in time with each clock phase. The obvious choices are at the beginning of the clock phase or the end of the clock phase. We will arbitrarily choose the beginning of the clock phase. However, one could equally well choose the end of the clock phase. The key is to be consistent throughout a given analysis. In the following example, the time point is selected as the beginning of the phase period as indicated by the single parenthesis in Fig. E.1-4(b) associating the beginning of the phase period with that phase period.
---
Example E. 1-1
---
## Analysis of a Switched Capacitor, First-Order, Low-Pass Filter
Use the above approach to find the $z$ -domain transfer function of the first-order, low-pass switched capacitor circuit shown in Fig. E.1-4(a). Figure E.1-4(b) gives the timing of the clocks. This timing is arbitrary and is used to assist the analysis and does not change the result.
## SOLUTION
Let us begin with the ${\phi }_{1}$ phase during the time interval from $\left( {n - 1}\right) T$ to $\left( {n - \frac{1}{2}}\right) T$ . Figure E.1-5(a) is the equivalent of Fig. E.1-4(a) during this time period. During this time period, ${C}_{1}$ is charged to ${v}_{1}^{o}\left( {n - 1}\right) T$ . However, ${C}_{2}$ remains at the voltage of the previous period, ${v}_{2}^{e}$ $\left( {n - \frac{3}{2}}\right) T$ . Figure E.1-5(b) shows a useful simplification to Fig. E.1-5(a) by replacing ${C}_{2}$ , which has been charged to ${v}_{2}^{e}\left( {n - \frac{3}{2}}\right) T$ , by an uncharged capacitor, ${C}_{2}$ , in series with a voltage source of ${v}_{2}^{e}\left( {n - \frac{3}{2}}\right) T$ . This voltage source is a step function that starts at $t = \left( {n - \frac{3}{2}}\right) T$ . Because ${C}_{2}$ is uncharged, then
$$
{v}_{2}^{o}\left( {n - 1}\right) T = {v}_{2}^{e}\left( {n - \frac{3}{2}}\right) T \tag{E.1-7}
$$

Figure E.1-5 (a) Equivalent circuit of Fig. E.1-4(a) during the period from $t = \left( {n - 1}\right) T$ to $t = \left( {n - \frac{3}{2}}\right) T$ . (b) Simplified equivalent of (a).
Now, let us consider the next clock period, ${\phi }_{2}$ , during the time from $t = \left( {n - \frac{1}{2}}\right) T$ to $t =$ ${nT}$ . The equivalent circuit of Fig. E.1-4(a) during this period is shown in Fig. E.1-6. We see that ${C}_{1}$ with its previous charge of ${v}_{1}^{o}\left( {n - 1}\right) T$ is connected in parallel with ${C}_{2}$ , which has the voltage given by Eq. (E.1-7). Thus, the output of Fig. E.1-6 can be expressed as the superposition of two voltage sources, ${v}_{1}^{o}\left( {n - 1}\right) T$ and ${v}_{2}^{o}\left( {n - 1}\right) T$ , given as
$$
{v}_{2}^{e}\left( {n - \frac{1}{2}}\right) T = \left( \frac{{C}_{1}}{{C}_{1} + {C}_{2}}\right) {v}_{1}^{o}\left( {n - 1}\right) T + \left( \frac{{C}_{2}}{{C}_{1} + {C}_{2}}\right) {v}_{2}^{o}\left( {n - 1}\right) T \tag{E.1-8}
$$

Figure E.1-6 Equivalent circuit of Fig. E.1-4(a) during the time from $t = \left( {n = \frac{1}{2}}\right) T$ to $t = {nT}$ .
If we advance Eq. (E.1-7) by one full period, $T$ , it can be rewritten as
$$
{v}_{2}^{o}\left( n\right) T = {v}_{2}^{e}\left( {n - \frac{1}{2}}\right) T \tag{E.1-9}
$$
Substituting Eq. (E.1-8) into Eq. (E.1-9) yields the desired result given as
$$
{v}_{2}^{o}\left( {nT}\right)  = \left( \frac{{C}_{1}}{{C}_{1} + {C}_{2}}\right) {v}_{1}^{o}\left( {n - 1}\right) T + \left( \frac{{C}_{2}}{{C}_{1} + {C}_{2}}\right) {v}_{2}^{o}\left( {n - 1}\right) T \tag{E.1-10}
$$
The next step is to write the $z$ -domain equivalent expression for Eq. (E.1-10). If we express the $z$ -domain equivalence as
$$
v\left( {nT}\right)  \leftrightarrow  V\left( z\right)  \tag{E.1-11}
$$
then the sequence shifting property can be expressed as
$$
v\left( {n - {n}_{0}}\right) T \leftrightarrow  {z}^{-{n}_{0}}V\left( z\right)  \tag{E.1-12}
$$
Applying this property to Eq. (E.1-10) gives
$$
{V}_{2}^{o}\left( z\right)  = \left( \frac{{C}_{1}}{{C}_{1} + {C}_{2}}\right) {z}^{-1}{V}_{1}^{o}\left( z\right)  + \left( \frac{{C}_{2}}{{C}_{1} + {C}_{2}}\right) {z}^{-1}{V}_{2}^{o}\left( z\right)  \tag{E.1-13}
$$
Rearranging Eq. (E.1-13) gives
$$
{V}_{2}^{o}\left( z\right) \left\lbrack  {1 - \left( \frac{{C}_{2}}{{C}_{1} + {C}_{2}}\right) {z}^{-1}}\right\rbrack   = \left( \frac{{C}_{1}}{{C}_{1} + {C}_{2}}\right) {z}^{-1}{V}_{1}^{o}\left( z\right)  \tag{E.1-14}
$$
Finally, solving for ${V}_{2}^{o}\left( z\right) /{V}_{1}^{o}\left( z\right)$ gives the desired $z$ -domain transfer function for the switched capacitor circuit of Fig. E.1-4(a) as
$$
{H}^{oo}\left( z\right)  = \frac{{V}_{2}^{o}\left( z\right) }{{V}_{1}^{o}\left( z\right) } = \frac{{z}^{-1}\left( \frac{{C}_{1}}{{C}_{1} + {C}_{2}}\right) }{1 - {z}^{-1}\left( \frac{{C}_{2}}{{C}_{1} + {C}_{2}}\right) } = \frac{{z}^{-1}}{1 + \alpha  - \alpha {z}^{-1}} \tag{E.1-15}
$$
where
$$
\alpha  = \frac{{C}_{2}}{{C}_{1}} \tag{E.1-16}
$$
The above example illustrates the approach of finding the $z$ -domain transfer function of switched capacitor circuits. In general, one tries to find the transfer function corresponding to even or odd phase at the output and input, that is, ${H}^{oo}\left( z\right)$ or ${H}^{ee}\left( z\right)$ . However, in some cases, ${H}^{oe}\left( z\right)$ or ${H}^{eo}\left( z\right)$ is used.
The frequency response of a continuous time circuit can be found from the complex frequency-transfer function, $H\left( s\right)$ , given as
$$
H\left( s\right)  = \frac{{V}_{\text{out }}\left( s\right) }{{V}_{\text{in }}\left( s\right) } \tag{E.1-17}
$$
where $s$ is the familiar complex frequency variable defined as
$$
s = \sigma  + {j\omega } \tag{E.1-18}
$$
where $\sigma$ is the real part and $\omega$ is the imaginary part of the complex frequency variable $s$ . The $s$ -domain is shown in Fig. E.1-7(a). The continuous time frequency response is found when $\sigma  = 0$ or $s = {j\omega }$ . The $z$ -domain variable is also a complex variable expressed as
$$
z = r{e}^{j\omega T} \tag{E.1-19}
$$
where $r$ is the radius from the origin to a point, $\omega$ is the radian frequency variable in radians per second, and $T$ is the clock period in seconds. The $z$ -domain is shown in Fig. E.1-7(b). The discrete time frequency response is found by letting $r = 1$ . We see that the continuous time frequency response corresponds to the vertical axis of Fig. E.1-7(a) and the discrete time frequency response corresponds to the unit circle of Fig. E.1-7(b). Therefore, to find the frequency response of a discrete time or switched capacitor circuit, we replace the $z$ variable with ${e}^{j\omega T}$ and evaluate the result as a function of $\omega$ . The following example will illustrate the method.

Figure E.1-7 (a) Continuous frequency domain. (b) Discrete frequency domain.
---
Example E. 1-2
---
## Frequency Response of Example E.1-1
Use the results of the previous example to find the magnitude and phase of the discrete time frequency response for the switched capacitor circuit of Fig. E.1-4(a).
## SOLUTION
The first step is to replace $z$ in Eq. (E.1-15) by ${e}^{j\omega T}$ . The result is given as
$$
{H}^{oo}\left( {e}^{j\omega T}\right)  = \frac{{e}^{-{j\omega T}}}{1 + \alpha  - \alpha {e}^{-{j\omega T}}} = \frac{1}{\left( {1 + \alpha }\right) {e}^{j\omega T} - \alpha } \tag{E.1-20}
$$
$$
= \frac{1}{\left( {1 + \alpha }\right) \cos \left( {\omega T}\right)  - \alpha  + j\left( {1 + \alpha }\right) \sin \left( {\omega T}\right) }
$$
where we have used Euler’s formula to replace ${e}^{j\omega T}$ by $\cos \left( {\omega T}\right)  + j\sin \left( {\omega T}\right)$ . The magnitude of Eq. (E.1-20) is found by taking the square root of the square of the real and imaginary components of the denominator to give
$$
\left| {H}^{oo}\right|  = \frac{1}{\sqrt{{\left( 1 + \alpha \right) }^{2}{\cos }^{2}\left( {\omega T}\right)  - {2\alpha }\left( {1 + \alpha }\right) \cos \left( {\omega T}\right)  + {\alpha }^{2} + {\left( 1 + \alpha \right) }^{2}{\sin }^{2}\left( {\omega T}\right) }}
$$
$$
= \frac{1}{\sqrt{{\left( 1 + \alpha \right) }^{2}\left\lbrack  {{\cos }^{2}\left( {\omega T}\right)  + {\sin }^{2}\left( {\omega T}\right) }\right\rbrack   + {\alpha }^{2} - {2\alpha }\left( {1 + \alpha }\right) \cos \left( {\omega T}\right) }}
$$
$$
= \frac{1}{\sqrt{1 + {2\alpha } + 2{\alpha }^{2} - {2\alpha }\left( {1 + \alpha }\right) \cos \left( {\omega T}\right) }}
$$
$$
= \frac{1}{\sqrt{1 + {2\alpha }\left( {1 + \alpha }\right) \left( {1 - \cos \left( {\omega T}\right) }\right) }} \tag{E.1-21}
$$
The phase shift of Eq. (E.1-20) is expressed as
$$
\operatorname{Arg}\left\lbrack  {H}^{oo}\right\rbrack   =  - {\tan }^{-1}\left\lbrack  \frac{\left( {1 + \alpha }\right) \sin \left( {\omega T}\right) }{\left( {1 + \alpha }\right) \cos \left( {\omega T}\right)  - \alpha }\right\rbrack   =  - {\tan }^{-1}\left\lbrack  \frac{\sin \left( {\omega T}\right) }{\cos \left( {\omega T}\right)  - \alpha /\left( {1 + \alpha }\right) }\right\rbrack   \tag{E.1-22}
$$
Once the frequency response of the switched capacitor circuit has been found, it is possible to design the circuit parameters. In the previous two examples, $\alpha$ , which is the ratio of ${C}_{2}$ to ${C}_{1}$ , is a circuit parameter. The design is typically done by assuming that the frequency of the signal applied to the switched capacitor circuit is much less than the clock frequency. This is called the oversampling assumption. It is expressed as
$$
{f}_{\text{signal }} \ll  {f}_{\text{clock }} \tag{E.1-23}
$$
If we let ${f}_{\text{signal }}$ be represented as $f$ , then we may rewrite the inequality of Eq. (E.1-23) as
$$
{f}_{\text{signal }} = f \ll  \frac{1}{T} \tag{E.1-24}
$$
Multiplying Eq. (E.1-24) by ${2\pi }$ gives
$$
{2\pi f} = \omega  \ll  \frac{2\pi }{T} \tag{E.1-25}
$$
or
$$
{\omega T} \ll  {2\pi } \tag{E.1-26}
$$
If we use the oversampling assumption of Eq. (E.1-26), then ${\omega T}$ is much less than ${2\pi }$ and we can simplify the discrete time frequency response and equate it to the continuous time frequency response to find values for the circuit parameters.
### E.2 Switched Capacitor Amplifiers
In this section, the use of switched capacitors for amplification will be presented. This class of circuits will use the op amp with negative feedback to achieve gains that are proportional to the ratios of capacitors. We will begin with amplifiers using resistor feedback. These amplifiers will serve as the basis for switched capacitor amplifiers. The influence of the op amp open-loop gain and unity-gain bandwidth on these amplifiers will be examined.
## Continuous Time Amplifiers
Figure E.2-1 shows the familiar noninverting and inverting amplifiers using resistors and op amps. The ideal gain of both circuits can easily be found [2]. For the noninverting amplifier of Fig. E.2-1(a), the ideal gain is
$$
\frac{{v}_{\mathrm{{OUT}}}}{{v}_{\mathrm{{IN}}}} = \frac{{R}_{1} + {R}_{2}}{{R}_{1}} \tag{E.2-1}
$$
and for the inverting amplifier of Fig. E.2-1(b), the ideal gain is
$$
\frac{{v}_{\mathrm{{OUT}}}}{{v}_{\mathrm{{IN}}}} =  - \frac{{R}_{2}}{{R}_{1}} \tag{E.2-2}
$$
The results of Eqs. (E.2-1) and (E.2-2) assume that the differential gains of the op amps in Fig. E.2-1 approach infinity.
The influence of a finite gain and finite unity-gain bandwidth can be seen by replacing the op amps of Fig. E.2-1 with a voltage-controlled, voltage source model shown in Fig. E.2-2. The voltage gain, ${A}_{vd}\left( s\right)$ , is a function of the complex frequency variable, $s$ , and is given as
$$
{A}_{vd}\left( s\right)  = \frac{{A}_{vd}\left( 0\right) {\omega }_{a}}{s + {\omega }_{a}} = \frac{GB}{s + {\omega }_{a}} \approx  \frac{GB}{s}\;\text{ if }\omega  \gg  {\omega }_{a} \tag{E.2-3}
$$
where ${A}_{vd}\left( 0\right)$ is the low-frequency differential voltage gain, ${GB}$ is the unity-gain bandwidth, and ${\omega }_{a}$ is the $- 3\mathrm{\;{dB}}$ frequency of the op amp. The influence of ${A}_{vd}\left( 0\right)$ can be examined by letting $s$ in Eq. (E.2-3) approach zero. Solving for the voltage gains of the op amp configurations in Fig. E.2-2 with ${A}_{vd}\left( s\right)$ equal to ${A}_{vd}\left( 0\right)$ gives the following results. For the noninverting amplifier, we obtain
$$
\frac{{V}_{\text{out }}}{{V}_{\text{in }}} = \frac{{A}_{vd}\left( 0\right) }{1 + \frac{{A}_{vd}\left( 0\right) {R}_{1}}{{R}_{1} + {R}_{2}}} = \left( \frac{{R}_{1} + {R}_{2}}{{R}_{1}}\right) \frac{\frac{{A}_{vd}\left( 0\right) {R}_{1}}{{R}_{1} + {R}_{2}}}{1 + \frac{{A}_{vd}\left( 0\right) {R}_{1}}{{R}_{1} + {R}_{2}}} = \left( \frac{{R}_{1} + {R}_{2}}{{R}_{1}}\right) \frac{\left| LG\right| }{1 + \left| {LG}\right| } \tag{E.2-4}
$$
where the magnitude of the feedback loop gain, $\left| {LG}\right|$ , is given as
$$
\left| {LG}\right|  = \frac{{A}_{vd}\left( 0\right) {R}_{1}}{{R}_{1} + {R}_{2}} \tag{E.2-5}
$$

Figure E.2-1 (a) Continuous time noninverting amplifier. (b) Continuous time inverting amplifier.

Figure E.2-2 Models for the (a) noninverting and (b) inverting voltage amplifiers that include finite gain and finite unity-gain bandwidth.
The result for the inverting amplifier is
$$
\frac{{V}_{\text{out }}}{{V}_{\text{in }}} = \frac{\frac{-{R}_{2}{A}_{vd}\left( 0\right) }{{R}_{1} + {R}_{2}}}{1 + \frac{{A}_{vd}\left( 0\right) {R}_{1}}{{R}_{1} + {R}_{2}}} =  - \left( \frac{{R}_{2}}{{R}_{1}}\right) \frac{\frac{{R}_{1}{A}_{vd}\left( 0\right) }{{R}_{1} + {R}_{2}}}{1 + \frac{{A}_{vd}\left( 0\right) {R}_{1}}{{R}_{1} + {R}_{2}}} =  - \left( \frac{{R}_{2}}{{R}_{1}}\right) \frac{\left| LG\right| }{1 + \left| {LG}\right| } \tag{E.2-6}
$$
Note that as ${A}_{vd}\left( 0\right)$ or $\left| {LG}\right|$ becomes large, Eqs. (E.2-4) and (E.2-6) approach Eqs. (E.2-1) and (E.2-2), respectively.
---
Example E.2-1
---
## Accuracy Limitation of Voltage Amplifiers Due to a Finite Voltage Gain
Assume that the voltage amplifiers of Fig. E.2-1 have been designed for a voltage gain of +10 and -10 . If ${A}_{vd}\left( 0\right)$ is 1000, find the actual voltage gains for each amplifier.
## SOLUTION
For the noninverting amplifier, the ratio of ${R}_{2}/{R}_{1}$ is 9 . Therefore, from Eq. (E.2-5) the feedback loop gain becomes $\left| {LG}\right|  = {1000}/\left( {1 + 9}\right)  = {100}$ . From Eq. (E.2-4), the actual gain is ${10}\left( {{100}/{101}}\right)  = {9.901}$ rather than 10 . For the inverting amplifier, the ratio of ${R}_{2}/{R}_{1}$ is 10 . In this case, the feedback loop gain is $\left| {LG}\right|  = {1000}/\left( {1 + {10}}\right)  = {90.909}$ . Substituting this value in Eq. (E.2-6) gives an actual gain of -9.891 rather than -10 .
A finite value of ${A}_{vd}\left( 0\right)$ in Eq. (E.2-3) will influence the accuracy of the amplifier’s gain at dc and low frequencies. As the frequency increases, a finite value of ${GB}$ in Eq. (E.2-3) will influence the amplifier's frequency response. Before repeating the above analysis, let us assume that $\omega$ is much greater than ${\omega }_{a}$ so that we may use the approximation for ${A}_{vd}\left( s\right)$ given in Eq. (E.2-3), that is, ${A}_{vd}\left( s\right)  \approx  {GB}/s$ . Replacing ${A}_{vd}\left( 0\right)$ in Eqs. (E.2-4) and (E.2-6) by ${GB}/s$ results in the following expression for the noninverting amplifier:
$$
\frac{{V}_{\text{out }}\left( s\right) }{{V}_{\text{in }}\left( s\right) } = \left( \frac{{R}_{1} + {R}_{2}}{{R}_{1}}\right) \frac{\frac{{GB} \cdot  {R}_{1}}{{R}_{1} + {R}_{2}}}{s + \frac{{GB} \cdot  {R}_{1}}{{R}_{1} + {R}_{2}}} = \left( \frac{{R}_{1} + {R}_{2}}{{R}_{1}}\right) \frac{{\omega }_{H}}{s + {\omega }_{H}} \tag{E.2-7}
$$
where ${\omega }_{H}$ is the upper $- 3\mathrm{\;{dB}}$ frequency and is given as
$$
{\omega }_{H} = \frac{{GB} \cdot  {R}_{1}}{{R}_{1} + {R}_{2}} \tag{E.2-8}
$$
The equivalent expression for the inverting amplifier is given below.
$$
\frac{{V}_{\text{out }}\left( s\right) }{{V}_{\text{in }}\left( s\right) } = \left( {-\frac{{R}_{2}}{{R}_{1}}}\right) \frac{\frac{{GB} \cdot  {R}_{1}}{{R}_{1} + {R}_{2}}}{s + \frac{{GB} \cdot  {R}_{1}}{{R}_{1} + {R}_{2}}} = \left( {-\frac{{R}_{2}}{{R}_{1}}}\right) \frac{{\omega }_{H}}{s + {\omega }_{H}} \tag{E.2-9}
$$
---
Example E. 2-2
---
## $- 3\mathrm{\;{dB}}$ Frequency of Voltage Amplifiers Due to Finite Unity-Gain Bandwidth
Assume that the voltage amplifiers of Fig. E.2-1 have been designed for a voltage gain of +1 and -1 . If the unity-gain bandwidth, ${GB}$ , of the op amps in Fig. E.2-1 are ${2\pi }$ Mrad/s, find the upper $- 3\mathrm{\;{dB}}$ frequency for each amplifier.
## SOLUTION
In both cases, the upper $- 3\mathrm{\;{dB}}$ frequency is given by Eq. (E.2-8). However, for the noninverting amplifier with an ideal gain of $+ 1$ , the value of ${R}_{2}/{R}_{1}$ is zero. Therefore, the upper $- 3\mathrm{\;{dB}}$ frequency, ${\omega }_{H}$ , is equal to ${GB}$ or ${2\pi }\mathrm{{Mrad}}/\mathrm{s}\left( \mathrm{{MHz}}\right)$ . For the inverting amplifier with an ideal gain of -1, the value of ${R}_{2}/{R}_{1}$ is one. Therefore, ${\omega }_{H}$ is equal to ${GB}/2$ or $\pi \mathrm{{Mrad}}/\mathrm{s}\left( {{500}\mathrm{{kHz}}}\right)$ .
## Charge Amplifiers
Before we consider switched capacitor amplifiers, let us examine a category of amplifiers called charge amplifiers. Charge amplifiers simply replace the resistors of Fig. E.2-1 by capacitors, resulting in Fig. E.2-3. All the relationships summarized above hold if the resistor is replaced by the reciprocal capacitor. For example, the influence of the low-frequency, differential voltage gain, ${A}_{vd}\left( 0\right)$ , given in Eqs. (E.2-4),(E.2-5), and (E.2-6) become
$$
\frac{{V}_{\text{out }}}{{V}_{\text{in }}} = \left( \frac{{C}_{1} + {C}_{2}}{{C}_{2}}\right) \frac{\left| LG\right| }{1 + \left| {LG}\right| } \tag{E.2-10}
$$
$$
\left| {LG}\right|  = \frac{{A}_{vd}\left( 0\right) {C}_{2}}{{C}_{1} + {C}_{2}} \tag{E.2-11}
$$
and
$$
\frac{{V}_{\text{out }}}{{V}_{\text{in }}} =  - \left( \frac{{C}_{1}}{{C}_{2}}\right) \frac{\left| LG\right| }{1 + \left| {LG}\right| } \tag{E.2-12}
$$

Figure E.2-3 (a) Noninverting charge amplifier. (b.) Inverting charge amplifier.
respectively. The influence of the unity-gain bandwidth, ${GB}$ , given in Eqs. (E.2-7),(E.2-8), and (E.2-9) becomes
$$
\frac{{V}_{\text{out }}\left( s\right) }{{V}_{\text{in }}\left( s\right) } = \left( \frac{{C}_{1} + {C}_{2}}{{C}_{2}}\right) \frac{{\omega }_{H}}{s + {\omega }_{H}} \tag{E.2-13}
$$
$$
{\omega }_{H} = \frac{{GB} \cdot  {C}_{2}}{{C}_{1} + {C}_{2}} \tag{E.2-14}
$$
and
$$
\frac{{V}_{\text{out }}\left( s\right) }{{V}_{\text{in }}\left( s\right) } = \left( {-\frac{{C}_{1}}{{C}_{2}}}\right) \frac{{\omega }_{H}}{s + {\omega }_{H}} \tag{E.2-15}
$$
The major difference between the charge amplifiers of Fig. E.2-3 and the voltage amplifiers of Fig. E.2-1 occurs as a function of time. If the inputs to the charge amplifiers remain constant, eventually the leakage currents will cause the voltage across the capacitors to change. This will result in the output voltage of the op amp becoming equal to either its plus or minus limit. At this point, the feedback loop around the op amp is no longer active and the above equations no longer hold. Thus, one of the requirements for charge amplifiers is that voltage across the capacitor is redefined often enough so that leakage currents have no influence. It turns out in switched capacitor circuits that the voltages are redefined at least once every clock cycle. Therefore, charge amplifiers find use in switched capacitor circuits as voltage amplifiers.
## Switched Capacitor Amplifiers
At first thought, it may seem like the charge amplifiers above can serve as amplifiers for switched capacitor circuits. While this is true there are several reasons for examining a switched capacitor amplifier that uses op amps, switches, and capacitors. The first is that there is a difference between the performance of switched capacitor amplifiers and charge amplifiers. Second, switched capacitor amplifiers are a natural step in the development of switched capacitor integrators, which are an important objective of this chapter. For the present, we will consider only a switched capacitor implementation of the inverting voltage amplifier of Fig. E.2-1(b).
The switched capacitor voltage amplifier of Fig. E.2-4(b) can be analyzed using the methods illustrated in the previous section. It turns out that the op amp will make the analysis simpler because it reduces the number of floating nodes to zero. Let us use the clock phasing shown in Fig. E.1-4(b) to guide the analysis. We begin with the ${\phi }_{1}$ phase period during the time interval from $\left( {n - 1}\right) T$ to $\left( {n - \frac{1}{2}}\right) T$ . We see that during this time, ${C}_{1}$ is charged to ${v}_{\text{in }}^{o}$ $\left( {n - 1}\right) T$ and ${C}_{2}$ is discharged. Now, let us consider the next clock period, ${\phi }_{2}$ , during the time from $t = \left( {n - \frac{1}{2}}\right) T$ to $t = {nT}$ . The equivalent circuit of Fig. E.2-4 just at the moment that the ${\phi }_{2}$ switch closes is shown in Fig. E.2-5(a). (For simplicity, this moment is assumed to be $t = 0$ .) A more useful form of this circuit is given in Fig. E.2-5(b). In Fig. E.2-5(b), a step voltage source of ${v}_{\text{in }}^{o}\left( {n - 1}\right) T$ is effectively applied to an inverting charge amplifier to yield the output voltage during the ${\phi }_{2}$ phase period of
$$
{v}_{\text{out }}^{e}\left( {n - \frac{1}{2}}\right) T =  - \left( \frac{{C}_{1}}{{C}_{2}}\right) {v}_{\text{in }}^{o}\left( {n - 1}\right) T \tag{E.2-16}
$$

Figure E.2-4 Inverting switched capacitor amplifier.
Converting Eq. (E.2-16) to its $z$ -domain equivalent gives
$$
{z}^{-1/2}{V}_{\text{out }}^{e}\left( z\right)  =  - \left( \frac{{C}_{1}}{{C}_{2}}\right) {z}^{-1}{V}_{\text{in }}^{o}\left( z\right)  \tag{E.2-17}
$$
Multiplying Eq. (E.2-17) by ${z}^{1/2}$ gives
$$
{V}_{\text{out }}^{e}\left( z\right)  =  - \left( \frac{{C}_{1}}{{C}_{2}}\right) {z}^{-1/2}{V}_{\text{in }}^{o}\left( z\right)  \tag{E.2-18}
$$
Solving for the even-odd transfer function gives
$$
{H}^{oe}\left( z\right)  = \frac{{V}_{\text{out }}^{e}\left( z\right) }{{V}_{\text{in }}^{o}\left( z\right) } =  - \left( \frac{{C}_{1}}{{C}_{2}}\right) {z}^{-1/2} \tag{E.2-19}
$$
If we assume that the applied input signal, ${v}_{\text{in }}^{o}\left( {n - 1}\right) T$ , was unchanged during the previous ${\phi }_{2}$ phase period [from $t = \left( {n - \frac{3}{2}}\right) T$ to $t = \left( {n - 1}\right) T$ ], then
$$
{v}_{\text{in }}^{o}\left( {n - 1}\right) T = {v}_{\text{in }}^{e}\left( {n - \frac{3}{2}}\right) T \tag{E.2-20}
$$

Figure E.2-5 (a) Equivalent circuit of Fig. E.2-4 at the moment the ${\phi }_{2}$ switch closes. (b) Simplified equivalent of (a).
which gives
$$
{V}_{\text{in }}^{o}\left( z\right)  = {z}^{-1/2}{V}_{\text{in }}^{e}\left( z\right)  \tag{E.2-21}
$$
Substituting Eq. (E.2-21) into Eq. (E.2-18) gives
$$
{V}_{\text{out }}^{e}\left( z\right)  =  - \left( \frac{{C}_{1}}{{C}_{2}}\right) {z}^{-1}{V}_{\text{in }}^{e}\left( z\right)  \tag{E.2-22}
$$
or
$$
{H}^{ee}\left( z\right)  = \frac{{V}_{\text{out }}^{e}\left( z\right) }{{V}_{\text{in }}^{e}\left( z\right) } =  - \left( \frac{{C}_{1}}{{C}_{2}}\right) {z}^{-1} \tag{E.2-23}
$$
As before, it is useful to compare the continuous time inverting amplifier of Fig. E.2-1(b) with the switched capacitor equivalent of Fig. E.2-4 in the frequency domain. Let us first assume ideal op amps. The frequency response of Fig. E.2-1(b) has a magnitude of ${R}_{2}/{R}_{1}$ and a phase shift of $\pm  {180}^{ \circ  }$ . Both the magnitude and phase shift are independent of frequency. The frequency response of Fig. E.2-4 is found by substituting for $z$ by ${e}^{j\omega T}$ in Eq. (E.2-19) or (E.2-23). The result is
$$
{H}^{oe}\left( {e}^{j\omega T}\right)  = \frac{{V}_{\text{out }}^{e}\left( {e}^{j\omega T}\right) }{{V}_{\text{in }}^{o}\left( {e}^{j\omega T}\right) } =  - \left( \frac{{C}_{1}}{{C}_{2}}\right) {e}^{-{j\omega T}/2} \tag{E.2-24}
$$
for Eq. (E.2-19) and
$$
{H}^{ee}\left( {e}^{j\omega T}\right)  = \frac{{V}_{\text{out }}^{e}\left( {e}^{j\omega T}\right) }{{V}_{\text{in }}^{e}\left( {e}^{j\omega T}\right) } =  - \left( \frac{{C}_{1}}{{C}_{2}}\right) {e}^{-{j\omega T}} \tag{E.2-25}
$$
for Eq. (E.2-23). If ${C}_{1}/{C}_{2}$ is equal to ${R}_{2}/{R}_{1}$ , then the magnitude response of Fig. E.2-4 is identical to that of Fig. E.2-1(b). However, the phase shift of Eq. (E.2-24) is
$$
\operatorname{Arg}\left\lbrack  {{H}^{oe}\left( {e}^{j\omega T}\right) }\right\rbrack   =  \pm  {180}^{ \circ  } - {\omega T}/2 \tag{E.2-26}
$$
and the phase shift of Eq. (E.2-25) is
$$
\operatorname{Arg}\left\lbrack  {{H}^{ee}\left( {e}^{j\omega T}\right) }\right\rbrack   =  \pm  {180}^{ \circ  } - {\omega T} \tag{E.2-27}
$$
We see that the phase shift of the switched capacitor inverting amplifier starts out equal to the continuous time inverting amplifier but experiences a linear phase delay in addition to the $\pm  {180}^{ \circ  }$ phase shift. The excess negative phase shift of Eq. (E.2-27) is twice that of Eq. (E.2-26). The reader can confirm that when the signal frequency is one-half of the clock frequency, the excess negative phase shift from Eq. (E.2-26) is ${90}^{ \circ  }$ and from Eq. (E.2-27) it is ${180}^{ \circ  }$ . In most cases, the excess negative phase shift will not be important. However, if the switched capacitor inverting amplifier is placed in a feedback loop, the excess phase shift can become a critical factor in regard to stability.
In practice, the switched capacitor inverting amplifier of Fig. E.2-4 is influenced by the parasitic capacitors shown in Fig. 2.4-3. The bottom-plate parasitic is shorted out but the top-plate parasitic adds directly to the value of ${C}_{1}$ . We observe that the parasitics of ${C}_{2}$ do not affect it. This is because one of the parasitic capacitors (i.e., the bottom plate) is in shunt with the op amp input, which is a virtual ground and always has zero voltage across it. The other parasitic capacitor (i.e., the top plate) is in shunt with the output of the op amp and only serves as a capacitive load for the op amp.
Switched capacitor circuits have been developed that are insensitive to the capacitor parasitics [3]. Figure E.2-6 shows positive and negative switched capacitor transresistor equivalent circuits that are independent of the capacitor parasitics. These transresistors are two-port networks that take the voltage applied at one port and create a current in the other port, which has been short-circuited in this case. In our application, the short-circuited port is the port connected to the differential input of the op amp, which is a virtual ground.
We see that if the switched capacitor circuits of Fig. E.2-6 are used as transresistances, then the parasitic capacitors of $C$ do not influence the circuit. When the ${\phi }_{1}$ switches in Fig. E.2-6(a) are closed, the parasitic capacitors, ${C}_{P}$ , are shorted out and cannot be charged. During the ${\phi }_{2}$ phase, the parasitic capacitors are either connected in parallel with ${v}_{1}$ or shorted out. Even though the left-hand parasitic capacitor is charged to a value of ${v}_{1}$ , this charge is shorted out during the next phase period, ${\phi }_{1}$ .
We now show that Fig. E.2-6(b) is equivalent to a negative transresistance of $T/C$ . The transresistance of Fig. E.2-6 is defined as
$$
{R}_{T} = \frac{{v}_{1}\left( t\right) }{{i}_{2}\left( t\right) } = \frac{{v}_{1}}{{i}_{2}\text{ (average) }} \tag{E.2-28}
$$
In Eq. (E.2-28), we have assumed as before that ${v}_{1}\left( t\right)$ is approximately constant over one period of the clock frequency. We can write
$$
{i}_{2}\text{(average)} = \frac{1}{T}{\int }_{T/2}^{T}{i}_{2}\left( t\right) {dt} = \frac{{q}_{2}\left( T\right)  - {q}_{2}\left( {T/2}\right) }{T} = \frac{C{v}_{c}\left( T\right)  - C{v}_{c}\left( {T/2}\right) }{T} = \frac{-C{v}_{1}}{T} \tag{E.2-29}
$$
Substituting Eq. (E.2-28) into Eq. (E.2-29) shows that ${R}_{T} =  - T/C$ . Similarly, it can be shown that the transresistance of Fig. E.2-6(a) is $T/C$ . These results are only valid when ${f}_{c} >  > f$ .
Using the switched capacitor transresistances of Fig. E.2-6 in the switched capacitor inverting amplifier of Fig. E.2-4, we can achieve both a noninverting and an inverting switched capacitor voltage amplifier that is independent of the parasitic capacitances of the capacitors. The resulting circuits are shown in Fig. E.2-7. We should take careful notice of the fact that the only difference between Figs. E.2-7(a) and E.2-7(b) are the phasing of the leftmost set of switches. We still use the feedback circuit of Fig. E.2-4(b) because the transresis-tance circuits of Fig. E.2-6 would cause the feedback loop to be open during one of the clock phases. Although the circuits of Fig. E.2-6 achieve the desired realization of switched capacitor voltage amplifiers, we must examine their performance more closely because they are slightly different from the previous circuit of Fig. E.2-4.

Figure E.2-6 (a) Positive and (b) negative switched capacitor transresistance equivalent circuits.

Figure E.2-7 (a) Noninverting and (b) inverting switched capacitor voltage amplifiers that are insensitive to parasitic capacitors.
Let us first examine the noninverting voltage amplifier of Fig. E.2-7(a). Using the phasing of Fig. E.1-4(b), we begin with the ${\phi }_{1}$ phase during the time from $t = \left( {n - 1}\right) T$ to $t = (n -$ $\left. \frac{1}{2}\right)$ T. The voltages across each capacitor can be written as
$$
{v}_{C1}^{o}\left( {n - 1}\right) T = {v}_{\text{in }}^{o}\left( {n - 1}\right) T \tag{E.2-30}
$$
and
$$
{v}_{C2}^{o}\left( {n - 1}\right) T = {v}_{\text{out }}^{o}\left( {n - 1}\right) T = 0 \tag{E.2-31}
$$
During the ${\phi }_{2}$ phase, the circuit is equivalent to the inverting charge amplifier of Fig. E.2-3(b) with a negative input of ${v}_{\text{in }}^{o}\left( {n - 1}\right) T$ applied. As a consequence, the output voltage can be written as
$$
{v}_{\text{out }}^{e}\left( {n - \frac{1}{2}}\right) T = \left( \frac{{C}_{1}}{{C}_{2}}\right) {v}_{\text{in }}^{o}\left( {n - 1}\right) T \tag{E.2-32}
$$
The $z$ -domain equivalent of Eq. (E.2-32) is
$$
{V}_{\text{out }}^{e}\left( z\right)  = \left( \frac{{C}_{1}}{{C}_{2}}\right) {z}^{-1/2}{V}_{\text{in }}^{o}\left( z\right)  \tag{E.2-33}
$$
which is equivalent to Eq. (E.2-18) except for the sign. If the applied input signal, ${v}_{\text{in }}^{o}\left( {n - 1}\right) T$ , was unchanged during the previous ${\phi }_{2}$ phase period, then Eq. (E.2-33) becomes
$$
{V}_{\text{out }}^{e}\left( z\right)  = \left( \frac{{C}_{1}}{{C}_{2}}\right) {z}^{-1}{V}_{\text{in }}^{e}\left( z\right)  \tag{E.2-34}
$$
which also is similar to Eq. (E.2-22) except for the sign. To summarize the comparison between Fig. E.2-4 and Fig. E.2-7(a), we see that the magnitude is identical and the phase of Eqs. (E.2-33) and (E.2-34) is simply $- {\omega T}/2$ and $- {\omega T}$ , respectively, without the $\pm  {180}^{ \circ  }$ due to the minus sign.
Next, let us examine Fig. E.2-7(b), which is the inverting voltage amplifier realization. We note that during the ${\phi }_{1}$ phase, both ${C}_{1}$ and ${C}_{2}$ are discharged. Consequently, there is no charge transferred between the ${\phi }_{1}$ and ${\phi }_{2}$ phase periods. During the ${\phi }_{2}$ phase period, Fig. E.2-7(b) is simply an inverting charge amplifier, similar to Fig. E.2-3(b). The output voltage during this phase period is written as
$$
{v}_{\text{out }}^{e}\left( {n - \frac{1}{2}}\right) T =  - \left( \frac{{C}_{1}}{{C}_{2}}\right) {v}_{\text{in }}^{e}\left( {n - \frac{1}{2}}\right) T \tag{E.2-35}
$$
We note that the output voltage has no delay with respect to the input voltage. The $z$ -domain equivalent expression is
$$
{V}_{\text{out }}^{e}\left( z\right)  =  - \left( \frac{{C}_{1}}{{C}_{2}}\right) {V}_{\text{in }}^{e}\left( z\right)  \tag{E.2-36}
$$
Thus, the parasitic insensitive, inverting voltage amplifier is equivalent to an inverting charge amplifier during the phase where ${C}_{1}$ is connected between the input and the inverting input terminal of the op amp. Compared with Fig. E.2-4, which is characterized by Eq. (E.2-19) or (E.2-23), Fig. E.2-7(b) has the same magnitude response but has no excess phase delay.
---
Example E. 2-3
---
## Analysis of a Flip-Around, Gain-of-2 Amplifier
Find the $z$ -domain transfer function of the switched capacitor amplifier in Fig. E.2-8(a). Assume that the op amp is ideal, the ${\phi }_{1}$ switches are closed from $t = \left( {n - 1}\right) T$ to $\left( {n - {0.5}}\right) T$ , and the ${\phi }_{2}$ switched are closed from $t = \left( {n - {0.5}}\right) T$ to ${nT}$ .

Figure E.2-8 (a) Flip-around voltage amplifier. (b) ${\phi }_{1}$ phase period. (b) ${\phi }_{2}$ phase period.
## SOLUTION
The configuration of the amplifier during the ${\phi }_{1}$ phase period is shown in Fig. E.2-8(b). During this time we can write,
$$
{v}_{C1}^{o}\left( {n - 1}\right) T = {v}_{\text{in }}^{o}\left( {n - 1}\right) T \tag{E.2-37}
$$
and
$$
{v}_{C2}^{o}\left( {n - 1}\right) T = {v}_{\text{in }}^{o}\left( {n - 1}\right) T \tag{E.2-38}
$$
The configuration of the amplifier during the ${\phi }_{2}$ phase period is shown in Fig. E.2-8(c). In this period we can write
$$
{v}_{\text{out }}^{e}\left( {n - {0.5}}\right) T = {v}_{C2}^{o}\left( {n - 1}\right) T + \frac{{C}_{1}}{{C}_{2}}{v}_{C1}^{e}\left( {n - 1}\right) T = \left( {1 + \frac{{C}_{1}}{{C}_{2}}}\right) {v}_{\text{in }}^{o}\left( {n - 1}\right) T \tag{E.2-39}
$$
or
$$
{v}_{\text{out }}^{e}\left( {n - {0.5}}\right) T = \left( {1 + \frac{{C}_{1}}{{C}_{2}}}\right) {v}_{\text{in }}^{o}\left( {n - 1}\right) T \tag{E.2-40}
$$
Converting to $z$ -domain equivalent gives
$$
{V}_{\text{out }}^{e}\left( z\right)  = \left( {1 + \frac{{C}_{1}}{{C}_{2}}}\right) {z}^{-{0.5}}{V}_{\text{in }}^{e}\left( z\right)  \tag{E.2-41}
$$
The advantage of this amplifier is seen in Eq. (E.2-14). Normally, a +2 amplifier would have ${C}_{1} = 2{C}_{2}$ , which gives a factor of one-third multiplying the op amp ${GB}$ . In this case, ${C}_{1} =$ ${C}_{2}$ , which means the factor multiplying the ${GB}$ is one-half. The result is a slightly higher bandwidth that becomes important in applications requiring high speed.
## Nonidealities of Switched Capacitor Circuits
In Section 4.1, we noted that the MOSFET switches of the switched capacitor circuits can cause a feedthrough that results in a dc offset. This offset has two parts, an input-dependent part and an input-independent part. We will illustrate the influence of clock feedthrough in the following example, which requires a good understanding of the clock feedthrough model presented in Section 4.1.
---
Example E. 2-4
---
## Influence of Clock Feedthrough on a Noninverting Switched Capacitor Amplifier
A noninverting switched capacitor voltage amplifier is shown in Fig. E.2-9. The switch overlap capacitors, ${C}_{OL}$ , are assumed to be ${100}\mathrm{{fF}}$ each and ${C}_{1} = {C}_{2} = 1\mathrm{{pF}}$ . If the switches have a $W = {1\mu }\mathrm{m}$ and $L = {1\mu }\mathrm{m}$ and the nonoverlapping clock of $0 - 5\mathrm{\;V}$ amplitude has a rate of rise and fall of $\pm  {0.2} \times  {10}^{9}\mathrm{\;V}/\mathrm{s}$ , find the actual value of the output voltage when a $1\mathrm{\;V}$ signal is applied to the input.
## SOLUTION
We will break this example into three time sequences. The first will be when ${\phi }_{1}$ turns off ( ${\phi }_{\text{loff }}$ ), the second when ${\phi }_{2}$ turns on $\left( {\phi }_{2\mathrm{{on}}}\right)$ , and the third when ${\phi }_{2}$ turns off $\left( {\phi }_{2\mathrm{{off}}}\right)$ .
## ${\phi }_{1}$ Turning Off
For M1 the value of ${V}_{HT}$ [Eq. (4.1-5)] is given as
$$
{V}_{HT} = 5\mathrm{\;V} - 1\mathrm{\;V} - {0.7}\mathrm{\;V} = {3.3}\mathrm{\;V}
$$

Figure E.2-9 Noninverting switched capacitor voltage amplifier showing the MOSFET switch overlap capacitors, ${C}_{OL}$ .
Therefore, the value of $\beta {V}_{HT}^{2}/2{C}_{L}$ is found as
$$
\frac{\beta {V}_{HT}^{2}}{2{C}_{L}} = \frac{{110} \times  {10}^{-6}{\left( {3.3}\right) }^{2}}{2 \times  {10}^{-{12}}} = {0.599} \times  {10}^{9}\mathrm{\;V}/\mathrm{s}
$$
We see that this corresponds approximately to the slow transition mode. Using Eq. (4.1-6) gives
$$
{V}_{\text{error }} = \left( \frac{{220} \times  {10}^{-{18}} + \left( {0.5}\right) \left( {24.7}\right) \left( {10}^{-{16}}\right) }{{10}^{-{12}}}\right) \sqrt{\frac{\pi  \cdot  2 \times  {10}^{8} \cdot  {10}^{-{12}}}{2 \cdot  {110} \times  {10}^{-6}}} - \frac{{220} \times  {10}^{-{18}}}{{10}^{-{12}}}\left( {1 + {1.4} + 0}\right)
$$
$$
= \left( {0.001455}\right) \left( {1.690}\right)  - {220} \times  {10}^{-6}\left( {2.4}\right)  = {2.459}\mathrm{\;{mV}} - {0.528}\mathrm{\;{mV}} = {1.931}\mathrm{\;{mV}}
$$
For M2 the value of ${V}_{HT}$ [Eq. (4.1-5)] is given as
$$
{V}_{HT} = 5\mathrm{\;V} - 0\mathrm{\;V} - {0.7}\mathrm{\;V} = {4.3}\mathrm{\;V}
$$
The value of $\beta {V}_{HT}^{2}/2{C}_{L}$ is found as
$$
\frac{\beta {V}_{HT}^{2}}{2{C}_{L}} = \frac{{110} \times  {10}^{-6}{\left( {4.3}\right) }^{2}}{2 \times  {10}^{-{12}}} = {1.017} \times  {10}^{9}\mathrm{\;V}/\mathrm{s}
$$
Therefore, M2 is also in the slow transition mode. The error voltage using Eq. (4.1-6) is found as
$$
{V}_{\text{error }} = \left( \frac{{220} \times  {10}^{-{18}} + \left( {0.5}\right) \left( {24.7}\right) \left( {10}^{-{16}}\right) }{{10}^{-{12}}}\right) \sqrt{\frac{\pi  \cdot  2 \times  {10}^{8} \cdot  {10}^{-{12}}}{2 \cdot  {110} \times  {10}^{-6}}} - \frac{{220} \times  {10}^{-{18}}}{{10}^{-{12}}}\left( {1 + {1.4} + 0}\right)
$$
$$
= \left( {0.001455}\right) \left( {1.690}\right)  - {220} \times  {10}^{-6}\left( {1.4}\right)  = {2.459}\mathrm{{mV}} - {0.308}\mathrm{{mV}} = {2.151}\mathrm{{mV}}
$$
Therefore, the net error on the ${C}_{1}$ capacitor at the end of the ${\phi }_{1}$ phase is
$$
{v}_{C1}\left( {\phi }_{1\mathrm{{off}}}\right)  = {1.0} - {0.00193} + {0.00215} = {1.00022}\mathrm{\;V}
$$
We see that the influence of ${v}_{in} \neq  0\mathrm{\;V}$ is to cause the feedthrough from M1 and M2 not to cancel completely.
We must also consider the influence of M5 turning off. In order to use the relationships of Section 4.1 on M5, we see that feedthrough of M5 via a virtual ground is valid for the model given in Section 4.1 for feedthrough. Based on this assumption, M5 will have the same feedthrough as M2, which is ${2.15}\mathrm{\;{mV}}$ . This error voltage will be left on ${C}_{2}$ at the end of the ${\phi }_{1}$ phase and is
$$
{v}_{C2}\left( {\phi }_{1\text{ off }}\right)  = {0.00215}\mathrm{\;V}
$$
## ${\phi }_{2}$ Turning On
During the turn-on part of ${\phi }_{2}$ , M3 and M4 will feed through onto ${C}_{1}$ and ${C}_{2}$ . However, it is easy to show that the influence of M3 and M4 will cancel each other for ${C}_{1}$ . Therefore, we need only consider the feedthrough of M4 and its influence on ${C}_{2}$ . Interestingly enough, the feedthrough of M4 onto ${C}_{2}$ is exactly equal and opposite to the previous feedthrough by M5. As a result, the value of voltage on ${C}_{2}$ after ${\phi }_{2}$ has stabilized is
$$
{v}_{C2}\left( {\phi }_{2\mathrm{{on}}}\right)  = {0.00215}\mathrm{\;V} - {0.00215}\mathrm{\;V} + \frac{{C}_{1}}{{C}_{2}}{v}_{C1}\left( {\phi }_{1\mathrm{{off}}}\right)  = {1.00022}\mathrm{\;V}
$$
## ${\phi }_{2}$ Turning Off
Finally, as switch M4 turns off, there will be feedthrough onto ${C}_{2}$ . Since M4 has one of its terminals at $0\mathrm{\;V}$ , the feedthrough is the same as before and is ${2.15}\mathrm{\;{mV}}$ . The final voltage across ${C}_{2}$ , and therefore the output voltage ${v}_{\text{out }}$ , is given as
$$
{v}_{\text{out }}\left( {\phi }_{2\text{ off }}\right)  = {v}_{C2}\left( {\phi }_{2\text{ off }}\right)  = {1.00022}\mathrm{\;V} + {0.00215}\mathrm{\;V} = {1.0024}\mathrm{\;V}
$$
It is interesting to note that the last feedthrough has the most influence.
The next nonideality of the switched capacitor voltage amplifiers we will examine is that of a finite differential voltage gain of the op amp, ${A}_{vd}\left( 0\right)$ . The influence of ${A}_{vd}\left( 0\right)$ on the noninverting voltage amplifier of Fig. E.2-7(a) can be characterized from the model given in Fig. E.2-10 for the amplifier during the ${\phi }_{2}$ phase period. Equations (E.2-30) and (E.2-31) for the ${\phi }_{2}$ phase period are still valid. Because ${A}_{vd}\left( 0\right)$ is not infinite, there is a voltage that exists in series with the op amp input to model this result. The value of this voltage source is ${v}_{\text{out }}/{A}_{vd}\left( 0\right)$ , where ${v}_{\text{out }}$ is the output voltage of the op amp. The result, as shown in Fig. E.2-10, is that a virtual ground no longer exists at the inverting input terminal of the op amp. Therefore, the output voltage during the ${\phi }_{2}$ phase period can be written as
$$
{v}_{\text{out }}^{e}\left( {n - \frac{1}{2}}\right) T = \left( \frac{{C}_{1}}{{C}_{2}}\right) {v}_{\text{in }}^{o}\left( {n - 1}\right) T + \left( \frac{{C}_{1} + {C}_{2}}{{C}_{2}}\right) \frac{{v}_{\text{out }}^{e}\left( {n - \frac{1}{2}}\right) T}{{A}_{vd}\left( 0\right) } \tag{E.2-42}
$$
Note that if ${A}_{vd}\left( 0\right)$ becomes infinite Eq. (E.2-42) reduces to Eq. (E.2-32). Converting Eq. (E.2-42) to the $z$ -domain and solving for the ${H}^{oe}\left( z\right)$ transfer function gives
$$
{H}^{oe}\left( z\right)  = \frac{{V}_{\text{out }}^{e}\left( z\right) }{{V}_{\text{in }}^{o}\left( z\right) } = \left( \frac{{C}_{1}}{{C}_{2}}\right) {z}^{-1/2}\left\lbrack  \frac{1}{1 - \frac{{C}_{1} + {C}_{2}}{{A}_{vd}\left( 0\right) {C}_{2}}}\right\rbrack   \tag{E.2-43}
$$

Figure E.2-10 Circuit model for Fig. E.2-7(a) during the ${\phi }_{2}$ phase.
Equation (E.2-43) shows that the influence of a finite value of ${A}_{vd}\left( 0\right)$ is on the magnitude response only. The phase response is unaffected by a finite value of ${A}_{vd}\left( 0\right)$ . For example, if ${A}_{vd}\left( 0\right)$ is ${1000}\mathrm{\;V}/\mathrm{V}$ , then for Example E.2-4, the bracketed term, which is the error term (Eq. E.2-43), has a value of 1.002 instead of the ideal value of 1.0 . This error is a gain error, which can influence the signal-processing function of the switched capacitor circuit.
Lastly, let us consider the influence of a finite value of the unity-gain bandwidth, ${GB}$ , and the slew rate of the op amp. The quantitative analysis of the influence of ${GB}$ on switched capacitor circuits is not simple and is best done using simulation methods. In general, if clock period $T$ becomes less than ${10}/{GB}$ , the ${GB}$ will influence the performance. The influence manifests itself in an incomplete transfer of charge causing both magnitude and phase errors. The ${GB}$ of the op amp must be large enough so that the transient response, called the settling time, is completed before the circuit is ready for the next phase. For further details, the reader is referred to the literature [3].
In addition to a finite value of ${GB}$ , another nonideality of the op amp that can influence the switched capacitor circuit performance is the slew rate. The slew rate is the maximum rate of the rise or fall of the output voltage of the op amp. If the output voltage of the op amp must make large changes, such as when the feedback switch (M5) in Fig. E.2-9 closes, the slew rate requires a period of time for the output voltage to change. For example, suppose the output voltage of Fig. E.2-9 is $5\mathrm{\;V}$ and the slew rate of the op amp is $1\mathrm{\;V}/\mu \mathrm{s}$ . To change the output by $5\mathrm{\;V}$ requires ${5\mu }\mathrm{s}$ . This means a period of at least ${10\mu }\mathrm{s}$ is required, which corresponds to a maximum clock frequency of ${100}\mathrm{{kHz}}$ .
### E.3 Switched Capacitor Integrators
The switched capacitor integrator is a key building block in analog signal-processing circuits. All filter design can be reduced to noninverting and inverting integrators. In this section, we will first examine continuous time integrators to understand the desired performance of switched capacitor integrators. The remainder of the section will discuss switched capacitor integrators and illustrate their frequency response characteristics. The influence of the nonideal characteristics of the op amp and switches on the performance will be presented.
## Continuous Time Integrators
Noninverting and inverting continuous time integrators using op amps are shown in Fig. E.3-1. While it is possible to find a noninverting integrator configuration using one op amp, Fig. E.3-1(a) is used because it is one of the simplest forms of a noninverting integrator. We will characterize the integrators in this section in the frequency domain although we could equally well use the time domain. The ideal transfer function for the noninverting integrator of Fig. E.3-1(a) is
$$
\frac{{V}_{\text{out }}\left( {j\omega }\right) }{{V}_{\text{in }}\left( {j\omega }\right) } = \frac{1}{{j\omega }{R}_{1}{C}_{2}} = \frac{{\omega }_{I}}{j\omega } = \frac{-j{\omega }_{I}}{\omega } \tag{E.3-1}
$$
where ${\omega }_{I}$ is called the integrator frequency. ${\tau }_{I}$ is equal to $1/{\omega }_{I}$ and is called the integrator time constant. ${\omega }_{I}$ is the frequency where the magnitude of the integrator gain is unity. For the inverting integrator, the ideal transfer function is
$$
\frac{{V}_{\text{out }}\left( {j\omega }\right) }{{V}_{\text{in }}\left( {j\omega }\right) } = \frac{-1}{{j\omega }{R}_{1}{C}_{2}} = \frac{-{\omega }_{I}}{j\omega } = \frac{j{\omega }_{I}}{\omega } \tag{E.3-2}
$$

Figure E.3-1 (a) Noninverting and (b) inverting continuous time integrators.
Figure E.3-2 gives the ideal magnitude and phase response of the noninverting and inverting integrators. The magnitude response is the same but the phase response is different by ${180}^{ \circ  }$ .
Let us now investigate the influence of a finite value of the differential voltage gain, ${A}_{vd}\left( 0\right)$ , and a finite unity-gain bandwidth, ${GB}$ , of the op amp. We will focus only on Fig. E.3-1(b) because the switched capacitor realizations will use this structure and not Fig. E.3-1(a). Substituting the resistance, ${R}_{1}$ , in Fig. E.2-2 with a capacitance, ${C}_{2}$ , and solving for the closed transfer function gives
$$
\frac{{V}_{\text{out }}}{{V}_{\text{in }}} =  - \left( \frac{1}{s{R}_{1}{C}_{2}}\right) \frac{\frac{{A}_{vd}\left( s\right) s{R}_{1}{C}_{2}}{s{R}_{1}{C}_{2} + 1}}{1 + \frac{{A}_{vd}\left( s\right) s{R}_{1}{C}_{2}}{s{R}_{1}{C}_{2} + 1}} = \left( {-\frac{{\omega }_{I}}{s}}\right) \frac{\frac{{A}_{vd}\left( s\right) \left( {s/{\omega }_{I}}\right) }{\left( {s/{\omega }_{I}}\right)  + 1}}{1 + \frac{{A}_{vd}\left( s\right) \left( {s/{\omega }_{I}}\right) }{\left( {s/{\omega }_{I}}\right)  + 1}} \tag{E.3-3}
$$
where the magnitude of the loop gain, $\left| {LG}\right|$ , is given as
$$
\left| {LG}\right|  = \frac{{A}_{vd}\left( s\right) \left( {s/{\omega }_{I}}\right) }{\left( {s/{\omega }_{I}}\right)  + 1} \tag{E.3-4}
$$

Figure E.3-2 (a) Ideal magnitude and (b) phase response for a noninverting and continuous time integrator.
As we examine the magnitude of the loop gain frequency response, we see that for low frequencies $\left( {s \rightarrow  0}\right) {LG}$ becomes much less than unity. Also, at high frequencies ${LG}$ is much less than unity. In the middle frequency range, the magnitude of ${LG}$ is much greater than unity and Eq. (E.3-3) becomes
$$
\frac{{V}_{\text{out }}}{{V}_{\text{in }}} =  - \frac{{\omega }_{I}}{s} \tag{E.3-5}
$$
At low frequencies $\left( {s \rightarrow  0}\right) ,{A}_{vd}\left( s\right)$ is approximately ${A}_{vd}\left( 0\right)$ and Eq. (E.3-3) becomes
$$
\frac{{V}_{\text{out }}}{{V}_{\text{in }}} =  - {A}_{vd}\left( 0\right)  \tag{E.3-6}
$$
At high frequencies $\left( {s \rightarrow  \infty }\right) ,{A}_{vd}\left( s\right)$ is approximately ${GB}/s$ and Eq. (E.3-3) becomes
$$
\frac{{V}_{\text{out }}}{{V}_{\text{in }}} =  - \left( \frac{GB}{s}\right) \left( \frac{{\omega }_{I}}{s}\right)  \tag{E.3-7}
$$
Equations (E.3-5) through (E.3-7) represent Eq. (E.3-3) for various ranges of frequency. We can identify these ranges by finding the frequency where the magnitude of the loop gain goes to unity. However, it is simpler just to equate the magnitude of Eq. (E.3-5) to Eq. (E.3-6) and solve for the frequency, ${\omega }_{x1}$ , where they cross. The result is
$$
{\omega }_{x1} = \frac{{\omega }_{I}}{{A}_{vd}\left( 0\right) } \tag{E.3-8}
$$
The transition frequency between Eqs. (E.3-5) and (E.3-7), ${\omega }_{x2}$ , is similarly found by equating the magnitude of Eq. (E.3-5) to the magnitude of Eq. (E.3-7), resulting in
$$
{\omega }_{x2} = {GB} \tag{E.3-9}
$$
Figure E.3-3 shows the resulting asymptotic magnitude and phase response of the inverting integrator when ${A}_{vd}\left( 0\right)$ and ${GB}$ are finite.

Figure E.3-3 (a) Magnitude and (b) phase response of a continuous time inverting integrator when ${A}_{vd}\left( 0\right)$ and ${GB}$ are finite.
## Frequency Range Over Which the Continuous Time Integrator Is Ideal
Find the range of frequencies over which the continuous time integrator approximates ideal behavior if ${A}_{vd}\left( 0\right)$ and ${GB}$ of the op amp are 1000 and $1\mathrm{{MHz}}$ , respectively. Assume that ${\omega }_{I}$ is ${2000\pi }\mathrm{{rad}}/\mathrm{s}$ .
## SOLUTION
The "idealness" of an integrator is determined by how close the phase shift is to $\pm  {90}^{ \circ  }\left( {+{90}^{ \circ  }}\right.$ for an inverting integrator and $- {90}^{ \circ  }$ for a noninverting integrator). The actual phase shift in the asymptotic plot of Fig. E.3-3(b) is approximately ${6}^{ \circ  }$ above ${90}^{ \circ  }$ at the frequency ${10}{\omega }_{I}/{A}_{vd}\left( 0\right)$ and approximately ${6}^{ \circ  }$ below ${90}^{ \circ  }$ at ${GB}/{10}$ . Let us assume for this example that a $\pm  {6}^{ \circ  }$ tolerance is satisfactory. The frequency range can be found by evaluating ${10}{\omega }_{I}/{A}_{vd}\left( 0\right)$ and ${GB}/{10}$ . We find this range to be from ${10}\mathrm{\;{Hz}}$ to ${100}\mathrm{{kHz}}$ .
## Switched Capacitor Integrators
The implementation of switched capacitor integrators is straightforward based on the previous considerations of this chapter. Let us choose the continuous time inverting integrator of Fig. E.3-1(b) as the prototype. If we replace the resistor, ${R}_{1}$ , with the negative transresistance equivalent circuit of Fig. E.2-6(b), we obtain the noninverting switched capacitor integrator shown in Fig. E.3-4(a). Note that the negative transresistance circuit in effect realizes the inverter of Fig. E.3-1(a). Next, if we replace ${R}_{1}$ by the positive transresistance equivalent circuit of Fig. E.2-6(a), we obtain the inverting switched capacitor integrator shown in Fig. E.3- 4(b). Alternately, we could simply remove the ${\phi }_{1}$ feedback switch from circuits in Fig. E.2-7 to obtain the circuits in Fig. E.3-4.
Next, we will develop the frequency response for each of the integrators in Fig. E.3-4. Starting with the noninverting integrator of Fig. E.3-4(a), let us again use the phasing of Fig. E.1-4(b). Beginning with the phase ${\phi }_{1}$ , during the time from $t = \left( {n - 1}\right) T$ to $t = \left( {n - \frac{1}{2}}\right) T$ , we may write the voltage across each capacitor as
$$
{v}_{c1}^{o}\left( {n - 1}\right) T = {v}_{\text{in }}^{o}\left( {n - 1}\right) T \tag{E.3-10}
$$
and
$$
{v}_{c2}^{o}\left( {n - 1}\right) T = {v}_{\text{out }}^{o}\left( {n - 1}\right) T \tag{E.3-11}
$$

Figure E.3-4 (a) Noninverting and (b) inverting switched capacitor integrators that are independent of parasitic capacitors.
---
Example E. 3-1
---
During the ${\phi }_{2}$ phase, the circuit is equivalent to the circuit shown in Fig. E.3-5. Note that each capacitor has a previous charge that is now represented by voltage sources in series with the capacitances. From Fig. E.3-5(b), we can write
$$
{v}_{\text{out }}^{e}\left( {n - \frac{1}{2}}\right) T = \left( \frac{{C}_{1}}{{C}_{2}}\right) {v}_{\text{in }}^{o}\left( {n - 1}\right) T + {v}_{\text{out }}^{o}\left( {n - 1}\right) T \tag{E.3-12}
$$
If we advance one more phase period, that is, $t = \left( {n - \frac{1}{2}}\right) T$ to $t = \left( n\right) T$ , we see that the voltage at the output is unchanged. Thus, we may write
$$
{v}_{\text{out }}^{o}\left( n\right) T = {v}_{\text{out }}^{e}\left( {n - \frac{1}{2}}\right) T \tag{E.3-13}
$$
Substituting Eq. (E.3-12) into Eq. (E.3-13) gives the desired time relationship expressed as
$$
{v}_{\text{out }}^{o}\left( n\right) T = \left( \frac{{C}_{1}}{{C}_{2}}\right) {v}_{\text{in }}^{o}\left( {n - 1}\right) T + {v}_{\text{out }}^{o}\left( {n - 1}\right) T \tag{E.3-14}
$$
We can write Eq. (E.3-14) in the $z$ -domain as
$$
{V}_{\text{out }}^{o}\left( z\right)  = \left( \frac{{C}_{1}}{{C}_{2}}\right) {z}^{-1}{V}_{\text{in }}^{o}\left( z\right)  + {z}^{-1}{V}_{\text{out }}^{o}\left( z\right)  \tag{E.3-15}
$$
Solving for the transfer function, ${H}^{oo}\left( z\right)$ , gives
$$
{H}^{oo}\left( z\right)  = \frac{{V}_{\text{out }}^{o}\left( z\right) }{{V}_{\text{in }}^{o}\left( z\right) } = \left( \frac{{C}_{1}}{{C}_{2}}\right) \frac{{z}^{-1}}{1 - {z}^{-1}} = \left( \frac{{C}_{1}}{{C}_{2}}\right) \frac{1}{z - 1} \tag{E.3-16}
$$
To get the frequency response, we replace $z$ by ${e}^{j\omega T}$ . The result is
$$
{H}^{oo}\left( {e}^{j\omega T}\right)  = \frac{{V}_{\text{out }}^{o}\left( {e}^{j\omega T}\right) }{{V}_{\text{in }}^{o}\left( {e}^{j\omega T}\right) } = \left( \frac{{C}_{1}}{{C}_{2}}\right) \frac{1}{{e}^{j\omega T} - 1} = \left( \frac{{C}_{1}}{{C}_{2}}\right) \frac{{e}^{-{j\omega T}/2}}{{e}^{{j\omega T}/2} - {e}^{-{j\omega T}/2}} \tag{E.3-17}
$$
Replacing ${e}^{{j\omega T}/2} - {e}^{-{j\omega T}/2}$ by its equivalent trigonometric identity, Eq. (E.3-17) becomes
$$
{H}^{oo}\left( {e}^{j\omega T}\right)  = \frac{{V}_{\text{out }}^{o}\left( {e}^{j\omega T}\right) }{{V}_{\text{in }}^{o}\left( {e}^{j\omega T}\right) } = \left( \frac{{C}_{1}}{{C}_{2}}\right) \frac{{e}^{-{j\omega T}/2}}{{j2}\sin \left( {{\omega T}/2}\right) }\left( \frac{\omega T}{\omega T}\right)  = \left( \frac{{C}_{1}}{{j\omega T}{C}_{2}}\right) \left( \frac{{\omega T}/2}{\sin \left( {{\omega T}/2}\right) }\right) \left( {e}^{-{j\omega T}/2}\right)  \tag{E.3-18}
$$

Figure E.3-5 (a) Equivalent circuit of Fig. E.3-4(a) at the moment the ${\phi }_{2}$ switches close. (b) Simplified equivalent circuit of (a).
The interpretation of the results of Eq. (E.3-18) is found by letting ${\omega T}$ become small so that the last two terms approach unity. Therefore, we can equate Eq. (E.3-18) with Eq. (E.3-1). We see that the result is that ${R}_{1}$ is equivalent to $T/{C}_{1}$ , which is consistent with the transresistance of Fig. E.2-6. The integrator frequency, ${\omega }_{I}$ , can be expressed as
$$
{\omega }_{I} = \frac{{C}_{1}}{T{C}_{2}} \tag{E.3-19}
$$
Note that the integrator frequency, ${\omega }_{I}$ , of the switched capacitor integrator will be well defined because it is proportional to the ratio of capacitors.
The second and third terms in Eq. (E.3-18) represent the magnitude error and phase error, respectively. As the signal frequency, $\omega$ , increases the magnitude term increases from a value of unity and approaches infinity when $\omega  = {2\pi }/T$ . The phase error is zero at low frequencies and subtracts linearly from the ideal phase shift of $- {90}^{ \circ  }$ . The following example illustrates the influence of these errors and the difference between a continuous time and switched capacitor integrator.
---
Example E. 3-2
---
## Comparison of a Continuous Time and Switched Capacitor Integrator
Assume that ${\omega }_{I}$ is equal to ${0.1}{\omega }_{c}$ and plot the magnitude and phase response of the noninverting continuous time and switched capacitor integrator from 0 to ${\omega }_{c}$ .
## SOLUTION
Letting ${\omega }_{I}$ be ${0.1}{\omega }_{c}$ gives
$$
H\left( {j\omega }\right)  = \frac{1}{{10j\omega }/{\omega }_{c}}
$$
and
$$
{H}^{oo}\left( {e}^{j\omega T}\right)  = \left( \frac{1}{{10j\omega }/{\omega }_{c}}\right) \left( \frac{{\pi \omega }/{\omega }_{c}}{\sin \left( {{\pi \omega }/{\omega }_{c}}\right) }\right) \left( {e}^{-{j\pi \omega }/{\omega }_{c}}\right)
$$
Figure E.3-6 shows the results of this example. Note that the magnitudes of the continuous and switched capacitor integrators are reasonably close up to a frequency of ${\omega }_{l}$ . On the other hand, the phase shift is only close at $\omega  = 0$ .

Figure E.3-6 (a) Magnitude and (b) phase response of a continuous time, $H\left( {j\omega }\right)$ , and a switched capacitor, ${H}^{oo}\left( {e}^{j\omega T}\right)$ , noninverting integrator.
The inverting, stray-insensitive, switched capacitor integrator is shown in Fig. E.3-4(b). The frequency response for this circuit will be developed in a manner similar to the noninverting integrator illustrated above. If we continue to use the switch phasing of Fig. E.1-4(b), the conditions during the ${\phi }_{1}$ phase period during the time from $t = \left( {n - 1}\right) T$ to $t = \left( {n - \frac{1}{2}}\right) T$ can be written as
$$
{v}_{C1}^{o}\left( {n - 1}\right) T = 0 \tag{E.3-20}
$$
and
$$
{v}_{C2}^{o}\left( {n - 1}\right) T = {v}_{\text{out }}^{o}\left( {n - 1}\right) T = {v}_{\text{out }}^{e}\left( {n - \frac{3}{2}}\right) T \tag{E.3-21}
$$
We note from Eq. (E.3-21) that the capacitor, ${C}_{2}$ , holds the voltage from the previous phase period, ${\phi }_{2}$ , during the present phase period, ${\phi }_{1}$ .
During the next phase period, ${\phi }_{2}$ , which occurs during the time from $t = \left( {n - \frac{1}{2}}\right) T$ to $t =$ ${nT}$ , the inverting integrator of Fig. E.3-4(b) can be represented as shown in Fig. E.3-7(a). Using the simplified equivalent circuit of Fig. E.3-7(b), we easily write the output voltage during this phase period as
$$
{v}_{\text{out }}^{e}\left( {n - \frac{1}{2}}\right) T = {v}_{\text{out }}^{e}\left( {n - \frac{3}{2}}\right) T - \left( \frac{{C}_{1}}{{C}_{2}}\right) {v}_{\text{in }}^{e}\left( {n - \frac{1}{2}}\right) T \tag{E.3-22}
$$

Figure E.3-7 (a) Equivalent circuit of Fig. E.3-4(b) at the moment the ${\phi }_{2}$ switches close. (b) Simplified equivalent circuit of (a).
Expressing Eq. (E.3-22) in terms of the $z$ -domain equivalent gives
$$
{V}_{\text{out }}^{e}\left( z\right)  = {z}^{-1}{V}_{\text{out }}^{e}\left( z\right)  - \left( \frac{{C}_{1}}{{C}_{2}}\right) {V}_{\text{in }}^{e}\left( z\right)  \tag{E.3-23}
$$
Solving for the transfer function, ${H}^{ee}\left( z\right)$ , gives
$$
{H}^{ee}\left( z\right)  = \frac{{V}_{\text{out }}^{e}\left( z\right) }{{V}_{\text{in }}^{e}\left( z\right) } =  - \left( \frac{{C}_{1}}{{C}_{2}}\right) \frac{1}{1 - {z}^{-1}} =  - \left( \frac{{C}_{1}}{{C}_{2}}\right) \frac{z}{z - 1} \tag{E.3-24}
$$
To get the frequency response, we replace $z$ by ${e}^{j\omega T}$ . The result is
$$
{H}^{ee}\left( {e}^{j\omega T}\right)  = \frac{{V}_{\text{out }}^{e}\left( {e}^{j\omega T}\right) }{{V}_{\text{in }}^{e}\left( {e}^{j\omega T}\right) } =  - \left( \frac{{C}_{1}}{{C}_{2}}\right) \frac{{e}^{j\omega T}}{{e}^{j\omega T} - 1} =  - \left( \frac{{C}_{1}}{{C}_{2}}\right) \frac{{e}^{{j\omega T}/2}}{{e}^{{j\omega T}/2} - {e}^{-{j\omega T}/2}} \tag{E.3-25}
$$
Replacing ${e}^{{j\omega T}/2} - {e}^{-{j\omega T}/2}$ in Eq. (E.3-25) by ${2j}\sin \left( {{\omega T}/2}\right)$ and simplifying gives
$$
{H}^{ee}\left( {e}^{j\omega T}\right)  = \frac{{V}_{\text{out }}^{e}\left( {e}^{j\omega T}\right) }{{V}_{\text{in }}^{e}\left( {e}^{j\omega T}\right) } =  - \left( \frac{{C}_{1}}{{j\omega T}{C}_{2}}\right) \left( \frac{{\omega T}/2}{\sin \left( {{\omega T}/2}\right) }\right) \left( {e}^{{j\omega T}/2}\right)  \tag{E.3-26}
$$
Equation (E.3-26) is nearly identical with Eq. (E.3-18) for the noninverting integrator. The only difference is the minus sign multiplying the entire function and in the argument of the exponential term. Consequently, the magnitude response is identical but the phase response is given as
$$
\operatorname{Arg}\left\lbrack  {{H}^{ee}\left( {e}^{j\omega T}\right) }\right\rbrack   = \frac{\pi }{2} + \frac{\omega T}{2} \tag{E.3-27}
$$
We see that the phase error is positive for the case of the inverting integrator and negative for the noninverting integrator. Other transfer functions can be developed for the inverting (and noninverting) integrator depending on when the output is taken.
In many applications, a noninverting and an inverting integrator are in series in a feedback loop. It should be noted using the configurations of Fig. E.3-4 that the phase errors of each integrator cancel, resulting in no phase error. Consequently, these integrators would be ideal from a phase response viewpoint.
In addition, we note that the inverting, stray-insensitive, switched capacitor integrator of Fig. E.3-4(b) differs from the noninverting, stray-insensitive, switched capacitor integrator of Fig. E.3-4(a) only by the phasing of the two leftmost switches. The same observation is true of the switched capacitor amplifiers of Fig. E.2-7. In many applications, the phasing of these switches can be controlled by a circuit such as Fig. E.3-8, which steers the ${\phi }_{1}$ and ${\phi }_{2}$ clocks according to the binary value of the control voltage, ${v}_{C}.{\phi }_{x}$ is applied to the switch connected to the input (S1) and ${\phi }_{y}$ is applied to the leftmost switch connected to ground (S2). This circuit is particularly useful in waveform generators.
## Nonideal Characteristics of Switched Capacitor Integrators
The nonideal behavior of switched capacitor integrators includes clock feedthrough, finite differential voltage gain of the op amp, finite unity-gain bandwidth of the op amp, and the slew rate of the op amp. We will briefly consider the effects of each of these characteristics.

Figure E.3-8 A circuit that changes the ${\phi }_{1}$ and ${\phi }_{2}$ clocks of the leftmost switches of Fig. E.3-4.
The influence of the clock feedthrough has been illustrated in the discussion of switched capacitor amplifiers. Recall that the offset appeared at the output in two forms: one that was independent of the input signal and one that was dependent on the input signal. The signal-dependent input offset can be removed by delaying the ${\phi }_{1}$ clock applied to the leftmost switches of Fig. E.3-4. Figure E.3-9 illustrates how the clock is delayed. Consider the results of applying the clocks of Fig. E.3-9 to the noninverting integrator of Fig. E.3-4(a). As ${S}_{3}$ opens when ${\phi }_{1}$ falls, clock feedthrough occurs but since the switch terminals are at ground potential, this feedthrough is independent of the signal level. After a clock delay, S1 opens when the clock ${\phi }_{1d}$ falls. However, no feedthrough can occur because ${S}_{3}$ is open and there is no current path. A delayed clock for ${\phi }_{2}$ is not necessary because switches ${S}_{2}$ and ${S}_{4}$ have no input-dependent feedthrough. The delayed clock for switch ${S1}$ results in the removal of input-dependent feedthrough.
The influence of a finite value of ${A}_{vd}\left( 0\right)$ can be developed by using the model for the op amp shown in Fig. E.2-10 for one of the switched capacitor integrators of Fig. E.3-4. Consider the circuit in Fig. E.3-10, which is an equivalent for the noninverting integrator at the beginning of the ${\phi }_{2}$ phase period. Compared with Fig. E.3-5(b), we note two important changes. The first is the presence of an independent source, ${v}_{\text{out }}^{e}\left( {n - \frac{1}{2}}\right) T/{A}_{vd}\left( 0\right)$ , that models the finite value of ${A}_{vd}\left( 0\right)$ and the second is that the independent source in series with ${C}_{2}$ has

Figure E.3-9 Delayed clock scheme to remove input-dependent offset voltage.

Figure E.3-10 Equivalent circuit for the noninverting integrator at the beginning of the ${\phi }_{2}$ phase period.
been decreased by the amount of ${v}_{\text{out }}^{o}\left( {n = 1}\right) T/I{A}_{vd}\left( 0\right)$ . The time domain expression for ${v}_{\text{out }}^{e}$ $\left( {n - \frac{1}{2}}\right) T$ can be written as
$$
{v}_{\text{out }}^{e}\left( {n - \frac{1}{2}}\right) T = \left( \frac{{C}_{1}}{{C}_{2}}\right) {v}_{\text{in }}^{o}\left( {n - 1}\right) T + {v}_{\text{out }}^{o}\left( {n - 1}\right) T - \frac{{v}_{\text{out }}^{o}\left( {n - 1}\right) T}{{A}_{vd}\left( 0\right) } + \frac{{v}_{\text{out }}^{e}\left( {n - \frac{1}{2}}\right) T}{{A}_{vd}\left( 0\right) }\left( \frac{{C}_{1} + {C}_{2}}{{C}_{2}}\right)  \tag{E.3-28}
$$
Substituting Eq. (E.3-13) into Eq. (E.3-28) gives
$$
{v}_{\text{out }}^{o}\left( n\right) T = \left( \frac{{C}_{1}}{{C}_{2}}\right) {v}_{\text{in }}^{o}\left( {n - 1}\right) T + {v}_{\text{out }}^{o}\left( {n - 1}\right) T - \frac{{v}_{\text{out }}^{o}\left( {n - 1}\right) T}{{A}_{vd}\left( 0\right) } + \frac{{v}_{\text{out }}^{o}\left( n\right) T}{{A}_{vd}\left( 0\right) }\left( \frac{{C}_{1} + {C}_{2}}{{C}_{2}}\right)  \tag{E.3-29}
$$
Using the previous procedures to solve for the $z$ -domain transfer function results in
$$
{H}^{oo}\left( z\right)  = \frac{{V}_{\text{out }}^{o}\left( z\right) }{{V}_{\text{in }}^{o}\left( z\right) } = \frac{\frac{{C}_{1}}{{C}_{2}}{z}^{-1}}{1 - {z}^{-1} + \frac{{z}^{-1}}{{A}_{vd}\left( 0\right) } - \frac{{C}_{1}}{{A}_{vd}\left( 0\right) {C}_{2}} - \frac{1}{{A}_{vd}\left( 0\right) }} \tag{E.3-30}
$$
Equation (E.3-30) can be rewritten as
$$
{H}^{oo}\left( z\right)  = \frac{{V}_{\text{out }}^{o}\left( z\right) }{{V}_{\text{in }}^{o}\left( z\right) } = \left( \frac{\left( {{C}_{1}/{C}_{2}}\right) {z}^{-1}}{1 - {z}^{-1}}\right) \left( \frac{1}{1 - \frac{1}{{A}_{vd}\left( 0\right) } - \frac{{C}_{1}}{{A}_{vd}\left( 0\right) {C}_{2}\left( {1 - {z}^{-1}}\right) }}\right)  \tag{E.3-31}
$$
or
$$
{H}^{oo}\left( z\right)  = \frac{{V}_{\text{out }}^{o}\left( z\right) }{{V}_{\text{in }}^{o}\left( z\right) } = \frac{{H}_{I}\left( z\right) }{1 - \frac{1}{{A}_{vd}\left( 0\right) } - \frac{{C}_{1}}{{A}_{vd}\left( 0\right) {C}_{2}\left( {1 - {z}^{-1}}\right) }} \tag{E.3-32}
$$
where ${H}_{I}\left( z\right)$ is given by Eq. (E.3-16). The similar development for the inverting integrator of Fig. E.3-4(b) results in Eq. (E.3-32) if ${H}_{I}\left( z\right)$ is given by Eq. (E.3-24).
The denominator of Eq. (E.3-32) represents the error due to a finite value of ${A}_{vd}\left( 0\right)$ . If we substitute in Eq. (E.3-32) for the $z$ -domain variable, $z$ , by ${e}^{j\omega T}$ , we can get the following expression:
$$
{H}^{oo}\left( {e}^{j\omega T}\right)  = \frac{{H}_{I}\left( {e}^{j\omega T}\right) }{1 - \frac{1}{{A}_{vd}\left( 0\right) }\left\lbrack  {1 + \frac{{C}_{1}}{2{C}_{2}}}\right\rbrack   - j\frac{{C}_{1}/{C}_{2}}{2{A}_{vd}\left( 0\right) \tan \left( {{\omega T}/2}\right) }} \tag{E.3-33}
$$
where now ${H}_{I}\left( {e}^{j\omega T}\right)$ is given by Eq. (E.3-18) for the noninverting integrator and by Eq. (E.3-26) for the inverting integrator. The error of an integrator can be expressed by the following [3]:
$$
H\left( {j\omega }\right)  = \frac{{H}_{I}\left( {j\omega }\right) }{\left\lbrack  {1 - m\left( \omega \right) }\right\rbrack  {e}^{-{j\theta }\left( \omega \right) }} \tag{E.3-34}
$$
where $m\left( \omega \right)$ is the magnitude error and $\theta \left( \omega \right)$ is the phase error and ${H}_{I}\left( {j\omega }\right)$ is the ideal integrator transfer function. Note that in the case of switched capacitor circuits, ${H}_{I}\left( {j\omega }\right)$ includes a magnitude and phase error due to sampling. If $\theta \left( \omega \right)$ is much less than unity, Eq. (E.3-34) can be approximated by
$$
H\left( {j\omega }\right)  \approx  \frac{{H}_{I}\left( {j\omega }\right) }{1 - m\left( \omega \right)  - {j\theta }\left( \omega \right) } \tag{E.3-35}
$$
Comparing Eq. (E.3-33) with Eq. (E.3-35) gives the magnitude and phase error due to a finite value of ${A}_{vd}\left( 0\right)$ as
$$
m\left( {j\omega }\right)  = \frac{1}{{A}_{vd}\left( 0\right) }\left\lbrack  {1 + \frac{{C}_{1}}{2{C}_{2}}}\right\rbrack   \tag{E.3-36}
$$
and
$$
\theta \left( {j\omega }\right)  = \frac{{C}_{1}/{C}_{2}}{2{A}_{vd}\left( 0\right) \tan {\omega T}/2} \tag{E.3-37}
$$
Equations (E.3-36) and (E.3-37) characterize the magnitude and phase error due to a finite value of ${A}_{vd}\left( 0\right)$ for the switched capacitor integrators of Fig. E.3-4.
---
Example E.3-3
---
## Evaluation of the Integrator Errors Due to a Finite Value of ${A}_{vd}\left( 0\right)$
Assume that the clock frequency and integrator frequency of a switch capacitor integrator are ${100}\mathrm{{kHz}}$ and ${10}\mathrm{{kHz}}$ , respectively. If the value of ${A}_{vd}\left( 0\right)$ is100, find the value of $m\left( {j\omega }\right)$ and $\theta \left( {j\omega }\right)$ at ${10}\mathrm{{kHz}}$ .
## SOLUTION
The ratio of ${C}_{1}$ to ${C}_{2}$ is found from Eq. (E.3-19) as
$$
\frac{{C}_{1}}{{C}_{2}} = {\omega }_{1}T = \frac{{2\pi } \cdot  {10},{000}}{{100},{000}} = {0.6283}
$$
Substituting this value along with that for ${A}_{vd}\left( 0\right)$ into Eqs. (E.3-36) and (E.3-37) gives
$$
m\left( {j\omega }\right)  = \frac{1}{100}\left\lbrack  {1 + \frac{0.6283}{2}}\right\rbrack   = {1.0131} \rightarrow  1 - m\left( \omega \right)  = {0.9869}
$$
and
$$
\theta \left( {j\omega }\right)  = \frac{0.6283}{2 \cdot  {100} \cdot  \tan \left( {18}^{ \circ  }\right) } = {0.554}^{ \circ  }
$$
The interpretation of these results is best seen in Eq. (E.3-34). The "ideal" switched capacitor transfer function, ${H}_{I}\left( {j\omega }\right)$ , will be multiplied by a value of approximately $1/{0.9869} =$ 1.013 and will have an additional phase lag of approximately ${0.554}^{ \circ  }$ . In general, the phase shift error is more serious than the magnitude error.
Finally, let us examine the influence of a finite value of the unity-gain bandwidth, ${GB}$ . The calculations necessary to develop the results require a time domain model for the op amp that incorporates the frequency effects of ${GB}$ . The model and calculations are beyond the scope of this presentation but can be found in the appendix of Martin and Sedra [3]. The results are summarized in Table E.3-1. If ${\omega T}$ is much less than unity, the expressions in Table E. 3-1 reduce to
$$
m\left( \omega \right)  \approx   - {2\pi }\left( \frac{f}{{f}_{c}}\right) {e}^{-\pi \left( {{GB}/{f}_{c}}\right) } \tag{E.3-38}
$$
for both the noninverting and inverting integrators. For the noninverting integrator, $\theta \left( {j\omega }\right)$ is still approximately zero but for the inverting integrator, $\theta \left( \omega \right)  \approx  m\left( \omega \right)$ . These results should allow one to estimate the influence of a finite value of ${GB}$ on the performance of the switched capacitor integrators of Fig. E.3-4.
The remaining nonideal characteristic of the op amp to consider is the slew rate. The integrators are fortunate in being less sensitive to slew-rate limits than the amplifiers of the last section. This is because the feedback capacitor, ${C}_{2}$ , holds the output voltage of the op amp constant when no capacitors are being connected to the inverting input of the op amp. Slew-rate limitations occur only when the output of the op amp is changing due to a change of charge on ${C}_{2}$ . During this time, slew-rate limitation may occur. To avoid this limitation, it is necessary that the following inequality be satisfied:
$$
\frac{\Delta {v}_{o}\left( \max \right) }{SR} < \frac{T}{2} \tag{E.3-39}
$$
where $\Delta {v}_{o}\left( \max \right)$ is the maximum output swing of the integrator. For example, if $\Delta {v}_{o}\left( \max \right)$ is $5\mathrm{\;V}$ and the clock frequency is ${100}\mathrm{{kHz}}$ , the slew rate of the op amp must be greater than $1\mathrm{\;V}/\mu \mathrm{s}$ . To allow for the other nonidealities of the op amp, a slew rate of ${10}\mathrm{\;V}/\mu \mathrm{s}$ would be preferable in this case.
Table E.3-1 Summary of the Influence of a Finite Value of ${GB}$ on Switched Capacitor Integrators
<table><tr><td>Noninverting Integrator</td><td>Inverting Integrator</td></tr><tr><td>$m\left( \omega \right)  \approx   - {e}^{-{k}_{1}}\left( \frac{{C}_{2}}{{C}_{1} + {C}_{2}}\right)$</td><td>$m\left( \omega \right)  \approx   - {e}^{-{k}_{1}}\left\lbrack  {1 - \left( \frac{{C}_{2}}{{C}_{1} + {C}_{2}}\right) \cos \left( {\omega T}\right) }\right\rbrack$</td></tr><tr><td>$\theta \left( \omega \right)  \approx  0$</td><td>$\theta \left( \omega \right)  \approx   - {e}^{-{k}_{1}}\left( \frac{{C}_{2}}{{C}_{1} + {C}_{2}}\right) \cos \left( {\omega T}\right)$</td></tr><tr><td>${k}_{1} \approx  \pi \left( \frac{{C}_{2}}{{C}_{1} + {C}_{2}}\right) \left( \frac{GB}{{f}_{c}}\right)$</td><td/></tr></table>

Figure E.3-11 (a) Simple switched capacitor circuit. (b) Approximation of (a).
The noise of switched capacitor circuits includes normal sources plus a noise source that is a thermal equivalent noise source of the switches. This noise-voltage spectral density is called ${kT}/C$ noise and has units of ${\mathrm{V}}^{2}/\mathrm{{Hz}}$ . Assume that the switched capacitor of Fig. E.3- 11(a) can be represented by the continuous time circuit of Fig. E.3-11(b). Next, we find the rms noise voltage of Fig. E.3-11(b) and assume that it approximates that of Fig. E.3-11(a).
The noise-voltage spectral density of Fig. E.3-11(b) is given as
$$
{e}_{{R}_{on}}^{2} = {4kT}{R}_{on}{\mathrm{V}}^{2}/\mathrm{{Hz}} = \frac{{2kT}{R}_{on}}{\pi }{\mathrm{V}}^{2}/\mathrm{{rad}}/\mathrm{s} \tag{E.3-40}
$$
The rms noise voltage is found by integrating this spectral density from 0 to $\infty$ . This is given as
$$
{v}_{{R}_{on}}^{2} = \frac{{2kT}{R}_{on}}{\pi }{\int }_{0}^{\infty }\frac{{\omega }_{1}^{2}{d\omega }}{{\omega }_{1}^{2} + {\omega }^{2}} = \frac{{2kT}{R}_{on}}{\pi }\left( \frac{\pi {\omega }_{1}}{2}\right)  = \frac{kT}{C}{\mathrm{\;V}}^{2}\left( \mathrm{{rms}}\right)  \tag{E.3-41}
$$
where ${\omega }_{1} = 1/\left( {{R}_{on}C}\right)$ . Note that the switch has an effective noise bandwidth of
$$
{f}_{sw} = \frac{1}{4{R}_{on}C}\mathrm{\;{Hz}} \tag{E.3-42}
$$
which is found by dividing Eq. (E.3-41) by Eq. (E.3-40).
Other nonidealities that we have not examined include noise coupled directly or capacitively from the power, clock, and ground lines and from the substrate into the circuit. In addition, the noise of the MOSFETs must be considered.
## References
1. A. V. Oppenheim and R. W. Schafer, Digital Signal Processing. Englewood Cliffs, NJ: Prentice Hall, 1975.
2. A. S. Sedra and K. C. Smith, Microelectronic Circuits, 3rd ed. New York: Oxford University Press, 1991.
3. K. Martin and A. S. Sedra, "Effects of the Op Amp Finite Gain and Bandwidth on the Performance of Switched-Capacitor Filters," IEEE Trans. on Circuits and Systems, Vol. CAS-28, no. 8, August 1981, pp. 822-829.
## INDEX

This page has been reformatted by Knovel to provide easier navigation.
Index Terms

This page has been reformatted by Knovel to provide easier navigation.

This page has been reformatted by Knovel to provide easier navigation.
Index Terms
Bandgap voltage reference. See reference, bandgap
Barrier potential 35
Beta $\left( \beta \right)$ 91
Bias monitor 675
BJT
lateral 412
output stage 363
substrate 363
Blackman's formula 136
Body effect 111 131 175 240
Boltzmann constant 35 60 69 77
83 157
Breakdown voltage 32 33 37 40
avalanche 37 60
zener breakdown 37
BSIM 67 95 108 299
Bulk 20 40
bulk threshold parameter. See GAMMA
junction potential 78 94 102 682
See also PB
C
Capacitor, capacitance 46
accumulation 47
bottom plate 47 49
charge storage
cutoff region 70
saturation region 71
nonsaturation region 70
depletion 41 78
double polysilicon 316
finger 48
This page has been reformatted by Knovel to provide easier navigation.

This page has been reformatted by Knovel to provide easier navigation. Current source/sink cascode 510 delta-sigma 601 ladder, R-2R 512 510 536 534 525 513 538 509 598

This page has been reformatted by Knovel to provide easier navigation.
This page has been reformatted by Knovel to provide easier navigation. Design rules Differential amplifiers. See amplifier differential Differential-in, differential-out amplifiers Differential linearity. See linearity, differential Diffused resistor. See resistor diffused Diffusion Diode pn DNL. See linearity, differential DNW Drain Dual-slope A/D. See A/D, dual-slope E Effective channel length/width. See length/width, effective

This page has been reformatted by Knovel to provide easier navigation.
Index Terms

This page has been reformatted by Knovel to provide easier navigation.

Inversion. See moderate inversion, strong inversion, inversion
This page has been reformatted by Knovel to provide easier navigation.

This page has been reformatted by Knovel to provide easier navigation.

This page has been reformatted by Knovel to provide easier navigation.

This page has been reformatted by Knovel to provide easier navigation.

This page has been reformatted by Knovel to provide easier navigation.

This page has been reformatted by Knovel to provide easier navigation.

This page has been reformatted by Knovel to provide easier navigation.

This page has been reformatted by Knovel to provide easier navigation.

This page has been reformatted by Knovel to provide easier navigation.

This page has been reformatted by Knovel to provide easier navigation.

This page has been reformatted by Knovel to provide easier navigation.

This page has been reformatted by Knovel to provide easier navigation.
乙
Z-domain
analysis 693
Zener breakdown. See breakdown, zener
Zener diode 38